<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 8.0.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"wangmc1024.github.io","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":false,"style":"mac"},"back2top":{"enable":true,"sidebar":true,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":true,"pangu":false,"comments":{"style":"tabs","active":"gitalk","storage":true,"lazyload":true,"nav":null,"activeClass":"gitalk"},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":true,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.json"};
  </script>

  <meta name="description" content="结合pybind11官方文档，利用ai整理">
<meta property="og:type" content="article">
<meta property="og:title" content="pybind11使用指南">
<meta property="og:url" content="https://wangmc1024.github.io/2025/10/30/C++/pybind11%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/index.html">
<meta property="og:site_name" content="Computer Science">
<meta property="og:description" content="结合pybind11官方文档，利用ai整理">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2025-10-29T16:05:43.000Z">
<meta property="article:modified_time" content="2025-10-30T12:15:32.294Z">
<meta property="article:author" content="三子曰">
<meta property="article:tag" content="C++">
<meta property="article:tag" content="python">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://wangmc1024.github.io/2025/10/30/C++/pybind11%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>pybind11使用指南 | Computer Science</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>


<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Computer Science</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">WangMC Blog</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>时间轴</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    


    <main class="main">
      <div class="main-inner">
        <div id="spa-content-wrap" class="content-wrap">
            

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://wangmc1024.github.io/2025/10/30/C++/pybind11%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://cdn.jsdelivr.net/gh/MengChangWang/Blog_Image@main/img/avatar.png">
      <meta itemprop="name" content="三子曰">
      <meta itemprop="description" content="欢迎来到我的博客">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Computer Science">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          pybind11使用指南
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2025-10-30 00:05:43 / 修改时间：20:15:32" itemprop="dateCreated datePublished" datetime="2025-10-30T00:05:43+08:00">2025-10-30</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E7%BC%96%E7%A8%8B/" itemprop="url" rel="index"><span itemprop="name">编程</span></a>
                </span>
            </span>

          
            <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span id="busuanzi_value_page_pv"></span>
            </span><br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>27k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>24 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <blockquote>
<p>结合pybind11官方文档，利用ai整理</p>
</blockquote>
<span id="more"></span>
<h1 id="pybind11-全面使用指南">pybind11 全面使用指南</h1>
<p><strong>Date: October 30, 2025</strong><br />
<strong>Code: https://github.com/pybind/pybind11</strong></p>
<hr />
<h2 id="目录">目录</h2>
<ol type="1">
<li><a href="#概述">概述</a></li>
<li><a href="#安装指南">安装指南</a></li>
<li><a href="#快速开始">快速开始</a></li>
<li><a href="#函数绑定">函数绑定</a></li>
<li><a href="#类绑定">类绑定</a></li>
<li><a href="#stl容器支持">STL容器支持</a></li>
<li><a href="#高级特性">高级特性</a></li>
<li><a href="#跨平台构建">跨平台构建</a></li>
<li><a href="#最佳实践">最佳实践</a></li>
<li><a href="#常见问题解决">常见问题解决</a></li>
</ol>
<hr />
<h2 id="概述">概述</h2>
<p>pybind11是一个轻量级的头文件库，用于在C++11和Python之间创建无缝的互操作性。它支持将C++函数、类和数据结构暴露给Python，反之亦然。</p>
<h3 id="主要特性">主要特性</h3>
<ul>
<li><strong>头文件库</strong>: 无需链接额外的库</li>
<li><strong>跨平台</strong>: 支持Windows、Linux、macOS</li>
<li><strong>自动类型转换</strong>: 基本数据类型和STL容器的自动转换</li>
<li><strong>C++11及以上</strong>: 充分利用现代C++特性</li>
<li><strong>Python 3.8+</strong>: 支持最新的Python版本</li>
</ul>
<h3 id="支持的编译器">支持的编译器</h3>
<table>
<colgroup>
<col style="width: 15%" />
<col style="width: 30%" />
<col style="width: 30%" />
<col style="width: 25%" />
</colgroup>
<thead>
<tr>
<th>平台</th>
<th>编译器支持</th>
<th>Python版本</th>
<th>特殊要求</th>
</tr>
</thead>
<tbody>
<tr>
<td>Windows</td>
<td>MSVC 2022+, Clang, GCC</td>
<td>3.8+</td>
<td>需要Visual Studio Build Tools</td>
</tr>
<tr>
<td>Linux</td>
<td>GCC 4.8+, Clang 3.3+</td>
<td>3.8+</td>
<td>开发工具链完备</td>
</tr>
<tr>
<td>macOS</td>
<td>Clang 5.0+</td>
<td>3.8+</td>
<td>Xcode命令行工具</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="安装指南">安装指南</h2>
<h3 id="windows安装">Windows安装</h3>
<h4 id="方法1-使用pip安装">方法1: 使用pip安装</h4>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install pybind11</span><br></pre></td></tr></table></figure>
<h4 id="方法2-使用conda安装">方法2: 使用conda安装</h4>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">conda install -c conda-forge pybind11</span><br></pre></td></tr></table></figure>
<h4 id="方法3-源码安装">方法3: 源码安装</h4>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/pybind/pybind11.git</span><br><span class="line"><span class="built_in">cd</span> pybind11</span><br><span class="line"><span class="built_in">mkdir</span> build</span><br><span class="line"><span class="built_in">cd</span> build</span><br><span class="line">cmake .. -G <span class="string">&quot;Visual Studio 17 2022&quot;</span> -A x64</span><br><span class="line">cmake --build . --config Release</span><br><span class="line">cmake --install .</span><br></pre></td></tr></table></figure>
<h3 id="linux安装">Linux安装</h3>
<h4 id="方法1-使用包管理器">方法1: 使用包管理器</h4>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Ubuntu/Debian</span></span><br><span class="line"><span class="built_in">sudo</span> apt update</span><br><span class="line"><span class="built_in">sudo</span> apt install pybind11-dev</span><br><span class="line"></span><br><span class="line"><span class="comment"># Fedora</span></span><br><span class="line"><span class="built_in">sudo</span> dnf install pybind11-devel</span><br></pre></td></tr></table></figure>
<h4 id="方法2-使用pip安装">方法2: 使用pip安装</h4>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install pybind11</span><br></pre></td></tr></table></figure>
<h4 id="方法3-源码安装-1">方法3: 源码安装</h4>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/pybind/pybind11.git</span><br><span class="line"><span class="built_in">cd</span> pybind11</span><br><span class="line"><span class="built_in">mkdir</span> build</span><br><span class="line"><span class="built_in">cd</span> build</span><br><span class="line">cmake .. -DCMAKE_BUILD_TYPE=Release</span><br><span class="line">make -j4</span><br><span class="line"><span class="built_in">sudo</span> make install</span><br></pre></td></tr></table></figure>
<h3 id="验证安装">验证安装</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 检查pybind11版本</span></span><br><span class="line">python -m pybind11 --version</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取头文件路径</span></span><br><span class="line">python -m pybind11 --includes</span><br></pre></td></tr></table></figure>
<hr />
<h2 id="快速开始">快速开始</h2>
<h3 id="第一个示例">第一个示例</h3>
<p>创建一个简单的C++函数并暴露给Python。</p>
<h4 id="创建c文件-example.cpp">1. 创建C++文件 (example.cpp)</h4>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;pybind11/pybind11.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> py = pybind11;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">add</span><span class="params">(<span class="type">int</span> i, <span class="type">int</span> j)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> i + j;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">PYBIND11_MODULE</span>(example, m) &#123;</span><br><span class="line">    m.<span class="built_in">doc</span>() = <span class="string">&quot;pybind11 example plugin&quot;</span>;  <span class="comment">// 模块文档字符串</span></span><br><span class="line">    m.<span class="built_in">def</span>(<span class="string">&quot;add&quot;</span>, &amp;add, <span class="string">&quot;A function that adds two numbers&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="编译">2. 编译</h4>
<p><strong>Linux/macOS:</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">c++ -O3 -Wall -shared -std=c++11 -fPIC $(python3 -m pybind11 --includes) example.cpp -o example$(python3-config --extension-suffix)</span><br></pre></td></tr></table></figure>
<p><strong>Windows (Visual Studio):</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cl /O2 /LD /EHsc /I %PYBIND11_INCLUDE% /I %PYTHON_INCLUDE% example.cpp /link /LIBPATH:%PYTHON_LIB% python314.lib /OUT:example.pyd</span><br></pre></td></tr></table></figure>
<h4 id="在python中使用">3. 在Python中使用</h4>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> example</span><br><span class="line"><span class="built_in">print</span>(example.add(<span class="number">1</span>, <span class="number">2</span>))  <span class="comment"># 输出: 3</span></span><br><span class="line"><span class="built_in">print</span>(example.__doc__)    <span class="comment"># 输出: pybind11 example plugin</span></span><br></pre></td></tr></table></figure>
<hr />
<h2 id="函数绑定">函数绑定</h2>
<h3 id="基本参数传递">基本参数传递</h3>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;pybind11/pybind11.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> py = pybind11;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">add</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> a + b;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">double</span> <span class="title">multiply</span><span class="params">(<span class="type">double</span> x, <span class="type">double</span> y)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x * y;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">std::string <span class="title">greet</span><span class="params">(<span class="type">const</span> std::string&amp; name)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;Hello, &quot;</span> + name + <span class="string">&quot;!&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">PYBIND11_MODULE</span>(example, m) &#123;</span><br><span class="line">    m.<span class="built_in">def</span>(<span class="string">&quot;add&quot;</span>, &amp;add, <span class="string">&quot;Add two integers&quot;</span>);</span><br><span class="line">    m.<span class="built_in">def</span>(<span class="string">&quot;multiply&quot;</span>, &amp;multiply, <span class="string">&quot;Multiply two doubles&quot;</span>);</span><br><span class="line">    m.<span class="built_in">def</span>(<span class="string">&quot;greet&quot;</span>, &amp;greet, <span class="string">&quot;Greet someone by name&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="关键字参数">关键字参数</h3>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;pybind11/pybind11.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;tuple&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> py = pybind11;</span><br><span class="line"></span><br><span class="line"><span class="function">std::tuple&lt;<span class="type">int</span>, <span class="type">int</span>, <span class="type">int</span>&gt; <span class="title">create_point</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y, <span class="type">int</span> z)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> std::<span class="built_in">make_tuple</span>(x, y, z);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">PYBIND11_MODULE</span>(example, m) &#123;</span><br><span class="line">    m.<span class="built_in">def</span>(<span class="string">&quot;create_point&quot;</span>, &amp;create_point, </span><br><span class="line">          py::<span class="built_in">arg</span>(<span class="string">&quot;x&quot;</span>), py::<span class="built_in">arg</span>(<span class="string">&quot;y&quot;</span>), py::<span class="built_in">arg</span>(<span class="string">&quot;z&quot;</span>),</span><br><span class="line">          <span class="string">&quot;Create a 3D point&quot;</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 简写形式</span></span><br><span class="line">    <span class="keyword">using</span> <span class="keyword">namespace</span> pybind11::literals;</span><br><span class="line">    m.<span class="built_in">def</span>(<span class="string">&quot;create_point_short&quot;</span>, &amp;create_point,</span><br><span class="line">          <span class="string">&quot;x&quot;</span>_a, <span class="string">&quot;y&quot;</span>_a, <span class="string">&quot;z&quot;</span>_a,</span><br><span class="line">          <span class="string">&quot;Create a 3D point (short notation)&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Python使用: <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">point = example.create_point(x=<span class="number">10</span>, y=<span class="number">20</span>, z=<span class="number">30</span>)</span><br></pre></td></tr></table></figure></p>
<h3 id="默认参数">默认参数</h3>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;pybind11/pybind11.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> py = pybind11;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">power</span><span class="params">(<span class="type">int</span> base, <span class="type">int</span> exponent = <span class="number">2</span>)</span> </span>&#123;</span><br><span class="line">    <span class="type">int</span> result = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; exponent; i++) &#123;</span><br><span class="line">        result *= base;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">PYBIND11_MODULE</span>(example, m) &#123;</span><br><span class="line">    m.<span class="built_in">def</span>(<span class="string">&quot;power&quot;</span>, &amp;power, </span><br><span class="line">          py::<span class="built_in">arg</span>(<span class="string">&quot;base&quot;</span>), py::<span class="built_in">arg</span>(<span class="string">&quot;exponent&quot;</span>) = <span class="number">2</span>,</span><br><span class="line">          <span class="string">&quot;Calculate power of a number&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Python使用: <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">result1 = example.power(<span class="number">5</span>)      <span class="comment"># 返回 25 (5^2)</span></span><br><span class="line">result2 = example.power(<span class="number">5</span>, <span class="number">3</span>)   <span class="comment"># 返回 125 (5^3)</span></span><br></pre></td></tr></table></figure></p>
<h3 id="参数传递模式">参数传递模式</h3>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;pybind11/pybind11.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> py = pybind11;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">process_values</span><span class="params">(<span class="type">int</span> by_value, <span class="type">int</span>&amp; by_ref, <span class="type">const</span> <span class="type">int</span>&amp; by_const_ref)</span> </span>&#123;</span><br><span class="line">    by_ref += <span class="number">10</span>;  <span class="comment">// 修改引用参数</span></span><br><span class="line">    <span class="comment">// by_const_ref += 10;  // 错误：const引用不能修改</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">PYBIND11_MODULE</span>(example, m) &#123;</span><br><span class="line">    m.<span class="built_in">def</span>(<span class="string">&quot;process_values&quot;</span>, &amp;process_values,</span><br><span class="line">          py::<span class="built_in">arg</span>(<span class="string">&quot;by_value&quot;</span>), py::<span class="built_in">arg</span>(<span class="string">&quot;by_ref&quot;</span>), py::<span class="built_in">arg</span>(<span class="string">&quot;by_const_ref&quot;</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="禁止类型转换">禁止类型转换</h3>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;pybind11/pybind11.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> py = pybind11;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">strict_int_function</span><span class="params">(<span class="type">int</span> value)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 只接受整数类型</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">PYBIND11_MODULE</span>(example, m) &#123;</span><br><span class="line">    m.<span class="built_in">def</span>(<span class="string">&quot;strict_int_function&quot;</span>, &amp;strict_int_function,</span><br><span class="line">          py::<span class="built_in">arg</span>(<span class="string">&quot;value&quot;</span>).<span class="built_in">noconvert</span>());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr />
<h2 id="类绑定">类绑定</h2>
<h3 id="基本类绑定">基本类绑定</h3>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;pybind11/pybind11.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> py = pybind11;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Person</span>(<span class="type">const</span> std::string&amp; name, <span class="type">int</span> age) </span><br><span class="line">        : <span class="built_in">name</span>(name), <span class="built_in">age</span>(age) &#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">set_name</span><span class="params">(<span class="type">const</span> std::string&amp; new_name)</span> </span>&#123;</span><br><span class="line">        name = new_name;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function">std::string <span class="title">get_name</span><span class="params">()</span> <span class="type">const</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">get_age</span><span class="params">()</span> <span class="type">const</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> age;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function">std::string <span class="title">greet</span><span class="params">()</span> <span class="type">const</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Hello, my name is &quot;</span> + name + <span class="string">&quot; and I&#x27;m &quot;</span> + std::<span class="built_in">to_string</span>(age) + <span class="string">&quot; years old.&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    std::string name;</span><br><span class="line">    <span class="type">int</span> age;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">PYBIND11_MODULE</span>(example, m) &#123;</span><br><span class="line">    py::<span class="built_in">class_</span>&lt;Person&gt;(m, <span class="string">&quot;Person&quot;</span>)</span><br><span class="line">        .<span class="built_in">def</span>(py::<span class="built_in">init</span>&lt;<span class="type">const</span> std::string&amp;, <span class="type">int</span>&gt;(), </span><br><span class="line">             py::<span class="built_in">arg</span>(<span class="string">&quot;name&quot;</span>), py::<span class="built_in">arg</span>(<span class="string">&quot;age&quot;</span>))</span><br><span class="line">        .<span class="built_in">def</span>(<span class="string">&quot;set_name&quot;</span>, &amp;Person::set_name, </span><br><span class="line">             py::<span class="built_in">arg</span>(<span class="string">&quot;new_name&quot;</span>))</span><br><span class="line">        .<span class="built_in">def</span>(<span class="string">&quot;get_name&quot;</span>, &amp;Person::get_name)</span><br><span class="line">        .<span class="built_in">def</span>(<span class="string">&quot;get_age&quot;</span>, &amp;Person::get_age)</span><br><span class="line">        .<span class="built_in">def</span>(<span class="string">&quot;greet&quot;</span>, &amp;Person::greet)</span><br><span class="line">        .<span class="built_in">def_readwrite</span>(<span class="string">&quot;name&quot;</span>, &amp;Person::name)  <span class="comment">// 直接访问成员变量</span></span><br><span class="line">        .<span class="built_in">def_readonly</span>(<span class="string">&quot;age&quot;</span>, &amp;Person::age);    <span class="comment">// 只读访问</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Python使用: <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">person = example.Person(<span class="string">&quot;Alice&quot;</span>, <span class="number">30</span>)</span><br><span class="line"><span class="built_in">print</span>(person.get_name())  <span class="comment"># Alice</span></span><br><span class="line"><span class="built_in">print</span>(person.greet())     <span class="comment"># Hello, my name is Alice and I&#x27;m 30 years old.</span></span><br><span class="line">person.set_name(<span class="string">&quot;Bob&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(person.name)        <span class="comment"># Bob</span></span><br></pre></td></tr></table></figure></p>
<h3 id="继承和多态">继承和多态</h3>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;pybind11/pybind11.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> py = pybind11;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Animal</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">virtual</span> ~<span class="built_in">Animal</span>() &#123;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> std::string <span class="title">speak</span><span class="params">()</span> <span class="type">const</span> </span>= <span class="number">0</span>;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">int</span> <span class="title">get_legs</span><span class="params">()</span> <span class="type">const</span> </span>= <span class="number">0</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Dog</span> : <span class="keyword">public</span> Animal &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">std::string <span class="title">speak</span><span class="params">()</span> <span class="type">const</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Woof!&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">get_legs</span><span class="params">()</span> <span class="type">const</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">4</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">fetch</span><span class="params">()</span> <span class="type">const</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 狗特有的方法</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Bird</span> : <span class="keyword">public</span> Animal &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">std::string <span class="title">speak</span><span class="params">()</span> <span class="type">const</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Chirp!&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">get_legs</span><span class="params">()</span> <span class="type">const</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">2</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">fly</span><span class="params">()</span> <span class="type">const</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 鸟特有的方法</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">PYBIND11_MODULE</span>(example, m) &#123;</span><br><span class="line">    py::<span class="built_in">class_</span>&lt;Animal&gt;(m, <span class="string">&quot;Animal&quot;</span>)</span><br><span class="line">        .<span class="built_in">def</span>(<span class="string">&quot;speak&quot;</span>, &amp;Animal::speak)</span><br><span class="line">        .<span class="built_in">def</span>(<span class="string">&quot;get_legs&quot;</span>, &amp;Animal::get_legs);</span><br><span class="line">    </span><br><span class="line">    py::<span class="built_in">class_</span>&lt;Dog, Animal&gt;(m, <span class="string">&quot;Dog&quot;</span>)</span><br><span class="line">        .<span class="built_in">def</span>(py::init&lt;&gt;())</span><br><span class="line">        .<span class="built_in">def</span>(<span class="string">&quot;fetch&quot;</span>, &amp;Dog::fetch);</span><br><span class="line">    </span><br><span class="line">    py::<span class="built_in">class_</span>&lt;Bird, Animal&gt;(m, <span class="string">&quot;Bird&quot;</span>)</span><br><span class="line">        .<span class="built_in">def</span>(py::init&lt;&gt;())</span><br><span class="line">        .<span class="built_in">def</span>(<span class="string">&quot;fly&quot;</span>, &amp;Bird::fly);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="虚函数重写蹦床类">虚函数重写（蹦床类）</h3>
<p>为了支持Python继承C++类并重写虚函数，需要使用蹦床类：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;pybind11/pybind11.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> py = pybind11;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Animal</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">virtual</span> ~<span class="built_in">Animal</span>() &#123;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> std::string <span class="title">speak</span><span class="params">()</span> <span class="type">const</span> </span>= <span class="number">0</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 蹦床类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">PyAnimal</span> : <span class="keyword">public</span> Animal, <span class="keyword">public</span> py::trampoline_self_life_support &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">using</span> Animal::Animal;</span><br><span class="line">    </span><br><span class="line">    <span class="function">std::string <span class="title">speak</span><span class="params">()</span> <span class="type">const</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        <span class="built_in">PYBIND11_OVERRIDE_PURE</span>(</span><br><span class="line">            std::string,    <span class="comment">// 返回类型</span></span><br><span class="line">            Animal,         <span class="comment">// 父类</span></span><br><span class="line">            speak           <span class="comment">// 函数名</span></span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">PYBIND11_MODULE</span>(example, m) &#123;</span><br><span class="line">    py::<span class="built_in">class_</span>&lt;Animal, PyAnimal, py::smart_holder&gt;(m, <span class="string">&quot;Animal&quot;</span>)</span><br><span class="line">        .<span class="built_in">def</span>(py::init&lt;&gt;())</span><br><span class="line">        .<span class="built_in">def</span>(<span class="string">&quot;speak&quot;</span>, &amp;Animal::speak);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Python中继承： <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> example</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Cat</span>(example.Animal):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">speak</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Meow!&quot;</span></span><br><span class="line"></span><br><span class="line">cat = Cat()</span><br><span class="line"><span class="built_in">print</span>(cat.speak())  <span class="comment"># Meow!</span></span><br></pre></td></tr></table></figure></p>
<hr />
<h2 id="stl容器支持">STL容器支持</h2>
<h3 id="基础容器转换">基础容器转换</h3>
<p>pybind11通过<code>pybind11/stl.h</code>头文件提供STL容器的自动转换：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;pybind11/pybind11.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;pybind11/stl.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;set&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> py = pybind11;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 向量处理</span></span><br><span class="line"><span class="function">std::vector&lt;<span class="type">int</span>&gt; <span class="title">process_vector</span><span class="params">(<span class="type">const</span> std::vector&lt;<span class="type">int</span>&gt;&amp; input)</span> </span>&#123;</span><br><span class="line">    std::vector&lt;<span class="type">int</span>&gt; result;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> num : input) &#123;</span><br><span class="line">        result.<span class="built_in">push_back</span>(num * <span class="number">2</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 集合处理</span></span><br><span class="line"><span class="function">std::set&lt;std::string&gt; <span class="title">unique_words</span><span class="params">(<span class="type">const</span> std::vector&lt;std::string&gt;&amp; words)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> std::<span class="built_in">set</span>&lt;std::string&gt;(words.<span class="built_in">begin</span>(), words.<span class="built_in">end</span>());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 字典处理</span></span><br><span class="line"><span class="function">std::map&lt;std::string, <span class="type">int</span>&gt; <span class="title">count_chars</span><span class="params">(<span class="type">const</span> std::string&amp; str)</span> </span>&#123;</span><br><span class="line">    std::map&lt;std::string, <span class="type">int</span>&gt; result;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">char</span> c : str) &#123;</span><br><span class="line">        result[std::<span class="built_in">string</span>(<span class="number">1</span>, c)]++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">PYBIND11_MODULE</span>(example, m) &#123;</span><br><span class="line">    m.<span class="built_in">def</span>(<span class="string">&quot;process_vector&quot;</span>, &amp;process_vector, <span class="string">&quot;Double each element in vector&quot;</span>);</span><br><span class="line">    m.<span class="built_in">def</span>(<span class="string">&quot;unique_words&quot;</span>, &amp;unique_words, <span class="string">&quot;Get unique words from list&quot;</span>);</span><br><span class="line">    m.<span class="built_in">def</span>(<span class="string">&quot;count_chars&quot;</span>, &amp;count_chars, <span class="string">&quot;Count character occurrences&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Python使用: <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> example</span><br><span class="line"></span><br><span class="line"><span class="comment"># 向量处理</span></span><br><span class="line">result = example.process_vector([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>])</span><br><span class="line"><span class="built_in">print</span>(result)  <span class="comment"># [2, 4, 6, 8]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 集合处理</span></span><br><span class="line">unique = example.unique_words([<span class="string">&quot;apple&quot;</span>, <span class="string">&quot;banana&quot;</span>, <span class="string">&quot;apple&quot;</span>, <span class="string">&quot;orange&quot;</span>])</span><br><span class="line"><span class="built_in">print</span>(unique)  <span class="comment"># &#123;&#x27;apple&#x27;, &#x27;banana&#x27;, &#x27;orange&#x27;&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 字典处理</span></span><br><span class="line">counts = example.count_chars(<span class="string">&quot;hello world&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(counts)  <span class="comment"># &#123;&#x27;h&#x27;: 1, &#x27;e&#x27;: 1, &#x27;l&#x27;: 3, &#x27;o&#x27;: 2, &#x27; &#x27;: 1, &#x27;w&#x27;: 1, &#x27;r&#x27;: 1, &#x27;d&#x27;: 1&#125;</span></span><br></pre></td></tr></table></figure></p>
<h3 id="嵌套容器">嵌套容器</h3>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;pybind11/pybind11.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;pybind11/stl.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;set&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> py = pybind11;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 向量中的映射</span></span><br><span class="line">std::vector&lt;std::map&lt;std::string, <span class="type">int</span>&gt;&gt; <span class="built_in">process_nested_data</span>(</span><br><span class="line">    <span class="type">const</span> std::vector&lt;std::map&lt;std::string, <span class="type">int</span>&gt;&gt;&amp; data) &#123;</span><br><span class="line">    </span><br><span class="line">    std::vector&lt;std::map&lt;std::string, <span class="type">int</span>&gt;&gt; result;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">const</span> <span class="keyword">auto</span>&amp; map_data : data) &#123;</span><br><span class="line">        std::map&lt;std::string, <span class="type">int</span>&gt; processed_map;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">const</span> <span class="keyword">auto</span>&amp; [key, value] : map_data) &#123;</span><br><span class="line">            processed_map[key] = value * <span class="number">2</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        result.<span class="built_in">push_back</span>(processed_map);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 复杂嵌套结构</span></span><br><span class="line">std::map&lt;std::string, std::vector&lt;std::set&lt;<span class="type">int</span>&gt;&gt;&gt; <span class="built_in">complex_structure</span>() &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        &#123;<span class="string">&quot;even&quot;</span>, &#123;&#123;<span class="number">2</span>, <span class="number">4</span>, <span class="number">6</span>&#125;, &#123;<span class="number">8</span>, <span class="number">10</span>, <span class="number">12</span>&#125;&#125;&#125;,</span><br><span class="line">        &#123;<span class="string">&quot;odd&quot;</span>, &#123;&#123;<span class="number">1</span>, <span class="number">3</span>, <span class="number">5</span>&#125;, &#123;<span class="number">7</span>, <span class="number">9</span>, <span class="number">11</span>&#125;&#125;&#125;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">PYBIND11_MODULE</span>(example, m) &#123;</span><br><span class="line">    m.<span class="built_in">def</span>(<span class="string">&quot;process_nested_data&quot;</span>, &amp;process_nested_data, <span class="string">&quot;Process nested data structures&quot;</span>);</span><br><span class="line">    m.<span class="built_in">def</span>(<span class="string">&quot;complex_structure&quot;</span>, &amp;complex_structure, <span class="string">&quot;Create complex nested structure&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="c17容器支持">C++17容器支持</h3>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;pybind11/pybind11.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;pybind11/stl.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;optional&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;variant&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> py = pybind11;</span><br><span class="line"></span><br><span class="line"><span class="comment">// std::optional示例</span></span><br><span class="line"><span class="function">std::optional&lt;<span class="type">int</span>&gt; <span class="title">find_first_even</span><span class="params">(<span class="type">const</span> std::vector&lt;<span class="type">int</span>&gt;&amp; numbers)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> num : numbers) &#123;</span><br><span class="line">        <span class="keyword">if</span> (num % <span class="number">2</span> == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> num;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> std::<span class="literal">nullopt</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// std::variant示例</span></span><br><span class="line"><span class="keyword">using</span> Value = std::variant&lt;<span class="type">int</span>, <span class="type">double</span>, std::string&gt;;</span><br><span class="line"></span><br><span class="line"><span class="function">std::string <span class="title">value_type</span><span class="params">(<span class="type">const</span> Value&amp; value)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> std::<span class="built_in">visit</span>([](<span class="keyword">auto</span>&amp;&amp; arg) -&gt; std::string &#123;</span><br><span class="line">        <span class="keyword">using</span> T = std::<span class="type">decay_t</span>&lt;<span class="keyword">decltype</span>(arg)&gt;;</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">constexpr</span> (std::is_same_v&lt;T, <span class="type">int</span>&gt;)</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;integer&quot;</span>;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> <span class="built_in">constexpr</span> (std::is_same_v&lt;T, <span class="type">double</span>&gt;)</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;double&quot;</span>;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> <span class="built_in">constexpr</span> (std::is_same_v&lt;T, std::string&gt;)</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;string&quot;</span>;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;unknown&quot;</span>;</span><br><span class="line">    &#125;, value);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">PYBIND11_MODULE</span>(example, m) &#123;</span><br><span class="line">    m.<span class="built_in">def</span>(<span class="string">&quot;find_first_even&quot;</span>, &amp;find_first_even, <span class="string">&quot;Find first even number&quot;</span>);</span><br><span class="line">    m.<span class="built_in">def</span>(<span class="string">&quot;value_type&quot;</span>, &amp;value_type, <span class="string">&quot;Get type of variant value&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr />
<h2 id="高级特性">高级特性</h2>
<h3 id="异常处理">异常处理</h3>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;pybind11/pybind11.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdexcept&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> py = pybind11;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">divide</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (b == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> std::<span class="built_in">runtime_error</span>(<span class="string">&quot;Division by zero is not allowed&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> a / b;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">validate_age</span><span class="params">(<span class="type">int</span> age)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (age &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> std::<span class="built_in">invalid_argument</span>(<span class="string">&quot;Age cannot be negative&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (age &gt; <span class="number">150</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> std::<span class="built_in">out_of_range</span>(<span class="string">&quot;Age is too large&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">PYBIND11_MODULE</span>(example, m) &#123;</span><br><span class="line">    m.<span class="built_in">def</span>(<span class="string">&quot;divide&quot;</span>, &amp;divide, <span class="string">&quot;Divide two integers&quot;</span>);</span><br><span class="line">    m.<span class="built_in">def</span>(<span class="string">&quot;validate_age&quot;</span>, &amp;validate_age, <span class="string">&quot;Validate age range&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Python中处理异常： <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> example</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    result = example.divide(<span class="number">10</span>, <span class="number">0</span>)</span><br><span class="line"><span class="keyword">except</span> RuntimeError <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;Error: <span class="subst">&#123;e&#125;</span>&quot;</span>)  <span class="comment"># Error: Division by zero is not allowed</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    example.validate_age(-<span class="number">5</span>)</span><br><span class="line"><span class="keyword">except</span> ValueError <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;Validation error: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure></p>
<h3 id="自定义类型转换">自定义类型转换</h3>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;pybind11/pybind11.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;pybind11/stl.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> py = pybind11;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 自定义数据结构</span></span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">Point</span> &#123;</span><br><span class="line">    <span class="type">int</span> x;</span><br><span class="line">    <span class="type">int</span> y;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">Point</span>(<span class="type">int</span> x_ = <span class="number">0</span>, <span class="type">int</span> y_ = <span class="number">0</span>) : <span class="built_in">x</span>(x_), <span class="built_in">y</span>(y_) &#123;&#125;</span><br><span class="line">    </span><br><span class="line">    Point <span class="keyword">operator</span>+(<span class="type">const</span> Point&amp; other) <span class="type">const</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">Point</span>(x + other.x, y + other.y);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function">std::string <span class="title">to_string</span><span class="params">()</span> <span class="type">const</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;(&quot;</span> + std::<span class="built_in">to_string</span>(x) + <span class="string">&quot;, &quot;</span> + std::<span class="built_in">to_string</span>(y) + <span class="string">&quot;)&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 自定义类型转换器</span></span><br><span class="line"><span class="keyword">namespace</span> pybind11 &#123; <span class="keyword">namespace</span> detail &#123;</span><br><span class="line">    <span class="keyword">template</span> &lt;&gt; <span class="keyword">struct</span> <span class="title class_">type_caster</span>&lt;Point&gt; &#123;</span><br><span class="line">    <span class="keyword">public</span>:</span><br><span class="line">        <span class="built_in">PYBIND11_TYPE_CASTER</span>(Point, _(<span class="string">&quot;Point&quot;</span>));</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 从Python对象转换到C++</span></span><br><span class="line">        <span class="function"><span class="type">bool</span> <span class="title">load</span><span class="params">(handle src, <span class="type">bool</span>)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (!src) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            <span class="keyword">auto</span> obj = <span class="built_in">reinterpret_borrow</span>&lt;dict&gt;(src);</span><br><span class="line">            value.x = obj[<span class="string">&quot;x&quot;</span>].<span class="built_in">cast</span>&lt;<span class="type">int</span>&gt;();</span><br><span class="line">            value.y = obj[<span class="string">&quot;y&quot;</span>].<span class="built_in">cast</span>&lt;<span class="type">int</span>&gt;();</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 从C++转换到Python对象</span></span><br><span class="line">        <span class="function"><span class="type">static</span> handle <span class="title">cast</span><span class="params">(Point src, return_value_policy <span class="comment">/* policy */</span>, handle <span class="comment">/* parent */</span>)</span> </span>&#123;</span><br><span class="line">            dict d;</span><br><span class="line">            d[<span class="string">&quot;x&quot;</span>] = src.x;</span><br><span class="line">            d[<span class="string">&quot;y&quot;</span>] = src.y;</span><br><span class="line">            <span class="keyword">return</span> d.<span class="built_in">release</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">PYBIND11_MODULE</span>(example, m) &#123;</span><br><span class="line">    py::<span class="built_in">class_</span>&lt;Point&gt;(m, <span class="string">&quot;Point&quot;</span>)</span><br><span class="line">        .<span class="built_in">def</span>(py::<span class="built_in">init</span>&lt;<span class="type">int</span>, <span class="type">int</span>&gt;(), py::<span class="built_in">arg</span>(<span class="string">&quot;x&quot;</span>) = <span class="number">0</span>, py::<span class="built_in">arg</span>(<span class="string">&quot;y&quot;</span>) = <span class="number">0</span>)</span><br><span class="line">        .<span class="built_in">def</span>(<span class="string">&quot;__add__&quot;</span>, &amp;Point::<span class="keyword">operator</span>+)</span><br><span class="line">        .<span class="built_in">def</span>(<span class="string">&quot;to_string&quot;</span>, &amp;Point::to_string)</span><br><span class="line">        .<span class="built_in">def_readwrite</span>(<span class="string">&quot;x&quot;</span>, &amp;Point::x)</span><br><span class="line">        .<span class="built_in">def_readwrite</span>(<span class="string">&quot;y&quot;</span>, &amp;Point::y);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="numpy集成">NumPy集成</h3>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;pybind11/pybind11.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;pybind11/numpy.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> py = pybind11;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 将std::vector转换为NumPy数组</span></span><br><span class="line"><span class="function">py::<span class="type">array_t</span>&lt;<span class="type">double</span>&gt; <span class="title">vector_to_numpy</span><span class="params">(<span class="type">const</span> std::vector&lt;<span class="type">double</span>&gt;&amp; vec)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> py::<span class="built_in">array_t</span>&lt;<span class="type">double</span>&gt;(vec.<span class="built_in">size</span>(), vec.<span class="built_in">data</span>());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 从NumPy数组创建std::vector</span></span><br><span class="line"><span class="function">std::vector&lt;<span class="type">double</span>&gt; <span class="title">numpy_to_vector</span><span class="params">(<span class="type">const</span> py::<span class="type">array_t</span>&lt;<span class="type">double</span>&gt;&amp; array)</span> </span>&#123;</span><br><span class="line">    <span class="function">std::vector&lt;<span class="type">double</span>&gt; <span class="title">result</span><span class="params">(array.size())</span></span>;</span><br><span class="line">    std::<span class="built_in">memcpy</span>(result.<span class="built_in">data</span>(), array.<span class="built_in">data</span>(), array.<span class="built_in">size</span>() * <span class="built_in">sizeof</span>(<span class="type">double</span>));</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 就地修改NumPy数组</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">multiply_array_inplace</span><span class="params">(py::<span class="type">array_t</span>&lt;<span class="type">double</span>&gt;&amp; array, <span class="type">double</span> factor)</span> </span>&#123;</span><br><span class="line">    py::buffer_info buf = array.<span class="built_in">request</span>();</span><br><span class="line">    <span class="type">double</span>* ptr = <span class="built_in">static_cast</span>&lt;<span class="type">double</span>*&gt;(buf.ptr);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (<span class="type">size_t</span> i = <span class="number">0</span>; i &lt; buf.size; i++) &#123;</span><br><span class="line">        ptr[i] *= factor;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">PYBIND11_MODULE</span>(example, m) &#123;</span><br><span class="line">    m.<span class="built_in">def</span>(<span class="string">&quot;vector_to_numpy&quot;</span>, &amp;vector_to_numpy, <span class="string">&quot;Convert vector to NumPy array&quot;</span>);</span><br><span class="line">    m.<span class="built_in">def</span>(<span class="string">&quot;numpy_to_vector&quot;</span>, &amp;numpy_to_vector, <span class="string">&quot;Convert NumPy array to vector&quot;</span>);</span><br><span class="line">    m.<span class="built_in">def</span>(<span class="string">&quot;multiply_array_inplace&quot;</span>, &amp;multiply_array_inplace, <span class="string">&quot;Multiply array elements in-place&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="嵌入python解释器">嵌入Python解释器</h3>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;pybind11/embed.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> py = pybind11;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 启动Python解释器</span></span><br><span class="line">    py::scoped_interpreter guard&#123;&#125;;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 执行Python代码</span></span><br><span class="line">    py::<span class="built_in">print</span>(<span class="string">&quot;Hello from embedded Python!&quot;</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 导入模块</span></span><br><span class="line">    py::module_ math = py::module_::<span class="built_in">import</span>(<span class="string">&quot;math&quot;</span>);</span><br><span class="line">    py::object result = math.<span class="built_in">attr</span>(<span class="string">&quot;sqrt&quot;</span>)(<span class="number">25</span>);</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Square root of 25 is &quot;</span> &lt;&lt; result.<span class="built_in">cast</span>&lt;<span class="type">double</span>&gt;() &lt;&lt; std::endl;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 执行Python字符串</span></span><br><span class="line">    py::<span class="built_in">exec</span>(<span class="string">R&quot;(</span></span><br><span class="line"><span class="string">        def add(a, b):</span></span><br><span class="line"><span class="string">            return a + b</span></span><br><span class="line"><span class="string">        </span></span><br><span class="line"><span class="string">        result = add(3, 5)</span></span><br><span class="line"><span class="string">        print(f&quot;3 + 5 = &#123;result&#125;&quot;)</span></span><br><span class="line"><span class="string">    )&quot;</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 创建嵌入式模块</span></span><br><span class="line">    <span class="built_in">PYBIND11_EMBEDDED_MODULE</span>(fast_ops, m) &#123;</span><br><span class="line">        m.<span class="built_in">def</span>(<span class="string">&quot;multiply&quot;</span>, [](<span class="type">int</span> a, <span class="type">int</span> b) &#123;</span><br><span class="line">            <span class="keyword">return</span> a * b;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">auto</span> fast_ops = py::module_::<span class="built_in">import</span>(<span class="string">&quot;fast_ops&quot;</span>);</span><br><span class="line">    <span class="type">int</span> product = fast_ops.<span class="built_in">attr</span>(<span class="string">&quot;multiply&quot;</span>)(<span class="number">4</span>, <span class="number">6</span>).<span class="built_in">cast</span>&lt;<span class="type">int</span>&gt;();</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;4 * 6 = &quot;</span> &lt;&lt; product &lt;&lt; std::endl;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr />
<h2 id="跨平台构建">跨平台构建</h2>
<h3 id="cmake配置">CMake配置</h3>
<h4 id="基础cmakelists.txt">基础CMakeLists.txt</h4>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">cmake_minimum_required</span>(VERSION <span class="number">3.15</span>...<span class="number">4.0</span>)</span><br><span class="line"><span class="keyword">project</span>(example LANGUAGES CXX)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 自动查找Python和pybind11</span></span><br><span class="line"><span class="keyword">set</span>(PYBIND11_FINDPYTHON <span class="keyword">ON</span>)</span><br><span class="line"><span class="keyword">find_package</span>(pybind11 CONFIG REQUIRED)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建Python模块</span></span><br><span class="line">pybind11_add_module(example example.cpp)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 平台特定配置</span></span><br><span class="line"><span class="keyword">if</span>(MSVC)</span><br><span class="line">    <span class="comment"># Windows特定编译选项</span></span><br><span class="line">    <span class="keyword">target_compile_options</span>(example PRIVATE /bigobj /MP /utf-<span class="number">8</span>)</span><br><span class="line"><span class="keyword">elseif</span>(APPLE)</span><br><span class="line">    <span class="comment"># macOS特定链接选项</span></span><br><span class="line">    <span class="keyword">target_link_options</span>(example PRIVATE -undefined dynamic_lookup)</span><br><span class="line"><span class="keyword">elseif</span>(UNIX)</span><br><span class="line">    <span class="comment"># Linux特定编译选项</span></span><br><span class="line">    <span class="keyword">target_compile_options</span>(example PRIVATE -fvisibility=hidden)</span><br><span class="line"><span class="keyword">endif</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 优化选项</span></span><br><span class="line"><span class="keyword">if</span>(CMAKE_BUILD_TYPE <span class="keyword">STREQUAL</span> <span class="string">&quot;Release&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span>(MSVC)</span><br><span class="line">        <span class="keyword">target_compile_options</span>(example PRIVATE /O2)</span><br><span class="line">    <span class="keyword">else</span>()</span><br><span class="line">        <span class="keyword">target_compile_options</span>(example PRIVATE -O3 -march=native)</span><br><span class="line">    <span class="keyword">endif</span>()</span><br><span class="line"><span class="keyword">endif</span>()</span><br></pre></td></tr></table></figure>
<h4 id="手动指定python和pybind11位置">手动指定python和pybind11位置</h4>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">cmake_minimum_required</span>(VERSION <span class="number">3.15</span>...<span class="number">4.0</span>)</span><br><span class="line"><span class="keyword">project</span>(example LANGUAGES CXX)</span><br><span class="line"></span><br><span class="line"><span class="comment"># --------------------------</span></span><br><span class="line"><span class="comment"># 1. 手动指定 Python 路径</span></span><br><span class="line"><span class="comment"># --------------------------</span></span><br><span class="line"><span class="keyword">set</span>(PYBIND11_FINDPYTHON <span class="keyword">OFF</span>)  <span class="comment"># 关闭 pybind11 自带的 Python 查找</span></span><br><span class="line"><span class="keyword">if</span>(WIN32)</span><br><span class="line">  <span class="keyword">set</span>(Python_EXECUTABLE <span class="string">&quot;C:/Python39/python.exe&quot;</span>)  <span class="comment"># 你的 Python 路径</span></span><br><span class="line"><span class="keyword">else</span>()</span><br><span class="line">  <span class="keyword">set</span>(Python_EXECUTABLE <span class="string">&quot;/home/user/venv/bin/python3&quot;</span>)  <span class="comment"># 虚拟环境 Python</span></span><br><span class="line"><span class="keyword">endif</span>()</span><br><span class="line"><span class="keyword">find_package</span>(Python REQUIRED COMPONENTS Interpreter Development)  <span class="comment"># 显式查找 Python</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># --------------------------</span></span><br><span class="line"><span class="comment"># 2. 手动指定 pybind11 路径</span></span><br><span class="line"><span class="comment"># --------------------------</span></span><br><span class="line"><span class="keyword">if</span>(WIN32)</span><br><span class="line">  <span class="keyword">set</span>(pybind11_DIR <span class="string">&quot;C:/my_pybind11/lib/cmake/pybind11&quot;</span>)  <span class="comment"># pybind11 配置文件目录</span></span><br><span class="line"><span class="keyword">else</span>()</span><br><span class="line">  <span class="keyword">set</span>(pybind11_DIR <span class="string">&quot;~/pybind11/build&quot;</span>)  <span class="comment"># pybind11 编译目录</span></span><br><span class="line"><span class="keyword">endif</span>()</span><br><span class="line"><span class="keyword">find_package</span>(pybind11 CONFIG REQUIRED)  <span class="comment"># 基于指定路径查找 pybind11</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># --------------------------</span></span><br><span class="line"><span class="comment"># 3. 生成 Python 模块</span></span><br><span class="line"><span class="comment"># --------------------------</span></span><br><span class="line">pybind11_add_module(example example.cpp)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 后续平台配置和优化选项...</span></span><br></pre></td></tr></table></figure>
<h4 id="高级cmake配置">高级CMake配置</h4>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">cmake_minimum_required</span>(VERSION <span class="number">3.15</span>...<span class="number">4.0</span>)</span><br><span class="line"><span class="keyword">project</span>(MyProject VERSION <span class="number">1.0</span>.<span class="number">0</span> LANGUAGES CXX)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置C++标准</span></span><br><span class="line"><span class="keyword">set</span>(CMAKE_CXX_STANDARD <span class="number">17</span>)</span><br><span class="line"><span class="keyword">set</span>(CMAKE_CXX_STANDARD_REQUIRED <span class="keyword">ON</span>)</span><br><span class="line"><span class="keyword">set</span>(CMAKE_CXX_EXTENSIONS <span class="keyword">OFF</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 自动查找Python</span></span><br><span class="line"><span class="keyword">find_package</span>(Python <span class="number">3.8</span> REQUIRED COMPONENTS Interpreter Development)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查找pybind11</span></span><br><span class="line"><span class="keyword">find_package</span>(pybind11 CONFIG REQUIRED)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 项目源文件</span></span><br><span class="line"><span class="keyword">set</span>(SOURCES</span><br><span class="line">    src/main.cpp</span><br><span class="line">    src/utils.cpp</span><br><span class="line">    src/math_ops.cpp</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 项目头文件</span></span><br><span class="line"><span class="keyword">set</span>(HEADERS</span><br><span class="line">    <span class="keyword">include</span>/utils.h</span><br><span class="line">    <span class="keyword">include</span>/math_ops.h</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建Python模块</span></span><br><span class="line">pybind11_add_module(</span><br><span class="line">    my_module </span><br><span class="line">    MODULE </span><br><span class="line">    <span class="variable">$&#123;SOURCES&#125;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置包含目录</span></span><br><span class="line"><span class="keyword">target_include_directories</span>(my_module PRIVATE</span><br><span class="line">    <span class="variable">$&#123;CMAKE_CURRENT_SOURCE_DIR&#125;</span>/<span class="keyword">include</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 链接其他库</span></span><br><span class="line"><span class="keyword">find_package</span>(Eigen3 REQUIRED)</span><br><span class="line"><span class="keyword">target_link_libraries</span>(my_module PRIVATE</span><br><span class="line">    Eigen3::Eigen</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 平台特定配置</span></span><br><span class="line"><span class="keyword">if</span>(MSVC)</span><br><span class="line">    <span class="keyword">target_compile_options</span>(my_module PRIVATE</span><br><span class="line">        /bigobj</span><br><span class="line">        /MP</span><br><span class="line">        /utf-<span class="number">8</span></span><br><span class="line">        /W4</span><br><span class="line">        /WX</span><br><span class="line">    )</span><br><span class="line"><span class="keyword">elseif</span>(APPLE)</span><br><span class="line">    <span class="keyword">target_compile_options</span>(my_module PRIVATE</span><br><span class="line">        -Wall</span><br><span class="line">        -Wextra</span><br><span class="line">        -Werror</span><br><span class="line">        -fvisibility=hidden</span><br><span class="line">    )</span><br><span class="line">    <span class="keyword">target_link_options</span>(my_module PRIVATE</span><br><span class="line">        -undefined dynamic_lookup</span><br><span class="line">    )</span><br><span class="line"><span class="keyword">elseif</span>(UNIX)</span><br><span class="line">    <span class="keyword">target_compile_options</span>(my_module PRIVATE</span><br><span class="line">        -Wall</span><br><span class="line">        -Wextra</span><br><span class="line">        -Werror</span><br><span class="line">        -fvisibility=hidden</span><br><span class="line">    )</span><br><span class="line"><span class="keyword">endif</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 优化配置</span></span><br><span class="line"><span class="keyword">if</span>(CMAKE_BUILD_TYPE <span class="keyword">STREQUAL</span> <span class="string">&quot;Release&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span>(MSVC)</span><br><span class="line">        <span class="keyword">target_compile_options</span>(my_module PRIVATE /O2)</span><br><span class="line">    <span class="keyword">else</span>()</span><br><span class="line">        <span class="keyword">target_compile_options</span>(my_module PRIVATE</span><br><span class="line">            -O3</span><br><span class="line">            -march=native</span><br><span class="line">            -flto</span><br><span class="line">        )</span><br><span class="line">        <span class="keyword">target_link_options</span>(my_module PRIVATE</span><br><span class="line">            -flto</span><br><span class="line">        )</span><br><span class="line">    <span class="keyword">endif</span>()</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 剥离调试符号（Linux/macOS）</span></span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">NOT</span> MSVC)</span><br><span class="line">        pybind11_strip(my_module)</span><br><span class="line">    <span class="keyword">endif</span>()</span><br><span class="line"><span class="keyword">elseif</span>(CMAKE_BUILD_TYPE <span class="keyword">STREQUAL</span> <span class="string">&quot;Debug&quot;</span>)</span><br><span class="line">    <span class="keyword">target_compile_options</span>(my_module PRIVATE</span><br><span class="line">        -O0</span><br><span class="line">        -g</span><br><span class="line">    )</span><br><span class="line"><span class="keyword">endif</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装配置</span></span><br><span class="line"><span class="keyword">install</span>(TARGETS my_module</span><br><span class="line">    LIBRARY DESTINATION <span class="variable">$&#123;Python_SITEARCH&#125;</span></span><br><span class="line">    RUNTIME DESTINATION <span class="variable">$&#123;Python_SITEARCH&#125;</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<h3 id="命令行编译">命令行编译</h3>
<h4 id="linuxmacos">Linux/macOS</h4>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建构建目录</span></span><br><span class="line"><span class="built_in">mkdir</span> build</span><br><span class="line"><span class="built_in">cd</span> build</span><br><span class="line"></span><br><span class="line"><span class="comment"># 配置CMake</span></span><br><span class="line">cmake .. -DCMAKE_BUILD_TYPE=Release</span><br><span class="line"></span><br><span class="line"><span class="comment"># 编译</span></span><br><span class="line">make -j4</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装</span></span><br><span class="line"><span class="built_in">sudo</span> make install</span><br></pre></td></tr></table></figure>
<h4 id="windows-visual-studio">Windows (Visual Studio)</h4>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建构建目录</span></span><br><span class="line"><span class="built_in">mkdir</span> build</span><br><span class="line"><span class="built_in">cd</span> build</span><br><span class="line"></span><br><span class="line"><span class="comment"># 配置CMake (64位)</span></span><br><span class="line">cmake .. -G <span class="string">&quot;Visual Studio 17 2022&quot;</span> -A x64 -DCMAKE_BUILD_TYPE=Release</span><br><span class="line"></span><br><span class="line"><span class="comment"># 编译</span></span><br><span class="line">cmake --build . --config Release --target ALL_BUILD</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装</span></span><br><span class="line">cmake --build . --config Release --target INSTALL</span><br></pre></td></tr></table></figure>
<h3 id="setuptools配置">setuptools配置</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># setup.py</span></span><br><span class="line"><span class="keyword">from</span> setuptools <span class="keyword">import</span> setup, Extension</span><br><span class="line"><span class="keyword">from</span> pybind11.setup_helpers <span class="keyword">import</span> Pybind11Extension, build_ext</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line">ext_modules = [</span><br><span class="line">    Pybind11Extension(</span><br><span class="line">        <span class="string">&quot;my_module&quot;</span>,</span><br><span class="line">        [<span class="string">&quot;src/main.cpp&quot;</span>, <span class="string">&quot;src/utils.cpp&quot;</span>],</span><br><span class="line">        include_dirs=[<span class="string">&quot;include&quot;</span>],</span><br><span class="line">        extra_compile_args=[<span class="string">&quot;-std=c++17&quot;</span>],</span><br><span class="line">        language=<span class="string">&quot;c++&quot;</span>,</span><br><span class="line">    ),</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">setup(</span><br><span class="line">    name=<span class="string">&quot;my_module&quot;</span>,</span><br><span class="line">    version=<span class="string">&quot;1.0.0&quot;</span>,</span><br><span class="line">    author=<span class="string">&quot;Your Name&quot;</span>,</span><br><span class="line">    author_email=<span class="string">&quot;your.email@example.com&quot;</span>,</span><br><span class="line">    description=<span class="string">&quot;A pybind11 example module&quot;</span>,</span><br><span class="line">    long_description=<span class="string">&quot;&quot;</span>,</span><br><span class="line">    ext_modules=ext_modules,</span><br><span class="line">    cmdclass=&#123;<span class="string">&quot;build_ext&quot;</span>: build_ext&#125;,</span><br><span class="line">    zip_safe=<span class="literal">False</span>,</span><br><span class="line">    python_requires=<span class="string">&quot;&gt;=3.8&quot;</span>,</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>使用setup.py构建： <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python setup.py build_ext --inplace</span><br></pre></td></tr></table></figure></p>
<hr />
<h2 id="最佳实践">最佳实践</h2>
<h3 id="代码组织">1. 代码组织</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">project/</span><br><span class="line">├── include/</span><br><span class="line">│   ├── my_module/</span><br><span class="line">│   │   ├── core.h</span><br><span class="line">│   │   ├── utils.h</span><br><span class="line">│   │   └── types.h</span><br><span class="line">├── src/</span><br><span class="line">│   ├── core.cpp</span><br><span class="line">│   ├── utils.cpp</span><br><span class="line">│   ├── bindings.cpp    # pybind11绑定代码</span><br><span class="line">│   └── main.cpp        # 可选的C++主程序</span><br><span class="line">├── tests/</span><br><span class="line">│   ├── test_basic.py</span><br><span class="line">│   ├── test_advanced.py</span><br><span class="line">│   └── conftest.py</span><br><span class="line">├── examples/</span><br><span class="line">│   ├── example1.py</span><br><span class="line">│   └── example2.py</span><br><span class="line">├── CMakeLists.txt</span><br><span class="line">├── setup.py</span><br><span class="line">├── pyproject.toml</span><br><span class="line">└── README.md</span><br></pre></td></tr></table></figure>
<h3 id="绑定代码分离">2. 绑定代码分离</h3>
<p>将C++实现和pybind11绑定代码分离：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// src/core.h (纯C++接口)</span></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> once</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> my_module &#123;</span><br><span class="line">    <span class="function">std::vector&lt;<span class="type">double</span>&gt; <span class="title">process_data</span><span class="params">(<span class="type">const</span> std::vector&lt;<span class="type">double</span>&gt;&amp; input)</span></span>;</span><br><span class="line">    <span class="function">std::string <span class="title">format_result</span><span class="params">(<span class="type">double</span> value)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// src/core.cpp (C++实现)</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;core.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> my_module &#123;</span><br><span class="line">    <span class="function">std::vector&lt;<span class="type">double</span>&gt; <span class="title">process_data</span><span class="params">(<span class="type">const</span> std::vector&lt;<span class="type">double</span>&gt;&amp; input)</span> </span>&#123;</span><br><span class="line">        std::vector&lt;<span class="type">double</span>&gt; result = input;</span><br><span class="line">        std::<span class="built_in">transform</span>(result.<span class="built_in">begin</span>(), result.<span class="built_in">end</span>(), result.<span class="built_in">begin</span>(),</span><br><span class="line">                      [](<span class="type">double</span> x) &#123; <span class="keyword">return</span> x * <span class="number">2.0</span>; &#125;);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function">std::string <span class="title">format_result</span><span class="params">(<span class="type">double</span> value)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Result: &quot;</span> + std::<span class="built_in">to_string</span>(value);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// src/bindings.cpp (pybind11绑定)</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;pybind11/pybind11.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;pybind11/stl.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;core.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> py = pybind11;</span><br><span class="line"></span><br><span class="line"><span class="built_in">PYBIND11_MODULE</span>(my_module, m) &#123;</span><br><span class="line">    m.<span class="built_in">doc</span>() = <span class="string">&quot;My module documentation&quot;</span>;</span><br><span class="line">    </span><br><span class="line">    m.<span class="built_in">def</span>(<span class="string">&quot;process_data&quot;</span>, &amp;my_module::process_data, </span><br><span class="line">          <span class="string">&quot;Process input data&quot;</span>);</span><br><span class="line">    </span><br><span class="line">    m.<span class="built_in">def</span>(<span class="string">&quot;format_result&quot;</span>, &amp;my_module::format_result, </span><br><span class="line">          <span class="string">&quot;Format result as string&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="类型安全">3. 类型安全</h3>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;pybind11/pybind11.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;type_traits&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> py = pybind11;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 类型检查工具</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="keyword">struct</span> <span class="title class_">type_checker</span> &#123;</span><br><span class="line">    <span class="function"><span class="type">static</span> <span class="type">void</span> <span class="title">check</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="built_in">static_assert</span>(std::is_arithmetic_v&lt;T&gt;, <span class="string">&quot;Type must be arithmetic&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 类型安全的函数</span></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</span><br><span class="line"><span class="function">T <span class="title">safe_add</span><span class="params">(T a, T b)</span> </span>&#123;</span><br><span class="line">    type_checker&lt;T&gt;::<span class="built_in">check</span>();</span><br><span class="line">    <span class="keyword">return</span> a + b;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">PYBIND11_MODULE</span>(example, m) &#123;</span><br><span class="line">    <span class="comment">// 为不同类型创建绑定</span></span><br><span class="line">    m.<span class="built_in">def</span>(<span class="string">&quot;add_int&quot;</span>, &amp;safe_add&lt;<span class="type">int</span>&gt;, <span class="string">&quot;Add two integers&quot;</span>);</span><br><span class="line">    m.<span class="built_in">def</span>(<span class="string">&quot;add_double&quot;</span>, &amp;safe_add&lt;<span class="type">double</span>&gt;, <span class="string">&quot;Add two doubles&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="性能优化">4. 性能优化</h3>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;pybind11/pybind11.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;pybind11/numpy.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> py = pybind11;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 高效的NumPy数组处理</span></span><br><span class="line"><span class="function">py::<span class="type">array_t</span>&lt;<span class="type">double</span>&gt; <span class="title">fast_processing</span><span class="params">(py::<span class="type">array_t</span>&lt;<span class="type">double</span>&gt;&amp; input)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 获取数组信息</span></span><br><span class="line">    py::buffer_info buf = input.<span class="built_in">request</span>();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 直接访问原始数据</span></span><br><span class="line">    <span class="type">double</span>* ptr = <span class="built_in">static_cast</span>&lt;<span class="type">double</span>*&gt;(buf.ptr);</span><br><span class="line">    <span class="type">const</span> <span class="type">size_t</span> size = buf.size;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 就地处理数据（避免拷贝）</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">size_t</span> i = <span class="number">0</span>; i &lt; size; i++) &#123;</span><br><span class="line">        ptr[i] = ptr[i] * <span class="number">2.0</span> + <span class="number">1.0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> input;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用预分配的向量</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">process_with_preallocation</span><span class="params">(<span class="type">const</span> std::vector&lt;<span class="type">double</span>&gt;&amp; input, </span></span></span><br><span class="line"><span class="params"><span class="function">                               std::vector&lt;<span class="type">double</span>&gt;&amp; output)</span> </span>&#123;</span><br><span class="line">    output.<span class="built_in">resize</span>(input.<span class="built_in">size</span>());</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">size_t</span> i = <span class="number">0</span>; i &lt; input.<span class="built_in">size</span>(); i++) &#123;</span><br><span class="line">        output[i] = input[i] * <span class="number">3.0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">PYBIND11_MODULE</span>(example, m) &#123;</span><br><span class="line">    m.<span class="built_in">def</span>(<span class="string">&quot;fast_processing&quot;</span>, &amp;fast_processing, </span><br><span class="line">          <span class="string">&quot;Fast in-place array processing&quot;</span>);</span><br><span class="line">    </span><br><span class="line">    m.<span class="built_in">def</span>(<span class="string">&quot;process_with_preallocation&quot;</span>, &amp;process_with_preallocation,</span><br><span class="line">          <span class="string">&quot;Processing with preallocated output&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="错误处理">5. 错误处理</h3>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;pybind11/pybind11.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdexcept&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> py = pybind11;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyException</span> : <span class="keyword">public</span> std::exception &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">MyException</span>(<span class="type">const</span> std::string&amp; message) : <span class="built_in">message_</span>(message) &#123;&#125;</span><br><span class="line">    <span class="function"><span class="type">const</span> <span class="type">char</span>* <span class="title">what</span><span class="params">()</span> <span class="type">const</span> <span class="keyword">noexcept</span> <span class="keyword">override</span> </span>&#123; <span class="keyword">return</span> message_.<span class="built_in">c_str</span>(); &#125;</span><br><span class="line">    </span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    std::string message_;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">validate_input</span><span class="params">(<span class="type">int</span> value)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (value &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="built_in">MyException</span>(<span class="string">&quot;Input cannot be negative&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (value &gt; <span class="number">100</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> std::<span class="built_in">out_of_range</span>(<span class="string">&quot;Input exceeds maximum value (100)&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">PYBIND11_MODULE</span>(example, m) &#123;</span><br><span class="line">    m.<span class="built_in">def</span>(<span class="string">&quot;validate_input&quot;</span>, &amp;validate_input, <span class="string">&quot;Validate input value&quot;</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 注册自定义异常</span></span><br><span class="line">    py::<span class="built_in">register_exception</span>&lt;MyException&gt;(m, <span class="string">&quot;MyException&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="文档生成">6. 文档生成</h3>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;pybind11/pybind11.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> py = pybind11;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @brief Adds two integers</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * This function takes two integers and returns their sum.</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * @param a First integer</span></span><br><span class="line"><span class="comment"> * @param b Second integer</span></span><br><span class="line"><span class="comment"> * @return Sum of a and b</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * @example</span></span><br><span class="line"><span class="comment"> * &gt;&gt;&gt; add(2, 3)</span></span><br><span class="line"><span class="comment"> * 5</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">add</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> a + b;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">PYBIND11_MODULE</span>(example, m) &#123;</span><br><span class="line">    m.<span class="built_in">doc</span>() = <span class="string">R&quot;pbdoc(</span></span><br><span class="line"><span class="string">        Example module for pybind11</span></span><br><span class="line"><span class="string">        --------------------------</span></span><br><span class="line"><span class="string">        </span></span><br><span class="line"><span class="string">        This module demonstrates various pybind11 features.</span></span><br><span class="line"><span class="string">    )pbdoc&quot;</span>;</span><br><span class="line">    </span><br><span class="line">    m.<span class="built_in">def</span>(<span class="string">&quot;add&quot;</span>, &amp;add, <span class="string">R&quot;pbdoc(</span></span><br><span class="line"><span class="string">        Add two integers</span></span><br><span class="line"><span class="string">        </span></span><br><span class="line"><span class="string">        Args:</span></span><br><span class="line"><span class="string">            a (int): First integer</span></span><br><span class="line"><span class="string">            b (int): Second integer</span></span><br><span class="line"><span class="string">            </span></span><br><span class="line"><span class="string">        Returns:</span></span><br><span class="line"><span class="string">            int: Sum of a and b</span></span><br><span class="line"><span class="string">    )pbdoc&quot;</span>, py::<span class="built_in">arg</span>(<span class="string">&quot;a&quot;</span>), py::<span class="built_in">arg</span>(<span class="string">&quot;b&quot;</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr />
<h2 id="常见问题解决">常见问题解决</h2>
<h3 id="编译错误">1. 编译错误</h3>
<h4 id="问题头文件找不到">问题：头文件找不到</h4>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fatal error: pybind11/pybind11.h: No such file or directory</span><br></pre></td></tr></table></figure>
<p><strong>解决方案：</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 方法1: 使用pip安装的pybind11</span></span><br><span class="line">c++ -O3 -Wall -shared -std=c++11 -fPIC $(python3 -m pybind11 --includes) example.cpp -o example$(python3-config --extension-suffix)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 方法2: 指定头文件路径</span></span><br><span class="line">c++ -O3 -Wall -shared -std=c++11 -fPIC -I/path/to/pybind11/include example.cpp -o example.so</span><br></pre></td></tr></table></figure>
<h4 id="问题python版本不匹配">问题：Python版本不匹配</h4>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">undefined symbol: PyExc_RuntimeError</span><br></pre></td></tr></table></figure>
<p><strong>解决方案：</strong>
确保使用的Python版本与编译时使用的版本一致。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 检查Python版本</span></span><br><span class="line">python3 --version</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用正确的Python配置</span></span><br><span class="line">python3-config --includes</span><br><span class="line">python3-config --extension-suffix</span><br></pre></td></tr></table></figure>
<h3 id="运行时错误">2. 运行时错误</h3>
<h4 id="问题模块导入失败">问题：模块导入失败</h4>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ImportError: No module named <span class="string">&#x27;example&#x27;</span></span><br></pre></td></tr></table></figure>
<p><strong>解决方案：</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 检查模块文件是否存在</span></span><br><span class="line"><span class="built_in">ls</span> -la example*</span><br><span class="line"></span><br><span class="line"><span class="comment"># 检查Python路径</span></span><br><span class="line">python3 -c <span class="string">&quot;import sys; print(sys.path)&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 将模块所在目录添加到Python路径</span></span><br><span class="line"><span class="built_in">export</span> PYTHONPATH=<span class="variable">$PYTHONPATH</span>:/path/to/module</span><br></pre></td></tr></table></figure>
<h4 id="问题类型转换错误">问题：类型转换错误</h4>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">TypeError: incompatible types, c++ <span class="built_in">type</span> <span class="keyword">is</span> std::vector&lt;<span class="built_in">int</span>&gt;</span><br></pre></td></tr></table></figure>
<p><strong>解决方案：</strong> 确保包含STL头文件：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;pybind11/stl.h&gt;</span></span></span><br></pre></td></tr></table></figure>
<h3 id="性能问题">3. 性能问题</h3>
<h4 id="问题大数据传输缓慢">问题：大数据传输缓慢</h4>
<p><strong>解决方案：</strong> 使用NumPy数组避免数据拷贝：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;pybind11/numpy.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function">py::<span class="type">array_t</span>&lt;<span class="type">double</span>&gt; <span class="title">process_large_data</span><span class="params">(py::<span class="type">array_t</span>&lt;<span class="type">double</span>&gt;&amp; input)</span> </span>&#123;</span><br><span class="line">    py::buffer_info buf = input.<span class="built_in">request</span>();</span><br><span class="line">    <span class="type">double</span>* ptr = <span class="built_in">static_cast</span>&lt;<span class="type">double</span>*&gt;(buf.ptr);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 就地处理数据</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">size_t</span> i = <span class="number">0</span>; i &lt; buf.size; i++) &#123;</span><br><span class="line">        ptr[i] = ptr[i] * <span class="number">2.0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> input;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="跨平台问题">4. 跨平台问题</h3>
<h4 id="问题windows上链接错误">问题：Windows上链接错误</h4>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">error LNK2001: unresolved external symbol</span><br></pre></td></tr></table></figure>
<p><strong>解决方案：</strong> 使用正确的Visual Studio版本和架构：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 使用x64架构</span></span><br><span class="line">cmake .. -G <span class="string">&quot;Visual Studio 17 2022&quot;</span> -A x64</span><br><span class="line"></span><br><span class="line"><span class="comment"># 确保使用与Python匹配的架构</span></span><br><span class="line">python -c <span class="string">&quot;import platform; print(platform.architecture())&quot;</span></span><br></pre></td></tr></table></figure>
<h4 id="问题macos上符号冲突">问题：macOS上符号冲突</h4>
<p><strong>解决方案：</strong> 使用dynamic_lookup：</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(APPLE)</span><br><span class="line">    <span class="keyword">target_link_options</span>(example PRIVATE -undefined dynamic_lookup)</span><br><span class="line"><span class="keyword">endif</span>()</span><br></pre></td></tr></table></figure>
<h3 id="调试技巧">5. 调试技巧</h3>
<h4 id="启用调试信息">启用调试信息</h4>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Linux/macOS</span></span><br><span class="line">cmake .. -DCMAKE_BUILD_TYPE=Debug</span><br><span class="line">make</span><br><span class="line"></span><br><span class="line"><span class="comment"># Windows</span></span><br><span class="line">cmake .. -G <span class="string">&quot;Visual Studio 17 2022&quot;</span> -A x64 -DCMAKE_BUILD_TYPE=Debug</span><br></pre></td></tr></table></figure>
<h4 id="使用gdb调试">使用GDB调试</h4>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">gdb python3</span><br><span class="line">(gdb) run -c <span class="string">&quot;import example; example.add(1, 2)&quot;</span></span><br><span class="line">(gdb) <span class="built_in">break</span> example.cpp:10</span><br><span class="line">(gdb) <span class="built_in">continue</span></span><br></pre></td></tr></table></figure>
<h4 id="输出调试信息">输出调试信息</h4>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;pybind11/pybind11.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> py = pybind11;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">add</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span> </span>&#123;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Adding &quot;</span> &lt;&lt; a &lt;&lt; <span class="string">&quot; and &quot;</span> &lt;&lt; b &lt;&lt; std::endl;</span><br><span class="line">    <span class="keyword">return</span> a + b;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">PYBIND11_MODULE</span>(example, m) &#123;</span><br><span class="line">    m.<span class="built_in">def</span>(<span class="string">&quot;add&quot;</span>, &amp;add);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

    </div>

    
    
    

      <footer class="post-footer">
          
          <div class="post-tags">
              <a href="/tags/python/" rel="tag"><i class="fa fa-tag"></i> python</a>
              <a href="/tags/cpp/" rel="tag"><i class="fa fa-tag"></i> C++</a>
          </div>

        



        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2025/10/29/compiler_principle/LR(1)%E6%96%87%E6%B3%95%E4%B8%AD%E7%9A%84%E6%A0%B8%E5%BF%83%E9%A1%B9%E7%9B%AE%E5%92%8C%E6%90%9C%E7%B4%A2%E7%AC%A6/" rel="prev" title="LR(1)文法中的核心项目和搜索符">
      <i class="fa fa-chevron-left"></i> LR(1)文法中的核心项目和搜索符
    </a></div>
      <div class="post-nav-item">
    <a href="/2025/10/30/C++/vscode%E4%B8%AD%E9%85%8D%E7%BD%AEpybind11/" rel="next" title="vscode中配置pybind11">
      vscode中配置pybind11 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
            
    <div class="comments" id="gitalk-container"></div>

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#pybind11-%E5%85%A8%E9%9D%A2%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97"><span class="nav-number">1.</span> <span class="nav-text">pybind11 全面使用指南</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%9B%AE%E5%BD%95"><span class="nav-number">1.1.</span> <span class="nav-text">目录</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%A6%82%E8%BF%B0"><span class="nav-number">1.2.</span> <span class="nav-text">概述</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%BB%E8%A6%81%E7%89%B9%E6%80%A7"><span class="nav-number">1.2.1.</span> <span class="nav-text">主要特性</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%94%AF%E6%8C%81%E7%9A%84%E7%BC%96%E8%AF%91%E5%99%A8"><span class="nav-number">1.2.2.</span> <span class="nav-text">支持的编译器</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%89%E8%A3%85%E6%8C%87%E5%8D%97"><span class="nav-number">1.3.</span> <span class="nav-text">安装指南</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#windows%E5%AE%89%E8%A3%85"><span class="nav-number">1.3.1.</span> <span class="nav-text">Windows安装</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%96%B9%E6%B3%951-%E4%BD%BF%E7%94%A8pip%E5%AE%89%E8%A3%85"><span class="nav-number">1.3.1.1.</span> <span class="nav-text">方法1: 使用pip安装</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%96%B9%E6%B3%952-%E4%BD%BF%E7%94%A8conda%E5%AE%89%E8%A3%85"><span class="nav-number">1.3.1.2.</span> <span class="nav-text">方法2: 使用conda安装</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%96%B9%E6%B3%953-%E6%BA%90%E7%A0%81%E5%AE%89%E8%A3%85"><span class="nav-number">1.3.1.3.</span> <span class="nav-text">方法3: 源码安装</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#linux%E5%AE%89%E8%A3%85"><span class="nav-number">1.3.2.</span> <span class="nav-text">Linux安装</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%96%B9%E6%B3%951-%E4%BD%BF%E7%94%A8%E5%8C%85%E7%AE%A1%E7%90%86%E5%99%A8"><span class="nav-number">1.3.2.1.</span> <span class="nav-text">方法1: 使用包管理器</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%96%B9%E6%B3%952-%E4%BD%BF%E7%94%A8pip%E5%AE%89%E8%A3%85"><span class="nav-number">1.3.2.2.</span> <span class="nav-text">方法2: 使用pip安装</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%96%B9%E6%B3%953-%E6%BA%90%E7%A0%81%E5%AE%89%E8%A3%85-1"><span class="nav-number">1.3.2.3.</span> <span class="nav-text">方法3: 源码安装</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%AA%8C%E8%AF%81%E5%AE%89%E8%A3%85"><span class="nav-number">1.3.3.</span> <span class="nav-text">验证安装</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%BF%AB%E9%80%9F%E5%BC%80%E5%A7%8B"><span class="nav-number">1.4.</span> <span class="nav-text">快速开始</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AC%AC%E4%B8%80%E4%B8%AA%E7%A4%BA%E4%BE%8B"><span class="nav-number">1.4.1.</span> <span class="nav-text">第一个示例</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%88%9B%E5%BB%BAc%E6%96%87%E4%BB%B6-example.cpp"><span class="nav-number">1.4.1.1.</span> <span class="nav-text">1. 创建C++文件 (example.cpp)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BC%96%E8%AF%91"><span class="nav-number">1.4.1.2.</span> <span class="nav-text">2. 编译</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%9C%A8python%E4%B8%AD%E4%BD%BF%E7%94%A8"><span class="nav-number">1.4.1.3.</span> <span class="nav-text">3. 在Python中使用</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%87%BD%E6%95%B0%E7%BB%91%E5%AE%9A"><span class="nav-number">1.5.</span> <span class="nav-text">函数绑定</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9F%BA%E6%9C%AC%E5%8F%82%E6%95%B0%E4%BC%A0%E9%80%92"><span class="nav-number">1.5.1.</span> <span class="nav-text">基本参数传递</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%85%B3%E9%94%AE%E5%AD%97%E5%8F%82%E6%95%B0"><span class="nav-number">1.5.2.</span> <span class="nav-text">关键字参数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%BB%98%E8%AE%A4%E5%8F%82%E6%95%B0"><span class="nav-number">1.5.3.</span> <span class="nav-text">默认参数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8F%82%E6%95%B0%E4%BC%A0%E9%80%92%E6%A8%A1%E5%BC%8F"><span class="nav-number">1.5.4.</span> <span class="nav-text">参数传递模式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%A6%81%E6%AD%A2%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2"><span class="nav-number">1.5.5.</span> <span class="nav-text">禁止类型转换</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%B1%BB%E7%BB%91%E5%AE%9A"><span class="nav-number">1.6.</span> <span class="nav-text">类绑定</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9F%BA%E6%9C%AC%E7%B1%BB%E7%BB%91%E5%AE%9A"><span class="nav-number">1.6.1.</span> <span class="nav-text">基本类绑定</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BB%A7%E6%89%BF%E5%92%8C%E5%A4%9A%E6%80%81"><span class="nav-number">1.6.2.</span> <span class="nav-text">继承和多态</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%99%9A%E5%87%BD%E6%95%B0%E9%87%8D%E5%86%99%E8%B9%A6%E5%BA%8A%E7%B1%BB"><span class="nav-number">1.6.3.</span> <span class="nav-text">虚函数重写（蹦床类）</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#stl%E5%AE%B9%E5%99%A8%E6%94%AF%E6%8C%81"><span class="nav-number">1.7.</span> <span class="nav-text">STL容器支持</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9F%BA%E7%A1%80%E5%AE%B9%E5%99%A8%E8%BD%AC%E6%8D%A2"><span class="nav-number">1.7.1.</span> <span class="nav-text">基础容器转换</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B5%8C%E5%A5%97%E5%AE%B9%E5%99%A8"><span class="nav-number">1.7.2.</span> <span class="nav-text">嵌套容器</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#c17%E5%AE%B9%E5%99%A8%E6%94%AF%E6%8C%81"><span class="nav-number">1.7.3.</span> <span class="nav-text">C++17容器支持</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%AB%98%E7%BA%A7%E7%89%B9%E6%80%A7"><span class="nav-number">1.8.</span> <span class="nav-text">高级特性</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86"><span class="nav-number">1.8.1.</span> <span class="nav-text">异常处理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2"><span class="nav-number">1.8.2.</span> <span class="nav-text">自定义类型转换</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#numpy%E9%9B%86%E6%88%90"><span class="nav-number">1.8.3.</span> <span class="nav-text">NumPy集成</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B5%8C%E5%85%A5python%E8%A7%A3%E9%87%8A%E5%99%A8"><span class="nav-number">1.8.4.</span> <span class="nav-text">嵌入Python解释器</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%B7%A8%E5%B9%B3%E5%8F%B0%E6%9E%84%E5%BB%BA"><span class="nav-number">1.9.</span> <span class="nav-text">跨平台构建</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#cmake%E9%85%8D%E7%BD%AE"><span class="nav-number">1.9.1.</span> <span class="nav-text">CMake配置</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%9F%BA%E7%A1%80cmakelists.txt"><span class="nav-number">1.9.1.1.</span> <span class="nav-text">基础CMakeLists.txt</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%89%8B%E5%8A%A8%E6%8C%87%E5%AE%9Apython%E5%92%8Cpybind11%E4%BD%8D%E7%BD%AE"><span class="nav-number">1.9.1.2.</span> <span class="nav-text">手动指定python和pybind11位置</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%AB%98%E7%BA%A7cmake%E9%85%8D%E7%BD%AE"><span class="nav-number">1.9.1.3.</span> <span class="nav-text">高级CMake配置</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%91%BD%E4%BB%A4%E8%A1%8C%E7%BC%96%E8%AF%91"><span class="nav-number">1.9.2.</span> <span class="nav-text">命令行编译</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#linuxmacos"><span class="nav-number">1.9.2.1.</span> <span class="nav-text">Linux&#x2F;macOS</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#windows-visual-studio"><span class="nav-number">1.9.2.2.</span> <span class="nav-text">Windows (Visual Studio)</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#setuptools%E9%85%8D%E7%BD%AE"><span class="nav-number">1.9.3.</span> <span class="nav-text">setuptools配置</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5"><span class="nav-number">1.10.</span> <span class="nav-text">最佳实践</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81%E7%BB%84%E7%BB%87"><span class="nav-number">1.10.1.</span> <span class="nav-text">1. 代码组织</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BB%91%E5%AE%9A%E4%BB%A3%E7%A0%81%E5%88%86%E7%A6%BB"><span class="nav-number">1.10.2.</span> <span class="nav-text">2. 绑定代码分离</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%B1%BB%E5%9E%8B%E5%AE%89%E5%85%A8"><span class="nav-number">1.10.3.</span> <span class="nav-text">3. 类型安全</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96"><span class="nav-number">1.10.4.</span> <span class="nav-text">4. 性能优化</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86"><span class="nav-number">1.10.5.</span> <span class="nav-text">5. 错误处理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%96%87%E6%A1%A3%E7%94%9F%E6%88%90"><span class="nav-number">1.10.6.</span> <span class="nav-text">6. 文档生成</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98%E8%A7%A3%E5%86%B3"><span class="nav-number">1.11.</span> <span class="nav-text">常见问题解决</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BC%96%E8%AF%91%E9%94%99%E8%AF%AF"><span class="nav-number">1.11.1.</span> <span class="nav-text">1. 编译错误</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%97%AE%E9%A2%98%E5%A4%B4%E6%96%87%E4%BB%B6%E6%89%BE%E4%B8%8D%E5%88%B0"><span class="nav-number">1.11.1.1.</span> <span class="nav-text">问题：头文件找不到</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%97%AE%E9%A2%98python%E7%89%88%E6%9C%AC%E4%B8%8D%E5%8C%B9%E9%85%8D"><span class="nav-number">1.11.1.2.</span> <span class="nav-text">问题：Python版本不匹配</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%BF%90%E8%A1%8C%E6%97%B6%E9%94%99%E8%AF%AF"><span class="nav-number">1.11.2.</span> <span class="nav-text">2. 运行时错误</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%97%AE%E9%A2%98%E6%A8%A1%E5%9D%97%E5%AF%BC%E5%85%A5%E5%A4%B1%E8%B4%A5"><span class="nav-number">1.11.2.1.</span> <span class="nav-text">问题：模块导入失败</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%97%AE%E9%A2%98%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2%E9%94%99%E8%AF%AF"><span class="nav-number">1.11.2.2.</span> <span class="nav-text">问题：类型转换错误</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%80%A7%E8%83%BD%E9%97%AE%E9%A2%98"><span class="nav-number">1.11.3.</span> <span class="nav-text">3. 性能问题</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%97%AE%E9%A2%98%E5%A4%A7%E6%95%B0%E6%8D%AE%E4%BC%A0%E8%BE%93%E7%BC%93%E6%85%A2"><span class="nav-number">1.11.3.1.</span> <span class="nav-text">问题：大数据传输缓慢</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%B7%A8%E5%B9%B3%E5%8F%B0%E9%97%AE%E9%A2%98"><span class="nav-number">1.11.4.</span> <span class="nav-text">4. 跨平台问题</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%97%AE%E9%A2%98windows%E4%B8%8A%E9%93%BE%E6%8E%A5%E9%94%99%E8%AF%AF"><span class="nav-number">1.11.4.1.</span> <span class="nav-text">问题：Windows上链接错误</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%97%AE%E9%A2%98macos%E4%B8%8A%E7%AC%A6%E5%8F%B7%E5%86%B2%E7%AA%81"><span class="nav-number">1.11.4.2.</span> <span class="nav-text">问题：macOS上符号冲突</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%B0%83%E8%AF%95%E6%8A%80%E5%B7%A7"><span class="nav-number">1.11.5.</span> <span class="nav-text">5. 调试技巧</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%90%AF%E7%94%A8%E8%B0%83%E8%AF%95%E4%BF%A1%E6%81%AF"><span class="nav-number">1.11.5.1.</span> <span class="nav-text">启用调试信息</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8gdb%E8%B0%83%E8%AF%95"><span class="nav-number">1.11.5.2.</span> <span class="nav-text">使用GDB调试</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%BE%93%E5%87%BA%E8%B0%83%E8%AF%95%E4%BF%A1%E6%81%AF"><span class="nav-number">1.11.5.3.</span> <span class="nav-text">输出调试信息</span></a></li></ol></li></ol></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="三子曰"
      src="https://cdn.jsdelivr.net/gh/MengChangWang/Blog_Image@main/img/avatar.png">
  <p class="site-author-name" itemprop="name">三子曰</p>
  <div class="site-description" itemprop="description">欢迎来到我的博客</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">69</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">6</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">23</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/wangmc1024" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;wangmc1024" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:wangmc1024@gmail.com" title="E-Mail → mailto:wangmc1024@gmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>



      </div>
        <div class="back-to-top motion-element">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; Wed Mar 27 2024 08:00:00 GMT+0800 (中国标准时间) – 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">三子曰</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
    <span title="站点总字数">656k</span>
</div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script size="300" alpha="0.6" zIndex="-1" src="/lib/canvas-ribbon/canvas-ribbon.js"></script>
  <script src="/lib/anime.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/lozad@1/dist/lozad.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  
  <script>
    (function(){
      var canonicalURL, curProtocol;
      //Get the <link> tag
      var x=document.getElementsByTagName("link");
		//Find the last canonical URL
		if(x.length > 0){
			for (i=0;i<x.length;i++){
				if(x[i].rel.toLowerCase() == 'canonical' && x[i].href){
					canonicalURL=x[i].href;
				}
			}
		}
    //Get protocol
	    if (!canonicalURL){
	    	curProtocol = window.location.protocol.split(':')[0];
	    }
	    else{
	    	curProtocol = canonicalURL.split(':')[0];
	    }
      //Get current URL if the canonical URL does not exist
	    if (!canonicalURL) canonicalURL = window.location.href;
	    //Assign script content. Replace current URL with the canonical URL
      !function(){var e=/([http|https]:\/\/[a-zA-Z0-9\_\.]+\.baidu\.com)/gi,r=canonicalURL,t=document.referrer;if(!e.test(r)){var n=(String(curProtocol).toLowerCase() === 'https')?"https://sp0.baidu.com/9_Q4simg2RQJ8t7jm9iCKT-xh_/s.gif":"//api.share.baidu.com/s.gif";t?(n+="?r="+encodeURIComponent(document.referrer),r&&(n+="&l="+r)):r&&(n+="?l="+r);var i=new Image;i.src=n}}(window);})();
  </script>















  

  

<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.css">

<script>
NexT.utils.loadComments(document.querySelector('#gitalk-container'), () => {
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js', () => {
    var gitalk = new Gitalk({
      clientID    : '2719e26e1ea715ee8429',
      clientSecret: '77a4ce8e9410a002f05c8f2c2b398c952a012d7c',
      repo        : 'wangmc1024.github.io',
      owner       : 'wangmc1024',
      admin       : ['wangmc1024'],
      id          : '0b7256026343f1adfd58c96b7d5e0c85',
        language: 'zh-CN',
      distractionFreeMode: true
    });
    gitalk.render('gitalk-container');
  }, window.Gitalk);
});
</script>



</body>
</html>
