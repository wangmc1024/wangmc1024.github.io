<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 8.0.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"wangmc1024.github.io","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":false,"style":"mac"},"back2top":{"enable":true,"sidebar":true,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":true,"pangu":false,"comments":{"style":"tabs","active":"gitalk","storage":true,"lazyload":true,"nav":null,"activeClass":"gitalk"},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":true,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.json"};
  </script>

  <meta name="description" content="如题，结合pybind11官方文档，利用ai整理">
<meta property="og:type" content="article">
<meta property="og:title" content="在python中使用C++">
<meta property="og:url" content="https://wangmc1024.github.io/2025/10/30/C++/%E5%9C%A8python%E4%B8%AD%E4%BD%BF%E7%94%A8C++/index.html">
<meta property="og:site_name" content="Computer Science">
<meta property="og:description" content="如题，结合pybind11官方文档，利用ai整理">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2025-10-29T16:06:10.000Z">
<meta property="article:modified_time" content="2025-10-29T16:17:43.833Z">
<meta property="article:author" content="三子曰">
<meta property="article:tag" content="C++">
<meta property="article:tag" content="python">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://wangmc1024.github.io/2025/10/30/C++/%E5%9C%A8python%E4%B8%AD%E4%BD%BF%E7%94%A8C++/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>在python中使用C++ | Computer Science</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>


<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Computer Science</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">WangMC Blog</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>时间轴</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    


    <main class="main">
      <div class="main-inner">
        <div id="spa-content-wrap" class="content-wrap">
            

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://wangmc1024.github.io/2025/10/30/C++/%E5%9C%A8python%E4%B8%AD%E4%BD%BF%E7%94%A8C++/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://cdn.jsdelivr.net/gh/MengChangWang/Blog_Image@main/img/avatar.png">
      <meta itemprop="name" content="三子曰">
      <meta itemprop="description" content="欢迎来到我的博客">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Computer Science">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          在python中使用C++
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2025-10-30 00:06:10 / 修改时间：00:17:43" itemprop="dateCreated datePublished" datetime="2025-10-30T00:06:10+08:00">2025-10-30</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/" itemprop="url" rel="index"><span itemprop="name">编程语言</span></a>
                </span>
            </span>

          
            <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span id="busuanzi_value_page_pv"></span>
            </span><br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>55k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>50 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <blockquote>
<p>如题，结合pybind11官方文档，利用ai整理</p>
</blockquote>
<span id="more"></span>
<h1>在Python中使用pybind11完整指南</h1>
<p><strong>Date: October 16, 2025</strong><br>
<strong>Code:</strong> <a target="_blank" rel="noopener" href="https://github.com/pybind/pybind11">https://github.com/pybind/pybind11</a></p>
<h2 id="目录">目录</h2>
<ol>
<li class="lvl-3">
<p><a href="#%E7%AE%80%E4%BB%8B">简介</a></p>
</li>
<li class="lvl-3">
<p><a href="#%E5%AE%89%E8%A3%85%E4%B8%8E%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE">安装与环境配置</a></p>
</li>
<li class="lvl-3">
<p><a href="#%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8">基础使用</a></p>
</li>
<li class="lvl-3">
<p><a href="#%E5%87%BD%E6%95%B0%E8%B0%83%E7%94%A8">函数调用</a></p>
</li>
<li class="lvl-3">
<p><a href="#%E7%B1%BB%E7%9A%84%E4%BD%BF%E7%94%A8">类的使用</a></p>
</li>
<li class="lvl-3">
<p><a href="#%E7%BB%A7%E6%89%BFc%E7%B1%BB">继承C++类</a></p>
</li>
<li class="lvl-3">
<p><a href="#%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2">类型转换</a></p>
</li>
<li class="lvl-3">
<p><a href="#%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86">异常处理</a></p>
</li>
<li class="lvl-3">
<p><a href="#numpy%E9%9B%86%E6%88%90">NumPy集成</a></p>
</li>
<li class="lvl-4">
<p><a href="#%E5%A4%9A%E7%BA%BF%E7%A8%8B%E4%BD%BF%E7%94%A8">多线程使用</a></p>
</li>
<li class="lvl-4">
<p><a href="#%E9%AB%98%E7%BA%A7%E7%89%B9%E6%80%A7">高级特性</a></p>
</li>
<li class="lvl-4">
<p><a href="#%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96">性能优化</a></p>
</li>
<li class="lvl-4">
<p><a href="#%E8%B0%83%E8%AF%95%E6%8A%80%E5%B7%A7">调试技巧</a></p>
</li>
<li class="lvl-4">
<p><a href="#%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5">最佳实践</a></p>
</li>
<li class="lvl-4">
<p><a href="#%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98%E4%B8%8E%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88">常见问题与解决方案</a></p>
</li>
</ol>
<h2 id="简介">简介</h2>
<p><strong>pybind11</strong> 是一个轻量级的C<ins>库，它能够将C</ins>代码无缝地暴露给Python。对于Python开发者来说，pybind11提供了以下核心价值：</p>
<h3 id="核心优势">核心优势</h3>
<ul class="lvl-0">
<li class="lvl-2">
<p><strong>高性能</strong>：直接调用C++代码，享受接近原生的性能</p>
</li>
<li class="lvl-2">
<p><strong>丰富的类型支持</strong>：支持基本类型、STL容器、NumPy数组等</p>
</li>
<li class="lvl-2">
<p><strong>面向对象</strong>：可以像使用Python类一样使用C++类</p>
</li>
<li class="lvl-2">
<p><strong>扩展性强</strong>：Python类可以继承C++类，实现多态</p>
</li>
<li class="lvl-2">
<p><strong>易用性</strong>：简单直观的API设计，学习成本低</p>
</li>
</ul>
<h3 id="典型应用场景">典型应用场景</h3>
<ul class="lvl-0">
<li class="lvl-2">
<p><strong>性能瓶颈优化</strong>：将计算密集型代码用C++实现</p>
</li>
<li class="lvl-2">
<p><strong>现有C++库包装</strong>：为已有的C++库提供Python接口</p>
</li>
<li class="lvl-2">
<p><strong>混合编程</strong>：结合Python的易用性和C++的高性能</p>
</li>
<li class="lvl-2">
<p><strong>科学计算</strong>：与NumPy等科学计算库无缝集成</p>
</li>
</ul>
<h2 id="安装与环境配置">安装与环境配置</h2>
<h3 id="1-安装pybind11">1. 安装pybind11</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 使用pip安装</span></span><br><span class="line">pip install pybind11</span><br><span class="line"></span><br><span class="line"><span class="comment"># 或者使用conda安装</span></span><br><span class="line">conda install pybind11 -c conda-forge</span><br></pre></td></tr></table></figure>
<h3 id="2-验证安装">2. 验证安装</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pybind11</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;pybind11版本: <span class="subst">&#123;pybind11.__version__&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;头文件路径: <span class="subst">&#123;pybind11.get_include()&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>
<h3 id="3-项目结构">3. 项目结构</h3>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">python_project/</span><br><span class="line">├── src/</span><br><span class="line">│   └── cpp_extension/</span><br><span class="line">│       ├── __init__.py</span><br><span class="line">│       ├── core.py</span><br><span class="line">│       └── utils.py</span><br><span class="line">├── cpp/</span><br><span class="line">│   ├── bindings/</span><br><span class="line">│   │   ├── core_bindings.cpp</span><br><span class="line">│   │   └── utils_bindings.cpp</span><br><span class="line">│   ├── include/</span><br><span class="line">│   │   └── my_module/</span><br><span class="line">│   │       ├── math_ops.h</span><br><span class="line">│   │       └── data_structures.h</span><br><span class="line">│   └── src/</span><br><span class="line">│       ├── math_ops.cpp</span><br><span class="line">│       └── data_structures.cpp</span><br><span class="line">├── tests/</span><br><span class="line">│   ├── test_core.py</span><br><span class="line">│   └── test_utils.py</span><br><span class="line">├── examples/</span><br><span class="line">│   └── usage_examples.py</span><br><span class="line">├── setup.py</span><br><span class="line">├── CMakeLists.txt</span><br><span class="line">└── README.md</span><br></pre></td></tr></table></figure>
<h3 id="4-构建配置（setup-py）">4. 构建配置（<a target="_blank" rel="noopener" href="http://setup.py">setup.py</a>）</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> setuptools <span class="keyword">import</span> setup, Extension</span><br><span class="line"><span class="keyword">from</span> pybind11.setup_helpers <span class="keyword">import</span> Pybind11Extension, build_ext</span><br><span class="line"><span class="keyword">import</span> glob</span><br><span class="line"></span><br><span class="line">ext_modules = [</span><br><span class="line">    Pybind11Extension(</span><br><span class="line">        <span class="string">&quot;cpp_extension._core&quot;</span>,</span><br><span class="line">        <span class="built_in">sorted</span>(glob.glob(<span class="string">&quot;cpp/bindings/*.cpp&quot;</span>) + glob.glob(<span class="string">&quot;cpp/src/*.cpp&quot;</span>)),</span><br><span class="line">        include_dirs=[<span class="string">&quot;cpp/include&quot;</span>],</span><br><span class="line">        extra_compile_args=[<span class="string">&quot;-O3&quot;</span>, <span class="string">&quot;-std=c++17&quot;</span>, <span class="string">&quot;-Wall&quot;</span>],</span><br><span class="line">    ),</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">setup(</span><br><span class="line">    name=<span class="string">&quot;cpp_extension&quot;</span>,</span><br><span class="line">    version=<span class="string">&quot;1.0.0&quot;</span>,</span><br><span class="line">    author=<span class="string">&quot;Python Developer&quot;</span>,</span><br><span class="line">    description=<span class="string">&quot;pybind11 C++扩展示例&quot;</span>,</span><br><span class="line">    ext_modules=ext_modules,</span><br><span class="line">    cmdclass=&#123;<span class="string">&quot;build_ext&quot;</span>: build_ext&#125;,</span><br><span class="line">    packages=[<span class="string">&quot;cpp_extension&quot;</span>],</span><br><span class="line">    package_dir=&#123;<span class="string">&quot;cpp_extension&quot;</span>: <span class="string">&quot;src/cpp_extension&quot;</span>&#125;,</span><br><span class="line">    zip_safe=<span class="literal">False</span>,</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<h2 id="基础使用">基础使用</h2>
<h3 id="1-模块导入">1. 模块导入</h3>
<p>假设我们已经有一个使用pybind11编译的C++扩展模块<code>example</code>。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 导入C++扩展模块</span></span><br><span class="line"><span class="keyword">import</span> example</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看模块信息</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;模块名称: <span class="subst">&#123;example.__name__&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;模块文件: <span class="subst">&#123;example.__file__&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;模块文档: <span class="subst">&#123;example.__doc__&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看模块中的函数和类</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;\n模块内容:&quot;</span>)</span><br><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> <span class="built_in">dir</span>(example):</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> item.startswith(<span class="string">&#x27;_&#x27;</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;  <span class="subst">&#123;item&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>
<h3 id="2-基本函数调用">2. 基本函数调用</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> example</span><br><span class="line"></span><br><span class="line"><span class="comment"># 1. 简单函数调用</span></span><br><span class="line">result = example.add(<span class="number">3</span>, <span class="number">4</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;3 + 4 = <span class="subst">&#123;result&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. 关键字参数</span></span><br><span class="line">result = example.multiply(a=<span class="number">5</span>, b=<span class="number">6</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;5 * 6 = <span class="subst">&#123;result&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. 默认参数</span></span><br><span class="line">result = example.power(<span class="number">2</span>)  <span class="comment"># 使用默认参数</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;2^2 = <span class="subst">&#123;result&#125;</span>&quot;</span>)</span><br><span class="line">result = example.power(<span class="number">2</span>, <span class="number">3</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;2^3 = <span class="subst">&#123;result&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4. 查看函数文档</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;\nadd函数文档: <span class="subst">&#123;example.add.__doc__&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;multiply函数签名: <span class="subst">&#123;example.multiply.__signature__&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>
<h3 id="3-常量和属性访问">3. 常量和属性访问</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> example</span><br><span class="line"></span><br><span class="line"><span class="comment"># 访问模块级常量</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;PI = <span class="subst">&#123;example.PI&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;版本号 = <span class="subst">&#123;example.VERSION&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;作者 = <span class="subst">&#123;example.AUTHOR&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 修改可写属性</span></span><br><span class="line">example.counter = <span class="number">100</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;修改后的counter = <span class="subst">&#123;example.counter&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 尝试修改只读属性（可能会抛出异常）</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    example.PI = <span class="number">3.14</span></span><br><span class="line"><span class="keyword">except</span> AttributeError <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;修改只读属性失败: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>
<h2 id="函数调用">函数调用</h2>
<h3 id="1-不同参数类型的函数">1. 不同参数类型的函数</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> example</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"><span class="comment"># 1. 基本类型参数</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;=== 基本类型 ===&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(example.add(<span class="number">1</span>, <span class="number">2</span>))          <span class="comment"># int</span></span><br><span class="line"><span class="built_in">print</span>(example.multiply(<span class="number">3.5</span>, <span class="number">2</span>))   <span class="comment"># float</span></span><br><span class="line"><span class="built_in">print</span>(example.concat(<span class="string">&quot;Hello&quot;</span>, <span class="string">&quot; World&quot;</span>))  <span class="comment"># str</span></span><br><span class="line"><span class="built_in">print</span>(example.is_positive(-<span class="number">5</span>))    <span class="comment"># bool</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. 容器类型参数</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;\n=== 容器类型 ===&quot;</span>)</span><br><span class="line">result_list = example.double_list([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>])</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;列表翻倍: <span class="subst">&#123;result_list&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">result_dict = example.increment_values(&#123;<span class="string">&quot;a&quot;</span>: <span class="number">1</span>, <span class="string">&quot;b&quot;</span>: <span class="number">2</span>, <span class="string">&quot;c&quot;</span>: <span class="number">3</span>&#125;)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;字典值递增: <span class="subst">&#123;result_dict&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">result_set = example.square_set(&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>&#125;)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;集合平方: <span class="subst">&#123;result_set&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. NumPy数组参数</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;\n=== NumPy数组 ===&quot;</span>)</span><br><span class="line">arr = np.array([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>], dtype=np.float32)</span><br><span class="line">result_arr = example.process_array(arr)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;数组处理结果: <span class="subst">&#123;result_arr&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4. 多个参数和返回值</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;\n=== 多个参数和返回值 ===&quot;</span>)</span><br><span class="line">a, b, c = example.calculate_stats([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>])</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;平均值: <span class="subst">&#123;a&#125;</span>, 标准差: <span class="subst">&#123;b&#125;</span>, 总和: <span class="subst">&#123;c&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>
<h3 id="2-函数装饰器和回调">2. 函数装饰器和回调</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> example</span><br><span class="line"></span><br><span class="line"><span class="comment"># 1. 使用C++实现的装饰器</span></span><br><span class="line"><span class="meta">@example.timer</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">slow_function</span>():</span><br><span class="line">    <span class="keyword">import</span> time</span><br><span class="line">    time.sleep(<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;完成&quot;</span></span><br><span class="line"></span><br><span class="line">result = slow_function()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;函数结果: <span class="subst">&#123;result&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. 将Python函数作为回调传递给C++</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">python_callback</span>(<span class="params">x</span>):</span><br><span class="line">    <span class="keyword">return</span> x * <span class="number">2</span> + <span class="number">1</span></span><br><span class="line"></span><br><span class="line">result = example.apply_function(python_callback, [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>])</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;回调函数结果: <span class="subst">&#123;result&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. 高阶函数</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">filter_even</span>(<span class="params">x</span>):</span><br><span class="line">    <span class="keyword">return</span> x % <span class="number">2</span> == <span class="number">0</span></span><br><span class="line"></span><br><span class="line">filtered = example.filter_list(filter_even, <span class="built_in">range</span>(<span class="number">10</span>))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;过滤偶数: <span class="subst">&#123;filtered&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>
<h3 id="3-性能对比">3. 性能对比</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> example</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"><span class="comment"># Python实现</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">python_sum</span>(<span class="params">arr</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">sum</span>(arr)</span><br><span class="line"></span><br><span class="line"><span class="comment"># C++实现（通过pybind11暴露）</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">cpp_sum</span>(<span class="params">arr</span>):</span><br><span class="line">    <span class="keyword">return</span> example.sum_array(arr)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 性能测试</span></span><br><span class="line">arr = np.random.rand(<span class="number">1_000_000</span>).astype(np.float32)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Python版本</span></span><br><span class="line">start_time = time.time()</span><br><span class="line">python_result = python_sum(arr)</span><br><span class="line">python_time = time.time() - start_time</span><br><span class="line"></span><br><span class="line"><span class="comment"># C++版本</span></span><br><span class="line">start_time = time.time()</span><br><span class="line">cpp_result = cpp_sum(arr)</span><br><span class="line">cpp_time = time.time() - start_time</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;Python求和结果: <span class="subst">&#123;python_result:<span class="number">.6</span>f&#125;</span>, 耗时: <span class="subst">&#123;python_time:<span class="number">.6</span>f&#125;</span>秒&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;C++求和结果: <span class="subst">&#123;cpp_result:<span class="number">.6</span>f&#125;</span>, 耗时: <span class="subst">&#123;cpp_time:<span class="number">.6</span>f&#125;</span>秒&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;性能提升: <span class="subst">&#123;python_time / cpp_time:<span class="number">.2</span>f&#125;</span>倍&quot;</span>)</span><br></pre></td></tr></table></figure>
<h2 id="类的使用">类的使用</h2>
<h3 id="1-基础类操作">1. 基础类操作</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> example</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建对象</span></span><br><span class="line">pet = example.Pet(<span class="string">&quot;小黄&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;宠物名称: <span class="subst">&#123;pet.get_name()&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 调用方法</span></span><br><span class="line">pet.set_name(<span class="string">&quot;小黑&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;修改后名称: <span class="subst">&#123;pet.get_name()&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 访问属性</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;直接访问名称属性: <span class="subst">&#123;pet.name&#125;</span>&quot;</span>)</span><br><span class="line">pet.name = <span class="string">&quot;小白&quot;</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;修改属性后: <span class="subst">&#123;pet.name&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 动态属性（如果C++类启用了py::dynamic_attr）</span></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">hasattr</span>(pet, <span class="string">&#x27;__dict__&#x27;</span>):</span><br><span class="line">    pet.age = <span class="number">2</span></span><br><span class="line">    pet.color = <span class="string">&quot;棕色&quot;</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;动态属性 - 年龄: <span class="subst">&#123;pet.age&#125;</span>, 颜色: <span class="subst">&#123;pet.color&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>
<h3 id="2-类的继承和多态">2. 类的继承和多态</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> example</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建不同类型的动物</span></span><br><span class="line">dog = example.Dog(<span class="string">&quot;旺财&quot;</span>)</span><br><span class="line">cat = example.Cat(<span class="string">&quot;咪咪&quot;</span>)</span><br><span class="line">bird = example.Bird(<span class="string">&quot;小鸟&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 多态调用</span></span><br><span class="line">animals = [dog, cat, bird]</span><br><span class="line"><span class="keyword">for</span> animal <span class="keyword">in</span> animals:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;animal.get_name()&#125;</span> 说: <span class="subst">&#123;animal.speak()&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;类型: <span class="subst">&#123;<span class="built_in">type</span>(animal).__name__&#125;</span>&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 调用特定类型的方法</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">isinstance</span>(animal, example.Dog):</span><br><span class="line">        animal.fetch()</span><br><span class="line">    <span class="keyword">elif</span> <span class="built_in">isinstance</span>(animal, example.Cat):</span><br><span class="line">        animal.purr()</span><br><span class="line">    <span class="keyword">elif</span> <span class="built_in">isinstance</span>(animal, example.Bird):</span><br><span class="line">        animal.fly()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用工厂函数</span></span><br><span class="line">animal = example.create_animal(<span class="string">&quot;dog&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;\n工厂函数创建的动物: <span class="subst">&#123;animal.get_name()&#125;</span>, 类型: <span class="subst">&#123;<span class="built_in">type</span>(animal).__name__&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>
<h3 id="3-运算符重载">3. 运算符重载</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> example</span><br><span class="line"></span><br><span class="line"><span class="comment"># 向量运算</span></span><br><span class="line">v1 = example.Vector2(<span class="number">1</span>, <span class="number">2</span>)</span><br><span class="line">v2 = example.Vector2(<span class="number">3</span>, <span class="number">4</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;v1 = (<span class="subst">&#123;v1.x&#125;</span>, <span class="subst">&#123;v1.y&#125;</span>)&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;v2 = (<span class="subst">&#123;v2.x&#125;</span>, <span class="subst">&#123;v2.y&#125;</span>)&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 运算符重载</span></span><br><span class="line">v3 = v1 + v2</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;v1 + v2 = (<span class="subst">&#123;v3.x&#125;</span>, <span class="subst">&#123;v3.y&#125;</span>)&quot;</span>)</span><br><span class="line"></span><br><span class="line">v4 = v1 * <span class="number">2</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;v1 * 2 = (<span class="subst">&#123;v4.x&#125;</span>, <span class="subst">&#123;v4.y&#125;</span>)&quot;</span>)</span><br><span class="line"></span><br><span class="line">v5 = <span class="number">3</span> * v2</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;3 * v2 = (<span class="subst">&#123;v5.x&#125;</span>, <span class="subst">&#123;v5.y&#125;</span>)&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 比较运算符</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;v1 == v2: <span class="subst">&#123;v1 == v2&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;v1 == v1: <span class="subst">&#123;v1 == v1&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 方法调用</span></span><br><span class="line">dot_product = v1.dot(v2)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;v1 · v2 = <span class="subst">&#123;dot_product&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>
<h3 id="4-枚举类型">4. 枚举类型</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> example</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用枚举类型</span></span><br><span class="line">character = example.GameCharacter(<span class="string">&quot;战士张三&quot;</span>, example.CharacterClass.Warrior)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;角色名称: <span class="subst">&#123;character.name&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;角色职业: <span class="subst">&#123;character.character_class&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置属性</span></span><br><span class="line">character.attributes = (example.CharacterAttributes.Strength | </span><br><span class="line">                       example.CharacterAttributes.Vitality)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;角色属性: <span class="subst">&#123;character.attributes&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 检查属性</span></span><br><span class="line">has_strength = (character.attributes &amp; example.CharacterAttributes.Strength) != <span class="number">0</span></span><br><span class="line">has_intelligence = (character.attributes &amp; example.CharacterAttributes.Intelligence) != <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;有力量属性: <span class="subst">&#123;has_strength&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;有智力属性: <span class="subst">&#123;has_intelligence&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>
<h2 id="继承C-类">继承C++类</h2>
<h3 id="1-Python类继承C-类">1. Python类继承C++类</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> example</span><br><span class="line"></span><br><span class="line"><span class="comment"># Python类继承C++类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyDog</span>(example.Dog):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, name, breed</span>):</span><br><span class="line">        <span class="built_in">super</span>().__init__(name)</span><br><span class="line">        <span class="variable language_">self</span>.breed = breed  <span class="comment"># Python特有的属性</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_breed</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;Python特有的方法&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.breed</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">speak</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;重写C++方法&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">f&quot;<span class="subst">&#123;self.get_name()&#125;</span> 汪汪汪！我是一只<span class="subst">&#123;self.breed&#125;</span>。&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">do_trick</span>(<span class="params">self, trick_name</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;新的Python方法&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">f&quot;<span class="subst">&#123;self.get_name()&#125;</span> 表演了 <span class="subst">&#123;trick_name&#125;</span>！&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用继承的类</span></span><br><span class="line">my_dog = MyDog(<span class="string">&quot;小黄&quot;</span>, <span class="string">&quot;金毛&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;狗的名字: <span class="subst">&#123;my_dog.get_name()&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;狗的品种: <span class="subst">&#123;my_dog.get_breed()&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;叫声: <span class="subst">&#123;my_dog.speak()&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;特技: <span class="subst">&#123;my_dog.do_trick(<span class="string">&#x27;握手&#x27;</span>)&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 调用父类方法</span></span><br><span class="line">my_dog.fetch()  <span class="comment"># 这是C++ Dog类的方法</span></span><br></pre></td></tr></table></figure>
<h3 id="2-抽象类和接口实现">2. 抽象类和接口实现</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> example</span><br><span class="line"><span class="keyword">import</span> abc</span><br><span class="line"></span><br><span class="line"><span class="comment"># 实现C++抽象类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyShape</span>(example.Shape):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, color</span>):</span><br><span class="line">        <span class="variable language_">self</span>.color = color</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_color</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.color</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 必须实现C++抽象方法</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">area</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">raise</span> NotImplementedError(<span class="string">&quot;子类必须实现area方法&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">perimeter</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">raise</span> NotImplementedError(<span class="string">&quot;子类必须实现perimeter方法&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Circle</span>(<span class="title class_ inherited__">MyShape</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, radius, color=<span class="string">&quot;red&quot;</span></span>):</span><br><span class="line">        <span class="built_in">super</span>().__init__(color)</span><br><span class="line">        <span class="variable language_">self</span>.radius = radius</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">area</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="number">3.14159</span> * <span class="variable language_">self</span>.radius * <span class="variable language_">self</span>.radius</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">perimeter</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="number">2</span> * <span class="number">3.14159</span> * <span class="variable language_">self</span>.radius</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Rectangle</span>(<span class="title class_ inherited__">MyShape</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, width, height, color=<span class="string">&quot;blue&quot;</span></span>):</span><br><span class="line">        <span class="built_in">super</span>().__init__(color)</span><br><span class="line">        <span class="variable language_">self</span>.width = width</span><br><span class="line">        <span class="variable language_">self</span>.height = height</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">area</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.width * <span class="variable language_">self</span>.height</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">perimeter</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="number">2</span> * (<span class="variable language_">self</span>.width + <span class="variable language_">self</span>.height)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用自定义形状</span></span><br><span class="line">shapes = [Circle(<span class="number">5</span>), Rectangle(<span class="number">4</span>, <span class="number">6</span>)]</span><br><span class="line"><span class="keyword">for</span> shape <span class="keyword">in</span> shapes:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;shape.get_color()&#125;</span> <span class="subst">&#123;<span class="built_in">type</span>(shape).__name__&#125;</span>:&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;  面积: <span class="subst">&#123;shape.area():<span class="number">.2</span>f&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;  周长: <span class="subst">&#123;shape.perimeter():<span class="number">.2</span>f&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>
<h3 id="3-多态和类型检查">3. 多态和类型检查</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> example</span><br><span class="line"></span><br><span class="line"><span class="comment"># 类型检查示例</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">process_animal</span>(<span class="params">animal</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;处理动物对象，演示多态&quot;&quot;&quot;</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;处理动物: <span class="subst">&#123;animal.get_name()&#125;</span>&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 类型检查</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">isinstance</span>(animal, example.Dog):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;这是一只狗，正在fetch...&quot;</span>)</span><br><span class="line">        animal.fetch()</span><br><span class="line">    <span class="keyword">elif</span> <span class="built_in">isinstance</span>(animal, example.Cat):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;这是一只猫，正在purr...&quot;</span>)</span><br><span class="line">        animal.purr()</span><br><span class="line">    <span class="keyword">elif</span> <span class="built_in">isinstance</span>(animal, example.Animal):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;这是一只动物，正在叫...&quot;</span>)</span><br><span class="line">        animal.speak()</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;未知类型: <span class="subst">&#123;<span class="built_in">type</span>(animal)&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建不同类型的动物</span></span><br><span class="line">dog = example.Dog(<span class="string">&quot;旺财&quot;</span>)</span><br><span class="line">cat = example.Cat(<span class="string">&quot;咪咪&quot;</span>)</span><br><span class="line">unknown = <span class="string">&quot;这不是动物&quot;</span></span><br><span class="line"></span><br><span class="line">process_animal(dog)</span><br><span class="line">process_animal(cat)</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    process_animal(unknown)</span><br><span class="line"><span class="keyword">except</span> TypeError <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;处理失败: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 类型转换</span></span><br><span class="line">animal = example.create_animal(<span class="string">&quot;dog&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;\n工厂函数返回类型: <span class="subst">&#123;<span class="built_in">type</span>(animal)&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 向下转型（如果需要）</span></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">isinstance</span>(animal, example.Dog):</span><br><span class="line">    dog = animal  <span class="comment"># 自动向下转型</span></span><br><span class="line">    dog.fetch()</span><br></pre></td></tr></table></figure>
<h2 id="类型转换">类型转换</h2>
<h3 id="1-基础类型转换">1. 基础类型转换</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> example</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"><span class="comment"># 1. Python到C++的类型转换</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;=== Python到C++类型转换 ===&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># int</span></span><br><span class="line">cpp_int = example.accept_int(<span class="number">42</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;int转换: <span class="subst">&#123;cpp_int&#125;</span>, 类型: <span class="subst">&#123;<span class="built_in">type</span>(cpp_int)&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># float</span></span><br><span class="line">cpp_float = example.accept_float(<span class="number">3.14</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;float转换: <span class="subst">&#123;cpp_float&#125;</span>, 类型: <span class="subst">&#123;<span class="built_in">type</span>(cpp_float)&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># bool</span></span><br><span class="line">cpp_bool = example.accept_bool(<span class="literal">True</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;bool转换: <span class="subst">&#123;cpp_bool&#125;</span>, 类型: <span class="subst">&#123;<span class="built_in">type</span>(cpp_bool)&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># str</span></span><br><span class="line">cpp_str = example.accept_string(<span class="string">&quot;Hello pybind11&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;str转换: <span class="subst">&#123;cpp_str&#125;</span>, 类型: <span class="subst">&#123;<span class="built_in">type</span>(cpp_str)&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. C++到Python的类型转换</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;\n=== C++到Python类型转换 ===&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 基本类型</span></span><br><span class="line">py_int = example.return_int()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;C++返回int: <span class="subst">&#123;py_int&#125;</span>, 类型: <span class="subst">&#123;<span class="built_in">type</span>(py_int)&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">py_float = example.return_float()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;C++返回float: <span class="subst">&#123;py_float&#125;</span>, 类型: <span class="subst">&#123;<span class="built_in">type</span>(py_float)&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">py_str = example.return_string()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;C++返回str: <span class="subst">&#123;py_str&#125;</span>, 类型: <span class="subst">&#123;<span class="built_in">type</span>(py_str)&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>
<h3 id="2-容器类型转换">2. 容器类型转换</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> example</span><br><span class="line"></span><br><span class="line"><span class="comment"># 1. 列表转换</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;=== 列表转换 ===&quot;</span>)</span><br><span class="line">py_list = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>]</span><br><span class="line">cpp_processed = example.process_vector(py_list)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;原始列表: <span class="subst">&#123;py_list&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;C++处理后: <span class="subst">&#123;cpp_processed&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;类型: <span class="subst">&#123;<span class="built_in">type</span>(cpp_processed)&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. 字典转换</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;\n=== 字典转换 ===&quot;</span>)</span><br><span class="line">py_dict = &#123;<span class="string">&quot;apple&quot;</span>: <span class="number">1</span>, <span class="string">&quot;banana&quot;</span>: <span class="number">2</span>, <span class="string">&quot;orange&quot;</span>: <span class="number">3</span>&#125;</span><br><span class="line">cpp_dict = example.process_map(py_dict)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;原始字典: <span class="subst">&#123;py_dict&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;C++处理后: <span class="subst">&#123;cpp_dict&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. 集合转换</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;\n=== 集合转换 ===&quot;</span>)</span><br><span class="line">py_set = &#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>&#125;</span><br><span class="line">cpp_set = example.process_set(py_set)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;原始集合: <span class="subst">&#123;py_set&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;C++处理后: <span class="subst">&#123;cpp_set&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4. 元组转换</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;\n=== 元组转换 ===&quot;</span>)</span><br><span class="line">py_tuple = (<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>)</span><br><span class="line">cpp_tuple = example.process_tuple(py_tuple)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;原始元组: <span class="subst">&#123;py_tuple&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;C++处理后: <span class="subst">&#123;cpp_tuple&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>
<h3 id="3-NumPy数组转换">3. NumPy数组转换</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> example</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"><span class="comment"># 1. 一维数组转换</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;=== 一维数组转换 ===&quot;</span>)</span><br><span class="line">py_array_1d = np.array([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>], dtype=np.float32)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;Python数组形状: <span class="subst">&#123;py_array_1d.shape&#125;</span>, 类型: <span class="subst">&#123;py_array_1d.dtype&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">cpp_processed_1d = example.process_1d_array(py_array_1d)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;C++处理后: <span class="subst">&#123;cpp_processed_1d&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;返回类型: <span class="subst">&#123;<span class="built_in">type</span>(cpp_processed_1d)&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. 二维数组转换</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;\n=== 二维数组转换 ===&quot;</span>)</span><br><span class="line">py_array_2d = np.array([[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>], [<span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>]], dtype=np.int32)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;Python数组形状: <span class="subst">&#123;py_array_2d.shape&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">cpp_processed_2d = example.process_2d_array(py_array_2d)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;C++处理后:\n<span class="subst">&#123;cpp_processed_2d&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. 矩阵乘法</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;\n=== 矩阵乘法 ===&quot;</span>)</span><br><span class="line">matrix_a = np.array([[<span class="number">1</span>, <span class="number">2</span>], [<span class="number">3</span>, <span class="number">4</span>]], dtype=np.int32)</span><br><span class="line">matrix_b = np.array([[<span class="number">5</span>, <span class="number">6</span>], [<span class="number">7</span>, <span class="number">8</span>]], dtype=np.int32)</span><br><span class="line"></span><br><span class="line">result_matrix = example.matrix_multiply(matrix_a, matrix_b)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;矩阵A:\n<span class="subst">&#123;matrix_a&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;矩阵B:\n<span class="subst">&#123;matrix_b&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;乘积:\n<span class="subst">&#123;result_matrix&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4. 零拷贝视图</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;\n=== 零拷贝视图 ===&quot;</span>)</span><br><span class="line">large_array = np.random.rand(<span class="number">1_000_000</span>).astype(np.float32)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;大数组大小: <span class="subst">&#123;large_array.nbytes / <span class="number">1024</span> / <span class="number">1024</span>:<span class="number">.2</span>f&#125;</span> MB&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 传递数组视图，避免复制</span></span><br><span class="line">result_view = example.process_array_view(large_array)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;处理结果形状: <span class="subst">&#123;result_view.shape&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;是否共享内存: <span class="subst">&#123;np.shares_memory(large_array, result_view)&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>
<h3 id="4-自定义类型转换">4. 自定义类型转换</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> example</span><br><span class="line"></span><br><span class="line"><span class="comment"># 1. 元组到自定义类型</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;=== 元组到自定义类型 ===&quot;</span>)</span><br><span class="line">point_tuple = (<span class="number">10</span>, <span class="number">20</span>)</span><br><span class="line">point = example.Point(point_tuple)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;从元组创建Point: (<span class="subst">&#123;point.x&#125;</span>, <span class="subst">&#123;point.y&#125;</span>)&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. 自定义类型到元组</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;\n=== 自定义类型到元组 ===&quot;</span>)</span><br><span class="line">point2 = example.Point(<span class="number">30</span>, <span class="number">40</span>)</span><br><span class="line">point_tuple2 = example.point_to_tuple(point2)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;Point转换为元组: <span class="subst">&#123;point_tuple2&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. 字典到对象</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;\n=== 字典到对象 ===&quot;</span>)</span><br><span class="line">person_dict = &#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;张三&quot;</span>, <span class="string">&quot;age&quot;</span>: <span class="number">30</span>, <span class="string">&quot;email&quot;</span>: <span class="string">&quot;zhangsan@example.com&quot;</span>&#125;</span><br><span class="line">person = example.create_person_from_dict(person_dict)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;从字典创建Person: <span class="subst">&#123;person.get_name()&#125;</span>, <span class="subst">&#123;person.get_age()&#125;</span>岁&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4. 对象到字典</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;\n=== 对象到字典 ===&quot;</span>)</span><br><span class="line">person_dict2 = example.person_to_dict(person)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;Person转换为字典: <span class="subst">&#123;person_dict2&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>
<h2 id="异常处理">异常处理</h2>
<h3 id="1-捕获C-异常">1. 捕获C++异常</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> example</span><br><span class="line"></span><br><span class="line"><span class="comment"># 1. 基本异常处理</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;=== 基本异常处理 ===&quot;</span>)</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    result = example.divide(<span class="number">10</span>, <span class="number">0</span>)</span><br><span class="line"><span class="keyword">except</span> example.DivisionByZeroError <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;捕获C++异常: <span class="subst">&#123;<span class="built_in">type</span>(e).__name__&#125;</span>: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. 不同类型的异常</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;\n=== 不同类型异常 ===&quot;</span>)</span><br><span class="line">exceptions_to_test = [</span><br><span class="line">    (example.divide, (<span class="number">10</span>, <span class="number">0</span>), example.DivisionByZeroError),</span><br><span class="line">    (example.validate_positive, (-<span class="number">5</span>,), example.InvalidInputError),</span><br><span class="line">    (example.open_file, (<span class="string">&quot;nonexistent.txt&quot;</span>,), example.FileNotFoundError),</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> func, args, expected_exc <span class="keyword">in</span> exceptions_to_test:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        func(*args)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;func.__name__&#125;</span><span class="subst">&#123;args&#125;</span> 未抛出异常&quot;</span>)</span><br><span class="line">    <span class="keyword">except</span> expected_exc <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;func.__name__&#125;</span><span class="subst">&#123;args&#125;</span> 抛出 <span class="subst">&#123;<span class="built_in">type</span>(e).__name__&#125;</span>: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. 异常链</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;\n=== 异常链 ===&quot;</span>)</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    result = example.divide(<span class="number">10</span>, <span class="number">0</span>)</span><br><span class="line"><span class="keyword">except</span> example.DivisionByZeroError <span class="keyword">as</span> e:</span><br><span class="line">    <span class="comment"># 包装为Python异常</span></span><br><span class="line">    <span class="keyword">raise</span> ValueError(<span class="string">&quot;除法运算失败&quot;</span>) <span class="keyword">from</span> e</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4. 通用异常捕获</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;\n=== 通用异常捕获 ===&quot;</span>)</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    result = example.unsafe_function()</span><br><span class="line"><span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;捕获通用异常: <span class="subst">&#123;<span class="built_in">type</span>(e).__name__&#125;</span>: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;异常类型MRO: <span class="subst">&#123;[base.__name__ <span class="keyword">for</span> base <span class="keyword">in</span> <span class="built_in">type</span>(e).__mro__]&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>
<h3 id="2-自定义异常处理">2. 自定义异常处理</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> example</span><br><span class="line"><span class="keyword">import</span> traceback</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">PythonExceptionHandler</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;Python异常处理器，统一处理C++和Python异常&quot;&quot;&quot;</span></span><br><span class="line">    </span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">handle_exception</span>(<span class="params">func, *args, **kwargs</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;执行函数并处理异常&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            result = func(*args, **kwargs)</span><br><span class="line">            <span class="keyword">return</span> &#123;<span class="string">&quot;success&quot;</span>: <span class="literal">True</span>, <span class="string">&quot;result&quot;</span>: result&#125;</span><br><span class="line">        <span class="keyword">except</span> example.DivisionByZeroError <span class="keyword">as</span> e:</span><br><span class="line">            <span class="keyword">return</span> &#123;</span><br><span class="line">                <span class="string">&quot;success&quot;</span>: <span class="literal">False</span>,</span><br><span class="line">                <span class="string">&quot;error_type&quot;</span>: <span class="string">&quot;DivisionByZeroError&quot;</span>,</span><br><span class="line">                <span class="string">&quot;error_message&quot;</span>: <span class="built_in">str</span>(e),</span><br><span class="line">                <span class="string">&quot;details&quot;</span>: <span class="string">&quot;除数不能为零&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line">        <span class="keyword">except</span> example.InvalidInputError <span class="keyword">as</span> e:</span><br><span class="line">            <span class="keyword">return</span> &#123;</span><br><span class="line">                <span class="string">&quot;success&quot;</span>: <span class="literal">False</span>,</span><br><span class="line">                <span class="string">&quot;error_type&quot;</span>: <span class="string">&quot;InvalidInputError&quot;</span>,</span><br><span class="line">                <span class="string">&quot;error_message&quot;</span>: <span class="built_in">str</span>(e),</span><br><span class="line">                <span class="string">&quot;details&quot;</span>: <span class="string">&quot;输入参数无效&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="keyword">return</span> &#123;</span><br><span class="line">                <span class="string">&quot;success&quot;</span>: <span class="literal">False</span>,</span><br><span class="line">                <span class="string">&quot;error_type&quot;</span>: <span class="built_in">type</span>(e).__name__,</span><br><span class="line">                <span class="string">&quot;error_message&quot;</span>: <span class="built_in">str</span>(e),</span><br><span class="line">                <span class="string">&quot;traceback&quot;</span>: traceback.format_exc()</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用异常处理器</span></span><br><span class="line">handler = PythonExceptionHandler()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 测试正常情况</span></span><br><span class="line">result = handler.handle_exception(example.divide, <span class="number">10</span>, <span class="number">2</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;正常情况: <span class="subst">&#123;result&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 测试异常情况</span></span><br><span class="line">result = handler.handle_exception(example.divide, <span class="number">10</span>, <span class="number">0</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;异常情况: <span class="subst">&#123;result&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 批量处理</span></span><br><span class="line">operations = [</span><br><span class="line">    (example.add, (<span class="number">2</span>, <span class="number">3</span>)),</span><br><span class="line">    (example.divide, (<span class="number">10</span>, <span class="number">0</span>)),</span><br><span class="line">    (example.multiply, (<span class="number">4</span>, <span class="number">5</span>)),</span><br><span class="line">    (example.validate_positive, (-<span class="number">1</span>,)),</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;\n=== 批量异常处理 ===&quot;</span>)</span><br><span class="line"><span class="keyword">for</span> func, args <span class="keyword">in</span> operations:</span><br><span class="line">    result = handler.handle_exception(func, *args)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;func.__name__&#125;</span><span class="subst">&#123;args&#125;</span>: <span class="subst">&#123;<span class="string">&#x27;成功&#x27;</span> <span class="keyword">if</span> result[<span class="string">&#x27;success&#x27;</span>] <span class="keyword">else</span> <span class="string">&#x27;失败&#x27;</span>&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>
<h2 id="NumPy集成">NumPy集成</h2>
<h3 id="1-数组操作">1. 数组操作</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> example</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"><span class="comment"># 1. 基础数组操作</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;=== 基础数组操作 ===&quot;</span>)</span><br><span class="line">arr = np.array([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>], dtype=np.float32)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;原始数组: <span class="subst">&#123;arr&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 数组乘以标量</span></span><br><span class="line">result1 = example.multiply_by_scalar(arr, <span class="number">2.0</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;乘以2: <span class="subst">&#123;result1&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 数组加法</span></span><br><span class="line">result2 = example.add_arrays(arr, arr * <span class="number">2</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;数组加法: <span class="subst">&#123;result2&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. 统计计算</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;\n=== 统计计算 ===&quot;</span>)</span><br><span class="line">large_arr = np.random.rand(<span class="number">1000000</span>).astype(np.float32)</span><br><span class="line"></span><br><span class="line"><span class="comment"># C++实现的统计函数</span></span><br><span class="line">mean, std, sum_val = example.calculate_stats(large_arr)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;C++统计结果: 均值=<span class="subst">&#123;mean:<span class="number">.6</span>f&#125;</span>, 标准差=<span class="subst">&#123;std:<span class="number">.6</span>f&#125;</span>, 总和=<span class="subst">&#123;sum_val:<span class="number">.6</span>f&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Python实现的统计函数（对比）</span></span><br><span class="line">py_mean = np.mean(large_arr)</span><br><span class="line">py_std = np.std(large_arr)</span><br><span class="line">py_sum = np.<span class="built_in">sum</span>(large_arr)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;NumPy统计结果: 均值=<span class="subst">&#123;py_mean:<span class="number">.6</span>f&#125;</span>, 标准差=<span class="subst">&#123;py_std:<span class="number">.6</span>f&#125;</span>, 总和=<span class="subst">&#123;py_sum:<span class="number">.6</span>f&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. 矩阵运算</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;\n=== 矩阵运算 ===&quot;</span>)</span><br><span class="line">matrix_a = np.array([[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>], [<span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>], [<span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>]], dtype=np.float32)</span><br><span class="line">matrix_b = np.array([[<span class="number">9</span>, <span class="number">8</span>, <span class="number">7</span>], [<span class="number">6</span>, <span class="number">5</span>, <span class="number">4</span>], [<span class="number">3</span>, <span class="number">2</span>, <span class="number">1</span>]], dtype=np.float32)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 矩阵乘法</span></span><br><span class="line">product = example.matrix_multiply(matrix_a, matrix_b)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;矩阵乘法结果:\n<span class="subst">&#123;product&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 矩阵转置</span></span><br><span class="line">transposed = example.transpose_matrix(matrix_a)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;矩阵转置结果:\n<span class="subst">&#123;transposed&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 矩阵求逆（如果可逆）</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    inverse = example.invert_matrix(matrix_a)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;矩阵逆:\n<span class="subst">&#123;inverse&#125;</span>&quot;</span>)</span><br><span class="line"><span class="keyword">except</span> example.MatrixError <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;矩阵求逆失败: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>
<h3 id="2-高级NumPy功能">2. 高级NumPy功能</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> example</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"><span class="comment"># 1. 数组视图和内存管理</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;=== 数组视图和内存管理 ===&quot;</span>)</span><br><span class="line">large_array = np.random.rand(<span class="number">2048</span>, <span class="number">2048</span>).astype(np.float32)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;大数组大小: <span class="subst">&#123;large_array.nbytes / <span class="number">1024</span> / <span class="number">1024</span>:<span class="number">.2</span>f&#125;</span> MB&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建数组视图（零拷贝）</span></span><br><span class="line">view_result = example.create_array_view(large_array)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;视图形状: <span class="subst">&#123;view_result.shape&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;是否共享内存: <span class="subst">&#123;np.shares_memory(large_array, view_result)&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. 数组切片</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;\n=== 数组切片 ===&quot;</span>)</span><br><span class="line">matrix = np.arange(<span class="number">16</span>).reshape(<span class="number">4</span>, <span class="number">4</span>).astype(np.float32)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;原始矩阵:\n<span class="subst">&#123;matrix&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 切片操作</span></span><br><span class="line">slice_result = example.slice_matrix(matrix, <span class="number">1</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">3</span>)  <span class="comment"># 行1-3，列1-3</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;切片结果:\n<span class="subst">&#123;slice_result&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. 条件操作</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;\n=== 条件操作 ===&quot;</span>)</span><br><span class="line">arr = np.array([-<span class="number">2</span>, -<span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>], dtype=np.float32)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;原始数组: <span class="subst">&#123;arr&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 正数置零</span></span><br><span class="line">zero_positives = example.zero_positives(arr.copy())</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;正数置零: <span class="subst">&#123;zero_positives&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 绝对值</span></span><br><span class="line">abs_values = example.absolute_values(arr.copy())</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;绝对值: <span class="subst">&#123;abs_values&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4. 自定义数据类型</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;\n=== 自定义数据类型 ===&quot;</span>)</span><br><span class="line"><span class="comment"># 定义结构体数组</span></span><br><span class="line">dt = np.dtype([(<span class="string">&#x27;x&#x27;</span>, np.float32), (<span class="string">&#x27;y&#x27;</span>, np.float32), (<span class="string">&#x27;value&#x27;</span>, np.float32)])</span><br><span class="line">struct_array = np.array([(<span class="number">1</span>, <span class="number">2</span>, <span class="number">10</span>), (<span class="number">3</span>, <span class="number">4</span>, <span class="number">20</span>), (<span class="number">5</span>, <span class="number">6</span>, <span class="number">30</span>)], dtype=dt)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 处理结构体数组</span></span><br><span class="line">processed_struct = example.process_struct_array(struct_array)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;处理后的结构体数组: <span class="subst">&#123;processed_struct&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>
<h3 id="3-性能优化">3. 性能优化</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> example</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"></span><br><span class="line"><span class="comment"># 性能对比测试</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">performance_comparison</span>():</span><br><span class="line">    sizes = [<span class="number">1000</span>, <span class="number">10000</span>, <span class="number">100000</span>, <span class="number">1000000</span>, <span class="number">10000000</span>]</span><br><span class="line">    py_times = []</span><br><span class="line">    cpp_times = []</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> size <span class="keyword">in</span> sizes:</span><br><span class="line">        <span class="comment"># 生成测试数据</span></span><br><span class="line">        arr = np.random.rand(size).astype(np.float32)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># Python实现</span></span><br><span class="line">        start_time = time.time()</span><br><span class="line">        py_result = np.sqrt(arr)</span><br><span class="line">        py_time = time.time() - start_time</span><br><span class="line">        py_times.append(py_time)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># C++实现</span></span><br><span class="line">        start_time = time.time()</span><br><span class="line">        cpp_result = example.fast_sqrt(arr)</span><br><span class="line">        cpp_time = time.time() - start_time</span><br><span class="line">        cpp_times.append(cpp_time)</span><br><span class="line">        </span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;大小: <span class="subst">&#123;size:10d&#125;</span> | Python: <span class="subst">&#123;py_time:<span class="number">.6</span>f&#125;</span>s | C++: <span class="subst">&#123;cpp_time:<span class="number">.6</span>f&#125;</span>s | 加速比: <span class="subst">&#123;py_time/cpp_time:<span class="number">.2</span>f&#125;</span>x&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 绘制性能对比图</span></span><br><span class="line">    plt.figure(figsize=(<span class="number">10</span>, <span class="number">6</span>))</span><br><span class="line">    plt.plot(sizes, py_times, <span class="string">&#x27;o-&#x27;</span>, label=<span class="string">&#x27;Python (NumPy)&#x27;</span>)</span><br><span class="line">    plt.plot(sizes, cpp_times, <span class="string">&#x27;s-&#x27;</span>, label=<span class="string">&#x27;C++ (pybind11)&#x27;</span>)</span><br><span class="line">    plt.xscale(<span class="string">&#x27;log&#x27;</span>)</span><br><span class="line">    plt.yscale(<span class="string">&#x27;log&#x27;</span>)</span><br><span class="line">    plt.xlabel(<span class="string">&#x27;数组大小&#x27;</span>)</span><br><span class="line">    plt.ylabel(<span class="string">&#x27;时间 (秒)&#x27;</span>)</span><br><span class="line">    plt.title(<span class="string">&#x27;Python vs C++ 性能对比&#x27;</span>)</span><br><span class="line">    plt.legend()</span><br><span class="line">    plt.grid(<span class="literal">True</span>)</span><br><span class="line">    plt.savefig(<span class="string">&#x27;performance_comparison.png&#x27;</span>)</span><br><span class="line">    plt.close()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 内存带宽测试</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">memory_bandwidth_test</span>():</span><br><span class="line">    <span class="string">&quot;&quot;&quot;测试内存带宽性能&quot;&quot;&quot;</span></span><br><span class="line">    sizes = [<span class="number">1024</span> * <span class="number">1024</span> * i <span class="keyword">for</span> i <span class="keyword">in</span> [<span class="number">1</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">8</span>, <span class="number">16</span>, <span class="number">32</span>]]  <span class="comment"># 1MB到32MB</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> size <span class="keyword">in</span> sizes:</span><br><span class="line">        arr = np.random.rand(size).astype(np.float32)</span><br><span class="line">        bytes_processed = arr.nbytes</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># C++内存操作</span></span><br><span class="line">        start_time = time.time()</span><br><span class="line">        example.memory_intensive_operation(arr)</span><br><span class="line">        cpp_time = time.time() - start_time</span><br><span class="line">        </span><br><span class="line">        bandwidth = bytes_processed / cpp_time / <span class="number">1024</span> / <span class="number">1024</span> / <span class="number">1024</span>  <span class="comment"># GB/s</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;内存大小: <span class="subst">&#123;size/(<span class="number">1024</span>*<span class="number">1024</span>):<span class="number">4.0</span>f&#125;</span>MB | 带宽: <span class="subst">&#123;bandwidth:<span class="number">6.2</span>f&#125;</span> GB/s&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 运行性能测试</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;=== 性能对比测试 ===&quot;</span>)</span><br><span class="line">performance_comparison()</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;\n=== 内存带宽测试 ===&quot;</span>)</span><br><span class="line">memory_bandwidth_test()</span><br></pre></td></tr></table></figure>
<h2 id="多线程使用">多线程使用</h2>
<h3 id="1-基础多线程">1. 基础多线程</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> example</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> concurrent.futures</span><br><span class="line"></span><br><span class="line"><span class="comment"># 1. 使用threading模块</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;=== 使用threading模块 ===&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">worker_task</span>(<span class="params">task_id, delay</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;工作线程函数&quot;&quot;&quot;</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;任务 <span class="subst">&#123;task_id&#125;</span> 开始 (线程: <span class="subst">&#123;threading.current_thread().name&#125;</span>)&quot;</span>)</span><br><span class="line">    result = example.long_running_task(delay)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;任务 <span class="subst">&#123;task_id&#125;</span> 完成，结果: <span class="subst">&#123;result&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line"><span class="comment"># 启动多个线程</span></span><br><span class="line">threads = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>):</span><br><span class="line">    t = threading.Thread(target=worker_task, args=(i+<span class="number">1</span>, <span class="number">1</span>))</span><br><span class="line">    threads.append(t)</span><br><span class="line">    t.start()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 等待所有线程完成</span></span><br><span class="line"><span class="keyword">for</span> t <span class="keyword">in</span> threads:</span><br><span class="line">    t.join()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. 使用concurrent.futures</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;\n=== 使用concurrent.futures ===&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> concurrent.futures.ThreadPoolExecutor(max_workers=<span class="number">4</span>) <span class="keyword">as</span> executor:</span><br><span class="line">    <span class="comment"># 提交任务</span></span><br><span class="line">    futures = [executor.submit(example.process_data, i) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>)]</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 获取结果</span></span><br><span class="line">    <span class="keyword">for</span> future <span class="keyword">in</span> concurrent.futures.as_completed(futures):</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            result = future.result()</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;任务完成，结果: <span class="subst">&#123;result&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;任务失败: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. 线程安全的函数调用</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;\n=== 线程安全函数 ===&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">thread_safe_operation</span>(<span class="params">value</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;线程安全的操作&quot;&quot;&quot;</span></span><br><span class="line">    result = example.thread_safe_function(value)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;线程安全操作 <span class="subst">&#123;value&#125;</span> -&gt; <span class="subst">&#123;result&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用多个线程调用线程安全函数</span></span><br><span class="line"><span class="keyword">with</span> concurrent.futures.ThreadPoolExecutor(max_workers=<span class="number">5</span>) <span class="keyword">as</span> executor:</span><br><span class="line">    executor.<span class="built_in">map</span>(thread_safe_operation, <span class="built_in">range</span>(<span class="number">10</span>))</span><br></pre></td></tr></table></figure>
<h3 id="2-异步编程">2. 异步编程</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> example</span><br><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> concurrent.futures</span><br><span class="line"></span><br><span class="line"><span class="comment"># 1. 使用asyncio和线程池</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;=== asyncio和线程池 ===&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">async_task</span>(<span class="params">task_id, delay</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;异步任务&quot;&quot;&quot;</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;异步任务 <span class="subst">&#123;task_id&#125;</span> 开始&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 使用线程池执行C++函数</span></span><br><span class="line">    loop = asyncio.get_running_loop()</span><br><span class="line">    <span class="keyword">with</span> concurrent.futures.ThreadPoolExecutor() <span class="keyword">as</span> pool:</span><br><span class="line">        result = <span class="keyword">await</span> loop.run_in_executor(</span><br><span class="line">            pool, example.long_running_task, delay</span><br><span class="line">        )</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;异步任务 <span class="subst">&#123;task_id&#125;</span> 完成，结果: <span class="subst">&#123;result&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line"><span class="comment"># 运行多个异步任务</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    tasks = [async_task(i+<span class="number">1</span>, <span class="number">0.5</span>) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>)]</span><br><span class="line">    results = <span class="keyword">await</span> asyncio.gather(*tasks)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;所有异步任务完成，结果: <span class="subst">&#123;results&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 运行事件循环</span></span><br><span class="line">asyncio.run(main())</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. 异步生成器</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;\n=== 异步生成器 ===&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">async_generator</span>():</span><br><span class="line">    <span class="string">&quot;&quot;&quot;异步生成器，产生C++计算结果&quot;&quot;&quot;</span></span><br><span class="line">    loop = asyncio.get_running_loop()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">        <span class="comment"># 异步执行C++函数</span></span><br><span class="line">        result = <span class="keyword">await</span> loop.run_in_executor(</span><br><span class="line">            <span class="literal">None</span>, example.compute_value, i</span><br><span class="line">        )</span><br><span class="line">        <span class="keyword">yield</span> result</span><br><span class="line">        <span class="keyword">await</span> asyncio.sleep(<span class="number">0.1</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用异步生成器</span></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">consume_generator</span>():</span><br><span class="line">    <span class="keyword">async</span> <span class="keyword">for</span> result <span class="keyword">in</span> async_generator():</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;生成器产生: <span class="subst">&#123;result&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">asyncio.run(consume_generator())</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. 超时处理</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;\n=== 超时处理 ===&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">task_with_timeout</span>():</span><br><span class="line">    <span class="string">&quot;&quot;&quot;带超时的异步任务&quot;&quot;&quot;</span></span><br><span class="line">    loop = asyncio.get_running_loop()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="comment"># 设置超时</span></span><br><span class="line">        result = <span class="keyword">await</span> asyncio.wait_for(</span><br><span class="line">            loop.run_in_executor(<span class="literal">None</span>, example.long_running_task, <span class="number">2</span>),</span><br><span class="line">            timeout=<span class="number">1.0</span></span><br><span class="line">        )</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;任务完成: <span class="subst">&#123;result&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">except</span> asyncio.TimeoutError:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;任务超时&quot;</span>)</span><br><span class="line"></span><br><span class="line">asyncio.run(task_with_timeout())</span><br></pre></td></tr></table></figure>
<h3 id="3-线程安全和GIL管理">3. 线程安全和GIL管理</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> example</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> ctypes</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"><span class="comment"># 1. GIL状态检查</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;=== GIL状态检查 ===&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">check_gil_status</span>():</span><br><span class="line">    <span class="string">&quot;&quot;&quot;检查GIL状态&quot;&quot;&quot;</span></span><br><span class="line">    <span class="comment"># 获取当前线程状态</span></span><br><span class="line">    thread_state = sys._current_frames()[threading.get_ident()]</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;线程 <span class="subst">&#123;threading.current_thread().name&#125;</span>: GIL状态检查&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 在多个线程中检查GIL</span></span><br><span class="line">threads = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>):</span><br><span class="line">    t = threading.Thread(target=check_gil_status)</span><br><span class="line">    threads.append(t)</span><br><span class="line">    t.start()</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> t <span class="keyword">in</span> threads:</span><br><span class="line">    t.join()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. 释放GIL的C++函数</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;\n=== 释放GIL的C++函数 ===&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test_gil_release</span>():</span><br><span class="line">    <span class="string">&quot;&quot;&quot;测试C++函数释放GIL的效果&quot;&quot;&quot;</span></span><br><span class="line">    start_time = time.time()</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 启动多个线程执行释放GIL的C++函数</span></span><br><span class="line">    <span class="keyword">with</span> concurrent.futures.ThreadPoolExecutor(max_workers=<span class="number">4</span>) <span class="keyword">as</span> executor:</span><br><span class="line">        futures = [executor.submit(example.task_with_guard, i) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>)]</span><br><span class="line">        results = [future.result() <span class="keyword">for</span> future <span class="keyword">in</span> futures]</span><br><span class="line">    </span><br><span class="line">    total_time = time.time() - start_time</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;总耗时: <span class="subst">&#123;total_time:<span class="number">.2</span>f&#125;</span>秒 (理论串行时间: 4秒)&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;并行效率: <span class="subst">&#123;(<span class="number">4.0</span> / total_time):<span class="number">.2</span>f&#125;</span>x&quot;</span>)</span><br><span class="line"></span><br><span class="line">test_gil_release()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. 线程局部存储</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;\n=== 线程局部存储 ===&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Python线程局部存储</span></span><br><span class="line">thread_local = threading.local()</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">thread_local_task</span>(<span class="params">task_id</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;使用线程局部存储的任务&quot;&quot;&quot;</span></span><br><span class="line">    <span class="comment"># 设置线程局部数据</span></span><br><span class="line">    thread_local.task_id = task_id</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 调用C++函数</span></span><br><span class="line">    result = example.use_thread_local_data()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;线程 <span class="subst">&#123;task_id&#125;</span> 结果: <span class="subst">&#123;result&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 启动多个线程</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>):</span><br><span class="line">    threading.Thread(target=thread_local_task, args=(i,)).start()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4. 死锁预防</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;\n=== 死锁预防 ===&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">safe_concurrent_operations</span>():</span><br><span class="line">    <span class="string">&quot;&quot;&quot;安全的并发操作&quot;&quot;&quot;</span></span><br><span class="line">    <span class="comment"># 使用超时机制预防死锁</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        result = example.concurrent_operation_with_timeout(<span class="number">5.0</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;并发操作成功: <span class="subst">&#123;result&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">except</span> example.TimeoutError <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;并发操作超时: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 启动多个并发操作</span></span><br><span class="line"><span class="keyword">with</span> concurrent.futures.ThreadPoolExecutor(max_workers=<span class="number">3</span>) <span class="keyword">as</span> executor:</span><br><span class="line">    executor.submit(safe_concurrent_operations)</span><br><span class="line">    executor.submit(safe_concurrent_operations)</span><br><span class="line">    executor.submit(safe_concurrent_operations)</span><br></pre></td></tr></table></figure>
<h2 id="高级特性">高级特性</h2>
<h3 id="1-上下文管理器">1. 上下文管理器</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> example</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="comment"># 1. 使用C++实现的上下文管理器</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;=== C++上下文管理器 ===&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 计时器上下文管理器</span></span><br><span class="line"><span class="keyword">with</span> example.Timer() <span class="keyword">as</span> timer:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;执行一些操作...&quot;</span>)</span><br><span class="line">    time.sleep(<span class="number">1</span>)</span><br><span class="line">    timer.reset()</span><br><span class="line">    time.sleep(<span class="number">0.5</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;总耗时: <span class="subst">&#123;timer.elapsed_time():<span class="number">.3</span>f&#125;</span>秒&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. 文件操作上下文管理器</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;\n=== 文件操作上下文管理器 ===&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> example.FileHandler(<span class="string">&quot;test.txt&quot;</span>, <span class="string">&quot;w&quot;</span>) <span class="keyword">as</span> file:</span><br><span class="line">    file.write(<span class="string">&quot;Hello from Python!&quot;</span>)</span><br><span class="line">    file.write(<span class="string">&quot;\nThis is a test.&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 读取文件内容</span></span><br><span class="line"><span class="keyword">with</span> example.FileHandler(<span class="string">&quot;test.txt&quot;</span>, <span class="string">&quot;r&quot;</span>) <span class="keyword">as</span> file:</span><br><span class="line">    content = file.read()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;文件内容:\n<span class="subst">&#123;content&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. 数据库连接上下文管理器</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;\n=== 数据库连接上下文管理器 ===&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    <span class="keyword">with</span> example.DatabaseConnection(<span class="string">&quot;localhost&quot;</span>, <span class="string">&quot;user&quot;</span>, <span class="string">&quot;password&quot;</span>, <span class="string">&quot;testdb&quot;</span>) <span class="keyword">as</span> db:</span><br><span class="line">        result = db.query(<span class="string">&quot;SELECT * FROM users LIMIT 10&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;查询结果: <span class="subst">&#123;<span class="built_in">len</span>(result)&#125;</span> 条记录&quot;</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 事务处理</span></span><br><span class="line">        <span class="keyword">with</span> db.transaction():</span><br><span class="line">            db.execute(<span class="string">&quot;INSERT INTO logs (message) VALUES (?)&quot;</span>, [<span class="string">&quot;测试日志&quot;</span>])</span><br><span class="line">            db.execute(<span class="string">&quot;UPDATE stats SET count = count + 1&quot;</span>)</span><br><span class="line">    </span><br><span class="line"><span class="keyword">except</span> example.DatabaseError <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;数据库错误: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4. Python上下文管理器包装C++对象</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;\n=== Python包装C++对象 ===&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CppResourceManager</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;Python上下文管理器，包装C++资源&quot;&quot;&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, resource_name</span>):</span><br><span class="line">        <span class="variable language_">self</span>.resource = example.create_resource(resource_name)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__enter__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;获取资源...&quot;</span>)</span><br><span class="line">        <span class="variable language_">self</span>.resource.acquire()</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.resource</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__exit__</span>(<span class="params">self, exc_type, exc_val, exc_tb</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;释放资源...&quot;</span>)</span><br><span class="line">        <span class="variable language_">self</span>.resource.release()</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span>  <span class="comment"># 不抑制异常</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用自定义上下文管理器</span></span><br><span class="line"><span class="keyword">with</span> CppResourceManager(<span class="string">&quot;test_resource&quot;</span>) <span class="keyword">as</span> resource:</span><br><span class="line">    resource.process_data([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>])</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;资源状态: <span class="subst">&#123;resource.get_status()&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>
<h3 id="2-迭代器和生成器">2. 迭代器和生成器</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> example</span><br><span class="line"></span><br><span class="line"><span class="comment"># 1. C++迭代器</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;=== C++迭代器 ===&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 数字序列迭代器</span></span><br><span class="line">sequence = example.NumberSequence(<span class="number">1</span>, <span class="number">5</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用for循环</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;使用for循环:&quot;</span>)</span><br><span class="line"><span class="keyword">for</span> num <span class="keyword">in</span> sequence:</span><br><span class="line">    <span class="built_in">print</span>(num)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 手动迭代</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;\n手动迭代:&quot;</span>)</span><br><span class="line">it = <span class="built_in">iter</span>(sequence)</span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="built_in">next</span>(it))</span><br><span class="line">    <span class="keyword">except</span> StopIteration:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. 无限迭代器</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;\n=== 无限迭代器 ===&quot;</span>)</span><br><span class="line"></span><br><span class="line">fibonacci = example.FibonacciGenerator()</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;斐波那契数列前10项:&quot;</span>)</span><br><span class="line"><span class="keyword">for</span> i, num <span class="keyword">in</span> <span class="built_in">enumerate</span>(fibonacci):</span><br><span class="line">    <span class="keyword">if</span> i &gt;= <span class="number">10</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="built_in">print</span>(num, end=<span class="string">&quot; &quot;</span>)</span><br><span class="line"><span class="built_in">print</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. 过滤迭代器</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;\n=== 过滤迭代器 ===&quot;</span>)</span><br><span class="line"></span><br><span class="line">numbers = example.NumberSequence(<span class="number">1</span>, <span class="number">20</span>)</span><br><span class="line">even_numbers = example.FilteredIterator(numbers, <span class="keyword">lambda</span> x: x % <span class="number">2</span> == <span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;1-20中的偶数:&quot;</span>)</span><br><span class="line"><span class="keyword">for</span> num <span class="keyword">in</span> even_numbers:</span><br><span class="line">    <span class="built_in">print</span>(num, end=<span class="string">&quot; &quot;</span>)</span><br><span class="line"><span class="built_in">print</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4. 转换迭代器</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;\n=== 转换迭代器 ===&quot;</span>)</span><br><span class="line"></span><br><span class="line">squares = example.TransformedIterator(numbers, <span class="keyword">lambda</span> x: x * x)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;1-20的平方:&quot;</span>)</span><br><span class="line"><span class="keyword">for</span> num <span class="keyword">in</span> squares:</span><br><span class="line">    <span class="built_in">print</span>(num, end=<span class="string">&quot; &quot;</span>)</span><br><span class="line"><span class="built_in">print</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 5. Python生成器包装C++迭代器</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;\n=== Python生成器包装 ===&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">cpp_iterator_to_generator</span>(<span class="params">cpp_iterator</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;将C++迭代器转换为Python生成器&quot;&quot;&quot;</span></span><br><span class="line">    it = <span class="built_in">iter</span>(cpp_iterator)</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">yield</span> <span class="built_in">next</span>(it)</span><br><span class="line">        <span class="keyword">except</span> StopIteration:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用生成器</span></span><br><span class="line">generator = cpp_iterator_to_generator(example.NumberSequence(<span class="number">1</span>, <span class="number">10</span>))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;生成器输出:&quot;</span>)</span><br><span class="line"><span class="keyword">for</span> num <span class="keyword">in</span> generator:</span><br><span class="line">    <span class="built_in">print</span>(num, end=<span class="string">&quot; &quot;</span>)</span><br><span class="line"><span class="built_in">print</span>()</span><br></pre></td></tr></table></figure>
<h3 id="3-装饰器">3. 装饰器</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> example</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> functools</span><br><span class="line"></span><br><span class="line"><span class="comment"># 1. C++实现的装饰器</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;=== C++装饰器 ===&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@example.timer</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">slow_function</span>():</span><br><span class="line">    <span class="string">&quot;&quot;&quot;测试函数&quot;&quot;&quot;</span></span><br><span class="line">    time.sleep(<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;完成&quot;</span></span><br><span class="line"></span><br><span class="line">result = slow_function()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;函数结果: <span class="subst">&#123;result&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. 缓存装饰器</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;\n=== 缓存装饰器 ===&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@example.memoize</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">expensive_computation</span>(<span class="params">x, y</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;耗时计算&quot;&quot;&quot;</span></span><br><span class="line">    time.sleep(<span class="number">0.5</span>)</span><br><span class="line">    <span class="keyword">return</span> x * y + x + y</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;第一次调用:&quot;</span>)</span><br><span class="line">result1 = expensive_computation(<span class="number">3</span>, <span class="number">4</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;结果: <span class="subst">&#123;result1&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;第二次调用（应该缓存）:&quot;</span>)</span><br><span class="line">result2 = expensive_computation(<span class="number">3</span>, <span class="number">4</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;结果: <span class="subst">&#123;result2&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. 权限检查装饰器</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;\n=== 权限检查装饰器 ===&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@example.require_permission(<span class="params"><span class="string">&quot;admin&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">admin_operation</span>():</span><br><span class="line">    <span class="string">&quot;&quot;&quot;管理员操作&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;执行管理员操作&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    result = admin_operation()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;操作结果: <span class="subst">&#123;result&#125;</span>&quot;</span>)</span><br><span class="line"><span class="keyword">except</span> example.PermissionError <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;权限错误: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4. Python装饰器包装C++函数</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;\n=== Python装饰器包装C++函数 ===&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">python_decorator</span>(<span class="params">func</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;Python装饰器&quot;&quot;&quot;</span></span><br><span class="line"><span class="meta">    @functools.wraps(<span class="params">func</span>)</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">wrapper</span>(<span class="params">*args, **kwargs</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;Python装饰器: 调用 <span class="subst">&#123;func.__name__&#125;</span>&quot;</span>)</span><br><span class="line">        start_time = time.time()</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            result = func(*args, **kwargs)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;Python装饰器: 成功返回&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span> result</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;Python装饰器: 捕获异常 <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="keyword">raise</span></span><br><span class="line">        <span class="keyword">finally</span>:</span><br><span class="line">            end_time = time.time()</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;Python装饰器: 耗时 <span class="subst">&#123;end_time - start_time:<span class="number">.6</span>f&#125;</span>秒&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> wrapper</span><br><span class="line"></span><br><span class="line"><span class="comment"># 包装C++函数</span></span><br><span class="line">wrapped_function = python_decorator(example.long_running_task)</span><br><span class="line">result = wrapped_function(<span class="number">0.5</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;包装函数结果: <span class="subst">&#123;result&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 5. 装饰器链</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;\n=== 装饰器链 ===&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@python_decorator</span></span><br><span class="line"><span class="meta">@example.timer</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">decorated_function</span>():</span><br><span class="line">    <span class="string">&quot;&quot;&quot;使用多个装饰器&quot;&quot;&quot;</span></span><br><span class="line">    time.sleep(<span class="number">0.3</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;多重装饰&quot;</span></span><br><span class="line"></span><br><span class="line">result = decorated_function()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;最终结果: <span class="subst">&#123;result&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>
<h2 id="性能优化">性能优化</h2>
<h3 id="1-内存优化">1. 内存优化</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> example</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> gc</span><br><span class="line"></span><br><span class="line"><span class="comment"># 1. 内存使用分析</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;=== 内存使用分析 ===&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">memory_usage</span>(<span class="params">obj</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;计算对象内存使用&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">return</span> sys.getsizeof(obj)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 测试不同类型的内存使用</span></span><br><span class="line">cpp_obj = example.LargeObject()</span><br><span class="line">py_obj = &#123;<span class="string">&quot;data&quot;</span>: [i <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">100000</span>)]&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;C++对象内存: <span class="subst">&#123;memory_usage(cpp_obj)&#125;</span> bytes&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;Python对象内存: <span class="subst">&#123;memory_usage(py_obj)&#125;</span> bytes&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. 避免数据复制</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;\n=== 避免数据复制 ===&quot;</span>)</span><br><span class="line"></span><br><span class="line">large_array = np.random.rand(<span class="number">1_000_000</span>).astype(np.float32)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;大数组大小: <span class="subst">&#123;large_array.nbytes / <span class="number">1024</span> / <span class="number">1024</span>:<span class="number">.2</span>f&#125;</span> MB&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用视图而不是复制</span></span><br><span class="line">result_view = example.process_array_view(large_array)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;是否共享内存: <span class="subst">&#123;np.shares_memory(large_array, result_view)&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. 对象池模式</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;\n=== 对象池模式 ===&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用C++对象池</span></span><br><span class="line">pool = example.ObjectPool()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 从池中获取对象</span></span><br><span class="line">obj1 = pool.acquire()</span><br><span class="line">obj2 = pool.acquire()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用对象</span></span><br><span class="line">obj1.set_value(<span class="number">100</span>)</span><br><span class="line">obj2.set_value(<span class="number">200</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;对象1值: <span class="subst">&#123;obj1.get_value()&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;对象2值: <span class="subst">&#123;obj2.get_value()&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 释放对象回池</span></span><br><span class="line">pool.release(obj1)</span><br><span class="line">pool.release(obj2)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4. 垃圾回收优化</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;\n=== 垃圾回收优化 ===&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 禁用自动垃圾回收</span></span><br><span class="line">gc.disable()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建大量C++对象</span></span><br><span class="line">objects = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10000</span>):</span><br><span class="line">    obj = example.MyObject(i)</span><br><span class="line">    objects.append(obj)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 手动垃圾回收</span></span><br><span class="line">gc.collect()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 释放对象引用</span></span><br><span class="line"><span class="keyword">del</span> objects</span><br><span class="line">gc.collect()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 重新启用自动垃圾回收</span></span><br><span class="line">gc.enable()</span><br></pre></td></tr></table></figure>
<h3 id="2-计算优化">2. 计算优化</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> example</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> numba</span><br><span class="line"></span><br><span class="line"><span class="comment"># 1. 算法优化对比</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;=== 算法优化对比 ===&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">benchmark_function</span>(<span class="params">name, func, *args, **kwargs</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;基准测试函数&quot;&quot;&quot;</span></span><br><span class="line">    start_time = time.time()</span><br><span class="line">    result = func(*args, **kwargs)</span><br><span class="line">    end_time = time.time()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;name&#125;</span>: <span class="subst">&#123;end_time - start_time:<span class="number">.6</span>f&#125;</span>秒&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line"><span class="comment"># 测试数据</span></span><br><span class="line">data = np.random.rand(<span class="number">1_000_000</span>).astype(np.float32)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Python实现</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">python_algorithm</span>(<span class="params">arr</span>):</span><br><span class="line">    <span class="keyword">return</span> np.sqrt(arr) + np.sin(arr) * np.cos(arr)</span><br><span class="line"></span><br><span class="line"><span class="comment"># C++实现</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">cpp_algorithm</span>(<span class="params">arr</span>):</span><br><span class="line">    <span class="keyword">return</span> example.optimized_algorithm(arr)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Numba JIT实现</span></span><br><span class="line"><span class="meta">@numba.jit(<span class="params">nopython=<span class="literal">True</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">numba_algorithm</span>(<span class="params">arr</span>):</span><br><span class="line">    result = np.empty_like(arr)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(arr)):</span><br><span class="line">        result[i] = np.sqrt(arr[i]) + np.sin(arr[i]) * np.cos(arr[i])</span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line"><span class="comment"># 预热numba</span></span><br><span class="line">numba_algorithm(data[:<span class="number">100</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># 运行基准测试</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;=== 算法性能对比 ===&quot;</span>)</span><br><span class="line">benchmark_function(<span class="string">&quot;Python (NumPy)&quot;</span>, python_algorithm, data)</span><br><span class="line">benchmark_function(<span class="string">&quot;C++ (pybind11)&quot;</span>, cpp_algorithm, data)</span><br><span class="line">benchmark_function(<span class="string">&quot;Numba JIT&quot;</span>, numba_algorithm, data)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. 批量处理</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;\n=== 批量处理优化 ===&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 小批量处理</span></span><br><span class="line">small_batches = [np.random.rand(<span class="number">1000</span>).astype(np.float32) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1000</span>)]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 逐个处理</span></span><br><span class="line">start_time = time.time()</span><br><span class="line"><span class="keyword">for</span> batch <span class="keyword">in</span> small_batches:</span><br><span class="line">    example.process_batch(batch)</span><br><span class="line">single_time = time.time() - start_time</span><br><span class="line"></span><br><span class="line"><span class="comment"># 批量处理（一次处理所有）</span></span><br><span class="line">all_data = np.concatenate(small_batches)</span><br><span class="line">start_time = time.time()</span><br><span class="line">example.process_batch(all_data)</span><br><span class="line">batch_time = time.time() - start_time</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;逐个处理: <span class="subst">&#123;single_time:<span class="number">.6</span>f&#125;</span>秒&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;批量处理: <span class="subst">&#123;batch_time:<span class="number">.6</span>f&#125;</span>秒&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;批量优化: <span class="subst">&#123;single_time / batch_time:<span class="number">.2</span>f&#125;</span>x&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. 并行计算</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;\n=== 并行计算 ===&quot;</span>)</span><br><span class="line"></span><br><span class="line">large_data = np.random.rand(<span class="number">10_000_000</span>).astype(np.float32)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 单线程处理</span></span><br><span class="line">start_time = time.time()</span><br><span class="line">result_single = example.single_threaded_processing(large_data)</span><br><span class="line">single_time = time.time() - start_time</span><br><span class="line"></span><br><span class="line"><span class="comment"># 多线程处理</span></span><br><span class="line">start_time = time.time()</span><br><span class="line">result_multi = example.multi_threaded_processing(large_data)</span><br><span class="line">multi_time = time.time() - start_time</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;单线程: <span class="subst">&#123;single_time:<span class="number">.6</span>f&#125;</span>秒&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;多线程: <span class="subst">&#123;multi_time:<span class="number">.6</span>f&#125;</span>秒&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;并行加速: <span class="subst">&#123;single_time / multi_time:<span class="number">.2</span>f&#125;</span>x&quot;</span>)</span><br></pre></td></tr></table></figure>
<h3 id="3-缓存策略">3. 缓存策略</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> example</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> functools</span><br><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> timedelta</span><br><span class="line"></span><br><span class="line"><span class="comment"># 1. 内存缓存</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;=== 内存缓存 ===&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># C++实现的缓存</span></span><br><span class="line"><span class="meta">@example.memoize(<span class="params">max_size=<span class="number">1000</span>, timeout=<span class="number">300</span></span>)  </span><span class="comment"># 最大1000项，超时300秒</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">expensive_calculation</span>(<span class="params">x, y</span>):</span><br><span class="line">    time.sleep(<span class="number">0.1</span>)  <span class="comment"># 模拟耗时计算</span></span><br><span class="line">    <span class="keyword">return</span> x * y + x + y</span><br><span class="line"></span><br><span class="line"><span class="comment"># 测试缓存效果</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;第一次调用（无缓存）:&quot;</span>)</span><br><span class="line">result1 = expensive_calculation(<span class="number">10</span>, <span class="number">20</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;结果: <span class="subst">&#123;result1&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;第二次调用（有缓存）:&quot;</span>)</span><br><span class="line">result2 = expensive_calculation(<span class="number">10</span>, <span class="number">20</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;结果: <span class="subst">&#123;result2&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. 磁盘缓存</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;\n=== 磁盘缓存 ===&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">DiskCache</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;磁盘缓存类&quot;&quot;&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, cache_dir=<span class="string">&quot;cache&quot;</span></span>):</span><br><span class="line">        <span class="variable language_">self</span>.cache_dir = cache_dir</span><br><span class="line">        <span class="keyword">import</span> os</span><br><span class="line">        os.makedirs(cache_dir, exist_ok=<span class="literal">True</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_key</span>(<span class="params">self, func, *args, **kwargs</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;生成缓存键&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">import</span> hashlib</span><br><span class="line">        key = <span class="string">f&quot;<span class="subst">&#123;func.__name__&#125;</span>:<span class="subst">&#123;args&#125;</span>:<span class="subst">&#123;kwargs&#125;</span>&quot;</span></span><br><span class="line">        <span class="keyword">return</span> hashlib.md5(key.encode()).hexdigest()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">cache</span>(<span class="params">self, func</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;缓存装饰器&quot;&quot;&quot;</span></span><br><span class="line"><span class="meta">        @functools.wraps(<span class="params">func</span>)</span></span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">wrapper</span>(<span class="params">*args, **kwargs</span>):</span><br><span class="line">            key = <span class="variable language_">self</span>.get_key(func, *args, **kwargs)</span><br><span class="line">            cache_file = <span class="string">f&quot;<span class="subst">&#123;self.cache_dir&#125;</span>/<span class="subst">&#123;key&#125;</span>.pkl&quot;</span></span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 检查缓存是否存在</span></span><br><span class="line">            <span class="keyword">import</span> os</span><br><span class="line">            <span class="keyword">if</span> os.path.exists(cache_file):</span><br><span class="line">                <span class="keyword">try</span>:</span><br><span class="line">                    <span class="keyword">with</span> <span class="built_in">open</span>(cache_file, <span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">                        <span class="keyword">return</span> pickle.load(f)</span><br><span class="line">                <span class="keyword">except</span>:</span><br><span class="line">                    <span class="keyword">pass</span></span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 执行函数并缓存结果</span></span><br><span class="line">            result = func(*args, **kwargs)</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                <span class="keyword">with</span> <span class="built_in">open</span>(cache_file, <span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">                    pickle.dump(result, f)</span><br><span class="line">            <span class="keyword">except</span>:</span><br><span class="line">                <span class="keyword">pass</span></span><br><span class="line">            </span><br><span class="line">            <span class="keyword">return</span> result</span><br><span class="line">        <span class="keyword">return</span> wrapper</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用磁盘缓存</span></span><br><span class="line">disk_cache = DiskCache()</span><br><span class="line"></span><br><span class="line"><span class="meta">@disk_cache.cache</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">disk_cached_function</span>(<span class="params">data</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;磁盘缓存的函数&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">return</span> example.process_large_data(data)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. 分层缓存</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;\n=== 分层缓存 ===&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TieredCache</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;分层缓存（内存+磁盘）&quot;&quot;&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.memory_cache = &#123;&#125;</span><br><span class="line">        <span class="variable language_">self</span>.disk_cache = DiskCache()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">cache</span>(<span class="params">self, func</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;分层缓存装饰器&quot;&quot;&quot;</span></span><br><span class="line"><span class="meta">        @functools.wraps(<span class="params">func</span>)</span></span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">wrapper</span>(<span class="params">*args, **kwargs</span>):</span><br><span class="line">            key = <span class="variable language_">self</span>.disk_cache.get_key(func, *args, **kwargs)</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 1. 检查内存缓存</span></span><br><span class="line">            <span class="keyword">if</span> key <span class="keyword">in</span> <span class="variable language_">self</span>.memory_cache:</span><br><span class="line">                <span class="keyword">return</span> <span class="variable language_">self</span>.memory_cache[key]</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 2. 检查磁盘缓存</span></span><br><span class="line">            disk_wrapper = <span class="variable language_">self</span>.disk_cache.cache(func)</span><br><span class="line">            result = disk_wrapper(*args, **kwargs)</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 3. 更新内存缓存</span></span><br><span class="line">            <span class="variable language_">self</span>.memory_cache[key] = result</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 限制内存缓存大小</span></span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">len</span>(<span class="variable language_">self</span>.memory_cache) &gt; <span class="number">100</span>:</span><br><span class="line">                <span class="variable language_">self</span>.memory_cache.pop(<span class="built_in">next</span>(<span class="built_in">iter</span>(<span class="variable language_">self</span>.memory_cache)))</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">return</span> result</span><br><span class="line">        <span class="keyword">return</span> wrapper</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用分层缓存</span></span><br><span class="line">tiered_cache = TieredCache()</span><br><span class="line"></span><br><span class="line"><span class="meta">@tiered_cache.cache</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">tiered_cached_function</span>(<span class="params">data</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;分层缓存的函数&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">return</span> example.process_large_data(data)</span><br></pre></td></tr></table></figure>
<h2 id="调试技巧">调试技巧</h2>
<h3 id="1-基本调试">1. 基本调试</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> example</span><br><span class="line"><span class="keyword">import</span> pdb</span><br><span class="line"><span class="keyword">import</span> traceback</span><br><span class="line"></span><br><span class="line"><span class="comment"># 1. 使用print调试</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;=== Print调试 ===&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">debug_with_print</span>():</span><br><span class="line">    <span class="string">&quot;&quot;&quot;使用print语句调试&quot;&quot;&quot;</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;开始执行函数&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 打印变量值</span></span><br><span class="line">    x = <span class="number">10</span></span><br><span class="line">    y = <span class="number">20</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;x = <span class="subst">&#123;x&#125;</span>, y = <span class="subst">&#123;y&#125;</span>&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 调用C++函数</span></span><br><span class="line">    result = example.add(x, y)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;example.add(<span class="subst">&#123;x&#125;</span>, <span class="subst">&#123;y&#125;</span>) = <span class="subst">&#123;result&#125;</span>&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;函数执行完成&quot;</span>)</span><br><span class="line"></span><br><span class="line">debug_with_print()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. 使用pdb调试器</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;\n=== PDB调试器 ===&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">debug_with_pdb</span>():</span><br><span class="line">    <span class="string">&quot;&quot;&quot;使用pdb调试器&quot;&quot;&quot;</span></span><br><span class="line">    x = <span class="number">5</span></span><br><span class="line">    y = <span class="number">3</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 设置断点</span></span><br><span class="line">    pdb.set_trace()</span><br><span class="line">    </span><br><span class="line">    result = example.divide(x, y)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;结果: <span class="subst">&#123;result&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. 异常追踪</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;\n=== 异常追踪 ===&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">debug_exceptions</span>():</span><br><span class="line">    <span class="string">&quot;&quot;&quot;异常调试&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        result = example.divide(<span class="number">10</span>, <span class="number">0</span>)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;捕获异常: <span class="subst">&#123;<span class="built_in">type</span>(e).__name__&#125;</span>: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;异常追踪:&quot;</span>)</span><br><span class="line">        traceback.print_exc()</span><br><span class="line"></span><br><span class="line">debug_exceptions()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4. 断言调试</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;\n=== 断言调试 ===&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">debug_with_assertions</span>():</span><br><span class="line">    <span class="string">&quot;&quot;&quot;使用断言调试&quot;&quot;&quot;</span></span><br><span class="line">    x = <span class="number">10</span></span><br><span class="line">    y = <span class="number">20</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 断言检查</span></span><br><span class="line">    <span class="keyword">assert</span> x &gt; <span class="number">0</span>, <span class="string">&quot;x必须为正数&quot;</span></span><br><span class="line">    <span class="keyword">assert</span> y &gt; <span class="number">0</span>, <span class="string">&quot;y必须为正数&quot;</span></span><br><span class="line">    </span><br><span class="line">    result = example.multiply(x, y)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 结果检查</span></span><br><span class="line">    <span class="keyword">assert</span> result == x * y, <span class="string">f&quot;乘法结果错误: <span class="subst">&#123;result&#125;</span> != <span class="subst">&#123;x&#125;</span> * <span class="subst">&#123;y&#125;</span>&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;调试完成，结果正确: <span class="subst">&#123;result&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">debug_with_assertions()</span><br></pre></td></tr></table></figure>
<h3 id="2-高级调试技巧">2. 高级调试技巧</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> example</span><br><span class="line"><span class="keyword">import</span> inspect</span><br><span class="line"><span class="keyword">import</span> cProfile</span><br><span class="line"><span class="keyword">import</span> pstats</span><br><span class="line"><span class="keyword">import</span> line_profiler</span><br><span class="line"><span class="keyword">import</span> memory_profiler</span><br><span class="line"></span><br><span class="line"><span class="comment"># 1. 函数签名检查</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;=== 函数签名检查 ===&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">inspect_function</span>(<span class="params">func_name</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;检查函数签名&quot;&quot;&quot;</span></span><br><span class="line">    func = <span class="built_in">getattr</span>(example, func_name)</span><br><span class="line">    sig = inspect.signature(func)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;函数 <span class="subst">&#123;func_name&#125;</span> 签名: <span class="subst">&#123;sig&#125;</span>&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 检查返回类型</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">hasattr</span>(func, <span class="string">&#x27;__annotations__&#x27;</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;返回类型: <span class="subst">&#123;func.__annotations__.get(<span class="string">&#x27;return&#x27;</span>, <span class="string">&#x27;unknown&#x27;</span>)&#125;</span>&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 检查文档字符串</span></span><br><span class="line">    <span class="keyword">if</span> func.__doc__:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;文档字符串: <span class="subst">&#123;func.__doc__&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">inspect_function(<span class="string">&quot;add&quot;</span>)</span><br><span class="line">inspect_function(<span class="string">&quot;multiply&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. 性能分析</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;\n=== 性能分析 ===&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">profile_performance</span>():</span><br><span class="line">    <span class="string">&quot;&quot;&quot;性能分析&quot;&quot;&quot;</span></span><br><span class="line">    <span class="comment"># 使用cProfile进行性能分析</span></span><br><span class="line">    cProfile.runctx(</span><br><span class="line">        <span class="string">&quot;example.process_large_data(data)&quot;</span>,</span><br><span class="line">        <span class="built_in">globals</span>(),</span><br><span class="line">        &#123;<span class="string">&quot;data&quot;</span>: [i <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">100000</span>)]&#125;,</span><br><span class="line">        <span class="string">&quot;profile_results&quot;</span></span><br><span class="line">    )</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 分析结果</span></span><br><span class="line">    stats = pstats.Stats(<span class="string">&quot;profile_results&quot;</span>)</span><br><span class="line">    stats.sort_stats(pstats.SortKey.TIME).print_stats(<span class="number">10</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. 行级性能分析</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;\n=== 行级性能分析 ===&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@line_profiler.profile</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">line_profile_example</span>():</span><br><span class="line">    <span class="string">&quot;&quot;&quot;行级性能分析示例&quot;&quot;&quot;</span></span><br><span class="line">    data = [i <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10000</span>)]</span><br><span class="line">    result1 = example.process_batch(data)</span><br><span class="line">    result2 = example.another_operation(result1)</span><br><span class="line">    <span class="keyword">return</span> result2</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4. 内存分析</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;\n=== 内存分析 ===&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@memory_profiler.profile</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">memory_profile_example</span>():</span><br><span class="line">    <span class="string">&quot;&quot;&quot;内存分析示例&quot;&quot;&quot;</span></span><br><span class="line">    large_data = [i <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1000000</span>)]</span><br><span class="line">    result = example.process_large_data(large_data)</span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line"><span class="comment"># 5. 远程调试</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;\n=== 远程调试 ===&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">setup_remote_debugging</span>():</span><br><span class="line">    <span class="string">&quot;&quot;&quot;设置远程调试&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">import</span> ptvsd</span><br><span class="line">        ptvsd.enable_attach(address=(<span class="string">&#x27;0.0.0.0&#x27;</span>, <span class="number">5678</span>))</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;远程调试已启用，等待连接...&quot;</span>)</span><br><span class="line">    <span class="keyword">except</span> ImportError:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;ptvsd未安装，无法启用远程调试&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 6. 日志调试</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;\n=== 日志调试 ===&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">setup_logging</span>():</span><br><span class="line">    <span class="string">&quot;&quot;&quot;设置日志系统&quot;&quot;&quot;</span></span><br><span class="line">    logging.basicConfig(</span><br><span class="line">        level=logging.DEBUG,</span><br><span class="line">        <span class="built_in">format</span>=<span class="string">&#x27;%(asctime)s - %(name)s - %(levelname)s - %(message)s&#x27;</span>,</span><br><span class="line">        handlers=[</span><br><span class="line">            logging.FileHandler(<span class="string">&quot;debug.log&quot;</span>),</span><br><span class="line">            logging.StreamHandler()</span><br><span class="line">        ]</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">debug_with_logging</span>():</span><br><span class="line">    <span class="string">&quot;&quot;&quot;使用日志调试&quot;&quot;&quot;</span></span><br><span class="line">    logger = logging.getLogger(__name__)</span><br><span class="line">    </span><br><span class="line">    logger.debug(<span class="string">&quot;开始执行调试函数&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        result = example.divide(<span class="number">10</span>, <span class="number">2</span>)</span><br><span class="line">        logger.info(<span class="string">f&quot;除法结果: <span class="subst">&#123;result&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        logger.error(<span class="string">f&quot;执行失败: <span class="subst">&#123;e&#125;</span>&quot;</span>, exc_info=<span class="literal">True</span>)</span><br><span class="line">    </span><br><span class="line">    logger.debug(<span class="string">&quot;调试函数执行完成&quot;</span>)</span><br></pre></td></tr></table></figure>
<h3 id="3-C-扩展调试">3. C++扩展调试</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> example</span><br><span class="line"><span class="keyword">import</span> ctypes</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"><span class="comment"># 1. 类型检查</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;=== 类型检查 ===&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">check_types</span>():</span><br><span class="line">    <span class="string">&quot;&quot;&quot;检查C++扩展的类型信息&quot;&quot;&quot;</span></span><br><span class="line">    <span class="comment"># 检查模块类型</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;example模块类型: <span class="subst">&#123;<span class="built_in">type</span>(example)&#125;</span>&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 检查函数类型</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;example.add类型: <span class="subst">&#123;<span class="built_in">type</span>(example.add)&#125;</span>&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 检查类类型</span></span><br><span class="line">    obj = example.Pet(<span class="string">&quot;测试&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;Pet对象类型: <span class="subst">&#123;<span class="built_in">type</span>(obj)&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;Pet对象MRO: <span class="subst">&#123;<span class="built_in">type</span>(obj).__mro__&#125;</span>&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 检查属性</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;obj是否有name属性: <span class="subst">&#123;<span class="built_in">hasattr</span>(obj, <span class="string">&#x27;name&#x27;</span>)&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;obj是否有get_name方法: <span class="subst">&#123;<span class="built_in">hasattr</span>(obj, <span class="string">&#x27;get_name&#x27;</span>)&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">check_types()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. 内存地址检查</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;\n=== 内存地址检查 ===&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">check_memory_addresses</span>():</span><br><span class="line">    <span class="string">&quot;&quot;&quot;检查对象内存地址&quot;&quot;&quot;</span></span><br><span class="line">    obj1 = example.Pet(<span class="string">&quot;宠物1&quot;</span>)</span><br><span class="line">    obj2 = example.Pet(<span class="string">&quot;宠物2&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 获取内存地址（仅限CPython）</span></span><br><span class="line">    <span class="keyword">if</span> sys.implementation.name == <span class="string">&#x27;cpython&#x27;</span>:</span><br><span class="line">        addr1 = <span class="built_in">id</span>(obj1)</span><br><span class="line">        addr2 = <span class="built_in">id</span>(obj2)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;obj1内存地址: 0x<span class="subst">&#123;addr1:x&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;obj2内存地址: 0x<span class="subst">&#123;addr2:x&#125;</span>&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 检查对象是否相同</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;obj1 is obj2: <span class="subst">&#123;obj1 <span class="keyword">is</span> obj2&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">check_memory_addresses()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. 扩展模块信息</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;\n=== 扩展模块信息 ===&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_module_info</span>():</span><br><span class="line">    <span class="string">&quot;&quot;&quot;获取扩展模块信息&quot;&quot;&quot;</span></span><br><span class="line">    <span class="comment"># 模块文件路径</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;模块文件: <span class="subst">&#123;example.__file__&#125;</span>&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 模块文档</span></span><br><span class="line">    <span class="keyword">if</span> example.__doc__:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;模块文档: <span class="subst">&#123;example.__doc__&#125;</span>&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 模块属性</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;模块属性:&quot;</span>)</span><br><span class="line">    <span class="keyword">for</span> attr <span class="keyword">in</span> <span class="built_in">dir</span>(example):</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> attr.startswith(<span class="string">&#x27;_&#x27;</span>):</span><br><span class="line">            attr_value = <span class="built_in">getattr</span>(example, attr)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;  <span class="subst">&#123;attr&#125;</span>: <span class="subst">&#123;<span class="built_in">type</span>(attr_value).__name__&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">get_module_info()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4. 错误处理调试</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;\n=== 错误处理调试 ===&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">debug_error_handling</span>():</span><br><span class="line">    <span class="string">&quot;&quot;&quot;调试错误处理&quot;&quot;&quot;</span></span><br><span class="line">    <span class="comment"># 测试各种错误情况</span></span><br><span class="line">    test_cases = [</span><br><span class="line">        (example.divide, (<span class="number">10</span>, <span class="number">0</span>), <span class="string">&quot;DivisionByZeroError&quot;</span>),</span><br><span class="line">        (example.validate_positive, (-<span class="number">5</span>,), <span class="string">&quot;InvalidInputError&quot;</span>),</span><br><span class="line">        (example.process_array, (<span class="string">&quot;not an array&quot;</span>,), <span class="string">&quot;TypeError&quot;</span>),</span><br><span class="line">    ]</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> func, args, expected_error <span class="keyword">in</span> test_cases:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            func(*args)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;func.__name__&#125;</span><span class="subst">&#123;args&#125;</span> 未抛出预期的<span class="subst">&#123;expected_error&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;func.__name__&#125;</span><span class="subst">&#123;args&#125;</span> 抛出 <span class="subst">&#123;<span class="built_in">type</span>(e).__name__&#125;</span>: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="comment"># 检查异常类型层次</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;  异常MRO: <span class="subst">&#123;[base.__name__ <span class="keyword">for</span> base <span class="keyword">in</span> <span class="built_in">type</span>(e).__mro__]&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>
<h2 id="最佳实践">最佳实践</h2>
<h3 id="1-代码组织">1. 代码组织</h3>
<p><strong>推荐的项目结构：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">python_project/</span><br><span class="line">├── src/</span><br><span class="line">│   └── my_package/</span><br><span class="line">│       ├── __init__.py</span><br><span class="line">│       ├── core.py          # Python包装器</span><br><span class="line">│       ├── utils.py         # 工具函数</span><br><span class="line">│       └── _cpp_extension.so  # C++扩展模块</span><br><span class="line">├── cpp/</span><br><span class="line">│   ├── bindings/</span><br><span class="line">│   │   └── extension.cpp   # pybind11绑定代码</span><br><span class="line">│   ├── include/</span><br><span class="line">│   │   └── my_module/</span><br><span class="line">│   │       └── algorithms.h</span><br><span class="line">│   └── src/</span><br><span class="line">│       └── algorithms.cpp</span><br><span class="line">├── tests/</span><br><span class="line">│   ├── test_basic.py</span><br><span class="line">│   ├── test_performance.py</span><br><span class="line">│   └── test_integration.py</span><br><span class="line">├── examples/</span><br><span class="line">│   ├── basic_usage.py</span><br><span class="line">│   └── advanced_examples.py</span><br><span class="line">├── docs/</span><br><span class="line">│   ├── api_reference.md</span><br><span class="line">│   └── user_guide.md</span><br><span class="line">├── setup.py</span><br><span class="line">├── CMakeLists.txt</span><br><span class="line">├── requirements.txt</span><br><span class="line">└── README.md</span><br></pre></td></tr></table></figure>
<h3 id="2-Python包装器模式">2. Python包装器模式</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># src/my_package/core.py</span></span><br><span class="line"><span class="keyword">import</span> example</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">List</span>, <span class="type">Dict</span>, <span class="type">Any</span>, <span class="type">Optional</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyPackage</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;Python包装器类，提供友好的API&quot;&quot;&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, config: <span class="type">Optional</span>[<span class="type">Dict</span>[<span class="built_in">str</span>, <span class="type">Any</span>]] = <span class="literal">None</span></span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;初始化</span></span><br><span class="line"><span class="string">        </span></span><br><span class="line"><span class="string">        Args:</span></span><br><span class="line"><span class="string">            config: 配置字典</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="variable language_">self</span>.config = config <span class="keyword">or</span> &#123;&#125;</span><br><span class="line">        <span class="variable language_">self</span>._cpp_instance = example.MyCppClass(**<span class="variable language_">self</span>.config)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">process_data</span>(<span class="params">self, data: np.ndarray</span>) -&gt; np.ndarray:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;处理数据</span></span><br><span class="line"><span class="string">        </span></span><br><span class="line"><span class="string">        Args:</span></span><br><span class="line"><span class="string">            data: 输入数据数组</span></span><br><span class="line"><span class="string">            </span></span><br><span class="line"><span class="string">        Returns:</span></span><br><span class="line"><span class="string">            处理后的数据数组</span></span><br><span class="line"><span class="string">            </span></span><br><span class="line"><span class="string">        Raises:</span></span><br><span class="line"><span class="string">            ValueError: 如果输入数据无效</span></span><br><span class="line"><span class="string">            RuntimeError: 如果处理失败</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> <span class="built_in">isinstance</span>(data, np.ndarray):</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">&quot;输入必须是NumPy数组&quot;</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> data.ndim != <span class="number">2</span>:</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">&quot;输入必须是二维数组&quot;</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            result = <span class="variable language_">self</span>._cpp_instance.process_data(data)</span><br><span class="line">            <span class="keyword">return</span> result</span><br><span class="line">        <span class="keyword">except</span> example.CppError <span class="keyword">as</span> e:</span><br><span class="line">            <span class="keyword">raise</span> RuntimeError(<span class="string">f&quot;C++处理失败: <span class="subst">&#123;e&#125;</span>&quot;</span>) <span class="keyword">from</span> e</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">batch_process</span>(<span class="params">self, data_list: <span class="type">List</span>[np.ndarray]</span>) -&gt; <span class="type">List</span>[np.ndarray]:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;批量处理数据</span></span><br><span class="line"><span class="string">        </span></span><br><span class="line"><span class="string">        Args:</span></span><br><span class="line"><span class="string">            data_list: 数据列表</span></span><br><span class="line"><span class="string">            </span></span><br><span class="line"><span class="string">        Returns:</span></span><br><span class="line"><span class="string">            处理结果列表</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="comment"># 验证输入</span></span><br><span class="line">        <span class="keyword">for</span> i, data <span class="keyword">in</span> <span class="built_in">enumerate</span>(data_list):</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> <span class="built_in">isinstance</span>(data, np.ndarray):</span><br><span class="line">                <span class="keyword">raise</span> ValueError(<span class="string">f&quot;第<span class="subst">&#123;i&#125;</span>个元素不是NumPy数组&quot;</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 转换为C++可以处理的格式</span></span><br><span class="line">        cpp_input = example.DataBatch(data_list)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 处理</span></span><br><span class="line">        cpp_result = <span class="variable language_">self</span>._cpp_instance.batch_process(cpp_input)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 转换回Python格式</span></span><br><span class="line">        <span class="keyword">return</span> [np.array(batch) <span class="keyword">for</span> batch <span class="keyword">in</span> cpp_result]</span><br><span class="line">    </span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">version</span>(<span class="params">self</span>) -&gt; <span class="built_in">str</span>:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;获取版本信息&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">return</span> example.__version__</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__enter__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;上下文管理器进入&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__exit__</span>(<span class="params">self, exc_type, exc_val, exc_tb</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;上下文管理器退出&quot;&quot;&quot;</span></span><br><span class="line">        <span class="variable language_">self</span>._cpp_instance.cleanup()</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br></pre></td></tr></table></figure>
<h3 id="3-错误处理最佳实践">3. 错误处理最佳实践</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># src/my_package/errors.py</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyPackageError</span>(<span class="title class_ inherited__">Exception</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;基础异常类&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">InvalidInputError</span>(<span class="title class_ inherited__">MyPackageError</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;输入无效异常&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ProcessingError</span>(<span class="title class_ inherited__">MyPackageError</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;处理异常&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ConfigurationError</span>(<span class="title class_ inherited__">MyPackageError</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;配置异常&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># src/my_package/utils.py</span></span><br><span class="line"><span class="keyword">import</span> traceback</span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">Callable</span>, <span class="type">Any</span>, <span class="type">Dict</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">exception_handler</span>(<span class="params">func: <span class="type">Callable</span></span>) -&gt; <span class="type">Callable</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;统一异常处理装饰器&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">import</span> functools</span><br><span class="line">    </span><br><span class="line"><span class="meta">    @functools.wraps(<span class="params">func</span>)</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">wrapper</span>(<span class="params">*args, **kwargs</span>) -&gt; <span class="type">Dict</span>[<span class="built_in">str</span>, <span class="type">Any</span>]:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;包装函数&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            result = func(*args, **kwargs)</span><br><span class="line">            <span class="keyword">return</span> &#123;</span><br><span class="line">                <span class="string">&quot;success&quot;</span>: <span class="literal">True</span>,</span><br><span class="line">                <span class="string">&quot;result&quot;</span>: result</span><br><span class="line">            &#125;</span><br><span class="line">        <span class="keyword">except</span> example.DivisionByZeroError <span class="keyword">as</span> e:</span><br><span class="line">            <span class="keyword">return</span> &#123;</span><br><span class="line">                <span class="string">&quot;success&quot;</span>: <span class="literal">False</span>,</span><br><span class="line">                <span class="string">&quot;error_type&quot;</span>: <span class="string">&quot;DivisionByZeroError&quot;</span>,</span><br><span class="line">                <span class="string">&quot;error_message&quot;</span>: <span class="built_in">str</span>(e),</span><br><span class="line">                <span class="string">&quot;details&quot;</span>: <span class="string">&quot;除数不能为零&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line">        <span class="keyword">except</span> example.InvalidInputError <span class="keyword">as</span> e:</span><br><span class="line">            <span class="keyword">return</span> &#123;</span><br><span class="line">                <span class="string">&quot;success&quot;</span>: <span class="literal">False</span>,</span><br><span class="line">                <span class="string">&quot;error_type&quot;</span>: <span class="string">&quot;InvalidInputError&quot;</span>,</span><br><span class="line">                <span class="string">&quot;error_message&quot;</span>: <span class="built_in">str</span>(e),</span><br><span class="line">                <span class="string">&quot;details&quot;</span>: <span class="string">&quot;输入参数无效&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="keyword">return</span> &#123;</span><br><span class="line">                <span class="string">&quot;success&quot;</span>: <span class="literal">False</span>,</span><br><span class="line">                <span class="string">&quot;error_type&quot;</span>: <span class="built_in">type</span>(e).__name__,</span><br><span class="line">                <span class="string">&quot;error_message&quot;</span>: <span class="built_in">str</span>(e),</span><br><span class="line">                <span class="string">&quot;traceback&quot;</span>: traceback.format_exc()</span><br><span class="line">            &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> wrapper</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">validate_input</span>(<span class="params">func: <span class="type">Callable</span></span>) -&gt; <span class="type">Callable</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;输入验证装饰器&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">import</span> functools</span><br><span class="line">    </span><br><span class="line"><span class="meta">    @functools.wraps(<span class="params">func</span>)</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">wrapper</span>(<span class="params">*args, **kwargs</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;包装函数&quot;&quot;&quot;</span></span><br><span class="line">        <span class="comment"># 这里可以添加通用的输入验证逻辑</span></span><br><span class="line">        <span class="keyword">for</span> i, arg <span class="keyword">in</span> <span class="built_in">enumerate</span>(args):</span><br><span class="line">            <span class="keyword">if</span> arg <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">                <span class="keyword">raise</span> ValueError(<span class="string">f&quot;第<span class="subst">&#123;i+<span class="number">1</span>&#125;</span>个参数不能为None&quot;</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> func(*args, **kwargs)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> wrapper</span><br></pre></td></tr></table></figure>
<h3 id="4-测试策略">4. 测试策略</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># tests/conftest.py</span></span><br><span class="line"><span class="keyword">import</span> pytest</span><br><span class="line"><span class="keyword">import</span> example</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"><span class="meta">@pytest.fixture(<span class="params">scope=<span class="string">&quot;session&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">cpp_instance</span>():</span><br><span class="line">    <span class="string">&quot;&quot;&quot;C++实例夹具&quot;&quot;&quot;</span></span><br><span class="line">    instance = example.MyCppClass()</span><br><span class="line">    <span class="keyword">yield</span> instance</span><br><span class="line">    instance.cleanup()</span><br><span class="line"></span><br><span class="line"><span class="meta">@pytest.fixture(<span class="params">scope=<span class="string">&quot;function&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test_data</span>():</span><br><span class="line">    <span class="string">&quot;&quot;&quot;测试数据夹具&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="string">&quot;small_array&quot;</span>: np.array([[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>], [<span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>]], dtype=np.float32),</span><br><span class="line">        <span class="string">&quot;large_array&quot;</span>: np.random.rand(<span class="number">1000</span>, <span class="number">1000</span>).astype(np.float32),</span><br><span class="line">        <span class="string">&quot;empty_array&quot;</span>: np.array([], dtype=np.float32),</span><br><span class="line">        <span class="string">&quot;invalid_data&quot;</span>: <span class="string">&quot;not an array&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># tests/test_basic.py</span></span><br><span class="line"><span class="keyword">import</span> pytest</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">from</span> my_package <span class="keyword">import</span> MyPackage</span><br><span class="line"><span class="keyword">from</span> my_package.errors <span class="keyword">import</span> InvalidInputError</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test_basic_operations</span>(<span class="params">cpp_instance</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;测试基本操作&quot;&quot;&quot;</span></span><br><span class="line">    result = cpp_instance.add(<span class="number">2</span>, <span class="number">3</span>)</span><br><span class="line">    <span class="keyword">assert</span> result == <span class="number">5</span></span><br><span class="line">    </span><br><span class="line">    result = cpp_instance.multiply(<span class="number">4</span>, <span class="number">5</span>)</span><br><span class="line">    <span class="keyword">assert</span> result == <span class="number">20</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test_array_processing</span>(<span class="params">cpp_instance, test_data</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;测试数组处理&quot;&quot;&quot;</span></span><br><span class="line">    data = test_data[<span class="string">&quot;small_array&quot;</span>]</span><br><span class="line">    result = cpp_instance.process_array(data)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">assert</span> <span class="built_in">isinstance</span>(result, np.ndarray)</span><br><span class="line">    <span class="keyword">assert</span> result.shape == data.shape</span><br><span class="line">    <span class="keyword">assert</span> result.dtype == data.dtype</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test_error_handling</span>(<span class="params">cpp_instance, test_data</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;测试错误处理&quot;&quot;&quot;</span></span><br><span class="line">    <span class="comment"># 测试无效输入</span></span><br><span class="line">    <span class="keyword">with</span> pytest.raises(InvalidInputError):</span><br><span class="line">        cpp_instance.process_array(test_data[<span class="string">&quot;invalid_data&quot;</span>])</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 测试空数组</span></span><br><span class="line">    <span class="keyword">with</span> pytest.raises(ValueError):</span><br><span class="line">        cpp_instance.process_array(test_data[<span class="string">&quot;empty_array&quot;</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># tests/test_performance.py</span></span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> pytest</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test_performance</span>(<span class="params">cpp_instance, test_data</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;性能测试&quot;&quot;&quot;</span></span><br><span class="line">    data = test_data[<span class="string">&quot;large_array&quot;</span>]</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 测量执行时间</span></span><br><span class="line">    start_time = time.time()</span><br><span class="line">    result = cpp_instance.process_array(data)</span><br><span class="line">    execution_time = time.time() - start_time</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 性能断言</span></span><br><span class="line">    <span class="keyword">assert</span> execution_time &lt; <span class="number">1.0</span>, <span class="string">f&quot;执行时间过长: <span class="subst">&#123;execution_time:<span class="number">.2</span>f&#125;</span>秒&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 结果验证</span></span><br><span class="line">    <span class="keyword">assert</span> <span class="built_in">isinstance</span>(result, np.ndarray)</span><br><span class="line">    <span class="keyword">assert</span> result.shape == data.shape</span><br><span class="line"></span><br><span class="line"><span class="comment"># tests/test_integration.py</span></span><br><span class="line"><span class="keyword">import</span> pytest</span><br><span class="line"><span class="keyword">from</span> my_package <span class="keyword">import</span> MyPackage</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test_integration</span>():</span><br><span class="line">    <span class="string">&quot;&quot;&quot;集成测试&quot;&quot;&quot;</span></span><br><span class="line">    <span class="comment"># 创建Python包装器实例</span></span><br><span class="line">    package = MyPackage()</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 测试完整流程</span></span><br><span class="line">    result = package.process_data(np.array([[<span class="number">1</span>, <span class="number">2</span>], [<span class="number">3</span>, <span class="number">4</span>]], dtype=np.float32))</span><br><span class="line">    <span class="keyword">assert</span> result <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 测试上下文管理器</span></span><br><span class="line">    <span class="keyword">with</span> MyPackage() <span class="keyword">as</span> package_ctx:</span><br><span class="line">        result = package_ctx.process_data(np.array([[<span class="number">1</span>, <span class="number">2</span>], [<span class="number">3</span>, <span class="number">4</span>]], dtype=np.float32))</span><br><span class="line">        <span class="keyword">assert</span> result <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span></span><br></pre></td></tr></table></figure>
<h3 id="5-文档和注释">5. 文档和注释</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># src/my_package/__init__.py</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">MyPackage - pybind11 C++扩展示例包</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">这个包提供了Python友好的API来访问高性能的C++算法。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">主要特性：</span></span><br><span class="line"><span class="string">- 高性能的数值计算</span></span><br><span class="line"><span class="string">- 与NumPy无缝集成</span></span><br><span class="line"><span class="string">- 完整的错误处理</span></span><br><span class="line"><span class="string">- 多线程支持</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">示例：</span></span><br><span class="line"><span class="string"><span class="meta">&gt;&gt;&gt; </span>from my_package import MyPackage</span></span><br><span class="line"><span class="string"><span class="meta">&gt;&gt;&gt; </span>package = MyPackage()</span></span><br><span class="line"><span class="string"><span class="meta">&gt;&gt;&gt; </span>result = package.process_data(data)</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> .core <span class="keyword">import</span> MyPackage</span><br><span class="line"><span class="keyword">from</span> .errors <span class="keyword">import</span> (</span><br><span class="line">    MyPackageError,</span><br><span class="line">    InvalidInputError,</span><br><span class="line">    ProcessingError,</span><br><span class="line">    ConfigurationError</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">__version__ = <span class="string">&quot;1.0.0&quot;</span></span><br><span class="line">__author__ = <span class="string">&quot;Python Developer&quot;</span></span><br><span class="line">__license__ = <span class="string">&quot;MIT&quot;</span></span><br><span class="line"></span><br><span class="line">__all__ = [</span><br><span class="line">    <span class="string">&quot;MyPackage&quot;</span>,</span><br><span class="line">    <span class="string">&quot;MyPackageError&quot;</span>,</span><br><span class="line">    <span class="string">&quot;InvalidInputError&quot;</span>,</span><br><span class="line">    <span class="string">&quot;ProcessingError&quot;</span>,</span><br><span class="line">    <span class="string">&quot;ConfigurationError&quot;</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="comment"># docs/api_reference.md</span></span><br><span class="line"><span class="comment"># API参考文档示例</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string"># MyPackage API参考</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">## MyPackage类</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">### 构造函数</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">```python</span></span><br><span class="line"><span class="string">MyPackage(config: Optional[Dict[str, Any]] = None)</span></span><br></pre></td></tr></table></figure>
<p>创建MyPackage实例。</p>
<p><strong>参数:</strong></p>
<ul class="lvl-0">
<li class="lvl-2">
<p><code>config</code>: 配置字典，可选</p>
</li>
</ul>
<h3 id="方法">方法</h3>
<h4 id="process-data">process_data</h4>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">process_data(data: np.ndarray) -&gt; np.ndarray</span><br></pre></td></tr></table></figure>
<p>处理输入数据。</p>
<p><strong>参数:</strong></p>
<ul class="lvl-0">
<li class="lvl-2">
<p><code>data</code>: 输入数据数组，必须是二维NumPy数组</p>
</li>
</ul>
<p><strong>返回:</strong></p>
<ul class="lvl-0">
<li class="lvl-2">
<p>处理后的数据数组</p>
</li>
</ul>
<p><strong>异常:</strong></p>
<ul class="lvl-0">
<li class="lvl-2">
<p><code>InvalidInputError</code>: 如果输入数据无效</p>
</li>
<li class="lvl-2">
<p><code>ProcessingError</code>: 如果处理失败</p>
</li>
</ul>
<h2 id="异常类">异常类</h2>
<h3 id="MyPackageError">MyPackageError</h3>
<p>基础异常类，所有包内异常都继承自此类。</p>
<h3 id="InvalidInputError">InvalidInputError</h3>
<p>输入数据无效时抛出。</p>
<h3 id="ProcessingError">ProcessingError</h3>
<p>数据处理失败时抛出。</p>
<h3 id="ConfigurationError">ConfigurationError</h3>
<p>配置错误时抛出。</p>
<h2 id="常见问题与解决方案">常见问题与解决方案</h2>
<h3 id="1-导入问题">1. 导入问题</h3>
<p><strong>问题：ImportError: No module named ‘_example’</strong></p>
<p><strong>解决方案：</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1. 检查扩展模块是否编译成功</span></span><br><span class="line"><span class="built_in">ls</span> -la *.so  <span class="comment"># Linux/macOS</span></span><br><span class="line"><span class="built_in">dir</span> *.pyd   <span class="comment"># Windows</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. 检查Python路径</span></span><br><span class="line">import sys</span><br><span class="line"><span class="built_in">print</span>(sys.path)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. 重新编译</span></span><br><span class="line">python setup.py build_ext --inplace</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4. 检查编译输出</span></span><br><span class="line">python setup.py build_ext --inplace -v</span><br></pre></td></tr></table></figure>
<p><strong>问题：DLL load failed while importing _example</strong></p>
<p><strong>解决方案：</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Windows系统</span></span><br><span class="line"><span class="comment"># 1. 检查Visual C++ Redistributable是否安装</span></span><br><span class="line"><span class="comment"># 2. 检查Python版本是否与编译版本匹配</span></span><br><span class="line"><span class="comment"># 3. 使用dumpbin检查依赖</span></span><br><span class="line">dumpbin /dependents _example.pyd</span><br><span class="line"></span><br><span class="line"><span class="comment"># Linux系统</span></span><br><span class="line"><span class="comment"># 1. 检查共享库依赖</span></span><br><span class="line">ldd _example.so</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. 检查libpython是否正确链接</span></span><br><span class="line">ldd _example.so | grep python</span><br></pre></td></tr></table></figure>
<h3 id="2-类型错误">2. 类型错误</h3>
<p><strong>问题：TypeError: argument of type ‘NoneType’ is not iterable</strong></p>
<p><strong>解决方案：</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 检查输入参数是否为None</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">safe_process</span>(<span class="params">data</span>):</span><br><span class="line">    <span class="keyword">if</span> data <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        <span class="keyword">raise</span> ValueError(<span class="string">&quot;输入数据不能为None&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> example.process_data(data)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 类型检查</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">type_safe_process</span>(<span class="params">data</span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> <span class="built_in">isinstance</span>(data, np.ndarray):</span><br><span class="line">        <span class="keyword">raise</span> TypeError(<span class="string">&quot;输入必须是NumPy数组&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> example.process_data(data)</span><br></pre></td></tr></table></figure>
<p><strong>问题：TypeError: No registered converter was able to produce a C++ rvalue of type int from this Python object of type list</strong></p>
<p><strong>解决方案：</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 确保传递正确的类型</span></span><br><span class="line"><span class="comment"># 错误: example.add([1, 2], 3)</span></span><br><span class="line"><span class="comment"># 正确: example.add(1, 2)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 或者修改C++代码接受容器类型</span></span><br><span class="line">// C++代码</span><br><span class="line"><span class="comment">#include &lt;pybind11/stl.h&gt;</span></span><br><span class="line">void process_list(const std::vector&lt;<span class="built_in">int</span>&gt;&amp; <span class="built_in">list</span>) &#123;</span><br><span class="line">    // ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="3-性能问题">3. 性能问题</h3>
<p><strong>问题：C++扩展比纯Python还慢</strong></p>
<p><strong>解决方案：</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1. 检查是否释放了GIL</span></span><br><span class="line"><span class="comment"># C++代码中添加</span></span><br><span class="line">py::gil_scoped_release release;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. 避免频繁的类型转换</span></span><br><span class="line"><span class="comment"># 错误: 循环中频繁调用C++函数</span></span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> data:</span><br><span class="line">    result.append(example.process(x))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 正确: 批量处理</span></span><br><span class="line">result = example.process_batch(data)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. 使用NumPy数组而不是Python列表</span></span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line">data_np = np.array(data, dtype=np.float32)</span><br><span class="line">result = example.process_array(data_np)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4. 性能分析找出瓶颈</span></span><br><span class="line"><span class="keyword">import</span> cProfile</span><br><span class="line">cProfile.run(<span class="string">&quot;example.process_large_data(data)&quot;</span>)</span><br></pre></td></tr></table></figure>
<h3 id="4-内存问题">4. 内存问题</h3>
<p><strong>问题：内存泄漏</strong></p>
<p><strong>解决方案：</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1. 确保正确释放C++对象</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SafeWrapper</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>._cpp_obj = example.MyCppClass()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__del__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>._cpp_obj.cleanup()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. 使用上下文管理器</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CppResource</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__enter__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>._obj = example.MyCppClass()</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>._obj</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__exit__</span>(<span class="params">self, exc_type, exc_val, exc_tb</span>):</span><br><span class="line">        <span class="variable language_">self</span>._obj.cleanup()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. 避免循环引用</span></span><br><span class="line"><span class="keyword">import</span> weakref</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">NoCycleWrapper</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>._cpp_obj = example.MyCppClass()</span><br><span class="line">        <span class="variable language_">self</span>._weak_ref = weakref.ref(<span class="variable language_">self</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4. 手动垃圾回收</span></span><br><span class="line"><span class="keyword">import</span> gc</span><br><span class="line">gc.collect()</span><br></pre></td></tr></table></figure>
<h3 id="5-异常处理问题">5. 异常处理问题</h3>
<p><strong>问题：无法捕获C++异常</strong></p>
<p><strong>解决方案：</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1. 确保C++异常已注册</span></span><br><span class="line"><span class="comment"># C++代码</span></span><br><span class="line">py::register_exception&lt;MyException&gt;(m, <span class="string">&quot;MyException&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. 正确的异常捕获顺序</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    example.throw_exception()</span><br><span class="line"><span class="keyword">except</span> example.MySpecificException <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;特定异常:&quot;</span>, e)</span><br><span class="line"><span class="keyword">except</span> example.MyBaseException <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;基础异常:&quot;</span>, e)</span><br><span class="line"><span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;通用异常:&quot;</span>, e)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. 检查异常类型</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    example.throw_exception()</span><br><span class="line"><span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;异常类型: <span class="subst">&#123;<span class="built_in">type</span>(e).__name__&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;异常MRO: <span class="subst">&#123;[base.__name__ <span class="keyword">for</span> base <span class="keyword">in</span> <span class="built_in">type</span>(e).__mro__]&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>

    </div>

    
    
    

      <footer class="post-footer">
          
          <div class="post-tags">
              <a href="/tags/python/" rel="tag"><i class="fa fa-tag"></i> python</a>
              <a href="/tags/cpp/" rel="tag"><i class="fa fa-tag"></i> C++</a>
          </div>

        



        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2025/10/30/C++/%E5%9C%A8C++%E4%B8%AD%E4%BD%BF%E7%94%A8python/" rel="prev" title="在C++中使用python">
      <i class="fa fa-chevron-left"></i> 在C++中使用python
    </a></div>
      <div class="post-nav-item"></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
            
    <div class="comments" id="gitalk-container"></div>

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link"><span class="nav-number">1.</span> <span class="nav-text">在Python中使用pybind11完整指南</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%9B%AE%E5%BD%95"><span class="nav-number">1.1.</span> <span class="nav-text">目录</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%AE%80%E4%BB%8B"><span class="nav-number">1.2.</span> <span class="nav-text">简介</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A0%B8%E5%BF%83%E4%BC%98%E5%8A%BF"><span class="nav-number">1.2.1.</span> <span class="nav-text">核心优势</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%85%B8%E5%9E%8B%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="nav-number">1.2.2.</span> <span class="nav-text">典型应用场景</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%89%E8%A3%85%E4%B8%8E%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE"><span class="nav-number">1.3.</span> <span class="nav-text">安装与环境配置</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E5%AE%89%E8%A3%85pybind11"><span class="nav-number">1.3.1.</span> <span class="nav-text">1. 安装pybind11</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E9%AA%8C%E8%AF%81%E5%AE%89%E8%A3%85"><span class="nav-number">1.3.2.</span> <span class="nav-text">2. 验证安装</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E9%A1%B9%E7%9B%AE%E7%BB%93%E6%9E%84"><span class="nav-number">1.3.3.</span> <span class="nav-text">3. 项目结构</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-%E6%9E%84%E5%BB%BA%E9%85%8D%E7%BD%AE%EF%BC%88setup-py%EF%BC%89"><span class="nav-number">1.3.4.</span> <span class="nav-text">4. 构建配置（setup.py）</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8"><span class="nav-number">1.4.</span> <span class="nav-text">基础使用</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E6%A8%A1%E5%9D%97%E5%AF%BC%E5%85%A5"><span class="nav-number">1.4.1.</span> <span class="nav-text">1. 模块导入</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E5%9F%BA%E6%9C%AC%E5%87%BD%E6%95%B0%E8%B0%83%E7%94%A8"><span class="nav-number">1.4.2.</span> <span class="nav-text">2. 基本函数调用</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E5%B8%B8%E9%87%8F%E5%92%8C%E5%B1%9E%E6%80%A7%E8%AE%BF%E9%97%AE"><span class="nav-number">1.4.3.</span> <span class="nav-text">3. 常量和属性访问</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%87%BD%E6%95%B0%E8%B0%83%E7%94%A8"><span class="nav-number">1.5.</span> <span class="nav-text">函数调用</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E4%B8%8D%E5%90%8C%E5%8F%82%E6%95%B0%E7%B1%BB%E5%9E%8B%E7%9A%84%E5%87%BD%E6%95%B0"><span class="nav-number">1.5.1.</span> <span class="nav-text">1. 不同参数类型的函数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E5%87%BD%E6%95%B0%E8%A3%85%E9%A5%B0%E5%99%A8%E5%92%8C%E5%9B%9E%E8%B0%83"><span class="nav-number">1.5.2.</span> <span class="nav-text">2. 函数装饰器和回调</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E6%80%A7%E8%83%BD%E5%AF%B9%E6%AF%94"><span class="nav-number">1.5.3.</span> <span class="nav-text">3. 性能对比</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%B1%BB%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="nav-number">1.6.</span> <span class="nav-text">类的使用</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E5%9F%BA%E7%A1%80%E7%B1%BB%E6%93%8D%E4%BD%9C"><span class="nav-number">1.6.1.</span> <span class="nav-text">1. 基础类操作</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E7%B1%BB%E7%9A%84%E7%BB%A7%E6%89%BF%E5%92%8C%E5%A4%9A%E6%80%81"><span class="nav-number">1.6.2.</span> <span class="nav-text">2. 类的继承和多态</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E8%BF%90%E7%AE%97%E7%AC%A6%E9%87%8D%E8%BD%BD"><span class="nav-number">1.6.3.</span> <span class="nav-text">3. 运算符重载</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-%E6%9E%9A%E4%B8%BE%E7%B1%BB%E5%9E%8B"><span class="nav-number">1.6.4.</span> <span class="nav-text">4. 枚举类型</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BB%A7%E6%89%BFC-%E7%B1%BB"><span class="nav-number">1.7.</span> <span class="nav-text">继承C++类</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-Python%E7%B1%BB%E7%BB%A7%E6%89%BFC-%E7%B1%BB"><span class="nav-number">1.7.1.</span> <span class="nav-text">1. Python类继承C++类</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E6%8A%BD%E8%B1%A1%E7%B1%BB%E5%92%8C%E6%8E%A5%E5%8F%A3%E5%AE%9E%E7%8E%B0"><span class="nav-number">1.7.2.</span> <span class="nav-text">2. 抽象类和接口实现</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E5%A4%9A%E6%80%81%E5%92%8C%E7%B1%BB%E5%9E%8B%E6%A3%80%E6%9F%A5"><span class="nav-number">1.7.3.</span> <span class="nav-text">3. 多态和类型检查</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2"><span class="nav-number">1.8.</span> <span class="nav-text">类型转换</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E5%9F%BA%E7%A1%80%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2"><span class="nav-number">1.8.1.</span> <span class="nav-text">1. 基础类型转换</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E5%AE%B9%E5%99%A8%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2"><span class="nav-number">1.8.2.</span> <span class="nav-text">2. 容器类型转换</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-NumPy%E6%95%B0%E7%BB%84%E8%BD%AC%E6%8D%A2"><span class="nav-number">1.8.3.</span> <span class="nav-text">3. NumPy数组转换</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-%E8%87%AA%E5%AE%9A%E4%B9%89%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2"><span class="nav-number">1.8.4.</span> <span class="nav-text">4. 自定义类型转换</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86"><span class="nav-number">1.9.</span> <span class="nav-text">异常处理</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E6%8D%95%E8%8E%B7C-%E5%BC%82%E5%B8%B8"><span class="nav-number">1.9.1.</span> <span class="nav-text">1. 捕获C++异常</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E8%87%AA%E5%AE%9A%E4%B9%89%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86"><span class="nav-number">1.9.2.</span> <span class="nav-text">2. 自定义异常处理</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#NumPy%E9%9B%86%E6%88%90"><span class="nav-number">1.10.</span> <span class="nav-text">NumPy集成</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E6%95%B0%E7%BB%84%E6%93%8D%E4%BD%9C"><span class="nav-number">1.10.1.</span> <span class="nav-text">1. 数组操作</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E9%AB%98%E7%BA%A7NumPy%E5%8A%9F%E8%83%BD"><span class="nav-number">1.10.2.</span> <span class="nav-text">2. 高级NumPy功能</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96"><span class="nav-number">1.10.3.</span> <span class="nav-text">3. 性能优化</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%A4%9A%E7%BA%BF%E7%A8%8B%E4%BD%BF%E7%94%A8"><span class="nav-number">1.11.</span> <span class="nav-text">多线程使用</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E5%9F%BA%E7%A1%80%E5%A4%9A%E7%BA%BF%E7%A8%8B"><span class="nav-number">1.11.1.</span> <span class="nav-text">1. 基础多线程</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E5%BC%82%E6%AD%A5%E7%BC%96%E7%A8%8B"><span class="nav-number">1.11.2.</span> <span class="nav-text">2. 异步编程</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E7%BA%BF%E7%A8%8B%E5%AE%89%E5%85%A8%E5%92%8CGIL%E7%AE%A1%E7%90%86"><span class="nav-number">1.11.3.</span> <span class="nav-text">3. 线程安全和GIL管理</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%AB%98%E7%BA%A7%E7%89%B9%E6%80%A7"><span class="nav-number">1.12.</span> <span class="nav-text">高级特性</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E4%B8%8A%E4%B8%8B%E6%96%87%E7%AE%A1%E7%90%86%E5%99%A8"><span class="nav-number">1.12.1.</span> <span class="nav-text">1. 上下文管理器</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E8%BF%AD%E4%BB%A3%E5%99%A8%E5%92%8C%E7%94%9F%E6%88%90%E5%99%A8"><span class="nav-number">1.12.2.</span> <span class="nav-text">2. 迭代器和生成器</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E8%A3%85%E9%A5%B0%E5%99%A8"><span class="nav-number">1.12.3.</span> <span class="nav-text">3. 装饰器</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96"><span class="nav-number">1.13.</span> <span class="nav-text">性能优化</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E5%86%85%E5%AD%98%E4%BC%98%E5%8C%96"><span class="nav-number">1.13.1.</span> <span class="nav-text">1. 内存优化</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E8%AE%A1%E7%AE%97%E4%BC%98%E5%8C%96"><span class="nav-number">1.13.2.</span> <span class="nav-text">2. 计算优化</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E7%BC%93%E5%AD%98%E7%AD%96%E7%95%A5"><span class="nav-number">1.13.3.</span> <span class="nav-text">3. 缓存策略</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%B0%83%E8%AF%95%E6%8A%80%E5%B7%A7"><span class="nav-number">1.14.</span> <span class="nav-text">调试技巧</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E5%9F%BA%E6%9C%AC%E8%B0%83%E8%AF%95"><span class="nav-number">1.14.1.</span> <span class="nav-text">1. 基本调试</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E9%AB%98%E7%BA%A7%E8%B0%83%E8%AF%95%E6%8A%80%E5%B7%A7"><span class="nav-number">1.14.2.</span> <span class="nav-text">2. 高级调试技巧</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-C-%E6%89%A9%E5%B1%95%E8%B0%83%E8%AF%95"><span class="nav-number">1.14.3.</span> <span class="nav-text">3. C++扩展调试</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5"><span class="nav-number">1.15.</span> <span class="nav-text">最佳实践</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E4%BB%A3%E7%A0%81%E7%BB%84%E7%BB%87"><span class="nav-number">1.15.1.</span> <span class="nav-text">1. 代码组织</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-Python%E5%8C%85%E8%A3%85%E5%99%A8%E6%A8%A1%E5%BC%8F"><span class="nav-number">1.15.2.</span> <span class="nav-text">2. Python包装器模式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5"><span class="nav-number">1.15.3.</span> <span class="nav-text">3. 错误处理最佳实践</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-%E6%B5%8B%E8%AF%95%E7%AD%96%E7%95%A5"><span class="nav-number">1.15.4.</span> <span class="nav-text">4. 测试策略</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-%E6%96%87%E6%A1%A3%E5%92%8C%E6%B3%A8%E9%87%8A"><span class="nav-number">1.15.5.</span> <span class="nav-text">5. 文档和注释</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%96%B9%E6%B3%95"><span class="nav-number">1.15.6.</span> <span class="nav-text">方法</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#process-data"><span class="nav-number">1.15.6.1.</span> <span class="nav-text">process_data</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%BC%82%E5%B8%B8%E7%B1%BB"><span class="nav-number">1.16.</span> <span class="nav-text">异常类</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#MyPackageError"><span class="nav-number">1.16.1.</span> <span class="nav-text">MyPackageError</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#InvalidInputError"><span class="nav-number">1.16.2.</span> <span class="nav-text">InvalidInputError</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ProcessingError"><span class="nav-number">1.16.3.</span> <span class="nav-text">ProcessingError</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ConfigurationError"><span class="nav-number">1.16.4.</span> <span class="nav-text">ConfigurationError</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98%E4%B8%8E%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88"><span class="nav-number">1.17.</span> <span class="nav-text">常见问题与解决方案</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E5%AF%BC%E5%85%A5%E9%97%AE%E9%A2%98"><span class="nav-number">1.17.1.</span> <span class="nav-text">1. 导入问题</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E7%B1%BB%E5%9E%8B%E9%94%99%E8%AF%AF"><span class="nav-number">1.17.2.</span> <span class="nav-text">2. 类型错误</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E6%80%A7%E8%83%BD%E9%97%AE%E9%A2%98"><span class="nav-number">1.17.3.</span> <span class="nav-text">3. 性能问题</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-%E5%86%85%E5%AD%98%E9%97%AE%E9%A2%98"><span class="nav-number">1.17.4.</span> <span class="nav-text">4. 内存问题</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86%E9%97%AE%E9%A2%98"><span class="nav-number">1.17.5.</span> <span class="nav-text">5. 异常处理问题</span></a></li></ol></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="三子曰"
      src="https://cdn.jsdelivr.net/gh/MengChangWang/Blog_Image@main/img/avatar.png">
  <p class="site-author-name" itemprop="name">三子曰</p>
  <div class="site-description" itemprop="description">欢迎来到我的博客</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">69</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">7</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">23</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/wangmc1024" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;wangmc1024" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:wangmc1024@gmail.com" title="E-Mail → mailto:wangmc1024@gmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>



      </div>
        <div class="back-to-top motion-element">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; Wed Mar 27 2024 08:00:00 GMT+0800 (中国标准时间) – 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">三子曰</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
    <span title="站点总字数">726k</span>
</div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script size="300" alpha="0.6" zIndex="-1" src="/lib/canvas-ribbon/canvas-ribbon.js"></script>
  <script src="/lib/anime.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/lozad@1/dist/lozad.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  
  <script>
    (function(){
      var canonicalURL, curProtocol;
      //Get the <link> tag
      var x=document.getElementsByTagName("link");
		//Find the last canonical URL
		if(x.length > 0){
			for (i=0;i<x.length;i++){
				if(x[i].rel.toLowerCase() == 'canonical' && x[i].href){
					canonicalURL=x[i].href;
				}
			}
		}
    //Get protocol
	    if (!canonicalURL){
	    	curProtocol = window.location.protocol.split(':')[0];
	    }
	    else{
	    	curProtocol = canonicalURL.split(':')[0];
	    }
      //Get current URL if the canonical URL does not exist
	    if (!canonicalURL) canonicalURL = window.location.href;
	    //Assign script content. Replace current URL with the canonical URL
      !function(){var e=/([http|https]:\/\/[a-zA-Z0-9\_\.]+\.baidu\.com)/gi,r=canonicalURL,t=document.referrer;if(!e.test(r)){var n=(String(curProtocol).toLowerCase() === 'https')?"https://sp0.baidu.com/9_Q4simg2RQJ8t7jm9iCKT-xh_/s.gif":"//api.share.baidu.com/s.gif";t?(n+="?r="+encodeURIComponent(document.referrer),r&&(n+="&l="+r)):r&&(n+="?l="+r);var i=new Image;i.src=n}}(window);})();
  </script>















  

  

<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.css">

<script>
NexT.utils.loadComments(document.querySelector('#gitalk-container'), () => {
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js', () => {
    var gitalk = new Gitalk({
      clientID    : '2719e26e1ea715ee8429',
      clientSecret: '77a4ce8e9410a002f05c8f2c2b398c952a012d7c',
      repo        : 'wangmc1024.github.io',
      owner       : 'wangmc1024',
      admin       : ['wangmc1024'],
      id          : '8e3e5324662c33f8da6543264d423150',
        language: 'zh-CN',
      distractionFreeMode: true
    });
    gitalk.render('gitalk-container');
  }, window.Gitalk);
});
</script>



</body>
</html>
