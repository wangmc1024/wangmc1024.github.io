<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 8.0.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"wangmc1024.github.io","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":false,"style":"mac"},"back2top":{"enable":true,"sidebar":true,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":true,"pangu":false,"comments":{"style":"tabs","active":"gitalk","storage":true,"lazyload":true,"nav":null,"activeClass":"gitalk"},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":true,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.json"};
  </script>

  <meta name="description" content="如题，AI收集整理，作为了解">
<meta property="og:type" content="article">
<meta property="og:title" content="playwright使用">
<meta property="og:url" content="https://wangmc1024.github.io/2025/10/23/AI/playwright/index.html">
<meta property="og:site_name" content="Computer Science">
<meta property="og:description" content="如题，AI收集整理，作为了解">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2025-10-23T10:40:37.000Z">
<meta property="article:modified_time" content="2025-10-23T10:41:58.350Z">
<meta property="article:author" content="三子曰">
<meta property="article:tag" content="AI">
<meta property="article:tag" content="web">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://wangmc1024.github.io/2025/10/23/AI/playwright/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>playwright使用 | Computer Science</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>


<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Computer Science</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">WangMC Blog</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>时间轴</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    


    <main class="main">
      <div class="main-inner">
        <div id="spa-content-wrap" class="content-wrap">
            

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://wangmc1024.github.io/2025/10/23/AI/playwright/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://cdn.jsdelivr.net/gh/MengChangWang/Blog_Image@main/img/avatar.png">
      <meta itemprop="name" content="三子曰">
      <meta itemprop="description" content="欢迎来到我的博客">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Computer Science">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          playwright使用
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2025-10-23 18:40:37 / 修改时间：18:41:58" itemprop="dateCreated datePublished" datetime="2025-10-23T18:40:37+08:00">2025-10-23</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/AI/" itemprop="url" rel="index"><span itemprop="name">AI</span></a>
                </span>
            </span>

          
            <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span id="busuanzi_value_page_pv"></span>
            </span><br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>27k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>24 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <blockquote>
<p>如题，AI收集整理，作为了解</p>
</blockquote>
<span id="more"></span>
<h1>Playwright 完整使用指南</h1>
<p><strong>Date: October 23, 2025</strong><br>
<strong>Code: <a target="_blank" rel="noopener" href="https://github.com/microsoft/playwright">https://github.com/microsoft/playwright</a></strong></p>
<hr>
<h2 id="目录">目录</h2>
<ol>
<li class="lvl-3">
<p><a href="#1-playwright-%E6%A6%82%E8%BF%B0">Playwright 概述</a></p>
</li>
<li class="lvl-3">
<p><a href="#2-%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5">核心概念</a></p>
</li>
<li class="lvl-3">
<p><a href="#3-%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA">环境搭建</a></p>
</li>
<li class="lvl-3">
<p><a href="#4-%E5%9F%BA%E6%9C%AC%E7%94%A8%E6%B3%95">基本用法</a></p>
</li>
<li class="lvl-3">
<p><a href="#5-%E5%85%83%E7%B4%A0%E5%AE%9A%E4%BD%8D%E4%B8%8E%E6%93%8D%E4%BD%9C">元素定位与操作</a></p>
</li>
<li class="lvl-3">
<p><a href="#6-%E6%99%BA%E8%83%BD%E7%AD%89%E5%BE%85%E6%9C%BA%E5%88%B6">智能等待机制</a></p>
</li>
<li class="lvl-3">
<p><a href="#7-%E7%BD%91%E7%BB%9C%E8%AF%B7%E6%B1%82%E5%A4%84%E7%90%86">网络请求处理</a></p>
</li>
<li class="lvl-3">
<p><a href="#8-%E9%AB%98%E7%BA%A7%E7%89%B9%E6%80%A7">高级特性</a></p>
</li>
<li class="lvl-3">
<p><a href="#9-%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5">最佳实践</a></p>
</li>
<li class="lvl-4">
<p><a href="#10-%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B">实战案例</a></p>
</li>
<li class="lvl-4">
<p><a href="#11-%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98%E4%B8%8E%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88">常见问题与解决方案</a></p>
</li>
</ol>
<hr>
<h2 id="1-Playwright-概述">1. Playwright 概述</h2>
<h3 id="1-1-什么是-Playwright">1.1 什么是 Playwright</h3>
<p>Playwright 是由微软开发的一款开源自动化测试工具，专为现代 Web 应用程序设计。它提供了一套统一的 API，支持 Chromium、Firefox 和 WebKit 三大主流浏览器引擎，能够实现真正的跨浏览器测试。</p>
<h3 id="1-2-核心优势">1.2 核心优势</h3>
<table>
<thead>
<tr>
<th>特性</th>
<th>传统工具（如 Selenium）</th>
<th>Playwright 解决方案</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>跨浏览器支持</strong></td>
<td>需分别配置不同驱动，兼容性问题多</td>
<td>原生支持三大浏览器，API 完全统一</td>
</tr>
<tr>
<td><strong>元素等待机制</strong></td>
<td>依赖 time.sleep() 或显式等待，脚本不稳定</td>
<td>所有操作内置智能等待，自动等待元素&quot;可操作&quot;状态</td>
</tr>
<tr>
<td><strong>元素定位能力</strong></td>
<td>主要依赖 CSS、XPath，对动态页面支持差</td>
<td>支持文本、组件、属性组合等 10+ 种定位方式</td>
</tr>
<tr>
<td><strong>多场景模拟</strong></td>
<td>多标签页、多用户场景配置复杂</td>
<td>基于&quot;上下文隔离&quot;机制，多场景独立运行</td>
</tr>
<tr>
<td><strong>网络请求控制</strong></td>
<td>需借助第三方工具，集成复杂</td>
<td>内置网络拦截、Mock、限速功能</td>
</tr>
<tr>
<td><strong>移动端测试</strong></td>
<td>需搭建额外环境，配置繁琐</td>
<td>一键模拟手机设备，支持 GPS 定位模拟</td>
</tr>
</tbody>
</table>
<h3 id="1-3-适用场景">1.3 适用场景</h3>
<ul class="lvl-0">
<li class="lvl-2">
<p><strong>现代 Web 应用测试</strong>：尤其适合 React、Vue、Angular 等前端框架开发的 SPA 应用</p>
</li>
<li class="lvl-2">
<p><strong>跨浏览器兼容性测试</strong>：需在 Chrome、Firefox、Safari 同时验证功能的项目</p>
</li>
<li class="lvl-2">
<p><strong>自动化业务流程</strong>：用户登录、订单提交、数据导出等重复性业务操作</p>
</li>
<li class="lvl-2">
<p><strong>异常场景测试</strong>：模拟接口报错、网络延迟、弱网环境的测试</p>
</li>
<li class="lvl-2">
<p><strong>移动端响应式测试</strong>：无需真实设备，模拟不同手机型号的浏览器表现</p>
</li>
</ul>
<hr>
<h2 id="2-核心概念">2. 核心概念</h2>
<h3 id="2-1-浏览器（Browser）">2.1 浏览器（Browser）</h3>
<p>浏览器实例代表一个具体的浏览器进程，可以是 Chromium、Firefox 或 WebKit。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> playwright.sync_api <span class="keyword">import</span> sync_playwright</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> sync_playwright() <span class="keyword">as</span> p:</span><br><span class="line">    <span class="comment"># 启动不同浏览器</span></span><br><span class="line">    chromium_browser = p.chromium.launch()</span><br><span class="line">    firefox_browser = p.firefox.launch()</span><br><span class="line">    webkit_browser = p.webkit.launch()</span><br></pre></td></tr></table></figure>
<h3 id="2-2-浏览器上下文（Browser-Context）">2.2 浏览器上下文（Browser Context）</h3>
<p>浏览器上下文是一个隔离的会话环境，相当于一个无痕浏览器窗口。它可以独立管理 cookies、localStorage 等状态信息。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建浏览器上下文</span></span><br><span class="line">context = browser.new_context(</span><br><span class="line">    user_agent=<span class="string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36&quot;</span>,</span><br><span class="line">    viewport=&#123;<span class="string">&quot;width&quot;</span>: <span class="number">1920</span>, <span class="string">&quot;height&quot;</span>: <span class="number">1080</span>&#125;,</span><br><span class="line">    geolocation=&#123;<span class="string">&quot;longitude&quot;</span>: <span class="number">12.492507</span>, <span class="string">&quot;latitude&quot;</span>: <span class="number">41.889938</span>&#125;,</span><br><span class="line">    permissions=[<span class="string">&quot;geolocation&quot;</span>]</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<h3 id="2-3-页面（Page）">2.3 页面（Page）</h3>
<p>页面代表浏览器中的一个标签页，是进行页面操作的主要对象。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建新页面</span></span><br><span class="line">page = context.new_page()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 导航到网址</span></span><br><span class="line">page.goto(<span class="string">&quot;https://playwright.dev&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取页面标题</span></span><br><span class="line"><span class="built_in">print</span>(page.title())</span><br></pre></td></tr></table></figure>
<h3 id="2-4-元素定位器（Locator）">2.4 元素定位器（Locator）</h3>
<p>定位器是用于查找页面元素的对象，支持多种定位策略。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 文本定位</span></span><br><span class="line">page.locator(<span class="string">&quot;text=Get Started&quot;</span>).click()</span><br><span class="line"></span><br><span class="line"><span class="comment"># CSS 选择器定位</span></span><br><span class="line">page.locator(<span class="string">&quot;button#submit&quot;</span>).click()</span><br><span class="line"></span><br><span class="line"><span class="comment"># XPath 定位</span></span><br><span class="line">page.locator(<span class="string">&quot;//input[@name=&#x27;username&#x27;]&quot;</span>).fill(<span class="string">&quot;admin&quot;</span>)</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="3-环境搭建">3. 环境搭建</h2>
<h3 id="3-1-安装-Playwright">3.1 安装 Playwright</h3>
<h4 id="Python-环境">Python 环境</h4>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 安装 Playwright 库</span></span><br><span class="line">pip install playwright</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装浏览器驱动</span></span><br><span class="line">playwright install</span><br></pre></td></tr></table></figure>
<h4 id="Node-js-环境">Node.js 环境</h4>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 使用 npm</span></span><br><span class="line">npm init playwright@latest</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用 yarn</span></span><br><span class="line">yarn create playwright</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用 pnpm</span></span><br><span class="line">pnpm create playwright</span><br></pre></td></tr></table></figure>
<h3 id="3-2-验证安装">3.2 验证安装</h3>
<p>创建一个简单的测试脚本验证环境是否正常：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> playwright.sync_api <span class="keyword">import</span> sync_playwright</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test_installation</span>():</span><br><span class="line">    <span class="keyword">with</span> sync_playwright() <span class="keyword">as</span> p:</span><br><span class="line">        <span class="comment"># 启动浏览器（headless=False 显示浏览器窗口）</span></span><br><span class="line">        browser = p.chromium.launch(headless=<span class="literal">False</span>)</span><br><span class="line">        page = browser.new_page()</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 访问百度</span></span><br><span class="line">        page.goto(<span class="string">&quot;https://www.baidu.com&quot;</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 验证页面标题</span></span><br><span class="line">        <span class="keyword">assert</span> <span class="string">&quot;百度&quot;</span> <span class="keyword">in</span> page.title()</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;环境搭建成功！&quot;</span>)</span><br><span class="line">        </span><br><span class="line">        browser.close()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    test_installation()</span><br></pre></td></tr></table></figure>
<h3 id="3-3-浏览器配置">3.3 浏览器配置</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 浏览器启动配置</span></span><br><span class="line">browser = p.chromium.launch(</span><br><span class="line">    headless=<span class="literal">False</span>,          <span class="comment"># 是否无头模式</span></span><br><span class="line">    slow_mo=<span class="number">50</span>,              <span class="comment"># 慢动作执行（毫秒）</span></span><br><span class="line">    args=[                   <span class="comment"># 浏览器启动参数</span></span><br><span class="line">        <span class="string">&quot;--start-maximized&quot;</span>,</span><br><span class="line">        <span class="string">&quot;--disable-gpu&quot;</span>,</span><br><span class="line">        <span class="string">&quot;--no-sandbox&quot;</span></span><br><span class="line">    ],</span><br><span class="line">    devtools=<span class="literal">True</span>            <span class="comment"># 自动打开开发者工具</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="4-基本用法">4. 基本用法</h2>
<h3 id="4-1-同步-API-vs-异步-API">4.1 同步 API vs 异步 API</h3>
<h4 id="同步-API">同步 API</h4>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> playwright.sync_api <span class="keyword">import</span> sync_playwright</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> sync_playwright() <span class="keyword">as</span> p:</span><br><span class="line">    browser = p.chromium.launch()</span><br><span class="line">    page = browser.new_page()</span><br><span class="line">    page.goto(<span class="string">&quot;https://example.com&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(page.title())</span><br><span class="line">    browser.close()</span><br></pre></td></tr></table></figure>
<h4 id="异步-API">异步 API</h4>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"><span class="keyword">from</span> playwright.async_api <span class="keyword">import</span> async_playwright</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    <span class="keyword">async</span> <span class="keyword">with</span> async_playwright() <span class="keyword">as</span> p:</span><br><span class="line">        browser = <span class="keyword">await</span> p.chromium.launch()</span><br><span class="line">        page = <span class="keyword">await</span> browser.new_page()</span><br><span class="line">        <span class="keyword">await</span> page.goto(<span class="string">&quot;https://example.com&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="keyword">await</span> page.title())</span><br><span class="line">        <span class="keyword">await</span> browser.close()</span><br><span class="line"></span><br><span class="line">asyncio.run(main())</span><br></pre></td></tr></table></figure>
<h3 id="4-2-页面导航">4.2 页面导航</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 基本导航</span></span><br><span class="line">page.goto(<span class="string">&quot;https://example.com&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 等待页面加载完成</span></span><br><span class="line">page.goto(<span class="string">&quot;https://example.com&quot;</span>, wait_until=<span class="string">&quot;networkidle&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 前进后退</span></span><br><span class="line">page.go_back()</span><br><span class="line">page.go_forward()</span><br><span class="line">page.reload()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取当前 URL</span></span><br><span class="line">current_url = page.url</span><br></pre></td></tr></table></figure>
<h3 id="4-3-页面操作">4.3 页面操作</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 截图</span></span><br><span class="line">page.screenshot(path=<span class="string">&quot;screenshot.png&quot;</span>, full_page=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 生成 PDF（仅 Chromium 支持）</span></span><br><span class="line">page.pdf(path=<span class="string">&quot;page.pdf&quot;</span>, <span class="built_in">format</span>=<span class="string">&quot;A4&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 滚动页面</span></span><br><span class="line">page.scroll_by_amount(<span class="number">0</span>, <span class="number">500</span>)  <span class="comment"># 向下滚动 500px</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取页面内容</span></span><br><span class="line">content = page.content()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 等待页面状态</span></span><br><span class="line">page.wait_for_load_state(<span class="string">&quot;load&quot;</span>)      <span class="comment"># 等待 load 事件</span></span><br><span class="line">page.wait_for_load_state(<span class="string">&quot;domcontentloaded&quot;</span>)  <span class="comment"># 等待 DOM 加载完成</span></span><br><span class="line">page.wait_for_load_state(<span class="string">&quot;networkidle&quot;</span>)  <span class="comment"># 等待网络空闲</span></span><br></pre></td></tr></table></figure>
<hr>
<h2 id="5-元素定位与操作">5. 元素定位与操作</h2>
<h3 id="5-1-定位策略">5.1 定位策略</h3>
<h4 id="文本定位">文本定位</h4>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 精确文本匹配</span></span><br><span class="line">page.locator(<span class="string">&quot;text=Submit&quot;</span>).click()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 包含文本匹配</span></span><br><span class="line">page.locator(<span class="string">&quot;text=Log in&quot;</span>).click()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 正则表达式匹配</span></span><br><span class="line">page.locator(<span class="string">&quot;text=/^Submit$/&quot;</span>).click()</span><br></pre></td></tr></table></figure>
<h4 id="CSS-选择器定位">CSS 选择器定位</h4>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ID 选择器</span></span><br><span class="line">page.locator(<span class="string">&quot;#username&quot;</span>).fill(<span class="string">&quot;admin&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Class 选择器</span></span><br><span class="line">page.locator(<span class="string">&quot;.btn-primary&quot;</span>).click()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 属性选择器</span></span><br><span class="line">page.locator(<span class="string">&quot;[name=&#x27;email&#x27;]&quot;</span>).fill(<span class="string">&quot;test@example.com&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 组合选择器</span></span><br><span class="line">page.locator(<span class="string">&quot;form#login input[type=&#x27;password&#x27;]&quot;</span>).fill(<span class="string">&quot;password&quot;</span>)</span><br></pre></td></tr></table></figure>
<h4 id="XPath-定位">XPath 定位</h4>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 绝对 XPath</span></span><br><span class="line">page.locator(<span class="string">&quot;/html/body/div[1]/form/input[2]&quot;</span>).click()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 相对 XPath</span></span><br><span class="line">page.locator(<span class="string">&quot;//input[@id=&#x27;username&#x27;]&quot;</span>).fill(<span class="string">&quot;admin&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 文本 XPath</span></span><br><span class="line">page.locator(<span class="string">&quot;//button[text()=&#x27;Submit&#x27;]&quot;</span>).click()</span><br></pre></td></tr></table></figure>
<h4 id="ARIA-角色定位">ARIA 角色定位</h4>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 按角色定位</span></span><br><span class="line">page.locator(<span class="string">&quot;role=button&quot;</span>, name=<span class="string">&quot;Submit&quot;</span>).click()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 按标签定位</span></span><br><span class="line">page.locator(<span class="string">&quot;label=Username&quot;</span>).fill(<span class="string">&quot;admin&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 按占位符定位</span></span><br><span class="line">page.locator(<span class="string">&quot;placeholder=Enter your email&quot;</span>).fill(<span class="string">&quot;test@example.com&quot;</span>)</span><br></pre></td></tr></table></figure>
<h3 id="5-2-元素操作">5.2 元素操作</h3>
<h4 id="输入操作">输入操作</h4>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 填充文本</span></span><br><span class="line">page.locator(<span class="string">&quot;#username&quot;</span>).fill(<span class="string">&quot;admin&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 清空文本</span></span><br><span class="line">page.locator(<span class="string">&quot;#username&quot;</span>).clear()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 输入文本（模拟键盘输入）</span></span><br><span class="line">page.locator(<span class="string">&quot;#username&quot;</span>).<span class="built_in">type</span>(<span class="string">&quot;admin&quot;</span>, delay=<span class="number">100</span>)  <span class="comment"># 延迟 100ms 输入</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 按下键盘</span></span><br><span class="line">page.keyboard.press(<span class="string">&quot;Enter&quot;</span>)</span><br><span class="line">page.keyboard.<span class="built_in">type</span>(<span class="string">&quot;Hello World!&quot;</span>)</span><br></pre></td></tr></table></figure>
<h4 id="点击操作">点击操作</h4>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 基本点击</span></span><br><span class="line">page.locator(<span class="string">&quot;button#submit&quot;</span>).click()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 双击</span></span><br><span class="line">page.locator(<span class="string">&quot;div#item&quot;</span>).dblclick()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 右键点击</span></span><br><span class="line">page.locator(<span class="string">&quot;div#menu&quot;</span>).click(button=<span class="string">&quot;right&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 按下 Shift 点击</span></span><br><span class="line">page.locator(<span class="string">&quot;checkbox#select-all&quot;</span>).click(modifiers=[<span class="string">&quot;Shift&quot;</span>])</span><br></pre></td></tr></table></figure>
<h4 id="表单操作">表单操作</h4>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 选择下拉框</span></span><br><span class="line">page.locator(<span class="string">&quot;select#country&quot;</span>).select_option(<span class="string">&quot;China&quot;</span>)</span><br><span class="line">page.locator(<span class="string">&quot;select#country&quot;</span>).select_option(value=<span class="string">&quot;CN&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 勾选复选框</span></span><br><span class="line">page.locator(<span class="string">&quot;checkbox#agree&quot;</span>).check()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 取消勾选</span></span><br><span class="line">page.locator(<span class="string">&quot;checkbox#agree&quot;</span>).uncheck()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 上传文件</span></span><br><span class="line">page.locator(<span class="string">&quot;input[type=&#x27;file&#x27;]&quot;</span>).set_input_files(<span class="string">&quot;document.pdf&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 上传多个文件</span></span><br><span class="line">page.locator(<span class="string">&quot;input[type=&#x27;file&#x27;]&quot;</span>).set_input_files([<span class="string">&quot;file1.txt&quot;</span>, <span class="string">&quot;file2.txt&quot;</span>])</span><br></pre></td></tr></table></figure>
<h3 id="5-3-元素状态检查">5.3 元素状态检查</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 检查元素是否可见</span></span><br><span class="line"><span class="keyword">if</span> page.locator(<span class="string">&quot;div.success-message&quot;</span>).is_visible():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;操作成功&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 检查元素是否存在</span></span><br><span class="line"><span class="keyword">if</span> page.locator(<span class="string">&quot;button#submit&quot;</span>).is_enabled():</span><br><span class="line">    page.locator(<span class="string">&quot;button#submit&quot;</span>).click()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 等待元素出现</span></span><br><span class="line">page.locator(<span class="string">&quot;div.loading&quot;</span>).wait_for(state=<span class="string">&quot;hidden&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取元素属性</span></span><br><span class="line">value = page.locator(<span class="string">&quot;input#username&quot;</span>).input_value()</span><br><span class="line">text = page.locator(<span class="string">&quot;div.message&quot;</span>).text_content()</span><br><span class="line">attribute = page.locator(<span class="string">&quot;img.logo&quot;</span>).get_attribute(<span class="string">&quot;src&quot;</span>)</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="6-智能等待机制">6. 智能等待机制</h2>
<h3 id="6-1-自动等待原理">6.1 自动等待原理</h3>
<p>Playwright 的所有操作都会自动等待元素满足以下条件：</p>
<ol>
<li class="lvl-3">
<p><strong>元素已附加到 DOM</strong>（attached）</p>
</li>
<li class="lvl-3">
<p><strong>元素可见</strong>（visible）</p>
</li>
<li class="lvl-3">
<p><strong>元素稳定</strong>（stable，没有动画）</p>
</li>
<li class="lvl-3">
<p><strong>元素能够接收事件</strong>（not obscured）</p>
</li>
<li class="lvl-3">
<p><strong>元素已启用</strong>（enabled）</p>
</li>
</ol>
<h3 id="6-2-显式等待">6.2 显式等待</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 等待元素可见</span></span><br><span class="line">page.locator(<span class="string">&quot;div.result&quot;</span>).wait_for(state=<span class="string">&quot;visible&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 等待元素隐藏</span></span><br><span class="line">page.locator(<span class="string">&quot;div.loading&quot;</span>).wait_for(state=<span class="string">&quot;hidden&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 等待元素包含特定文本</span></span><br><span class="line">page.locator(<span class="string">&quot;div.message&quot;</span>).wait_for(text=<span class="string">&quot;Success&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 等待自定义条件</span></span><br><span class="line">page.wait_for_function(<span class="string">&quot;() =&gt; document.title === &#x27;Home Page&#x27;&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 等待网络请求</span></span><br><span class="line"><span class="keyword">with</span> page.expect_request(<span class="string">&quot;**/api/data&quot;</span>) <span class="keyword">as</span> request_info:</span><br><span class="line">    page.click(<span class="string">&quot;button#load-data&quot;</span>)</span><br><span class="line">request = request_info.value</span><br></pre></td></tr></table></figure>
<h3 id="6-3-等待超时配置">6.3 等待超时配置</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 全局超时配置</span></span><br><span class="line">context = browser.new_context(timeout=<span class="number">30000</span>)  <span class="comment"># 30 秒</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 单个操作超时</span></span><br><span class="line">page.locator(<span class="string">&quot;button#submit&quot;</span>).click(timeout=<span class="number">5000</span>)  <span class="comment"># 5 秒</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 页面导航超时</span></span><br><span class="line">page.goto(<span class="string">&quot;https://example.com&quot;</span>, timeout=<span class="number">10000</span>)  <span class="comment"># 10 秒</span></span><br></pre></td></tr></table></figure>
<hr>
<h2 id="7-网络请求处理">7. 网络请求处理</h2>
<h3 id="7-1-请求拦截与-Mock">7.1 请求拦截与 Mock</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 拦截所有请求</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">handle_route</span>(<span class="params">route</span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&quot;api/user&quot;</span> <span class="keyword">in</span> route.request.url:</span><br><span class="line">        <span class="comment"># Mock API 响应</span></span><br><span class="line">        route.fulfill(</span><br><span class="line">            status=<span class="number">200</span>,</span><br><span class="line">            content_type=<span class="string">&quot;application/json&quot;</span>,</span><br><span class="line">            body=<span class="string">&#x27;&#123;&quot;id&quot;: 123, &quot;name&quot;: &quot;Test User&quot;, &quot;email&quot;: &quot;test@example.com&quot;&#125;&#x27;</span></span><br><span class="line">        )</span><br><span class="line">    <span class="keyword">elif</span> route.request.url.endswith(<span class="string">&quot;.png&quot;</span>):</span><br><span class="line">        <span class="comment"># 阻止图片加载</span></span><br><span class="line">        route.abort()</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="comment"># 继续其他请求</span></span><br><span class="line">        route.continue_()</span><br><span class="line"></span><br><span class="line">page.route(<span class="string">&quot;**/*&quot;</span>, handle_route)</span><br></pre></td></tr></table></figure>
<h3 id="7-2-模拟网络错误">7.2 模拟网络错误</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 模拟 500 错误</span></span><br><span class="line">page.route(<span class="string">&quot;**/api/payment&quot;</span>, <span class="keyword">lambda</span> route: route.fulfill(</span><br><span class="line">    status=<span class="number">500</span>,</span><br><span class="line">    content_type=<span class="string">&quot;text/plain&quot;</span>,</span><br><span class="line">    body=<span class="string">&quot;Internal Server Error&quot;</span></span><br><span class="line">))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 模拟网络延迟</span></span><br><span class="line">page.route(<span class="string">&quot;**/api/slow&quot;</span>, <span class="keyword">lambda</span> route: route.continue_(delay=<span class="number">3000</span>))  <span class="comment"># 延迟 3 秒</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 模拟网络中断</span></span><br><span class="line">page.route(<span class="string">&quot;**/api/offline&quot;</span>, <span class="keyword">lambda</span> route: route.abort(<span class="string">&quot;connectionrefused&quot;</span>))</span><br></pre></td></tr></table></figure>
<h3 id="7-3-请求监控">7.3 请求监控</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 监听所有请求</span></span><br><span class="line">page.on(<span class="string">&quot;request&quot;</span>, <span class="keyword">lambda</span> request: <span class="built_in">print</span>(<span class="string">f&quot;&gt;&gt; <span class="subst">&#123;request.method&#125;</span> <span class="subst">&#123;request.url&#125;</span>&quot;</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 监听所有响应</span></span><br><span class="line">page.on(<span class="string">&quot;response&quot;</span>, <span class="keyword">lambda</span> response: <span class="built_in">print</span>(<span class="string">f&quot;&lt;&lt; <span class="subst">&#123;response.status&#125;</span> <span class="subst">&#123;response.url&#125;</span>&quot;</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 监听请求失败</span></span><br><span class="line">page.on(<span class="string">&quot;requestfailed&quot;</span>, <span class="keyword">lambda</span> request: <span class="built_in">print</span>(<span class="string">f&quot;!! <span class="subst">&#123;request.url&#125;</span> <span class="subst">&#123;request.failure&#125;</span>&quot;</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 捕获特定请求</span></span><br><span class="line"><span class="keyword">with</span> page.expect_request(<span class="string">&quot;**/api/login&quot;</span>) <span class="keyword">as</span> request_info:</span><br><span class="line">    page.click(<span class="string">&quot;button#login&quot;</span>)</span><br><span class="line">login_request = request_info.value</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;Login request: <span class="subst">&#123;login_request.post_data&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>
<h3 id="7-4-HTTP-认证">7.4 HTTP 认证</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 基本认证</span></span><br><span class="line">context = browser.new_context(</span><br><span class="line">    http_credentials=&#123;<span class="string">&quot;username&quot;</span>: <span class="string">&quot;user&quot;</span>, <span class="string">&quot;password&quot;</span>: <span class="string">&quot;pass&quot;</span>&#125;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 代理设置</span></span><br><span class="line">context = browser.new_context(</span><br><span class="line">    proxy=&#123;</span><br><span class="line">        <span class="string">&quot;server&quot;</span>: <span class="string">&quot;http://proxy.example.com:8080&quot;</span>,</span><br><span class="line">        <span class="string">&quot;username&quot;</span>: <span class="string">&quot;proxyuser&quot;</span>,</span><br><span class="line">        <span class="string">&quot;password&quot;</span>: <span class="string">&quot;proxypass&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="8-高级特性">8. 高级特性</h2>
<h3 id="8-1-多页面和弹出窗口">8.1 多页面和弹出窗口</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 处理新页面</span></span><br><span class="line"><span class="keyword">with</span> page.expect_popup() <span class="keyword">as</span> popup_info:</span><br><span class="line">    page.click(<span class="string">&quot;a[target=&#x27;_blank&#x27;]&quot;</span>)</span><br><span class="line">popup_page = popup_info.value</span><br><span class="line"></span><br><span class="line"><span class="comment"># 处理下载</span></span><br><span class="line"><span class="keyword">with</span> page.expect_download() <span class="keyword">as</span> download_info:</span><br><span class="line">    page.click(<span class="string">&quot;button#download&quot;</span>)</span><br><span class="line">download = download_info.value</span><br><span class="line">download.save_as(<span class="string">&quot;file.pdf&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 处理对话框</span></span><br><span class="line">page.on(<span class="string">&quot;dialog&quot;</span>, <span class="keyword">lambda</span> dialog: dialog.accept())  <span class="comment"># 接受对话框</span></span><br><span class="line">page.on(<span class="string">&quot;dialog&quot;</span>, <span class="keyword">lambda</span> dialog: dialog.dismiss())  <span class="comment"># 取消对话框</span></span><br><span class="line">page.on(<span class="string">&quot;dialog&quot;</span>, <span class="keyword">lambda</span> dialog: dialog.accept(<span class="string">&quot;input text&quot;</span>))  <span class="comment"># 输入文本并接受</span></span><br></pre></td></tr></table></figure>
<h3 id="8-2-iframe-处理">8.2 iframe 处理</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 获取 iframe</span></span><br><span class="line">frame = page.frame(name=<span class="string">&quot;payment-form&quot;</span>)</span><br><span class="line">frame = page.frame(url=<span class="string">&quot;https://payment.example.com/form&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 通过选择器获取 iframe</span></span><br><span class="line">iframe_element = page.locator(<span class="string">&quot;iframe#checkout&quot;</span>)</span><br><span class="line">frame = iframe_element.content_frame()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 在 iframe 内操作</span></span><br><span class="line">frame.locator(<span class="string">&quot;input#card-number&quot;</span>).fill(<span class="string">&quot;4111 1111 1111 1111&quot;</span>)</span><br><span class="line">frame.locator(<span class="string">&quot;button#pay&quot;</span>).click()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 嵌套 iframe</span></span><br><span class="line">parent_frame = page.frame(name=<span class="string">&quot;parent&quot;</span>)</span><br><span class="line">child_frame = parent_frame.frame(name=<span class="string">&quot;child&quot;</span>)</span><br></pre></td></tr></table></figure>
<h3 id="8-3-设备模拟">8.3 设备模拟</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 模拟 iPhone 13</span></span><br><span class="line">iphone_13 = playwright.devices[<span class="string">&quot;iPhone 13&quot;</span>]</span><br><span class="line">context = browser.new_context(**iphone_13)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 自定义设备模拟</span></span><br><span class="line">context = browser.new_context(</span><br><span class="line">    viewport=&#123;<span class="string">&quot;width&quot;</span>: <span class="number">375</span>, <span class="string">&quot;height&quot;</span>: <span class="number">667</span>&#125;,</span><br><span class="line">    user_agent=<span class="string">&quot;Mozilla/5.0 (iPhone; CPU iPhone OS 15_0 like Mac OS X) AppleWebKit/605.1.15&quot;</span>,</span><br><span class="line">    device_scale_factor=<span class="number">2</span>,</span><br><span class="line">    is_mobile=<span class="literal">True</span>,</span><br><span class="line">    has_touch=<span class="literal">True</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 模拟地理位置</span></span><br><span class="line">context = browser.new_context(</span><br><span class="line">    geolocation=&#123;<span class="string">&quot;longitude&quot;</span>: <span class="number">12.492507</span>, <span class="string">&quot;latitude&quot;</span>: <span class="number">41.889938</span>&#125;,</span><br><span class="line">    permissions=[<span class="string">&quot;geolocation&quot;</span>]</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 模拟颜色方案</span></span><br><span class="line">context = browser.new_context(color_scheme=<span class="string">&quot;dark&quot;</span>)  <span class="comment"># &quot;light&quot;, &quot;dark&quot;, &quot;no-preference&quot;</span></span><br></pre></td></tr></table></figure>
<h3 id="8-4-视频录制和追踪">8.4 视频录制和追踪</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 录制视频</span></span><br><span class="line">context = browser.new_context(record_video_dir=<span class="string">&quot;videos/&quot;</span>)</span><br><span class="line">page = context.new_page()</span><br><span class="line">page.goto(<span class="string">&quot;https://example.com&quot;</span>)</span><br><span class="line">context.close()  <span class="comment"># 自动保存视频</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 追踪记录</span></span><br><span class="line">context.tracing.start(screenshots=<span class="literal">True</span>, snapshots=<span class="literal">True</span>)</span><br><span class="line">page.goto(<span class="string">&quot;https://example.com&quot;</span>)</span><br><span class="line">page.click(<span class="string">&quot;button#submit&quot;</span>)</span><br><span class="line">context.tracing.stop(path=<span class="string">&quot;trace.zip&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 性能分析</span></span><br><span class="line">metrics = page.evaluate(<span class="string">&quot;&quot;&quot;() =&gt; &#123;</span></span><br><span class="line"><span class="string">    const navigation = performance.getEntriesByType(&#x27;navigation&#x27;)[0];</span></span><br><span class="line"><span class="string">    return &#123;</span></span><br><span class="line"><span class="string">        domContentLoaded: navigation.domContentLoadedEventEnd - navigation.domContentLoadedEventStart,</span></span><br><span class="line"><span class="string">        loadComplete: navigation.loadEventEnd - navigation.loadEventStart,</span></span><br><span class="line"><span class="string">        totalTime: navigation.loadEventEnd - navigation.navigationStart</span></span><br><span class="line"><span class="string">    &#125;;</span></span><br><span class="line"><span class="string">&#125;&quot;&quot;&quot;</span>)</span><br></pre></td></tr></table></figure>
<h3 id="8-5-并行执行">8.5 并行执行</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 多浏览器并行</span></span><br><span class="line"><span class="keyword">from</span> playwright.sync_api <span class="keyword">import</span> sync_playwright</span><br><span class="line"><span class="keyword">import</span> concurrent.futures</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">run_test</span>(<span class="params">browser_type</span>):</span><br><span class="line">    <span class="keyword">with</span> sync_playwright() <span class="keyword">as</span> p:</span><br><span class="line">        browser = <span class="built_in">getattr</span>(p, browser_type).launch()</span><br><span class="line">        page = browser.new_page()</span><br><span class="line">        page.goto(<span class="string">&quot;https://example.com&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;browser_type&#125;</span>: <span class="subst">&#123;page.title()&#125;</span>&quot;</span>)</span><br><span class="line">        browser.close()</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> concurrent.futures.ThreadPoolExecutor() <span class="keyword">as</span> executor:</span><br><span class="line">    executor.<span class="built_in">map</span>(run_test, [<span class="string">&quot;chromium&quot;</span>, <span class="string">&quot;firefox&quot;</span>, <span class="string">&quot;webkit&quot;</span>])</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="9-最佳实践">9. 最佳实践</h2>
<h3 id="9-1-测试设计原则">9.1 测试设计原则</h3>
<h4 id="测试用户可见行为">测试用户可见行为</h4>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ✅ 好的实践：测试用户可见的行为</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test_login_success</span>(<span class="params">page</span>):</span><br><span class="line">    page.goto(<span class="string">&quot;/login&quot;</span>)</span><br><span class="line">    page.locator(<span class="string">&quot;input#username&quot;</span>).fill(<span class="string">&quot;admin&quot;</span>)</span><br><span class="line">    page.locator(<span class="string">&quot;input#password&quot;</span>).fill(<span class="string">&quot;password&quot;</span>)</span><br><span class="line">    page.locator(<span class="string">&quot;button#submit&quot;</span>).click()</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 验证用户看到的结果</span></span><br><span class="line">    <span class="keyword">assert</span> page.is_visible(<span class="string">&quot;text=Welcome, admin!&quot;</span>)</span><br><span class="line">    <span class="keyword">assert</span> page.url.endswith(<span class="string">&quot;/dashboard&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ❌ 不好的实践：依赖实现细节</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test_login_api_call</span>(<span class="params">page</span>):</span><br><span class="line">    <span class="keyword">with</span> page.expect_request(<span class="string">&quot;**/api/login&quot;</span>) <span class="keyword">as</span> request_info:</span><br><span class="line">        page.click(<span class="string">&quot;button#submit&quot;</span>)</span><br><span class="line">    request = request_info.value</span><br><span class="line">    <span class="keyword">assert</span> request.post_data_json[<span class="string">&quot;username&quot;</span>] == <span class="string">&quot;admin&quot;</span>  <span class="comment"># 依赖 API 实现细节</span></span><br></pre></td></tr></table></figure>
<h4 id="保持测试隔离">保持测试隔离</h4>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 使用 beforeEach 确保测试隔离</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test_user_management</span>(<span class="params">page, login</span>):</span><br><span class="line">    <span class="comment"># 每个测试都有独立的登录状态</span></span><br><span class="line">    page.goto(<span class="string">&quot;/users&quot;</span>)</span><br><span class="line">    <span class="comment"># 测试逻辑...</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用上下文隔离多用户场景</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test_multi_user_scenario</span>():</span><br><span class="line">    <span class="keyword">with</span> sync_playwright() <span class="keyword">as</span> p:</span><br><span class="line">        browser = p.chromium.launch()</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 用户 1 上下文</span></span><br><span class="line">        user1_context = browser.new_context()</span><br><span class="line">        user1_page = user1_context.new_page()</span><br><span class="line">        login(user1_page, <span class="string">&quot;user1&quot;</span>, <span class="string">&quot;pass1&quot;</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 用户 2 上下文</span></span><br><span class="line">        user2_context = browser.new_context()</span><br><span class="line">        user2_page = user2_context.new_page()</span><br><span class="line">        login(user2_page, <span class="string">&quot;user2&quot;</span>, <span class="string">&quot;pass2&quot;</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 两个用户的操作完全隔离</span></span><br></pre></td></tr></table></figure>
<h3 id="9-2-代码组织模式">9.2 代码组织模式</h3>
<h4 id="Page-Object-Model-POM">Page Object Model (POM)</h4>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># page_objects/login_page.py</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">LoginPage</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, page</span>):</span><br><span class="line">        <span class="variable language_">self</span>.page = page</span><br><span class="line">        <span class="variable language_">self</span>.username_input = page.locator(<span class="string">&quot;input#username&quot;</span>)</span><br><span class="line">        <span class="variable language_">self</span>.password_input = page.locator(<span class="string">&quot;input#password&quot;</span>)</span><br><span class="line">        <span class="variable language_">self</span>.submit_button = page.locator(<span class="string">&quot;button#submit&quot;</span>)</span><br><span class="line">        <span class="variable language_">self</span>.error_message = page.locator(<span class="string">&quot;div.error&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">navigate</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.page.goto(<span class="string">&quot;/login&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">login</span>(<span class="params">self, username, password</span>):</span><br><span class="line">        <span class="variable language_">self</span>.username_input.fill(username)</span><br><span class="line">        <span class="variable language_">self</span>.password_input.fill(password)</span><br><span class="line">        <span class="variable language_">self</span>.submit_button.click()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_error_message</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>.error_message.text_content()</span><br><span class="line"></span><br><span class="line"><span class="comment"># tests/test_login.py</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test_successful_login</span>(<span class="params">page</span>):</span><br><span class="line">    login_page = LoginPage(page)</span><br><span class="line">    login_page.navigate()</span><br><span class="line">    login_page.login(<span class="string">&quot;admin&quot;</span>, <span class="string">&quot;password&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">assert</span> page.url.endswith(<span class="string">&quot;/dashboard&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test_invalid_credentials</span>(<span class="params">page</span>):</span><br><span class="line">    login_page = LoginPage(page)</span><br><span class="line">    login_page.navigate()</span><br><span class="line">    login_page.login(<span class="string">&quot;admin&quot;</span>, <span class="string">&quot;wrong_password&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">assert</span> <span class="string">&quot;Invalid credentials&quot;</span> <span class="keyword">in</span> login_page.get_error_message()</span><br></pre></td></tr></table></figure>
<h4 id="Fixture-模式">Fixture 模式</h4>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># conftest.py</span></span><br><span class="line"><span class="keyword">import</span> pytest</span><br><span class="line"><span class="keyword">from</span> playwright.sync_api <span class="keyword">import</span> sync_playwright</span><br><span class="line"></span><br><span class="line"><span class="meta">@pytest.fixture(<span class="params">scope=<span class="string">&quot;session&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">playwright</span>():</span><br><span class="line">    <span class="keyword">with</span> sync_playwright() <span class="keyword">as</span> p:</span><br><span class="line">        <span class="keyword">yield</span> p</span><br><span class="line"></span><br><span class="line"><span class="meta">@pytest.fixture(<span class="params">scope=<span class="string">&quot;function&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">browser</span>(<span class="params">playwright</span>):</span><br><span class="line">    browser = playwright.chromium.launch(headless=<span class="literal">True</span>)</span><br><span class="line">    <span class="keyword">yield</span> browser</span><br><span class="line">    browser.close()</span><br><span class="line"></span><br><span class="line"><span class="meta">@pytest.fixture(<span class="params">scope=<span class="string">&quot;function&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">page</span>(<span class="params">browser</span>):</span><br><span class="line">    page = browser.new_page()</span><br><span class="line">    <span class="keyword">yield</span> page</span><br><span class="line">    page.close()</span><br><span class="line"></span><br><span class="line"><span class="meta">@pytest.fixture(<span class="params">scope=<span class="string">&quot;function&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">authenticated_page</span>(<span class="params">page</span>):</span><br><span class="line">    <span class="comment"># 登录逻辑</span></span><br><span class="line">    page.goto(<span class="string">&quot;/login&quot;</span>)</span><br><span class="line">    page.locator(<span class="string">&quot;input#username&quot;</span>).fill(<span class="string">&quot;admin&quot;</span>)</span><br><span class="line">    page.locator(<span class="string">&quot;input#password&quot;</span>).fill(<span class="string">&quot;password&quot;</span>)</span><br><span class="line">    page.locator(<span class="string">&quot;button#submit&quot;</span>).click()</span><br><span class="line">    <span class="keyword">return</span> page</span><br></pre></td></tr></table></figure>
<h3 id="9-3-性能优化">9.3 性能优化</h3>
<h4 id="选择性截图">选择性截图</h4>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 只在测试失败时截图</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test_critical_functionality</span>(<span class="params">page, request</span>):</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="comment"># 测试逻辑</span></span><br><span class="line">        page.goto(<span class="string">&quot;/critical-feature&quot;</span>)</span><br><span class="line">        page.click(<span class="string">&quot;button#execute&quot;</span>)</span><br><span class="line">        <span class="keyword">assert</span> page.is_visible(<span class="string">&quot;text=Success&quot;</span>)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="comment"># 失败时截图</span></span><br><span class="line">        screenshot_path = <span class="string">f&quot;screenshots/<span class="subst">&#123;request.node.name&#125;</span>.png&quot;</span></span><br><span class="line">        page.screenshot(path=screenshot_path, full_page=<span class="literal">True</span>)</span><br><span class="line">        <span class="keyword">raise</span> e</span><br></pre></td></tr></table></figure>
<h4 id="网络优化">网络优化</h4>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 阻止不必要的资源加载</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">optimize_network</span>(<span class="params">page</span>):</span><br><span class="line">    <span class="comment"># 阻止图片加载</span></span><br><span class="line">    page.route(<span class="string">&quot;**/*.&#123;png,jpg,jpeg,gif,svg&#125;&quot;</span>, <span class="keyword">lambda</span> route: route.abort())</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 阻止第三方脚本</span></span><br><span class="line">    page.route(<span class="string">&quot;**/*.&#123;js&#125;&quot;</span>, <span class="keyword">lambda</span> route: route.abort() <span class="keyword">if</span> <span class="string">&quot;analytics&quot;</span> <span class="keyword">in</span> route.request.url <span class="keyword">else</span> route.continue_())</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># Mock API 响应</span></span><br><span class="line">    page.route(<span class="string">&quot;**/api/slow-data&quot;</span>, <span class="keyword">lambda</span> route: route.fulfill(</span><br><span class="line">        status=<span class="number">200</span>,</span><br><span class="line">        content_type=<span class="string">&quot;application/json&quot;</span>,</span><br><span class="line">        body=<span class="string">&#x27;&#123;&quot;data&quot;: []&#125;&#x27;</span></span><br><span class="line">    ))</span><br></pre></td></tr></table></figure>
<h3 id="9-4-调试技巧">9.4 调试技巧</h3>
<h4 id="可视化调试">可视化调试</h4>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 慢动作执行</span></span><br><span class="line">browser = p.chromium.launch(headless=<span class="literal">False</span>, slow_mo=<span class="number">100</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 自动打开开发者工具</span></span><br><span class="line">browser = p.chromium.launch(headless=<span class="literal">False</span>, devtools=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 页面暂停</span></span><br><span class="line">page.pause()  <span class="comment"># 会打开 Playwright Inspector</span></span><br></pre></td></tr></table></figure>
<h4 id="日志记录">日志记录</h4>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"></span><br><span class="line">logging.basicConfig(level=logging.INFO)</span><br><span class="line">logger = logging.getLogger(__name__)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test_with_logging</span>(<span class="params">page</span>):</span><br><span class="line">    logger.info(<span class="string">&quot;Starting login test&quot;</span>)</span><br><span class="line">    page.goto(<span class="string">&quot;/login&quot;</span>)</span><br><span class="line">    logger.info(<span class="string">f&quot;Current URL: <span class="subst">&#123;page.url&#125;</span>&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 记录页面状态</span></span><br><span class="line">    page.on(<span class="string">&quot;request&quot;</span>, <span class="keyword">lambda</span> req: logger.debug(<span class="string">f&quot;Request: <span class="subst">&#123;req.method&#125;</span> <span class="subst">&#123;req.url&#125;</span>&quot;</span>))</span><br><span class="line">    page.on(<span class="string">&quot;response&quot;</span>, <span class="keyword">lambda</span> res: logger.debug(<span class="string">f&quot;Response: <span class="subst">&#123;res.status&#125;</span> <span class="subst">&#123;res.url&#125;</span>&quot;</span>))</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="10-实战案例">10. 实战案例</h2>
<h3 id="10-1-电商网站测试案例">10.1 电商网站测试案例</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">ECommerceTest</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, page</span>):</span><br><span class="line">        <span class="variable language_">self</span>.page = page</span><br><span class="line">        <span class="variable language_">self</span>.product_list = page.locator(<span class="string">&quot;div.product-item&quot;</span>)</span><br><span class="line">        <span class="variable language_">self</span>.add_to_cart_button = page.locator(<span class="string">&quot;button.add-to-cart&quot;</span>)</span><br><span class="line">        <span class="variable language_">self</span>.cart_icon = page.locator(<span class="string">&quot;div.cart-icon&quot;</span>)</span><br><span class="line">        <span class="variable language_">self</span>.checkout_button = page.locator(<span class="string">&quot;button.checkout&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">search_product</span>(<span class="params">self, keyword</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;搜索商品&quot;&quot;&quot;</span></span><br><span class="line">        search_input = <span class="variable language_">self</span>.page.locator(<span class="string">&quot;input#search&quot;</span>)</span><br><span class="line">        search_input.fill(keyword)</span><br><span class="line">        search_input.press(<span class="string">&quot;Enter&quot;</span>)</span><br><span class="line">        <span class="variable language_">self</span>.page.wait_for_load_state(<span class="string">&quot;networkidle&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">add_product_to_cart</span>(<span class="params">self, product_index=<span class="number">0</span></span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;添加商品到购物车&quot;&quot;&quot;</span></span><br><span class="line">        products = <span class="variable language_">self</span>.product_list.<span class="built_in">all</span>()</span><br><span class="line">        <span class="keyword">if</span> products:</span><br><span class="line">            product = products[product_index]</span><br><span class="line">            product.hover()</span><br><span class="line">            add_button = product.locator(<span class="string">&quot;button.add-to-cart&quot;</span>)</span><br><span class="line">            add_button.click()</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 等待添加成功提示</span></span><br><span class="line">            <span class="variable language_">self</span>.page.locator(<span class="string">&quot;div.added-to-cart&quot;</span>).wait_for(state=<span class="string">&quot;visible&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">go_to_cart</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;进入购物车&quot;&quot;&quot;</span></span><br><span class="line">        <span class="variable language_">self</span>.cart_icon.click()</span><br><span class="line">        <span class="variable language_">self</span>.page.wait_for_url(<span class="string">&quot;**/cart&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">proceed_to_checkout</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;进入结算页面&quot;&quot;&quot;</span></span><br><span class="line">        <span class="variable language_">self</span>.checkout_button.click()</span><br><span class="line">        <span class="variable language_">self</span>.page.wait_for_url(<span class="string">&quot;**/checkout&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test_ecommerce_flow</span>(<span class="params">page</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;完整电商流程测试&quot;&quot;&quot;</span></span><br><span class="line">    ecommerce = ECommerceTest(page)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 1. 访问首页</span></span><br><span class="line">    page.goto(<span class="string">&quot;https://example-ecommerce.com&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 2. 搜索商品</span></span><br><span class="line">    ecommerce.search_product(<span class="string">&quot;laptop&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 3. 添加商品到购物车</span></span><br><span class="line">    ecommerce.add_product_to_cart()</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 4. 验证购物车数量</span></span><br><span class="line">    cart_count = ecommerce.cart_icon.text_content()</span><br><span class="line">    <span class="keyword">assert</span> cart_count == <span class="string">&quot;1&quot;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 5. 进入购物车</span></span><br><span class="line">    ecommerce.go_to_cart()</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 6. 验证商品在购物车中</span></span><br><span class="line">    <span class="keyword">assert</span> page.is_visible(<span class="string">&quot;text=Laptop&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 7. 进入结算页面</span></span><br><span class="line">    ecommerce.proceed_to_checkout()</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 8. 填写结算信息</span></span><br><span class="line">    page.locator(<span class="string">&quot;input#shipping-address&quot;</span>).fill(<span class="string">&quot;123 Test St&quot;</span>)</span><br><span class="line">    page.locator(<span class="string">&quot;input#credit-card&quot;</span>).fill(<span class="string">&quot;4111 1111 1111 1111&quot;</span>)</span><br><span class="line">    page.locator(<span class="string">&quot;button#place-order&quot;</span>).click()</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 9. 验证订单成功</span></span><br><span class="line">    <span class="keyword">assert</span> page.is_visible(<span class="string">&quot;text=Order placed successfully&quot;</span>)</span><br><span class="line">    <span class="keyword">assert</span> page.url.endswith(<span class="string">&quot;/order-confirmation&quot;</span>)</span><br></pre></td></tr></table></figure>
<h3 id="10-2-数据抓取案例">10.2 数据抓取案例</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> csv</span><br><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"><span class="keyword">from</span> playwright.async_api <span class="keyword">import</span> async_playwright</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">DataScraper</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, browser</span>):</span><br><span class="line">        <span class="variable language_">self</span>.browser = browser</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">scrape_page</span>(<span class="params">self, url</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;抓取单个页面数据&quot;&quot;&quot;</span></span><br><span class="line">        page = <span class="keyword">await</span> <span class="variable language_">self</span>.browser.new_page()</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">await</span> page.goto(url)</span><br><span class="line">            <span class="keyword">await</span> page.wait_for_load_state(<span class="string">&quot;networkidle&quot;</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 抓取数据</span></span><br><span class="line">            products = []</span><br><span class="line">            product_elements = <span class="keyword">await</span> page.query_selector_all(<span class="string">&quot;div.product-item&quot;</span>)</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">for</span> element <span class="keyword">in</span> product_elements:</span><br><span class="line">                product = &#123;</span><br><span class="line">                    <span class="string">&quot;name&quot;</span>: <span class="keyword">await</span> element.locator(<span class="string">&quot;h3.product-name&quot;</span>).text_content(),</span><br><span class="line">                    <span class="string">&quot;price&quot;</span>: <span class="keyword">await</span> element.locator(<span class="string">&quot;span.price&quot;</span>).text_content(),</span><br><span class="line">                    <span class="string">&quot;rating&quot;</span>: <span class="keyword">await</span> element.locator(<span class="string">&quot;div.rating&quot;</span>).text_content(),</span><br><span class="line">                    <span class="string">&quot;image_url&quot;</span>: <span class="keyword">await</span> element.locator(<span class="string">&quot;img.product-image&quot;</span>).get_attribute(<span class="string">&quot;src&quot;</span>)</span><br><span class="line">                &#125;</span><br><span class="line">                products.append(product)</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">return</span> products</span><br><span class="line">        <span class="keyword">finally</span>:</span><br><span class="line">            <span class="keyword">await</span> page.close()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">scrape_multiple_pages</span>(<span class="params">self, base_url, total_pages</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;抓取多页数据&quot;&quot;&quot;</span></span><br><span class="line">        all_products = []</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> page_num <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, total_pages + <span class="number">1</span>):</span><br><span class="line">            url = <span class="string">f&quot;<span class="subst">&#123;base_url&#125;</span>?page=<span class="subst">&#123;page_num&#125;</span>&quot;</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;Scraping page <span class="subst">&#123;page_num&#125;</span>: <span class="subst">&#123;url&#125;</span>&quot;</span>)</span><br><span class="line">            </span><br><span class="line">            page_data = <span class="keyword">await</span> <span class="variable language_">self</span>.scrape_page(url)</span><br><span class="line">            all_products.extend(page_data)</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># 随机延迟避免被封</span></span><br><span class="line">            <span class="keyword">await</span> asyncio.sleep(<span class="number">1</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> all_products</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">save_to_csv</span>(<span class="params">self, data, filename</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;保存数据到 CSV 文件&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> data:</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(filename, mode=<span class="string">&#x27;w&#x27;</span>, newline=<span class="string">&#x27;&#x27;</span>, encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> file:</span><br><span class="line">            writer = csv.DictWriter(file, fieldnames=data[<span class="number">0</span>].keys())</span><br><span class="line">            writer.writeheader()</span><br><span class="line">            writer.writerows(data)</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    <span class="keyword">async</span> <span class="keyword">with</span> async_playwright() <span class="keyword">as</span> p:</span><br><span class="line">        <span class="comment"># 启动浏览器（无头模式）</span></span><br><span class="line">        browser = <span class="keyword">await</span> p.chromium.launch(headless=<span class="literal">True</span>)</span><br><span class="line">        </span><br><span class="line">        scraper = DataScraper(browser)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 抓取数据</span></span><br><span class="line">        base_url = <span class="string">&quot;https://example-ecommerce.com/products&quot;</span></span><br><span class="line">        products = <span class="keyword">await</span> scraper.scrape_multiple_pages(base_url, total_pages=<span class="number">5</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 保存数据</span></span><br><span class="line">        scraper.save_to_csv(products, <span class="string">&quot;products.csv&quot;</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;Scraped <span class="subst">&#123;<span class="built_in">len</span>(products)&#125;</span> products successfully!&quot;</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">await</span> browser.close()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    asyncio.run(main())</span><br></pre></td></tr></table></figure>
<h3 id="10-3-API-测试集成">10.3 API 测试集成</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pytest</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> playwright.sync_api <span class="keyword">import</span> sync_playwright</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">APITester</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, base_url</span>):</span><br><span class="line">        <span class="variable language_">self</span>.base_url = base_url</span><br><span class="line">        <span class="variable language_">self</span>.session = requests.Session()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_user</span>(<span class="params">self, user_id</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;获取用户信息&quot;&quot;&quot;</span></span><br><span class="line">        response = <span class="variable language_">self</span>.session.get(<span class="string">f&quot;<span class="subst">&#123;self.base_url&#125;</span>/api/users/<span class="subst">&#123;user_id&#125;</span>&quot;</span>)</span><br><span class="line">        response.raise_for_status()</span><br><span class="line">        <span class="keyword">return</span> response.json()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">create_user</span>(<span class="params">self, user_data</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;创建用户&quot;&quot;&quot;</span></span><br><span class="line">        response = <span class="variable language_">self</span>.session.post(<span class="string">f&quot;<span class="subst">&#123;self.base_url&#125;</span>/api/users&quot;</span>, json=user_data)</span><br><span class="line">        response.raise_for_status()</span><br><span class="line">        <span class="keyword">return</span> response.json()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">update_user</span>(<span class="params">self, user_id, user_data</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;更新用户信息&quot;&quot;&quot;</span></span><br><span class="line">        response = <span class="variable language_">self</span>.session.put(<span class="string">f&quot;<span class="subst">&#123;self.base_url&#125;</span>/api/users/<span class="subst">&#123;user_id&#125;</span>&quot;</span>, json=user_data)</span><br><span class="line">        response.raise_for_status()</span><br><span class="line">        <span class="keyword">return</span> response.json()</span><br><span class="line"></span><br><span class="line"><span class="meta">@pytest.fixture(<span class="params">scope=<span class="string">&quot;module&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">api_tester</span>():</span><br><span class="line">    <span class="string">&quot;&quot;&quot;API 测试器 fixture&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">return</span> APITester(<span class="string">&quot;https://api.example.com&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test_api_and_ui_integration</span>(<span class="params">api_tester, page</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;API 和 UI 集成测试&quot;&quot;&quot;</span></span><br><span class="line">    <span class="comment"># 1. 通过 API 创建测试用户</span></span><br><span class="line">    user_data = &#123;</span><br><span class="line">        <span class="string">&quot;name&quot;</span>: <span class="string">&quot;Test User&quot;</span>,</span><br><span class="line">        <span class="string">&quot;email&quot;</span>: <span class="string">&quot;test@example.com&quot;</span>,</span><br><span class="line">        <span class="string">&quot;password&quot;</span>: <span class="string">&quot;password123&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">    created_user = api_tester.create_user(user_data)</span><br><span class="line">    user_id = created_user[<span class="string">&quot;id&quot;</span>]</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="comment"># 2. 通过 UI 登录</span></span><br><span class="line">        page.goto(<span class="string">&quot;https://example.com/login&quot;</span>)</span><br><span class="line">        page.locator(<span class="string">&quot;input#email&quot;</span>).fill(user_data[<span class="string">&quot;email&quot;</span>])</span><br><span class="line">        page.locator(<span class="string">&quot;input#password&quot;</span>).fill(user_data[<span class="string">&quot;password&quot;</span>])</span><br><span class="line">        page.locator(<span class="string">&quot;button#login&quot;</span>).click()</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 3. 验证 UI 显示正确的用户信息</span></span><br><span class="line">        page.goto(<span class="string">&quot;https://example.com/profile&quot;</span>)</span><br><span class="line">        <span class="keyword">assert</span> page.locator(<span class="string">&quot;h1.username&quot;</span>).text_content() == user_data[<span class="string">&quot;name&quot;</span>]</span><br><span class="line">        <span class="keyword">assert</span> page.locator(<span class="string">&quot;div.email&quot;</span>).text_content() == user_data[<span class="string">&quot;email&quot;</span>]</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 4. 通过 UI 更新用户信息</span></span><br><span class="line">        page.locator(<span class="string">&quot;button#edit-profile&quot;</span>).click()</span><br><span class="line">        page.locator(<span class="string">&quot;input#name&quot;</span>).fill(<span class="string">&quot;Updated Name&quot;</span>)</span><br><span class="line">        page.locator(<span class="string">&quot;button#save&quot;</span>).click()</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># 5. 通过 API 验证更新结果</span></span><br><span class="line">        updated_user = api_tester.get_user(user_id)</span><br><span class="line">        <span class="keyword">assert</span> updated_user[<span class="string">&quot;name&quot;</span>] == <span class="string">&quot;Updated Name&quot;</span></span><br><span class="line">        </span><br><span class="line">    <span class="keyword">finally</span>:</span><br><span class="line">        <span class="comment"># 清理测试数据</span></span><br><span class="line">        api_tester.session.delete(<span class="string">f&quot;<span class="subst">&#123;api_tester.base_url&#125;</span>/api/users/<span class="subst">&#123;user_id&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="11-常见问题与解决方案">11. 常见问题与解决方案</h2>
<h3 id="11-1-元素定位问题">11.1 元素定位问题</h3>
<h4 id="问题：元素定位不稳定">问题：元素定位不稳定</h4>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ❌ 不稳定的定位方式</span></span><br><span class="line">page.locator(<span class="string">&quot;div:nth-child(3) &gt; button&quot;</span>).click()  <span class="comment"># 依赖页面结构</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ✅ 稳定的定位方式</span></span><br><span class="line">page.locator(<span class="string">&quot;button#submit&quot;</span>).click()  <span class="comment"># 使用 ID</span></span><br><span class="line">page.locator(<span class="string">&quot;button[type=&#x27;submit&#x27;]&quot;</span>).click()  <span class="comment"># 使用属性</span></span><br><span class="line">page.locator(<span class="string">&quot;text=Submit&quot;</span>).click()  <span class="comment"># 使用文本</span></span><br></pre></td></tr></table></figure>
<h4 id="解决方案：">解决方案：</h4>
<ol>
<li class="lvl-3">
<p><strong>优先使用 ID 和 name 属性</strong>：最稳定的定位方式</p>
</li>
<li class="lvl-3">
<p><strong>使用文本定位</strong>：对于用户可见的元素</p>
</li>
<li class="lvl-3">
<p><strong>组合定位策略</strong>：提高定位的唯一性</p>
</li>
<li class="lvl-3">
<p><strong>等待元素稳定</strong>：使用 wait_for() 方法</p>
</li>
</ol>
<h3 id="11-2-异步加载问题">11.2 异步加载问题</h3>
<h4 id="问题：页面内容动态加载导致元素找不到">问题：页面内容动态加载导致元素找不到</h4>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ❌ 直接操作，没有等待</span></span><br><span class="line">page.goto(<span class="string">&quot;/products&quot;</span>)</span><br><span class="line">page.locator(<span class="string">&quot;div.product&quot;</span>).click()  <span class="comment"># 可能还没加载完成</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ✅ 等待元素加载</span></span><br><span class="line">page.goto(<span class="string">&quot;/products&quot;</span>)</span><br><span class="line">page.locator(<span class="string">&quot;div.product&quot;</span>).wait_for(state=<span class="string">&quot;visible&quot;</span>)</span><br><span class="line">page.locator(<span class="string">&quot;div.product&quot;</span>).click()</span><br><span class="line"></span><br><span class="line"><span class="comment"># ✅ 等待网络空闲</span></span><br><span class="line">page.goto(<span class="string">&quot;/products&quot;</span>, wait_until=<span class="string">&quot;networkidle&quot;</span>)</span><br></pre></td></tr></table></figure>
<h4 id="解决方案：-2">解决方案：</h4>
<ol>
<li class="lvl-3">
<p><strong>使用 wait_until 参数</strong>：确保页面完全加载</p>
</li>
<li class="lvl-3">
<p><strong>等待特定元素</strong>：使用 wait_for() 方法</p>
</li>
<li class="lvl-3">
<p><strong>监听网络请求</strong>：确保关键 API 调用完成</p>
</li>
<li class="lvl-3">
<p><strong>使用 page.wait_for_function()</strong>：等待自定义条件</p>
</li>
</ol>
<h3 id="11-3-测试稳定性问题">11.3 测试稳定性问题</h3>
<h4 id="问题：测试时有时无地失败（Flaky-Tests）">问题：测试时有时无地失败（Flaky Tests）</h4>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ❌ 不稳定的测试</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test_flaky</span>(<span class="params">page</span>):</span><br><span class="line">    page.goto(<span class="string">&quot;/form&quot;</span>)</span><br><span class="line">    page.locator(<span class="string">&quot;input#name&quot;</span>).fill(<span class="string">&quot;Test&quot;</span>)</span><br><span class="line">    page.locator(<span class="string">&quot;button#submit&quot;</span>).click()</span><br><span class="line">    <span class="keyword">assert</span> page.is_visible(<span class="string">&quot;text=Success&quot;</span>)  <span class="comment"># 可能还没显示</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ✅ 稳定的测试</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test_stable</span>(<span class="params">page</span>):</span><br><span class="line">    page.goto(<span class="string">&quot;/form&quot;</span>)</span><br><span class="line">    page.locator(<span class="string">&quot;input#name&quot;</span>).fill(<span class="string">&quot;Test&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 使用 with 语句等待导航完成</span></span><br><span class="line">    <span class="keyword">with</span> page.expect_navigation():</span><br><span class="line">        page.locator(<span class="string">&quot;button#submit&quot;</span>).click()</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 等待成功消息显示</span></span><br><span class="line">    success_message = page.locator(<span class="string">&quot;text=Success&quot;</span>)</span><br><span class="line">    success_message.wait_for(state=<span class="string">&quot;visible&quot;</span>)</span><br><span class="line">    <span class="keyword">assert</span> success_message.is_visible()</span><br></pre></td></tr></table></figure>
<h4 id="解决方案：-3">解决方案：</h4>
<ol>
<li class="lvl-3">
<p><strong>使用 expect_navigation()</strong>：等待页面跳转完成</p>
</li>
<li class="lvl-3">
<p><strong>明确等待条件</strong>：不要依赖隐式等待</p>
</li>
<li class="lvl-3">
<p><strong>增加重试机制</strong>：对不稳定的测试增加重试</p>
</li>
<li class="lvl-3">
<p><strong>使用 tracing</strong>：记录测试执行过程便于分析</p>
</li>
</ol>
<h3 id="11-4-性能优化问题">11.4 性能优化问题</h3>
<h4 id="问题：测试执行速度慢">问题：测试执行速度慢</h4>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ❌ 每次测试都启动新浏览器</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test_slow_1</span>():</span><br><span class="line">    <span class="keyword">with</span> sync_playwright() <span class="keyword">as</span> p:</span><br><span class="line">        browser = p.chromium.launch()</span><br><span class="line">        <span class="comment"># 测试逻辑...</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ✅ 复用浏览器实例</span></span><br><span class="line"><span class="meta">@pytest.fixture(<span class="params">scope=<span class="string">&quot;session&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">browser</span>():</span><br><span class="line">    <span class="keyword">with</span> sync_playwright() <span class="keyword">as</span> p:</span><br><span class="line">        browser = p.chromium.launch()</span><br><span class="line">        <span class="keyword">yield</span> browser</span><br><span class="line">        browser.close()</span><br><span class="line"></span><br><span class="line"><span class="comment"># ✅ 使用无头模式</span></span><br><span class="line">browser = p.chromium.launch(headless=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ✅ 阻止不必要的资源</span></span><br><span class="line">page.route(<span class="string">&quot;**/*.&#123;png,jpg,jpeg,gif&#125;&quot;</span>, <span class="keyword">lambda</span> route: route.abort())</span><br></pre></td></tr></table></figure>
<h4 id="解决方案：-4">解决方案：</h4>
<ol>
<li class="lvl-3">
<p><strong>复用浏览器实例</strong>：减少启动时间</p>
</li>
<li class="lvl-3">
<p><strong>使用无头模式</strong>：提高执行速度</p>
</li>
<li class="lvl-3">
<p><strong>网络优化</strong>：阻止不必要的资源加载</p>
</li>
<li class="lvl-3">
<p><strong>并行执行</strong>：利用多核 CPU 资源</p>
</li>
</ol>
<h3 id="11-5-跨浏览器兼容性问题">11.5 跨浏览器兼容性问题</h3>
<h4 id="问题：在不同浏览器中表现不一致">问题：在不同浏览器中表现不一致</h4>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 解决方案：参数化测试不同浏览器</span></span><br><span class="line"><span class="keyword">import</span> pytest</span><br><span class="line"></span><br><span class="line"><span class="meta">@pytest.mark.parametrize(<span class="params"><span class="string">&quot;browser_type&quot;</span>, [<span class="string">&quot;chromium&quot;</span>, <span class="string">&quot;firefox&quot;</span>, <span class="string">&quot;webkit&quot;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test_cross_browser</span>(<span class="params">browser_type, playwright</span>):</span><br><span class="line">    browser = <span class="built_in">getattr</span>(playwright, browser_type).launch()</span><br><span class="line">    page = browser.new_page()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        page.goto(<span class="string">&quot;https://example.com&quot;</span>)</span><br><span class="line">        <span class="comment"># 执行测试逻辑</span></span><br><span class="line">        <span class="keyword">assert</span> <span class="string">&quot;Example Domain&quot;</span> <span class="keyword">in</span> page.title()</span><br><span class="line">    <span class="keyword">finally</span>:</span><br><span class="line">        browser.close()</span><br></pre></td></tr></table></figure>
<h4 id="解决方案：-5">解决方案：</h4>
<ol>
<li class="lvl-3">
<p><strong>参数化测试</strong>：在多个浏览器中运行相同测试</p>
</li>
<li class="lvl-3">
<p><strong>统一选择器策略</strong>：避免浏览器特定的选择器</p>
</li>
<li class="lvl-3">
<p><strong>处理浏览器差异</strong>：对特定浏览器添加兼容代码</p>
</li>
<li class="lvl-3">
<p><strong>使用设备模拟</strong>：测试移动端兼容性</p>
</li>
</ol>
<h3 id="11-6-调试技巧">11.6 调试技巧</h3>
<h4 id="使用-Playwright-Inspector">使用 Playwright Inspector</h4>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 启动 Inspector</span></span><br><span class="line">PWDEBUG=1 python your_script.py</span><br></pre></td></tr></table></figure>
<h4 id="生成测试报告">生成测试报告</h4>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 使用 pytest-html 生成报告</span></span><br><span class="line">pytest --html=report.html --<span class="variable language_">self</span>-contained-html</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用 allure 生成美观的报告</span></span><br><span class="line">pytest --alluredir=allure-results</span><br><span class="line">allure serve allure-results</span><br></pre></td></tr></table></figure>
<h4 id="录制和回放">录制和回放</h4>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 录制用户操作生成代码</span></span><br><span class="line">playwright codegen https://example.com</span><br><span class="line"></span><br><span class="line"><span class="comment"># 录制网络请求</span></span><br><span class="line">playwright codegen --save-storage=auth.json https://example.com/login</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="总结">总结</h2>
<p>Playwright 作为现代 Web 自动化测试的利器，凭借其强大的功能和简洁的 API，正在改变传统的自动化测试方式。本指南涵盖了 Playwright 的核心概念、基本用法、高级特性和最佳实践，希望能够帮助您快速掌握这一工具。</p>
<h3 id="关键要点回顾：">关键要点回顾：</h3>
<ol>
<li class="lvl-3">
<p><strong>智能等待机制</strong>：Playwright 的自动等待是解决不稳定测试的关键</p>
</li>
<li class="lvl-3">
<p><strong>统一 API 设计</strong>：一套代码支持三大主流浏览器</p>
</li>
<li class="lvl-3">
<p><strong>强大的网络控制</strong>：内置请求拦截和 Mock 功能</p>
</li>
<li class="lvl-3">
<p><strong>现代化的定位策略</strong>：支持多种定位方式，提高脚本稳定性</p>
</li>
<li class="lvl-3">
<p><strong>良好的开发体验</strong>：丰富的调试工具和详细的文档</p>
</li>
</ol>
<h3 id="学习建议：">学习建议：</h3>
<ol>
<li class="lvl-3">
<p><strong>从基础开始</strong>：先掌握基本的页面操作和元素定位</p>
</li>
<li class="lvl-3">
<p><strong>实践为主</strong>：通过实际项目练习巩固知识点</p>
</li>
<li class="lvl-3">
<p><strong>关注最佳实践</strong>：编写稳定、可维护的测试代码</p>
</li>
<li class="lvl-3">
<p><strong>持续学习</strong>：关注 Playwright 的更新和新特性</p>
</li>
</ol>
<p>Playwright 正在快速发展，建议定期查看官方文档和社区资源，以获取最新的功能和最佳实践。</p>
<hr>
<p><strong>参考资源：</strong></p>
<ul class="lvl-0">
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://playwright.dev/">Playwright 官方文档</a></p>
</li>
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://github.com/microsoft/playwright">Playwright GitHub 仓库</a></p>
</li>
<li class="lvl-2">
<p><a target="_blank" rel="noopener" href="https://playwright.dev/python/docs/api/class-playwright">Playwright Python API 文档</a></p>
</li>
</ul>
<p><strong>Code: <a target="_blank" rel="noopener" href="https://github.com/microsoft/playwright">https://github.com/microsoft/playwright</a></strong></p>

    </div>

    
    
    

      <footer class="post-footer">
          
          <div class="post-tags">
              <a href="/tags/AI/" rel="tag"><i class="fa fa-tag"></i> AI</a>
              <a href="/tags/web/" rel="tag"><i class="fa fa-tag"></i> web</a>
          </div>

        



        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2025/10/23/AI/playwright_mcp/" rel="prev" title="playwright_mcp使用">
      <i class="fa fa-chevron-left"></i> playwright_mcp使用
    </a></div>
      <div class="post-nav-item">
    <a href="/2025/10/23/AI/MCP%E6%9E%84%E5%BB%BA%E6%8C%87%E5%8D%97/" rel="next" title="MCP构建指南">
      MCP构建指南 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
            
    <div class="comments" id="gitalk-container"></div>

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link"><span class="nav-number">1.</span> <span class="nav-text">Playwright 完整使用指南</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%9B%AE%E5%BD%95"><span class="nav-number">1.1.</span> <span class="nav-text">目录</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-Playwright-%E6%A6%82%E8%BF%B0"><span class="nav-number">1.2.</span> <span class="nav-text">1. Playwright 概述</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-1-%E4%BB%80%E4%B9%88%E6%98%AF-Playwright"><span class="nav-number">1.2.1.</span> <span class="nav-text">1.1 什么是 Playwright</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-2-%E6%A0%B8%E5%BF%83%E4%BC%98%E5%8A%BF"><span class="nav-number">1.2.2.</span> <span class="nav-text">1.2 核心优势</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-3-%E9%80%82%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="nav-number">1.2.3.</span> <span class="nav-text">1.3 适用场景</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5"><span class="nav-number">1.3.</span> <span class="nav-text">2. 核心概念</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-1-%E6%B5%8F%E8%A7%88%E5%99%A8%EF%BC%88Browser%EF%BC%89"><span class="nav-number">1.3.1.</span> <span class="nav-text">2.1 浏览器（Browser）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-2-%E6%B5%8F%E8%A7%88%E5%99%A8%E4%B8%8A%E4%B8%8B%E6%96%87%EF%BC%88Browser-Context%EF%BC%89"><span class="nav-number">1.3.2.</span> <span class="nav-text">2.2 浏览器上下文（Browser Context）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-3-%E9%A1%B5%E9%9D%A2%EF%BC%88Page%EF%BC%89"><span class="nav-number">1.3.3.</span> <span class="nav-text">2.3 页面（Page）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-4-%E5%85%83%E7%B4%A0%E5%AE%9A%E4%BD%8D%E5%99%A8%EF%BC%88Locator%EF%BC%89"><span class="nav-number">1.3.4.</span> <span class="nav-text">2.4 元素定位器（Locator）</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA"><span class="nav-number">1.4.</span> <span class="nav-text">3. 环境搭建</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#3-1-%E5%AE%89%E8%A3%85-Playwright"><span class="nav-number">1.4.1.</span> <span class="nav-text">3.1 安装 Playwright</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Python-%E7%8E%AF%E5%A2%83"><span class="nav-number">1.4.1.1.</span> <span class="nav-text">Python 环境</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Node-js-%E7%8E%AF%E5%A2%83"><span class="nav-number">1.4.1.2.</span> <span class="nav-text">Node.js 环境</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-2-%E9%AA%8C%E8%AF%81%E5%AE%89%E8%A3%85"><span class="nav-number">1.4.2.</span> <span class="nav-text">3.2 验证安装</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-3-%E6%B5%8F%E8%A7%88%E5%99%A8%E9%85%8D%E7%BD%AE"><span class="nav-number">1.4.3.</span> <span class="nav-text">3.3 浏览器配置</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-%E5%9F%BA%E6%9C%AC%E7%94%A8%E6%B3%95"><span class="nav-number">1.5.</span> <span class="nav-text">4. 基本用法</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#4-1-%E5%90%8C%E6%AD%A5-API-vs-%E5%BC%82%E6%AD%A5-API"><span class="nav-number">1.5.1.</span> <span class="nav-text">4.1 同步 API vs 异步 API</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%90%8C%E6%AD%A5-API"><span class="nav-number">1.5.1.1.</span> <span class="nav-text">同步 API</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%BC%82%E6%AD%A5-API"><span class="nav-number">1.5.1.2.</span> <span class="nav-text">异步 API</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-2-%E9%A1%B5%E9%9D%A2%E5%AF%BC%E8%88%AA"><span class="nav-number">1.5.2.</span> <span class="nav-text">4.2 页面导航</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-3-%E9%A1%B5%E9%9D%A2%E6%93%8D%E4%BD%9C"><span class="nav-number">1.5.3.</span> <span class="nav-text">4.3 页面操作</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-%E5%85%83%E7%B4%A0%E5%AE%9A%E4%BD%8D%E4%B8%8E%E6%93%8D%E4%BD%9C"><span class="nav-number">1.6.</span> <span class="nav-text">5. 元素定位与操作</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#5-1-%E5%AE%9A%E4%BD%8D%E7%AD%96%E7%95%A5"><span class="nav-number">1.6.1.</span> <span class="nav-text">5.1 定位策略</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%96%87%E6%9C%AC%E5%AE%9A%E4%BD%8D"><span class="nav-number">1.6.1.1.</span> <span class="nav-text">文本定位</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#CSS-%E9%80%89%E6%8B%A9%E5%99%A8%E5%AE%9A%E4%BD%8D"><span class="nav-number">1.6.1.2.</span> <span class="nav-text">CSS 选择器定位</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#XPath-%E5%AE%9A%E4%BD%8D"><span class="nav-number">1.6.1.3.</span> <span class="nav-text">XPath 定位</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#ARIA-%E8%A7%92%E8%89%B2%E5%AE%9A%E4%BD%8D"><span class="nav-number">1.6.1.4.</span> <span class="nav-text">ARIA 角色定位</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-2-%E5%85%83%E7%B4%A0%E6%93%8D%E4%BD%9C"><span class="nav-number">1.6.2.</span> <span class="nav-text">5.2 元素操作</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%BE%93%E5%85%A5%E6%93%8D%E4%BD%9C"><span class="nav-number">1.6.2.1.</span> <span class="nav-text">输入操作</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%82%B9%E5%87%BB%E6%93%8D%E4%BD%9C"><span class="nav-number">1.6.2.2.</span> <span class="nav-text">点击操作</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%A1%A8%E5%8D%95%E6%93%8D%E4%BD%9C"><span class="nav-number">1.6.2.3.</span> <span class="nav-text">表单操作</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-3-%E5%85%83%E7%B4%A0%E7%8A%B6%E6%80%81%E6%A3%80%E6%9F%A5"><span class="nav-number">1.6.3.</span> <span class="nav-text">5.3 元素状态检查</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6-%E6%99%BA%E8%83%BD%E7%AD%89%E5%BE%85%E6%9C%BA%E5%88%B6"><span class="nav-number">1.7.</span> <span class="nav-text">6. 智能等待机制</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#6-1-%E8%87%AA%E5%8A%A8%E7%AD%89%E5%BE%85%E5%8E%9F%E7%90%86"><span class="nav-number">1.7.1.</span> <span class="nav-text">6.1 自动等待原理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-2-%E6%98%BE%E5%BC%8F%E7%AD%89%E5%BE%85"><span class="nav-number">1.7.2.</span> <span class="nav-text">6.2 显式等待</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-3-%E7%AD%89%E5%BE%85%E8%B6%85%E6%97%B6%E9%85%8D%E7%BD%AE"><span class="nav-number">1.7.3.</span> <span class="nav-text">6.3 等待超时配置</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#7-%E7%BD%91%E7%BB%9C%E8%AF%B7%E6%B1%82%E5%A4%84%E7%90%86"><span class="nav-number">1.8.</span> <span class="nav-text">7. 网络请求处理</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#7-1-%E8%AF%B7%E6%B1%82%E6%8B%A6%E6%88%AA%E4%B8%8E-Mock"><span class="nav-number">1.8.1.</span> <span class="nav-text">7.1 请求拦截与 Mock</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-2-%E6%A8%A1%E6%8B%9F%E7%BD%91%E7%BB%9C%E9%94%99%E8%AF%AF"><span class="nav-number">1.8.2.</span> <span class="nav-text">7.2 模拟网络错误</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-3-%E8%AF%B7%E6%B1%82%E7%9B%91%E6%8E%A7"><span class="nav-number">1.8.3.</span> <span class="nav-text">7.3 请求监控</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-4-HTTP-%E8%AE%A4%E8%AF%81"><span class="nav-number">1.8.4.</span> <span class="nav-text">7.4 HTTP 认证</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#8-%E9%AB%98%E7%BA%A7%E7%89%B9%E6%80%A7"><span class="nav-number">1.9.</span> <span class="nav-text">8. 高级特性</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#8-1-%E5%A4%9A%E9%A1%B5%E9%9D%A2%E5%92%8C%E5%BC%B9%E5%87%BA%E7%AA%97%E5%8F%A3"><span class="nav-number">1.9.1.</span> <span class="nav-text">8.1 多页面和弹出窗口</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#8-2-iframe-%E5%A4%84%E7%90%86"><span class="nav-number">1.9.2.</span> <span class="nav-text">8.2 iframe 处理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#8-3-%E8%AE%BE%E5%A4%87%E6%A8%A1%E6%8B%9F"><span class="nav-number">1.9.3.</span> <span class="nav-text">8.3 设备模拟</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#8-4-%E8%A7%86%E9%A2%91%E5%BD%95%E5%88%B6%E5%92%8C%E8%BF%BD%E8%B8%AA"><span class="nav-number">1.9.4.</span> <span class="nav-text">8.4 视频录制和追踪</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#8-5-%E5%B9%B6%E8%A1%8C%E6%89%A7%E8%A1%8C"><span class="nav-number">1.9.5.</span> <span class="nav-text">8.5 并行执行</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#9-%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5"><span class="nav-number">1.10.</span> <span class="nav-text">9. 最佳实践</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#9-1-%E6%B5%8B%E8%AF%95%E8%AE%BE%E8%AE%A1%E5%8E%9F%E5%88%99"><span class="nav-number">1.10.1.</span> <span class="nav-text">9.1 测试设计原则</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%B5%8B%E8%AF%95%E7%94%A8%E6%88%B7%E5%8F%AF%E8%A7%81%E8%A1%8C%E4%B8%BA"><span class="nav-number">1.10.1.1.</span> <span class="nav-text">测试用户可见行为</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BF%9D%E6%8C%81%E6%B5%8B%E8%AF%95%E9%9A%94%E7%A6%BB"><span class="nav-number">1.10.1.2.</span> <span class="nav-text">保持测试隔离</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#9-2-%E4%BB%A3%E7%A0%81%E7%BB%84%E7%BB%87%E6%A8%A1%E5%BC%8F"><span class="nav-number">1.10.2.</span> <span class="nav-text">9.2 代码组织模式</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Page-Object-Model-POM"><span class="nav-number">1.10.2.1.</span> <span class="nav-text">Page Object Model (POM)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Fixture-%E6%A8%A1%E5%BC%8F"><span class="nav-number">1.10.2.2.</span> <span class="nav-text">Fixture 模式</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#9-3-%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96"><span class="nav-number">1.10.3.</span> <span class="nav-text">9.3 性能优化</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%80%89%E6%8B%A9%E6%80%A7%E6%88%AA%E5%9B%BE"><span class="nav-number">1.10.3.1.</span> <span class="nav-text">选择性截图</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BD%91%E7%BB%9C%E4%BC%98%E5%8C%96"><span class="nav-number">1.10.3.2.</span> <span class="nav-text">网络优化</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#9-4-%E8%B0%83%E8%AF%95%E6%8A%80%E5%B7%A7"><span class="nav-number">1.10.4.</span> <span class="nav-text">9.4 调试技巧</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%8F%AF%E8%A7%86%E5%8C%96%E8%B0%83%E8%AF%95"><span class="nav-number">1.10.4.1.</span> <span class="nav-text">可视化调试</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%97%A5%E5%BF%97%E8%AE%B0%E5%BD%95"><span class="nav-number">1.10.4.2.</span> <span class="nav-text">日志记录</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#10-%E5%AE%9E%E6%88%98%E6%A1%88%E4%BE%8B"><span class="nav-number">1.11.</span> <span class="nav-text">10. 实战案例</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#10-1-%E7%94%B5%E5%95%86%E7%BD%91%E7%AB%99%E6%B5%8B%E8%AF%95%E6%A1%88%E4%BE%8B"><span class="nav-number">1.11.1.</span> <span class="nav-text">10.1 电商网站测试案例</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#10-2-%E6%95%B0%E6%8D%AE%E6%8A%93%E5%8F%96%E6%A1%88%E4%BE%8B"><span class="nav-number">1.11.2.</span> <span class="nav-text">10.2 数据抓取案例</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#10-3-API-%E6%B5%8B%E8%AF%95%E9%9B%86%E6%88%90"><span class="nav-number">1.11.3.</span> <span class="nav-text">10.3 API 测试集成</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#11-%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98%E4%B8%8E%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88"><span class="nav-number">1.12.</span> <span class="nav-text">11. 常见问题与解决方案</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#11-1-%E5%85%83%E7%B4%A0%E5%AE%9A%E4%BD%8D%E9%97%AE%E9%A2%98"><span class="nav-number">1.12.1.</span> <span class="nav-text">11.1 元素定位问题</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%97%AE%E9%A2%98%EF%BC%9A%E5%85%83%E7%B4%A0%E5%AE%9A%E4%BD%8D%E4%B8%8D%E7%A8%B3%E5%AE%9A"><span class="nav-number">1.12.1.1.</span> <span class="nav-text">问题：元素定位不稳定</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88%EF%BC%9A"><span class="nav-number">1.12.1.2.</span> <span class="nav-text">解决方案：</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#11-2-%E5%BC%82%E6%AD%A5%E5%8A%A0%E8%BD%BD%E9%97%AE%E9%A2%98"><span class="nav-number">1.12.2.</span> <span class="nav-text">11.2 异步加载问题</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%97%AE%E9%A2%98%EF%BC%9A%E9%A1%B5%E9%9D%A2%E5%86%85%E5%AE%B9%E5%8A%A8%E6%80%81%E5%8A%A0%E8%BD%BD%E5%AF%BC%E8%87%B4%E5%85%83%E7%B4%A0%E6%89%BE%E4%B8%8D%E5%88%B0"><span class="nav-number">1.12.2.1.</span> <span class="nav-text">问题：页面内容动态加载导致元素找不到</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88%EF%BC%9A-2"><span class="nav-number">1.12.2.2.</span> <span class="nav-text">解决方案：</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#11-3-%E6%B5%8B%E8%AF%95%E7%A8%B3%E5%AE%9A%E6%80%A7%E9%97%AE%E9%A2%98"><span class="nav-number">1.12.3.</span> <span class="nav-text">11.3 测试稳定性问题</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%97%AE%E9%A2%98%EF%BC%9A%E6%B5%8B%E8%AF%95%E6%97%B6%E6%9C%89%E6%97%B6%E6%97%A0%E5%9C%B0%E5%A4%B1%E8%B4%A5%EF%BC%88Flaky-Tests%EF%BC%89"><span class="nav-number">1.12.3.1.</span> <span class="nav-text">问题：测试时有时无地失败（Flaky Tests）</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88%EF%BC%9A-3"><span class="nav-number">1.12.3.2.</span> <span class="nav-text">解决方案：</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#11-4-%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E9%97%AE%E9%A2%98"><span class="nav-number">1.12.4.</span> <span class="nav-text">11.4 性能优化问题</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%97%AE%E9%A2%98%EF%BC%9A%E6%B5%8B%E8%AF%95%E6%89%A7%E8%A1%8C%E9%80%9F%E5%BA%A6%E6%85%A2"><span class="nav-number">1.12.4.1.</span> <span class="nav-text">问题：测试执行速度慢</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88%EF%BC%9A-4"><span class="nav-number">1.12.4.2.</span> <span class="nav-text">解决方案：</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#11-5-%E8%B7%A8%E6%B5%8F%E8%A7%88%E5%99%A8%E5%85%BC%E5%AE%B9%E6%80%A7%E9%97%AE%E9%A2%98"><span class="nav-number">1.12.5.</span> <span class="nav-text">11.5 跨浏览器兼容性问题</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%97%AE%E9%A2%98%EF%BC%9A%E5%9C%A8%E4%B8%8D%E5%90%8C%E6%B5%8F%E8%A7%88%E5%99%A8%E4%B8%AD%E8%A1%A8%E7%8E%B0%E4%B8%8D%E4%B8%80%E8%87%B4"><span class="nav-number">1.12.5.1.</span> <span class="nav-text">问题：在不同浏览器中表现不一致</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88%EF%BC%9A-5"><span class="nav-number">1.12.5.2.</span> <span class="nav-text">解决方案：</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#11-6-%E8%B0%83%E8%AF%95%E6%8A%80%E5%B7%A7"><span class="nav-number">1.12.6.</span> <span class="nav-text">11.6 调试技巧</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8-Playwright-Inspector"><span class="nav-number">1.12.6.1.</span> <span class="nav-text">使用 Playwright Inspector</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%94%9F%E6%88%90%E6%B5%8B%E8%AF%95%E6%8A%A5%E5%91%8A"><span class="nav-number">1.12.6.2.</span> <span class="nav-text">生成测试报告</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%BD%95%E5%88%B6%E5%92%8C%E5%9B%9E%E6%94%BE"><span class="nav-number">1.12.6.3.</span> <span class="nav-text">录制和回放</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%80%BB%E7%BB%93"><span class="nav-number">1.13.</span> <span class="nav-text">总结</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%85%B3%E9%94%AE%E8%A6%81%E7%82%B9%E5%9B%9E%E9%A1%BE%EF%BC%9A"><span class="nav-number">1.13.1.</span> <span class="nav-text">关键要点回顾：</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AD%A6%E4%B9%A0%E5%BB%BA%E8%AE%AE%EF%BC%9A"><span class="nav-number">1.13.2.</span> <span class="nav-text">学习建议：</span></a></li></ol></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="三子曰"
      src="https://cdn.jsdelivr.net/gh/MengChangWang/Blog_Image@main/img/avatar.png">
  <p class="site-author-name" itemprop="name">三子曰</p>
  <div class="site-description" itemprop="description">欢迎来到我的博客</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">69</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">6</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">23</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/wangmc1024" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;wangmc1024" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:wangmc1024@gmail.com" title="E-Mail → mailto:wangmc1024@gmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>



      </div>
        <div class="back-to-top motion-element">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; Wed Mar 27 2024 08:00:00 GMT+0800 (中国标准时间) – 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">三子曰</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
    <span title="站点总字数">732k</span>
</div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script size="300" alpha="0.6" zIndex="-1" src="/lib/canvas-ribbon/canvas-ribbon.js"></script>
  <script src="/lib/anime.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/lozad@1/dist/lozad.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  
  <script>
    (function(){
      var canonicalURL, curProtocol;
      //Get the <link> tag
      var x=document.getElementsByTagName("link");
		//Find the last canonical URL
		if(x.length > 0){
			for (i=0;i<x.length;i++){
				if(x[i].rel.toLowerCase() == 'canonical' && x[i].href){
					canonicalURL=x[i].href;
				}
			}
		}
    //Get protocol
	    if (!canonicalURL){
	    	curProtocol = window.location.protocol.split(':')[0];
	    }
	    else{
	    	curProtocol = canonicalURL.split(':')[0];
	    }
      //Get current URL if the canonical URL does not exist
	    if (!canonicalURL) canonicalURL = window.location.href;
	    //Assign script content. Replace current URL with the canonical URL
      !function(){var e=/([http|https]:\/\/[a-zA-Z0-9\_\.]+\.baidu\.com)/gi,r=canonicalURL,t=document.referrer;if(!e.test(r)){var n=(String(curProtocol).toLowerCase() === 'https')?"https://sp0.baidu.com/9_Q4simg2RQJ8t7jm9iCKT-xh_/s.gif":"//api.share.baidu.com/s.gif";t?(n+="?r="+encodeURIComponent(document.referrer),r&&(n+="&l="+r)):r&&(n+="?l="+r);var i=new Image;i.src=n}}(window);})();
  </script>















  

  

<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.css">

<script>
NexT.utils.loadComments(document.querySelector('#gitalk-container'), () => {
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js', () => {
    var gitalk = new Gitalk({
      clientID    : '2719e26e1ea715ee8429',
      clientSecret: '77a4ce8e9410a002f05c8f2c2b398c952a012d7c',
      repo        : 'wangmc1024.github.io',
      owner       : 'wangmc1024',
      admin       : ['wangmc1024'],
      id          : 'c8b618b769f90cb7e45d6af55c104387',
        language: 'zh-CN',
      distractionFreeMode: true
    });
    gitalk.render('gitalk-container');
  }, window.Gitalk);
});
</script>



</body>
</html>
