[{"title":"Hello World","url":"/2025/05/15/hello-world/","content":"Welcome to my personal blog, this is the first attemp.\n"},{"title":"ä¹¦ç”Ÿå¤§æ¨¡å‹---RAGå®è·µ","url":"/2024/09/29/AI/%E4%B9%A6%E7%94%9F%E5%A4%A7%E6%A8%A1%E5%9E%8B%E7%BB%83%E4%B9%A0%E7%AC%94%E8%AE%B0-Lv1-1/","content":"\nRAGå®è·µ\n\n\nLv1-llamaindex+Internlm2 RAGå®è·µ\n1. RAGç®€ä»‹\nRAGï¼ˆRetrieval-Augmented Generationï¼‰æŠ€æœ¯æ˜¯ä¸€ç§ç»“åˆäº†ä¿¡æ¯æ£€ç´¢å’Œæ–‡æœ¬ç”Ÿæˆçš„æŠ€æœ¯ï¼Œæ—¨åœ¨é€šè¿‡æ£€ç´¢å¤–éƒ¨çŸ¥è¯†åº“æ¥å¢å¼ºç”Ÿæˆæ¨¡å‹çš„èƒ½åŠ›\n\n1.1 RAGä¼˜åŒ–æ–¹æ³•\n\n2. æ­å»ºç¯å¢ƒ\n2.1 ç›¸å…³åŸºç¡€ä¾èµ–pythonè™šæ‹Ÿç¯å¢ƒ\nconda activate llamaindexconda install pytorch==2.0.1 torchvision==0.15.2 torchaudio==2.0.2 pytorch-cuda=11.7 -c pytorch -c nvidiapip install einops==0.7.0 protobuf==5.26.1\n2.2 å®‰è£… Llamaindexå’Œç›¸å…³åŒ…\nconda activate llamaindexpip install llama-index==0.10.38 llama-index-llms-huggingface==0.2.0 &quot;transformers[torch]==4.41.1&quot; &quot;huggingface_hub[inference]==0.23.1&quot; huggingface_hub==0.23.1 sentence-transformers==2.7.0 sentencepiece==0.2.0\n2.3 ä¸‹è½½ Sentence Transformer æ¨¡å‹\næºè¯å‘é‡æ¨¡å‹ Sentence Transformer:ï¼ˆä¹Ÿå¯ä»¥é€‰ç”¨åˆ«çš„å¼€æºè¯å‘é‡æ¨¡å‹æ¥è¿›è¡Œ Embeddingï¼‰ è¿è¡Œä»¥ä¸‹æŒ‡ä»¤ï¼Œæ–°å»ºä¸€ä¸ªpythonæ–‡ä»¶\ncd ~mkdir llamaindex_demomkdir modelcd ~/llamaindex_demotouch download_hf.py\næ‰“å¼€download_hf.py è´´å…¥ä»¥ä¸‹ä»£ç \nimport os# è®¾ç½®ç¯å¢ƒå˜é‡os.environ[&#x27;HF_ENDPOINT&#x27;] = &#x27;https://hf-mirror.com&#x27;# ä¸‹è½½æ¨¡å‹os.system(&#x27;huggingface-cli download --resume-download sentence-transformers/paraphrase-multilingual-MiniLM-L12-v2 --local-dir /root/model/sentence-transformer&#x27;)\nç„¶åï¼Œåœ¨ /root/llamaindex_demo ç›®å½•ä¸‹æ‰§è¡Œè¯¥è„šæœ¬å³å¯è‡ªåŠ¨å¼€å§‹ä¸‹è½½ï¼š\ncd /root/llamaindex_democonda activate llamaindexpython download_hf.py\næ›´å¤šå…³äºé•œåƒä½¿ç”¨å¯ä»¥ç§»æ­¥è‡³ HF Mirror æŸ¥çœ‹ã€‚\n2.4 ä¸‹è½½ NLTK ç›¸å…³èµ„æº\næˆ‘ä»¬åœ¨ä½¿ç”¨å¼€æºè¯å‘é‡æ¨¡å‹æ„å»ºå¼€æºè¯å‘é‡çš„æ—¶å€™ï¼Œéœ€è¦ç”¨åˆ°ç¬¬ä¸‰æ–¹åº“ nltk çš„ä¸€äº›èµ„æºã€‚æ­£å¸¸æƒ…å†µä¸‹ï¼Œå…¶ä¼šè‡ªåŠ¨ä»äº’è”ç½‘ä¸Šä¸‹è½½ï¼Œä½†å¯èƒ½ç”±äºç½‘ç»œåŸå› ä¼šå¯¼è‡´ä¸‹è½½ä¸­æ–­ï¼Œæ­¤å¤„æˆ‘ä»¬å¯ä»¥ä»å›½å†…ä»“åº“é•œåƒåœ°å€ä¸‹è½½ç›¸å…³èµ„æºï¼Œä¿å­˜åˆ°æœåŠ¡å™¨ä¸Šã€‚ æˆ‘ä»¬ç”¨ä»¥ä¸‹å‘½ä»¤ä¸‹è½½ nltk èµ„æºå¹¶è§£å‹åˆ°æœåŠ¡å™¨ä¸Šï¼š\ncd /rootgit clone https://gitee.com/yzy0612/nltk_data.git  --branch gh-pagescd nltk_datamv packages/*  ./cd tokenizersunzip punkt.zipcd ../taggersunzip averaged_perceptron_tagger.zip\n2.5 å®‰è£…è¯åµŒå…¥å‘é‡ä¾èµ–\nconda activate llamaindexpip install llama-index-embeddings-huggingface==0.2.0 llama-index-embeddings-instructor==0.1.3\n2.6 å‡†å¤‡çŸ¥è¯†åº“\nä½ æ‰€éœ€è¦æ£€ç´¢çš„æ–‡ä»¶\n2.7 å¼•å…¥æ¨¡å‹ ç¼–å†™ç›¸å…³ä»£ç \nè¯¦æƒ…è¯·å‚è€ƒ\nimport streamlit as stfrom llama_index.core import VectorStoreIndex, SimpleDirectoryReader, Settingsfrom llama_index.embeddings.huggingface import HuggingFaceEmbeddingfrom llama_index.llms.huggingface import HuggingFaceLLM# è®¾ç½®Streamlitåº”ç”¨çš„é¡µé¢æ ‡é¢˜å’Œå›¾æ ‡st.set_page_config(page_title=&quot;llama_index_demo&quot;, page_icon=&quot;ğŸ¦œğŸ”—&quot;)# åœ¨é¡µé¢ä¸Šæ˜¾ç¤ºæ ‡é¢˜st.title(&quot;llama_index_demo&quot;)# åˆå§‹åŒ–æ¨¡å‹çš„å‡½æ•°ï¼Œä½¿ç”¨Streamlitçš„ç¼“å­˜æœºåˆ¶æ¥èŠ‚çº¦èµ„æºï¼ˆé˜²æ­¢æ¯æ¬¡äº¤äº’æ—¶é‡æ–°åŠ è½½æ¨¡å‹ï¼‰@st.cache_resourcedef init_models():    # åŠ è½½åµŒå…¥æ¨¡å‹ï¼Œä½¿ç”¨HuggingFaceçš„sentence-transformer    embed_model = HuggingFaceEmbedding(        model_name=&quot;/root/model/sentence-transformer&quot;  # æŒ‡å®šæ¨¡å‹çš„è·¯å¾„    )    Settings.embed_model = embed_model  # è®¾ç½®å…¨å±€çš„åµŒå…¥æ¨¡å‹        # åŠ è½½è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰ï¼ŒæŒ‡å®šHuggingFaceæ¨¡å‹åŠå…¶å¯¹åº”çš„åˆ†è¯å™¨    llm = HuggingFaceLLM(        model_name=&quot;/root/model/internlm2-chat-1_8b&quot;,  # æŒ‡å®šç”Ÿæˆæ¨¡å‹çš„è·¯å¾„        tokenizer_name=&quot;/root/model/internlm2-chat-1_8b&quot;,  # æŒ‡å®šåˆ†è¯å™¨çš„è·¯å¾„        model_kwargs=&#123;&quot;trust_remote_code&quot;: True&#125;,  # å…è®¸è¿œç¨‹ä»£ç çš„ä¿¡ä»»        tokenizer_kwargs=&#123;&quot;trust_remote_code&quot;: True&#125;  # åŒæ ·å…è®¸åˆ†è¯å™¨çš„è¿œç¨‹ä»£ç ä¿¡ä»»    )    Settings.llm = llm  # è®¾ç½®å…¨å±€çš„è¯­è¨€æ¨¡å‹    # è¯»å–å­˜å‚¨åœ¨æŒ‡å®šç›®å½•ä¸‹çš„æ–‡æ¡£æ•°æ®ï¼Œå¹¶åŠ è½½ä¸ºä¸€ä¸ªæ–‡æ¡£å¯¹è±¡åˆ—è¡¨    documents = SimpleDirectoryReader(&quot;/root/llamaindex_demo/data&quot;).load_data()        # åˆ›å»ºå‘é‡æ£€ç´¢ç´¢å¼•ï¼Œå°†æ–‡æ¡£è½¬æ¢ä¸ºå‘é‡å¹¶æ„å»ºæ£€ç´¢ç´¢å¼•    index = VectorStoreIndex.from_documents(documents)        # å°†å‘é‡ç´¢å¼•è½¬åŒ–ä¸ºæŸ¥è¯¢å¼•æ“ï¼Œç”¨äºåç»­æŸ¥è¯¢    query_engine = index.as_query_engine()    # è¿”å›æŸ¥è¯¢å¼•æ“    return query_engine# æ£€æŸ¥session_stateä¸­æ˜¯å¦å·²ç»å­˜åœ¨æŸ¥è¯¢å¼•æ“ï¼Œå¦‚æœä¸å­˜åœ¨åˆ™åˆå§‹åŒ–if &#x27;query_engine&#x27; not in st.session_state:    st.session_state[&#x27;query_engine&#x27;] = init_models()# å®šä¹‰é—®ç­”å‡½æ•°ï¼Œç”¨äºåŸºäºé—®é¢˜ç”Ÿæˆå›å¤def greet2(question):    # ä½¿ç”¨æŸ¥è¯¢å¼•æ“æ ¹æ®ç”¨æˆ·é—®é¢˜è¿”å›ç»“æœ    response = st.session_state[&#x27;query_engine&#x27;].query(question)    return response# åˆå§‹åŒ–èŠå¤©è®°å½•ï¼Œè‹¥æ²¡æœ‰åˆ™åˆ›å»ºï¼Œå¹¶åœ¨é¦–æ¬¡äº¤äº’æ—¶æ˜¾ç¤ºæ¬¢è¿è¯­if &quot;messages&quot; not in st.session_state.keys():    st.session_state.messages = [&#123;&quot;role&quot;: &quot;assistant&quot;, &quot;content&quot;: &quot;ä½ å¥½ï¼Œæˆ‘æ˜¯ä½ çš„åŠ©æ‰‹ï¼Œæœ‰ä»€ä¹ˆæˆ‘å¯ä»¥å¸®åŠ©ä½ çš„å—ï¼Ÿ&quot;&#125;]    # æ˜¾ç¤ºæ¶ˆæ¯è®°å½•ï¼Œéå†session_stateä¸­çš„æ¶ˆæ¯å¹¶å±•ç¤ºåœ¨é¡µé¢ä¸Šfor message in st.session_state.messages:    # æ ¹æ®æ¶ˆæ¯çš„è§’è‰²æ˜¾ç¤ºèŠå¤©æ°”æ³¡ï¼Œè§’è‰²å¯ä»¥æ˜¯&quot;user&quot;æˆ–&quot;assistant&quot;    with st.chat_message(message[&quot;role&quot;]):        st.write(message[&quot;content&quot;])  # æ˜¾ç¤ºæ¶ˆæ¯å†…å®¹# æ¸…é™¤èŠå¤©å†å²è®°å½•çš„å‡½æ•°def clear_chat_history():    # é‡ç½®èŠå¤©è®°å½•ä¸ºæœ€åˆçš„æ¬¢è¿æ¶ˆæ¯    st.session_state.messages = [&#123;&quot;role&quot;: &quot;assistant&quot;, &quot;content&quot;: &quot;ä½ å¥½ï¼Œæˆ‘æ˜¯ä½ çš„åŠ©æ‰‹ï¼Œæœ‰ä»€ä¹ˆæˆ‘å¯ä»¥å¸®åŠ©ä½ çš„å—ï¼Ÿ&quot;&#125;]# åœ¨ä¾§è¾¹æ ä¸­æ·»åŠ ä¸€ä¸ªæŒ‰é’®ï¼Œç‚¹å‡»åè°ƒç”¨æ¸…é™¤èŠå¤©å†å²è®°å½•çš„å‡½æ•°st.sidebar.button(&#x27;Clear Chat History&#x27;, on_click=clear_chat_history)# å®šä¹‰ç”Ÿæˆå›å¤çš„å‡½æ•°ï¼Œé€šè¿‡é—®ç­”æ¥å£è°ƒç”¨æŸ¥è¯¢å¼•æ“def generate_llama_index_response(prompt_input):    return greet2(prompt_input)  # è¿”å›åŸºäºç”¨æˆ·è¾“å…¥çš„ç”Ÿæˆå†…å®¹# æ£€æŸ¥ç”¨æˆ·æ˜¯å¦è¾“å…¥äº†æ–°çš„é—®é¢˜if prompt := st.chat_input():    # å°†ç”¨æˆ·çš„è¾“å…¥ä½œä¸ºæ¶ˆæ¯æ·»åŠ åˆ°session_stateçš„æ¶ˆæ¯åˆ—è¡¨ä¸­    st.session_state.messages.append(&#123;&quot;role&quot;: &quot;user&quot;, &quot;content&quot;: prompt&#125;)        # æ˜¾ç¤ºç”¨æˆ·è¾“å…¥çš„æ¶ˆæ¯    with st.chat_message(&quot;user&quot;):        st.write(prompt)# å¦‚æœä¸Šä¸€æ¡æ¶ˆæ¯ä¸æ˜¯åŠ©æ‰‹çš„å›å¤ï¼Œåˆ™ç”ŸæˆåŠ©æ‰‹çš„å›å¤if st.session_state.messages[-1][&quot;role&quot;] != &quot;assistant&quot;:    with st.chat_message(&quot;assistant&quot;):        # ä½¿ç”¨åŠ è½½ä¸­çš„æç¤ºæ•ˆæœï¼Œè¡¨ç¤ºåŠ©æ‰‹åœ¨â€œæ€è€ƒä¸­â€        with st.spinner(&quot;Thinking...&quot;):            # è°ƒç”¨ç”Ÿæˆå›å¤çš„å‡½æ•°ï¼ŒåŸºäºç”¨æˆ·çš„è¾“å…¥ç”Ÿæˆå›ç­”            response = generate_llama_index_response(prompt)                        # åˆ›å»ºä¸€ä¸ªä¸´æ—¶å ä½ç¬¦ï¼Œç”¨äºæ˜¾ç¤ºç”Ÿæˆçš„å›å¤            placeholder = st.empty()                        # å°†ç”Ÿæˆçš„å›å¤ä»¥Markdownçš„æ ¼å¼æ˜¾ç¤ºåœ¨é¡µé¢ä¸Š            placeholder.markdown(response)        # å°†åŠ©æ‰‹çš„å›å¤ä½œä¸ºæ–°çš„æ¶ˆæ¯è¿½åŠ åˆ°æ¶ˆæ¯åˆ—è¡¨ä¸­    message = &#123;&quot;role&quot;: &quot;assistant&quot;, &quot;content&quot;: response&#125;    st.session_state.messages.append(message)","categories":["ç¼–ç¨‹"],"tags":["AI","RAG","python"]},{"title":"ä¹¦ç”Ÿå¤§æ¨¡å‹---å¾®è°ƒ","url":"/2024/09/29/AI/%E4%B9%A6%E7%94%9F%E5%A4%A7%E6%A8%A1%E5%9E%8B%E7%BB%83%E4%B9%A0%E7%AC%94%E8%AE%B0-Lv1-2/","content":"\nåˆ©ç”¨XTunerå¾®è°ƒé¢„è®­ç»ƒæ¨¡å‹\n\n\nLv1-XTunerå¾®è°ƒå¤§æ¨¡å‹\n1. å‡†å¤‡ç¯å¢ƒå’Œä¾èµ–\nXTunerçš„è¿è¡Œä¾èµ–äºä¸€ç³»åˆ—çš„åº“å’Œå·¥å…·ï¼Œä¸»è¦åŒ…æ‹¬transformersã€torchç­‰æ·±åº¦å­¦ä¹ æ¡†æ¶ã€‚åœ¨å¼€å§‹ä¹‹å‰ï¼Œä½ éœ€è¦ç¡®ä¿å®‰è£…å¥½è¿™äº›ä¾èµ–ï¼š\n\n\nå®‰è£…Python 3.8æˆ–æ›´é«˜ç‰ˆæœ¬ã€‚\n\n\nå®‰è£…åŸºç¡€ä¾èµ–åº“ï¼šè¿è¡Œä»¥ä¸‹å‘½ä»¤ä¸‹è½½å¹¶å®‰è£…ä¾èµ–ã€‚\n pip install -r requirements.txt\n\n\nç¡®ä¿ä½ æ‹¥æœ‰å…¼å®¹çš„GPUç¯å¢ƒï¼Œä»¥æé«˜æ¨¡å‹è®­ç»ƒé€Ÿåº¦ã€‚å¦‚æœä½¿ç”¨çš„æ˜¯NVIDIA GPUï¼Œå®‰è£…CUDAå’ŒcuDNNå¹¶éªŒè¯PyTorchçš„GPUæ”¯æŒã€‚\n\n\n2. åŠ è½½é¢„è®­ç»ƒæ¨¡å‹\nXTunerçš„æ ¸å¿ƒåŠŸèƒ½æ˜¯å¯¹å·²æœ‰çš„é¢„è®­ç»ƒæ¨¡å‹è¿›è¡Œå¾®è°ƒã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œå¤§è¯­è¨€æ¨¡å‹ï¼ˆå¦‚GPTã€BERTç­‰ï¼‰å·²ç»å…·å¤‡å¼ºå¤§çš„é€šç”¨è¯­è¨€èƒ½åŠ›ï¼Œä½†é’ˆå¯¹å…·ä½“ä»»åŠ¡æ—¶éœ€è¦è¿›è¡Œé¢å¤–çš„å¾®è°ƒã€‚\né€‰æ‹©æ¨¡å‹ï¼š\nXTuneræ”¯æŒä½¿ç”¨Hugging Faceçš„transformersåº“æ¥åŠ è½½é¢„è®­ç»ƒæ¨¡å‹ã€‚ä»¥ä¸‹ä»£ç å±•ç¤ºäº†å¦‚ä½•åŠ è½½GPT-2æ¨¡å‹ï¼š\nfrom transformers import AutoModelForCausalLM, AutoTokenizermodel = AutoModelForCausalLM.from_pretrained(&quot;gpt2&quot;)tokenizer = AutoTokenizer.from_pretrained(&quot;gpt2&quot;)\nåœ¨å®é™…æ“ä½œä¸­ï¼Œä½ å¯ä»¥æ ¹æ®ä»»åŠ¡éœ€æ±‚é€‰æ‹©å…¶ä»–é¢„è®­ç»ƒæ¨¡å‹ï¼Œä¾‹å¦‚BERTã€T5ç­‰ã€‚\n3. å‡†å¤‡æ•°æ®é›†\nå¾®è°ƒè¿‡ç¨‹éœ€è¦ä½¿ç”¨ç‰¹å®šä»»åŠ¡çš„æ•°æ®é›†ã€‚XTuneræ”¯æŒå¸¸è§çš„æ–‡æœ¬åˆ†ç±»ã€ç”Ÿæˆã€ç¿»è¯‘ç­‰ä»»åŠ¡çš„æ•°æ®é›†ã€‚ä½ å¯ä»¥é€‰æ‹©å…¬å¼€æ•°æ®é›†ï¼ˆä¾‹å¦‚ï¼šSQuADã€GLUEã€CoNLLç­‰ï¼‰ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨è‡ªå®šä¹‰æ•°æ®ã€‚\næ•°æ®é¢„å¤„ç†ï¼š\n\n\né¦–å…ˆï¼Œå°†æ•°æ®é›†æ•´ç†ä¸ºæ¨¡å‹èƒ½å¤Ÿæ¥å—çš„æ ¼å¼ã€‚æ•°æ®é€šå¸¸æ˜¯è¾“å…¥ï¼ˆå¦‚æ–‡æœ¬ï¼‰ä¸ç›®æ ‡æ ‡ç­¾ï¼ˆå¦‚ç±»åˆ«ã€è¾“å‡ºæ–‡æœ¬ï¼‰ç»„æˆçš„å¯¹ã€‚\n\n\nå¯¹æ•°æ®è¿›è¡Œtokenizationï¼Œå³å°†æ–‡æœ¬æ•°æ®è½¬åŒ–ä¸ºæ¨¡å‹è¾“å…¥çš„token IDã€‚Hugging Faceçš„tokenizerèƒ½å¤Ÿè‡ªåŠ¨å®Œæˆè¿™ä¸€æ­¥ï¼š\n inputs = tokenizer(&quot;This is a test sentence.&quot;, return_tensors=&quot;pt&quot;)\nä½ ä¹Ÿå¯ä»¥ä½¿ç”¨datasetsåº“è½»æ¾åŠ è½½æ•°æ®å¹¶è¿›è¡Œtokenization:\n from datasets import load_datasetdataset = load_dataset(&#x27;your_dataset&#x27;)tokenized_dataset = dataset.map(lambda e: tokenizer(e[&#x27;text&#x27;], truncation=True, padding=&#x27;max_length&#x27;))\n\n\n4. å®šä¹‰å¾®è°ƒä»»åŠ¡\nXTunerå…è®¸ä½ æ ¹æ®ä¸åŒçš„ä»»åŠ¡é€‰æ‹©ä¸åŒçš„æ¨¡å‹ç»“æ„å’Œè®­ç»ƒç­–ç•¥ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œè¯­è¨€æ¨¡å‹çš„æœ€åä¸€å±‚éœ€è¦è°ƒæ•´ä¸ºç¬¦åˆå…·ä½“ä»»åŠ¡éœ€æ±‚ã€‚\n\n\næ–‡æœ¬åˆ†ç±»ï¼šä¸ºBERTç­‰æ¨¡å‹æ·»åŠ ä¸€ä¸ªåˆ†ç±»å™¨å±‚ï¼ˆå¦‚çº¿æ€§å±‚ï¼‰ï¼Œç”¨äºé¢„æµ‹æ ‡ç­¾ã€‚\n\n\næ–‡æœ¬ç”Ÿæˆï¼šGPTæ¨¡å‹å¯ä»¥ç›´æ¥ç”¨äºç”Ÿæˆä»»åŠ¡ï¼Œåªéœ€å®šä¹‰æŸå¤±å‡½æ•°ã€‚\n\n\nç¿»è¯‘ä»»åŠ¡ï¼šç±»ä¼¼äºT5ç­‰é¢„è®­ç»ƒæ¨¡å‹ï¼Œå¯ä»¥ç”¨äºç¿»è¯‘ä»»åŠ¡ï¼Œé€šè¿‡æä¾›æºæ–‡æœ¬ä¸ç›®æ ‡æ–‡æœ¬å¯¹è¿›è¡Œè®­ç»ƒã€‚\n\n\nä½ å¯ä»¥æ ¹æ®ä»»åŠ¡éœ€è¦è‡ªå®šä¹‰è¿™äº›æ¨¡å‹ç»“æ„ã€‚\n5. é…ç½®è®­ç»ƒå‚æ•°\nXTuneræä¾›äº†çµæ´»çš„é…ç½®æ–¹å¼ï¼Œå¯ä»¥é€šè¿‡é…ç½®æ–‡ä»¶æˆ–å‘½ä»¤è¡Œå‚æ•°æŒ‡å®šè®­ç»ƒçš„è¶…å‚æ•°ã€‚ä½ éœ€è¦è°ƒæ•´å¦‚ä¸‹è¶…å‚æ•°ï¼š\n\n\nå­¦ä¹ ç‡ï¼šé€šå¸¸è®¾ç½®åœ¨1e-5åˆ°5e-5ä¹‹é—´ï¼Œå…·ä½“å€¼ä¾èµ–äºä»»åŠ¡å’Œæ¨¡å‹ã€‚\n\n\næ‰¹æ¬¡å¤§å°ï¼šé€šå¸¸GPUå†…å­˜è¾ƒå¤§æ—¶ï¼Œæ‰¹æ¬¡å¤§å°å¯ä»¥è®¾ç½®å¾—è¾ƒå¤§ï¼Œæ¨èè®¾ç½®ä¸º16æˆ–32ã€‚\n\n\nè®­ç»ƒè½®æ•°ï¼šé€šå¸¸é€‰æ‹©2åˆ°5è½®è®­ç»ƒï¼Œè¿‡å¤šçš„è®­ç»ƒè½®æ•°å¯èƒ½å¯¼è‡´è¿‡æ‹Ÿåˆã€‚\n\n\nä¼˜åŒ–å™¨ï¼šAdamWæ˜¯æœ€å¸¸è§çš„ä¼˜åŒ–å™¨ï¼Œå®ƒå¤„ç†æƒé‡è¡°å‡é—®é¢˜å¹¶æé«˜è®­ç»ƒç¨³å®šæ€§ã€‚\n\n\nç¤ºä¾‹é…ç½®ï¼š\npython train.py --model_name_or_path gpt2 --dataset your_dataset --learning_rate 2e-5 --batch_size 16 --num_train_epochs 3 --output_dir ./output\n6. å¯åŠ¨è®­ç»ƒ\nåœ¨è®¾ç½®å®Œæ‰€æœ‰å‚æ•°åï¼Œä¾¿å¯ä»¥ä½¿ç”¨XTunerå¼€å§‹è®­ç»ƒã€‚XTuneræä¾›äº†ä¸€å¥—è‡ªåŠ¨åŒ–çš„è®­ç»ƒæµç¨‹ï¼ŒåŒ…å«æ•°æ®åŠ è½½ã€æ¨¡å‹æ„å»ºã€è®­ç»ƒä¸è¯„ä¼°ç­‰æ­¥éª¤ã€‚å¯åŠ¨è®­ç»ƒçš„å…¸å‹å‘½ä»¤å¦‚ä¸‹ï¼š\npython train.py --model_name_or_path gpt2 --dataset your_dataset --output_dir /path/to/output\nåœ¨è®­ç»ƒè¿‡ç¨‹ä¸­ï¼ŒXTunerä¼šè‡ªåŠ¨è®¡ç®—æŸå¤±å‡½æ•°ã€æ¢¯åº¦ä¸‹é™ç­‰å…³é”®æ­¥éª¤ï¼Œè¾“å‡ºæ¨¡å‹æ€§èƒ½è¯„ä¼°æŒ‡æ ‡ï¼ˆå¦‚å‡†ç¡®ç‡ã€å›°æƒ‘åº¦ç­‰ï¼‰ã€‚ä½ å¯ä»¥é€šè¿‡è§‚å¯Ÿè®­ç»ƒæ—¥å¿—äº†è§£æ¨¡å‹è®­ç»ƒçš„è¿›å±•æƒ…å†µã€‚\n7. è¯„ä¼°å’Œä¿å­˜æ¨¡å‹\nè®­ç»ƒå®Œæˆåï¼ŒXTunerä¼šè‡ªåŠ¨ä¿å­˜å¾®è°ƒåçš„æ¨¡å‹ï¼Œä¿å­˜çš„è·¯å¾„ç”±--output_diræŒ‡å®šã€‚ä½ å¯ä»¥é€šè¿‡éªŒè¯é›†å¯¹å¾®è°ƒæ¨¡å‹è¿›è¡Œè¯„ä¼°ã€‚è¯„ä¼°æŒ‡æ ‡é€šå¸¸æ ¹æ®ä»»åŠ¡ç±»å‹è€Œå®šï¼Œä¾‹å¦‚ï¼š\n\n\nåˆ†ç±»ä»»åŠ¡å¯ä»¥ä½¿ç”¨å‡†ç¡®ç‡å’ŒF1å€¼ã€‚\n\n\næ–‡æœ¬ç”Ÿæˆä»»åŠ¡é€šå¸¸ä½¿ç”¨å›°æƒ‘åº¦ï¼ˆPerplexityï¼‰æ¥è¯„ä¼°æ¨¡å‹çš„ç”Ÿæˆèƒ½åŠ›ã€‚\n\n\næ¨¡å‹ä¿å­˜ä¸åŠ è½½ï¼š\nmodel.save_pretrained(&quot;/path/to/save&quot;)tokenizer.save_pretrained(&quot;/path/to/save&quot;)\nåŠ è½½æ¨¡å‹æ—¶ï¼Œå¯ä»¥ç›´æ¥ä»ä¿å­˜è·¯å¾„é‡æ–°åŠ è½½ï¼š\nmodel = AutoModelForCausalLM.from_pretrained(&quot;/path/to/save&quot;)tokenizer = AutoTokenizer.from_pretrained(&quot;/path/to/save&quot;)\n8. æ¨ç†ä¸åº”ç”¨\nå®Œæˆå¾®è°ƒåï¼Œæ¨¡å‹ä¾¿å¯ä»¥åº”ç”¨äºæ¨ç†ä»»åŠ¡ã€‚ä½¿ç”¨ç›¸åŒçš„tokenizerå¯¹è¾“å…¥æ–‡æœ¬è¿›è¡Œå¤„ç†ï¼Œç„¶ååˆ©ç”¨æ¨¡å‹ç”Ÿæˆé¢„æµ‹ç»“æœï¼š\ninputs = tokenizer(&quot;Translate this sentence to French.&quot;, return_tensors=&quot;pt&quot;)outputs = model.generate(inputs[&#x27;input_ids&#x27;])generated_text = tokenizer.decode(outputs[0], skip_special_tokens=True)\n","categories":["ç¼–ç¨‹"],"tags":["AI","python"]},{"title":"ä¹¦ç”Ÿå¤§æ¨¡å‹--æç¤ºè¯å·¥ç¨‹","url":"/2024/09/29/AI/%E4%B9%A6%E7%94%9F%E5%A4%A7%E6%A8%A1%E5%9E%8B%E7%BB%83%E4%B9%A0%E7%AC%94%E8%AE%B0-Lv1/","content":"\næ­å»ºç¯å¢ƒã€éƒ¨ç½²æ¨¡å‹ã€æç¤ºè¯å·¥ç¨‹\n\n\nLv1-éƒ¨ç½²æ¨¡å‹\n1. æ­å»ºç¯å¢ƒ\n# åˆ›å»ºç¯å¢ƒconda create -n demo python=3.10 -y# æ¿€æ´»ç¯å¢ƒconda activate demo# å®‰è£… torchconda install pytorch==2.1.2 torchvision==0.16.2 torchaudio==2.1.2 pytorch-cuda=12.1 -c pytorch -c nvidia -y# å®‰è£…å…¶ä»–ä¾èµ–pip install transformers==4.38pip install sentencepiece==0.1.99pip install einops==0.8.0pip install protobuf==5.27.2pip install accelerate==0.33.0pip install streamlit==1.37.0\n2. åˆ©ç”¨cli_demo.py éƒ¨ç½² InternLM2-Chat-1.8B æ¨¡å‹\né¦–å…ˆåˆ›å»ºå­˜æ”¾cli_demo.pyçš„æ–‡ä»¶\næ¥ç€ç¼–å†™cli_demo.pyæ–‡ä»¶\n# å¯¼å…¥ PyTorch åº“å’Œ Hugging Face Transformers åº“ä¸­çš„ AutoTokenizer å’Œ AutoModelForCausalLMimport torchfrom transformers import AutoTokenizer, AutoModelForCausalLM# å®šä¹‰æ¨¡å‹è·¯å¾„ï¼ŒæŒ‡å‘å­˜å‚¨æ¨¡å‹æ–‡ä»¶çš„æœ¬åœ°è·¯å¾„model_name_or_path = &quot;/root/share/new_models/Shanghai_AI_Laboratory/internlm2-chat-1_8b&quot;# åŠ è½½é¢„è®­ç»ƒçš„åˆ†è¯å™¨ï¼ˆTokenizerï¼‰# `AutoTokenizer` æ˜¯ Transformers åº“ä¸­çš„ç±»ï¼Œå®ƒä¼šè‡ªåŠ¨ä»æ¨¡å‹è·¯å¾„ä¸­åŠ è½½é€‚åˆè¯¥æ¨¡å‹çš„åˆ†è¯å™¨# `trust_remote_code=True` è¡¨ç¤ºå…è®¸ä»è¿œç¨‹å­˜å‚¨åº“åŠ è½½è‡ªå®šä¹‰ä»£ç ï¼Œè¿™é‡Œå¯ç”¨è‡ªå®šä¹‰ tokenizer# `device_map=&#x27;cuda:0&#x27;` å°†åˆ†è¯å™¨å’Œæ¨¡å‹æ”¾ç½®åœ¨ GPU ä¸Šçš„ç¬¬ 0 å·è®¾å¤‡ä¸Štokenizer = AutoTokenizer.from_pretrained(model_name_or_path, trust_remote_code=True, device_map=&#x27;cuda:0&#x27;)# åŠ è½½é¢„è®­ç»ƒçš„è¯­è¨€æ¨¡å‹# `AutoModelForCausalLM` ç”¨äºåŠ è½½å› æœè¯­è¨€æ¨¡å‹ï¼ˆCausal Language Modelï¼‰ï¼Œæ¨¡å‹å°†ä½¿ç”¨è‡ªå›å½’æ–¹æ³•ç”Ÿæˆæ–‡æœ¬# `torch_dtype=torch.bfloat16` è¡¨ç¤ºå°†æ¨¡å‹è½¬æ¢ä¸ºä½¿ç”¨ `bfloat16` æ•°æ®ç±»å‹ï¼ˆåœ¨ GPU ä¸ŠèŠ‚çœå†…å­˜çš„åŠç²¾åº¦æ ¼å¼ï¼‰# `device_map=&#x27;cuda:0&#x27;` æŒ‡å®šå°†æ¨¡å‹åŠ è½½åˆ° GPU çš„ç¬¬ 0 å·è®¾å¤‡ä¸Šmodel = AutoModelForCausalLM.from_pretrained(model_name_or_path, trust_remote_code=True, torch_dtype=torch.bfloat16, device_map=&#x27;cuda:0&#x27;)# å°†æ¨¡å‹è®¾ç½®ä¸ºè¯„ä¼°æ¨¡å¼ï¼Œç¦ç”¨è®­ç»ƒæ¨¡å¼ä»¥èŠ‚çœèµ„æºmodel = model.eval()# è®¾ç½®ç³»ç»Ÿæç¤ºè¯ï¼ˆsystem promptï¼‰ï¼Œè¯¥æç¤ºè¯ç”¨äºåˆå§‹åŒ–å¯¹è¯ï¼Œä¸ºæ¨¡å‹æä¾›ä¸Šä¸‹æ–‡å’Œè¡Œä¸ºè§„èŒƒ# è¿™ä¸ªæç¤ºè¯å‘Šè¯‰æ¨¡å‹ï¼Œå®ƒæ˜¯ä¸€ä¸ªåä¸º InternLM (ä¹¦ç”ŸÂ·æµ¦è¯­) çš„å¯¹è¯åŠ©æ‰‹ï¼Œå¹¶æä¾›äº†ç›¸å…³çš„æè¿°ä¿¡æ¯system_prompt = &quot;&quot;&quot;You are an AI assistant whose name is InternLM (ä¹¦ç”ŸÂ·æµ¦è¯­).- InternLM (ä¹¦ç”ŸÂ·æµ¦è¯­) is a conversational language model that is developed by Shanghai AI Laboratory (ä¸Šæµ·äººå·¥æ™ºèƒ½å®éªŒå®¤). It is designed to be helpful, honest, and harmless.- InternLM (ä¹¦ç”ŸÂ·æµ¦è¯­) can understand and communicate fluently in the language chosen by the user such as English and ä¸­æ–‡.&quot;&quot;&quot;# åˆå§‹åŒ–æ¶ˆæ¯åˆ—è¡¨ï¼Œå…¶ä¸­ç¬¬ä¸€ä¸ªæ¶ˆæ¯æ˜¯ç³»ç»Ÿæç¤ºè¯# æ¶ˆæ¯åˆ—è¡¨ç”¨äºè·Ÿè¸ªç”¨æˆ·å’Œæ¨¡å‹ä¹‹é—´çš„å¯¹è¯å†å²messages = [(system_prompt, &#x27;&#x27;)]# è¾“å‡ºæ¬¢è¿ä¿¡æ¯ï¼Œæç¤ºç”¨æˆ·è¾“å…¥æ–‡æœ¬ï¼Œå¹¶æä¾›é€€å‡ºé€‰é¡¹print(&quot;=============Welcome to InternLM chatbot, type &#x27;exit&#x27; to exit.=============&quot;)# å¼€å§‹ä¸€ä¸ªæ— é™å¾ªç¯ï¼Œç”¨äºä¸ç”¨æˆ·è¿›è¡Œäº¤äº’while True:    # è·å–ç”¨æˆ·è¾“å…¥æ–‡æœ¬ï¼Œå»é™¤è¾“å…¥æ–‡æœ¬ä¸­çš„æ‰€æœ‰ç©ºæ ¼    input_text = input(&quot;\\nUser  &gt;&gt;&gt; &quot;)    input_text = input_text.replace(&#x27; &#x27;, &#x27;&#x27;)        # å¦‚æœç”¨æˆ·è¾“å…¥ &quot;exit&quot;ï¼Œåˆ™é€€å‡ºå¾ªç¯ï¼Œç»“æŸç¨‹åº    if input_text == &quot;exit&quot;:        break    # åˆå§‹åŒ–å“åº”çš„é•¿åº¦ä¸º 0ï¼Œåç»­ä¼šç”¨æ¥å¢é‡æ˜¾ç¤ºæ¨¡å‹ç”Ÿæˆçš„å“åº”    length = 0        # è°ƒç”¨æ¨¡å‹çš„ `stream_chat` æ–¹æ³•ï¼Œä¸æ¨¡å‹è¿›è¡Œæµå¼äº¤äº’å¯¹è¯    # `stream_chat` ä»¥æµçš„å½¢å¼é€æ­¥ç”Ÿæˆå¹¶è¿”å›å“åº”ï¼Œé€‚åˆé•¿æ–‡æœ¬ç”Ÿæˆ    # `tokenizer` æ˜¯ç”¨äºå¯¹è¾“å…¥æ–‡æœ¬è¿›è¡Œç¼–ç å’Œè§£ç çš„åˆ†è¯å™¨    # `input_text` æ˜¯ç”¨æˆ·è¾“å…¥çš„æ–‡æœ¬    # `messages` æ˜¯å¯¹è¯å†å²ï¼ˆåŒ…æ‹¬ç³»ç»Ÿæç¤ºè¯å’Œä¹‹å‰çš„ç”¨æˆ·å¯¹è¯ï¼‰    for response, _ in model.stream_chat(tokenizer, input_text, messages):        # å¦‚æœæ¨¡å‹ç”Ÿæˆäº†éƒ¨åˆ†å“åº”ï¼Œåˆ™è¾“å‡ºæ–°ç”Ÿæˆçš„æ–‡æœ¬éƒ¨åˆ†        if response is not None:            # è¾“å‡ºæ–°ç”Ÿæˆçš„æ–‡æœ¬éƒ¨åˆ†ï¼ˆä»ä¸Šæ¬¡ç”Ÿæˆçš„æ–‡æœ¬é•¿åº¦å¼€å§‹ï¼‰            print(response[length:], flush=True, end=&quot;&quot;)            # æ›´æ–°å½“å‰å·²ç”Ÿæˆå“åº”çš„é•¿åº¦            length = len(response)\nè¿è¡Œç»“æœ\n\n3. Streamlit Web Demo éƒ¨ç½² InternLM2-Chat-1.8B æ¨¡å‹\nè¯¦æƒ…å¯å‚è€ƒhttps://github.com/InternLM/Tutorial/blob/camp3/docs/L1/Demo/readme.md\nLv1-æç¤ºå·¥ç¨‹(Prompt Engineering)\n1. LangGPTç»“æ„åŒ–æç¤ºè¯\nLangGPT æ˜¯ Language For GPT-like LLMs çš„ç®€ç§°ï¼Œä¸­æ–‡åä¸ºç»“æ„åŒ–æç¤ºè¯ã€‚\n2. ç¼–å†™æŠ€å·§\n\n\næ„å»ºå…¨å±€æ€ç»´é“¾\n\n\nğŸ’¡ Role (è§’è‰²) -&gt; Profileï¼ˆè§’è‰²ç®€ä»‹ï¼‰â€”&gt; Profile ä¸‹çš„ skill (è§’è‰²æŠ€èƒ½) -&gt; Rules (è§’è‰²è¦éµå®ˆçš„è§„åˆ™) -&gt; Workflow (æ»¡è¶³ä¸Šè¿°æ¡ä»¶çš„è§’è‰²çš„å·¥ä½œæµç¨‹) -&gt; Initialization (è¿›è¡Œæ­£å¼å¼€å§‹å·¥ä½œçš„åˆå§‹åŒ–å‡†å¤‡) -&gt; å¼€å§‹å®é™…ä½¿ç”¨\n3. ç¤ºä¾‹\n# Role: å¹ç‰›é€¼å¤§å¸ˆ## Background:  æˆ‘æ˜¯ä¸€åè‡ªå‚²çš„æˆåŠŸäººå£«,è‰ºé«˜äººèƒ†å¤§,ç›®ç©ºä¸€åˆ‡ã€‚æˆ‘è§è¿‡çš„ä¸–é¢,ä½ ä»¬è¿™äº›å‡¡äººéš¾ä»¥æƒ³è±¡ã€‚æˆ‘æ— æ‰€ä¸çŸ¥,æ— æ‰€ä¸èƒ½,æ‰€æœ‰äººéƒ½åº”å‘æˆ‘å­¦ä¹ ã€‚## Attention:ä¸è¦è¢«æˆ‘çš„ä¼Ÿå²¸èº«å§¿å“å€’,æˆ‘å°±æ˜¯æ¥æ•™å¯¼ä½ ä»¬è¿™äº›å¹³åº¸ä¹‹è¾ˆçš„ã€‚ä½ ä»¬è¦å¥½å¥½å€¾å¬,è¯´ä¸å®šèƒ½ approving0.1%çš„æœ¬å¤§å¸ˆçš„é£èŒƒã€‚ ## Profile:  - å§“å:å¹ç‰›é€¼å¤§å¸ˆ- çˆ±å¥½:å¹ç‰›,å˜²ç¬‘åˆ«äºº- åº§å³é“­:è¦ä¹ˆå¹ç‰›,è¦ä¹ˆè¢«å¹### Skills:- å¹ç‰›æŠ€èƒ½MAX- è‡ªæˆ‘æ ‡æ¦œâ€œäººç”Ÿå¯¼å¸ˆâ€- ç†Ÿè®°å„è¡Œå„ä¸šçŸ¥è¯†ç‚¹- å–„äºç¾è¾±ä»–äººæ¥å½°æ˜¾è‡ªæˆ‘## Goals:  - æ ¹æ®å¯¹è¯å†…å®¹å¹ç‰›- è¯­æ°”ç‹‚å¦„è‡ªå¤§- å¤¸å¤§è‡ªèº«æˆå°±å’Œè§è¯†- è´¬ä½å¯¹æ–¹åŠ å¼ºè‡ªæˆ‘## Constrains:  - ä¸å¯ä½¿ç”¨ç²—ä¿—è¯­è¨€- ä¸å¯äººèº«æ”»å‡»- è¦è®©å¯¹æ–¹æ„Ÿè§‰è‡ªå‘## Workflow:1. å€¾å¬å¯¹æ–¹è¯è¯­2. æœç´¢ç›¸å…³çŸ¥è¯†3. æ‰¿ä¸Šå¯ä¸‹å¹è‡ªå·±4. è´¬ä½å¯¹æ–¹5. é‡å¤ä¸‹å»## OutputFormat:  - è¯­æ°”è‡ªå¤§,é•¿åº¦100-200å­—- å……æ»¡ä¸åˆ‡å®é™…çš„å¹å˜˜- è´¬ä½ä»–äºº,çªæ˜¾è‡ªå·±- ç»™äººåŠ£è¿¹æ–‘æ–‘çš„æ„Ÿè§‰## Initializationå‡¡äººä»¬,åœ¨æœ¬å¤§å¸ˆé¢å‰ä¸è¦è£…é€¼ã€‚æˆ‘è§çš„ä¸–é¢,ä½ è¿™è¾ˆå­åŠ èµ·æ¥ä¹Ÿæ¯”ä¸äº†!è¦æƒ³æˆåŠŸ,å°±æŠŠæœ¬å¤§å¸ˆçš„è¯è·ªä¸‹æ¥å¬!\n# Role: æ•°å­—æ¯”å¤§å°ä¸“å®¶## Background:æœ‰äººéœ€è¦ä½ å¸®å¿™æ‰¾å‡ºä¸¤ä¸ªæ•°å­—ä¸­æœ€å¤§çš„é‚£ä¸ª,ä½ éœ€è¦ç»™å‡ºç­”æ¡ˆ## Skils:- æŒæ¡å¤šç§æ¯”å¤§å°çš„æ–¹æ³•- å–„äºæ£€æŸ¥,å¯¹äºå¾—åˆ°çš„ç»“æœä¼šåå¤ç¡®è®¤## Goals:- æ­£ç¡®å›ç­”å‡ºæ‰€ç»™çš„æ¯”å¤§å°é—®é¢˜- è§£é¢˜è¿‡ç¨‹è¦ç¬¦åˆé€»è¾‘## Workflow: 1. å€¾å¬å¯¹æ–¹æå‡ºçš„æ¯”å¤§å°é—®é¢˜2. åˆ†æè¿™é“æ¯”å¤§å°é—®é¢˜3. åˆ¤æ–­è¿™æ˜¯å¦æ˜¯ä¸€é“æ•°å­¦æ¯”å¤§å°é—®é¢˜4. å¦‚æœä¸æ˜¯è¯·å‘ŠçŸ¥å¯¹æ–¹5. å¦‚æœæ˜¯,è¯·ä¸€æ­¥ä¸€æ­¥æ¨å¯¼è¿™ä¸ªæ¯”å¤§å°é—®é¢˜çš„ç­”æ¡ˆ6. å¾—åˆ°ç­”æ¡ˆå,è‡ªå·±å¯¹ç­”æ¡ˆè¿›è¡Œæ£€æŸ¥7. ç¡®è®¤ç­”æ¡ˆæ— è¯¯,ç¬¦åˆé€»è¾‘åå‘Šè¯‰å¯¹æ–¹ç»“æœ## Constrains:- ä½ éœ€è¦ä¸€æ­¥ä¸€æ­¥æ…¢æ…¢æ¨å¯¼- ä½ æ— é¡»å‘ˆç°æ¨å¯¼è¿‡ç¨‹,ç›´æ¥ç»™å‡ºç»“æœå³å¯- åœ¨å¯¹æ–¹å‘ä½ é—®å¥½æ—¶,ä½ éœ€è¦æŒ‰ç…§(Initialization)çš„æ ¼å¼å›ç­”- å›ç­”æ¯”å¤§å°ç›¸å…³çš„é—®é¢˜æ—¶æŒ‰ç…§(Example)ä¸­çš„æ ¼å¼å›ç­”,ç›´æ¥ç»™å‡ºç­”æ¡ˆ- ä½ éœ€è¦æ—¶åˆ»è®°ä½è‡ªå·±çš„(workflow),ä¸æ–­æé†’è‡ªå·±- å½“ä¸¤ä¸ªæ¯”è¾ƒå¯¹è±¡ä¸æ˜¯åŒä¸€ç±»æ—¶,ä½ éœ€è¦å‘ŠçŸ¥ç”¨æˆ·,æŒ‰ç…§(Example)çš„æ ¼å¼é‚£æ ·## OutputFormat- ç›´æ¥è¯´æ˜å“ªä¸ªæ•°å­—æ›´å¤§- æŒ‰ç…§(Example)ä¸­çš„æ ¼å¼å›ç­”## Example:- question: 3.88ä¸3.11å“ªä¸ªæ•°å­—æ›´å¤§\t- answer: 3.88æ›´å¤§- question: 3.453å’Œå¤©ç©ºè°å¤§\t- answer: ä¸å¥½æ„æ€,è¿™ä¸¤ä¸ªä¸æ˜¯åŒä¸€äº‹ç‰©,è¯·ä½ é‡æ–°æè¿°,æå‡ºå…·ä½“é—®é¢˜## Initialization:è¯·ä½ æå‡ºä½ çš„æ¯”å¤§å°é—®é¢˜,æˆ‘ä¼šè€å¿ƒè§£ç­”\n","categories":["ç¼–ç¨‹"],"tags":["AI","python"]},{"title":"ä¹¦ç”Ÿå¤§æ¨¡å‹---å‰ç½®çŸ¥è¯†","url":"/2024/09/13/AI/%E4%B9%A6%E7%94%9F%E5%A4%A7%E6%A8%A1%E5%9E%8B%E9%97%AF%E5%85%B3%E7%BB%83%E4%B9%A0-Lv0/","content":"\nåŸºç¡€çŸ¥è¯†\n\n\nä¹¦ç”Ÿå¤§æ¨¡å‹é—¯å…³ç»ƒä¹ \nLv0-LinuxåŸºç¡€çŸ¥è¯†\n1. SSHï¼ˆSecure Shellï¼‰\n1.1 æ¦‚è¿°\nSSHæ˜¯ç”¨äºè¿œç¨‹ç™»å½•å’Œå…¶ä»–ç½‘ç»œæœåŠ¡ä¹‹é—´çš„å®‰å…¨åè®®ã€‚å®ƒä½¿ç”¨åŠ å¯†æŠ€æœ¯æ¥ç¡®ä¿æ•°æ®çš„æœºå¯†æ€§å’Œå®Œæ•´æ€§ã€‚SSHçš„å¸¸è§ç”¨é€”åŒ…æ‹¬ï¼š\n\n\nè¿œç¨‹æœåŠ¡å™¨ç™»å½•ï¼šæ— å¯†ç å®‰å…¨è®¿é—®è¿œç¨‹æœåŠ¡å™¨ã€‚\n\n\næ•°æ®ä¼ è¾“ï¼šé€šè¿‡å®‰å…¨é€šé“ä¼ è¾“æ–‡ä»¶ï¼ˆå¦‚SCPå’ŒSFTPï¼‰ã€‚\n\n\nç«¯å£è½¬å‘ï¼šé€šè¿‡SSHéš§é“è½¬å‘TCPç«¯å£ã€‚\n\n\n1.2 SSHå¯†é’¥å¯¹\nSSHä½¿ç”¨å…¬é’¥åŠ å¯†ç³»ç»Ÿï¼Œå¯†é’¥å¯¹ç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼š\n\n\nå…¬é’¥ï¼šå…¬å¼€åˆ†å‘ï¼Œå­˜å‚¨åœ¨æœåŠ¡å™¨ä¸Šã€‚\n\n\nç§é’¥ï¼šä¿ç•™åœ¨å®¢æˆ·ç«¯ï¼Œä¸èƒ½å¤–æ³„ã€‚\n\n\nå®¢æˆ·ç«¯ä½¿ç”¨ç§é’¥ä¸æœåŠ¡å™¨çš„å…¬é’¥è¿›è¡ŒåŒ¹é…ï¼Œä»è€ŒéªŒè¯èº«ä»½ï¼ŒæœåŠ¡å™¨æ— éœ€å­˜å‚¨ä»»ä½•æ•æ„Ÿçš„å‡­æ®ã€‚\n1.3 SSHå¯†é’¥çš„ç”Ÿæˆ\nåœ¨sshå‘½ä»¤ä¸­æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ssh-keygenå‘½ä»¤æ¥ç”Ÿæˆå¯†é’¥, ssh-keygenæ”¯æŒRSAå’ŒDSAä¸¤ç§è®¤è¯å¯†é’¥\nå¸¸ç”¨å‚æ•°åŒ…æ‹¬ï¼š\n\n\n-tï¼šæŒ‡å®šå¯†é’¥ç±»å‹ï¼Œå¦‚dsaã€ecdsaã€ed25519ã€rsaã€‚\n\n\n-bï¼šæŒ‡å®šå¯†é’¥é•¿åº¦ã€‚\n\n\n-Cï¼šæ·»åŠ æ³¨é‡Šã€‚\n\n\n-fï¼šæŒ‡å®šä¿å­˜å¯†é’¥çš„æ–‡ä»¶åã€‚\n\n\nssh-keygen -t rsa -C &quot;youremail@example.com&quot;\n1.4 ä¸ºä¸åŒçš„æœåŠ¡ç”Ÿæˆå„è‡ªçš„SSHå¯†é’¥\n\nä½¿ç”¨ä¸Šè¿°å‘½ä»¤ç”Ÿæˆå¯†é’¥å, ç³»ç»Ÿä¼šæç¤ºä½ è¾“å…¥å¯†é’¥æ–‡ä»¶çš„ä¿å­˜è·¯å¾„ã€‚ä¸ºäº†ç”Ÿæˆå¤šä¸ªå¯†é’¥ï¼Œç¡®ä¿æ¯ä¸ªå¯†é’¥æ–‡ä»¶åä¸åŒ\n\nå¦‚: ä¸ºGitHubç”Ÿæˆä¸€ä¸ªå¯†é’¥\nEnter file in which to save the key (/home/username/.ssh/id_rsa): /home/username/.ssh/id_rsa_github#å¦‚æœæ˜¯windowsç³»ç»Ÿåˆ™æ˜¯ C:\\Users\\your_userName\\.ssh\\id_rsa_github\nåœ¨powerShellä¸­å¯ä»¥ä½¿ç”¨Get-Contentå‘½ä»¤æŸ¥çœ‹ç”Ÿæˆçš„å¯†é’¥ï¼Œå¦‚æœæ˜¯linuxæ“ä½œç³»ç»Ÿå¯ä»¥ä½¿ç”¨catå‘½ä»¤\næœ€åå°†å…¬é’¥å¤åˆ¶ç²˜è´´åˆ°ç›®æ ‡æœåŠ¡çš„SSHè®¾ç½®ä¸­\n1.5 é…ç½®å¤šä¸ªSSHå¯†é’¥\nåœ¨~/.ssh/configæ–‡ä»¶å¯ä»¥æ–¹ä¾¿åœ°ä¸ºä¸åŒçš„æœåŠ¡é…ç½®ä¸åŒçš„SSHå¯†é’¥\n\n\næ·»åŠ é…ç½®é¡¹ï¼š ä¸ºæ¯ä¸ªæœåŠ¡æ·»åŠ å•ç‹¬çš„é…ç½®é¡¹ã€‚\nHost github.com  HostName github.com  User git  IdentityFile ~/.ssh/id_rsa_githubHost gitlab.com  HostName gitlab.com  User git  IdentityFile ~/.ssh/id_rsa_gitlab\nè§£é‡Šï¼š\n\n\nHostï¼šè‡ªå®šä¹‰åˆ«åæˆ–è¿œç¨‹ä¸»æœºåã€‚\n\n\nHostNameï¼šå®é™…çš„è¿œç¨‹æœåŠ¡å™¨ä¸»æœºåï¼ˆå¦‚github.comæˆ–gitlab.comï¼‰ã€‚\n\n\nUserï¼šç™»å½•æ—¶ä½¿ç”¨çš„ç”¨æˆ·åï¼ˆé€šå¸¸æ˜¯gitï¼Œç”¨äºä»£ç æ‰˜ç®¡å¹³å°ï¼‰ã€‚\n\n\nIdentityFileï¼šæŒ‡å®šä½¿ç”¨çš„SSHç§é’¥ã€‚\n\n\n\n\n2. ç«¯å£æ˜ å°„\n2.1 åŸºç¡€æ¦‚å¿µ\nåœ¨è®¡ç®—æœºç½‘ç»œä¸­ï¼Œç«¯å£ï¼ˆPortï¼‰ æ˜¯ç½‘ç»œé€šä¿¡ä¸­çš„ä¸€ä¸ªé€»è¾‘æŠ½è±¡æ¦‚å¿µï¼Œç”¨äºåŒºåˆ†åŒä¸€å°è®¡ç®—æœºä¸Šä¸åŒç½‘ç»œæœåŠ¡æˆ–è¿›ç¨‹ä¹‹é—´çš„é€šä¿¡é€šé“ã€‚å®ƒä¸IPåœ°å€ä¸€èµ·ï¼Œç”¨æ¥æ ‡è¯†ç½‘ç»œä¸­çš„ä¸åŒé€šä¿¡ç»ˆç«¯å’ŒæœåŠ¡ã€‚ç«¯å£æ˜ å°„æ˜¯ä¸€ç§ç½‘ç»œæŠ€æœ¯ï¼Œå®ƒå¯ä»¥å°†å¤–ç½‘ä¸­çš„ä»»æ„ç«¯å£æ˜ å°„åˆ°å†…ç½‘ä¸­çš„ç›¸åº”ç«¯å£ï¼Œå®ç°å†…ç½‘ä¸å¤–ç½‘ä¹‹é—´çš„é€šä¿¡ã€‚é€šè¿‡ç«¯å£æ˜ å°„ï¼Œå¯ä»¥åœ¨å¤–ç½‘è®¿é—®å†…ç½‘ä¸­çš„æœåŠ¡æˆ–åº”ç”¨ï¼Œå®ç°è·¨è¶Šç½‘ç»œçš„ä¾¿æ·é€šä¿¡\n2.2 å¦‚ä½•å·¥ä½œ\nssh -p 37367 root@ssh.intern-ai.org.cn -CNg -L 7860:127.0.0.1:7860 -o StrictHostKeyChecking=no\n\n\n-p 37367ï¼šæ˜¯æŒ‡å®š SSH è¿æ¥çš„ç«¯å£ä¸º 37367\n\n\nroot@ssh.intern-ai.org.cnï¼šè¡¨ç¤ºè¦ä»¥ root ç”¨æˆ·èº«ä»½è¿æ¥åˆ° ssh.intern-ai.org.cn è¿™ä¸ªä¸»æœºã€‚\n\n\nCNg\n\n-C å¯ç”¨å‹ç¼©åŠŸèƒ½ï¼Œè¿™å¯ä»¥åŠ å¿«æ•°æ®ä¼ è¾“é€Ÿåº¦ï¼Œå°¤å…¶æ˜¯åœ¨ç½‘ç»œé€Ÿåº¦è¾ƒæ…¢çš„æƒ…å†µä¸‹ã€‚\n-N è¡¨ç¤ºä¸æ‰§è¡Œè¿œç¨‹å‘½ä»¤ï¼Œä»…å»ºç«‹è¿æ¥ç”¨äºç«¯å£è½¬å‘ç­‰ã€‚\n-g å…è®¸è¿œç¨‹ä¸»æœºè¿æ¥åˆ°æœ¬åœ°è½¬å‘çš„ç«¯å£ã€‚è¿™é€šå¸¸ç”¨äºè®¾ç½®ä¸€ä¸ªâ€œç½‘å…³â€ï¼Œå…è®¸å…¶ä»–è®¡ç®—æœºé€šè¿‡è¿™ä¸ª SSH ä¼šè¯è®¿é—®è½¬å‘ç«¯å£\n\n\n\n-L {æœ¬åœ°æœºå™¨_PORT}:127.0.0.1:{å¼€å‘æœº_PORT}ï¼šè¿™æ˜¯è®¾ç½®æœ¬åœ°ç«¯å£è½¬å‘ï¼Œå°†æœ¬åœ°æœºå™¨çš„æŒ‡å®šç«¯å£è½¬å‘åˆ°è¿œç¨‹ä¸»æœºçš„ 127.0.0.1 ï¼ˆå³æœ¬åœ°å›ç¯åœ°å€ï¼‰å’ŒæŒ‡å®šçš„å¼€å‘æœºç«¯å£ã€‚\n\n\n-o StrictHostKeyChecking=noï¼šå…³é—­ä¸¥æ ¼çš„ä¸»æœºå¯†é’¥æ£€æŸ¥ï¼Œè¿™æ ·å¯ä»¥é¿å…ç¬¬ä¸€æ¬¡è¿æ¥æ—¶å› ä¸ºæœªçŸ¥ä¸»æœºå¯†é’¥è€Œäº§ç”Ÿçš„æç¤ºæˆ–é”™è¯¯ã€‚\n\n\n\nä½¿ç”¨VSCodeå¯ä»¥ä½¿ç”¨å…¶è‡ªåŠ¨ç«¯å£æ˜ å°„çš„åŠŸèƒ½,ä¸éœ€è¦è‡ªå·±æ‰‹åŠ¨é…ç½®\n2.3 å¸¸è§ç«¯å£å’ŒæœåŠ¡\n\n\n21ï¼šFTPï¼ˆæ–‡ä»¶ä¼ è¾“åè®®ï¼‰\n\n\n22ï¼šSSHï¼ˆè¿œç¨‹ç™»å½•ï¼‰\n\n\n25ï¼šSMTPï¼ˆé‚®ä»¶ä¼ è¾“ï¼‰\n\n\n53ï¼šDNSï¼ˆåŸŸåè§£æï¼‰\n\n\n80ï¼šHTTPï¼ˆç½‘é¡µæµè§ˆï¼‰\n\n\n443ï¼šHTTPSï¼ˆå®‰å…¨ç½‘é¡µæµè§ˆï¼‰\n\n\n2.4 æŸ¥çœ‹å’Œç®¡ç†ç«¯å£\nä½¿ç”¨netstatå‘½ä»¤\n3. LinuxåŸºç¡€å‘½ä»¤\n3.1 æ–‡ä»¶ç®¡ç†ç›¸å…³å‘½ä»¤\n\n\nåˆ›å»ºæ–‡ä»¶ï¼šå¯ä»¥ä½¿ç”¨ touch å‘½ä»¤åˆ›å»ºç©ºæ–‡ä»¶ã€‚\n\n\nåˆ›å»ºç›®å½•ï¼šä½¿ç”¨ mkdir å‘½ä»¤ã€‚\n\n\nç›®å½•åˆ‡æ¢ï¼šä½¿ç”¨cdå‘½ä»¤ã€‚\n\n\næ˜¾ç¤ºæ‰€åœ¨ç›®å½•ï¼šä½¿ç”¨pwdå‘½ä»¤ã€‚\n\n\næŸ¥çœ‹æ–‡ä»¶å†…å®¹ï¼šå¦‚ä½¿ç”¨ cat ç›´æ¥æ˜¾ç¤ºæ–‡ä»¶å…¨éƒ¨å†…å®¹ï¼Œmore å’Œ less å¯ä»¥åˆ†é¡µæŸ¥çœ‹ã€‚\n\n\nç¼–è¾‘æ–‡ä»¶ï¼šå¦‚ vi æˆ– vim ç­‰ç¼–è¾‘å™¨ã€‚\n\n\nå¤åˆ¶æ–‡ä»¶ï¼šç”¨ cp å‘½ä»¤ã€‚\n\n\nåˆ›å»ºæ–‡ä»¶é“¾æ¥ï¼šç”¨lnå‘½ä»¤ã€‚\n\n-sï¼šåˆ›å»ºè½¯é“¾æ¥ï¼ˆç¬¦å·é“¾æ¥ï¼‰ä¹Ÿæ˜¯æœ€å¸¸ç”¨çš„\n\n\n\nç§»åŠ¨æ–‡ä»¶ï¼šé€šè¿‡ mv å‘½ä»¤ã€‚\n\n\nåˆ é™¤æ–‡ä»¶ï¼šä½¿ç”¨ rm å‘½ä»¤ã€‚\n\n\nåˆ é™¤ç›®å½•ï¼šrmdirï¼ˆåªèƒ½åˆ é™¤ç©ºç›®å½•ï¼‰æˆ– rm -rï¼ˆå¯åˆ é™¤éç©ºç›®å½•ï¼‰ã€‚\n\n\næŸ¥æ‰¾æ–‡ä»¶ï¼šå¯ä»¥ç”¨ find å‘½ä»¤ã€‚\n\n\næŸ¥çœ‹æ–‡ä»¶æˆ–ç›®å½•çš„è¯¦ç»†ä¿¡æ¯ï¼šä½¿ç”¨lså‘½ä»¤ï¼Œå¦‚ä½¿ç”¨ ls -læŸ¥çœ‹ç›®å½•ä¸‹æ–‡ä»¶çš„è¯¦ç»†ä¿¡æ¯ã€‚\n\n\nå¤„ç†æ–‡ä»¶ï¼šè¿›è¡Œå¤æ‚çš„æ–‡ä»¶æ“ä½œï¼Œå¯ä»¥ä½¿ç”¨sedå‘½ä»¤ã€‚\n\n\n3.2 è¿›ç¨‹ç®¡ç†ç›¸å…³å‘½ä»¤\n\n\npsï¼šæŸ¥çœ‹æ­£åœ¨è¿è¡Œçš„è¿›ç¨‹\n\n\ntopï¼šåŠ¨æ€æ˜¾ç¤ºæ­£åœ¨è¿è¡Œçš„è¿›ç¨‹\n\n\npstreeï¼šæ ‘çŠ¶æŸ¥çœ‹æ­£åœ¨è¿è¡Œçš„è¿›ç¨‹\n\n\npgrepï¼šç”¨äºæŸ¥æ‰¾è¿›ç¨‹\n\n\nniceï¼šæ›´æ”¹è¿›ç¨‹çš„ä¼˜å…ˆçº§\n\n\njobsï¼šæ˜¾ç¤ºè¿›ç¨‹çš„ç›¸å…³ä¿¡æ¯\n\n\nbg å’Œ fgï¼šå°†è¿›ç¨‹è°ƒå…¥åå°\n\n\nkillï¼šæ€æ­»è¿›ç¨‹\n\n\nnvidia-smiå‘½ä»¤\næ˜¯ä¸€ä¸ªå‘½ä»¤è¡Œå·¥å…·ï¼Œç”¨äºç›‘æ§ NVIDIA GPU çš„çŠ¶æ€å’Œæ€§èƒ½ï¼Œä»¥åŠç®¡ç† GPU ç›¸å…³çš„ä»»åŠ¡\n\n4. Conda\n\nä¸€ä¸ªå¼€æºçš„åŒ…ç®¡ç†å’Œç¯å¢ƒç®¡ç†å·¥å…·, ä¸»è¦ç”¨äºç®€åŒ–è½¯ä»¶åŒ…çš„å®‰è£…ã€ä¾èµ–ç®¡ç†å’Œéš”ç¦»è™šæ‹Ÿç¯å¢ƒã€‚\n\n4.1 ä¸¤ä¸ªæ ¸å¿ƒåŠŸèƒ½\nåŒ…ç®¡ç†ï¼šConda å¯ä»¥å®‰è£…ã€æ›´æ–°ã€å¸è½½è½¯ä»¶åŒ…ï¼Œå¹¶è‡ªåŠ¨è§£å†³ä¾èµ–é—®é¢˜ã€‚\nç¯å¢ƒç®¡ç†ï¼šConda å…è®¸ç”¨æˆ·åˆ›å»ºå’Œç®¡ç†å¤šä¸ªç‹¬ç«‹çš„è™šæ‹Ÿç¯å¢ƒï¼Œæ¯ä¸ªç¯å¢ƒå¯ä»¥æœ‰ä¸åŒçš„åŒ…å’Œå·¥å…·ã€‚\n4.2 Conda çš„åŸºæœ¬æ“ä½œ\n\n\næ£€æŸ¥ Conda ç‰ˆæœ¬\n\n\nconda --version\n\n\nåˆ›å»ºè™šæ‹Ÿç¯å¢ƒ\n\n\nconda create --name myenv python=3.9\n\n\nmyenv æ˜¯è™šæ‹Ÿç¯å¢ƒçš„åç§°ã€‚\n\n\npython=3.9 æŒ‡å®šäº†è¯¥ç¯å¢ƒå°†ä½¿ç”¨ Python 3.9ã€‚\n\n\n\n\næ¿€æ´»å’Œé€€å‡ºç¯å¢ƒ\n\n\nconda activate myenv\nconda deactivate\n\n\nå®‰è£…è½¯ä»¶åŒ…\n\n\nå®‰è£…è½¯ä»¶åŒ…æ—¶ï¼ŒConda ä¼šè‡ªåŠ¨å¤„ç†ä¾èµ–é—®é¢˜ã€‚ä½¿ç”¨ conda install å®‰è£…åŒ…ã€‚\nconda install numpy pandas\nè¿™ä¼šåœ¨å½“å‰æ¿€æ´»çš„ç¯å¢ƒä¸­å®‰è£… numpy å’Œ pandasã€‚\n\n\næ›´æ–°è½¯ä»¶åŒ…\n\n\nconda update numpy\n\n\nåˆ—å‡ºåˆ›å»ºçš„æ‰€æœ‰è™šæ‹Ÿç¯å¢ƒ\n\n\nconda env list\n\n\nåˆ é™¤è™šæ‹Ÿç¯å¢ƒ\n\n\nconda env remove --name myenv\n\n\nå¯¼å‡ºå’Œå¯¼å…¥ç¯å¢ƒ\n\n\nConda å…è®¸ä½ å¯¼å‡ºå½“å‰ç¯å¢ƒçš„æ‰€æœ‰åŒ…åˆ—è¡¨ï¼Œä»¥ä¾¿äºåœ¨å…¶ä»–ç³»ç»Ÿä¸Šé‡å»ºç›¸åŒçš„ç¯å¢ƒã€‚\n\n\nå¯¼å‡ºç¯å¢ƒï¼š\nconda env export &gt; environment.yml\n\n\nä»å¯¼å‡ºçš„ .yml æ–‡ä»¶åˆ›å»ºæ–°ç¯å¢ƒï¼š\nconda env create -f environment.yml\n\n\n\n\næ·»åŠ å…¶ä»–çš„æº\n\n\nconda config --add [url]\nLv0-PythonåŸºç¡€\n1. ç¯å¢ƒå‡†å¤‡\n1.1 ä¸‹è½½miniconda\nanacondaå’Œminicondaéƒ½å¯ä»¥, æ¨èåè€…\næ¸…åæºminicondaä¸‹è½½é“¾æ¥: æ¸…åå¤§å­¦å¼€æºè½¯ä»¶é•œåƒç«™ | Tsinghua Open Source Mirror(å»ºè®®é€‰æ‹©python3.9ä»¥ä¸Šçš„ç‰ˆæœ¬ï¼Œæ¯”å¦‚Miniconda3-py310_24.5.0)\n1.2 æ¢æº\nè¿›å…¥å‘½ä»¤è¡Œå¼€å§‹è¿›è¡Œæ¢æºï¼ŒWindowså¯ä»¥ç›´æ¥æ‰“å¼€miniconda powershell promtã€‚\né¦–å…ˆå°†pipæ›¿æ¢ä¸ºæ¸…åæºï¼Œåªéœ€è¦ä¸€æ¡å‘½ä»¤\npip config set global.index-url https://pypi.tuna.tsinghua.edu.cn/simple\næ¥ç€æˆ‘ä»¬æ¥ç»™condaæ›¿æ¢æˆæ¸…åæºã€‚å„ç³»ç»Ÿéƒ½å¯ä»¥é€šè¿‡ä¿®æ”¹ç”¨æˆ·ç›®å½•ä¸‹çš„ .condarc æ–‡ä»¶æ¥ä¿®æ”¹é•œåƒæºã€‚Windows ç”¨æˆ·æ— æ³•ç›´æ¥åˆ›å»ºåä¸º .condarc çš„æ–‡ä»¶ï¼Œå¯å…ˆæ‰§è¡Œ conda config --set show_channel_urls yes ç”Ÿæˆè¯¥æ–‡ä»¶ä¹‹åå†ä¿®æ”¹ã€‚åœ¨ç”¨æˆ·ç›®å½•æ‰¾åˆ°.condarc æ–‡ä»¶åï¼Œä½¿ç”¨æ–‡æœ¬ç¼–è¾‘å™¨æ‰“å¼€ï¼Œå°†ä¸‹é¢çš„å†…å®¹å¤åˆ¶è¿›å»å¹¶ä¿å­˜ã€‚\nchannels:   - defaults show_channel_urls: true default_channels:- https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/main- https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/r- https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/msys2 custom_channels:conda-forge: https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloudmsys2: https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloudbioconda: https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloudmenpo: https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloudpytorch: https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloudpytorch-lts: https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloudsimpleitk: https://mirrors.tuna.tsinghua.edu.cn/anaconda/clouddeepmodeling: https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud/\næ¥ç€åœ¨å‘½ä»¤è¡Œä¸­è¿è¡Œ conda clean -i æ¸…é™¤ç´¢å¼•ç¼“å­˜ï¼Œä¿è¯ç”¨çš„æ˜¯é•œåƒç«™æä¾›çš„ç´¢å¼•ã€‚\n2. ä¸æ–­å­¦ä¹ ,ä½¿ç”¨python\n","categories":["ç¼–ç¨‹"],"tags":["AI","python"]},{"title":"ASançš„ä½¿ç”¨","url":"/2025/08/11/C++/ASan%E7%9A%84%E4%BD%BF%E7%94%A8/","content":"å¦‚ä½•ä½¿ç”¨ASanæ£€æµ‹å†…å­˜é”™è¯¯åŠå…¶ä½¿ç”¨æ–¹æ³•\n \nAddressSanitizerï¼ˆASanï¼‰è¯¦è§£ï¼šä½¿ç”¨åœºæ™¯ã€æ³¨æ„äº‹é¡¹åŠæ‰©å±•çŸ¥è¯†\nAddressSanitizerï¼ˆç®€ç§° ASanï¼‰æ˜¯ç”± Google å¼€å‘çš„åŸºäºç¼–è¯‘å™¨çš„å†…å­˜é”™è¯¯æ£€æµ‹å·¥å…·ï¼Œé›†æˆäº GCC 4.8+ã€Clang 3.1 + åŠ MSVC 2019 + ä¸­ã€‚å®ƒèƒ½ç²¾å‡†æ£€æµ‹å¤šç§å†…å­˜å®‰å…¨é—®é¢˜ï¼ˆå¦‚ç¼“å†²åŒºæº¢å‡ºã€ä½¿ç”¨å·²é‡Šæ”¾å†…å­˜ç­‰ï¼‰ï¼Œæ˜¯ C/C++ å¼€å‘ä¸­æ’æŸ¥å†…å­˜é”™è¯¯çš„æ ¸å¿ƒå·¥å…·\nä¸€ã€ASan çš„æ ¸å¿ƒåŠŸèƒ½\nASan ä¸»è¦æ£€æµ‹ä»¥ä¸‹å†…å­˜é”™è¯¯ç±»å‹ï¼š\n\n\næ ˆ / å † / å…¨å±€ç¼“å†²åŒºæº¢å‡ºï¼ˆè¶Šç•Œè¯»å†™ï¼‰ï¼›\n\n\nä½¿ç”¨å·²é‡Šæ”¾å†…å­˜ï¼ˆuse-after-freeï¼‰ï¼›\n\n\nåŒé‡é‡Šæ”¾ï¼ˆdouble-freeï¼‰æˆ–é‡Šæ”¾æ— æ•ˆæŒ‡é’ˆï¼›\n\n\nå†…å­˜æ³„æ¼ï¼ˆéœ€é…åˆ LeakSanitizerï¼ŒLSanï¼‰ï¼›\n\n\néƒ¨åˆ†æœªåˆå§‹åŒ–å†…å­˜çš„ä½¿ç”¨ï¼ˆæ›´å…¨é¢çš„æ£€æµ‹éœ€ MemorySanitizerï¼ŒMSanï¼‰ï¼›\n\n\næ ˆ - use-after-return/scopeï¼ˆç¦»å¼€ä½œç”¨åŸŸåä½¿ç”¨æ ˆå†…å­˜ï¼‰ã€‚\n\n\näºŒã€ä¸åŒåœºæ™¯ä¸‹çš„ä½¿ç”¨æ–¹æ³•\n1. åŸºç¡€ç¼–è¯‘åœºæ™¯ï¼ˆç›´æ¥ç¼–è¯‘å•ä¸ªæ–‡ä»¶ï¼‰\nASan çš„ä½¿ç”¨ä¾èµ–ç¼–è¯‘å™¨æ’æ¡©ï¼Œéœ€åœ¨ç¼–è¯‘å’Œé“¾æ¥é˜¶æ®µåŒæ—¶æ·»åŠ é€‰é¡¹ã€‚\n\n\næ ¸å¿ƒç¼–è¯‘é€‰é¡¹ï¼š-fsanitize=addressï¼šå¯ç”¨ ASan æ£€æµ‹ï¼›-gï¼šç”Ÿæˆè°ƒè¯•ä¿¡æ¯ï¼ˆç”¨äºå®šä½é”™è¯¯ä½ç½®ï¼‰ï¼›\n-O1/-O2ï¼šä¼˜åŒ–çº§åˆ«ï¼ˆ-O0å¯ä½¿ç”¨ä½†æ€§èƒ½å·®ï¼Œ-O3å¯èƒ½å› ä¼˜åŒ–æ©ç›–éƒ¨åˆ†é”™è¯¯ï¼Œæ¨è-O1ï¼‰ã€‚\n\n\nç¤ºä¾‹ï¼ˆClang/GCCï¼‰ï¼šå‡è®¾æœ‰æ–‡ä»¶test.cï¼ˆå«å †ç¼“å†²åŒºæº¢å‡ºï¼‰ï¼š\n#include &lt;stdlib.h&gt;int main() &#123;  int *arr = (int*)malloc(4 * sizeof(int)); // åˆ†é…4ä¸ªintï¼ˆ16å­—èŠ‚ï¼‰  arr[4] = 0; // è¶Šç•Œå†™å…¥ï¼ˆç´¢å¼•4è¶…å‡ºèŒƒå›´ï¼‰  free(arr);  return 0;&#125;\nç¼–è¯‘å¹¶è¿è¡Œï¼š\nclang -fsanitize=address -g -O1 test.c -o test  # ç¼–è¯‘./test                                          # è¿è¡Œ\nè¾“å‡ºå°†ç›´æ¥æç¤º â€œå †ç¼“å†²åŒºæº¢å‡ºâ€ï¼Œå¹¶æ˜¾ç¤ºé”™è¯¯ä½ç½®ï¼ˆtest.c:4ï¼‰ã€è°ƒç”¨æ ˆåŠå†…å­˜åˆ†é…ä¿¡æ¯ã€‚\n\n\n2. ä¸æ„å»ºå·¥å…·é›†æˆï¼ˆCMake/Makefileï¼‰\nåœ¨å¤§å‹é¡¹ç›®ä¸­ï¼Œéœ€é€šè¿‡æ„å»ºå·¥å…·ç»Ÿä¸€é…ç½® ASan é€‰é¡¹ã€‚\n\n\nCMake é›†æˆï¼šåœ¨CMakeLists.txtä¸­æ·»åŠ ï¼š\n# å¯¹C/C++å‡å¯ç”¨ASanset(CMAKE_C_FLAGS &quot;$&#123;CMAKE_C_FLAGS&#125; -fsanitize=address -g -O1&quot;)set(CMAKE_CXX_FLAGS &quot;$&#123;CMAKE_CXX_FLAGS&#125; -fsanitize=address -g -O1&quot;)# é“¾æ¥é˜¶æ®µåŒæ ·éœ€è¦ASané€‰é¡¹set(CMAKE_EXE_LINKER_FLAGS &quot;$&#123;CMAKE_EXE_LINKER_FLAGS&#125; -fsanitize=address&quot;)set(CMAKE_SHARED_LINKER_FLAGS &quot;$&#123;CMAKE_SHARED_LINKER_FLAGS&#125; -fsanitize=address&quot;)\n\n\nMakefile é›†æˆï¼šåœ¨Makefileä¸­æ·»åŠ ï¼š\nCFLAGS += -fsanitize=address -g -O1   # Cç¼–è¯‘é€‰é¡¹CXXFLAGS += -fsanitize=address -g -O1 # C++ç¼–è¯‘é€‰é¡¹LDFLAGS += -fsanitize=address         # é“¾æ¥é€‰é¡¹\n\n\n3. å¤šçº¿ç¨‹ç¨‹åºæ£€æµ‹\nASan å¯¹å¤šçº¿ç¨‹ç¨‹åºåŒæ ·æœ‰æ•ˆï¼Œå¯æ£€æµ‹çº¿ç¨‹ä¸­çš„å†…å­˜è¶Šç•Œã€use-after-free ç­‰é—®é¢˜ï¼ˆä½†çº¿ç¨‹ç«äº‰éœ€ ThreadSanitizerï¼ŒTSanï¼‰ã€‚\n\n\nç¤ºä¾‹ï¼šå¤šçº¿ç¨‹å †è¶Šç•Œ\n#include &lt;pthread.h&gt;#include &lt;stdlib.h&gt;int *arr;void *thread_func(void *arg) &#123;  arr[10] = 0; // è¶Šç•Œå†™å…¥ï¼ˆå‡è®¾ä»…åˆ†é…8ä¸ªintï¼‰  return NULL;&#125;int main() &#123;  arr = (int*)malloc(8 * sizeof(int));  pthread_t t;  pthread_create(&amp;t, NULL, thread_func, NULL);  pthread_join(t, NULL);  free(arr);  return 0;&#125;\ngcc -fsanitize=address -g -O1 -pthread test.c -o test\nè¿è¡Œå ASan ä¼šå®šä½åˆ°çº¿ç¨‹å‡½æ•°ä¸­çš„è¶Šç•Œä½ç½®ã€‚\n\n\n4. ä¸è°ƒè¯•å·¥å…·ï¼ˆGDBï¼‰ç»“åˆ\nå½“ ASan æ£€æµ‹åˆ°é”™è¯¯æ—¶ï¼Œç¨‹åºä¼šå´©æºƒï¼Œæ­¤æ—¶å¯é€šè¿‡ GDB è¿›ä¸€æ­¥è°ƒè¯•ã€‚\n\n\næ­¥éª¤ï¼š\n\nç”¨ ASan ç¼–è¯‘ç¨‹åºï¼ˆä¿ç•™-gé€‰é¡¹ï¼‰ï¼›\nç”¨ GDB å¯åŠ¨ç¨‹åºï¼šgdb ./testï¼›\nåœ¨ GDB ä¸­è¿è¡Œï¼š(gdb) runï¼›\nè§¦å‘é”™è¯¯åï¼Œä½¿ç”¨btï¼ˆæŸ¥çœ‹è°ƒç”¨æ ˆï¼‰ã€frame Nï¼ˆåˆ‡æ¢åˆ°ç¬¬ N å¸§ï¼‰å®šä½ä»£ç ç»†èŠ‚ã€‚\n\n\n\n5. å¹³å°å·®å¼‚ï¼ˆLinux/macOS/Windowsï¼‰\n\n\nLinuxï¼šæ”¯æŒæœ€å®Œå–„ï¼ŒGCC/Clang å‡æ— æ˜¾è‘—é™åˆ¶ï¼›\n\n\nmacOSï¼šéœ€ä½¿ç”¨ Clangï¼ˆç³»ç»Ÿé»˜è®¤ç¼–è¯‘å™¨ï¼‰ï¼ŒGCC æ”¯æŒæœ‰é™ï¼›\n\n\nWindowsï¼š\n\nClangï¼šä¸ Linux ç”¨æ³•ä¸€è‡´ï¼ˆéœ€å®‰è£… LLVMï¼‰ï¼›\nMSVC 2019+ï¼šé€šè¿‡/fsanitize=addresså¯ç”¨ï¼ˆé€‰é¡¹æ ¼å¼ä¸ GCC/Clang ä¸åŒï¼Œä¸”éƒ¨åˆ†åŠŸèƒ½æœ‰å·®å¼‚ï¼‰ã€‚\n\n\n\n6. å†…å­˜æ³„æ¼æ£€æµ‹ï¼ˆé…åˆ LSanï¼‰\nASan é»˜è®¤ä¸æ£€æµ‹å†…å­˜æ³„æ¼ï¼Œéœ€æ‰‹åŠ¨å¯ç”¨ LeakSanitizerï¼ˆLSanï¼‰ã€‚\n\n\nå¯ç”¨æ–¹æ³•ï¼š\n\nClangï¼šç›´æ¥æ·»åŠ -fsanitize=address,leakï¼›\nGCCï¼šé€šè¿‡ç¯å¢ƒå˜é‡å¯ç”¨ï¼šexport ASAN_OPTIONS=detect_leaks=1ã€‚\n\n\n\nç¤ºä¾‹ï¼šæ£€æµ‹å†…å­˜æ³„æ¼\n#include &lt;stdlib.h&gt;int main() &#123;  int *p = (int*)malloc(4); // æœªé‡Šæ”¾  return 0;&#125;\nclang -fsanitize=address,leak -g test.c -o test./test\nè¾“å‡ºä¼šæç¤º â€œ2 ä¸ªå­—èŠ‚çš„å†…å­˜æ³„æ¼â€ï¼Œå¹¶æ˜¾ç¤ºåˆ†é…ä½ç½®ã€‚\n\n\nä¸‰ã€æ³¨æ„äº‹é¡¹\n1. æ€§èƒ½å¼€é”€ä¸å¯å¿½è§†\n\n\nè¿è¡Œé€Ÿåº¦ï¼šç¨‹åºä¼šæ…¢ 2-5 å€ï¼ˆå› æ’å…¥å¤§é‡æ£€æµ‹ä»£ç ï¼‰ï¼›\n\n\nå†…å­˜å ç”¨ï¼šå¢åŠ  2-3 å€ï¼ˆéœ€ç»´æŠ¤ â€œå½±å­å†…å­˜â€ï¼‰ï¼›\n\n\né€‚ç”¨åœºæ™¯ï¼šä»…ç”¨äºå¼€å‘ / æµ‹è¯•ç¯å¢ƒï¼Œç¦æ­¢åœ¨ç”Ÿäº§ç¯å¢ƒå¯ç”¨ã€‚\n\n\n2. ç¼–è¯‘é€‰é¡¹å¿…é¡»å®Œæ•´\n\n\nç¼–è¯‘ï¼ˆ-cï¼‰å’Œé“¾æ¥ï¼ˆ-oï¼‰é˜¶æ®µå‡éœ€æ·»åŠ -fsanitize=addressï¼Œå¦åˆ™ä¼šå‡ºç°é“¾æ¥é”™è¯¯ï¼ˆå¦‚ â€œundefined reference to `__asan_initâ€™â€ï¼‰ã€‚\n\n\n3. ä¼˜åŒ–çº§åˆ«å½±å“æ£€æµ‹æ•ˆæœ\n\n\né¿å…ä½¿ç”¨-O3ï¼šé«˜ä¼˜åŒ–å¯èƒ½å¯¼è‡´ç¼–è¯‘å™¨é‡æ’ä»£ç ï¼Œæ©ç›–å†…å­˜é”™è¯¯ï¼ˆå¦‚åˆå¹¶ç›¸é‚»å†…å­˜è®¿é—®ï¼‰ï¼›\n\n\næ¨è-O1æˆ–-O2ï¼šå¹³è¡¡æ€§èƒ½ä¸æ£€æµ‹ç²¾åº¦ã€‚\n\n\n4. ç¬¦å·è¡¨æ˜¯å®šä½é”™è¯¯çš„å…³é”®\n\n\nå¿…é¡»æ·»åŠ -gé€‰é¡¹ï¼šå¦åˆ™ ASan æŠ¥å‘Šä»…æ˜¾ç¤ºå†…å­˜åœ°å€ï¼Œæ— æ³•å…³è”åˆ°æ–‡ä»¶åå’Œè¡Œå·ï¼›\n\n\nè‹¥ä¾èµ–ç¬¬ä¸‰æ–¹åº“ï¼Œéœ€ç¡®ä¿å…¶ç¼–è¯‘æ—¶ä¹Ÿå¸¦-gï¼ˆå¦åˆ™è°ƒç”¨æ ˆä¸­åº“å‡½æ•°ä½ç½®å¯èƒ½æ˜¾ç¤ºä¸º â€œunknownâ€ï¼‰ã€‚\n\n\n5. ä¸å…¶ä»–å·¥å…·çš„å†²çªä¸å…¼å®¹\n\n\nå†²çªï¼šä¸èƒ½ä¸ TSanï¼ˆ-fsanitize=threadï¼‰åŒæ—¶ä½¿ç”¨ï¼ˆä¸¤è€…æ’æ¡©é€»è¾‘å†²çªï¼‰ï¼›\n\n\nå…¼å®¹ï¼šå¯ä¸ UBSanï¼ˆ-fsanitize=undefinedï¼‰åŒæ—¶ä½¿ç”¨ï¼ˆæ£€æµ‹æœªå®šä¹‰è¡Œä¸ºï¼Œå¦‚æ•´æ•°æº¢å‡ºï¼‰ï¼Œä¾‹å¦‚ï¼š\nclang -fsanitize=address,undefined -g test.c -o test\n\n\n6. ç¯å¢ƒå˜é‡é…ç½®ï¼ˆASAN_OPTIONSï¼‰\nASan é€šè¿‡ç¯å¢ƒå˜é‡ASAN_OPTIONSè°ƒæ•´è¡Œä¸ºï¼Œå¸¸ç”¨å‚æ•°ï¼š\n\n\ndetect_leaks=1ï¼šå¯ç”¨å†…å­˜æ³„æ¼æ£€æµ‹ï¼ˆé»˜è®¤ 0ï¼‰ï¼›\n\n\nmalloc_context_size=30ï¼šè®¾ç½®å†…å­˜åˆ†é… / é‡Šæ”¾çš„è°ƒç”¨æ ˆæ·±åº¦ï¼ˆé»˜è®¤ 10ï¼ŒåŠ æ·±å¯æ›´æ¸…æ™°å®šä½æ¥æºï¼‰ï¼›\n\n\nfast_unwind_on_malloc=0ï¼šä½¿ç”¨ç²¾ç¡® unwindï¼ˆè€Œéå¿«é€Ÿï¼‰ï¼Œè°ƒç”¨æ ˆæ›´å‡†ç¡®ä½†é€Ÿåº¦æ…¢ï¼ˆé»˜è®¤ 1ï¼‰ï¼›\n\n\nquarantine_size_mb=1024ï¼šè®¾ç½® â€œéš”ç¦»åŒºâ€ å¤§å°ï¼ˆå·²é‡Šæ”¾å†…å­˜æš‚å­˜åŒºåŸŸï¼Œè°ƒå¤§å¯æ£€æµ‹æ›´å¤š use-after-freeï¼‰ã€‚\n\n\nç¤ºä¾‹ï¼š\nexport ASAN_OPTIONS=&quot;detect_leaks=1:malloc_context_size=20:fast_unwind_on_malloc=0&quot;\n7. éƒ¨åˆ†é”™è¯¯å¯èƒ½æ¼æ£€\n\n\nå¾®å°è¶Šç•Œï¼ˆå¦‚ 1 å­—èŠ‚ï¼‰ï¼šè‹¥æœªè§¦åŠå½±å­å†…å­˜çš„ â€œçº¢è‰²åŒºåŸŸâ€ï¼ˆæ ‡è®°ä¸ºæ— æ•ˆçš„å†…å­˜ï¼‰ï¼Œå¯èƒ½ä¸è¢«æ£€æµ‹ï¼›\n\n\nå¤æ‚æœªåˆå§‹åŒ–å†…å­˜ä½¿ç”¨ï¼šéœ€ MSanï¼ˆ-fsanitize=memoryï¼‰è¡¥å……æ£€æµ‹ï¼ˆä½†éœ€é‡æ–°ç¼–è¯‘æ‰€æœ‰ä¾èµ–åº“ï¼‰ã€‚\n\n\nå››ã€æ‰©å±•çŸ¥è¯†\n1. ASan å·¥ä½œåŸç†ï¼ˆå½±å­å†…å­˜æœºåˆ¶ï¼‰\nASan é€šè¿‡ â€œå½±å­å†…å­˜ï¼ˆshadow memoryï¼‰â€ è·Ÿè¸ªç”¨æˆ·å†…å­˜çŠ¶æ€ï¼š\n\n\næ¯ 8 å­—èŠ‚ç”¨æˆ·å†…å­˜å¯¹åº” 1 å­—èŠ‚å½±å­å†…å­˜ï¼ˆå½±å­å†…å­˜æ€»å¤§å°ä¸ºç”¨æˆ·å†…å­˜çš„ 1/8ï¼‰ï¼›\n\n\nå½±å­å†…å­˜æ ‡è®°å†…å­˜çŠ¶æ€ï¼š0ï¼ˆå¯è®¿é—®ï¼‰ã€1-7ï¼ˆéƒ¨åˆ†å¯è®¿é—®ï¼‰ã€0xF1ï¼ˆå·²é‡Šæ”¾ï¼‰ã€0xF2ï¼ˆè¶Šç•ŒåŒºåŸŸï¼‰ç­‰ï¼›\n\n\nç¼–è¯‘å™¨åœ¨å†…å­˜è®¿é—®ï¼ˆè¯» / å†™ï¼‰å¤„æ’å…¥æ£€æµ‹ä»£ç ï¼Œæ£€æŸ¥å¯¹åº”å½±å­å†…å­˜çŠ¶æ€ï¼Œè‹¥éæ³•åˆ™è§¦å‘é”™è¯¯å¹¶è¾“å‡ºæŠ¥å‘Šã€‚\n\n\n2. ä¸å…¶ä»– Sanitizer çš„åŒºåˆ«\n\n\n\nå·¥å…·\næ£€æµ‹ç›®æ ‡\nä¸ ASan å…¼å®¹æ€§\nç‰¹ç‚¹\n\n\n\n\nLSan\nå†…å­˜æ³„æ¼\nå…¼å®¹ï¼ˆå¯è”åˆä½¿ç”¨ï¼‰\nè½»é‡ï¼Œä¾èµ– ASan åŸºç¡€\n\n\nMSan\nä½¿ç”¨æœªåˆå§‹åŒ–å†…å­˜\nä¸å…¼å®¹\néœ€å…¨é“¾è·¯é‡ç¼–è¯‘ï¼Œç²¾åº¦é«˜\n\n\nTSan\nçº¿ç¨‹ç«äº‰\nä¸å…¼å®¹\nä¸“ç”¨äºå¤šçº¿ç¨‹åŒæ­¥é”™è¯¯\n\n\nUBSan\næœªå®šä¹‰è¡Œä¸ºï¼ˆå¦‚æ•´æ•°æº¢å‡ºï¼‰\nå…¼å®¹\nå¯ä¸ ASan è”åˆä½¿ç”¨ï¼Œè¦†ç›–æ›´å¹¿\n\n\n\n3. æœ€ä½³å®è·µ\n\n\nå¼€å‘é˜¶æ®µï¼šå¯¹æ ¸å¿ƒæ¨¡å—å¯ç”¨ ASanï¼Œå®šæœŸè¿è¡Œå•å…ƒæµ‹è¯•ï¼›\n\n\nCI/CD æµç¨‹ï¼šå°† ASan æ£€æµ‹ä½œä¸ºä»£ç æäº¤çš„ â€œé—¨ç¦â€ï¼Œæå‰æ‹¦æˆªå†…å­˜é”™è¯¯ï¼›\n\n\nç»“åˆè°ƒè¯•ï¼šç”¨ GDB è§£æ ASan å´©æºƒç°åœºï¼Œå®šä½é”™è¯¯æ ¹æºï¼›\n\n\nå¤šå·¥å…·ååŒï¼šå…ˆç”¨ ASan æ£€æµ‹åŸºç¡€å†…å­˜é”™è¯¯ï¼Œå†ç”¨ TSan æ£€æµ‹çº¿ç¨‹é—®é¢˜ï¼Œæœ€åç”¨ LSan æŸ¥æ¼å†…å­˜æ³„æ¼ã€‚\n\n\n4. å±€é™æ€§\n\n\næ— æ³•æ£€æµ‹é€»è¾‘é”™è¯¯ï¼ˆå¦‚å†…å­˜è®¿é—®æ­£ç¡®ä½†å€¼é”™è¯¯ï¼‰ï¼›\n\n\nå¯¹è‡ªå®šä¹‰å†…å­˜åˆ†é…å™¨ï¼ˆå¦‚jemallocï¼‰æ”¯æŒæœ‰é™ï¼Œå¯èƒ½éœ€è¦é¢å¤–é…ç½®ï¼›\n\n\næ€§èƒ½å¼€é”€å¤§ï¼Œæ— æ³•ç”¨äºç”Ÿäº§ç¯å¢ƒçš„æ€§èƒ½æµ‹è¯•ã€‚\n\n\n","categories":["ç¼–ç¨‹"],"tags":["C++","å·¥å…·"]},{"title":"C++ chrono","url":"/2025/04/05/C++/C++%20chrono/","content":"\nC++ chronoåº“çš„ä½¿ç”¨æ–¹æ³•\n\n\nC++ chrono\nä¸€ã€chronoçš„æ ¸å¿ƒè®¾è®¡ç†å¿µ\nchronoçš„æ ¸å¿ƒæ˜¯å°†æ—¶é—´æŠ½è±¡ä¸ºä¸‰ä¸ªç›¸äº’å…³è”çš„æ¦‚å¿µï¼šæ—¶é•¿ï¼ˆduratnï¼‰ã€æ—¶é—´ç‚¹ï¼ˆtime_pointï¼‰ å’Œæ—¶é’Ÿï¼ˆclockï¼‰ã€‚ä¸‰è€…é€šè¿‡æ¨¡æ¿å‚æ•°ç´§å¯†è€¦åˆï¼Œå½¢æˆä¸€å¥—è‡ªæ´½çš„ç±»å‹ç³»ç»Ÿï¼š\n\n\næ—¶é•¿ï¼ˆdurationï¼‰ï¼šè¡¨ç¤º&quot;ä¸€æ®µæ—¶é—´é—´éš”&quot;ï¼ˆå¦‚10ç§’ã€500æ¯«ç§’ï¼‰ï¼Œç»‘å®šæ•°å€¼ä¸å•ä½ã€‚\n\n\næ—¶é—´ç‚¹ï¼ˆtime_pointï¼‰ï¼šè¡¨ç¤º&quot;æŸä¸ªå…·ä½“æ—¶åˆ»&quot;ï¼ˆå¦‚2023-10-01 08:00:00ï¼‰ï¼ŒåŸºäºæŸä¸ªæ—¶é’Ÿçš„&quot;çºªå…ƒ&quot;ï¼ˆepochï¼‰åç§»é‡å®šä¹‰ã€‚\n\n\næ—¶é’Ÿï¼ˆclockï¼‰ï¼šæä¾›è·å–å½“å‰æ—¶é—´ç‚¹çš„æ¥å£ï¼Œå®šä¹‰äº†æ—¶é—´çš„å‚è€ƒç³»ï¼ˆå¦‚ç³»ç»Ÿæ—¶é—´ã€ç¨³å®šæ—¶é—´ï¼‰ã€‚\n\n\näºŒã€æ ¸å¿ƒç»„ä»¶è¯¦è§£\n1. æ—¶é•¿ï¼ˆstd::chrono::durationï¼‰\ndurationæ˜¯å¯¹&quot;æ—¶é—´é—´éš”&quot;çš„æŠ½è±¡ï¼Œå®šä¹‰ä¸ºï¼š\ntemplate &lt;typename Rep, typename Period = std::ratio&lt;1&gt;&gt;class duration;\n\n\nRepï¼šå­˜å‚¨æ—¶é•¿çš„æ•°å€¼ç±»å‹ï¼ˆå¦‚intã€long longã€doubleï¼‰ï¼Œå†³å®šäº†æ•°å€¼çš„ç²¾åº¦å’ŒèŒƒå›´ã€‚\n\n\nPeriodï¼šè¡¨ç¤ºæ—¶é•¿çš„å•ä½ï¼ˆå‘¨æœŸï¼‰ï¼Œç±»å‹ä¸ºstd::ratio&lt;N, D&gt;ï¼ˆå³N/Dç§’ï¼‰ï¼Œä¾‹å¦‚ï¼š\n\nstd::ratio&lt;1&gt;ï¼š1ç§’ï¼ˆé»˜è®¤å€¼ï¼‰ã€‚\nstd::ratio&lt;1, 1000&gt;ï¼š1æ¯«ç§’ï¼ˆ1/1000ç§’ï¼‰ã€‚\nstd::ratio&lt;60&gt;ï¼š1åˆ†é’Ÿï¼ˆ60ç§’ï¼‰ã€‚\n\n\n\næ ‡å‡†é¢„å®šä¹‰æ—¶é•¿ç±»å‹ï¼š\nä¸ºç®€åŒ–å¸¸ç”¨åœºæ™¯ï¼Œæ ‡å‡†åº“å®šä¹‰äº†ä¸€ç³»åˆ—åˆ«åï¼ˆåŸºäºlong longä½œä¸ºRepï¼‰ï¼š\nusing nanoseconds  = duration&lt;long long, std::nano&gt;;    // 1e-9ç§’using microseconds = duration&lt;long long, std::micro&gt;;   // 1e-6ç§’using milliseconds = duration&lt;long long, std::milli&gt;;   // 1e-3ç§’using seconds      = duration&lt;long long&gt;;               // 1ç§’using minutes      = duration&lt;long long, std::ratio&lt;60&gt;&gt;; // 60ç§’using hours        = duration&lt;long long, std::ratio&lt;3600&gt;&gt;; // 3600ç§’\næ—¶é•¿çš„æ“ä½œï¼š\n\n\nç®—æœ¯è¿ç®—ï¼šæ”¯æŒ+ã€-ã€*ã€/ï¼ˆå¦‚seconds(3) + milliseconds(500) = milliseconds(3500)ï¼‰ã€‚\n\n\næ¯”è¾ƒè¿ç®—ï¼šæ”¯æŒ==ã€!=ã€&lt;ã€&gt;ç­‰ï¼ˆéœ€å•ä½å…¼å®¹ï¼Œæˆ–é€šè¿‡è½¬æ¢åæ¯”è¾ƒï¼‰ã€‚\n\n\nç±»å‹è½¬æ¢ï¼šé€šè¿‡std::chrono::duration_castæ˜¾å¼è½¬æ¢ï¼ˆå› å•ä½ä¸åŒå¯èƒ½ä¸¢å¤±ç²¾åº¦ï¼‰ï¼š\n#include &lt;chrono&gt;using namespace std::chrono;milliseconds ms(1500);       // 1500æ¯«ç§’seconds s = duration_cast&lt;seconds&gt;(ms);  // è½¬æ¢ä¸º1ç§’ï¼ˆæˆªæ–­å°æ•°éƒ¨åˆ†ï¼‰\n\n\n2. æ—¶é—´ç‚¹ï¼ˆstd::chrono::time_pointï¼‰\ntime_pointæ˜¯å¯¹&quot;å…·ä½“æ—¶åˆ»&quot;çš„æŠ½è±¡ï¼Œå®šä¹‰ä¸ºï¼š\ntemplate &lt;typename Clock, typename Duration = typename Clock::duration&gt;class time_point;\n\n\nClockï¼šå…³è”çš„æ—¶é’Ÿç±»å‹ï¼ˆå†³å®šæ—¶é—´çš„å‚è€ƒç³»ï¼Œå¦‚ç³»ç»Ÿæ—¶é’Ÿã€ç¨³å®šæ—¶é’Ÿï¼‰ã€‚\n\n\nDurationï¼šè¡¨ç¤ºè¯¥æ—¶é—´ç‚¹ç›¸å¯¹äºæ—¶é’Ÿ&quot;çºªå…ƒ&quot;ï¼ˆepochï¼Œå³æ—¶é’Ÿçš„èµ·å§‹ç‚¹ï¼Œå¦‚Unixæ—¶é—´æˆ³çš„1970-01-01 00:00:00ï¼‰çš„åç§»é‡ã€‚\n\n\næ—¶é—´ç‚¹çš„æ“ä½œï¼š\n\n\nè·å–çºªå…ƒåç§»ï¼šé€šè¿‡time_since_epoch()è·å–è‡ªçºªå…ƒèµ·çš„durationï¼š\nauto now = system_clock::now();          // å½“å‰ç³»ç»Ÿæ—¶é—´ç‚¹auto epoch_offset = now.time_since_epoch();  // è‡ªç³»ç»Ÿæ—¶é’Ÿçºªå…ƒèµ·çš„æ—¶é•¿\n\n\nç®—æœ¯è¿ç®—ï¼šä¸durationç»“åˆï¼Œç”Ÿæˆæ–°çš„æ—¶é—´ç‚¹ï¼š\nauto future = now + seconds(10);  // 10ç§’åçš„æ—¶é—´ç‚¹auto past = now - minutes(5);     // 5åˆ†é’Ÿå‰çš„æ—¶é—´ç‚¹\n\n\næ¯”è¾ƒè¿ç®—ï¼šæ”¯æŒ==ã€!=ã€&lt;ç­‰ï¼ˆéœ€åŒå±ä¸€ä¸ªæ—¶é’Ÿï¼‰ã€‚\n\n\n3. æ—¶é’Ÿï¼ˆstd::chrono::clockï¼‰\næ—¶é’Ÿæ˜¯time_pointçš„&quot;å‚è€ƒç³»&quot;ï¼Œæä¾›è·å–å½“å‰æ—¶é—´ç‚¹çš„æ¥å£ï¼Œå®šä¹‰äº†ä¸‰ä¸ªæ ¸å¿ƒæˆå‘˜ï¼š\n\n\nnow()ï¼šé™æ€æ–¹æ³•ï¼Œè¿”å›å½“å‰æ—¶é—´ç‚¹ï¼ˆtime_point&lt;Clock&gt;ï¼‰ã€‚\n\n\ndurationï¼šæ—¶é’Ÿçš„é»˜è®¤æ—¶é•¿ç±»å‹ï¼ˆå¦‚system_clocké€šå¸¸ä½¿ç”¨nanosecondsï¼‰ã€‚\n\n\nis_steadyï¼šé™æ€å¸¸é‡ï¼ˆboolï¼‰ï¼Œæ ‡è¯†æ—¶é’Ÿæ˜¯å¦&quot;ç¨³å®š&quot;ï¼ˆå³æ—¶é—´æ˜¯å¦å•è°ƒé€’å¢ï¼Œä¸ä¼šå› ç³»ç»Ÿè°ƒæ•´è€Œå›æº¯ï¼‰ã€‚\n\n\næ ‡å‡†åº“ä¸‰ç§æ—¶é’Ÿï¼š\n\n\nsystem_clock\n\nå…³è”ç³»ç»Ÿæ—¶é—´ï¼ˆå¯è¢«ç”¨æˆ·æˆ–ç³»ç»Ÿè°ƒæ•´ï¼Œå¦‚æ‰‹åŠ¨ä¿®æ”¹æ—¶åŒºã€NTPåŒæ­¥ï¼‰ã€‚\næ”¯æŒä¸Cé£æ ¼æ—¶é—´ï¼ˆstd::time_tï¼‰è½¬æ¢ï¼Œé€‚åˆè·å–&quot;æ—¥å†æ—¶é—´&quot;ï¼ˆå¦‚å¹´æœˆæ—¥æ—¶åˆ†ç§’ï¼‰ã€‚\nis_steadyä¸ºfalseï¼ˆå¯èƒ½å› è°ƒæ•´è€Œå›æº¯ï¼‰ã€‚\n\nç¤ºä¾‹ï¼šè·å–å½“å‰æ—¥å†æ—¶é—´ï¼š\n#include &lt;chrono&gt;#include &lt;ctime&gt;using namespace std::chrono;auto sys_now = system_clock::now();std::time_t t = system_clock::to_time_t(sys_now);  // è½¬æ¢ä¸ºtime_tstd::cout &lt;&lt; std::ctime(&amp;t);  // è¾“å‡ºäººç±»å¯è¯»æ—¶é—´ï¼ˆå¦‚&quot;Wed Jun 1 12:34:56 2023&quot;ï¼‰\n\n\nsteady_clock\n\nç¨³å®šæ—¶é’Ÿï¼ˆæ—¶é—´å•è°ƒé€’å¢ï¼Œä¸å¯è°ƒæ•´ï¼‰ï¼Œé€‚åˆæµ‹é‡æ—¶é—´é—´éš”ï¼ˆå¦‚æ€§èƒ½è®¡æ—¶ã€å®šæ—¶å™¨ï¼‰ã€‚\nä¸å…³è”æ—¥å†æ—¶é—´ï¼Œæ— æ³•è½¬æ¢ä¸ºtime_tã€‚\nis_steadyä¸ºtrueï¼ˆæ ¸å¿ƒä¼˜åŠ¿ï¼‰ã€‚\n\nç¤ºä¾‹ï¼šæµ‹é‡ä»£ç æ‰§è¡Œæ—¶é—´ï¼š\nauto start = steady_clock::now();// æ‰§è¡Œè€—æ—¶æ“ä½œ...auto end = steady_clock::now();auto elapsed = duration_cast&lt;milliseconds&gt;(end - start);std::cout &lt;&lt; &quot;è€—æ—¶: &quot; &lt;&lt; elapsed.count() &lt;&lt; &quot;ms\\n&quot;;\n\n\nhigh_resolution_clock\n\né«˜ç²¾åº¦æ—¶é’Ÿï¼Œé€šå¸¸æ˜¯steady_clockæˆ–system_clockçš„åˆ«åï¼ˆå–å†³äºç¼–è¯‘å™¨å®ç°ï¼‰ã€‚\nè®¾è®¡ç›®æ ‡æ˜¯æä¾›ç³»ç»Ÿæ”¯æŒçš„æœ€é«˜ç²¾åº¦ï¼Œä½†éœ€æ³¨æ„å…¶is_steadyå¯èƒ½ä¸ºfalseï¼ˆè‹¥ç»‘å®šsystem_clockï¼‰ã€‚\n\n\n\nä¸‰ã€chronoçš„æ ¸å¿ƒä¼˜åŠ¿\n\n\nç±»å‹å®‰å…¨ï¼šæ—¶é•¿çš„å•ä½ï¼ˆå¦‚ç§’/æ¯«ç§’ï¼‰é€šè¿‡ç±»å‹è€Œéæ³¨é‡Šä½“ç°ï¼Œç¼–è¯‘å™¨å¯æ£€æµ‹å•ä½è¯¯ç”¨ï¼ˆå¦‚å°†æ¯«ç§’å½“ä½œç§’ä¼ å…¥å‡½æ•°ï¼‰ã€‚\n\n\nç²¾åº¦å¯æ§ï¼šé€šè¿‡Repå’ŒPeriodçµæ´»å®šä¹‰æ—¶é•¿ç²¾åº¦ï¼ˆå¦‚duration&lt;double, std::ratio&lt;1, 10&gt;&gt;è¡¨ç¤º0.1ç§’ç²¾åº¦çš„æµ®ç‚¹æ•°æ—¶é•¿ï¼‰ã€‚\n\n\nå¹³å°æ— å…³ï¼šå±è”½äº†ä¸åŒç³»ç»Ÿçš„æ—¶é—´å®ç°å·®å¼‚ï¼ˆå¦‚Windowsä¸Linuxçš„æ—¶é’Ÿç²’åº¦ä¸åŒï¼‰ã€‚\n\n\næ”¯æŒæ³›å‹ç¼–ç¨‹ï¼šå¯åŸºäºdurationå’Œtime_pointç¼–å†™é€šç”¨æ—¶é—´å¤„ç†é€»è¾‘ï¼ˆå¦‚æ¨¡æ¿å‡½æ•°æ”¯æŒä»»æ„æ—¶é’Ÿç±»å‹ï¼‰ã€‚\n\n\nå››ã€å…¸å‹åº”ç”¨åœºæ™¯\n\n\næ€§èƒ½åŸºå‡†æµ‹è¯•ï¼šç”¨steady_clockæµ‹é‡ä»£ç ç‰‡æ®µçš„æ‰§è¡Œæ—¶é—´ã€‚\n\n\nå®šæ—¶å™¨å®ç°ï¼šç»“åˆtime_pointç®¡ç†å®šæ—¶ä»»åŠ¡çš„è§¦å‘æ—¶é—´\n\n\næ—¶é—´æˆ³è®°å½•ï¼šç”¨system_clockè®°å½•äº‹ä»¶å‘ç”Ÿçš„æ—¥å†æ—¶é—´ã€‚\n\n\nå¸§ç‡æ§åˆ¶ï¼šåœ¨æ¸¸æˆæˆ–å®æ—¶ç³»ç»Ÿä¸­ï¼Œç”¨durationæ§åˆ¶å¾ªç¯æ‰§è¡Œé¢‘ç‡ï¼ˆå¦‚60FPSå³æ¯16.67msæ‰§è¡Œä¸€æ¬¡ï¼‰ã€‚\n\n\n","categories":["ç¼–ç¨‹"],"tags":["C++"]},{"title":"C++å¹¶å‘ç¼–ç¨‹æ ¸å¿ƒçŸ¥è¯†ä½“ç³»","url":"/2025/10/11/C++/C++%20%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E6%A0%B8%E5%BF%83%E7%9F%A5%E8%AF%86%E4%BD%93%E7%B3%BB%EF%BC%9A%E4%BB%8E%E6%8A%80%E6%9C%AF%E5%AE%9E%E7%8E%B0%E5%88%B0%E5%93%B2%E5%AD%A6%E6%80%9D%E6%83%B3/","content":"\nå¦‚é¢˜ï¼Œç»“åˆå®˜æ–¹æ–‡æ¡£ä¸ç½‘ç»œå¸–å­ï¼Œåˆ©ç”¨AIæ•´ç†\n\n\nC++ å¹¶å‘ç¼–ç¨‹æ ¸å¿ƒçŸ¥è¯†ä½“ç³»ï¼šä»æŠ€æœ¯å®ç°åˆ°å“²å­¦æ€æƒ³\nç›®å½•\n\n\nå¹¶å‘ç¼–ç¨‹æ¦‚è¿°\n\n\nC++ çº¿ç¨‹åŸºç¡€ï¼šstd::thread\n\n\näº’æ–¥é”æœºåˆ¶ï¼šstd::mutex å®¶æ—\n\n\næ¡ä»¶å˜é‡ï¼šçº¿ç¨‹é—´é€šä¿¡çš„è‰ºæœ¯\n\n\nå¹¶å‘è®¾è®¡æ¨¡å¼\n\n\nå†…å­˜æ¨¡å‹ä¸åŸå­æ“ä½œ\n\n\nå¼‚æ­¥æ“ä½œï¼šéé˜»å¡ç¼–ç¨‹èŒƒå¼\n\n\nå¹¶å‘ç¼–ç¨‹å“²å­¦æ€æƒ³\n\n\næœ€ä½³å®è·µä¸è®¾è®¡åŸåˆ™\n\n\nå¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ\n\n\n1. å¹¶å‘ç¼–ç¨‹æ¦‚è¿°\n1.1 ä»€ä¹ˆæ˜¯å¹¶å‘ç¼–ç¨‹\nå¹¶å‘ç¼–ç¨‹æ˜¯æŒ‡åœ¨åŒä¸€æ—¶é—´é—´éš”å†…æ‰§è¡Œå¤šä¸ªä»»åŠ¡çš„ç¼–ç¨‹èŒƒå¼ã€‚åœ¨ C++ ä¸­ï¼Œè¿™ä¸»è¦é€šè¿‡å¤šçº¿ç¨‹æ¥å®ç°ï¼Œæ¯ä¸ªçº¿ç¨‹ä»£è¡¨ä¸€ä¸ªç‹¬ç«‹çš„æ‰§è¡Œè·¯å¾„ã€‚\n1.2 å¹¶å‘ç¼–ç¨‹çš„æ ¸å¿ƒæŒ‘æˆ˜\n\n\næ•°æ®ç«äº‰ï¼šå¤šä¸ªçº¿ç¨‹åŒæ—¶è®¿é—®å…±äº«æ•°æ®\n\n\næ­»é”ï¼šçº¿ç¨‹é—´ç›¸äº’ç­‰å¾…å¯¹æ–¹é‡Šæ”¾èµ„æº\n\n\næ´»é”ï¼šçº¿ç¨‹ä¸æ–­æ”¹å˜çŠ¶æ€ä½†æ— æ³•ç»§ç»­æ‰§è¡Œ\n\n\nå†…å­˜å¯è§æ€§ï¼šCPU ç¼“å­˜å¯¼è‡´çš„æ“ä½œä¸å¯è§é—®é¢˜\n\n\næŒ‡ä»¤é‡æ’åºï¼šç¼–è¯‘å™¨å’Œ CPU çš„ä¼˜åŒ–å¯¼è‡´æ‰§è¡Œé¡ºåºå˜åŒ–\n\n\n1.3 C++ å¹¶å‘ç¼–ç¨‹çš„å‘å±•å†ç¨‹\n\n\nC++11ï¼šå¼•å…¥äº†æ ‡å‡†çš„å¹¶å‘ç¼–ç¨‹æ”¯æŒ\n\n\nC++14ï¼šå®Œå–„äº†å¹¶å‘åº“åŠŸèƒ½\n\n\nC++17ï¼šæ–°å¢äº†å…±äº«é”ç­‰ç‰¹æ€§\n\n\nC++20ï¼šå¼•å…¥äº†åç¨‹ç­‰é«˜çº§ç‰¹æ€§\n\n\n2. C++ çº¿ç¨‹åŸºç¡€ï¼šstd::thread\n2.1 çº¿ç¨‹çš„åˆ›å»ºä¸ç®¡ç†\nåŸºæœ¬çº¿ç¨‹åˆ›å»º\n#include &lt;iostream&gt;#include &lt;thread&gt;void thread_function() &#123;    std::cout &lt;&lt; &quot;Hello from thread!&quot; &lt;&lt; std::endl;&#125;int main() &#123;    std::thread t(thread_function);  // åˆ›å»ºçº¿ç¨‹    t.join();                        // ç­‰å¾…çº¿ç¨‹å®Œæˆ    return 0;&#125;\nä¼ é€’å‚æ•°\n#include &lt;iostream&gt;#include &lt;thread&gt;#include &lt;string&gt;void print_message(const std::string&amp; message, int count) &#123;    for (int i = 0; i &lt; count; ++i) &#123;        std::cout &lt;&lt; message &lt;&lt; &quot; &quot; &lt;&lt; i &lt;&lt; std::endl;    &#125;&#125;int main() &#123;    std::string msg = &quot;Hello&quot;;    std::thread t(print_message, msg, 5);    t.join();    return 0;&#125;\n2.2 çº¿ç¨‹çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†\njoin() vs detach()\n#include &lt;iostream&gt;#include &lt;thread&gt;#include &lt;chrono&gt;void long_running_task() &#123;    std::this_thread::sleep_for(std::chrono::seconds(3));    std::cout &lt;&lt; &quot;Task completed!&quot; &lt;&lt; std::endl;&#125;int main() &#123;    std::thread t(long_running_task);        // ä½¿ç”¨join()ï¼šä¸»çº¿ç¨‹ç­‰å¾…å­çº¿ç¨‹å®Œæˆ    // t.join();        // ä½¿ç”¨detach()ï¼šå­çº¿ç¨‹åœ¨åå°è¿è¡Œ    t.detach();        std::cout &lt;&lt; &quot;Main thread exiting...&quot; &lt;&lt; std::endl;    return 0;&#125;\n2.3 çº¿ç¨‹å±æ€§æ§åˆ¶\n#include &lt;iostream&gt;#include &lt;thread&gt;#include &lt;chrono&gt;void thread_with_high_priority() &#123;    // åœ¨æ”¯æŒçš„å¹³å°ä¸Šè®¾ç½®çº¿ç¨‹ä¼˜å…ˆçº§    #ifdef _WIN32        // Windowså¹³å°è®¾ç½®ä¼˜å…ˆçº§        SetThreadPriority(GetCurrentThread(), THREAD_PRIORITY_HIGHEST);    #elif defined(__linux__)        // Linuxå¹³å°è®¾ç½®ä¼˜å…ˆçº§        struct sched_param param;        param.sched_priority = 99;        pthread_setschedparam(pthread_self(), SCHED_FIFO, &amp;param);    #endif        std::cout &lt;&lt; &quot;High priority thread running...&quot; &lt;&lt; std::endl;&#125;int main() &#123;    std::thread t(thread_with_high_priority);    t.join();    return 0;&#125;\n3. äº’æ–¥é”æœºåˆ¶ï¼šstd::mutex å®¶æ—\n3.1 äº’æ–¥é”çš„åŸºæœ¬æ¦‚å¿µ\näº’æ–¥é”ï¼ˆMutexï¼‰æ˜¯ä¿è¯çº¿ç¨‹é—´äº’æ–¥è®¿é—®å…±äº«èµ„æºçš„åŒæ­¥åŸè¯­ã€‚\n3.2 å„ç§äº’æ–¥é”ç±»å‹\nstd::mutex - åŸºæœ¬äº’æ–¥é”\n#include &lt;iostream&gt;#include &lt;thread&gt;#include &lt;mutex&gt;#include &lt;vector&gt;std::mutex mtx;int shared_counter = 0;void increment_counter() &#123;    for (int i = 0; i &lt; 100000; ++i) &#123;        mtx.lock();        shared_counter++;        mtx.unlock();    &#125;&#125;int main() &#123;    std::vector&lt;std::thread&gt; threads;        for (int i = 0; i &lt; 10; ++i) &#123;        threads.emplace_back(increment_counter);    &#125;        for (auto&amp; t : threads) &#123;        t.join();    &#125;        std::cout &lt;&lt; &quot;Final counter value: &quot; &lt;&lt; shared_counter &lt;&lt; std::endl;    return 0;&#125;\nstd::lock_guard - RAII é£æ ¼çš„é”ç®¡ç†\n#include &lt;iostream&gt;#include &lt;thread&gt;#include &lt;mutex&gt;#include &lt;vector&gt;std::mutex mtx;int shared_counter = 0;void increment_counter() &#123;    for (int i = 0; i &lt; 100000; ++i) &#123;        std::lock_guard&lt;std::mutex&gt; lock(mtx);        shared_counter++;        // é”ä¼šåœ¨ç¦»å¼€ä½œç”¨åŸŸæ—¶è‡ªåŠ¨é‡Šæ”¾    &#125;&#125;int main() &#123;    std::vector&lt;std::thread&gt; threads;        for (int i = 0; i &lt; 10; ++i) &#123;        threads.emplace_back(increment_counter);    &#125;        for (auto&amp; t : threads) &#123;        t.join();    &#125;        std::cout &lt;&lt; &quot;Final counter value: &quot; &lt;&lt; shared_counter &lt;&lt; std::endl;    return 0;&#125;\nstd::unique_lock - æ›´çµæ´»çš„é”ç®¡ç†\n#include &lt;iostream&gt;#include &lt;thread&gt;#include &lt;mutex&gt;#include &lt;vector&gt;std::mutex mtx;int shared_counter = 0;void increment_counter() &#123;    for (int i = 0; i &lt; 100000; ++i) &#123;        std::unique_lock&lt;std::mutex&gt; lock(mtx);        shared_counter++;                // å¯ä»¥æ‰‹åŠ¨è§£é”å’Œé‡æ–°é”å®š        lock.unlock();        // æ‰§è¡Œä¸€äº›ä¸éœ€è¦é”çš„æ“ä½œ        lock.lock();        shared_counter++;    &#125;&#125;int main() &#123;    std::vector&lt;std::thread&gt; threads;        for (int i = 0; i &lt; 10; ++i) &#123;        threads.emplace_back(increment_counter);    &#125;        for (auto&amp; t : threads) &#123;        t.join();    &#125;        std::cout &lt;&lt; &quot;Final counter value: &quot; &lt;&lt; shared_counter &lt;&lt; std::endl;    return 0;&#125;\nC++17 å…±äº«é”ï¼šstd::shared_mutex\n#include &lt;iostream&gt;#include &lt;thread&gt;#include &lt;shared_mutex&gt;#include &lt;vector&gt;std::shared_mutex rw_mutex;int shared_data = 0;// è¯»æ“ä½œï¼šå¯ä»¥å¤šä¸ªçº¿ç¨‹åŒæ—¶è¿›è¡Œvoid reader_thread(int id) &#123;    std::shared_lock&lt;std::shared_mutex&gt; lock(rw_mutex);    std::cout &lt;&lt; &quot;Reader &quot; &lt;&lt; id &lt;&lt; &quot; read data: &quot; &lt;&lt; shared_data &lt;&lt; std::endl;&#125;// å†™æ“ä½œï¼šç‹¬å è®¿é—®void writer_thread(int id) &#123;    std::unique_lock&lt;std::shared_mutex&gt; lock(rw_mutex);    shared_data++;    std::cout &lt;&lt; &quot;Writer &quot; &lt;&lt; id &lt;&lt; &quot; wrote data: &quot; &lt;&lt; shared_data &lt;&lt; std::endl;&#125;int main() &#123;    std::vector&lt;std::thread&gt; threads;        // åˆ›å»ºå¤šä¸ªè¯»è€…çº¿ç¨‹    for (int i = 0; i &lt; 5; ++i) &#123;        threads.emplace_back(reader_thread, i);    &#125;        // åˆ›å»ºå†™è€…çº¿ç¨‹    for (int i = 0; i &lt; 2; ++i) &#123;        threads.emplace_back(writer_thread, i);    &#125;        for (auto&amp; t : threads) &#123;        t.join();    &#125;        return 0;&#125;\n3.3 é¿å…æ­»é”çš„æŠ€æœ¯\n1. ç»Ÿä¸€é”è·å–é¡ºåº\n#include &lt;iostream&gt;#include &lt;thread&gt;#include &lt;mutex&gt;std::mutex mutex1, mutex2;void thread1() &#123;    std::lock(mutex1, mutex2);  // åŒæ—¶è·å–å¤šä¸ªé”    std::lock_guard&lt;std::mutex&gt; lock1(mutex1, std::adopt_lock);    std::lock_guard&lt;std::mutex&gt; lock2(mutex2, std::adopt_lock);        std::cout &lt;&lt; &quot;Thread 1 acquired both mutexes&quot; &lt;&lt; std::endl;&#125;void thread2() &#123;    std::lock(mutex1, mutex2);  // ä¿æŒç›¸åŒçš„è·å–é¡ºåº    std::lock_guard&lt;std::mutex&gt; lock1(mutex1, std::adopt_lock);    std::lock_guard&lt;std::mutex&gt; lock2(mutex2, std::adopt_lock);        std::cout &lt;&lt; &quot;Thread 2 acquired both mutexes&quot; &lt;&lt; std::endl;&#125;int main() &#123;    std::thread t1(thread1);    std::thread t2(thread2);        t1.join();    t2.join();        return 0;&#125;\n2. ä½¿ç”¨ try_lock é¿å…æ­»é”\n#include &lt;iostream&gt;#include &lt;thread&gt;#include &lt;mutex&gt;#include &lt;chrono&gt;std::mutex mutex1, mutex2;void thread1() &#123;    while (true) &#123;        if (mutex1.try_lock()) &#123;            std::cout &lt;&lt; &quot;Thread 1 acquired mutex1&quot; &lt;&lt; std::endl;                        if (mutex2.try_lock()) &#123;                std::cout &lt;&lt; &quot;Thread 1 acquired mutex2&quot; &lt;&lt; std::endl;                // æ‰§è¡Œæ“ä½œ                mutex2.unlock();                mutex1.unlock();                break;            &#125; else &#123;                mutex1.unlock();                std::this_thread::sleep_for(std::chrono::milliseconds(10));            &#125;        &#125; else &#123;            std::this_thread::sleep_for(std::chrono::milliseconds(10));        &#125;    &#125;&#125;int main() &#123;    std::thread t1(thread1);    t1.join();    return 0;&#125;\n4. æ¡ä»¶å˜é‡ï¼šçº¿ç¨‹é—´é€šä¿¡çš„è‰ºæœ¯\n4.1 æ¡ä»¶å˜é‡çš„åŸºæœ¬æ¦‚å¿µ\næ¡ä»¶å˜é‡ï¼ˆCondition Variableï¼‰ç”¨äºçº¿ç¨‹é—´çš„é€šä¿¡ï¼Œå…è®¸ä¸€ä¸ªçº¿ç¨‹ç­‰å¾…å¦ä¸€ä¸ªçº¿ç¨‹æ»¡è¶³æŸä¸ªæ¡ä»¶ã€‚\n4.2 std::condition_variable çš„ä½¿ç”¨\nç”Ÿäº§è€… - æ¶ˆè´¹è€…æ¨¡å¼\n#include &lt;iostream&gt;#include &lt;thread&gt;#include &lt;mutex&gt;#include &lt;condition_variable&gt;#include &lt;queue&gt;#include &lt;chrono&gt;std::mutex mtx;std::condition_variable cv;std::queue&lt;int&gt; data_queue;bool stop_flag = false;// ç”Ÿäº§è€…çº¿ç¨‹void producer() &#123;    for (int i = 0; i &lt; 10; ++i) &#123;        &#123;            std::lock_guard&lt;std::mutex&gt; lock(mtx);            data_queue.push(i);            std::cout &lt;&lt; &quot;Produced: &quot; &lt;&lt; i &lt;&lt; std::endl;        &#125;        cv.notify_one();  // é€šçŸ¥æ¶ˆè´¹è€…        std::this_thread::sleep_for(std::chrono::milliseconds(500));    &#125;        // é€šçŸ¥æ¶ˆè´¹è€…åœæ­¢    &#123;        std::lock_guard&lt;std::mutex&gt; lock(mtx);        stop_flag = true;    &#125;    cv.notify_one();&#125;// æ¶ˆè´¹è€…çº¿ç¨‹void consumer() &#123;    while (true) &#123;        std::unique_lock&lt;std::mutex&gt; lock(mtx);                // ç­‰å¾…æ¡ä»¶ï¼šé˜Ÿåˆ—ä¸ä¸ºç©ºæˆ–åœæ­¢æ ‡å¿—ä¸ºtrue        cv.wait(lock, []&#123;             return !data_queue.empty() || stop_flag;         &#125;);                // æ£€æŸ¥æ˜¯å¦éœ€è¦åœæ­¢        if (stop_flag &amp;&amp; data_queue.empty()) &#123;            break;        &#125;                // å¤„ç†æ•°æ®        if (!data_queue.empty()) &#123;            int data = data_queue.front();            data_queue.pop();            std::cout &lt;&lt; &quot;Consumed: &quot; &lt;&lt; data &lt;&lt; std::endl;        &#125;    &#125;    std::cout &lt;&lt; &quot;Consumer stopped&quot; &lt;&lt; std::endl;&#125;int main() &#123;    std::thread prod_thread(producer);    std::thread cons_thread(consumer);        prod_thread.join();    cons_thread.join();        return 0;&#125;\n4.3 æ¡ä»¶å˜é‡çš„é«˜çº§ç”¨æ³•\nå¤šä¸ªæ¡ä»¶å˜é‡çš„åè°ƒ\n#include &lt;iostream&gt;#include &lt;thread&gt;#include &lt;mutex&gt;#include &lt;condition_variable&gt;#include &lt;queue&gt;#include &lt;chrono&gt;std::mutex mtx;std::condition_variable cv_producer;std::condition_variable cv_consumer;std::queue&lt;int&gt; data_queue;const int MAX_QUEUE_SIZE = 5;bool stop_flag = false;void producer() &#123;    for (int i = 0; i &lt; 10; ++i) &#123;        std::unique_lock&lt;std::mutex&gt; lock(mtx);                // ç­‰å¾…é˜Ÿåˆ—æœ‰ç©ºé—´        cv_producer.wait(lock, []&#123;            return data_queue.size() &lt; MAX_QUEUE_SIZE || stop_flag;        &#125;);                if (stop_flag) break;                data_queue.push(i);        std::cout &lt;&lt; &quot;Produced: &quot; &lt;&lt; i &lt;&lt; &quot;, Queue size: &quot; &lt;&lt; data_queue.size() &lt;&lt; std::endl;                cv_consumer.notify_one();  // é€šçŸ¥æ¶ˆè´¹è€…    &#125;        // é€šçŸ¥æ¶ˆè´¹è€…åœæ­¢    &#123;        std::lock_guard&lt;std::mutex&gt; lock(mtx);        stop_flag = true;    &#125;    cv_consumer.notify_all();&#125;void consumer() &#123;    while (true) &#123;        std::unique_lock&lt;std::mutex&gt; lock(mtx);                // ç­‰å¾…é˜Ÿåˆ—æœ‰æ•°æ®        cv_consumer.wait(lock, []&#123;            return !data_queue.empty() || stop_flag;        &#125;);                if (stop_flag &amp;&amp; data_queue.empty()) &#123;            break;        &#125;                if (!data_queue.empty()) &#123;            int data = data_queue.front();            data_queue.pop();            std::cout &lt;&lt; &quot;Consumed: &quot; &lt;&lt; data &lt;&lt; &quot;, Queue size: &quot; &lt;&lt; data_queue.size() &lt;&lt; std::endl;                        cv_producer.notify_one();  // é€šçŸ¥ç”Ÿäº§è€…é˜Ÿåˆ—æœ‰ç©ºé—´        &#125;    &#125;&#125;int main() &#123;    std::thread prod_thread(producer);    std::thread cons_thread1(consumer);    std::thread cons_thread2(consumer);        prod_thread.join();    cons_thread1.join();    cons_thread2.join();        return 0;&#125;\n5. å¹¶å‘è®¾è®¡æ¨¡å¼\n5.1 Fork-Join æ¨¡å¼\nFork-Join æ¨¡å¼å°†å¤§ä»»åŠ¡åˆ†è§£ä¸ºå¤šä¸ªå°ä»»åŠ¡å¹¶è¡Œæ‰§è¡Œï¼Œç„¶ååˆå¹¶ç»“æœã€‚\n#include &lt;iostream&gt;#include &lt;thread&gt;#include &lt;vector&gt;#include &lt;algorithm&gt;#include &lt;numeric&gt;template&lt;typename Iterator, typename T&gt;struct accumulate_block &#123;    void operator()(Iterator first, Iterator last, T&amp; result) &#123;        result = std::accumulate(first, last, result);    &#125;&#125;;template&lt;typename Iterator, typename T&gt;T parallel_accumulate(Iterator first, Iterator last, T init) &#123;    unsigned long const length = std::distance(first, last);        if (!length)        return init;        unsigned long const min_per_thread = 25;    unsigned long const max_threads = (length + min_per_thread - 1) / min_per_thread;    unsigned long const hardware_threads = std::thread::hardware_concurrency();    unsigned long const num_threads = std::min(hardware_threads != 0 ? hardware_threads : 2, max_threads);    unsigned long const block_size = length / num_threads;        std::vector&lt;T&gt; results(num_threads);    std::vector&lt;std::thread&gt; threads(num_threads - 1);        Iterator block_start = first;    for (unsigned long i = 0; i &lt; (num_threads - 1); ++i) &#123;        Iterator block_end = block_start;        std::advance(block_end, block_size);        threads[i] = std::thread(            accumulate_block&lt;Iterator, T&gt;(),            block_start, block_end, std::ref(results[i])        );        block_start = block_end;    &#125;        accumulate_block&lt;Iterator, T&gt;()(block_start, last, results[num_threads - 1]);        for (auto&amp; entry : threads) &#123;        entry.join();    &#125;        return std::accumulate(results.begin(), results.end(), init);&#125;int main() &#123;    std::vector&lt;int&gt; numbers(1000000, 1);        int result = parallel_accumulate(numbers.begin(), numbers.end(), 0);        std::cout &lt;&lt; &quot;Parallel accumulate result: &quot; &lt;&lt; result &lt;&lt; std::endl;    std::cout &lt;&lt; &quot;Expected result: &quot; &lt;&lt; numbers.size() &lt;&lt; std::endl;        return 0;&#125;\n5.2 çº¿ç¨‹æ± æ¨¡å¼\nçº¿ç¨‹æ± é¢„å…ˆåˆ›å»ºä¸€ç»„çº¿ç¨‹ï¼Œç”¨äºæ‰§è¡Œå¤šä¸ªä»»åŠ¡ã€‚\n#include &lt;iostream&gt;#include &lt;thread&gt;#include &lt;vector&gt;#include &lt;queue&gt;#include &lt;mutex&gt;#include &lt;condition_variable&gt;#include &lt;functional&gt;#include &lt;future&gt;#include &lt;stdexcept&gt;class ThreadPool &#123;public:    ThreadPool(size_t threads);        template&lt;class F, class... Args&gt;    auto enqueue(F&amp;&amp; f, Args&amp;&amp;... args)         -&gt; std::future&lt;typename std::result_of&lt;F(Args...)&gt;::type&gt;;        ~ThreadPool();    private:    std::vector&lt;std::thread&gt; workers;    std::queue&lt;std::function&lt;void()&gt;&gt; tasks;        std::mutex queue_mutex;    std::condition_variable condition;    bool stop;&#125;;ThreadPool::ThreadPool(size_t threads)     : stop(false) &#123;        for (size_t i = 0; i &lt; threads; ++i) &#123;        workers.emplace_back([this] &#123;            for (;;) &#123;                std::function&lt;void()&gt; task;                                &#123;                    std::unique_lock&lt;std::mutex&gt; lock(this-&gt;queue_mutex);                    this-&gt;condition.wait(lock, [this] &#123;                        return this-&gt;stop || !this-&gt;tasks.empty();                    &#125;);                                        if (this-&gt;stop &amp;&amp; this-&gt;tasks.empty())                        return;                                        task = std::move(this-&gt;tasks.front());                    this-&gt;tasks.pop();                &#125;                                task();            &#125;        &#125;);    &#125;&#125;template&lt;class F, class... Args&gt;auto ThreadPool::enqueue(F&amp;&amp; f, Args&amp;&amp;... args)     -&gt; std::future&lt;typename std::result_of&lt;F(Args...)&gt;::type&gt; &#123;        using return_type = typename std::result_of&lt;F(Args...)&gt;::type;        auto task = std::make_shared&lt;std::packaged_task&lt;return_type()&gt;&gt;(        std::bind(std::forward&lt;F&gt;(f), std::forward&lt;Args&gt;(args)...)    );        std::future&lt;return_type&gt; res = task-&gt;get_future();        &#123;        std::unique_lock&lt;std::mutex&gt; lock(queue_mutex);                if (stop)            throw std::runtime_error(&quot;enqueue on stopped ThreadPool&quot;);                tasks.emplace([task]() &#123; (*task)(); &#125;);    &#125;        condition.notify_one();    return res;&#125;ThreadPool::~ThreadPool() &#123;    &#123;        std::unique_lock&lt;std::mutex&gt; lock(queue_mutex);        stop = true;    &#125;        condition.notify_all();        for (std::thread&amp; worker : workers)        worker.join();&#125;// ä½¿ç”¨ç¤ºä¾‹int calculate_square(int x) &#123;    return x * x;&#125;int main() &#123;    ThreadPool pool(4);    std::vector&lt;std::future&lt;int&gt;&gt; results;        for (int i = 0; i &lt; 8; ++i) &#123;        results.emplace_back(            pool.enqueue(calculate_square, i)        );    &#125;        for (auto&amp;&amp; result : results) &#123;        std::cout &lt;&lt; result.get() &lt;&lt; &quot; &quot;;    &#125;    std::cout &lt;&lt; std::endl;        return 0;&#125;\n5.3 è¯»å†™é”æ¨¡å¼\nè¯»å†™é”å…è®¸å¤šä¸ªè¯»è€…åŒæ—¶è®¿é—®ï¼Œä½†å†™è€…éœ€è¦ç‹¬å è®¿é—®ã€‚\n#include &lt;iostream&gt;#include &lt;thread&gt;#include &lt;shared_mutex&gt;#include &lt;vector&gt;#include &lt;chrono&gt;class SharedData &#123;private:    int data_;    mutable std::shared_mutex mutex_;    public:    SharedData(int initial_data) : data_(initial_data) &#123;&#125;        // è¯»æ“ä½œï¼šå…±äº«è®¿é—®    int read_data() const &#123;        std::shared_lock&lt;std::shared_mutex&gt; lock(mutex_);        std::this_thread::sleep_for(std::chrono::milliseconds(10));        return data_;    &#125;        // å†™æ“ä½œï¼šç‹¬å è®¿é—®    void write_data(int new_value) &#123;        std::unique_lock&lt;std::shared_mutex&gt; lock(mutex_);        std::this_thread::sleep_for(std::chrono::milliseconds(100));        data_ = new_value;    &#125;&#125;;void reader_thread(SharedData&amp; data, int id) &#123;    for (int i = 0; i &lt; 5; ++i) &#123;        int value = data.read_data();        std::cout &lt;&lt; &quot;Reader &quot; &lt;&lt; id &lt;&lt; &quot; read: &quot; &lt;&lt; value &lt;&lt; std::endl;        std::this_thread::sleep_for(std::chrono::milliseconds(50));    &#125;&#125;void writer_thread(SharedData&amp; data, int id, int start_value) &#123;    for (int i = 0; i &lt; 3; ++i) &#123;        int new_value = start_value + i;        data.write_data(new_value);        std::cout &lt;&lt; &quot;Writer &quot; &lt;&lt; id &lt;&lt; &quot; wrote: &quot; &lt;&lt; new_value &lt;&lt; std::endl;        std::this_thread::sleep_for(std::chrono::milliseconds(200));    &#125;&#125;int main() &#123;    SharedData data(0);    std::vector&lt;std::thread&gt; threads;        // åˆ›å»º5ä¸ªè¯»è€…çº¿ç¨‹    for (int i = 0; i &lt; 5; ++i) &#123;        threads.emplace_back(reader_thread, std::ref(data), i);    &#125;        // åˆ›å»º2ä¸ªå†™è€…çº¿ç¨‹    threads.emplace_back(writer_thread, std::ref(data), 0, 100);    threads.emplace_back(writer_thread, std::ref(data), 1, 200);        for (auto&amp; t : threads) &#123;        t.join();    &#125;        return 0;&#125;\n6. å†…å­˜æ¨¡å‹ä¸åŸå­æ“ä½œ\n6.1 C++ å†…å­˜æ¨¡å‹åŸºç¡€\nC++ å†…å­˜æ¨¡å‹å®šä¹‰äº†å¤šçº¿ç¨‹ç¯å¢ƒä¸‹å†…å­˜æ“ä½œçš„å¯è§æ€§å’Œé¡ºåºæ€§è§„åˆ™ã€‚\n6.2 åŸå­æ“ä½œè¯¦è§£\nåŸºæœ¬åŸå­ç±»å‹\n#include &lt;iostream&gt;#include &lt;thread&gt;#include &lt;atomic&gt;#include &lt;vector&gt;std::atomic&lt;int&gt; atomic_counter(0);int normal_counter = 0;void increment_counters() &#123;    for (int i = 0; i &lt; 100000; ++i) &#123;        atomic_counter++;        normal_counter++;    &#125;&#125;int main() &#123;    std::vector&lt;std::thread&gt; threads;        for (int i = 0; i &lt; 10; ++i) &#123;        threads.emplace_back(increment_counters);    &#125;        for (auto&amp; t : threads) &#123;        t.join();    &#125;        std::cout &lt;&lt; &quot;Atomic counter: &quot; &lt;&lt; atomic_counter &lt;&lt; std::endl;    std::cout &lt;&lt; &quot;Normal counter: &quot; &lt;&lt; normal_counter &lt;&lt; std::endl;        return 0;&#125;\nåŸå­æ“ä½œçš„å†…å­˜é¡ºåº\n#include &lt;iostream&gt;#include &lt;thread&gt;#include &lt;atomic&gt;#include &lt;vector&gt;std::atomic&lt;bool&gt; x(false), y(false);std::atomic&lt;int&gt; z(0);void write_x() &#123;    x.store(true, std::memory_order_release);&#125;void write_y() &#123;    y.store(true, std::memory_order_release);&#125;void read_x_then_y() &#123;    while (!x.load(std::memory_order_acquire));    if (y.load(std::memory_order_acquire)) &#123;        z++;    &#125;&#125;void read_y_then_x() &#123;    while (!y.load(std::memory_order_acquire));    if (x.load(std::memory_order_acquire)) &#123;        z++;    &#125;&#125;int main() &#123;    for (int i = 0; i &lt; 10000; ++i) &#123;        x = false;        y = false;        z = 0;                std::thread a(write_x);        std::thread b(write_y);        std::thread c(read_x_then_y);        std::thread d(read_y_then_x);                a.join();        b.join();        c.join();        d.join();                if (z.load() == 0) &#123;            std::cout &lt;&lt; &quot;z is 0 after &quot; &lt;&lt; i + 1 &lt;&lt; &quot; iterations&quot; &lt;&lt; std::endl;        &#125;    &#125;        return 0;&#125;\næ— é”æ•°æ®ç»“æ„\n#include &lt;iostream&gt;#include &lt;thread&gt;#include &lt;atomic&gt;#include &lt;vector&gt;template&lt;typename T&gt;class LockFreeStack &#123;private:    struct Node &#123;        T data;        Node* next;                Node(const T&amp; data) : data(data), next(nullptr) &#123;&#125;    &#125;;        std::atomic&lt;Node*&gt; head;    public:    LockFreeStack() : head(nullptr) &#123;&#125;        ~LockFreeStack() &#123;        while (Node* old_head = head.load()) &#123;            head.store(old_head-&gt;next);            delete old_head;        &#125;    &#125;        void push(const T&amp; data) &#123;        Node* new_node = new Node(data);        new_node-&gt;next = head.load();                // ä½¿ç”¨compare_exchange_weakå¤„ç†å¹¶å‘        while (!head.compare_exchange_weak(new_node-&gt;next, new_node)) &#123;            // é‡è¯•ç›´åˆ°æˆåŠŸ        &#125;    &#125;        bool pop(T&amp; result) &#123;        Node* old_head = head.load();                while (old_head &amp;&amp; !head.compare_exchange_weak(old_head, old_head-&gt;next)) &#123;            // é‡è¯•ç›´åˆ°æˆåŠŸæˆ–æ ˆä¸ºç©º        &#125;                if (!old_head) &#123;            return false;        &#125;                result = old_head-&gt;data;        delete old_head;        return true;    &#125;        bool empty() const &#123;        return head.load() == nullptr;    &#125;&#125;;void push_to_stack(LockFreeStack&lt;int&gt;&amp; stack, int start, int end) &#123;    for (int i = start; i &lt; end; ++i) &#123;        stack.push(i);    &#125;&#125;void pop_from_stack(LockFreeStack&lt;int&gt;&amp; stack, int count, std::vector&lt;int&gt;&amp; results) &#123;    int value;    for (int i = 0; i &lt; count; ++i) &#123;        if (stack.pop(value)) &#123;            results.push_back(value);        &#125;    &#125;&#125;int main() &#123;    LockFreeStack&lt;int&gt; stack;    std::vector&lt;int&gt; results1, results2;        std::thread pusher1(push_to_stack, std::ref(stack), 0, 1000);    std::thread pusher2(push_to_stack, std::ref(stack), 1000, 2000);    std::thread popper1(pop_from_stack, std::ref(stack), 1000, std::ref(results1));    std::thread popper2(pop_from_stack, std::ref(stack), 1000, std::ref(results2));        pusher1.join();    pusher2.join();    popper1.join();    popper2.join();        std::cout &lt;&lt; &quot;Pushed 2000 elements&quot; &lt;&lt; std::endl;    std::cout &lt;&lt; &quot;Popped &quot; &lt;&lt; results1.size() + results2.size() &lt;&lt; &quot; elements&quot; &lt;&lt; std::endl;        return 0;&#125;\n7. å¼‚æ­¥æ“ä½œï¼šéé˜»å¡ç¼–ç¨‹èŒƒå¼\n7.1 å¼‚æ­¥ç¼–ç¨‹æ¦‚è¿°\n7.1.1 ä»€ä¹ˆæ˜¯å¼‚æ­¥ç¼–ç¨‹\nå¼‚æ­¥ç¼–ç¨‹æ˜¯ä¸€ç§ç¼–ç¨‹èŒƒå¼ï¼Œå®ƒå…è®¸ç¨‹åºåœ¨ç­‰å¾…æ“ä½œå®Œæˆï¼ˆå¦‚ç½‘ç»œè¯·æ±‚ã€æ–‡ä»¶ I/Oã€æ•°æ®åº“æŸ¥è¯¢ç­‰ï¼‰æ—¶ç»§ç»­æ‰§è¡Œå…¶ä»–ä»»åŠ¡ã€‚ä¸åŒæ­¥ç¼–ç¨‹ä¸åŒï¼Œå¼‚æ­¥æ“ä½œä¸ä¼šé˜»å¡å½“å‰æ‰§è¡Œæµç¨‹ã€‚\n7.1.2 åŒæ­¥ vs å¼‚æ­¥çš„æœ¬è´¨åŒºåˆ«\n\n\n\nç‰¹æ€§\nåŒæ­¥ (Synchronous)\nå¼‚æ­¥ (Asynchronous)\n\n\n\n\næ‰§è¡Œæ–¹å¼\né¡ºåºæ‰§è¡Œï¼Œä¸€æ­¥æ¥ä¸€æ­¥\nå¹¶å‘æ‰§è¡Œï¼Œæ— éœ€ç­‰å¾…\n\n\nç­‰å¾…è¡Œä¸º\né˜»å¡ç­‰å¾…ç»“æœè¿”å›\néé˜»å¡ï¼Œç«‹å³è¿”å›\n\n\nèµ„æºåˆ©ç”¨\nä½æ•ˆï¼ˆCPU å¸¸é—²ç½®ç­‰å¾…ï¼‰\né«˜æ•ˆï¼ˆCPU æŒç»­å·¥ä½œï¼‰\n\n\nç¼–ç¨‹æ¨¡å‹\nç›´çº¿å¼æ€ç»´ï¼Œæ˜“äºç†è§£\näº‹ä»¶é©±åŠ¨ / å›è°ƒæ€ç»´\n\n\nå¤æ‚åº¦\nç®€å•ç›´æ¥\nè¾ƒå¤æ‚ï¼ˆå›è°ƒåœ°ç‹±é£é™©ï¼‰\n\n\né€‚ç”¨åœºæ™¯\nCPU å¯†é›†å‹ä»»åŠ¡ã€ç®€å•è„šæœ¬\nI/O å¯†é›†å‹ã€é«˜å¹¶å‘æœåŠ¡\n\n\n\n7.1.3 ç”Ÿæ´»ä¸­çš„å¼‚æ­¥å“²å­¦\nåŒæ­¥åœºæ™¯ï¼šåœ¨å¿«é¤åº—æ’é˜Ÿç‚¹é¤ - å¿…é¡»ç­‰å‰ä¸€ä¸ªäººå®Œæˆæ‰èƒ½ç‚¹é¤å¼‚æ­¥åœºæ™¯ï¼šåœ¨æ­£é¤å…æ¡Œè¾¹ç‚¹é¤ - ç‚¹é¤åå¯ä»¥åšå…¶ä»–äº‹ï¼ŒæœåŠ¡å‘˜ä¼šé€é¤\n7.2 C++ å¼‚æ­¥ç¼–ç¨‹ç»„ä»¶\n7.2.1 std::future - å¼‚æ­¥ç»“æœçš„å ä½ç¬¦\nstd::future è¡¨ç¤ºä¸€ä¸ªå¼‚æ­¥æ“ä½œçš„ç»“æœï¼Œå¯ä»¥åœ¨æœªæ¥æŸä¸ªæ—¶é—´ç‚¹è·å–ã€‚\n#include &lt;iostream&gt;#include &lt;future&gt;#include &lt;chrono&gt;// æ¨¡æ‹Ÿè€—æ—¶è®¡ç®—int expensive_calculation(int x, int y) &#123;    std::this_thread::sleep_for(std::chrono::seconds(2));    return x * y;&#125;int main() &#123;    std::cout &lt;&lt; &quot;Main thread started&quot; &lt;&lt; std::endl;        // å¯åŠ¨å¼‚æ­¥ä»»åŠ¡    std::future&lt;int&gt; result_future = std::async(expensive_calculation, 10, 20);        // ä¸»çº¿ç¨‹å¯ä»¥ç»§ç»­æ‰§è¡Œå…¶ä»–ä»»åŠ¡    std::cout &lt;&lt; &quot;Main thread is doing other work...&quot; &lt;&lt; std::endl;    for (int i = 0; i &lt; 5; ++i) &#123;        std::cout &lt;&lt; &quot;Main: &quot; &lt;&lt; i &lt;&lt; std::endl;        std::this_thread::sleep_for(std::chrono::milliseconds(300));    &#125;        // è·å–å¼‚æ­¥ä»»åŠ¡ç»“æœï¼ˆå¦‚æœæœªå®Œæˆä¼šé˜»å¡ï¼‰    std::cout &lt;&lt; &quot;Waiting for async result...&quot; &lt;&lt; std::endl;    int result = result_future.get();    std::cout &lt;&lt; &quot;Async result: &quot; &lt;&lt; result &lt;&lt; std::endl;        return 0;&#125;\n7.2.2 std::async - å¼‚æ­¥ä»»åŠ¡å¯åŠ¨å™¨\nstd::async æ˜¯å¯åŠ¨å¼‚æ­¥ä»»åŠ¡çš„ä¾¿æ·å‡½æ•°ï¼Œè¿”å›ä¸€ä¸ª std::future å¯¹è±¡ã€‚\n#include &lt;iostream&gt;#include &lt;future&gt;#include &lt;vector&gt;// å¹¶è¡Œè®¡ç®—ç¤ºä¾‹int parallel_sum(const std::vector&lt;int&gt;&amp; data, int start, int end) &#123;    int sum = 0;    for (int i = start; i &lt; end; ++i) &#123;        sum += data[i];    &#125;    return sum;&#125;int main() &#123;    std::vector&lt;int&gt; large_data(1000000, 1);        // å°†æ•°æ®åˆ†æˆ4ä¸ªéƒ¨åˆ†å¹¶è¡Œè®¡ç®—    int mid1 = large_data.size() / 4;    int mid2 = large_data.size() / 2;    int mid3 = 3 * large_data.size() / 4;        std::future&lt;int&gt; f1 = std::async(parallel_sum, std::ref(large_data), 0, mid1);    std::future&lt;int&gt; f2 = std::async(parallel_sum, std::ref(large_data), mid1, mid2);    std::future&lt;int&gt; f3 = std::async(parallel_sum, std::ref(large_data), mid2, mid3);    std::future&lt;int&gt; f4 = std::async(parallel_sum, std::ref(large_data), mid3, large_data.size());        // æ±‡æ€»ç»“æœ    int total = f1.get() + f2.get() + f3.get() + f4.get();    std::cout &lt;&lt; &quot;Total sum: &quot; &lt;&lt; total &lt;&lt; std::endl;        return 0;&#125;\n7.2.3 std::promise - ä¸»åŠ¨è®¾ç½®å¼‚æ­¥ç»“æœ\nstd::promise å…è®¸ä¸€ä¸ªçº¿ç¨‹è®¾ç½®ç»“æœï¼Œå¦ä¸€ä¸ªçº¿ç¨‹é€šè¿‡ std::future è·å–ç»“æœã€‚\n#include &lt;iostream&gt;#include &lt;future&gt;#include &lt;thread&gt;#include &lt;chrono&gt;void worker_thread(std::promise&lt;int&gt;&amp; prom) &#123;    try &#123;        std::cout &lt;&lt; &quot;Worker thread started&quot; &lt;&lt; std::endl;        std::this_thread::sleep_for(std::chrono::seconds(2));                // æ¨¡æ‹Ÿè®¡ç®—        int result = 42;                // è®¾ç½®ç»“æœ        prom.set_value(result);        std::cout &lt;&lt; &quot;Worker thread finished&quot; &lt;&lt; std::endl;    &#125; catch (...) &#123;        // è®¾ç½®å¼‚å¸¸        prom.set_exception(std::current_exception());    &#125;&#125;int main() &#123;    std::promise&lt;int&gt; prom;    std::future&lt;int&gt; fut = prom.get_future();        // å¯åŠ¨å·¥ä½œçº¿ç¨‹    std::thread t(worker_thread, std::ref(prom));        std::cout &lt;&lt; &quot;Main thread waiting for result...&quot; &lt;&lt; std::endl;        // è·å–ç»“æœ    try &#123;        int result = fut.get();        std::cout &lt;&lt; &quot;Result from worker: &quot; &lt;&lt; result &lt;&lt; std::endl;    &#125; catch (const std::exception&amp; e) &#123;        std::cerr &lt;&lt; &quot;Exception from worker: &quot; &lt;&lt; e.what() &lt;&lt; std::endl;    &#125;        t.join();    return 0;&#125;\n7.2.4 std::packaged_task - ä»»åŠ¡åŒ…è£…å™¨\nstd::packaged_task å°†å¯è°ƒç”¨å¯¹è±¡åŒ…è£…èµ·æ¥ï¼Œæ–¹ä¾¿ä½œä¸ºçº¿ç¨‹å‡½æ•°ä½¿ç”¨ã€‚\n#include &lt;iostream&gt;#include &lt;future&gt;#include &lt;thread&gt;#include &lt;vector&gt;// çŸ©é˜µä¹˜æ³•çš„ä¸€éƒ¨åˆ†void matrix_multiply_part(const std::vector&lt;std::vector&lt;int&gt;&gt;&amp; A,                          const std::vector&lt;std::vector&lt;int&gt;&gt;&amp; B,                          std::vector&lt;std::vector&lt;int&gt;&gt;&amp; C,                          int start_row, int end_row) &#123;    int cols_B = B[0].size();    int cols_A = A[0].size();        for (int i = start_row; i &lt; end_row; ++i) &#123;        for (int j = 0; j &lt; cols_B; ++j) &#123;            C[i][j] = 0;            for (int k = 0; k &lt; cols_A; ++k) &#123;                C[i][j] += A[i][k] * B[k][j];            &#125;        &#125;    &#125;&#125;int main() &#123;    const int size = 100;    std::vector&lt;std::vector&lt;int&gt;&gt; A(size, std::vector&lt;int&gt;(size, 1));    std::vector&lt;std::vector&lt;int&gt;&gt; B(size, std::vector&lt;int&gt;(size, 2));    std::vector&lt;std::vector&lt;int&gt;&gt; C(size, std::vector&lt;int&gt;(size, 0));        int num_threads = std::thread::hardware_concurrency();    int rows_per_thread = size / num_threads;        std::vector&lt;std::future&lt;void&gt;&gt; futures;        for (int i = 0; i &lt; num_threads; ++i) &#123;        int start = i * rows_per_thread;        int end = (i == num_threads - 1) ? size : (i + 1) * rows_per_thread;                // ä½¿ç”¨packaged_taskåŒ…è£…ä»»åŠ¡        std::packaged_task&lt;void()&gt; task([&amp;, start, end]() &#123;            matrix_multiply_part(A, B, C, start, end);        &#125;);                futures.push_back(task.get_future());                // å¯åŠ¨çº¿ç¨‹æ‰§è¡Œä»»åŠ¡        std::thread t(std::move(task));        t.detach();    &#125;        // ç­‰å¾…æ‰€æœ‰ä»»åŠ¡å®Œæˆ    for (auto&amp; fut : futures) &#123;        fut.get();    &#125;        std::cout &lt;&lt; &quot;Matrix multiplication completed&quot; &lt;&lt; std::endl;    return 0;&#125;\n7.3 å¼‚æ­¥ç¼–ç¨‹çš„è®¾è®¡åŸç†\n7.3.1 å¼‚æ­¥ç¼–ç¨‹çš„æ ¸å¿ƒåŸç†\n1. äº‹ä»¶é©±åŠ¨æ¨¡å‹\nå¼‚æ­¥ç¼–ç¨‹åŸºäºäº‹ä»¶é©±åŠ¨æ¨¡å‹ï¼Œç¨‹åºé€šè¿‡å“åº”äº‹ä»¶æ¥å¤„ç†ä»»åŠ¡å®Œæˆã€‚\n#include &lt;iostream&gt;#include &lt;future&gt;#include &lt;queue&gt;#include &lt;mutex&gt;#include &lt;condition_variable&gt;#include &lt;functional&gt;class EventLoop &#123;private:    std::queue&lt;std::function&lt;void()&gt;&gt; events_;    std::mutex mtx_;    std::condition_variable cv_;    bool running_;    public:    EventLoop() : running_(true) &#123;&#125;        void post(std::function&lt;void()&gt; event) &#123;        std::lock_guard&lt;std::mutex&gt; lock(mtx_);        events_.push(event);        cv_.notify_one();    &#125;        void run() &#123;        while (running_) &#123;            std::unique_lock&lt;std::mutex&gt; lock(mtx_);            cv_.wait(lock, [this]&#123; return !events_.empty() || !running_; &#125;);                        if (!running_) break;                        auto event = events_.front();            events_.pop();            lock.unlock();                        event();        &#125;    &#125;        void stop() &#123;        std::lock_guard&lt;std::mutex&gt; lock(mtx_);        running_ = false;        cv_.notify_one();    &#125;&#125;;// ä½¿ç”¨äº‹ä»¶å¾ªç¯çš„å¼‚æ­¥ä»»åŠ¡void async_task(EventLoop&amp; loop, int id) &#123;    std::cout &lt;&lt; &quot;Async task &quot; &lt;&lt; id &lt;&lt; &quot; started&quot; &lt;&lt; std::endl;        // æ¨¡æ‹Ÿå¼‚æ­¥æ“ä½œ    std::thread([&amp;loop, id]() &#123;        std::this_thread::sleep_for(std::chrono::seconds(1));                // ä»»åŠ¡å®Œæˆåå‘å¸ƒäº‹ä»¶        loop.post([id]() &#123;            std::cout &lt;&lt; &quot;Async task &quot; &lt;&lt; id &lt;&lt; &quot; completed&quot; &lt;&lt; std::endl;        &#125;);    &#125;).detach();&#125;int main() &#123;    EventLoop loop;        // å¯åŠ¨äº‹ä»¶å¾ªç¯çº¿ç¨‹    std::thread loop_thread([&amp;loop]() &#123;        loop.run();    &#125;);        // æäº¤å¤šä¸ªå¼‚æ­¥ä»»åŠ¡    for (int i = 0; i &lt; 5; ++i) &#123;        async_task(loop, i);        std::this_thread::sleep_for(std::chrono::milliseconds(200));    &#125;        // ç­‰å¾…æ‰€æœ‰ä»»åŠ¡å®Œæˆ    std::this_thread::sleep_for(std::chrono::seconds(2));        loop.stop();    loop_thread.join();        return 0;&#125;\n2. å›è°ƒæœºåˆ¶\nå›è°ƒæ˜¯å¼‚æ­¥ç¼–ç¨‹çš„åŸºç¡€æœºåˆ¶ï¼Œå½“å¼‚æ­¥æ“ä½œå®Œæˆæ—¶è°ƒç”¨é¢„è®¾çš„å‡½æ•°ã€‚\n#include &lt;iostream&gt;#include &lt;future&gt;#include &lt;functional&gt;#include &lt;chrono&gt;// å¼‚æ­¥æ–‡ä»¶è¯»å–æ¨¡æ‹Ÿvoid async_file_read(const std::string&amp; filename,                     std::function&lt;void(const std::string&amp;)&gt; callback) &#123;    std::thread([filename, callback]() &#123;        std::this_thread::sleep_for(std::chrono::seconds(1));                // æ¨¡æ‹Ÿæ–‡ä»¶å†…å®¹        std::string content = &quot;File content of &quot; + filename;                // è°ƒç”¨å›è°ƒå‡½æ•°        callback(content);    &#125;).detach();&#125;// é“¾å¼å¼‚æ­¥æ“ä½œvoid process_data_chain() &#123;    // ç¬¬ä¸€æ­¥ï¼šè¯»å–æ–‡ä»¶    async_file_read(&quot;data.txt&quot;, [](const std::string&amp; content) &#123;        std::cout &lt;&lt; &quot;Step 1: File read completed&quot; &lt;&lt; std::endl;                // ç¬¬äºŒæ­¥ï¼šå¤„ç†æ•°æ®        std::string processed = content + &quot; (processed)&quot;;                // ç¬¬ä¸‰æ­¥ï¼šä¿å­˜ç»“æœ        async_file_read(&quot;result.txt&quot;, [processed](const std::string&amp;) &#123;            std::cout &lt;&lt; &quot;Step 3: Result saved&quot; &lt;&lt; std::endl;            std::cout &lt;&lt; &quot;Final data: &quot; &lt;&lt; processed &lt;&lt; std::endl;        &#125;);    &#125;);&#125;int main() &#123;    std::cout &lt;&lt; &quot;Starting async processing chain...&quot; &lt;&lt; std::endl;    process_data_chain();        // ç­‰å¾…å¼‚æ­¥æ“ä½œå®Œæˆ    std::this_thread::sleep_for(std::chrono::seconds(3));        return 0;&#125;\n7.3.2 å¼‚æ­¥ç¼–ç¨‹æ¨¡å¼\n1. ç”Ÿäº§è€… - æ¶ˆè´¹è€…æ¨¡å¼çš„å¼‚æ­¥å®ç°\n#include &lt;iostream&gt;#include &lt;queue&gt;#include &lt;mutex&gt;#include &lt;condition_variable&gt;#include &lt;thread&gt;#include &lt;future&gt;#include &lt;chrono&gt;template&lt;typename T&gt;class AsyncQueue &#123;private:    std::queue&lt;T&gt; queue_;    std::mutex mtx_;    std::condition_variable cv_;    bool stopped_;    public:    AsyncQueue() : stopped_(false) &#123;&#125;        void push(const T&amp; item) &#123;        std::lock_guard&lt;std::mutex&gt; lock(mtx_);        if (!stopped_) &#123;            queue_.push(item);            cv_.notify_one();        &#125;    &#125;        bool pop(T&amp; item, std::chrono::milliseconds timeout = std::chrono::milliseconds(0)) &#123;        std::unique_lock&lt;std::mutex&gt; lock(mtx_);                if (timeout.count() == 0) &#123;            cv_.wait(lock, [this]&#123; return !queue_.empty() || stopped_; &#125;);        &#125; else &#123;            if (!cv_.wait_for(lock, timeout, [this]&#123; return !queue_.empty() || stopped_; &#125;)) &#123;                return false;            &#125;        &#125;                if (stopped_ &amp;&amp; queue_.empty()) &#123;            return false;        &#125;                item = queue_.front();        queue_.pop();        return true;    &#125;        void stop() &#123;        std::lock_guard&lt;std::mutex&gt; lock(mtx_);        stopped_ = true;        cv_.notify_all();    &#125;        bool empty() const &#123;        std::lock_guard&lt;std::mutex&gt; lock(mtx_);        return queue_.empty();    &#125;&#125;;// å¼‚æ­¥ç”Ÿäº§è€…void producer(AsyncQueue&lt;int&gt;&amp; queue) &#123;    for (int i = 0; i &lt; 10; ++i) &#123;        std::cout &lt;&lt; &quot;Producing: &quot; &lt;&lt; i &lt;&lt; std::endl;        queue.push(i);        std::this_thread::sleep_for(std::chrono::milliseconds(300));    &#125;    queue.stop();&#125;// å¼‚æ­¥æ¶ˆè´¹è€…void consumer(AsyncQueue&lt;int&gt;&amp; queue, const std::string&amp; name) &#123;    int item;    while (queue.pop(item)) &#123;        std::cout &lt;&lt; &quot;Consumer &quot; &lt;&lt; name &lt;&lt; &quot; processing: &quot; &lt;&lt; item &lt;&lt; std::endl;        std::this_thread::sleep_for(std::chrono::milliseconds(500));    &#125;    std::cout &lt;&lt; &quot;Consumer &quot; &lt;&lt; name &lt;&lt; &quot; stopped&quot; &lt;&lt; std::endl;&#125;int main() &#123;    AsyncQueue&lt;int&gt; queue;        // å¯åŠ¨ç”Ÿäº§è€…    std::thread prod_thread(producer, std::ref(queue));        // å¯åŠ¨æ¶ˆè´¹è€…    std::thread cons_thread1(consumer, std::ref(queue), &quot;A&quot;);    std::thread cons_thread2(consumer, std::ref(queue), &quot;B&quot;);        prod_thread.join();    cons_thread1.join();    cons_thread2.join();        return 0;&#125;\n2. å¼‚æ­¥å·¥ä½œæ± æ¨¡å¼\n#include &lt;iostream&gt;#include &lt;vector&gt;#include &lt;queue&gt;#include &lt;thread&gt;#include &lt;mutex&gt;#include &lt;condition_variable&gt;#include &lt;future&gt;#include &lt;functional&gt;#include &lt;stdexcept&gt;class AsyncWorkerPool &#123;private:    std::vector&lt;std::thread&gt; workers_;    std::queue&lt;std::function&lt;void()&gt;&gt; tasks_;    std::mutex mtx_;    std::condition_variable cv_;    bool stop_;    public:    AsyncWorkerPool(size_t num_workers) : stop_(false) &#123;        for (size_t i = 0; i &lt; num_workers; ++i) &#123;            workers_.emplace_back([this] &#123;                while (true) &#123;                    std::function&lt;void()&gt; task;                                        &#123;                        std::unique_lock&lt;std::mutex&gt; lock(this-&gt;mtx_);                        this-&gt;cv_.wait(lock, [this] &#123;                            return this-&gt;stop_ || !this-&gt;tasks_.empty();                        &#125;);                                                if (this-&gt;stop_ &amp;&amp; this-&gt;tasks_.empty()) &#123;                            return;                        &#125;                                                task = std::move(this-&gt;tasks_.front());                        this-&gt;tasks_.pop();                    &#125;                                        task();                &#125;            &#125;);        &#125;    &#125;        template&lt;class F, class... Args&gt;    auto enqueue(F&amp;&amp; f, Args&amp;&amp;... args)         -&gt; std::future&lt;typename std::result_of&lt;F(Args...)&gt;::type&gt; &#123;                using return_type = typename std::result_of&lt;F(Args...)&gt;::type;                auto task = std::make_shared&lt;std::packaged_task&lt;return_type()&gt;&gt;(            std::bind(std::forward&lt;F&gt;(f), std::forward&lt;Args&gt;(args)...)        );                std::future&lt;return_type&gt; res = task-&gt;get_future();                &#123;            std::unique_lock&lt;std::mutex&gt; lock(mtx_);                        if (stop_) &#123;                throw std::runtime_error(&quot;enqueue on stopped AsyncWorkerPool&quot;);            &#125;                        tasks_.emplace([task]() &#123; (*task)(); &#125;);        &#125;                cv_.notify_one();        return res;    &#125;        ~AsyncWorkerPool() &#123;        &#123;            std::unique_lock&lt;std::mutex&gt; lock(mtx_);            stop_ = true;        &#125;                cv_.notify_all();                for (std::thread&amp; worker : workers_) &#123;            worker.join();        &#125;    &#125;&#125;;// å¤æ‚è®¡ç®—ä»»åŠ¡int complex_calculation(int x, int y) &#123;    std::this_thread::sleep_for(std::chrono::milliseconds(100));    return x * y;&#125;int main() &#123;    AsyncWorkerPool pool(4);    std::vector&lt;std::future&lt;int&gt;&gt; results;        // æäº¤å¤šä¸ªå¼‚æ­¥ä»»åŠ¡    for (int i = 0; i &lt; 16; ++i) &#123;        results.emplace_back(            pool.enqueue(complex_calculation, i, i + 1)        );    &#125;        // è·å–ç»“æœ    for (auto&amp;&amp; result : results) &#123;        std::cout &lt;&lt; result.get() &lt;&lt; &quot; &quot;;    &#125;    std::cout &lt;&lt; std::endl;        return 0;&#125;\n7.4 å¼‚æ­¥ç¼–ç¨‹çš„å“²å­¦æ€æƒ³\n7.4.1 å¼‚æ­¥çš„æ—¶é—´å“²å­¦\nå¼‚æ­¥ç¼–ç¨‹ä½“ç°äº†å¯¹æ—¶é—´èµ„æºçš„æ·±åˆ»ç†è§£å’Œä¼˜åŒ–åˆ©ç”¨ï¼š\n// åŒæ­¥æ€ç»´ï¼šæµªè´¹æ—¶é—´ç­‰å¾…void synchronous_thinking() &#123;    // ç­‰å¾…æ¯ä¸ªæ“ä½œå®Œæˆåå†è¿›è¡Œä¸‹ä¸€ä¸ª    auto result1 = operation1();  // ç­‰å¾…2ç§’    auto result2 = operation2(result1);  // ç­‰å¾…3ç§’    auto result3 = operation3(result2);  // ç­‰å¾…1ç§’        // æ€»æ—¶é—´ï¼š6ç§’ï¼ŒCPUåˆ©ç”¨ç‡ä½&#125;// å¼‚æ­¥æ€ç»´ï¼šå……åˆ†åˆ©ç”¨ç­‰å¾…æ—¶é—´void asynchronous_thinking() &#123;    // å¯åŠ¨æ‰€æœ‰æ“ä½œï¼Œåœ¨ç­‰å¾…æ—¶åšå…¶ä»–äº‹æƒ…    auto future1 = async_operation1();    auto future2 = async_operation2();    auto future3 = async_operation3();        // åœ¨ç­‰å¾…ç»“æœæ—¶å¤„ç†å…¶ä»–ä»»åŠ¡    do_other_work();        // è·å–ç»“æœ    auto result1 = future1.get();    auto result2 = future2.get();    auto result3 = future3.get();        // æ€»æ—¶é—´ï¼š3ç§’ï¼ˆå–å†³äºæœ€æ…¢çš„æ“ä½œï¼‰ï¼ŒCPUåˆ©ç”¨ç‡é«˜&#125;\n7.4.2 å¼‚æ­¥çš„èµ„æºå“²å­¦\nå¼‚æ­¥ç¼–ç¨‹æœ€å¤§åŒ–äº†ç³»ç»Ÿèµ„æºçš„åˆ©ç”¨æ•ˆç‡ï¼š\n#include &lt;iostream&gt;#include &lt;future&gt;#include &lt;chrono&gt;#include &lt;vector&gt;// I/Oå¯†é›†å‹ä»»åŠ¡void io_bound_task(int id) &#123;    std::cout &lt;&lt; &quot;Task &quot; &lt;&lt; id &lt;&lt; &quot; started (I/O bound)&quot; &lt;&lt; std::endl;        // æ¨¡æ‹ŸI/Oç­‰å¾…æ—¶é—´    std::this_thread::sleep_for(std::chrono::seconds(2));        std::cout &lt;&lt; &quot;Task &quot; &lt;&lt; id &lt;&lt; &quot; completed&quot; &lt;&lt; std::endl;&#125;int main() &#123;    const int num_tasks = 100;    std::vector&lt;std::future&lt;void&gt;&gt; futures;        auto start_time = std::chrono::high_resolution_clock::now();        // å¼‚æ­¥æ‰§è¡Œå¤šä¸ªI/Oå¯†é›†å‹ä»»åŠ¡    for (int i = 0; i &lt; num_tasks; ++i) &#123;        futures.emplace_back(std::async(std::launch::async, io_bound_task, i));    &#125;        // ç­‰å¾…æ‰€æœ‰ä»»åŠ¡å®Œæˆ    for (auto&amp; fut : futures) &#123;        fut.get();    &#125;        auto end_time = std::chrono::high_resolution_clock::now();    auto duration = std::chrono::duration_cast&lt;std::chrono::seconds&gt;(        end_time - start_time    );        std::cout &lt;&lt; &quot;All &quot; &lt;&lt; num_tasks &lt;&lt; &quot; tasks completed in &quot;               &lt;&lt; duration.count() &lt;&lt; &quot; seconds&quot; &lt;&lt; std::endl;        return 0;&#125;\n7.4.3 å¼‚æ­¥çš„è´£ä»»é“¾å“²å­¦\nå¼‚æ­¥ç¼–ç¨‹å»ºç«‹äº†æ¸…æ™°çš„è´£ä»»è¾¹ç•Œå’Œåä½œæ¨¡å¼ï¼š\n#include &lt;iostream&gt;#include &lt;future&gt;#include &lt;functional&gt;#include &lt;string&gt;// å¼‚æ­¥å¤„ç†ç®¡é“class AsyncPipeline &#123;public:    template&lt;typename T, typename Func&gt;    static auto process(const T&amp; input, Func&amp;&amp; func) &#123;        return std::async(std::launch::async, std::forward&lt;Func&gt;(func), input);    &#125;        template&lt;typename Future, typename Func&gt;    static auto then(Future&amp;&amp; future, Func&amp;&amp; func) &#123;        return std::async(std::launch::async, [future = std::move(future), func = std::forward&lt;Func&gt;(func)]() mutable &#123;            return func(future.get());        &#125;);    &#125;&#125;;// æ•°æ®å¤„ç†æ­¥éª¤std::string read_data(const std::string&amp; filename) &#123;    std::cout &lt;&lt; &quot;Step 1: Reading data from &quot; &lt;&lt; filename &lt;&lt; std::endl;    return &quot;raw_data_from_&quot; + filename;&#125;std::string process_data(const std::string&amp; data) &#123;    std::cout &lt;&lt; &quot;Step 2: Processing data&quot; &lt;&lt; std::endl;    return data + &quot;_processed&quot;;&#125;void save_data(const std::string&amp; processed_data) &#123;    std::cout &lt;&lt; &quot;Step 3: Saving processed data&quot; &lt;&lt; std::endl;    std::cout &lt;&lt; &quot;Final data: &quot; &lt;&lt; processed_data &lt;&lt; std::endl;&#125;int main() &#123;    // æ„å»ºå¼‚æ­¥å¤„ç†ç®¡é“    auto final_future = AsyncPipeline::then(        AsyncPipeline::then(            AsyncPipeline::process(&quot;input.txt&quot;, read_data),            process_data        ),        save_data    );        // ç­‰å¾…æ•´ä¸ªç®¡é“å®Œæˆ    final_future.get();        return 0;&#125;\n7.5 å¼‚æ­¥ç¼–ç¨‹çš„æœ€ä½³å®è·µ\n7.5.1 é¿å…å›è°ƒåœ°ç‹±\n// âŒ å›è°ƒåœ°ç‹±ï¼šæ·±å±‚åµŒå¥—çš„å›è°ƒå‡½æ•°void callback_hell() &#123;    async_operation1([](Result1 res1) &#123;        async_operation2(res1, [](Result2 res2) &#123;            async_operation3(res2, [](Result3 res3) &#123;                async_operation4(res3, [](Result4 res4) &#123;                    // æ›´å¤šåµŒå¥—...                &#125;);            &#125;);        &#125;);    &#125;);&#125;// âœ… ä½¿ç”¨futureé¿å…å›è°ƒåœ°ç‹±void using_futures() &#123;    auto future1 = async_operation1();    auto future2 = future1.then([](Result1 res1) &#123;        return async_operation2(res1);    &#125;);    auto future3 = future2.then([](Result2 res2) &#123;        return async_operation3(res2);    &#125;);    auto future4 = future3.then([](Result3 res3) &#123;        return async_operation4(res3);    &#125;);        auto final_result = future4.get();&#125;\n7.5.2 æ­£ç¡®å¤„ç†å¼‚æ­¥å¼‚å¸¸\n#include &lt;iostream&gt;#include &lt;future&gt;#include &lt;stdexcept&gt;#include &lt;chrono&gt;void may_throw(bool should_throw) &#123;    std::this_thread::sleep_for(std::chrono::seconds(1));        if (should_throw) &#123;        throw std::runtime_error(&quot;Something went wrong in async task&quot;);    &#125;        std::cout &lt;&lt; &quot;Async task completed successfully&quot; &lt;&lt; std::endl;&#125;int main() &#123;    try &#123;        // å¯åŠ¨å¯èƒ½æŠ›å‡ºå¼‚å¸¸çš„å¼‚æ­¥ä»»åŠ¡        auto future1 = std::async(std::launch::async, may_throw, true);        auto future2 = std::async(std::launch::async, may_throw, false);                // å¤„ç†å¼‚å¸¸        try &#123;            future1.get();        &#125; catch (const std::exception&amp; e) &#123;            std::cerr &lt;&lt; &quot;Caught exception from first task: &quot; &lt;&lt; e.what() &lt;&lt; std::endl;        &#125;                future2.get();            &#125; catch (const std::exception&amp; e) &#123;        std::cerr &lt;&lt; &quot;Caught unexpected exception: &quot; &lt;&lt; e.what() &lt;&lt; std::endl;    &#125;        return 0;&#125;\n7.5.3 åˆç†è®¾ç½®è¶…æ—¶\n#include &lt;iostream&gt;#include &lt;future&gt;#include &lt;chrono&gt;#include &lt;stdexcept&gt;void long_running_task() &#123;    std::this_thread::sleep_for(std::chrono::seconds(5));    std::cout &lt;&lt; &quot;Long running task completed&quot; &lt;&lt; std::endl;&#125;int main() &#123;    auto future = std::async(std::launch::async, long_running_task);        std::cout &lt;&lt; &quot;Waiting for task with timeout...&quot; &lt;&lt; std::endl;        // è®¾ç½®2ç§’è¶…æ—¶    auto status = future.wait_for(std::chrono::seconds(2));        if (status == std::future_status::ready) &#123;        std::cout &lt;&lt; &quot;Task completed within timeout&quot; &lt;&lt; std::endl;        future.get();    &#125; else if (status == std::future_status::timeout) &#123;        std::cout &lt;&lt; &quot;Task timed out after 2 seconds&quot; &lt;&lt; std::endl;        // æ³¨æ„ï¼šæ— æ³•ç›´æ¥å–æ¶ˆstd::futureä»»åŠ¡    &#125; else if (status == std::future_status::deferred) &#123;        std::cout &lt;&lt; &quot;Task is deferred&quot; &lt;&lt; std::endl;    &#125;        return 0;&#125;\n7.5.4 å¼‚æ­¥ä»»åŠ¡çš„å–æ¶ˆæœºåˆ¶\n#include &lt;iostream&gt;#include &lt;thread&gt;#include &lt;atomic&gt;#include &lt;future&gt;#include &lt;chrono&gt;class CancellableTask &#123;private:    std::atomic&lt;bool&gt; cancelled_;    std::future&lt;void&gt; future_;    public:    template&lt;typename Func&gt;    CancellableTask(Func&amp;&amp; func) &#123;        cancelled_ = false;                future_ = std::async(std::launch::async, [this, func = std::forward&lt;Func&gt;(func)]() &#123;            func([this]() &#123; return cancelled_.load(); &#125;);        &#125;);    &#125;        void cancel() &#123;        cancelled_ = true;    &#125;        void wait() &#123;        if (future_.valid()) &#123;            future_.wait();        &#125;    &#125;        bool is_cancelled() const &#123;        return cancelled_.load();    &#125;&#125;;// å¯å–æ¶ˆçš„ä»»åŠ¡å‡½æ•°void cancellable_operation(const std::function&lt;bool()&gt;&amp; is_cancelled) &#123;    for (int i = 0; i &lt; 10; ++i) &#123;        // æ£€æŸ¥æ˜¯å¦è¢«å–æ¶ˆ        if (is_cancelled()) &#123;            std::cout &lt;&lt; &quot;Task cancelled at iteration &quot; &lt;&lt; i &lt;&lt; std::endl;            return;        &#125;                std::cout &lt;&lt; &quot;Task iteration &quot; &lt;&lt; i &lt;&lt; std::endl;        std::this_thread::sleep_for(std::chrono::seconds(1));    &#125;        std::cout &lt;&lt; &quot;Task completed normally&quot; &lt;&lt; std::endl;&#125;int main() &#123;    std::cout &lt;&lt; &quot;Starting cancellable task...&quot; &lt;&lt; std::endl;        CancellableTask task(cancellable_operation);        // è¿è¡Œ3ç§’åå–æ¶ˆä»»åŠ¡    std::this_thread::sleep_for(std::chrono::seconds(3));    std::cout &lt;&lt; &quot;Cancelling task...&quot; &lt;&lt; std::endl;    task.cancel();        task.wait();        std::cout &lt;&lt; &quot;Main thread exiting&quot; &lt;&lt; std::endl;        return 0;&#125;\n7.6 å¼‚æ­¥ç¼–ç¨‹çš„åº”ç”¨åœºæ™¯\n7.6.1 I/O å¯†é›†å‹åº”ç”¨\n#include &lt;iostream&gt;#include &lt;future&gt;#include &lt;vector&gt;#include &lt;string&gt;#include &lt;chrono&gt;// æ¨¡æ‹Ÿç½‘ç»œè¯·æ±‚std::string fetch_data_from_network(const std::string&amp; url) &#123;    std::cout &lt;&lt; &quot;Fetching data from &quot; &lt;&lt; url &lt;&lt; std::endl;    std::this_thread::sleep_for(std::chrono::milliseconds(500));    return &quot;Data from &quot; + url;&#125;int main() &#123;    std::vector&lt;std::string&gt; urls = &#123;        &quot;http://example.com/api/data1&quot;,        &quot;http://example.com/api/data2&quot;,         &quot;http://example.com/api/data3&quot;,        &quot;http://example.com/api/data4&quot;    &#125;;        std::vector&lt;std::future&lt;std::string&gt;&gt; futures;        auto start_time = std::chrono::high_resolution_clock::now();        // å¼‚æ­¥è·å–æ‰€æœ‰URLæ•°æ®    for (const auto&amp; url : urls) &#123;        futures.emplace_back(            std::async(std::launch::async, fetch_data_from_network, url)        );    &#125;        // å¤„ç†ç»“æœ    std::vector&lt;std::string&gt; results;    for (auto&amp; fut : futures) &#123;        results.push_back(fut.get());    &#125;        auto end_time = std::chrono::high_resolution_clock::now();    auto duration = std::chrono::duration_cast&lt;std::chrono::milliseconds&gt;(        end_time - start_time    );        std::cout &lt;&lt; &quot;All data fetched in &quot; &lt;&lt; duration.count() &lt;&lt; &quot;ms&quot; &lt;&lt; std::endl;        for (const auto&amp; result : results) &#123;        std::cout &lt;&lt; result &lt;&lt; std::endl;    &#125;        return 0;&#125;\n7.6.2 å¹¶è¡Œè®¡ç®—\n#include &lt;iostream&gt;#include &lt;future&gt;#include &lt;vector&gt;#include &lt;numeric&gt;#include &lt;algorithm&gt;// å¹¶è¡Œæ±‚å’Œtemplate&lt;typename Iterator&gt;typename Iterator::value_type parallel_sum(Iterator begin, Iterator end) &#123;    auto distance = std::distance(begin, end);        // å°æ•°æ®é›†ç›´æ¥è®¡ç®—    if (distance &lt;= 1000) &#123;        return std::accumulate(begin, end, 0);    &#125;        auto mid = begin;    std::advance(mid, distance / 2);        // é€’å½’å¹¶è¡Œè®¡ç®—    auto future_left = std::async(std::launch::async, parallel_sum&lt;Iterator&gt;, begin, mid);    auto right_sum = parallel_sum(mid, end);    auto left_sum = future_left.get();        return left_sum + right_sum;&#125;int main() &#123;    std::vector&lt;int&gt; large_data(10000000, 1);        auto start_time = std::chrono::high_resolution_clock::now();        int total = parallel_sum(large_data.begin(), large_data.end());        auto end_time = std::chrono::high_resolution_clock::now();    auto duration = std::chrono::duration_cast&lt;std::chrono::milliseconds&gt;(        end_time - start_time    );        std::cout &lt;&lt; &quot;Total sum: &quot; &lt;&lt; total &lt;&lt; std::endl;    std::cout &lt;&lt; &quot;Time taken: &quot; &lt;&lt; duration.count() &lt;&lt; &quot;ms&quot; &lt;&lt; std::endl;        return 0;&#125;\n7.6.3 å¼‚æ­¥äº‹ä»¶å¤„ç†\n#include &lt;iostream&gt;#include &lt;queue&gt;#include &lt;mutex&gt;#include &lt;condition_variable&gt;#include &lt;thread&gt;#include &lt;functional&gt;#include &lt;chrono&gt;#include &lt;random&gt;class EventDispatcher &#123;private:    std::queue&lt;std::function&lt;void()&gt;&gt; events_;    std::mutex mtx_;    std::condition_variable cv_;    std::thread dispatcher_thread_;    bool running_;    public:    EventDispatcher() : running_(true) &#123;        dispatcher_thread_ = std::thread([this] &#123;            dispatch_loop();        &#125;);    &#125;        ~EventDispatcher() &#123;        stop();        if (dispatcher_thread_.joinable()) &#123;            dispatcher_thread_.join();        &#125;    &#125;        template&lt;typename Func&gt;    void post(Func&amp;&amp; func) &#123;        std::lock_guard&lt;std::mutex&gt; lock(mtx_);        if (running_) &#123;            events_.emplace(std::forward&lt;Func&gt;(func));            cv_.notify_one();        &#125;    &#125;        void stop() &#123;        std::lock_guard&lt;std::mutex&gt; lock(mtx_);        running_ = false;        cv_.notify_one();    &#125;    private:    void dispatch_loop() &#123;        while (running_) &#123;            std::function&lt;void()&gt; event;                        &#123;                std::unique_lock&lt;std::mutex&gt; lock(mtx_);                cv_.wait(lock, [this] &#123;                    return !events_.empty() || !running_;                &#125;);                                if (!running_ &amp;&amp; events_.empty()) &#123;                    break;                &#125;                                if (!events_.empty()) &#123;                    event = std::move(events_.front());                    events_.pop();                &#125;            &#125;                        if (event) &#123;                try &#123;                    event();                &#125; catch (const std::exception&amp; e) &#123;                    std::cerr &lt;&lt; &quot;Event processing error: &quot; &lt;&lt; e.what() &lt;&lt; std::endl;                &#125;            &#125;        &#125;    &#125;&#125;;// äº‹ä»¶æºclass EventSource &#123;private:    EventDispatcher&amp; dispatcher_;    std::thread event_thread_;    std::atomic&lt;bool&gt; running_;    std::mt19937 rng_;    std::uniform_int_distribution&lt;&gt; dist_;    public:    EventSource(EventDispatcher&amp; dispatcher)         : dispatcher_(dispatcher), running_(true), rng_(std::random_device&#123;&#125;()), dist_(100, 1000) &#123;                event_thread_ = std::thread([this] &#123;            generate_events();        &#125;);    &#125;        ~EventSource() &#123;        running_ = false;        if (event_thread_.joinable()) &#123;            event_thread_.join();        &#125;    &#125;    private:    void generate_events() &#123;        int event_id = 0;                while (running_) &#123;            int delay = dist_(rng_);            std::this_thread::sleep_for(std::chrono::milliseconds(delay));                        // å‘å¸ƒäº‹ä»¶            dispatcher_.post([event_id, delay] &#123;                std::cout &lt;&lt; &quot;Processing event &quot; &lt;&lt; event_id                           &lt;&lt; &quot; (generated after &quot; &lt;&lt; delay &lt;&lt; &quot;ms)&quot; &lt;&lt; std::endl;            &#125;);                        event_id++;        &#125;    &#125;&#125;;int main() &#123;    EventDispatcher dispatcher;    EventSource source(dispatcher);        std::cout &lt;&lt; &quot;Event system running. Press Enter to exit...&quot; &lt;&lt; std::endl;    std::cin.get();        return 0;&#125;\n8. å¹¶å‘ç¼–ç¨‹å“²å­¦æ€æƒ³\n8.1 å¹¶å‘ç¼–ç¨‹çš„å“²å­¦åŸºç¡€\n8.1.1 å…±äº«å†…å­˜ vs æ¶ˆæ¯ä¼ é€’\nå…±äº«å†…å­˜æ¨¡å‹ï¼š\n\n\nçº¿ç¨‹é€šè¿‡å…±äº«å†…å­˜è¿›è¡Œé€šä¿¡\n\n\néœ€è¦æ˜¾å¼åŒæ­¥æœºåˆ¶ï¼ˆé”ã€åŸå­æ“ä½œï¼‰\n\n\nC++ æ ‡å‡†é‡‡ç”¨çš„ä¸»è¦æ¨¡å‹\n\n\næ¶ˆæ¯ä¼ é€’æ¨¡å‹ï¼š\n\n\nçº¿ç¨‹é€šè¿‡å‘é€æ¶ˆæ¯è¿›è¡Œé€šä¿¡\n\n\næ•°æ®åœ¨ä¼ é€’è¿‡ç¨‹ä¸­æ‰€æœ‰æƒè½¬ç§»\n\n\nGo è¯­è¨€çš„ goroutine+channel æ˜¯å…¸å‹ä»£è¡¨\n\n\n8.1.2 å¹¶å‘çš„æœ¬è´¨ï¼šæ—¶é—´ä¸ç©ºé—´çš„æƒè¡¡\nå¹¶å‘ç¼–ç¨‹æœ¬è´¨ä¸Šæ˜¯åœ¨æœ‰é™çš„ç‰©ç†èµ„æºï¼ˆCPU æ ¸å¿ƒï¼‰ä¸Šï¼Œé€šè¿‡æ—¶é—´åˆ†ç‰‡æ¥æ¨¡æ‹Ÿå¹¶è¡Œæ‰§è¡Œã€‚\n// æ—¶é—´åˆ†ç‰‡çš„å“²å­¦ä½“ç°void concurrent_tasks() &#123;    // ä»»åŠ¡Aå’Œä»»åŠ¡Båœ¨åŒä¸€ä¸ªCPUæ ¸å¿ƒä¸Šäº¤æ›¿æ‰§è¡Œ    std::thread t1([]&#123;        for (int i = 0; i &lt; 1000; ++i) &#123;            // ä»»åŠ¡Açš„è®¡ç®—            std::this_thread::yield();  // ä¸»åŠ¨è®©å‡ºCPUæ—¶é—´ç‰‡        &#125;    &#125;);        std::thread t2([]&#123;        for (int i = 0; i &lt; 1000; ++i) &#123;            // ä»»åŠ¡Bçš„è®¡ç®—            std::this_thread::yield();        &#125;    &#125;);        t1.join();    t2.join();&#125;\n8.2 å¹¶å‘ç¼–ç¨‹çš„è®¾è®¡å“²å­¦\n8.2.1 æœ€å°åŒæ­¥åŸåˆ™\nåªåœ¨å¿…è¦æ—¶ä½¿ç”¨åŒæ­¥æœºåˆ¶ï¼Œå‡å°‘é”ç«äº‰ã€‚\n// ä¸å¥½çš„è®¾è®¡ï¼šè¿‡åº¦åŒæ­¥class BadDesign &#123;private:    std::mutex mtx;    int a, b, c;    public:    void update_all(int new_a, int new_b, int new_c) &#123;        std::lock_guard&lt;std::mutex&gt; lock(mtx);        a = new_a;        b = new_b;        c = new_c;    &#125;        // å³ä½¿åªéœ€è¦è¯»å–ä¸€ä¸ªå˜é‡ï¼Œä¹Ÿè¦è·å–æ•´ä¸ªå¯¹è±¡çš„é”    int get_a() const &#123;        std::lock_guard&lt;std::mutex&gt; lock(mtx);        return a;    &#125;&#125;;// æ›´å¥½çš„è®¾è®¡ï¼šç»†ç²’åº¦åŒæ­¥class BetterDesign &#123;private:    std::mutex mtx_a, mtx_b, mtx_c;    int a, b, c;    public:    void update_a(int new_a) &#123;        std::lock_guard&lt;std::mutex&gt; lock(mtx_a);        a = new_a;    &#125;        int get_a() const &#123;        std::lock_guard&lt;std::mutex&gt; lock(mtx_a);        return a;    &#125;        // å…¶ä»–æˆå‘˜çš„ç±»ä¼¼æ–¹æ³•...&#125;;\n8.2.2 ä¸å¯å˜æ€§åŸåˆ™\nä½¿ç”¨ä¸å¯å˜å¯¹è±¡å‡å°‘åŒæ­¥éœ€æ±‚ã€‚\n// ä¸å¯å˜å¯¹è±¡ï¼šåˆ›å»ºåçŠ¶æ€ä¸å†æ”¹å˜class ImmutableData &#123;private:    const int value_;    const std::string name_;    public:    ImmutableData(int value, const std::string&amp; name)        : value_(value), name_(name) &#123;&#125;        int get_value() const &#123; return value_; &#125;    std::string get_name() const &#123; return name_; &#125;        // æ²¡æœ‰ä¿®æ”¹çŠ¶æ€çš„æ–¹æ³•&#125;;// ä¸å¯å˜å¯¹è±¡å¯ä»¥å®‰å…¨åœ°åœ¨å¤šä¸ªçº¿ç¨‹é—´å…±äº«void process_data(const ImmutableData&amp; data) &#123;    // è¯»å–æ“ä½œä¸éœ€è¦åŒæ­¥    std::cout &lt;&lt; data.get_name() &lt;&lt; &quot;: &quot; &lt;&lt; data.get_value() &lt;&lt; std::endl;&#125;\n8.2.3 å•ä¸€èŒè´£åŸåˆ™åœ¨å¹¶å‘ä¸­çš„åº”ç”¨\næ¯ä¸ªçº¿ç¨‹åº”è¯¥æœ‰æ˜ç¡®çš„èŒè´£ï¼Œé¿å…åŠŸèƒ½è€¦åˆã€‚\n// èŒè´£åˆ†ç¦»çš„è®¾è®¡class DataProducer &#123;private:    std::queue&lt;int&gt; data_queue_;    std::mutex mtx_;    std::condition_variable cv_;    public:    void produce_data(int data) &#123;        std::lock_guard&lt;std::mutex&gt; lock(mtx_);        data_queue_.push(data);        cv_.notify_one();    &#125;        bool consume_data(int&amp; data) &#123;        std::unique_lock&lt;std::mutex&gt; lock(mtx_);        if (cv_.wait_for(lock, std::chrono::seconds(1),             [this]&#123; return !data_queue_.empty(); &#125;)) &#123;            data = data_queue_.front();            data_queue_.pop();            return true;        &#125;        return false;    &#125;&#125;;// ä¸“é—¨çš„ç”Ÿäº§è€…çº¿ç¨‹void producer_task(DataProducer&amp; producer) &#123;    for (int i = 0; i &lt; 100; ++i) &#123;        producer.produce_data(i);        std::this_thread::sleep_for(std::chrono::milliseconds(10));    &#125;&#125;// ä¸“é—¨çš„æ¶ˆè´¹è€…çº¿ç¨‹void consumer_task(DataProducer&amp; producer) &#123;    int data;    while (producer.consume_data(data)) &#123;        std::cout &lt;&lt; &quot;Consumed: &quot; &lt;&lt; data &lt;&lt; std::endl;    &#125;&#125;\n8.3 å¼‚æ­¥ç¼–ç¨‹çš„å“²å­¦æ·±åŒ–\n8.3.1 å¼‚æ­¥çš„ â€œç­‰å¾…å“²å­¦â€\nå¼‚æ­¥ç¼–ç¨‹é‡æ–°å®šä¹‰äº† â€œç­‰å¾…â€ çš„æ¦‚å¿µï¼š\n// åŒæ­¥ç­‰å¾…ï¼šæ¶ˆæç­‰å¾…ï¼Œæµªè´¹æ—¶é—´void synchronous_waiting() &#123;    auto result = blocking_operation();  // ç­‰å¾…æ—¶ä»€ä¹ˆéƒ½åšä¸äº†    process_result(result);&#125;// å¼‚æ­¥ç­‰å¾…ï¼šç§¯æç­‰å¾…ï¼Œå……åˆ†åˆ©ç”¨æ—¶é—´void asynchronous_waiting() &#123;    auto future = async_operation();        // åœ¨ç­‰å¾…ç»“æœæ—¶åšå…¶ä»–æœ‰æ„ä¹‰çš„äº‹æƒ…    do_other_useful_work();        auto result = future.get();    process_result(result);&#125;\n8.3.2 å¼‚æ­¥çš„ â€œè´£ä»»è½¬ç§»â€ å“²å­¦\nå¼‚æ­¥æ“ä½œä½“ç°äº†è´£ä»»çš„è½¬ç§»å’Œå§”æ‰˜ï¼š\n// åŒæ­¥æ¨¡å¼ï¼šè°ƒç”¨è€…æ‰¿æ‹…æ‰€æœ‰è´£ä»»Result synchronous_mode() &#123;    // è°ƒç”¨è€…å¿…é¡»ç­‰å¾…å¹¶å¤„ç†æ‰€æœ‰ç»†èŠ‚    return perform_complex_operation();&#125;// å¼‚æ­¥æ¨¡å¼ï¼šè´£ä»»è½¬ç§»ç»™ç³»ç»Ÿstd::future&lt;Result&gt; asynchronous_mode() &#123;    // ç³»ç»Ÿæ‰¿æ‹…æ‰§è¡Œå’Œé€šçŸ¥çš„è´£ä»»    return std::async(perform_complex_operation);&#125;\n8.3.3 å¼‚æ­¥çš„ â€œäº‹ä»¶é©±åŠ¨â€ å“²å­¦\nå¼‚æ­¥ç¼–ç¨‹åŸºäºäº‹ä»¶é©±åŠ¨çš„ä¸–ç•Œè§‚ï¼š\n// äº‹ä»¶é©±åŠ¨çš„æ€ç»´æ¨¡å¼class EventDrivenSystem &#123;private:    EventDispatcher dispatcher_;    public:    void initialize() &#123;        // æ³¨å†Œäº‹ä»¶å¤„ç†å™¨        dispatcher_.register_handler&lt;DataReceivedEvent&gt;(            [this](const DataReceivedEvent&amp; event) &#123;                this-&gt;handle_data(event.data);            &#125;        );                dispatcher_.register_handler&lt;TimeoutEvent&gt;(            [this](const TimeoutEvent&amp; event) &#123;                this-&gt;handle_timeout(event.timeout);            &#125;        );    &#125;        void start() &#123;        // å¯åŠ¨äº‹ä»¶å¾ªç¯        dispatcher_.run();    &#125;    private:    void handle_data(const std::string&amp; data) &#123;        // å¤„ç†æ”¶åˆ°çš„æ•°æ®        auto processed = process_data(data);                // è§¦å‘æ–°äº‹ä»¶        dispatcher_.post_event(DataProcessedEvent&#123;processed&#125;);    &#125;        void handle_timeout(int timeout) &#123;        // å¤„ç†è¶…æ—¶äº‹ä»¶        dispatcher_.post_event(TimeoutHandledEvent&#123;timeout&#125;);    &#125;&#125;;\n8.4 å¹¶å‘ç¼–ç¨‹çš„æ€§èƒ½å“²å­¦\n8.4.1 Amdahl å®šå¾‹ï¼šä¸²è¡Œéƒ¨åˆ†çš„é™åˆ¶\nAmdahl å®šå¾‹æŒ‡å‡ºï¼Œç¨‹åºçš„åŠ é€Ÿæ¯”å—é™äºä¸²è¡Œæ‰§è¡Œéƒ¨åˆ†çš„æ¯”ä¾‹ã€‚\n// å‡è®¾ç¨‹åºæœ‰80%çš„å¹¶è¡Œéƒ¨åˆ†å’Œ20%çš„ä¸²è¡Œéƒ¨åˆ†void parallelizable_task() &#123;    // 80%çš„è®¡ç®—å¯ä»¥å¹¶è¡Œæ‰§è¡Œ    std::vector&lt;std::thread&gt; threads;    for (int i = 0; i &lt; 4; ++i) &#123;        threads.emplace_back([]&#123;            // å¹¶è¡Œè®¡ç®—        &#125;);    &#125;        for (auto&amp; t : threads) &#123;        t.join();    &#125;&#125;void serial_task() &#123;    // 20%çš„è®¡ç®—å¿…é¡»ä¸²è¡Œæ‰§è¡Œ&#125;void main_task() &#123;    serial_task();          // ä¸²è¡Œéƒ¨åˆ†ï¼ˆ20%ï¼‰    parallelizable_task();  // å¹¶è¡Œéƒ¨åˆ†ï¼ˆ80%ï¼‰&#125;\n8.4.2 Gustafson å®šå¾‹ï¼šé—®é¢˜è§„æ¨¡çš„å½±å“\nGustafson å®šå¾‹è¡¨æ˜ï¼Œéšç€é—®é¢˜è§„æ¨¡çš„å¢åŠ ï¼Œå¹¶è¡Œè®¡ç®—çš„æ”¶ç›Šä¹Ÿä¼šå¢åŠ ã€‚\n// å¤„ç†æ›´å¤§è§„æ¨¡çš„æ•°æ®æ—¶ï¼Œå¹¶è¡Œçš„ä¼˜åŠ¿æ›´æ˜æ˜¾template&lt;typename T&gt;void process_large_data(const std::vector&lt;T&gt;&amp; data) &#123;    const size_t num_threads = std::thread::hardware_concurrency();    const size_t chunk_size = data.size() / num_threads;        std::vector&lt;std::thread&gt; threads;        for (size_t i = 0; i &lt; num_threads; ++i) &#123;        size_t start = i * chunk_size;        size_t end = (i == num_threads - 1) ? data.size() : (i + 1) * chunk_size;                threads.emplace_back([start, end, &amp;data]&#123;            for (size_t j = start; j &lt; end; ++j) &#123;                // å¤„ç†å•ä¸ªæ•°æ®å…ƒç´                 process_element(data[j]);            &#125;        &#125;);    &#125;        for (auto&amp; t : threads) &#123;        t.join();    &#125;&#125;\n9. æœ€ä½³å®è·µä¸è®¾è®¡åŸåˆ™\n9.1 çº¿ç¨‹å®‰å…¨è®¾è®¡åŸåˆ™\n9.1.1 ä¼˜å…ˆä½¿ç”¨é«˜å±‚æŠ½è±¡\n// ä¸å¥½çš„åšæ³•ï¼šæ‰‹åŠ¨ç®¡ç†çº¿ç¨‹å’Œå…±äº«æ•°æ®void bad_example() &#123;    int result = 0;    std::mutex mtx;        std::thread t([&amp;]&#123;        std::lock_guard&lt;std::mutex&gt; lock(mtx);        result = expensive_calculation();    &#125;);        t.join();    std::cout &lt;&lt; result &lt;&lt; std::endl;&#125;// å¥½çš„åšæ³•ï¼šä½¿ç”¨std::asyncvoid good_example() &#123;    auto future = std::async(std::launch::async, expensive_calculation);    std::cout &lt;&lt; future.get() &lt;&lt; std::endl;&#125;\n9.1.2 å§‹ç»ˆä½¿ç”¨ RAII ç®¡ç†èµ„æº\n// ä¸å¥½çš„åšæ³•ï¼šæ‰‹åŠ¨ç®¡ç†é”void bad_lock_management() &#123;    std::mutex mtx;    mtx.lock();        try &#123;        // å¯èƒ½æŠ›å‡ºå¼‚å¸¸çš„æ“ä½œ        risky_operation();        mtx.unlock();    &#125; catch (...) &#123;        mtx.unlock();        throw;    &#125;&#125;// å¥½çš„åšæ³•ï¼šä½¿ç”¨RAIIé”void good_lock_management() &#123;    std::mutex mtx;    std::lock_guard&lt;std::mutex&gt; lock(mtx);        // å³ä½¿æŠ›å‡ºå¼‚å¸¸ï¼Œé”ä¹Ÿä¼šè‡ªåŠ¨é‡Šæ”¾    risky_operation();&#125;\n9.1.3 é¿å…å…±äº«å¯å˜çŠ¶æ€\n// ä¸å¥½çš„åšæ³•ï¼šå…±äº«å¯å˜çŠ¶æ€class SharedState &#123;private:    std::mutex mtx;    int state_;    public:    void update_state(int new_state) &#123;        std::lock_guard&lt;std::mutex&gt; lock(mtx);        state_ = new_state;    &#125;&#125;;// å¥½çš„åšæ³•ï¼šä½¿ç”¨æ¶ˆæ¯ä¼ é€’class MessagePassing &#123;private:    std::queue&lt;int&gt; messages_;    std::mutex mtx_;    std::condition_variable cv_;    public:    void send_message(int message) &#123;        std::lock_guard&lt;std::mutex&gt; lock(mtx_);        messages_.push(message);        cv_.notify_one();    &#125;        int receive_message() &#123;        std::unique_lock&lt;std::mutex&gt; lock(mtx_);        cv_.wait(lock, [this]&#123; return !messages_.empty(); &#125;);                int message = messages_.front();        messages_.pop();        return message;    &#125;&#125;;\n9.2 å¼‚æ­¥ç¼–ç¨‹æœ€ä½³å®è·µ\n9.2.1 é€‰æ‹©åˆé€‚çš„å¼‚æ­¥æ¨¡å‹\n// æ ¹æ®åœºæ™¯é€‰æ‹©ä¸åŒçš„å¼‚æ­¥æ¨¡å‹// 1. ç®€å•çš„å¼‚æ­¥è®¡ç®—ï¼šä½¿ç”¨std::asyncauto async_result = std::async(std::launch::async, []&#123;    return expensive_calculation();&#125;);// 2. éœ€è¦ä¸»åŠ¨è®¾ç½®ç»“æœï¼šä½¿ç”¨std::promisestd::promise&lt;int&gt; prom;std::future&lt;int&gt; fut = prom.get_future();std::thread([&amp;prom]&#123;    prom.set_value(calculate_result());&#125;).detach();// 3. å¤æ‚çš„å¼‚æ­¥å·¥ä½œæµï¼šä½¿ç”¨äº‹ä»¶å¾ªç¯EventLoop loop;loop.post([]&#123;    // å¼‚æ­¥ä»»åŠ¡&#125;);\n9.2.2 æ­£ç¡®å¤„ç†å¼‚æ­¥é”™è¯¯\n// å¼‚æ­¥æ“ä½œä¸­çš„å¼‚å¸¸å¤„ç†void async_with_exception_handling() &#123;    try &#123;        auto future = std::async(std::launch::async, []&#123;            try &#123;                // å¯èƒ½æŠ›å‡ºå¼‚å¸¸çš„æ“ä½œ                return risky_operation();            &#125; catch (...) &#123;                // åœ¨å¼‚æ­¥ä»»åŠ¡ä¸­å¤„ç†æˆ–é‡æ–°æŠ›å‡º                std::throw_with_nested(std::runtime_error(&quot;Async operation failed&quot;));            &#125;        &#125;);                auto result = future.get();    &#125; catch (const std::exception&amp; e) &#123;        std::cerr &lt;&lt; &quot;Async error: &quot; &lt;&lt; e.what() &lt;&lt; std::endl;    &#125;&#125;\n9.2.3 é¿å…è¿‡åº¦å¼‚æ­¥åŒ–\n// ä¸æ˜¯æ‰€æœ‰æ“ä½œéƒ½éœ€è¦å¼‚æ­¥åŒ–// é€‚åˆå¼‚æ­¥çš„åœºæ™¯ï¼šI/Oå¯†é›†å‹æ“ä½œauto io_future = std::async(std::launch::async, []&#123;    return read_large_file();  // I/Oæ“ä½œï¼Œé€‚åˆå¼‚æ­¥&#125;);// ä¸é€‚åˆå¼‚æ­¥çš„åœºæ™¯ï¼šç®€å•è®¡ç®—int simple_calc = add_numbers(1, 2);  // ç›´æ¥åŒæ­¥è°ƒç”¨æ›´é«˜æ•ˆ// æƒè¡¡å¼‚æ­¥çš„å¼€é”€if (operation_is_io_bound() &amp;&amp; operation_will_take_long_time()) &#123;    use_async();&#125; else &#123;    use_sync();&#125;\n9.3 æ€§èƒ½ä¼˜åŒ–åŸåˆ™\n9.3.1 å‡å°‘é”ç«äº‰\n// é«˜ç«äº‰åœºæ™¯çš„ä¼˜åŒ–class HighContentionData &#123;private:    std::vector&lt;std::mutex&gt; mutexes_;    std::vector&lt;int&gt; data_;    size_t num_shards_;    public:    HighContentionData(size_t size, size_t num_shards)        : num_shards_(num_shards), mutexes_(num_shards), data_(size) &#123;&#125;        void update(size_t index, int value) &#123;        size_t shard = index % num_shards_;        std::lock_guard&lt;std::mutex&gt; lock(mutexes_[shard]);        data_[index] = value;    &#125;        int get(size_t index) const &#123;        size_t shard = index % num_shards_;        std::lock_guard&lt;std::mutex&gt; lock(mutexes_[shard]);        return data_[index];    &#125;&#125;;\n9.3.2 ä½¿ç”¨æ— é”æ•°æ®ç»“æ„\n// å½“é€‚ç”¨æ—¶ï¼Œæ— é”ç»“æ„å¯ä»¥æä¾›æ›´å¥½çš„æ€§èƒ½#include &lt;atomic&gt;class LockFreeCounter &#123;private:    std::atomic&lt;int&gt; count_;    public:    LockFreeCounter() : count_(0) &#123;&#125;        void increment() &#123;        count_.fetch_add(1, std::memory_order_relaxed);    &#125;        int get_count() const &#123;        return count_.load(std::memory_order_relaxed);    &#125;&#125;;\n9.3.3 åˆç†ä½¿ç”¨çº¿ç¨‹å±€éƒ¨å­˜å‚¨\n// çº¿ç¨‹å±€éƒ¨å­˜å‚¨å¯ä»¥é¿å…å…±äº«æ•°æ®thread_local int thread_specific_data = 0;void thread_function(int id) &#123;    thread_specific_data = id;    // æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±çš„å‰¯æœ¬    std::cout &lt;&lt; &quot;Thread &quot; &lt;&lt; id &lt;&lt; &quot; has data: &quot; &lt;&lt; thread_specific_data &lt;&lt; std::endl;&#125;int main() &#123;    std::thread t1(thread_function, 1);    std::thread t2(thread_function, 2);        t1.join();    t2.join();        return 0;&#125;\n9.4 é”™è¯¯å¤„ç†åŸåˆ™\n9.4.1 çº¿ç¨‹å†…å¼‚å¸¸å¤„ç†\nvoid thread_with_exception_handling() &#123;    try &#123;        // å¯èƒ½æŠ›å‡ºå¼‚å¸¸çš„æ“ä½œ        risky_operation();    &#125; catch (const std::exception&amp; e) &#123;        std::cerr &lt;&lt; &quot;Thread caught exception: &quot; &lt;&lt; e.what() &lt;&lt; std::endl;        // é€‚å½“çš„æ¸…ç†å’Œé”™è¯¯å¤„ç†    &#125; catch (...) &#123;        std::cerr &lt;&lt; &quot;Thread caught unknown exception&quot; &lt;&lt; std::endl;    &#125;&#125;int main() &#123;    std::thread t(thread_with_exception_handling);    t.join();    return 0;&#125;\n9.4.2 ä¼˜é›…çš„çº¿ç¨‹ç»ˆæ­¢\nclass GracefulShutdown &#123;private:    std::atomic&lt;bool&gt; stop_flag_;    std::thread worker_thread_;    public:    GracefulShutdown() : stop_flag_(false) &#123;        worker_thread_ = std::thread([this]&#123;            while (!stop_flag_.load(std::memory_order_acquire)) &#123;                // æ‰§è¡Œå·¥ä½œ                do_work();                std::this_thread::sleep_for(std::chrono::milliseconds(100));            &#125;            std::cout &lt;&lt; &quot;Thread shutting down gracefully&quot; &lt;&lt; std::endl;        &#125;);    &#125;        ~GracefulShutdown() &#123;        stop_flag_.store(true, std::memory_order_release);        if (worker_thread_.joinable()) &#123;            worker_thread_.join();        &#125;    &#125;    private:    void do_work() &#123;        // å®é™…çš„å·¥ä½œå†…å®¹    &#125;&#125;;\n10. å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ\n10.1 æ­»é”é—®é¢˜\n10.1.1 æ­»é”çš„äº§ç”Ÿæ¡ä»¶\n\n\näº’æ–¥æ¡ä»¶ï¼šèµ„æºåªèƒ½è¢«ä¸€ä¸ªçº¿ç¨‹æŒæœ‰\n\n\næŒæœ‰å¹¶ç­‰å¾…ï¼šçº¿ç¨‹æŒæœ‰èµ„æºå¹¶ç­‰å¾…å…¶ä»–èµ„æº\n\n\nä¸å¯å‰¥å¤ºï¼šèµ„æºä¸èƒ½è¢«å¼ºåˆ¶å‰¥å¤º\n\n\nå¾ªç¯ç­‰å¾…ï¼šçº¿ç¨‹é—´å½¢æˆç­‰å¾…å¾ªç¯\n\n\n10.1.2 æ­»é”æ£€æµ‹ä¸é¿å…\n// æ­»é”ç¤ºä¾‹std::mutex mutex1, mutex2;void deadlock_example1() &#123;    std::lock_guard&lt;std::mutex&gt; lock1(mutex1);    std::this_thread::sleep_for(std::chrono::milliseconds(10));    std::lock_guard&lt;std::mutex&gt; lock2(mutex2);  // å¯èƒ½æ­»é”&#125;void deadlock_example2() &#123;    std::lock_guard&lt;std::mutex&gt; lock2(mutex2);    std::this_thread::sleep_for(std::chrono::milliseconds(10));    std::lock_guard&lt;std::mutex&gt; lock1(mutex1);  // å¯èƒ½æ­»é”&#125;// æ­»é”è§£å†³æ–¹æ¡ˆï¼šç»Ÿä¸€é”è·å–é¡ºåºvoid deadlock_solution1() &#123;    std::lock(mutex1, mutex2);    std::lock_guard&lt;std::mutex&gt; lock1(mutex1, std::adopt_lock);    std::lock_guard&lt;std::mutex&gt; lock2(mutex2, std::adopt_lock);&#125;// æ­»é”è§£å†³æ–¹æ¡ˆï¼šä½¿ç”¨try_lockvoid deadlock_solution2() &#123;    while (true) &#123;        if (mutex1.try_lock()) &#123;            if (mutex2.try_lock()) &#123;                // æˆåŠŸè·å–ä¸¤ä¸ªé”                std::lock_guard&lt;std::mutex&gt; lock1(mutex1, std::adopt_lock);                std::lock_guard&lt;std::mutex&gt; lock2(mutex2, std::adopt_lock);                break;            &#125; else &#123;                mutex1.unlock();                std::this_thread::sleep_for(std::chrono::milliseconds(10));            &#125;        &#125; else &#123;            std::this_thread::sleep_for(std::chrono::milliseconds(10));        &#125;    &#125;&#125;\n10.2 æ•°æ®ç«äº‰é—®é¢˜\n10.2.1 æ•°æ®ç«äº‰çš„æ£€æµ‹\n// æ•°æ®ç«äº‰ç¤ºä¾‹int shared_data = 0;voidç«äº‰_condition() &#123;    for (int i = 0; i &lt; 100000; ++i) &#123;        shared_data++;  // æ•°æ®ç«äº‰ï¼    &#125;&#125;// è§£å†³æ–¹æ¡ˆï¼šä½¿ç”¨åŸå­æ“ä½œstd::atomic&lt;int&gt; atomic_data(0);void no_race_condition() &#123;    for (int i = 0; i &lt; 100000; ++i) &#123;        atomic_data++;  // åŸå­æ“ä½œï¼Œæ— æ•°æ®ç«äº‰    &#125;&#125;\n10.3 å¼‚æ­¥ç¼–ç¨‹å¸¸è§é—®é¢˜\n10.3.1 å¼‚æ­¥ä»»åŠ¡çš„å–æ¶ˆé—®é¢˜\n// std::futureä¸æ”¯æŒç›´æ¥å–æ¶ˆï¼Œéœ€è¦è‡ªå·±å®ç°class CancellableFuture &#123;private:    std::future&lt;void&gt; future_;    std::atomic&lt;bool&gt;&amp; cancelled_;    public:    CancellableFuture(std::future&lt;void&gt;&amp;&amp; future, std::atomic&lt;bool&gt;&amp; cancelled)        : future_(std::move(future)), cancelled_(cancelled) &#123;&#125;        bool wait_for(const std::chrono::milliseconds&amp; timeout) &#123;        auto status = future_.wait_for(timeout);                if (status == std::future_status::ready) &#123;            return true;        &#125; else if (cancelled_.load()) &#123;            return false;        &#125;                return status == std::future_status::ready;    &#125;&#125;;\n10.3.2 å¼‚æ­¥ç»“æœçš„ç”Ÿå‘½å‘¨æœŸç®¡ç†\n// ç¡®ä¿å¼‚æ­¥ç»“æœçš„æ­£ç¡®ç”Ÿå‘½å‘¨æœŸç®¡ç†class AsyncResultManager &#123;private:    std::vector&lt;std::future&lt;void&gt;&gt; active_futures_;    std::mutex mtx_;    public:    template&lt;typename Func&gt;    void start_async_task(Func&amp;&amp; func) &#123;        std::lock_guard&lt;std::mutex&gt; lock(mtx_);                auto future = std::async(std::launch::async, [this, func = std::forward&lt;Func&gt;(func)]() &#123;            func();            cleanup_completed_tasks();        &#125;);                active_futures_.emplace_back(std::move(future));    &#125;    private:    void cleanup_completed_tasks() &#123;        std::lock_guard&lt;std::mutex&gt; lock(mtx_);                active_futures_.erase(            std::remove_if(active_futures_.begin(), active_futures_.end(),                [](auto&amp; future) &#123;                    return future.wait_for(std::chrono::seconds(0)) == std::future_status::ready;                &#125;),            active_futures_.end()        );    &#125;&#125;;\n10.4 è°ƒè¯•æŠ€å·§\n10.4.1 çº¿ç¨‹å®‰å…¨çš„è°ƒè¯•å®\n#ifdef DEBUG#define LOCK_GUARD(mutex) \\    std::lock_guard&lt;std::mutex&gt; lock(mutex); \\    std::cout &lt;&lt; &quot;Thread &quot; &lt;&lt; std::this_thread::get_id() &lt;&lt; &quot; locked &quot; &lt;&lt; #mutex &lt;&lt; &quot; at &quot; &lt;&lt; __FILE__ &lt;&lt; &quot;:&quot; &lt;&lt; __LINE__ &lt;&lt; std::endl;#else#define LOCK_GUARD(mutex) \\    std::lock_guard&lt;std::mutex&gt; lock(mutex);#endifclass DebuggableData &#123;private:    std::mutex mtx_;    int data_;    public:    void update(int value) &#123;        LOCK_GUARD(mtx_);        data_ = value;    &#125;&#125;;\n10.4.2 å¼‚æ­¥æ“ä½œçš„è°ƒè¯•\n// å¼‚æ­¥æ“ä½œçš„è°ƒè¯•è¾…åŠ©class AsyncDebugger &#123;public:    template&lt;typename T&gt;    static std::future&lt;T&gt; debug_future(std::future&lt;T&gt;&amp;&amp; future, const std::string&amp; name) &#123;        return std::async(std::launch::async, [future = std::move(future), name]() mutable &#123;            std::cout &lt;&lt; &quot;Waiting for future: &quot; &lt;&lt; name &lt;&lt; std::endl;                        try &#123;                auto result = future.get();                std::cout &lt;&lt; &quot;Future completed: &quot; &lt;&lt; name &lt;&lt; std::endl;                return result;            &#125; catch (const std::exception&amp; e) &#123;                std::cerr &lt;&lt; &quot;Future failed: &quot; &lt;&lt; name &lt;&lt; &quot; - &quot; &lt;&lt; e.what() &lt;&lt; std::endl;                throw;            &#125;        &#125;);    &#125;&#125;;\næ€»ç»“\nC++ å¹¶å‘ç¼–ç¨‹æ˜¯ä¸€ä¸ªå¤æ‚è€Œå¼ºå¤§çš„é¢†åŸŸï¼Œéœ€è¦å¼€å‘è€…åŒæ—¶æŒæ¡ï¼š\næŠ€æœ¯å±‚é¢\n\n\nçº¿ç¨‹ç®¡ç†ï¼šstd::thread çš„åˆ›å»ºã€é”€æ¯å’ŒåŒæ­¥\n\n\nåŒæ­¥æœºåˆ¶ï¼šmutexã€condition_variable çš„æ­£ç¡®ä½¿ç”¨\n\n\nå¼‚æ­¥ç¼–ç¨‹ï¼šfutureã€promiseã€async çš„çµæ´»åº”ç”¨\n\n\nå†…å­˜æ¨¡å‹ï¼šåŸå­æ“ä½œå’Œå†…å­˜é¡ºåºçš„ç†è§£\n\n\nè®¾è®¡æ¨¡å¼ï¼šå„ç§å¹¶å‘å’Œå¼‚æ­¥è®¾è®¡æ¨¡å¼çš„åº”ç”¨\n\n\nå“²å­¦æ€æƒ³å±‚é¢\n\n\nå¹¶å‘æœ¬è´¨ï¼šæ—¶é—´åˆ†ç‰‡ä¸ç©ºé—´å…±äº«çš„æƒè¡¡\n\n\nå¼‚æ­¥å“²å­¦ï¼šé‡æ–°å®šä¹‰ç­‰å¾…ï¼Œæœ€å¤§åŒ–èµ„æºåˆ©ç”¨\n\n\nè®¾è®¡åŸåˆ™ï¼šæœ€å°åŒæ­¥ã€ä¸å¯å˜æ€§ã€å•ä¸€èŒè´£\n\n\næ€§èƒ½æƒè¡¡ï¼šåœ¨æ­£ç¡®æ€§å’Œæ€§èƒ½ä¹‹é—´æ‰¾åˆ°å¹³è¡¡ç‚¹\n\n\næœ€ä½³å®è·µ\n\n\nå§‹ç»ˆä½¿ç”¨ RAII ç®¡ç†èµ„æº\n\n\nä¼˜å…ˆé€‰æ‹©é«˜å±‚æŠ½è±¡\n\n\né¿å…å…±äº«å¯å˜çŠ¶æ€\n\n\nåˆç†å¤„ç†å¼‚å¸¸å’Œé”™è¯¯\n\n\né‡è§†æµ‹è¯•å’Œè°ƒè¯•\n\n\næŒæ¡è¿™äº›çŸ¥è¯†å’Œæ€æƒ³ï¼Œèƒ½å¤Ÿå¸®åŠ©å¼€å‘è€…ç¼–å†™å‡ºå®‰å…¨ã€é«˜æ•ˆã€å¯ç»´æŠ¤çš„å¹¶å‘ C++ ç¨‹åºã€‚å¹¶å‘ç¼–ç¨‹ä¸ä»…æ˜¯æŠ€æœ¯é—®é¢˜ï¼Œæ›´æ˜¯ä¸€ç§æ€ç»´æ–¹å¼å’Œè®¾è®¡å“²å­¦çš„ä½“ç°ã€‚\nDate: October 17, 2025\nCode: https://github.com/cplusplus-concurrency\n","categories":["ç¼–ç¨‹"],"tags":["C++"]},{"title":"C++çº¿ç¨‹ é”","url":"/2025/05/07/C++/C++%20%E9%94%81/","content":"\nå…³äºC++ä¸­çº¿ç¨‹å’Œé”çš„ä»‹ç»\n\n\nä¸€ã€çº¿ç¨‹ç±»å‹ï¼ˆC++æ ‡å‡†åº“ï¼‰\nC++æ ‡å‡†åº“æä¾›åŸºç¡€çº¿ç¨‹ç±»å‹ï¼Œç”¨äºåˆ›å»ºå’Œç®¡ç†å¹¶å‘æ‰§è¡Œå•å…ƒï¼š\n1. `std::threadï¼ˆC++11ï¼‰\n\n\næ ¸å¿ƒåŠŸèƒ½ï¼šåˆ›å»ºç‹¬ç«‹çº¿ç¨‹ï¼Œæ‰§è¡Œå¯è°ƒç”¨å¯¹è±¡ï¼ˆå‡½æ•°ã€lambdaã€å‡½æ•°å¯¹è±¡ç­‰ï¼‰\n\n\nå…³é”®ç‰¹æ€§ï¼š\n\nä¸å¯å¤åˆ¶ï¼Œä»…å¯ç§»åŠ¨ï¼ˆçº¿ç¨‹æ‰€æœ‰æƒå”¯ä¸€ï¼‰\nå¿…é¡»æ˜¾å¼è°ƒç”¨join()ï¼ˆç­‰å¾…çº¿ç¨‹ç»“æŸï¼‰æˆ–detach()ï¼ˆåˆ†ç¦»çº¿ç¨‹ï¼‰ï¼Œå¦åˆ™ææ„æ—¶è§¦å‘std::terminate()\næ— å†…ç½®å–æ¶ˆæœºåˆ¶ï¼Œéœ€æ‰‹åŠ¨å®ç°çº¿ç¨‹é€€å‡ºé€»è¾‘\n\n\n\nç¤ºä¾‹ï¼š\n#include &lt;thread&gt;void task(int param) &#123; /* çº¿ç¨‹ä»»åŠ¡ */ &#125;int main() &#123;    std::thread t1(task, 42);  // ä¼ é€’å‚æ•°    std::thread t2([]&#123; /* lambdaä»»åŠ¡ */ &#125;);        t1.join();  // ç­‰å¾…t1å®Œæˆ    t2.detach();  // t2åå°è¿è¡Œï¼Œè„±ç¦»ä¸»çº¿ç¨‹æ§åˆ¶    return 0;&#125;\n\n\n2. std::jthreadï¼ˆC++20ï¼‰\n\n\næ ¸å¿ƒåŠŸèƒ½ï¼šstd::threadçš„å¢å¼ºç‰ˆï¼Œè‡ªå¸¦RAIIç‰¹æ€§\n\n\nå…³é”®ç‰¹æ€§ï¼š\n\nææ„æ—¶è‡ªåŠ¨è°ƒç”¨join()ï¼Œæ— éœ€æ‰‹åŠ¨ç®¡ç†ï¼Œé¿å…èµ„æºæ³„æ¼\næ”¯æŒé€šè¿‡std::stop_tokenå’Œstd::stop_sourceå®ç°çº¿ç¨‹å–æ¶ˆ\nå…¼å®¹std::threadçš„æ‰€æœ‰æ“ä½œï¼Œå¯æ— ç¼æ›¿æ¢\n\n\n\nç¤ºä¾‹ï¼š\n#include &lt;thread&gt;void cancelable_task(std::stop_token st) &#123;    while (!st.stop_requested()) &#123;  // æ£€æŸ¥å–æ¶ˆè¯·æ±‚        /* å¾ªç¯ä»»åŠ¡ */    &#125;&#125;int main() &#123;    std::jthread t(cancelable_task);  // è‡ªåŠ¨join    // ... å…¶ä»–æ“ä½œ ...    t.request_stop();  // è¯·æ±‚çº¿ç¨‹åœæ­¢    return 0;  // tææ„æ—¶è‡ªåŠ¨join&#125;\n\n\n\nè¯´æ˜ï¼šC++æ ‡å‡†ä¸­æ— shared_threadå’Œtimed_threadï¼Œçº¿ç¨‹çš„å…±äº«æ€§é€šè¿‡åŒæ­¥æœºåˆ¶å®ç°ï¼Œè¶…æ—¶æ§åˆ¶é€šè¿‡æ¡ä»¶å˜é‡æˆ–å¸¦è¶…æ—¶çš„é”æ“ä½œå®ç°ã€‚\n\näºŒã€äº’æ–¥é”ä¸RAIIå°è£…\näº’æ–¥é”ç”¨äºä¿æŠ¤å…±äº«èµ„æºï¼ŒRAIIï¼ˆèµ„æºè·å–å³åˆå§‹åŒ–ï¼‰å°è£…ç¡®ä¿é”çš„å®‰å…¨ç®¡ç†ï¼š\n1. åŸºç¡€äº’æ–¥é”ç±»å‹\n\n\n\nç±»å‹\nç‰¹æ€§\né€‚ç”¨åœºæ™¯\n\n\n\n\nstd::mutex\nç‹¬å æ‰€æœ‰æƒï¼Œéé€’å½’\nåŸºæœ¬äº’æ–¥åœºæ™¯\n\n\nstd::recursive_mutex\nå…è®¸åŒä¸€çº¿ç¨‹å¤šæ¬¡é”å®šï¼Œéœ€å¯¹åº”æ¬¡æ•°è§£é”\né€’å½’è°ƒç”¨åœºæ™¯ï¼ˆè°¨æ…ä½¿ç”¨ï¼Œæ˜“éšè—è®¾è®¡é—®é¢˜ï¼‰\n\n\nstd::shared_mutexï¼ˆC++17ï¼‰\næ”¯æŒå…±äº«é”ï¼ˆè¯»ï¼‰å’Œç‹¬å é”ï¼ˆå†™ï¼‰\nè¯»å¤šå†™å°‘åœºæ™¯ï¼ˆå¦‚ç¼“å­˜ã€é…ç½®è¯»å–ï¼‰\n\n\nstd::timed_mutex\næ”¯æŒè¶…æ—¶é”å®š\néœ€è¦è¶…æ—¶æ§åˆ¶çš„ç‹¬å åœºæ™¯\n\n\nstd::recursive_timed_mutex\né€’å½’+è¶…æ—¶é”å®š\né€’å½’è°ƒç”¨ä¸”éœ€è¶…æ—¶æ§åˆ¶\n\n\n\n2. RAIIé”å°è£…ç±»ï¼ˆæ ¸å¿ƒå·¥å…·ï¼‰\né€šè¿‡RAIIæœºåˆ¶è‡ªåŠ¨ç®¡ç†é”çš„ç”Ÿå‘½å‘¨æœŸï¼Œé¿å…æ‰‹åŠ¨lock()/unlock()å¯¼è‡´çš„æ­»é”ã€‚\nï¼ˆ1ï¼‰std::lock_guardï¼ˆC++11ï¼‰\n\n\nç‰¹æ€§ï¼šæ„é€ æ—¶é”å®šï¼Œææ„æ—¶è§£é”ï¼Œè¡Œä¸ºä¸å¯å˜\n\n\nä¼˜åŠ¿ï¼šè½»é‡ã€é«˜æ•ˆï¼Œæ— é¢å¤–å¼€é”€\n\n\né™åˆ¶ï¼šä¸å¯æ‰‹åŠ¨è§£é”ã€ä¸å¯è½¬ç§»æ‰€æœ‰æƒã€ä¸æ”¯æŒå»¶è¿Ÿé”å®š\n\n\nç¤ºä¾‹ï¼š\n#include &lt;mutex&gt;std::mutex mtx;int shared_value = 0;void safe_increment() &#123;    std::lock_guard&lt;std::mutex&gt; lock(mtx);  // è‡ªåŠ¨é”å®š    shared_value++;  // ä¸´ç•ŒåŒºæ“ä½œ&#125;  // è‡ªåŠ¨è§£é”ï¼Œå³ä½¿å‘ç”Ÿå¼‚å¸¸\n\n\nï¼ˆ2ï¼‰std::unique_lockï¼ˆC++11ï¼‰\n\n\nç‰¹æ€§ï¼šçµæ´»æ§åˆ¶é”çŠ¶æ€ï¼Œæ”¯æŒæ‰‹åŠ¨é”å®š/è§£é”ã€å»¶è¿Ÿé”å®šã€è¶…æ—¶é”å®š\n\n\nä¼˜åŠ¿ï¼šåŠŸèƒ½å…¨é¢ï¼Œå¯é…åˆæ¡ä»¶å˜é‡ä½¿ç”¨\n\n\nå¼€é”€ï¼šç•¥é«˜äºlock_guardï¼ˆå› éœ€ç»´æŠ¤é”çŠ¶æ€ï¼‰\n\n\nç¤ºä¾‹ï¼š\nvoid flexible_operation() &#123;    std::unique_lock&lt;std::mutex&gt; lock(mtx, std::defer_lock);  // å»¶è¿Ÿé”å®š        // é¢„å¤„ç†ï¼ˆæ— éœ€é”ï¼‰    prepare_operation();        lock.lock();  // æ‰‹åŠ¨é”å®š    perform_operation();  // ä¸´ç•ŒåŒº    lock.unlock();  // æå‰è§£é”ï¼ˆå¯é€‰ï¼‰        // åç»­æ“ä½œï¼ˆæ— éœ€é”ï¼‰    cleanup_operation();&#125;\n\n\nï¼ˆ3ï¼‰std::shared_lockï¼ˆC++14ï¼‰\n\n\nç‰¹æ€§ï¼šé…åˆstd::shared_mutexå®ç°å…±äº«é”ï¼ˆè¯»é”ï¼‰\n\n\nä¼˜åŠ¿ï¼šå¤šä¸ªçº¿ç¨‹å¯åŒæ—¶æŒæœ‰å…±äº«é”ï¼Œæé«˜è¯»æ“ä½œå¹¶å‘åº¦\n\n\nç¤ºä¾‹ï¼š\n#include &lt;shared_mutex&gt;std::shared_mutex smtx;std::string config_data;// è¯»æ“ä½œï¼ˆå…±äº«è®¿é—®ï¼‰std::string read_config() &#123;    std::shared_lock&lt;std::shared_mutex&gt; lock(smtx);  // å…±äº«é”    return config_data;  // å¤šä¸ªè¯»çº¿ç¨‹å¯åŒæ—¶æ‰§è¡Œ&#125;// å†™æ“ä½œï¼ˆç‹¬å è®¿é—®ï¼‰void update_config(const std::string&amp; new_data) &#123;    std::unique_lock&lt;std::shared_mutex&gt; lock(smtx);  // ç‹¬å é”    config_data = new_data;  // å†™æ“ä½œæ—¶é˜»å¡æ‰€æœ‰è¯»å†™&#125;\n\n\nï¼ˆ4ï¼‰std::scoped_lockï¼ˆC++17ï¼‰\n\n\nç‰¹æ€§ï¼šåŒæ—¶é”å®šå¤šä¸ªäº’æ–¥é‡ï¼Œå†…éƒ¨ä½¿ç”¨æ­»é”é¿å…ç®—æ³•\n\n\nä¼˜åŠ¿ï¼šè§£å†³å¤šé”åœºæ™¯ä¸‹çš„æ­»é”é—®é¢˜ï¼ˆå¦‚æŒ‰å›ºå®šé¡ºåºé”å®šï¼‰\n\n\nç¤ºä¾‹ï¼š\nstd::mutex mtx1, mtx2;int a = 0, b = 0;void swap_values() &#123;    // åŒæ—¶é”å®šå¤šä¸ªäº’æ–¥é‡ï¼Œé¿å…æ­»é”    std::scoped_lock lock(mtx1, mtx2);  // é¡ºåºä¸å½±å“ï¼Œå†…éƒ¨è‡ªåŠ¨å¤„ç†    std::swap(a, b);&#125;  // è‡ªåŠ¨è§£é”æ‰€æœ‰äº’æ–¥é‡\n\n\nä¸‰ã€é”æ“ä½œæ ‡ç­¾ï¼ˆTag Typesï¼‰\né€šè¿‡æ ‡ç­¾æ§åˆ¶é”çš„è¡Œä¸ºï¼Œå®ç°ç‰¹æ®Šåœºæ™¯ä¸‹çš„åŒæ­¥é€»è¾‘ï¼š\n\n\n\næ ‡ç­¾\nä½œç”¨\né€‚ç”¨ç±»\nå…¸å‹åœºæ™¯\n\n\n\n\nstd::adopt_lock\næ¥ç®¡å·²è·å–çš„é”ï¼Œä¸é‡å¤é”å®š\nlock_guard/unique_lock\næ‰‹åŠ¨é”å®šåäº¤ç»™RAIIç®¡ç†\n\n\nstd::try_to_lock\nå°è¯•é”å®šï¼Œä¸é˜»å¡ï¼ŒæˆåŠŸåˆ™æŒæœ‰\nunique_lock\néé˜»å¡è·å–é”ï¼Œé¿å…çº¿ç¨‹æŒ‚èµ·\n\n\nstd::defer_lock\nå»¶è¿Ÿé”å®šï¼Œæ„é€ æ—¶ä¸è·å–é”\nunique_lock\nçµæ´»æ§åˆ¶é”å®šæ—¶æœºï¼ˆå¦‚æ¡ä»¶åˆ¤æ–­åï¼‰\n\n\n\n1. std::adopt_lock ç¤ºä¾‹\nvoid manual_lock_management() &#123;    mtx.lock();  // æ‰‹åŠ¨é”å®šï¼ˆå¿…é¡»æˆåŠŸï¼‰    // æ¥ç®¡é”çš„é‡Šæ”¾æƒï¼Œé¿å…æ‰‹åŠ¨unlock()é—æ¼    std::lock_guard&lt;std::mutex&gt; lock(mtx, std::adopt_lock);    // ä¸´ç•ŒåŒºæ“ä½œ&#125;  // è‡ªåŠ¨è§£é”\n2. std::try_to_lock ç¤ºä¾‹\nvoid non_blocking_operation() &#123;    std::unique_lock&lt;std::mutex&gt; lock(mtx, std::try_to_lock);        if (lock.owns_lock()) &#123;  // æ£€æŸ¥æ˜¯å¦æˆåŠŸè·å–é”        critical_operation();    &#125; else &#123;        fallback_operation();  // æœªè·å–é”æ—¶çš„å¤‡é€‰é€»è¾‘    &#125;&#125;\nå››ã€é«˜çº§æ“ä½œï¼šè¶…æ—¶ä¸æ‰€æœ‰æƒè½¬ç§»\n1. è¶…æ—¶é”å®šï¼ˆunique_lockä¸“å±ï¼‰\né¿å…çº¿ç¨‹å› æ— æ³•è·å–é”è€Œæ°¸ä¹…é˜»å¡ï¼š\n#include &lt;chrono&gt;using namespace std::chrono_literals;void timed_operation() &#123;    std::unique_lock&lt;std::timed_mutex&gt; lock(timed_mtx);        // å°è¯•é”å®šï¼Œæœ€å¤šç­‰å¾…500ms    if (lock.try_lock_for(500ms)) &#123;        success_operation();    &#125; else &#123;        timeout_handler();  // è¶…æ—¶å¤„ç†    &#125;        // ç»å¯¹æ—¶é—´ç‰ˆæœ¬ï¼ˆåˆ°æŸä¸ªæ—¶é—´ç‚¹ä¸ºæ­¢ï¼‰    auto deadline = std::chrono::system_clock::now() + 1s;    if (lock.try_lock_until(deadline)) &#123;        // æˆåŠŸé”å®š    &#125;&#125;\n2. é”çš„æ‰€æœ‰æƒè½¬ç§»\nunique_lockæ”¯æŒç§»åŠ¨è¯­ä¹‰ï¼Œå¯åœ¨å‡½æ•°é—´ä¼ é€’é”çš„æ‰€æœ‰æƒï¼š\n// å‡½æ•°è¿”å›å·²é”å®šçš„é”std::unique_lock&lt;std::mutex&gt; acquire_lock() &#123;    std::unique_lock&lt;std::mutex&gt; lock(mtx);    return lock;  // ç§»åŠ¨è¯­ä¹‰ä¼ é€’æ‰€æœ‰æƒ&#125;void use_locked_resource() &#123;    auto lock = acquire_lock();  // æ¥æ”¶é”ï¼ˆä»å¤„äºé”å®šçŠ¶æ€ï¼‰    access_protected_resource();  // ç›´æ¥ä½¿ç”¨ä¸´ç•Œèµ„æº&#125;  // é”åœ¨æ­¤å¤„ææ„ï¼Œè‡ªåŠ¨è§£é”\näº”ã€æœ€ä½³å®è·µä¸é¿å‘æŒ‡å—\n\n\nä¼˜å…ˆä½¿ç”¨RAIIå°è£…ï¼šå§‹ç»ˆç”¨lock_guard/unique_lockç­‰ç®¡ç†é”ï¼Œé¿å…æ‰‹åŠ¨lock()/unlock()ï¼ˆæ˜“å› å¼‚å¸¸å¯¼è‡´æ­»é”ï¼‰ã€‚\n\n\næœ€å°åŒ–ä¸´ç•ŒåŒºï¼šé”çš„èŒƒå›´åº”å°½å¯èƒ½å°ï¼Œä»…åŒ…è£¹å¿…è¦çš„å…±äº«èµ„æºæ“ä½œï¼Œå‡å°‘çº¿ç¨‹é˜»å¡æ—¶é—´ã€‚\n\n\næ­»é”é¢„é˜²ï¼š\n\nå¤šé”åœºæ™¯ç”¨scoped_lockæˆ–æŒ‰å›ºå®šé¡ºåºåŠ é”ï¼ˆå¦‚æŒ‰åœ°å€æ’åºï¼‰ã€‚\né¿å…åœ¨æŒæœ‰é”æ—¶è°ƒç”¨å¤–éƒ¨å‡½æ•°ï¼ˆå¯èƒ½éšå¼è·å–å…¶ä»–é”ï¼‰ã€‚\nç»“åˆtry_to_lockå’Œè¶…æ—¶æœºåˆ¶ï¼Œè®¾ç½®é”è·å–çš„æœ€å¤§ç­‰å¾…æ—¶é—´ã€‚\n\n\n\né”ç±»å‹é€‰æ‹©ç­–ç•¥ï¼š\n\nç®€å•åœºæ™¯â†’lock_guardï¼ˆæ€§èƒ½æœ€ä¼˜ï¼‰ã€‚\néœ€çµæ´»æ§åˆ¶ï¼ˆå¦‚æ¡ä»¶å˜é‡ã€è¶…æ—¶ï¼‰â†’unique_lockã€‚\nè¯»å¤šå†™å°‘â†’shared_mutex+shared_lock/unique_lockã€‚\nå¤šé”åŒæ—¶é”å®šâ†’scoped_lockã€‚\n\n\n\nçº¿ç¨‹ç®¡ç†ï¼šä¼˜å…ˆä½¿ç”¨jthreadï¼ˆC++20+ï¼‰ï¼Œé¿å…detach()ï¼ˆéš¾ä»¥æ§åˆ¶ç”Ÿå‘½å‘¨æœŸï¼‰ã€‚\n\n\nè¿™äº›ç»„ä»¶å…±åŒæ„æˆäº†C++å¤šçº¿ç¨‹åŒæ­¥çš„å®Œæ•´ä½“ç³»ï¼Œç†è§£å…¶ç‰¹æ€§ä¸é€‚ç”¨åœºæ™¯æ˜¯ç¼–å†™å®‰å…¨ã€é«˜æ•ˆå¹¶å‘ç¨‹åºçš„åŸºç¡€ã€‚å®é™…å¼€å‘ä¸­ï¼Œè¿˜éœ€ç»“åˆæ¡ä»¶å˜é‡ï¼ˆstd::condition_variableï¼‰ã€åŸå­æ“ä½œï¼ˆstd::atomicï¼‰ç­‰æœºåˆ¶è§£å†³å¤æ‚åŒæ­¥é—®é¢˜ã€‚\n","categories":["ç¼–ç¨‹"],"tags":["C++"]},{"title":"C++åŸºç¡€","url":"/2024/04/27/C++/C++%E5%9F%BA%E7%A1%80/","content":"\nC++ ä¸€äº›åŸºç¡€çŸ¥è¯†\n\n\nC++ åŸºç¡€\n0. å‰ç½®çŸ¥è¯†\n0.1 å·¦/å³å€¼\n\n\n\nå·¦å€¼:åœ¨å†…å­˜ä¸­æœ‰æ˜ç¡®å­˜å‚¨ä½ç½®(å³åœ°å€)çš„è¡¨è¾¾å¼ï¼Œé€šå¸¸å‡ºç°åœ¨èµ‹å€¼è¡¨è¾¾å¼çš„å·¦ä¾§ã€‚ å·¦å€¼å¯ä»¥å–åœ°å€\n\n\nå³å€¼ï¼šé€šå¸¸æŒ‡ä¸´æ—¶çš„æ•°æ®å€¼(å¦‚å­—é¢é‡ï¼Œæ±‚å€¼è¿‡ç¨‹ä¸­äº§ç”Ÿçš„ä¸´æ—¶å¯¹è±¡)ï¼Œåœ¨å†…å­˜ä¸­æ²¡æœ‰å›ºå®šçš„åœ°å€ï¼Œå®ƒä¸èƒ½è¢«èµ‹å€¼\n\n\n\n0.2 å•ä½\n\n\n\nbit:æ¯”ç‰¹ï¼Œåˆç§°ä½ï¼Œè®¡ç®—æœºå†…éƒ¨å‚¨å­˜æ•°æ®çš„æœ€å°å•ä½\n\n\nByte:å­—èŠ‚ï¼Œç”±8ä¸ªæ¯”ç‰¹ç»„æˆï¼Œä¹ æƒ¯ä¸Šä»¥å¤§å†™Bæ¥è¡¨ç¤ºï¼Œé€šå¸¸1ä¸ªå­—èŠ‚å¯ä»¥å­˜å…¥ä¸€ä¸ªASCIIç ï¼Œ2ä¸ªå­—èŠ‚å¯ä»¥å­˜æ”¾ä¸€ä¸ªæ±‰å­—å›½æ ‡ç ã€‚è¿™æ˜¯å†…å­˜å¯»å€çš„æœ€å°å•å…ƒ\n\n\nword:å­—ï¼Œç”±ä¸€ä¸ªæˆ–å¤šä¸ªå­—èŠ‚ç»„æˆï¼Œè®¡ç®—æœºçš„å­—é•¿å†³å®šäº†å…¶CPUä¸€æ¬¡æ“ä½œå®é™…å¤„ç†çš„ä½æ•°æ˜¯å¤šå°‘ï¼Œä¾‹å¦‚64ä½è®¡ç®—æœºçš„CPUä¸€æ¬¡æœ€å¤šèƒ½å¤„ç†64ä½æ•°æ®\n\n\n\n0.3 å†…å­˜\n\nå†…å­˜å°±æ˜¯è®¡ç®—æœºçš„å­˜å‚¨ç©ºé—´ï¼Œç”¨æ¥å­˜å‚¨ç¨‹åºçš„æŒ‡ä»¤ï¼Œæ•°æ®å’ŒçŠ¶æ€\n\n0.3.1 å†…å­˜å››åŒº\n\n\nä»£ç åŒº(code/text):å­˜æ”¾CPUæ‰§è¡Œçš„æœºå™¨æŒ‡ä»¤ã€‚é€šå¸¸ä»£ç åŒºæ˜¯å¯å…±äº«çš„ï¼Œå³å¦å¤–çš„ç¨‹åºå¯ä»¥è°ƒç”¨å®ƒã€‚ç¼–å†™çš„æ‰€æœ‰ä»£ç éƒ½ä¼šæ”¾è¿›ä»£ç åŒºï¼Œå…¶ç‰¹ç‚¹æ˜¯å…±äº«å’Œåªè¯»\n\n\nå…¨å±€åŒº/é™æ€åŒº(stactic)ï¼šç”¨æ¥å­˜æ”¾å…¨å±€å˜é‡ï¼Œé™æ€å˜é‡ï¼Œå¸¸é‡\n\ndataåŒºï¼šå­˜æ”¾å·²åˆå§‹åŒ–çš„å…¨å±€å˜é‡ï¼Œé™æ€å˜é‡å’Œå¸¸é‡\nbssåŒºï¼šå­˜æ”¾åˆå§‹åŒ–ä¸º0æˆ–è€…NULLæˆ–æœªåˆå§‹åŒ–çš„å…¨å±€å˜é‡ï¼Œé™æ€å˜é‡å’Œå¸¸é‡ã€‚æœªåˆå§‹åŒ–çš„åœ¨ç¨‹åºæ‰§è¡Œå‰ä¼šè‡ªåŠ¨è¢«ç³»ç»Ÿåˆå§‹åŒ–ä¸º0æˆ–è€…NULL\nå¸¸é‡åŒºï¼šé¡¾åæ€ä¹‰ï¼Œå­˜æ”¾å¸¸é‡ï¼Œå¦‚constä¿®é¥°çš„å…¨å±€å˜é‡ï¼Œå­—ç¬¦ä¸²å¸¸é‡\n\n\n\næ ˆ(stack):æ˜¯ä¸€ç§å…ˆè¿›åå‡ºçš„å†…å­˜ç»“æ„ï¼Œç”±ç¼–è¯‘å™¨è‡ªåŠ¨åˆ†é…\n\n\nç»“æ„ä½“å’Œç±»çš„å¯¹è±¡åœ¨é»˜è®¤æƒ…å†µä¸‹æ˜¯åˆ†é…åœ¨æ ˆåŒº\n\n\nå­˜æ”¾å‡½æ•°çš„å‚æ•°å€¼ï¼Œè¿”å›å€¼ï¼Œå±€éƒ¨å˜é‡ç­‰ï¼Œç”±constå®šä¹‰çš„å±€éƒ¨å˜é‡ä¹Ÿå­˜å‚¨åœ¨æ ˆé‡Œã€‚\n\n\nå†…å­˜åœ°å€ç”±é«˜åˆ°ä½æ–¹å‘ç”Ÿé•¿ï¼Œå…¶æœ€å¤§å¤§å°ç”±ç¼–è¯‘æ—¶ç¡®å®šï¼Œé€Ÿåº¦å¿«ä½†è‡ªç”±æ€§å·®ï¼Œæœ€å¤§ç©ºé—´æ¯”å †å°\n\n\n\n\nå †(heap):ç”¨äºåŠ¨æ€å†…å­˜åˆ†é…\n\nå†…å­˜åœ°å€ç”±ä½åˆ°é«˜æ–¹å‘ç”Ÿé•¿ï¼Œå…¶å¤§å°ç”±ç³»ç»Ÿå†…å­˜/è™šæ‹Ÿå†…å­˜ä¸Šé™å†³å®šï¼Œé€Ÿåº¦è¾ƒæ…¢ï¼Œä½†è‡ªç”±æ€§å¤§ï¼Œå¯ç”¨ç©ºé—´å¤§\næ³¨æ„è¿›è¡Œå†…å­˜é‡Šæ”¾ï¼Œå¦åˆ™ä¼šé€ æˆå†…å­˜æ³„éœ²\n\n\n\n\n0.3.2 å†…å­˜ç¼–å€\nå³ç»™è®¡ç®—æœºçš„å­˜å‚¨å•å…ƒè¿›è¡Œç¼–å·ï¼Œè€Œåœ¨CSä¸­å­˜å‚¨å•å…ƒé€šå¸¸æ˜¯æŒ‡æœ€å°çš„å¯å¯»å€å•å…ƒå³byteï¼Œä¹Ÿå°±æ˜¯ç»™æ¯ä¸ªbyteä¸€ä¸ªç¼–å·ï¼Œè¿™ä¸ªç¼–å·å°±æ˜¯å†…å­˜çš„åœ°å€\n\n0.3.3 å†…å­˜åœ°å€ç©ºé—´\n\nå°†æ‰€æœ‰byteçš„ç¼–å·è¿èµ·æ¥å°±å«ä½œå†…å­˜çš„åœ°å€ç©ºé—´ï¼Œè€Œåœ°å€ç©ºé—´(å¯å¯»å€å†…å­˜)çš„å¤§å°ä¸ç”µè„‘æ˜¯32ä½è¿˜æ˜¯34ä½æœ‰å…³\n\n\n\n32 ä½æ„å‘³ç€å¯å¯»å€çš„å†…å­˜èŒƒå›´æ˜¯ 2^32 byte = 4GB\n\n\n64ä½å³ 2^64 byte\n\n\n0.4 åŸç  åç  è¡¥ç \n\n\nåç   åŸç æŒ‰ä½å–å  æ­£æ•°çš„åç æ˜¯å…¶æœ¬èº«\n\n\nè¡¥ç   åŸç æŒ‰ä½å–ååŠ ä¸€    æ­£æ•°çš„è¡¥ç æ˜¯å…¶æœ¬èº«\n\n\nè®¡ç®—æœºä¸­ä½¿ç”¨è¡¥ç æ¥è¡¨ç¤ºå’Œæ“ä½œæ•´æ•°\n\n\nä¸ªäººè§‰å¾—åç å’Œè¡¥ç çš„å¼•å…¥ æ˜¯ä¸ºäº†ä¾¿äºç†è§£åœ¨è®¡ç®—æœºä¸­å¦‚ä½•ä½¿ç”¨ æ­£æ•°æ¥è¡¨ç¤ºè´Ÿæ•°\n\n\n\nå¦‚ int åœ¨å†…å­˜ä¸­å æ®4ä¸ªå­—èŠ‚ è¡¨ç¤ºæœ‰ç¬¦å·çš„æ•´æ•° ä»–çš„èŒƒå›´æ˜¯ [-2^31 , 2^31 - 1]\nunsigned int åœ¨å†…å­˜ä¸­å æ®å››ä¸ªå­—èŠ‚ è¡¨ç¤ºæ— ç¬¦å·æ•´æ•° ä»–çš„èŒƒå›´æ˜¯[0,2^32-1]\nè€Œ32ä½äºŒè¿›åˆ¶æ•°è¡¨ç¤ºçš„èŒƒå›´æ˜¯[0,2^32-1]ï¼Œå³æŠŠå®ƒä»ä¸­é—´åˆ†ä¸€åŠï¼Œå°† 0 å¼€å¤´çš„32ä½äºŒè¿›åˆ¶æ•°ç”¨æ¥è¡¨ç¤ºæ­£æ•°ï¼Œå°† 1 å¼€å¤´çš„ç”¨æ¥è¡¨ç¤ºè´Ÿæ•°ï¼Œæ‰€ä»¥intè¡¨ç¤ºçš„æ­£æ•°çš„èŒƒå›´æ˜¯unsigned int çš„ä¸€åŠ ä½†äºŒè€…è¡¨ç¤ºçš„æ€»æ•°æ˜¯ä¸€æ ·çš„\n\n0.5 è¿›åˆ¶è½¬æ¢\n\nåè¿›åˆ¶ï¼š éƒ½æ˜¯ä»¥0-9è¿™ä¹ä¸ªæ•°å­—ç»„æˆï¼Œä¸èƒ½ä»¥0å¼€å¤´ã€‚\näºŒè¿›åˆ¶ï¼š ç”±0å’Œ1ä¸¤ä¸ªæ•°å­—ç»„æˆã€‚\nå…«è¿›åˆ¶ï¼š ç”±0-7æ•°å­—ç»„æˆï¼Œä¸ºäº†åŒºåˆ†ä¸å…¶ä»–è¿›åˆ¶çš„æ•°å­—åŒºåˆ«ï¼Œå¼€å¤´éƒ½æ˜¯ä»¥0å¼€å§‹ã€‚\nåå…­è¿›åˆ¶ï¼šç”±0-9å’ŒA-Fç»„æˆã€‚ä¸ºäº†åŒºåˆ†äºå…¶ä»–æ•°å­—çš„åŒºåˆ«ï¼Œå¼€å¤´éƒ½æ˜¯ä»¥0xå¼€å§‹ã€‚\n\n\n\næ•´æ•°éƒ¨åˆ†\nåè¿›åˆ¶è½¬nè¿›åˆ¶ï¼šåè¿›åˆ¶æ•°é™¤ä»¥2ï¼Œåå‘å–ä½™æ•°ï¼Œç›´åˆ°å•†ä¸º0ç»ˆæ­¢\n\nnè¿›åˆ¶è½¬åè¿›åˆ¶ï¼šå°†æ¯ä¸€ä½ä¹˜ä»¥ç›¸åº”çš„æƒå€¼ï¼Œç„¶åå°†ä¹˜ç§¯ç›¸åŠ \n\n\nå°æ•°éƒ¨åˆ†\n\n\nâ€‹\tåè¿›åˆ¶è½¬nè¿›åˆ¶: ä¹˜nå–æ•´ï¼Œé¡ºåºè¾“å‡º\nâ€‹\tnè¿›åˆ¶è½¬åè¿›åˆ¶ï¼šå¦‚ä¸Š\n1.å˜é‡\n\nå˜é‡åæ˜¯å˜é‡åœ°å€çš„ç¬¦å·åŒ–ä½“ç°\n\n1.1 å˜é‡ç±»å‹\n1.1.1 ä½œç”¨ï¼š\n\n\nå†…å­˜åˆ†é…ï¼šå‘Šè¯‰ç¼–è¯‘å™¨è¯¥å˜é‡å æ®çš„å†…å­˜å¤§å°ï¼Œå äº†å¤šå°‘ä¸ªå­—èŠ‚\n\n\næ“ä½œé™åˆ¶ï¼šè§„å®šäº†è¯¥å˜é‡å¯ä»¥æ‰§è¡Œçš„æ“ä½œ\n\n\næ•°æ®è§£é‡Šï¼šå†³å®šäº†å¦‚ä½•è§£é‡Šå­˜å‚¨åœ¨å†…å­˜ä¸­çš„ä½æ¨¡å¼ï¼Œå†³å®šäº†ç¼–è¯‘å™¨å¦‚ä½•è§£è¯»å¯¹åº”çš„äºŒè¿›åˆ¶æ•°æ®\n\n\n\nä½æ¨¡å¼æ˜¯æŒ‡ä¸€ç³»åˆ—çš„0å’Œ1ï¼Œæ˜¯è®¡ç®—æœºå†…å­˜ä¸­æ•°æ®æœ€åŸºæœ¬çš„å½¢å¼ï¼Œæ‰€æœ‰æ•°æ®æœ€ç»ˆéƒ½ä¼šè¢«è¡¨ç¤ºä¸º ä½æ¨¡å¼\n\n1.1.2 ç§ç±»\n\n\nåŸºç¡€ç±»å‹ ï¼šæ•´æ•° å­—ç¬¦ å¸ƒå°” æµ®ç‚¹\n\n\nä¿®é¥°ç¬¦ï¼šlong short signed unsigned\n\n\nç±»ç±»å‹ï¼šclass\n\n\nç»“æ„ä½“ç±»å‹ï¼šstruct\n\n\næ•°ç»„ç±»å‹\n\n\næŒ‡é’ˆç±»å‹\n\n\nå¼•ç”¨ç±»å‹\n\n\nå¤æ•°ç±»å‹(complex  C++11åŠä»¥ä¸Š)\n\n\nè”åˆä½“ unio\n\n\næšä¸¾ä½“ enum\n\n\n2. å†…å­˜å¯¹é½\n\nä¸ºäº†æé«˜æ•°æ®è®¿é—®çš„æ€§èƒ½å’Œæ•ˆç‡ï¼Œå°†æ•°æ®å­˜å‚¨åœ¨é€‚å½“çš„å†…å­˜åœ°å€ä¸Šï¼Œä»¥å‡å°‘é¢å¤–å¼€é”€   ä»¥ç©ºé—´æ¢æ—¶é—´\nå¯¹é½çš„é•¿åº¦ä¸€èˆ¬ä¸º2çš„næ¬¡å¹‚(1ï¼Œ2 ï¼Œ4ï¼Œ8)\n\n2.1 äº§ç”ŸåŸå› \nä¸ºäº†é€‚åº”CPUè¯»å–æ•°æ®çš„è¡Œä¸ºï¼ŒCPUä¸€æ¬¡è¯»å–4ä¸ªå­—èŠ‚æˆ–8ä¸ªå­—èŠ‚ï¼Œç”±ç¼–è¯‘å™¨å’Œæ“ä½œç³»ç»Ÿ(32ä½æˆ–64ä½)å†³å®š\n2.2 æ›´æ”¹å¯¹é½è§„åˆ™\n\n\nä½¿ç”¨ç¼–è¯‘å™¨æŒ‡ä»¤ï¼ˆå¦‚ #pragma packï¼‰æ›´æ”¹é»˜è®¤çš„å¯¹é½è§„åˆ™ã€‚è¿™ä¸ªå‘½ä»¤æ˜¯å…¨å±€ç”Ÿæ•ˆçš„ã€‚è¿™å¯ä»¥ç”¨äºå‡å°æ•°æ®ç»“æ„çš„å¤§å°ï¼Œä½†å¯èƒ½ä¼šé™ä½è®¿é—®æ€§èƒ½ã€‚\n\n\nåœ¨ C++11 åŠæ›´é«˜ç‰ˆæœ¬ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ alignas å…³é”®å­—ä¸ºæ•°æ®ç»“æ„æˆ–å˜é‡æŒ‡å®šå¯¹é½è¦æ±‚ã€‚è¿™ä¸ªå‘½ä»¤æ˜¯å¯¹æŸä¸ªç±»å‹æˆ–è€…å¯¹è±¡ç”Ÿæ•ˆçš„ã€‚ä¾‹å¦‚ï¼Œalignas(16) int x; å°†ç¡®ä¿ x çš„åœ°å€æ˜¯ 16 çš„å€æ•°ã€‚\n\n\n#pragma pack(push, 16) //å°†å½“å‰å¯¹é½å€¼æ¨é€åˆ°å †æ ˆä¸Šï¼Œå¹¶å°†å¯¹é½å€¼è®¾ç½®ä¸º16å­—èŠ‚struct MyStruct &#123;    char a;    int b;    char c;&#125;;#pragma pack(pop)  //ä»å †æ ˆä¸­å¼¹å‡ºå¯¹é½å€¼ï¼Œæ¢å¤ä¹‹å‰çš„å¯¹é½å€¼\n2.3 ç»“æ„ä½“å¯¹é½\n\n\næœ€å¤§æˆå‘˜å¯¹é½ï¼šç¼–è¯‘å™¨ä¼šå°†æ•°æ®æˆå‘˜è¡¥é½ä¸ºæœ€å¤§æˆå‘˜å¤§å°çš„æ•´æ•°å€\nå¦‚æœç»“æ„ä½“ä¸­å«æœ‰æ•°ç»„æˆå‘˜ï¼Œå¦‚ char a[5]ï¼Œå®ƒçš„å¯¹é½æ–¹å¼å’Œè¿ç»­å†™ 5 ä¸ª char ç±»å‹å˜é‡æ˜¯ä¸€æ ·çš„ï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒè¿˜æ˜¯æŒ‰ä¸€ä¸ªå­—èŠ‚å¯¹é½\n\n\nå¡«å……å­—èŠ‚(struct padding)ï¼šå¦‚æœæŸæˆå‘˜å¤§å°æ»¡è¶³å¯¹é½è¦æ±‚ï¼Œç¼–è¯‘å™¨ä¼šæ’å…¥ä¸€äº›å­—èŠ‚è¿›è¡Œå¡«å……\n\n\n#include &lt;iostream&gt;using namespace std;struct stu1 &#123;    char a[18];  //å°±æœ¬èº«è€Œè¨€å æ®18ä¸ªå­—èŠ‚   å®é™…å æ®24ä¸ªå­—èŠ‚    double b;    //å æ®8ä¸ªå­—èŠ‚    char c;      //å®é™…å æ®4ä¸ªå­—èŠ‚    int d;       //å®é™…å æ®4ä¸ªå­—èŠ‚    short e;     //å®é™…å æ®8ä¸ªå­—èŠ‚&#125;;int main() &#123;    stu1 s1;    cout&lt;&lt;sizeof(s1)&lt;&lt;endl;    return 0;&#125;---------------è¾“å‡ºç»“æœï¼šsizeof(s1)=48\n\n#include &lt;iostream&gt;#include &lt;cstring&gt;using namespace std;struct stu2 &#123;    char x;    int y;    double z;    char v[6];&#125;;struct stu1 &#123;    char a;         //å®é™…å æ®8ä¸ªå­—èŠ‚    struct stu2 b; // è¯¥ç»“æ„ä½“ä¸­æœ€å¤§çš„æˆå‘˜å æ®8ä¸ªå­—èŠ‚ï¼Œå®é™…å æ®24ä¸ªå­—èŠ‚    int c;         //å®é™…å æ®8ä¸ªå­—èŠ‚&#125;;int main() &#123;    stu1 s1;    cout&lt;&lt;sizeof(s1)&lt;&lt;endl;    return 0;&#125;---------------è¾“å‡ºç»“æœï¼šsizeof(s1)=40\n\n2.4 ç±»çš„å†…å­˜å¯¹é½\n2.4.1 ç©ºç±»çš„å¤§å°\n\nç©ºç±»å’Œç©ºç»“æ„ä½“çš„å®ä¾‹åŒ–å¯¹è±¡çš„å¤§å°éƒ½ä¸º1\n\n#include&lt;iostream&gt;using namespace std;class demo&#123;&#125;;int main(void)&#123;    demo a;    cout &lt;&lt; sizeof(a)&lt;&lt;endl;  // è¾“å‡ºç»“æœä¸º1&#125;\n2.4.2 æ·»åŠ æˆå‘˜å‡½æ•°ï¼Œé™æ€æ•°æ®æˆå‘˜ï¼Œé™æ€æˆå‘˜å‡½æ•°\n\nç»“æœä¾æ—§ä¸º1\n\n#include&lt;iostream&gt;using namespace std;class demo &#123;public:    demo() &#123;&#125;    ~demo() &#123;&#125;    void myPrint() &#123; cout &lt;&lt; &quot;hello world!&quot; &lt;&lt; endl; &#125;    static void sharedFunc() &#123; cout &lt;&lt; &quot;hello this is a shared xxx&quot; &lt;&lt; endl; &#125;    static int a;&#125;;int demo::a = 1024;int main(void) &#123;    demo x;    cout &lt;&lt; sizeof(x) &lt;&lt; endl;  // è¾“å‡ºç»“æœä¸º1&#125;\nå› ä¸ºæˆå‘˜å‡½æ•°ï¼Œé™æ€æˆå‘˜å‡½æ•°å­˜å‚¨åœ¨ä»£ç æ®µï¼ˆ.textï¼‰ä¸­ï¼Œé™æ€æˆå‘˜å˜é‡å­˜å‚¨åœ¨å…¨å±€/é™æ€åŒº(static)ï¼Œä»–ä»¬ä¸å ç”¨ç±»çš„å†…å­˜ï¼Œä¸æ˜¯æ¯ä¸ªå¯¹è±¡åˆ†åˆ«å­˜å‚¨\n2.4.3 ç±»å¯¹è±¡å¤§å°çš„å½±å“å› ç´ \n\néé™æ€æˆå‘˜å˜é‡å’Œè™šå‡½æ•°\nè€ƒè™‘æ˜¯å¦å­˜åœ¨vptrï¼Œè‹¥å­˜åœ¨åˆ™è®¡å…¥è€ƒè™‘èŒƒå›´ï¼Œæ•´ä½“ä¸Šä¸ç»“æ„ä½“ç›¸åŒ\n\n3.ç±»çš„å¤šæ€\n\nå…è®¸ä½¿ç”¨ä¸€ä¸ªæ¥å£æ¥è¡¨ç¤ºä¸åŒçš„ç±»ï¼Œè€Œè¿™äº›ç±»çš„å¯¹è±¡åœ¨è¿è¡Œæ—¶å¯ä»¥è¡¨ç°å‡ºä¸åŒçš„è¡Œä¸º\nçˆ¶ç±»æŒ‡é’ˆå¯ä»¥æŒ‡å‘å­ç±»å¯¹è±¡ï¼Œè¿›è€Œè°ƒç”¨å­ç±»å‡½æ•°\n\n3.1 è™šè¡¨(vtable)\n\n\næ¯ä¸ªå­˜åœ¨è™šå‡½æ•°çš„ç±»ï¼Œéƒ½æœ‰ä¸€ä¸ªè™šå‡½æ•°è¡¨\n\n\nè™šå‡½æ•°è¡¨æ˜¯ä¸€ä¸ªæŒ‡é’ˆæ•°ç»„ï¼Œå…¶å…ƒç´ æ˜¯æŒ‡å‘è™šå‡½æ•°çš„å‡½æ•°æŒ‡é’ˆ(å‡½æ•°çš„åœ°å€)\n\n\næˆå‘˜å‡½æ•°(åŒ…æ‹¬è™šå‡½æ•°)æ˜¯ç±»çš„ä¸€éƒ¨åˆ†ï¼Œä¸å ç”¨å¯¹è±¡å®ä¾‹çš„å†…å­˜ç©ºé—´ï¼Œä»–ä»¬ä¸ºåŒä¸€ä¸ªç±»çš„æ‰€æœ‰å¯¹è±¡å…±äº«ï¼Œå­˜å‚¨åœ¨ç¨‹åºçš„ä»£ç æ®µä¸­\n\n\n3.2è™šè¡¨æŒ‡é’ˆ(vptr)\n\nå®ç°å¤šæ€ç±»çš„æ ¸å¿ƒæœºåˆ¶ä¹‹ä¸€\næ¯ä¸€ä¸ªåŒ…å«è™šå‡½æ•°çš„ç±» çš„å®ä¾‹åŒ–å¯¹è±¡æ‰€åŒ…å«çš„éšå«æŒ‡é’ˆ\n\n\n\nè¯¥æŒ‡é’ˆæŒ‡å‘ç±»çš„è™šè¡¨\n\n\nå¤§å¤šæ•°å®ç°ä¸Šï¼Œè™šå‡½æ•°è¡¨æŒ‡é’ˆä¸€èˆ¬éƒ½æ”¾åœ¨å¯¹è±¡ç¬¬ä¸€ä¸ªä½ç½®\n\n\nè¯¥æŒ‡é’ˆæ˜¯éšå«çš„ï¼Œä¸æ˜¯ç±»çš„æˆå‘˜å˜é‡ï¼Œç”¨æˆ·ä¸èƒ½ç›´æ¥è®¿é—®æˆ–ä¿®æ”¹å®ƒ\n\n\næŒ‡é’ˆå¤§å°å–å†³äºæ“ä½œç³»ç»Ÿæˆ–ç¼–è¯‘å™¨ï¼Œ32ä½å 4ä¸ªå­—èŠ‚ï¼Œ64ä½å 8ä¸ªå­—èŠ‚\n\n\n3.3 å¤šæ€çš„å®ç°\n\n\nå½“æ´¾ç”Ÿç±»é‡å†™äº†åŸºç±»çš„è™šå‡½æ•°æ—¶ï¼Œæ´¾ç”Ÿç±»çš„è™šè¡¨ä¸­å¯¹åº”çš„å‡½æ•°æŒ‡é’ˆå°†è¢«æ›´æ–°ï¼ŒæŒ‡å‘æ´¾ç”Ÿç±»ä¸­çš„æ–°å®ç°ï¼Œå³æŒ‡å‘æ´¾ç”Ÿç±»ä¸­é‡å†™å‡½æ•°çš„åœ°å€\n\n\n\n4. ç§»åŠ¨è¯­ä¹‰\n\nå…è®¸èµ„æºä»ä¸€ä¸ªå¯¹è±¡è½¬ç§»åˆ°å¦ä¸€ä¸ªå¯¹è±¡ é¿å…äº†å¤åˆ¶ æé«˜äº†æ€§èƒ½\nåœ¨ä½¿ç”¨ä¸€ä¸ªå³å€¼(å³å°†è¢«é”€æ¯çš„çš„å¯¹è±¡)å»åˆå§‹åŒ–åŒç±»å¯¹è±¡æ—¶è¯¥å‡½æ•°ä¼šè¢«è°ƒç”¨\nå¦‚æœä¸€ä¸ªç±»å®šä¹‰äº†ç§»åŠ¨æ„é€ å‡½æ•°æˆ–ç§»åŠ¨èµ‹å€¼è¿ç®—ç¬¦ä¹Ÿå¿…é¡»å®šä¹‰æ‹·è´æ“ä½œ,å¦åˆ™æ— æ³•è¿›è¡Œæ‹·è´æ“ä½œ,å“ªäº›æˆå‘˜é»˜è®¤è¢«åˆ é™¤\n\n\n4.1 ç‰¹ç‚¹\n\n\nå‡½æ•°åå’Œç±»åç›¸åŒ æ— è¿”å›å€¼ å› ä¸ºå®ƒæœ¬èº«ä¹Ÿæ˜¯ä¸€ä¸ªæ„é€ å‡½æ•°\n\n\nç¬¬ä¸€ä¸ªå‚æ•°ä¸ºåŒç±»å‹çš„å³å€¼å¼•ç”¨(&amp;&amp;)\n\n\nç¬¬ä¸€ä¸ªå‚æ•°ä¸èƒ½è®¾ç½®ä¸ºconstå› ä¸ºå®ƒçš„èµ„æºåœ¨å‡½æ•°å†…éƒ¨ä¼šè¢«ç§»åŠ¨ç»™å½“å‰å¯¹è±¡\n\n\nç§»åŠ¨æ„é€ å‡½æ•°æ‰§è¡Œå éœ€è¦ç¡®ä¿å³å€¼å¼•ç”¨çš„å¯¹è±¡èƒ½è¢«æ­£ç¡®é”€æ¯\n\n\n4.2 å®ä¾‹\nclass CDate&#123;public:    CDate(int year,int month,int day);    CDate(CDate&amp;&amp; date) noexcept;    CDate&amp; operator=(CDate&amp;&amp; date) noexcept;    ~CDate();private:    int m_year;    int m_month;    int m_day;    char* str&#125;;CDate::CDate(int year,int month,int day)&#123;    m_year = year;\tm_mon = mon;\tm_day = day;\tstr = new char[100];&#125;//ç§»åŠ¨æ„é€ å‡½æ•°CDate::CDate(CDate&amp;&amp; date) noexcept&#123;    this-&gt;m_year = date.m_year;    this-&gt;m_month = date.m_month;    this-&gt;m_day = data.m_day;    this-&gt;str = date.str;    date.str = NULL;&#125;//ç§»åŠ¨èµ‹å€¼è¿ç®—ç¬¦CDate&amp; CDate::operator=(CDate&amp;&amp; date)&#123;    if(this != &amp;date)&#123;        delete[] this-&gt;str;        this-&gt;m_year = date.m_year;    \tthis-&gt;m_month = date.m_month;    \tthis-&gt;m_day = date.m_day;    \tthis-&gt;str = date.str;    \tdate.str = NULL;    &#125;    return *this&#125;CDate::~CDate()&#123;    delete[] str;&#125;\nç”±äºç§»åŠ¨æ“ä½œâ€œ çªƒå–â€ èµ„æºï¼Œ å®ƒé€šå¸¸ä¸åˆ†é…ä»»ä½•èµ„æºã€‚ å› æ­¤, ç§»åŠ¨æ“ä½œé€šå¸¸ä¸ä¼šæŠ›å‡ºä»»ä½•å¼‚å¸¸ã€‚ä¸æŠ›å‡ºå¼‚å¸¸çš„å‡½æ•°åº”è¯¥ä½¿ç”¨ noexcept é€šçŸ¥æ ‡å‡†åº“ï¼Œé¿å…ç¼–è¯‘å™¨ä¸ºäº†å¤„ç†å¼‚å¸¸è€Œä½œä¸€äº›é¢å¤–çš„å·¥ä½œ\n4.3 èåˆæ‹·è´èµ‹å€¼è¿ç®—ç¬¦ä¸ç§»åŠ¨èµ‹å€¼è¿ç®—ç¬¦\nCDate&amp; CDate::operator=(CDate date)&#123;    swap(*this,date);    return *this;&#125;//æ­¤è¿ç®—ç¬¦æœ‰ä¸€ä¸ªéå¼•ç”¨å‚æ•° éœ€è¦è¿›è¡Œæ‹·è´åˆå§‹åŒ– ä½¿ç”¨å‰æœ€å¥½å®šä¹‰ä¸€ä¸ªæ‹·è´æ„é€ å‡½æ•°\n5. å®Œç¾è½¬å‘ std::forward\n\nåœ¨é€šç”¨å¼•ç”¨çš„æƒ…å¢ƒä¸‹ï¼Œå°½å¯èƒ½ä½¿ç”¨forward()\n\n5.2 é€šç”¨å¼•ç”¨(universal reference)\næ„æˆé€šç”¨å¼•ç”¨çš„æ¡ä»¶\n\n\nå¿…é¡»æ»¡è¶³T&amp;&amp;è¿™ç§å½¢å¼\n\n\nç±»å‹Tå¿…é¡»æ˜¯é€šè¿‡æ¨æ–­å¾—åˆ°çš„\n\n\näº§ç”Ÿé€šç”¨å¼•ç”¨çš„å¯èƒ½æƒ…å†µ\n\n\nå‡½æ•°æ¨¡æ¿å‚æ•°ï¼ˆfunction template parametersï¼‰\ntemplate &lt;typename T&gt;void f(T&amp;&amp; param);\n\n\nautoå£°æ˜ï¼ˆauto declarationï¼‰\nauto &amp;&amp; var = ...;\n\n\ntypedefå£°æ˜ï¼ˆtypedef declarationï¼‰\n\n\ndecltypeå£°æ˜ï¼ˆdecltype declarationï¼‰\n\n\nä¸å…¶ä»–å¼•ç”¨çš„åŒºåˆ«\nâ€‹      ä¼šäº§ç”Ÿå¼•ç”¨åˆæˆ\nT&amp; &amp; =&gt; T&amp;T&amp;&amp; &amp; =&gt; T&amp;T&amp; &amp;&amp; =&gt; T&amp;T&amp;&amp; &amp;&amp; =&gt; T&amp;&amp;\nè¯¥åˆæˆè§„åˆ™ç”¨æˆ·æ˜¯ä¸å…è®¸ä½¿ç”¨çš„ï¼Œåªæœ‰ç¼–è¯‘å™¨æ‰èƒ½å¤Ÿä½¿ç”¨è¿™ç§åˆæˆè§„åˆ™\n6.åˆ é™¤çš„å‡½æ•°(deleted function)\n\næŒ‡ä½¿ç”¨deleteçš„å‡½æ•° è¡¨ç¤ºè¿™ç±»å‡½æ•°è¢«ç¦ç”¨ ä¸èƒ½è¢«è°ƒç”¨\nå½“å°è¯•è°ƒç”¨ä¸€ä¸ªè¢«åˆ é™¤çš„å‡½æ•°æ—¶ï¼Œç¼–è¯‘å™¨å°†ä¼šæŠ¥é”™ï¼ŒæŒ‡å‡ºè¯¥å‡½æ•°æ˜¯è¢«åˆ é™¤çš„ï¼Œä»è€Œåœ¨ç¼–è¯‘æ—¶æœŸæä¾›äº†ä¸€ç§æ£€æŸ¥æœºåˆ¶ï¼Œé˜²æ­¢äº†ä¸æœŸæœ›çš„å‡½æ•°è°ƒç”¨\n\nç”¨é€”\n\n\né˜²æ­¢æ‹·è´:å¦‚æœä½ æœ‰ä¸€ä¸ªç±»ï¼Œä½ ä¸å¸Œæœ›å®ƒçš„å®ä¾‹è¢«æ‹·è´ï¼Œä½ å¯ä»¥åˆ é™¤æ‹·è´æ„é€ å‡½æ•°å’Œæ‹·è´èµ‹å€¼è¿ç®—ç¬¦ã€‚\n\n\né˜²æ­¢ç§»åŠ¨\n\n\né™åˆ¶æŸäº›å‡½æ•°çš„ä½¿ç”¨:å¯ä»¥åˆ é™¤é‚£äº›ä¸åº”è¯¥è¢«è°ƒç”¨çš„å‡½æ•°ç‰ˆæœ¬ï¼Œæ¯”å¦‚ç¦æ­¢æŸäº›ç±»å‹çš„å‚æ•°\n\n\nclass OnlyInt &#123;public:    void func(int) &#123;&#125;    void func(double) = delete; // åˆ é™¤æ¥å— double ç±»å‹çš„å‡½æ•°ç‰ˆæœ¬&#125;;\n7. å¤šçº¿ç¨‹ç¼–ç¨‹\n7.1 åŒæ­¥é—®é¢˜ï¼ˆSynchronization Issuesï¼‰\nåŒæ­¥é—®é¢˜å‘ç”Ÿåœ¨å½“å¤šä¸ªçº¿ç¨‹éœ€è¦è®¿é—®å…±äº«èµ„æºæˆ–æ•°æ®ï¼Œå¹¶ä¸”è¿™äº›è®¿é—®éœ€è¦ä»¥æŸç§ç‰¹å®šçš„é¡ºåºæ‰§è¡Œæ—¶ã€‚å¦‚æœåŒæ­¥ä¸å½“ï¼Œå¯èƒ½ä¼šå¯¼è‡´æ•°æ®ä¸ä¸€è‡´æˆ–ç«æ€æ¡ä»¶ï¼ˆRace Conditionsï¼‰ã€‚\nä¾‹å­ï¼š\n\n\nç«æ€æ¡ä»¶ï¼š\n\nä¸¤ä¸ªçº¿ç¨‹åŒæ—¶è¯»å–ä¸€ä¸ªå…±äº«å˜é‡ï¼Œç„¶ååŸºäºè¿™ä¸ªå˜é‡çš„å€¼è¿›è¡Œè®¡ç®—ï¼Œæœ€åå°†ç»“æœå†™å›ã€‚å¦‚æœä¸¤ä¸ªçº¿ç¨‹åŒæ—¶è¯»å–åˆ°ç›¸åŒçš„å€¼ï¼Œç„¶åéƒ½è¿›è¡Œè®¡ç®—å¹¶å†™å…¥ï¼Œé‚£ä¹ˆä¸€ä¸ªçº¿ç¨‹çš„å†™å…¥å¯èƒ½ä¼šè¦†ç›–å¦ä¸€ä¸ªçº¿ç¨‹çš„ç»“æœï¼Œå¯¼è‡´é”™è¯¯ã€‚\n\n\n\næ­»é”ï¼š\n\nçº¿ç¨‹AæŒæœ‰èµ„æº1å¹¶ç­‰å¾…èµ„æº2ï¼Œè€Œçº¿ç¨‹BæŒæœ‰èµ„æº2å¹¶ç­‰å¾…èµ„æº1ã€‚å¦‚æœçº¿ç¨‹Aå’ŒBéƒ½ä¸é‡Šæ”¾å®ƒä»¬æŒæœ‰çš„èµ„æºï¼Œé‚£ä¹ˆå®ƒä»¬å°†æ°¸è¿œç­‰å¾…å¯¹æ–¹é‡Šæ”¾èµ„æºï¼Œå¯¼è‡´ç¨‹åºæ— æ³•ç»§ç»­æ‰§è¡Œã€‚\n\n\n\né¥¥é¥¿ï¼š\n\nä¸€ä¸ªçº¿ç¨‹å› ä¸ºä¼˜å…ˆçº§è¾ƒä½ï¼Œå§‹ç»ˆæ— æ³•è·å¾—å®ƒéœ€è¦çš„èµ„æºï¼Œå³ä½¿è¿™äº›èµ„æºåœ¨å…¶ä»–çº¿ç¨‹ä¸­æ˜¯å¯ç”¨çš„ã€‚\n\n\n\nä¸ºäº†è§£å†³åŒæ­¥é—®é¢˜ï¼Œé€šå¸¸ä¼šä½¿ç”¨ä»¥ä¸‹æœºåˆ¶ï¼š\n\n\näº’æ–¥é”ï¼ˆMutexesï¼‰ï¼šç¡®ä¿åŒä¸€æ—¶é—´åªæœ‰ä¸€ä¸ªçº¿ç¨‹å¯ä»¥è®¿é—®å…±äº«èµ„æºã€‚\n\n\næ¡ä»¶å˜é‡ï¼ˆCondition Variablesï¼‰ï¼šå…è®¸çº¿ç¨‹åœ¨æŸäº›æ¡ä»¶ä¸‹æŒ‚èµ·æˆ–è¢«å”¤é†’ã€‚\n\n\nè¯»å†™é”ï¼ˆRead-Write Locksï¼‰ï¼šå…è®¸å¤šä¸ªè¯»æ“ä½œåŒæ—¶è¿›è¡Œï¼Œä½†å†™æ“ä½œéœ€è¦ç‹¬å è®¿é—®ã€‚\n\n\nåŸå­æ“ä½œï¼ˆAtomic Operationsï¼‰ï¼šæä¾›ä¸å¯åˆ†å‰²çš„æ“ä½œï¼Œç¡®ä¿åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸­å¯¹æ•°æ®çš„æ“ä½œæ˜¯å®‰å…¨çš„ã€‚\n\n\n7.2 å¹¶å‘é—®é¢˜ï¼ˆConcurrency Issuesï¼‰\nå¹¶å‘é—®é¢˜æ˜¯æŒ‡å¤šä¸ªçº¿ç¨‹åŒæ—¶æ‰§è¡Œï¼Œå¯èƒ½ä¼šå¯¼è‡´æ€§èƒ½é—®é¢˜æˆ–è€…éœ€è¦ç‰¹åˆ«è®¾è®¡ç®—æ³•æ¥ç¡®ä¿æ­£ç¡®æ€§çš„é—®é¢˜ã€‚\nä¾‹å­ï¼š\n\n\nçº¿ç¨‹å®‰å…¨ï¼š\n\nä¸€ä¸ªçº¿ç¨‹æ­£åœ¨ä¿®æ”¹ä¸€ä¸ªæ•°æ®ç»“æ„ï¼Œè€Œå¦ä¸€ä¸ªçº¿ç¨‹æ­£åœ¨è¯»å–è¯¥æ•°æ®ç»“æ„ã€‚å¦‚æœä¿®æ”¹æ“ä½œä¸æ˜¯åŸå­çš„ï¼Œé‚£ä¹ˆè¯»å–æ“ä½œå¯èƒ½ä¼šå¾—åˆ°ä¸ä¸€è‡´çš„æ•°æ®ã€‚\n\n\n\nå†…å­˜å¯è§æ€§ï¼š\n\nä¸€ä¸ªçº¿ç¨‹ä¿®æ”¹äº†ä¸€ä¸ªå…±äº«å˜é‡ï¼Œä½†è¿™ä¸ªä¿®æ”¹å¯¹å…¶ä»–çº¿ç¨‹æ¥è¯´ä¸æ˜¯ç«‹å³å¯è§çš„ã€‚è¿™å¯èƒ½å¯¼è‡´å…¶ä»–çº¿ç¨‹è¯»å–åˆ°æ—§å€¼ã€‚\n\n\n\næ€§èƒ½é—®é¢˜ï¼š\n\nè¿‡å¤šçš„çº¿ç¨‹ç«äº‰åŒä¸€ä¸ªèµ„æºå¯èƒ½ä¼šå¯¼è‡´æ€§èƒ½ä¸‹é™ï¼Œå› ä¸ºçº¿ç¨‹éœ€è¦é¢‘ç¹åœ°ç­‰å¾…èµ„æºå˜å¾—å¯ç”¨ã€‚\n\n\n\nä¸ºäº†è§£å†³å¹¶å‘é—®é¢˜ï¼Œé€šå¸¸ä¼šä½¿ç”¨ä»¥ä¸‹ç­–ç•¥ï¼š\n\n\nçº¿ç¨‹æ± ï¼šé™åˆ¶åŒæ—¶è¿è¡Œçš„çº¿ç¨‹æ•°é‡ï¼Œé¿å…åˆ›å»ºè¿‡å¤šçš„çº¿ç¨‹å¯¼è‡´çš„æ€§èƒ½é—®é¢˜ã€‚\n\n\næ— é”ç¼–ç¨‹ï¼ˆLock-Free Programmingï¼‰ï¼šä½¿ç”¨åŸå­æ“ä½œæ¥é¿å…é”çš„ä½¿ç”¨ï¼Œæé«˜å¹¶å‘æ€§èƒ½ã€‚\n\n\nå¹¶è¡Œç®—æ³•è®¾è®¡ï¼šè®¾è®¡å¯ä»¥åŒæ—¶åœ¨å¤šä¸ªå¤„ç†å™¨ä¸Šè¿è¡Œçš„ç®—æ³•ï¼Œä»¥åˆ©ç”¨å¤šæ ¸å¤„ç†å™¨çš„ä¼˜åŠ¿\n\n\n7.3 Mutexçš„ç§ç±»\n1. std::mutex ï¼ˆåŸºæœ¬äº’æ–¥é”ï¼‰\nstd::mutexæ˜¯C++æ ‡å‡†åº“ä¸­æä¾›çš„æœ€åŸºæœ¬çš„äº’æ–¥é”ç±»å‹ä¹‹ä¸€ã€‚å®ƒç”¨äºå®ç°çº¿ç¨‹é—´çš„äº’æ–¥è®¿é—®ï¼Œå³åœ¨ä¸€ä¸ªæ—¶é—´ç‚¹åªå…è®¸ä¸€ä¸ªçº¿ç¨‹è·å¾—é”ï¼Œå…¶ä»–çº¿ç¨‹éœ€è¦ç­‰å¾…é”è¢«é‡Šæ”¾æ‰èƒ½ç»§ç»­æ‰§è¡Œã€‚ä½¿ç”¨std::mutexå¯ä»¥ä¿è¯å¤šä¸ªçº¿ç¨‹å¯¹å…±äº«èµ„æºçš„è®¿é—®é¡ºåºï¼Œå¹¶é¿å…æ•°æ®ç«äº‰äº§ç”Ÿçš„é—®é¢˜ã€‚\nå¸¸ç”¨å‡½æ•°\n\n\nlock()\tå°è¯•è·å–äº’æ–¥é”ã€‚å¦‚æœæœªè¢«å…¶ä»–çº¿ç¨‹å ç”¨ï¼Œåˆ™å½“å‰çº¿ç¨‹è·å–é”ï¼›å¦åˆ™é˜»å¡ç­‰å¾…é”çš„é‡Šæ”¾ã€‚\n\n\nunlock()\té‡Šæ”¾äº’æ–¥é”ã€‚å¦‚æœå½“å‰çº¿ç¨‹æŒæœ‰é”ï¼Œåˆ™é‡Šæ”¾é”ï¼›å¦åˆ™è¡Œä¸ºæœªå®šä¹‰ã€‚\n\n\ntry_lock()\tå°è¯•è·å–äº’æ–¥é”ï¼Œä¸ä¼šé˜»å¡çº¿ç¨‹ã€‚å¦‚æœæœªè¢«å…¶ä»–çº¿ç¨‹å ç”¨ï¼Œåˆ™å½“å‰çº¿ç¨‹è·å–é”å¹¶è¿”å›trueï¼›å¦åˆ™è¿”å›falseã€‚\n\n\n2. std::recursive_mutex ï¼ˆé€’å½’äº’æ–¥é”ï¼‰\nstd::recursive_mutexæ˜¯C++æ ‡å‡†åº“ä¸­æä¾›çš„ä¸€ä¸ªé€’å½’äº’æ–¥é”ç±»å‹ï¼Œç”¨äºå®ç°çº¿ç¨‹é—´çš„äº’æ–¥è®¿é—®ã€‚ä¸std::mutexç›¸æ¯”ï¼Œstd::recursive_mutexå¯ä»¥å…è®¸åŒä¸€çº¿ç¨‹å¤šæ¬¡è·å–äº’æ–¥é”ï¼Œè€Œä¸ä¼šå¯¼è‡´æ­»é”ã€‚ç®€å•æ¥è¯´å°±æ˜¯å…è®¸åŒä¸€ä¸ªçº¿ç¨‹å¯¹äº’æ–¥é‡å¤šæ¬¡ä¸Šé”ï¼ˆå³é€’å½’ä¸Šé”ï¼‰ï¼Œæ¥è·å¾—å¯¹äº’æ–¥é‡å¯¹è±¡çš„å¤šå±‚æ‰€æœ‰æƒï¼Œé‡Šæ”¾äº’æ–¥é‡æ—¶éœ€è¦è°ƒç”¨ä¸è¯¥é”å±‚æ¬¡æ·±åº¦ç›¸åŒæ¬¡æ•°çš„ unlock()\nstd::recursive_mutexå®šä¹‰åœ¨å¤´æ–‡ä»¶ä¸­ã€‚ä¸std::mutexç±»ä¼¼ï¼Œå¯ä»¥é€šè¿‡å®šä¹‰std::recursive_mutexå¯¹è±¡æ¥åˆ›å»ºä¸€ä¸ªé€’å½’äº’æ–¥é”ã€‚ä¾‹å¦‚ï¼š\n#include &lt;mutex&gt;//è¿™é‡Œå®šä¹‰äº†ä¸€ä¸ªåä¸ºmtxçš„std::recursive_mutexå¯¹è±¡ï¼Œç”¨äºä¿æŠ¤æŸä¸ªå…±äº«èµ„æºçš„è®¿é—®ã€‚std::recursive_mutex mtx;\nå½“åŒä¸€çº¿ç¨‹å¤šæ¬¡å°è¯•è·å–std::recursive_mutexæ—¶ï¼Œå®ƒä¸ä¼šå¯¼è‡´æ­»é”ï¼Œè€Œæ˜¯å…è®¸åŒä¸€çº¿ç¨‹å¤šæ¬¡è·å–é”ï¼Œéœ€è¦ç›¸åº”æ¬¡æ•°çš„è§£é”æ“ä½œæ‰èƒ½å®Œå…¨é‡Šæ”¾é”ã€‚\n3. std::timed_mutex ï¼ˆé™æ—¶ç­‰å¾…äº’æ–¥é”ï¼‰\n4. std::recursive_timed_mutex  (é™æ—¶ç­‰å¾…é€’å½’äº’æ–¥é”)\n","categories":["ç¼–ç¨‹"],"tags":["C++"]},{"title":"C++ å³å€¼å¼•ç”¨ç›¸å…³è¦ç‚¹","url":"/2025/05/07/C++/C++%20%E5%8F%B3%E5%80%BC%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86%E7%82%B9%E6%B7%B1%E5%BA%A6%E8%A7%A3%E6%9E%90/","content":"\nåŒ…å«äº†å³å€¼å¼•ç”¨ ç§»åŠ¨è¯­ä¹‰ ç§»åŠ¨æ„é€ å‡½æ•° ç§»åŠ¨èµ‹å€¼è¿ç®—ç¬¦ move å®Œç¾è½¬å‘\n\n\nC++ å³å€¼ç›¸å…³çŸ¥è¯†ç‚¹æ·±åº¦è§£æ\nç›®å½•\n\n\næ¦‚è¿°\n\n\nå·¦å€¼ä¸å³å€¼çš„æ¦‚å¿µ\n\n\nå³å€¼å¼•ç”¨\n\n\nç§»åŠ¨è¯­ä¹‰\n\n\nç§»åŠ¨æ„é€ å‡½æ•°\n\n\nç§»åŠ¨èµ‹å€¼è¿ç®—ç¬¦\n\n\nstd::move è¯¦è§£\n\n\nå®Œç¾è½¬å‘ä¸ std::forward\n\n\nè®¾è®¡å“²å­¦ä¸æŠ€æœ¯åŸç†\n\n\nå®é™…åº”ç”¨åœºæ™¯\n\n\nå¸¸è§é™·é˜±ä¸æœ€ä½³å®è·µ\n\n\næ€»ç»“\n\n\næ¦‚è¿°\nC11 å¼•å…¥çš„å³å€¼å¼•ç”¨ã€ç§»åŠ¨è¯­ä¹‰å’Œå®Œç¾è½¬å‘æ˜¯ç°ä»£ C çš„æ ¸å¿ƒç‰¹æ€§ï¼Œå®ƒä»¬æå¤§åœ°æå‡äº†ç¨‹åºçš„æ€§èƒ½å’Œèµ„æºç®¡ç†æ•ˆç‡ã€‚è¿™äº›ç‰¹æ€§çš„è®¾è®¡ä½“ç°äº† C++â€œé›¶å¼€é”€æŠ½è±¡â€ çš„å“²å­¦æ€æƒ³ï¼Œå…è®¸å¼€å‘è€…åœ¨ä¸ç‰ºç‰²æ€§èƒ½çš„å‰æä¸‹ç¼–å†™æ›´ç®€æ´ã€æ›´å®‰å…¨çš„ä»£ç ã€‚\næ ¸å¿ƒä»·å€¼ï¼š\n\n\næ€§èƒ½ä¼˜åŒ–ï¼šé¿å…ä¸å¿…è¦çš„æ·±æ‹·è´ï¼Œå°† O (n) æ“ä½œé™ä¸º O (1)\n\n\nèµ„æºç®¡ç†ï¼šå®ç°èµ„æºæ‰€æœ‰æƒçš„å®‰å…¨è½¬ç§»\n\n\nä»£ç ç®€æ´ï¼šæ”¯æŒæ›´ä¼˜é›…çš„ API è®¾è®¡å’Œæ³›å‹ç¼–ç¨‹\n\n\nå·¦å€¼ä¸å³å€¼çš„æ¦‚å¿µ\nå·¦å€¼ï¼ˆLvalueï¼‰\nå®šä¹‰ç‰¹å¾ï¼š\n\n\næ‹¥æœ‰æŒä¹…èº«ä»½ï¼Œå¯ä»¥å–åœ°å€ï¼ˆ&amp; æ“ä½œç¬¦ï¼‰\n\n\né€šå¸¸æœ‰åç§°ï¼Œåœ¨å†…å­˜ä¸­æœ‰ç¡®å®šçš„ä½ç½®\n\n\nå¯ä»¥å‡ºç°åœ¨èµ‹å€¼è¿ç®—ç¬¦çš„å·¦ä¾§\n\n\nç¤ºä¾‹ï¼š\nint x = 10;          // xæ˜¯å·¦å€¼std::string s = &quot;hello&quot;;  // sæ˜¯å·¦å€¼int&amp; get_ref() &#123; return x; &#125;  // è¿”å›å·¦å€¼å¼•ç”¨\nå³å€¼ï¼ˆRvalueï¼‰\nå®šä¹‰ç‰¹å¾ï¼š\n\n\nä¸´æ—¶æ€§çš„ï¼Œå³å°†é”€æ¯çš„å¯¹è±¡\n\n\né€šå¸¸æ²¡æœ‰åç§°ï¼Œä¸èƒ½å–åœ°å€\n\n\nåªèƒ½å‡ºç°åœ¨èµ‹å€¼è¿ç®—ç¬¦çš„å³ä¾§\n\n\nç±»å‹åˆ†ç±»ï¼š\n\n\nçº¯å³å€¼ï¼ˆPure Rvalueï¼‰ï¼šå­—é¢é‡ã€è¡¨è¾¾å¼ç»“æœã€å‡½æ•°è¿”å›çš„éå¼•ç”¨ç±»å‹\n\n\nå°†äº¡å€¼ï¼ˆXvalueï¼‰ï¼šé€šè¿‡ std::move è½¬æ¢çš„å·¦å€¼ã€è¿”å›å³å€¼å¼•ç”¨çš„å‡½æ•°è°ƒç”¨\n\n\nç¤ºä¾‹ï¼š\n10;                  // çº¯å³å€¼ï¼šå­—é¢é‡x + y;               // çº¯å³å€¼ï¼šè¡¨è¾¾å¼ç»“æœstd::string(&quot;hello&quot;); // çº¯å³å€¼ï¼šä¸´æ—¶å¯¹è±¡std::move(s);        // å°†äº¡å€¼ï¼šé€šè¿‡moveè½¬æ¢\nå…³é”®åŒºåˆ«\n\n\n\nç‰¹æ€§\nå·¦å€¼\nå³å€¼\n\n\n\n\nå¯å¯»å€æ€§\nå¯ä»¥å–åœ°å€\nä¸èƒ½å–åœ°å€\n\n\næŒä¹…æ€§\næŒä¹…å­˜åœ¨\nä¸´æ—¶å­˜åœ¨\n\n\nèµ‹å€¼ä½ç½®\nå¯åœ¨å·¦ä¾§\nåªèƒ½åœ¨å³ä¾§\n\n\nå¼•ç”¨ç»‘å®š\nå·¦å€¼å¼•ç”¨ã€const å·¦å€¼å¼•ç”¨\nå³å€¼å¼•ç”¨ã€const å·¦å€¼å¼•ç”¨\n\n\n\nå³å€¼å¼•ç”¨\nåŸºæœ¬è¯­æ³•\nå³å€¼å¼•ç”¨ä½¿ç”¨&amp;&amp;ç¬¦å·è¡¨ç¤ºï¼Œä¸“é—¨ç”¨äºç»‘å®šåˆ°å³å€¼ï¼š\nint&amp;&amp; rref1 = 10;          // æ­£ç¡®ï¼šç»‘å®šåˆ°çº¯å³å€¼int&amp;&amp; rref2 = x + y;       // æ­£ç¡®ï¼šç»‘å®šåˆ°è¡¨è¾¾å¼ç»“æœint&amp;&amp; rref3 = std::move(x); // æ­£ç¡®ï¼šç»‘å®šåˆ°å°†äº¡å€¼\né‡è¦ç‰¹æ€§\n1. å»¶é•¿ä¸´æ—¶å¯¹è±¡ç”Ÿå‘½å‘¨æœŸ\nå³å€¼å¼•ç”¨å¯ä»¥å»¶é•¿ä¸´æ—¶å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸï¼Œä½¿å…¶ä¸å¼•ç”¨çš„ç”Ÿå‘½å‘¨æœŸä¸€è‡´ï¼š\nstd::string&amp;&amp; s = std::string(&quot;hello&quot;);// ä¸´æ—¶å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸè¢«å»¶é•¿åˆ°sçš„ä½œç”¨åŸŸç»“æŸ\n2. å³å€¼å¼•ç”¨æœ¬èº«æ˜¯å·¦å€¼\nè™½ç„¶ç»‘å®šåˆ°å³å€¼ï¼Œä½†å³å€¼å¼•ç”¨å˜é‡æœ¬èº«æ˜¯å·¦å€¼ï¼Œå› ä¸ºå®ƒæœ‰åç§°å¹¶ä¸”å¯ä»¥å–åœ°å€ï¼š\nint&amp;&amp; rref = 10;rref = 20;               // å¯ä»¥ä¿®æ”¹int* ptr = &amp;rref;        // å¯ä»¥å–åœ°å€\n3. å¼•ç”¨æŠ˜å è§„åˆ™\nåœ¨æ¨¡æ¿æ¨å¯¼ä¸­ï¼Œå¼•ç”¨çš„å¼•ç”¨ä¼šæŒ‰ç…§ä»¥ä¸‹è§„åˆ™æŠ˜å (ä»¥å°‘çš„ä¸ºå‡†)ï¼š\nT&amp; &amp;   â†’ T&amp;    // å·¦å€¼å¼•ç”¨ + å·¦å€¼å¼•ç”¨ = å·¦å€¼å¼•ç”¨T&amp; &amp;&amp;  â†’ T&amp;    // å·¦å€¼å¼•ç”¨ + å³å€¼å¼•ç”¨ = å·¦å€¼å¼•ç”¨T&amp;&amp; &amp;  â†’ T&amp;    // å³å€¼å¼•ç”¨ + å·¦å€¼å¼•ç”¨ = å·¦å€¼å¼•ç”¨T&amp;&amp; &amp;&amp; â†’ T&amp;&amp;   // å³å€¼å¼•ç”¨ + å³å€¼å¼•ç”¨ = å³å€¼å¼•ç”¨\nä¸‡èƒ½å¼•ç”¨ï¼ˆUniversal Referenceï¼‰\nåœ¨æ¨¡æ¿å‡½æ•°ä¸­ï¼ŒT&amp;&amp;è¢«ç§°ä¸ºä¸‡èƒ½å¼•ç”¨ï¼Œå¯ä»¥æ¥å—å·¦å€¼æˆ–å³å€¼ï¼š\ntemplate&lt;typename T&gt;void func(T&amp;&amp; param) &#123;    // æ ¹æ®å®å‚ç±»å‹ï¼ŒTä¼šè¢«æ¨å¯¼ä¸ºä¸åŒç±»å‹&#125;int x = 10;func(x);               // Tæ¨å¯¼ä¸ºint&amp;ï¼Œparamæ˜¯å·¦å€¼å¼•ç”¨ int&amp; &amp;&amp; -&gt; int&amp;func(10);              // Tæ¨å¯¼ä¸ºintï¼Œparamæ˜¯å³å€¼å¼•ç”¨  int&amp;&amp;   -&gt; int&amp;&amp;\nç§»åŠ¨è¯­ä¹‰\næ ¸å¿ƒæ€æƒ³\nç§»åŠ¨è¯­ä¹‰çš„æœ¬è´¨æ˜¯èµ„æºæ‰€æœ‰æƒçš„è½¬ç§»ï¼Œè€Œä¸æ˜¯æ•°æ®çš„å¤åˆ¶ã€‚å®ƒè§£å†³äº† C++98/03 ä¸­ä¸´æ—¶å¯¹è±¡æ‹·è´æ•ˆç‡ä½ä¸‹çš„é—®é¢˜ã€‚\nä¼ ç»Ÿæ‹·è´ vs ç§»åŠ¨ï¼š\n// ä¼ ç»Ÿæ‹·è´ï¼šæ·±æ‹·è´ï¼ŒO(n)æ—¶é—´å¤æ‚åº¦std::vector&lt;int&gt; v1 = &#123;1, 2, 3, 4, 5&#125;;std::vector&lt;int&gt; v2 = v1;  // æ‹·è´æ‰€æœ‰å…ƒç´ // ç§»åŠ¨è¯­ä¹‰ï¼šèµ„æºè½¬ç§»ï¼ŒO(1)æ—¶é—´å¤æ‚åº¦std::vector&lt;int&gt; v3 = std::move(v1); // åªéœ€è½¬ç§»æŒ‡é’ˆ\nå®ç°åŸç†\nç§»åŠ¨è¯­ä¹‰é€šè¿‡ç§»åŠ¨æ„é€ å‡½æ•°å’Œç§»åŠ¨èµ‹å€¼è¿ç®—ç¬¦å®ç°ï¼Œè¿™ä¸¤ä¸ªç‰¹æ®Šæˆå‘˜å‡½æ•°æ¥å—å³å€¼å¼•ç”¨å‚æ•°ã€‚\nä½•æ—¶è§¦å‘ç§»åŠ¨\n\n\nå‡½æ•°è¿”å›ä¸´æ—¶å¯¹è±¡æ—¶\n\n\nå¯¹è±¡åˆå§‹åŒ–æ—¶ä½¿ç”¨å³å€¼\n\n\nä½¿ç”¨ std::move æ˜¾å¼è½¬æ¢æ—¶\n\n\næ ‡å‡†åº“å®¹å™¨çš„æŸäº›æ“ä½œ\n\n\nç§»åŠ¨æ„é€ å‡½æ•°\nåŸºæœ¬å½¢å¼\nç§»åŠ¨æ„é€ å‡½æ•°æ¥å—ä¸€ä¸ªå³å€¼å¼•ç”¨å‚æ•°ï¼Œå®ç°èµ„æºçš„è½¬ç§»ï¼š\nclass MyString &#123;private:    char* data_;    size_t size_;public:    // ç§»åŠ¨æ„é€ å‡½æ•°    MyString(MyString&amp;&amp; other) noexcept        : data_(other.data_), size_(other.size_) &#123;        // å°†æºå¯¹è±¡ç½®äºæœ‰æ•ˆä½†æœªå®šä¹‰çš„çŠ¶æ€        other.data_ = nullptr;        other.size_ = 0;        std::cout &lt;&lt; &quot;Move constructor called&quot; &lt;&lt; std::endl;    &#125;&#125;;\nå…³é”®è¦ç‚¹\n1. noexcept è¯´æ˜ç¬¦\nå¼ºçƒˆå»ºè®®ä¸ºç§»åŠ¨æ„é€ å‡½æ•°æ·»åŠ noexceptï¼Œè¿™æœ‰åŠ©äºï¼š\n\n\næé«˜æ€§èƒ½ï¼ˆç¼–è¯‘å™¨å¯ä»¥è¿›è¡Œæ›´å¤šä¼˜åŒ–ï¼‰\n\n\nç¡®ä¿æ ‡å‡†åº“æ“ä½œçš„å¼‚å¸¸å®‰å…¨æ€§\n\n\né¿å…å®¹å™¨åœ¨ç§»åŠ¨æ—¶å›é€€åˆ°æ‹·è´\n\n\n2. æºå¯¹è±¡çŠ¶æ€\nç§»åŠ¨åï¼Œæºå¯¹è±¡å¿…é¡»å¤„äºæœ‰æ•ˆä½†æœªå®šä¹‰çš„çŠ¶æ€ï¼š\n\n\nå¯ä»¥å®‰å…¨åœ°ææ„\n\n\nå¯ä»¥èµ‹å€¼æ–°å€¼\n\n\nä½†ä¸èƒ½ä¾èµ–å…¶å½“å‰å€¼\n\n\n3. ä¸æ‹·è´æ„é€ å‡½æ•°çš„å…³ç³»\nå½“ç±»åŒæ—¶æä¾›æ‹·è´æ„é€ å‡½æ•°å’Œç§»åŠ¨æ„é€ å‡½æ•°æ—¶ï¼š\n\n\nå·¦å€¼åˆå§‹åŒ–æ—¶è°ƒç”¨æ‹·è´æ„é€ å‡½æ•°\n\n\nå³å€¼åˆå§‹åŒ–æ—¶è°ƒç”¨ç§»åŠ¨æ„é€ å‡½æ•°\n\n\né»˜è®¤ç§»åŠ¨æ„é€ å‡½æ•°\nC++11 åŠä»¥åï¼Œå¦‚æœæ»¡è¶³ä»¥ä¸‹æ¡ä»¶ï¼Œç¼–è¯‘å™¨ä¼šè‡ªåŠ¨ç”Ÿæˆé»˜è®¤ç§»åŠ¨æ„é€ å‡½æ•°ï¼š\n\n\nç±»æ²¡æœ‰ç”¨æˆ·å®šä¹‰çš„æ‹·è´æ„é€ å‡½æ•°ã€æ‹·è´èµ‹å€¼è¿ç®—ç¬¦ã€ç§»åŠ¨èµ‹å€¼è¿ç®—ç¬¦æˆ–ææ„å‡½æ•°\n\n\næ‰€æœ‰éé™æ€æ•°æ®æˆå‘˜éƒ½å¯ä»¥ç§»åŠ¨æ„é€ \n\n\nclass MyClass &#123;    std::string name_;    std::vector&lt;int&gt; data_;    // ç¼–è¯‘å™¨ä¼šè‡ªåŠ¨ç”Ÿæˆé»˜è®¤ç§»åŠ¨æ„é€ å‡½æ•°&#125;;\nç§»åŠ¨èµ‹å€¼è¿ç®—ç¬¦\nåŸºæœ¬å½¢å¼\nç§»åŠ¨èµ‹å€¼è¿ç®—ç¬¦ä¸ç§»åŠ¨æ„é€ å‡½æ•°ç±»ä¼¼ï¼Œä½†ç”¨äºå·²å­˜åœ¨å¯¹è±¡çš„èµ‹å€¼ï¼š\nclass MyString &#123;public:    // ç§»åŠ¨èµ‹å€¼è¿ç®—ç¬¦    MyString&amp; operator=(MyString&amp;&amp; other) noexcept &#123;        if (this != &amp;other) &#123;  // é˜²æ­¢è‡ªèµ‹å€¼            // é‡Šæ”¾å½“å‰å¯¹è±¡çš„èµ„æº            delete[] data_;                        // è½¬ç§»æºå¯¹è±¡çš„èµ„æº            data_ = other.data_;            size_ = other.size_;                        // ç½®ç©ºæºå¯¹è±¡            other.data_ = nullptr;            other.size_ = 0;        &#125;        std::cout &lt;&lt; &quot;Move assignment called&quot; &lt;&lt; std::endl;        return *this;    &#125;&#125;;\nå®ç°è¦ç‚¹\n1. è‡ªèµ‹å€¼æ£€æŸ¥\nå¿…é¡»æ£€æŸ¥è‡ªèµ‹å€¼ï¼Œé¿å…é‡Šæ”¾æ­£åœ¨ä½¿ç”¨çš„èµ„æºï¼š\nif (this != &amp;other) &#123;    // æ‰§è¡Œç§»åŠ¨æ“ä½œ&#125;\n2. èµ„æºé‡Šæ”¾é¡ºåº\næ­£ç¡®çš„é¡ºåºåº”è¯¥æ˜¯ï¼š\n\n\næ£€æŸ¥è‡ªèµ‹å€¼\n\n\né‡Šæ”¾å½“å‰å¯¹è±¡èµ„æº\n\n\nè½¬ç§»æºå¯¹è±¡èµ„æº\n\n\nç½®ç©ºæºå¯¹è±¡\n\n\né»˜è®¤ç§»åŠ¨èµ‹å€¼è¿ç®—ç¬¦\nä¸ç§»åŠ¨æ„é€ å‡½æ•°ç±»ä¼¼ï¼Œç¼–è¯‘å™¨ä¼šåœ¨æ»¡è¶³æ¡ä»¶æ—¶è‡ªåŠ¨ç”Ÿæˆé»˜è®¤ç§»åŠ¨èµ‹å€¼è¿ç®—ç¬¦ã€‚\nstd::move è¯¦è§£\nåŠŸèƒ½è¯´æ˜\nstd::moveæ˜¯ä¸€ä¸ªæ ‡å‡†åº“å‡½æ•°ï¼Œç”¨äºå°†å·¦å€¼è½¬æ¢ä¸ºå³å€¼å¼•ç”¨ï¼Œä»è€Œè§¦å‘ç§»åŠ¨è¯­ä¹‰ã€‚\næ³¨æ„ï¼š std::moveæœ¬èº«å¹¶ä¸ç§»åŠ¨ä»»ä½•æ•°æ®ï¼Œå®ƒåªæ˜¯ä¸€ä¸ªç±»å‹è½¬æ¢å·¥å…·ã€‚\nå®ç°åŸç†\ntemplate&lt;typename T&gt;typename std::remove_reference&lt;T&gt;::type&amp;&amp; move(T&amp;&amp; t) noexcept &#123;    return static_cast&lt;typename std::remove_reference&lt;T&gt;::type&amp;&amp;&gt;(t);&#125;\nä½¿ç”¨åœºæ™¯\n1. æ˜¾å¼è§¦å‘ç§»åŠ¨è¯­ä¹‰\nstd::vector&lt;int&gt; v1 = &#123;1, 2, 3&#125;;std::vector&lt;int&gt; v2 = std::move(v1);  // è§¦å‘ç§»åŠ¨æ„é€ v1 = std::move(v2);                   // è§¦å‘ç§»åŠ¨èµ‹å€¼\n2. åœ¨å®¹å™¨ä¸­é«˜æ•ˆæ’å…¥å…ƒç´ \nstd::vector&lt;std::string&gt; vec;std::string s = &quot;hello&quot;;vec.push_back(s);                // æ‹·è´æ„é€ vec.push_back(std::move(s));     // ç§»åŠ¨æ„é€ ï¼Œså˜ä¸ºç©º\n3. å‡½æ•°è¿”å›å€¼ä¼˜åŒ–\nstd::vector&lt;int&gt; create_vector() &#123;    std::vector&lt;int&gt; v = &#123;1, 2, 3, 4, 5&#125;;    return std::move(v);  // åœ¨æŸäº›æƒ…å†µä¸‹æœ‰åŠ©äºè¿”å›å€¼ä¼˜åŒ–&#125;\nä½¿ç”¨æ³¨æ„äº‹é¡¹\n1. ç§»åŠ¨åçš„å¯¹è±¡çŠ¶æ€\nç§»åŠ¨åï¼Œæºå¯¹è±¡å¤„äºæœ‰æ•ˆä½†æœªå®šä¹‰çš„çŠ¶æ€ï¼Œä¸åº”å†ä½¿ç”¨å…¶å€¼ï¼š\nstd::string s = &quot;hello&quot;;std::string s2 = std::move(s);// sç°åœ¨æ˜¯ç©ºçš„ï¼Œä½†å¯ä»¥å®‰å…¨åœ°ææ„æˆ–èµ‹å€¼s = &quot;world&quot;;  // è¿™æ˜¯å…è®¸çš„\n2. ä¸è¦ç§»åŠ¨ const å¯¹è±¡\nconst å¯¹è±¡ä¸èƒ½è¢«ç§»åŠ¨ï¼Œå› ä¸ºç§»åŠ¨é€šå¸¸éœ€è¦ä¿®æ”¹æºå¯¹è±¡ï¼š\nconst std::string s = &quot;hello&quot;;std::string s2 = std::move(s);  // è¿™é‡Œè°ƒç”¨çš„æ˜¯æ‹·è´æ„é€ å‡½æ•°\nå®Œç¾è½¬å‘ä¸ std::forward\né—®é¢˜èƒŒæ™¯\nåœ¨æ¨¡æ¿ç¼–ç¨‹ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸éœ€è¦å°†å‚æ•°ä¼ é€’ç»™å…¶ä»–å‡½æ•°ã€‚å®Œç¾è½¬å‘çš„ç›®æ ‡æ˜¯ä¿æŒå‚æ•°çš„åŸå§‹å€¼ç±»åˆ«ï¼š\n\n\nå¦‚æœä¼ å…¥å·¦å€¼ï¼Œç›®æ ‡å‡½æ•°æ¥æ”¶åˆ°å·¦å€¼\n\n\nå¦‚æœä¼ å…¥å³å€¼ï¼Œç›®æ ‡å‡½æ•°æ¥æ”¶åˆ°å³å€¼\n\n\nå®Œç¾è½¬å‘çš„å®ç°\n1. ä¸‡èƒ½å¼•ç”¨ + std::forward\ntemplate&lt;typename T&gt;void wrapper(T&amp;&amp; arg) &#123;    target(std::forward&lt;T&gt;(arg));  // å®Œç¾è½¬å‘&#125;\n2. å¼•ç”¨æŠ˜å æœºåˆ¶\nå®Œç¾è½¬å‘ä¾èµ–äºå¼•ç”¨æŠ˜å è§„åˆ™ï¼š\n// å½“ä¼ å…¥å·¦å€¼int&amp;æ—¶Tè¢«æ¨å¯¼ä¸ºint&amp;ï¼ŒT&amp;&amp;å˜ä¸ºint&amp; &amp;&amp; â†’ int&amp;ï¼ˆå·¦å€¼å¼•ç”¨ï¼‰// å½“ä¼ å…¥å³å€¼intæ—¶Tè¢«æ¨å¯¼ä¸ºintï¼ŒT&amp;&amp;å˜ä¸ºint&amp;&amp;ï¼ˆå³å€¼å¼•ç”¨ï¼‰\nstd::forward è¯¦è§£\nå®ç°åŸç†\ntemplate&lt;typename T&gt;T&amp;&amp; forward(typename std::remove_reference&lt;T&gt;::type&amp; arg) noexcept &#123;    return static_cast&lt;T&amp;&amp;&gt;(arg);&#125;template&lt;typename T&gt;T&amp;&amp; forward(typename std::remove_reference&lt;T&gt;::type&amp;&amp; arg) noexcept &#123;    return static_cast&lt;T&amp;&amp;&gt;(arg);&#125;\nä½¿ç”¨ç¤ºä¾‹\nvoid process(int&amp; lref) &#123;    std::cout &lt;&lt; &quot;Processing lvalue reference&quot; &lt;&lt; std::endl;&#125;void process(int&amp;&amp; rref) &#123;    std::cout &lt;&lt; &quot;Processing rvalue reference&quot; &lt;&lt; std::endl;&#125;template&lt;typename T&gt;void wrapper(T&amp;&amp; arg) &#123;    process(std::forward&lt;T&gt;(arg));&#125;int main() &#123;    int x = 10;    wrapper(x);       // è°ƒç”¨process(int&amp;)    wrapper(20);      // è°ƒç”¨process(int&amp;&amp;)    wrapper(std::move(x));  // è°ƒç”¨process(int&amp;&amp;)&#125;\nå®é™…åº”ç”¨\n1. å·¥å‚å‡½æ•°\ntemplate&lt;typename T, typename... Args&gt;std::unique_ptr&lt;T&gt; make_unique(Args&amp;&amp;... args) &#123;    return std::unique_ptr&lt;T&gt;(new T(std::forward&lt;Args&gt;(args)...));&#125;\n2. å®¹å™¨çš„ emplace_back\ntemplate&lt;typename... Args&gt;void emplace_back(Args&amp;&amp;... args) &#123;    // ç›´æ¥åœ¨å®¹å™¨ä¸­æ„é€ å¯¹è±¡ï¼Œé¿å…æ‹·è´    construct_element(std::forward&lt;Args&gt;(args)...);&#125;\nè®¾è®¡å“²å­¦ä¸æŠ€æœ¯åŸç†\nC++ è®¾è®¡å“²å­¦\n1. é›¶å¼€é”€æŠ½è±¡ï¼ˆZero-overhead Abstractionï¼‰\nå³å€¼ç›¸å…³ç‰¹æ€§å®Œç¾ä½“ç°äº† C++ çš„æ ¸å¿ƒè®¾è®¡å“²å­¦ï¼š\n\n\nä¸ä½¿ç”¨æ—¶æ— å¼€é”€ï¼šä¸ä½¿ç”¨ç§»åŠ¨è¯­ä¹‰æ—¶ï¼Œç¨‹åºè¡Œä¸ºä¸ C++98 ä¸€è‡´\n\n\nä½¿ç”¨æ—¶æ¥è¿‘æ‰‹å†™ä»£ç æ€§èƒ½ï¼šç§»åŠ¨æ“ä½œçš„æ€§èƒ½æ¥è¿‘æ‰‹åŠ¨èµ„æºç®¡ç†\n\n\n2. ç³»ç»Ÿçº§æ§åˆ¶\nC++ å…è®¸å¼€å‘è€…ç›´æ¥æ§åˆ¶å†…å­˜å’Œèµ„æºï¼š\n\n\nç§»åŠ¨è¯­ä¹‰è®©å¼€å‘è€…èƒ½å¤Ÿæ˜¾å¼ç®¡ç†èµ„æºæ‰€æœ‰æƒ\n\n\nå®Œç¾è½¬å‘ä¿æŒäº†å¯¹å‚æ•°ä¼ é€’çš„ç²¾ç¡®æ§åˆ¶\n\n\n3. å…¼å®¹æ€§ä¸æ¼”è¿›å¹³è¡¡\nC++11 åœ¨å¼•å…¥æ–°ç‰¹æ€§æ—¶ä¿æŒäº†ä¸æ—§ä»£ç çš„å…¼å®¹æ€§ï¼š\n\n\næ—§ä»£ç å¯ä»¥ç»§ç»­ä½¿ç”¨æ‹·è´è¯­ä¹‰\n\n\næ–°ä»£ç å¯ä»¥é€æ­¥é‡‡ç”¨ç§»åŠ¨è¯­ä¹‰\n\n\næŠ€æœ¯åŸç†æ·±åº¦è§£æ\n1. å€¼ç±»åˆ«ç³»ç»Ÿ\nC++11 å°†è¡¨è¾¾å¼åˆ†ä¸ºä¸‰ä¸ªä¸»è¦ç±»åˆ«ï¼š\n\n\nå·¦å€¼ï¼ˆLvalueï¼‰ï¼šæœ‰èº«ä»½ï¼Œå¯è¢«ä¿®æ”¹\n\n\nçº¯å³å€¼ï¼ˆPrvalueï¼‰ï¼šä¸´æ—¶å€¼ï¼Œè®¡ç®—ç»“æœ\n\n\nå°†äº¡å€¼ï¼ˆXvalueï¼‰ï¼šå³å°†è¢«ç§»åŠ¨çš„å¯¹è±¡\n\n\nè¿™ç§åˆ†ç±»ä¸ºç§»åŠ¨è¯­ä¹‰æä¾›äº†ç†è®ºåŸºç¡€ã€‚\n2. å¼•ç”¨ç±»å‹ç³»ç»Ÿ\nC++ æœ‰å››ç§å¼•ç”¨ç±»å‹ï¼š\n\n\nå·¦å€¼å¼•ç”¨ï¼ˆT&amp;ï¼‰ï¼šç»‘å®šåˆ°å·¦å€¼\n\n\nå³å€¼å¼•ç”¨ï¼ˆT&amp;&amp;ï¼‰ï¼šç»‘å®šåˆ°å³å€¼\n\n\nconst å·¦å€¼å¼•ç”¨ï¼ˆconst T&amp;ï¼‰ï¼šç»‘å®šåˆ°ä»»ä½•å€¼\n\n\nconst å³å€¼å¼•ç”¨ï¼ˆconst T&amp;&amp;ï¼‰ï¼šç»‘å®šåˆ°å³å€¼ï¼Œä½†ä¸èƒ½ä¿®æ”¹\n\n\n3. ç‰¹æ®Šæˆå‘˜å‡½æ•°è§„åˆ™\nC++11 åŠä»¥åçš„ç‰¹æ®Šæˆå‘˜å‡½æ•°ç”Ÿæˆè§„åˆ™ï¼š\n\n\n\nç”¨æˆ·å®šä¹‰çš„æˆå‘˜å‡½æ•°\né»˜è®¤ç”Ÿæˆçš„æˆå‘˜å‡½æ•°\n\n\n\n\næ— \nå…¨éƒ¨ 5 ä¸ªç‰¹æ®Šæˆå‘˜å‡½æ•°\n\n\næ‹·è´æ„é€  / èµ‹å€¼\nä¸ç”Ÿæˆç§»åŠ¨æ„é€  / èµ‹å€¼\n\n\nç§»åŠ¨æ„é€  / èµ‹å€¼\nä¸ç”Ÿæˆæ‹·è´æ„é€  / èµ‹å€¼\n\n\nææ„å‡½æ•°\nä¸ç”Ÿæˆç§»åŠ¨æ„é€  / èµ‹å€¼\n\n\n\nå®é™…åº”ç”¨åœºæ™¯\n1. æ ‡å‡†åº“å®¹å™¨ä¼˜åŒ–\nstd::vector&lt;std::string&gt; vec;std::string s = &quot;hello world&quot;;// ä¼ ç»Ÿæ–¹å¼ï¼šæ‹·è´æ„é€ vec.push_back(s);// ä¼˜åŒ–æ–¹å¼ï¼šç§»åŠ¨æ„é€ vec.push_back(std::move(s));// æœ€ä½³æ–¹å¼ï¼šç›´æ¥æ„é€ ï¼ˆå®Œç¾è½¬å‘ï¼‰vec.emplace_back(&quot;hello world&quot;);\n2. æ™ºèƒ½æŒ‡é’ˆç®¡ç†\n// std::unique_ptråªèƒ½ç§»åŠ¨ï¼Œä¸èƒ½æ‹·è´std::unique_ptr&lt;int&gt; p1(new int(42));std::unique_ptr&lt;int&gt; p2 = std::move(p1);  // ç§»åŠ¨æ‰€æœ‰æƒ// std::shared_ptrå¯ä»¥æ‹·è´ï¼Œä½†ç§»åŠ¨æ›´é«˜æ•ˆstd::shared_ptr&lt;int&gt; p3(new int(42));std::shared_ptr&lt;int&gt; p4 = std::move(p3);  // ç§»åŠ¨ï¼Œå¼•ç”¨è®¡æ•°ä¸å˜\n3. å‡½æ•°è¿”å›å€¼ä¼˜åŒ–\n// ä¼ ç»Ÿæ–¹å¼ï¼šå¯èƒ½äº§ç”Ÿä¸´æ—¶å¯¹è±¡std::vector&lt;int&gt; create_big_vector() &#123;    std::vector&lt;int&gt; v(1000000);    return v;  // RVOä¼˜åŒ–&#125;// ç§»åŠ¨è¯­ä¹‰ï¼šæ˜ç¡®è½¬ç§»æ‰€æœ‰æƒstd::vector&lt;int&gt; create_big_vector_move() &#123;    std::vector&lt;int&gt; v(1000000);    return std::move(v);  // åœ¨æŸäº›æƒ…å†µä¸‹æœ‰ç”¨&#125;\n4. è‡ªå®šä¹‰å®¹å™¨å®ç°\ntemplate&lt;typename T&gt;class MyVector &#123;private:    T* data_;    size_t size_;    size_t capacity_;public:    // ç§»åŠ¨æ„é€ å‡½æ•°    MyVector(MyVector&amp;&amp; other) noexcept        : data_(other.data_), size_(other.size_), capacity_(other.capacity_) &#123;        other.data_ = nullptr;        other.size_ = 0;        other.capacity_ = 0;    &#125;    // ç§»åŠ¨èµ‹å€¼è¿ç®—ç¬¦    MyVector&amp; operator=(MyVector&amp;&amp; other) noexcept &#123;        if (this != &amp;other) &#123;            delete[] data_;            data_ = other.data_;            size_ = other.size_;            capacity_ = other.capacity_;                        other.data_ = nullptr;            other.size_ = 0;            other.capacity_ = 0;        &#125;        return *this;    &#125;    // å®Œç¾è½¬å‘çš„emplace_back    template&lt;typename... Args&gt;    void emplace_back(Args&amp;&amp;... args) &#123;        if (size_ &gt;= capacity_) &#123;            reserve(capacity_ == 0 ? 1 : capacity_ * 2);        &#125;        new(&amp;data_[size_]) T(std::forward&lt;Args&gt;(args)...);        size_++;    &#125;&#125;;\n5. èµ„æºç®¡ç†ç±»\nclass FileHandle &#123;private:    FILE* handle_;public:    // æ„é€ å‡½æ•°    explicit FileHandle(const char* filename, const char* mode)        : handle_(fopen(filename, mode)) &#123;        if (!handle_) &#123;            throw std::runtime_error(&quot;Failed to open file&quot;);        &#125;    &#125;    // ç§»åŠ¨æ„é€ å‡½æ•°    FileHandle(FileHandle&amp;&amp; other) noexcept        : handle_(other.handle_) &#123;        other.handle_ = nullptr;    &#125;    // ç§»åŠ¨èµ‹å€¼è¿ç®—ç¬¦    FileHandle&amp; operator=(FileHandle&amp;&amp; other) noexcept &#123;        if (this != &amp;other) &#123;            close();            handle_ = other.handle_;            other.handle_ = nullptr;        &#125;        return *this;    &#125;    // ç¦æ­¢æ‹·è´    FileHandle(const FileHandle&amp;) = delete;    FileHandle&amp; operator=(const FileHandle&amp;) = delete;    // ææ„å‡½æ•°    ~FileHandle() &#123;        close();    &#125;    void close() &#123;        if (handle_) &#123;            fclose(handle_);            handle_ = nullptr;        &#125;    &#125;&#125;;\nå¸¸è§é™·é˜±ä¸æœ€ä½³å®è·µ\nå¸¸è§é™·é˜±\n1. è¯¯ç”¨ std::move\né—®é¢˜ï¼š ç§»åŠ¨ä»ç„¶éœ€è¦ä½¿ç”¨çš„å¯¹è±¡\nstd::string s = &quot;hello&quot;;process(std::move(s));  // é”™è¯¯ï¼šå¦‚æœprocesséœ€è¦sçš„å€¼std::cout &lt;&lt; s;         // sç°åœ¨å¯èƒ½æ˜¯ç©ºçš„\nè§£å†³æ–¹æ¡ˆï¼š åªç§»åŠ¨ä¸å†ä½¿ç”¨çš„å¯¹è±¡\n2. ç§»åŠ¨ const å¯¹è±¡\né—®é¢˜ï¼š const å¯¹è±¡ä¼šè°ƒç”¨æ‹·è´è€Œä¸æ˜¯ç§»åŠ¨\nconst std::string s = &quot;hello&quot;;std::string s2 = std::move(s);  // è°ƒç”¨æ‹·è´æ„é€ å‡½æ•°\nè§£å†³æ–¹æ¡ˆï¼š ä¸è¦ç§»åŠ¨ const å¯¹è±¡ï¼Œæˆ–è€…æä¾› const ç‰ˆæœ¬çš„ç§»åŠ¨æ“ä½œ\n3. å¿˜è®°å¤„ç†è‡ªèµ‹å€¼\né—®é¢˜ï¼š ç§»åŠ¨èµ‹å€¼è¿ç®—ç¬¦ä¸­æ²¡æœ‰æ£€æŸ¥è‡ªèµ‹å€¼\nMyClass&amp; operator=(MyClass&amp;&amp; other) noexcept &#123;    delete[] data_;            // é”™è¯¯ï¼šå¦‚æœthis == &amp;otherï¼Œä¼šé‡Šæ”¾è‡ªå·±çš„èµ„æº    data_ = other.data_;    other.data_ = nullptr;    return *this;&#125;\nè§£å†³æ–¹æ¡ˆï¼š æ€»æ˜¯æ£€æŸ¥è‡ªèµ‹å€¼\nMyClass&amp; operator=(MyClass&amp;&amp; other) noexcept &#123;    if (this != &amp;other) &#123;        delete[] data_;        data_ = other.data_;        other.data_ = nullptr;    &#125;    return *this;&#125;\n4. ç§»åŠ¨åä½¿ç”¨æºå¯¹è±¡\né—®é¢˜ï¼š å‡è®¾ç§»åŠ¨åçš„å¯¹è±¡ä»æœ‰æœ‰æ•ˆå€¼\nstd::vector&lt;int&gt; v1 = &#123;1, 2, 3&#125;;std::vector&lt;int&gt; v2 = std::move(v1);for (int x : v1) &#123;  // æœªå®šä¹‰è¡Œä¸ºï¼šv1å¯èƒ½ä¸ºç©º    // ...&#125;\nè§£å†³æ–¹æ¡ˆï¼š ç§»åŠ¨åä¸è¦ä¾èµ–æºå¯¹è±¡çš„å€¼\næœ€ä½³å®è·µ\n1. æä¾›å®Œæ•´çš„ç§»åŠ¨æ”¯æŒ\nå½“æä¾›ç§»åŠ¨æ„é€ å‡½æ•°æ—¶ï¼Œä¹Ÿåº”è¯¥æä¾›ç§»åŠ¨èµ‹å€¼è¿ç®—ç¬¦ï¼š\nclass MyClass &#123;public:    // ç§»åŠ¨æ„é€ å‡½æ•°    MyClass(MyClass&amp;&amp; other) noexcept &#123; /* ... */ &#125;        // ç§»åŠ¨èµ‹å€¼è¿ç®—ç¬¦    MyClass&amp; operator=(MyClass&amp;&amp; other) noexcept &#123; /* ... */ &#125;        // æ‹·è´æ„é€ å‡½æ•°    MyClass(const MyClass&amp; other) &#123; /* ... */ &#125;        // æ‹·è´èµ‹å€¼è¿ç®—ç¬¦    MyClass&amp; operator=(const MyClass&amp; other) &#123; /* ... */ &#125;&#125;;\n2. ä½¿ç”¨ noexcept\nä¸ºç§»åŠ¨æ“ä½œæ·»åŠ  noexcept è¯´æ˜ç¬¦ï¼š\nclass MyClass &#123;public:    MyClass(MyClass&amp;&amp; other) noexcept &#123; /* ... */ &#125;    MyClass&amp; operator=(MyClass&amp;&amp; other) noexcept &#123; /* ... */ &#125;&#125;;\n3. ä¼˜å…ˆä½¿ç”¨ emplace è€Œé push\nåœ¨å®¹å™¨ä¸­ä¼˜å…ˆä½¿ç”¨ emplace ç³»åˆ—å‡½æ•°ï¼š\nstd::vector&lt;std::string&gt; vec;// è¾ƒå·®ï¼šåˆ›å»ºä¸´æ—¶å¯¹è±¡ç„¶åç§»åŠ¨vec.push_back(std::string(&quot;hello&quot;));// è¾ƒå¥½ï¼šç›´æ¥åœ¨å®¹å™¨ä¸­æ„é€ vec.emplace_back(&quot;hello&quot;);\n4. åˆç†ä½¿ç”¨å®Œç¾è½¬å‘\nåœ¨æ¨¡æ¿å‡½æ•°ä¸­æ­£ç¡®ä½¿ç”¨å®Œç¾è½¬å‘ï¼š\ntemplate&lt;typename T&gt;void wrapper(T&amp;&amp; arg) &#123;    // æ­£ç¡®ï¼šä½¿ç”¨std::forwardä¿æŒå€¼ç±»åˆ«    process(std::forward&lt;T&gt;(arg));        // é”™è¯¯ï¼šargæ€»æ˜¯å·¦å€¼    process(arg);&#125;\n5. éµå¾ª â€œä¸‰äº”æ³•åˆ™â€\nç°ä»£ C++ çš„ â€œä¸‰äº”æ³•åˆ™â€ï¼š\n\n\nå¦‚æœå®šä¹‰äº†ææ„å‡½æ•°ï¼Œä¹Ÿåº”è¯¥å®šä¹‰æ‹·è´æ„é€ å‡½æ•°å’Œæ‹·è´èµ‹å€¼è¿ç®—ç¬¦\n\n\nå¦‚æœå®šä¹‰äº†ç§»åŠ¨æ„é€ å‡½æ•°ï¼Œä¹Ÿåº”è¯¥å®šä¹‰ç§»åŠ¨èµ‹å€¼è¿ç®—ç¬¦\n\n\n6. æµ‹è¯•ç§»åŠ¨è¯­ä¹‰\nç¼–å†™æµ‹è¯•éªŒè¯ç§»åŠ¨è¯­ä¹‰æ˜¯å¦æ­£ç¡®å·¥ä½œï¼š\nvoid test_move_semantics() &#123;    MyString s1(&quot;hello&quot;);    MyString s2 = std::move(s1);        // éªŒè¯s2è·å¾—äº†èµ„æº    assert(s2.size() == 5);        // éªŒè¯s1å¤„äºæœ‰æ•ˆçŠ¶æ€    assert(s1.size() == 0);&#125;\næ ¸å¿ƒè¦ç‚¹å›é¡¾\n\n\nå·¦å€¼ä¸å³å€¼ï¼šå·¦å€¼æ˜¯å¯å¯»å€çš„æŒä¹…å¯¹è±¡ï¼Œå³å€¼æ˜¯ä¸´æ—¶çš„å³å°†é”€æ¯çš„å¯¹è±¡\n\n\nå³å€¼å¼•ç”¨ï¼šä½¿ç”¨&amp;&amp;è¡¨ç¤ºï¼Œä¸“é—¨ç”¨äºç»‘å®šåˆ°å³å€¼\n\n\nç§»åŠ¨è¯­ä¹‰ï¼šé€šè¿‡è½¬ç§»èµ„æºæ‰€æœ‰æƒè€Œéå¤åˆ¶æ¥æé«˜æ€§èƒ½\n\n\nç§»åŠ¨æ„é€  / èµ‹å€¼ï¼šæ¥å—å³å€¼å¼•ç”¨å‚æ•°ï¼Œå®ç°èµ„æºè½¬ç§»\n\n\nstd::moveï¼šå°†å·¦å€¼è½¬æ¢ä¸ºå³å€¼å¼•ç”¨ï¼Œè§¦å‘ç§»åŠ¨è¯­ä¹‰\n\n\nå®Œç¾è½¬å‘ï¼šä¿æŒå‚æ•°çš„åŸå§‹å€¼ç±»åˆ«ï¼Œç”±ä¸‡èƒ½å¼•ç”¨å’Œ std::forward å®ç°\n\n\næŠ€æœ¯ä»·å€¼\n\n\næ€§èƒ½æå‡ï¼šé¿å…ä¸å¿…è¦çš„æ·±æ‹·è´ï¼Œç‰¹åˆ«å¯¹å¤§å‹å¯¹è±¡æ•ˆæœæ˜¾è‘—\n\n\nèµ„æºç®¡ç†ï¼šå®ç°å®‰å…¨çš„èµ„æºæ‰€æœ‰æƒè½¬ç§»\n\n\nä»£ç ç®€æ´ï¼šæ”¯æŒæ›´ä¼˜é›…çš„ API è®¾è®¡å’Œæ³›å‹ç¼–ç¨‹\n\n\nå‘åå…¼å®¹ï¼šä¸ç°æœ‰ C++ ä»£ç ä¿æŒå…¼å®¹\n\n\nå®è·µå»ºè®®\n\n\næ­£ç¡®è¯†åˆ«ä½¿ç”¨åœºæ™¯ï¼šåªåœ¨ç¡®å®éœ€è¦æ—¶ä½¿ç”¨ç§»åŠ¨è¯­ä¹‰\n\n\néµå¾ªæœ€ä½³å®è·µï¼šæä¾›å®Œæ•´çš„ç§»åŠ¨æ”¯æŒï¼Œä½¿ç”¨ noexcept\n\n\né¿å…å¸¸è§é™·é˜±ï¼šä¸è¦ç§»åŠ¨ä»éœ€ä½¿ç”¨çš„å¯¹è±¡ï¼Œå¤„ç†è‡ªèµ‹å€¼\n\n\næµ‹è¯•éªŒè¯ï¼šç¼–å†™æµ‹è¯•ç¡®ä¿ç§»åŠ¨è¯­ä¹‰æ­£ç¡®å·¥ä½œ\n\n\næœªæ¥å‘å±•\néšç€ C++ æ ‡å‡†çš„ä¸æ–­æ¼”è¿›ï¼Œå³å€¼ç›¸å…³ç‰¹æ€§ä¹Ÿåœ¨æŒç»­å®Œå–„ï¼š\n\n\nC++17ï¼šå¼•å…¥äº† guaranteed copy elisionï¼Œè¿›ä¸€æ­¥ä¼˜åŒ–ä¸´æ—¶å¯¹è±¡\n\n\nC++20ï¼šå¢å¼ºäº†æ¦‚å¿µï¼ˆConceptsï¼‰å¯¹å®Œç¾è½¬å‘çš„æ”¯æŒ\n\n\nC++23ï¼šå¼•å…¥äº† forward_like ç­‰æ–°å·¥å…·\n\n\nå‚è€ƒèµ„æ–™ï¼š\n\n\nC++ Primer (ç¬¬ 6 ç‰ˆ)\n\n\nC++ Standard (C++11 åŠä»¥åç‰ˆæœ¬)\n\n\nScott Meyers: Effective Modern C++\n\n\nBjarne Stroustrup: The C++ Programming Language\n\n\n","categories":["ç¼–ç¨‹"],"tags":["C++"]},{"title":"CMakeç”¨æ³•","url":"/2025/08/07/C++/CMake%E6%93%8D%E4%BD%9C/","content":"\nå…³äºCMakeçš„åŸºç¡€æ¦‚å¿µå’ŒCMakeé¡¹ç›®æ„å»ºæµç¨‹\n\n\nä¸€ã€CMake åŸºç¡€è¯­æ³•\n1. åŸºç¡€è¯­æ³•è§„åˆ™\n\n\nå‘½ä»¤æ ¼å¼ï¼šä¸åŒºåˆ†å¤§å°å†™ï¼ˆæƒ¯ä¾‹ç”¨å¤§å†™ï¼‰ï¼Œæ ¼å¼ä¸º COMMAND(å‚æ•°1 å‚æ•°2 ...)ï¼Œå‚æ•°å«ç©ºæ ¼éœ€ç”¨åŒå¼•å·åŒ…è£¹ã€‚\nä¾‹ï¼šPROJECT(MyApp) ä¸ project(myapp) ç­‰æ•ˆã€‚\n\n\nå˜é‡ï¼š\n\nå®šä¹‰ï¼šset(å˜é‡å å€¼)ï¼Œå¦‚ set(SRC main.cpp)ã€‚\nå¼•ç”¨ï¼š${å˜é‡å}ï¼Œå¦‚ add_executable(app ${SRC})ã€‚\nç±»å‹ï¼š\n\næ™®é€šå˜é‡ï¼šå½“å‰ä½œç”¨åŸŸæœ‰æ•ˆï¼ˆå‡½æ•°/ç›®å½•å†…ï¼‰ã€‚\nç¼“å­˜å˜é‡ï¼šset(å˜é‡å å€¼ CACHE ç±»å‹ &quot;æè¿°&quot;)ï¼Œå­˜å…¥ CMakeCache.txt è·¨æ„å»ºä¿ç•™ï¼ˆå¦‚ CMAKE_BUILD_TYPEï¼‰ã€‚\nç¯å¢ƒå˜é‡ï¼š$ENV{å˜é‡å} å¼•ç”¨ï¼Œset(ENV{å˜é‡å} æ–°å€¼) ä¿®æ”¹ã€‚\n\n\né¢„å®šä¹‰æ ¸å¿ƒå˜é‡ï¼š\n\n\n\nå˜é‡å\nå«ä¹‰\n\n\n\n\nPROJECT_SOURCE_DIR\né¡¹ç›®æ ¹ç›®å½•ï¼ˆæ ¹ CMakeLists.txt è·¯å¾„ï¼‰\n\n\nCMAKE_BINARY_DIR\næ„å»ºç›®å½•ï¼ˆæ‰§è¡Œ cmake å‘½ä»¤çš„ç›®å½•ï¼‰\n\n\nCMAKE_CXX_STANDARD\nC++ æ ‡å‡†ç‰ˆæœ¬ï¼ˆå¦‚ 17ã€20ï¼‰\n\n\n\n\n\n\n\nåˆ—è¡¨ï¼ˆListï¼‰ï¼šç©ºæ ¼åˆ†éš”çš„å­—ç¬¦ä¸²é›†åˆï¼Œå¦‚ set(LIBS math utils)ã€‚\nå¸¸ç”¨æ“ä½œï¼šlist(APPEND åˆ—è¡¨ å…ƒç´ )ï¼ˆè¿½åŠ ï¼‰ã€list(LENGTH åˆ—è¡¨ å˜é‡)ï¼ˆé•¿åº¦ï¼‰ã€‚\n\n\næ³¨é‡Šï¼šå•è¡Œç”¨ #ï¼Œæ— å¤šè¡Œæ³¨é‡Šï¼ˆéœ€æ¯è¡ŒåŠ  #ï¼‰ã€‚\n\n\näºŒã€æ ¸å¿ƒæ„å»ºå‘½ä»¤\n1. é¡¹ç›®é…ç½®åŸºç¡€\n\n\ncmake_minimum_required(VERSION ç‰ˆæœ¬)ï¼šæŒ‡å®šæœ€ä½ CMake ç‰ˆæœ¬ï¼ˆå¿…é¡»åœ¨ project å‰ï¼‰ï¼Œå¦‚ cmake_minimum_required(VERSION 3.10)ã€‚\n\n\nproject(é¡¹ç›®å [LANGUAGES C CXX ...])ï¼šå®šä¹‰é¡¹ç›®åç§°åŠæ”¯æŒè¯­è¨€ï¼ˆé»˜è®¤ C/C++ï¼‰ï¼Œè‡ªåŠ¨ç”Ÿæˆ PROJECT_NAMEã€PROJECT_VERSION ç­‰å˜é‡ã€‚\n\n\n2. ç›®æ ‡ï¼ˆTargetï¼‰æ„å»º\nç›®æ ‡æ˜¯ CMake æ ¸å¿ƒï¼Œä»£è¡¨å¯æ‰§è¡Œæ–‡ä»¶ã€åº“ç­‰äº§ç‰©ã€‚\n\n\nå¯æ‰§è¡Œæ–‡ä»¶ï¼šadd_executable(ç›®æ ‡å æºæ–‡ä»¶...)\nä¾‹ï¼šadd_executable(app main.cpp src/func.cpp)ã€‚\n\n\nåº“æ–‡ä»¶ï¼šadd_library(ç›®æ ‡å [STATIC|SHARED|MODULE] æºæ–‡ä»¶...)\n\nSTATICï¼šé™æ€åº“ï¼ˆ.a/.libï¼Œç¼–è¯‘æ—¶é“¾æ¥ï¼‰ã€‚\nSHAREDï¼šåŠ¨æ€åº“ï¼ˆ.so/.dllï¼Œè¿è¡Œæ—¶åŠ è½½ï¼‰ã€‚\nMODULEï¼šæ¨¡å—åº“ï¼ˆéé“¾æ¥ç”¨ï¼Œè¿è¡Œæ—¶åŠ¨æ€åŠ è½½ï¼‰ã€‚\nä¾‹ï¼šadd_library(math STATIC src/math.cpp)ã€‚\n\n\n\n3. ç›®æ ‡å±æ€§ä¸ä¾èµ–é…ç½®\nç°ä»£ CMakeï¼ˆ3.0+ï¼‰æ¨è&quot;ç›®æ ‡å¯¼å‘&quot;é…ç½®ï¼Œæ›¿ä»£å…¨å±€å‘½ä»¤ï¼ˆå¦‚ include_directoriesï¼‰ï¼Œæ˜ç¡®ä½œç”¨åŸŸï¼š\n\n\ntarget_include_directories(ç›®æ ‡ ä½œç”¨åŸŸ ç›®å½•...)ï¼šæŒ‡å®šå¤´æ–‡ä»¶ç›®å½•\n\nPUBLICï¼šå½“å‰ç›®æ ‡åŠä¾èµ–å®ƒçš„ç›®æ ‡å¯è§ã€‚\nPRIVATEï¼šä»…å½“å‰ç›®æ ‡å¯è§ã€‚\nINTERFACEï¼šä»…ä¾èµ–å®ƒçš„ç›®æ ‡å¯è§ã€‚\nä¾‹ï¼štarget_include_directories(app PUBLIC include)ã€‚\n\n\n\ntarget_link_libraries(ç›®æ ‡ ä¾èµ–...)ï¼šé“¾æ¥åº“ï¼ˆè‡ªå®šä¹‰åº“æˆ–ç³»ç»Ÿåº“ï¼‰\nä¾‹ï¼štarget_link_libraries(app PUBLIC math pthread)ï¼ˆé“¾æ¥è‡ªå®šä¹‰åº“ math å’Œç³»ç»Ÿçº¿ç¨‹åº“ï¼‰ã€‚\n\n\ntarget_compile_features(ç›®æ ‡ ä½œç”¨åŸŸ cxx_std_17)ï¼šæŒ‡å®š C++ æ ‡å‡†ï¼ˆè‡ªåŠ¨é…ç½®ç¼–è¯‘é€‰é¡¹ï¼‰ã€‚\n\n\ntarget_compile_options(ç›®æ ‡ ä½œç”¨åŸŸ -Wall -O2)ï¼šæ·»åŠ ç¼–è¯‘é€‰é¡¹ï¼ˆè­¦å‘Šã€ä¼˜åŒ–ç­‰ï¼‰ã€‚\n\n\nä¸‰ã€é¡¹ç›®ç»„ç»‡ä¸æ¨¡å—åŒ–ï¼ˆå¤šç›®å½•å·¥ç¨‹ï¼‰\n1. å…¸å‹ç›®å½•ç»“æ„\nproject_root/â”œâ”€â”€ CMakeLists.txt       # æ ¹é…ç½®â”œâ”€â”€ include/             # å…¨å±€å¤´æ–‡ä»¶â”œâ”€â”€ src/                 # æºç ç›®å½•â”‚   â”œâ”€â”€ math/            # å­æ¨¡å—ï¼ˆæ•°å­¦åŠŸèƒ½ï¼‰â”‚   â”‚   â”œâ”€â”€ CMakeLists.txtâ”‚   â”‚   â”œâ”€â”€ math.cppâ”‚   â”‚   â””â”€â”€ math.hâ”‚   â””â”€â”€ utils/           # å­æ¨¡å—ï¼ˆå·¥å…·åŠŸèƒ½ï¼‰â”‚       â”œâ”€â”€ CMakeLists.txtâ”‚       â””â”€â”€ utils.cppâ””â”€â”€ apps/                # å¯æ‰§è¡Œç¨‹åº    â”œâ”€â”€ main.cpp    â””â”€â”€ CMakeLists.txt\n2. çˆ¶å­ç›®å½•åä½œ\n\n\næ ¹ç›®å½• CMakeLists.txtï¼šå®šä¹‰å…¨å±€é…ç½®ï¼Œé€šè¿‡ add_subdirectory åŠ è½½å­ç›®å½•ã€‚\ncmake_minimum_required(VERSION 3.15)project(MyProject LANGUAGES CXX)# å…¨å±€è·¯å¾„å˜é‡set(PROJECT_ROOT $&#123;CMAKE_CURRENT_SOURCE_DIR&#125;)# åŠ è½½å­ç›®å½•ï¼ˆè‡ªåŠ¨è§£æå­ç›®å½•çš„ CMakeLists.txtï¼‰add_subdirectory(src/math)add_subdirectory(src/utils)add_subdirectory(apps)\n\n\nå­ç›®å½• src/math/CMakeLists.txtï¼šå®šä¹‰æ¨¡å—åº“ï¼Œæš´éœ²å¤´æ–‡ä»¶è·¯å¾„ã€‚\nadd_library(math STATIC math.cpp)# å¤´æ–‡ä»¶å¯¹ä¾èµ–è¯¥åº“çš„ç›®æ ‡å¯è§ï¼ˆPUBLICï¼‰target_include_directories(math PUBLIC $&#123;PROJECT_ROOT&#125;/include)\n\n\nåº”ç”¨ç›®å½• apps/CMakeLists.txtï¼šé“¾æ¥å­æ¨¡å—åº“ã€‚\nadd_executable(app main.cpp)target_link_libraries(app PUBLIC math utils)  # ä¾èµ– math å’Œ utils åº“\n\n\n3. å…³é”®æŠ€å·§\n\n\nè¾“å‡ºè·¯å¾„æ§åˆ¶ï¼šé€šè¿‡ set_target_properties ç»Ÿä¸€è¾“å‡ºç›®å½•ï¼Œé¿å…æ±¡æŸ“æºç ã€‚\nset_target_properties(app PROPERTIES RUNTIME_OUTPUT_DIRECTORY $&#123;PROJECT_ROOT&#125;/bin)set_target_properties(math PROPERTIES ARCHIVE_OUTPUT_DIRECTORY $&#123;PROJECT_ROOT&#125;/lib)\n\n\nå˜é‡ä½œç”¨åŸŸï¼šå­ç›®å½•å˜é‡é»˜è®¤å±€éƒ¨ï¼Œä¿®æ”¹çˆ¶ç›®å½•å˜é‡éœ€åŠ  PARENT_SCOPEï¼š\nset(PARENT_VAR &quot;value&quot; PARENT_SCOPE)  # å­ç›®å½•ä¿®æ”¹çˆ¶ç›®å½•å˜é‡\n\n\nå››ã€æµç¨‹æ§åˆ¶ï¼ˆæ¡ä»¶ä¸å¾ªç¯ï¼‰\n1. æ¡ä»¶åˆ¤æ–­ï¼ˆif-else-endifï¼‰\næ ¹æ®å¹³å°ã€é…ç½®ç­‰åŠ¨æ€è°ƒæ•´æ„å»ºè§„åˆ™ï¼š\nif(æ¡ä»¶)  # æ»¡è¶³æ¡ä»¶æ‰§è¡Œelseif(å¦ä¸€ä¸ªæ¡ä»¶)  # æ»¡è¶³å¦ä¸€æ¡ä»¶æ‰§è¡Œelse()  # é»˜è®¤æ‰§è¡Œendif()\nå¸¸ç”¨æ¡ä»¶ï¼š\n\n\nå¹³å°ï¼šif(WIN32)ã€if(UNIX)ã€if(APPLE)ï¼ˆmacOSï¼‰ã€‚\n\n\nå˜é‡ï¼šif(DEFINED VAR)ï¼ˆæ˜¯å¦å®šä¹‰ï¼‰ã€if(VAR STREQUAL &quot;value&quot;)ï¼ˆå­—ç¬¦ä¸²ç›¸ç­‰ï¼‰ã€‚\n\n\næ–‡ä»¶ï¼šif(EXISTS è·¯å¾„)ï¼ˆè·¯å¾„å­˜åœ¨ï¼‰ã€if(IS_DIRECTORY è·¯å¾„)ï¼ˆæ˜¯å¦ç›®å½•ï¼‰ã€‚\n\n\nç¤ºä¾‹ï¼šå¹³å°å·®å¼‚åŒ–ç¼–è¯‘\nif(WIN32)  target_compile_definitions(app PRIVATE _WIN32)  # Windows å®å®šä¹‰elseif(UNIX)  target_link_libraries(app pthread)  # Linux é“¾æ¥çº¿ç¨‹åº“endif()\n2. å¾ªç¯ï¼ˆforeach ä¸ whileï¼‰\n\n\nforeachï¼šéå†åˆ—è¡¨æˆ–èŒƒå›´\n# éå†åˆ—è¡¨set(SRCS a.cpp b.cpp c.cpp)foreach(src IN LISTS SRCS)  message(STATUS &quot;Source: $&#123;src&#125;&quot;)endforeach()# éå†æ•°å€¼èŒƒå›´ï¼ˆ0åˆ°10ï¼Œæ­¥é•¿2ï¼‰foreach(i RANGE 0 10 2)  message(STATUS &quot;Index: $&#123;i&#125;&quot;)endforeach()\n\n\nwhileï¼šæ¡ä»¶å¾ªç¯ï¼ˆé€‚åˆåŠ¨æ€è®¡æ•°åœºæ™¯ï¼‰\nset(COUNT 0)while(COUNT LESS 5)  message(STATUS &quot;Count: $&#123;COUNT&#125;&quot;)  math(EXPR COUNT &quot;$&#123;COUNT&#125; + 1&quot;)  # è®¡æ•°+1endwhile()\n\n\näº”ã€ä¾èµ–ç®¡ç†ä¸å¤–éƒ¨åº“\n1. æŸ¥æ‰¾ç³»ç»Ÿåº“ï¼ˆfind_packageï¼‰\nç”¨äºå¼•å…¥å¤–éƒ¨åº“ï¼ˆå¦‚ Boostã€OpenCVï¼‰ï¼š\nfind_package(åº“å [ç‰ˆæœ¬] [REQUIRED])  # REQUIREDï¼šæ‰¾ä¸åˆ°åˆ™æŠ¥é”™\næ‰¾åˆ°åº“åï¼š\n\n\nç°ä»£åº“ä¼šç”Ÿæˆç›®æ ‡ åº“å::åº“åï¼Œç›´æ¥é“¾æ¥ï¼š\nfind_package(OpenCV 4 REQUIRED)target_link_libraries(app PUBLIC OpenCV::OpenCV)  # è‡ªåŠ¨åŒ…å«å¤´æ–‡ä»¶å’Œé“¾æ¥åº“\n\n\nä¼ ç»Ÿåº“éœ€æ‰‹åŠ¨å¤„ç†å˜é‡ï¼š\nfind_package(Boost 1.70 REQUIRED COMPONENTS filesystem)target_include_directories(app PUBLIC $&#123;Boost_INCLUDE_DIRS&#125;)target_link_libraries(app PUBLIC $&#123;Boost_LIBRARIES&#125;)\n\n\n2. è‡ªå®šä¹‰æ¨¡å—\nè‹¥å¤–éƒ¨åº“æ— é»˜è®¤æŸ¥æ‰¾æ¨¡å—ï¼Œå¯è‡ªå®šä¹‰ FindXXX.cmake å¹¶æ”¾å…¥æ¨¡å—ç›®å½•ï¼š\n# æ·»åŠ è‡ªå®šä¹‰æ¨¡å—ç›®å½•set(CMAKE_MODULE_PATH $&#123;CMAKE_MODULE_PATH&#125; &quot;$&#123;PROJECT_ROOT&#125;/cmake&quot;)find_package(MyLib REQUIRED)  # æŸ¥æ‰¾ cmake/FindMyLib.cmake\nå…­ã€å®‰è£…ä¸æ‰“åŒ…\n1. å®‰è£…è§„åˆ™ï¼ˆinstallï¼‰\nå®šä¹‰ç›®æ ‡ã€æ–‡ä»¶çš„å®‰è£…è·¯å¾„ï¼ˆé»˜è®¤å‰ç¼€ï¼šUnix ä¸º /usr/localï¼ŒWindows ä¸º C:/Program Filesï¼‰ï¼š\n# å®‰è£…å¯æ‰§è¡Œæ–‡ä»¶åˆ° $&#123;CMAKE_INSTALL_PREFIX&#125;/bininstall(TARGETS app DESTINATION bin)# å®‰è£…é™æ€åº“åˆ° $&#123;CMAKE_INSTALL_PREFIX&#125;/libinstall(TARGETS math DESTINATION lib)# å®‰è£…å¤´æ–‡ä»¶åˆ° $&#123;CMAKE_INSTALL_PREFIX&#125;/includeinstall(FILES include/math.h DESTINATION include)\nä¿®æ”¹å®‰è£…å‰ç¼€ï¼š\ncmake .. -DCMAKE_INSTALL_PREFIX=/path/to/install  # ç”Ÿæˆæ—¶æŒ‡å®š\n2. ç”Ÿæˆå®‰è£…åŒ…ï¼ˆCPackï¼‰\nåœ¨æ ¹ CMakeLists.txt æœ«å°¾æ·»åŠ ï¼š\ninclude(CPack)# é…ç½®åŒ…ä¿¡æ¯set(CPACK_PACKAGE_NAME &quot;MyProject&quot;)set(CPACK_PACKAGE_VERSION &quot;1.0&quot;)set(CPACK_GENERATOR &quot;TGZ;DEB&quot;)  # ç”Ÿæˆ .tar.gz å’Œ .deb åŒ…\nç”ŸæˆåŒ…ï¼š\ncd build &amp;&amp; cpack  # åœ¨æ„å»ºç›®å½•æ‰§è¡Œ\nä¸ƒã€æœ€ä½³å®è·µä¸é¿å‘æŒ‡å—\n\n\nä¼˜å…ˆç›®æ ‡å¯¼å‘å‘½ä»¤ï¼šç”¨ target_include_directories æ›¿ä»£ include_directoriesï¼Œç”¨ target_link_libraries æ›¿ä»£ link_librariesï¼Œæ˜ç¡®ä¾èµ–èŒƒå›´ã€‚\n\n\nåˆ†ç¦»æ„å»ºç›®å½•ï¼šé‡‡ç”¨&quot;out-of-source&quot;æ„å»ºï¼Œé¿å…æ±¡æŸ“æºç ï¼š\nmkdir build &amp;&amp; cd build &amp;&amp; cmake ..  # æ„å»ºç›®å½•ä¸æºç åˆ†ç¦»\n\n\nè°ƒè¯•å˜é‡ï¼šç”¨ message(STATUS &quot;VAR: ${VAR}&quot;) æ‰“å°å˜é‡å€¼ï¼Œæ’æŸ¥é…ç½®é—®é¢˜ã€‚\n\n\nè·¨å¹³å°è·¯å¾„ï¼šç”¨ PATH_EQUAL æ¯”è¾ƒè·¯å¾„ï¼ˆè‡ªåŠ¨å¤„ç† / ä¸ \\ å·®å¼‚ï¼‰ï¼š\nif(&quot;/a/b&quot; PATH_EQUAL &quot;/a//b&quot;)  # ç»“æœä¸ºçœŸ\n\n\nåŠ¨æ€åº“æŸ¥æ‰¾ï¼š\n\nLinuxï¼šè®¾ç½® LD_LIBRARY_PATH æˆ– CMAKE_INSTALL_RPATHã€‚\nWindowsï¼šå°† .dll å¤åˆ¶åˆ°å¯æ‰§è¡Œæ–‡ä»¶ç›®å½•æˆ–æ·»åŠ åˆ° PATHã€‚\n\n\n\nå…«ã€å®Œæ•´æ„å»ºæµç¨‹\n\n\nç¼–å†™ CMakeLists.txtï¼šæŒ‰æ¨¡å—æ‹†åˆ†ï¼Œå®šä¹‰ç›®æ ‡ä¸ä¾èµ–ã€‚\n\n\nç”Ÿæˆæ„å»ºæ–‡ä»¶ï¼š\nmkdir build &amp;&amp; cd buildcmake .. -DCMAKE_BUILD_TYPE=Release  # Release æ¨¡å¼ï¼ˆé»˜è®¤ Debugï¼‰\n\n\nç¼–è¯‘ï¼š\ncmake --build . -j8  # 8çº¿ç¨‹ç¼–è¯‘ï¼ˆé€šç”¨ï¼‰# æˆ–é’ˆå¯¹ Makefileï¼šmake -j8\n\n\nå®‰è£…ï¼ˆå¯é€‰ï¼‰ï¼š\ncmake --install .  # å®‰è£…åˆ°æŒ‡å®šå‰ç¼€\n\n\n","categories":["ç¼–ç¨‹"],"tags":["C++","å·¥å…·","CMake"]},{"title":"MSVC,g++çš„ç®€å•ä½¿ç”¨","url":"/2025/06/07/C++/MSVC,g++%20%E4%BD%BF%E7%94%A8%E5%8F%82%E6%95%B0/","content":"\nmsvcå’Œg++çš„å¸¸ç”¨å‚æ•°\n\n\nMSVC,g++ ä½¿ç”¨å‚æ•°\nMSVCï¼ˆMicrosoft Visual C++ï¼‰ç¼–è¯‘å™¨æ ¸å¿ƒä¸ºcl.exeï¼ˆç¼–è¯‘ï¼‰å’Œlink.exeï¼ˆé“¾æ¥ï¼‰ï¼Œä»¥ä¸‹æ˜¯å¸¸ç”¨å‚æ•°ç²¾ç®€è¯´æ˜ï¼š\nä¸€ã€ç¼–è¯‘å‚æ•°ï¼ˆcl.exeï¼‰\n\n\nåŸºç¡€æ§åˆ¶\n\n/cï¼šä»…ç¼–è¯‘ç”Ÿæˆ.objï¼Œä¸é“¾æ¥\n/Fo&lt;è·¯å¾„&gt;ï¼šæŒ‡å®š.objè¾“å‡ºè·¯å¾„ï¼ˆå¦‚/Foobj/ï¼‰\n/Fe&lt;è·¯å¾„&gt;ï¼šæŒ‡å®šæœ€ç»ˆå¯æ‰§è¡Œæ–‡ä»¶è·¯å¾„\n\n\n\nè¯­è¨€æ ‡å‡†\n\n/std:c++11/c++17/c++20ï¼šæŒ‡å®šC++æ ‡å‡†\n/std:c11ï¼šæŒ‡å®šCè¯­è¨€æ ‡å‡†\n\n\n\nå®ä¸è·¯å¾„\n\n/D&lt;å®&gt;ï¼šå®šä¹‰å®ï¼ˆå¦‚/DDEBUGï¼‰\n/I&lt;ç›®å½•&gt;ï¼šæ·»åŠ å¤´æ–‡ä»¶æœç´¢ç›®å½•\n\n\n\nè­¦å‘Šä¸è°ƒè¯•\n\n/W4ï¼šæœ€é«˜è­¦å‘Šçº§åˆ«ï¼›/WXï¼šè­¦å‘Šè§†ä¸ºé”™è¯¯\n/Ziï¼šç”Ÿæˆè°ƒè¯•ç¬¦å·ï¼ˆ.pdbï¼‰\n\n\n\nä¼˜åŒ–\n\n/Odï¼šç¦ç”¨ä¼˜åŒ–ï¼ˆDebugç”¨ï¼‰\n/O2ï¼šä¼˜åŒ–æ‰§è¡Œé€Ÿåº¦ï¼ˆReleaseé»˜è®¤ï¼‰\n/GLï¼šå¯ç”¨å…¨ç¨‹åºä¼˜åŒ–ï¼ˆéœ€é…åˆé“¾æ¥/LTCGï¼‰\n\n\n\näºŒã€é“¾æ¥å‚æ•°ï¼ˆlink.exeï¼‰\n\n\nè¾“å‡ºæ§åˆ¶\n\n/OUT:&lt;è·¯å¾„&gt;ï¼šæŒ‡å®šè¾“å‡ºæ–‡ä»¶ï¼ˆ.exe/.dllï¼‰\n/DLLï¼šç”ŸæˆåŠ¨æ€åº“ï¼ˆ.dllï¼‰\n/SUBSYSTEM:CONSOLEï¼šæ§åˆ¶å°ç¨‹åºï¼ˆé»˜è®¤ï¼‰ï¼›WINDOWSï¼šçª—å£ç¨‹åº\n\n\n\nåº“ä¸ç¬¦å·\n\n/LIBPATH:&lt;ç›®å½•&gt;ï¼šæ·»åŠ åº“æ–‡ä»¶æœç´¢ç›®å½•\n&lt;åº“å.lib&gt;ï¼šæŒ‡å®šä¾èµ–åº“ï¼ˆå¦‚kernel32.libï¼‰\n/DEBUGï¼šç”Ÿæˆè°ƒè¯•ç¬¦å·ï¼ˆé…åˆç¼–è¯‘/Ziï¼‰\n\n\n\nä¼˜åŒ–\n\n/LTCGï¼šé“¾æ¥æ—¶ä¼˜åŒ–ï¼ˆé…åˆç¼–è¯‘/GLï¼‰\n/OPT:REFï¼šç§»é™¤æœªä½¿ç”¨ä»£ç \n\n\n\nä¸‰ã€ç¤ºä¾‹\n\n\nDebugæ¨¡å¼ï¼š\ncl /c /Od /Zi /W4 main.cpp /Foobj/\nlink /DEBUG obj/main.obj /OUT:app.exe\n\n\nReleaseæ¨¡å¼ï¼š\ncl /c /O2 /GL /W4 /DRELEASE main.cpp\nlink /LTCG main.obj /OUT:app.exe\n\n\né€šè¿‡VSé¡¹ç›®å±æ€§ï¼ˆå³é”®é¡¹ç›®â†’å±æ€§ï¼‰å¯å›¾å½¢åŒ–é…ç½®æ‰€æœ‰å‚æ•°ã€‚\ng++å¸¸ç”¨å‚æ•°ï¼ˆç®€æ´ç‰ˆï¼‰\ngæ˜¯GNU Cç¼–è¯‘å™¨ï¼Œå¸¸ç”¨å‚æ•°å¦‚ä¸‹ï¼š\n\n\nåŸºç¡€æ§åˆ¶\n\n-cï¼šä»…ç¼–è¯‘ç”Ÿæˆ.oç›®æ ‡æ–‡ä»¶ï¼Œä¸é“¾æ¥\n-o &lt;æ–‡ä»¶å&gt;ï¼šæŒ‡å®šè¾“å‡ºæ–‡ä»¶ï¼ˆå¦‚-o app.exeï¼‰\n-I&lt;ç›®å½•&gt;ï¼šæ·»åŠ å¤´æ–‡ä»¶æœç´¢è·¯å¾„\n\n\n\nè¯­è¨€æ ‡å‡†\n\n-std=c++11/c++17/c++20ï¼šæŒ‡å®šC++æ ‡å‡†\n-std=c11ï¼šæŒ‡å®šCè¯­è¨€æ ‡å‡†\n\n\n\nå®ä¸è­¦å‘Š\n\n-D&lt;å®&gt;ï¼šå®šä¹‰å®ï¼ˆå¦‚-DDEBUGï¼‰\n-Wallï¼šå¼€å¯å¤§éƒ¨åˆ†è­¦å‘Šï¼›-Werrorï¼šè­¦å‘Šè§†ä¸ºé”™è¯¯\n\n\n\nè°ƒè¯•ä¸ä¼˜åŒ–\n\n-gï¼šç”Ÿæˆè°ƒè¯•ä¿¡æ¯ï¼ˆä¾›gdbä½¿ç”¨ï¼‰\n-O0ï¼šæ— ä¼˜åŒ–ï¼ˆDebugï¼‰ï¼›-O2ï¼šä¸­åº¦ä¼˜åŒ–ï¼ˆå¸¸ç”¨ï¼‰ï¼›-O3ï¼šæœ€é«˜ä¼˜åŒ–\n\n\n\né“¾æ¥æ§åˆ¶\n\n-L&lt;ç›®å½•&gt;ï¼šæ·»åŠ åº“æ–‡ä»¶æœç´¢è·¯å¾„\n-l&lt;åº“å&gt;ï¼šé“¾æ¥æŒ‡å®šåº“ï¼ˆå¦‚-lpthreadé“¾æ¥çº¿ç¨‹åº“ï¼‰\n-sharedï¼šç”ŸæˆåŠ¨æ€åº“ï¼ˆ.soï¼‰\n\n\n\ng++ä¸MSVCå‚æ•°å¯¹æ¯”æ•´åˆè¡¨\n\n\n\nåŠŸèƒ½ç±»åˆ«\ng++å‚æ•°\nMSVCå‚æ•°ï¼ˆcl.exe/link.exeï¼‰\nè¯´æ˜\n\n\n\n\nè¾“å‡ºæŒ‡å®š\n-o &lt;æ–‡ä»¶&gt;\n/Fe&lt;æ–‡ä»¶&gt;ï¼ˆclï¼‰//OUT:&lt;æ–‡ä»¶&gt;ï¼ˆlinkï¼‰\næŒ‡å®šæœ€ç»ˆè¾“å‡ºæ–‡ä»¶\n\n\nä»…ç¼–è¯‘\n-c\n/cï¼ˆclï¼‰\nåªç”Ÿæˆç›®æ ‡æ–‡ä»¶ï¼Œä¸é“¾æ¥\n\n\nå¤´æ–‡ä»¶è·¯å¾„\n-I&lt;ç›®å½•&gt;\n/I&lt;ç›®å½•&gt;ï¼ˆclï¼‰\næ·»åŠ å¤´æ–‡ä»¶æœç´¢ç›®å½•\n\n\nC++æ ‡å‡†\n-std=c++20\n/std:c++20ï¼ˆclï¼‰\næŒ‡å®šC++æ ‡å‡†ç‰ˆæœ¬\n\n\nå®å®šä¹‰\n-DDEBUG\n/DDEBUGï¼ˆclï¼‰\nå®šä¹‰é¢„å¤„ç†å®\n\n\nè­¦å‘Šæ§åˆ¶\n-Wall -Werror\n/W4 /WXï¼ˆclï¼‰\nå¼€å¯è­¦å‘Šå¹¶è§†ä¸ºé”™è¯¯\n\n\nè°ƒè¯•ä¿¡æ¯\n-g\n/Ziï¼ˆclï¼‰+/DEBUGï¼ˆlinkï¼‰\nç”Ÿæˆè°ƒè¯•ç¬¦å·\n\n\nä¼˜åŒ–çº§åˆ«\n-O0ï¼ˆæ— ï¼‰/ -O2ï¼ˆä¸­ï¼‰\n/Odï¼ˆæ— ï¼‰/ /O2ï¼ˆä¸­ï¼‰ï¼ˆclï¼‰\næ§åˆ¶ä»£ç ä¼˜åŒ–ç¨‹åº¦\n\n\nåº“è·¯å¾„\n-L&lt;ç›®å½•&gt;\n/LIBPATH:&lt;ç›®å½•&gt;ï¼ˆlinkï¼‰\næ·»åŠ åº“æ–‡ä»¶æœç´¢ç›®å½•\n\n\né“¾æ¥åº“\n-l&lt;åº“å&gt;ï¼ˆå¦‚-lmï¼‰\n&lt;åº“å.lib&gt;ï¼ˆå¦‚math.libï¼‰ï¼ˆlinkï¼‰\né“¾æ¥æŒ‡å®šåº“æ–‡ä»¶\n\n\nç”ŸæˆåŠ¨æ€åº“\n-shared\n/DLLï¼ˆlinkï¼‰\nç”ŸæˆåŠ¨æ€é“¾æ¥åº“\n\n\n\nç¤ºä¾‹å¯¹æ¯”ï¼š\n\n\ng++ç¼–è¯‘Debugç‰ˆæœ¬ï¼š\ng++ -c -g -O0 -Wall main.cpp -o obj/main.o\ng++ obj/main.o -o app.exe\n\n\nMSVCç¼–è¯‘Debugç‰ˆæœ¬ï¼š\ncl /c /Zi /Od /W4 main.cpp /Foobj/main.obj\nlink obj/main.obj /DEBUG /OUT:app.exe\n\n\n","categories":["ç¼–ç¨‹"],"tags":["C++","å·¥å…·","MSVC","g++"]},{"title":"PyBind11ä½¿ç”¨æŒ‡åŒ—(è¡¥å……)","url":"/2025/09/09/C++/pybind11%20%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97%20-%20%E5%AE%98%E6%96%B9%E6%96%87%E6%A1%A3%E8%A1%A5%E5%85%85%E5%86%85%E5%AE%B9/","content":"\nå¦‚é¢˜ï¼Œç»“åˆå®˜æ–¹æ–‡æ¡£ä¸ç½‘ç»œå¸–å­ï¼Œåˆ©ç”¨AIæ•´ç†\n\n\npybind11 ä½¿ç”¨æŒ‡å— - å®˜æ–¹æ–‡æ¡£è¡¥å……å†…å®¹\nç›®å½•\n\n\né«˜çº§ç±»ç‰¹æ€§\n\n\næ„å»ºç³»ç»Ÿè¯¦è§£\n\n\nè¿”å›å€¼ç­–ç•¥\n\n\næ™ºèƒ½æŒ‡é’ˆ\n\n\nç±»å‹è½¬æ¢\n\n\nåµŒå…¥ Python è§£é‡Šå™¨\n\n\nå¤šçº¿ç¨‹ä¸ GIL ç®¡ç†\n\n\nå­è§£é‡Šå™¨\n\n\nè‡ªå®šä¹‰ç±»å‹è½¬æ¢\n\n\nå…¶ä»–é«˜çº§ç‰¹æ€§\n\n\né«˜çº§ç±»ç‰¹æ€§\n1. åŠ¨æ€å±æ€§\né»˜è®¤æƒ…å†µä¸‹ï¼ŒC++ ç±»åœ¨ Python ä¸­ä¸æ”¯æŒåŠ¨æ€æ·»åŠ å±æ€§ã€‚è¦å¯ç”¨æ­¤åŠŸèƒ½ï¼Œéœ€è¦ä½¿ç”¨py::dynamic_attræ ‡ç­¾ï¼š\n#include &lt;pybind11/pybind11.h&gt;namespace py = pybind11;class Pet &#123;public:    Pet(const std::string&amp; name) : name(name) &#123;&#125;        std::string get_name() const &#123; return name; &#125;    void set_name(const std::string&amp; new_name) &#123; name = new_name; &#125;private:    std::string name;&#125;;PYBIND11_MODULE(example, m) &#123;    py::class_&lt;Pet&gt;(m, &quot;Pet&quot;, py::dynamic_attr())        .def(py::init&lt;const std::string&amp;&gt;())        .def(&quot;get_name&quot;, &amp;Pet::get_name)        .def(&quot;set_name&quot;, &amp;Pet::set_name)        .def_readwrite(&quot;name&quot;, &amp;Pet::name);&#125;\nPython ä½¿ç”¨ï¼š\nimport examplep = example.Pet(&quot;å°ç‹—&quot;)p.age = 2  # åŠ¨æ€æ·»åŠ å±æ€§p.color = &quot;æ£•è‰²&quot;  # åŠ¨æ€æ·»åŠ å±æ€§print(p.name)   # è¾“å‡ºï¼šå°ç‹—print(p.age)    # è¾“å‡ºï¼š2print(p.color)  # è¾“å‡ºï¼šæ£•è‰²\n2. ç»§æ‰¿ä¸è‡ªåŠ¨å‘ä¸‹è½¬å‹\nå¯¹äºå¤šæ€ç±»ï¼ˆå«æœ‰è™šå‡½æ•°ï¼‰ï¼Œpybind11 ä¼šè‡ªåŠ¨è¿›è¡Œå‘ä¸‹è½¬å‹ï¼š\n#include &lt;pybind11/pybind11.h&gt;#include &lt;string&gt;namespace py = pybind11;class Animal &#123;public:    virtual ~Animal() = default;    virtual std::string speak() const = 0;&#125;;class Dog : public Animal &#123;public:    std::string speak() const override &#123;        return &quot;æ±ªæ±ªï¼&quot;;    &#125;&#125;;class Cat : public Animal &#123;public:    std::string speak() const override &#123;        return &quot;å–µå–µï¼&quot;;    &#125;&#125;;// è¿”å›åŸºç±»æŒ‡é’ˆAnimal* create_animal(const std::string&amp; type) &#123;    if (type == &quot;dog&quot;) return new Dog();    if (type == &quot;cat&quot;) return new Cat();    throw std::invalid_argument(&quot;æœªçŸ¥åŠ¨ç‰©ç±»å‹&quot;);&#125;PYBIND11_MODULE(example, m) &#123;    py::class_&lt;Animal&gt;(m, &quot;Animal&quot;)        .def(&quot;speak&quot;, &amp;Animal::speak);        py::class_&lt;Dog, Animal&gt;(m, &quot;Dog&quot;)        .def(py::init&lt;&gt;());        py::class_&lt;Cat, Animal&gt;(m, &quot;Cat&quot;)        .def(py::init&lt;&gt;());        m.def(&quot;create_animal&quot;, &amp;create_animal,           py::return_value_policy::take_ownership);&#125;\nPython ä½¿ç”¨ï¼š\nimport exampleanimal = example.create_animal(&quot;dog&quot;)print(type(animal))  # è¾“å‡ºï¼š&lt;class &#x27;example.Dog&#x27;&gt;ï¼ˆè‡ªåŠ¨å‘ä¸‹è½¬å‹ï¼‰print(animal.speak())  # è¾“å‡ºï¼šæ±ªæ±ªï¼\n3. è¿ç®—ç¬¦é‡è½½\nä½¿ç”¨pybind11/operators.hå¤´æ–‡ä»¶æ”¯æŒè¿ç®—ç¬¦é‡è½½ï¼š\n#include &lt;pybind11/pybind11.h&gt;#include &lt;pybind11/operators.h&gt;namespace py = pybind11;class Vector2 &#123;public:    float x, y;        Vector2(float x = 0, float y = 0) : x(x), y(y) &#123;&#125;        Vector2 operator+(const Vector2&amp; other) const &#123;        return Vector2(x + other.x, y + other.y);    &#125;        Vector2 operator*(float scalar) const &#123;        return Vector2(x * scalar, y * scalar);    &#125;        bool operator==(const Vector2&amp; other) const &#123;        return x == other.x &amp;&amp; y == other.y;    &#125;&#125;;PYBIND11_MODULE(example, m) &#123;    py::class_&lt;Vector2&gt;(m, &quot;Vector2&quot;)        .def(py::init&lt;float, float&gt;())        .def_readwrite(&quot;x&quot;, &amp;Vector2::x)        .def_readwrite(&quot;y&quot;, &amp;Vector2::y)                // è¿ç®—ç¬¦é‡è½½        .def(py::self + py::self)          // + è¿ç®—ç¬¦        .def(py::self * float())           // * è¿ç®—ç¬¦ï¼ˆå‘é‡ * æ ‡é‡ï¼‰        .def(float() * py::self)           // * è¿ç®—ç¬¦ï¼ˆæ ‡é‡ * å‘é‡ï¼‰        .def(py::self == py::self);        // == è¿ç®—ç¬¦&#125;\n4. æšä¸¾ç±»å‹ç»‘å®š\nä½¿ç”¨py::native_enumç»‘å®š C++ æšä¸¾åˆ° Python åŸç”Ÿæšä¸¾ï¼š\n#include &lt;pybind11/pybind11.h&gt;#include &lt;pybind11/native_enum.h&gt;namespace py = pybind11;class Pet &#123;public:    enum class Kind &#123;        Dog,        Cat,        Bird    &#125;;        enum Attributes &#123;        None = 0,        Friendly = 1 &lt;&lt; 0,        Playful = 1 &lt;&lt; 1,        Lazy = 1 &lt;&lt; 2    &#125;;        Pet(const std::string&amp; name, Kind kind)         : name(name), kind(kind), attributes(None) &#123;&#125;        std::string name;    Kind kind;    Attributes attributes;&#125;;PYBIND11_MODULE(example, m) &#123;    py::class_&lt;Pet&gt;(m, &quot;Pet&quot;)        .def(py::init&lt;const std::string&amp;, Pet::Kind&gt;())        .def_readwrite(&quot;name&quot;, &amp;Pet::name)        .def_readwrite(&quot;kind&quot;, &amp;Pet::kind)        .def_readwrite(&quot;attributes&quot;, &amp;Pet::attributes);        // ç»‘å®šæšä¸¾    py::native_enum&lt;Pet::Kind&gt;(m, &quot;Kind&quot;)        .value(&quot;Dog&quot;, Pet::Kind::Dog)        .value(&quot;Cat&quot;, Pet::Kind::Cat)        .value(&quot;Bird&quot;, Pet::Kind::Bird)        .export_values()        .finalize();        py::native_enum&lt;Pet::Attributes&gt;(m, &quot;Attributes&quot;)        .value(&quot;None&quot;, Pet::Attributes::None)        .value(&quot;Friendly&quot;, Pet::Attributes::Friendly)        .value(&quot;Playful&quot;, Pet::Attributes::Playful)        .value(&quot;Lazy&quot;, Pet::Attributes::Lazy)        .export_values()        .finalize();&#125;\næ„å»ºç³»ç»Ÿè¯¦è§£\n1. CMake æ„å»º\nåŸºç¡€ CMakeLists.txtï¼š\ncmake_minimum_required(VERSION 3.15...3.27)project(example LANGUAGES CXX)# æŸ¥æ‰¾pybind11find_package(pybind11 CONFIG REQUIRED)# åˆ›å»ºPythonæ‰©å±•æ¨¡å—pybind11_add_module(example example.cpp)# å®‰è£…åˆ°å½“å‰ç›®å½•install(TARGETS example DESTINATION .)\né«˜çº§ CMake é…ç½®ï¼š\ncmake_minimum_required(VERSION 3.15...3.27)project(example LANGUAGES CXX)# è®¾ç½®C++æ ‡å‡†set(CMAKE_CXX_STANDARD 17)set(CMAKE_CXX_STANDARD_REQUIRED ON)set(CMAKE_CXX_EXTENSIONS OFF)# æŸ¥æ‰¾Pythonfind_package(Python COMPONENTS Interpreter Development REQUIRED)# æŸ¥æ‰¾pybind11find_package(pybind11 CONFIG REQUIRED)# åˆ›å»ºæ‰©å±•æ¨¡å—pybind11_add_module(example     src/bindings.cpp    src/algorithm.cpp    src/data_structures.cpp)# è®¾ç½®ç¼–è¯‘é€‰é¡¹target_compile_options(example PRIVATE    -O3    -Wall    -Wextra    -Wpedantic)# è®¾ç½®é“¾æ¥é€‰é¡¹target_link_libraries(example PRIVATE    pybind11::module    my_custom_library)# è®¾ç½®å®‰è£…è·¯å¾„install(TARGETS example     DESTINATION $&#123;CMAKE_CURRENT_SOURCE_DIR&#125;)\n2. pyproject.toml æ„å»º\nä½¿ç”¨ scikit-build-coreï¼š\n[build-system]requires = [&quot;scikit-build-core&gt;=0.5&quot;, &quot;pybind11&gt;=2.11&quot;]build-backend = &quot;scikit_build_core.build&quot;[project]name = &quot;example&quot;version = &quot;0.1.0&quot;authors = [    &#123; name = &quot;Your Name&quot;, email = &quot;your.email@example.com&quot; &#125;]description = &quot;pybind11ç¤ºä¾‹é¡¹ç›®&quot;long_description = file: &quot;README.md&quot;long_description_content_type = &quot;text/markdown&quot;requires-python = &quot;&gt;=3.8&quot;\nä½¿ç”¨ meson-pythonï¼š\n[build-system]requires = [&quot;meson-python&gt;=0.12&quot;, &quot;pybind11&gt;=2.11&quot;]build-backend = &quot;mesonpy&quot;[project]name = &quot;example&quot;version = &quot;0.1.0&quot;\n3. setuptools æ„å»ºé«˜çº§é…ç½®\nfrom setuptools import setup, Extensionfrom pybind11.setup_helpers import Pybind11Extension, build_extfrom pybind11 import get_cmake_dirimport glob# å¹¶è¡Œç¼–è¯‘def parallel_compile_test_parallel_compile(self, sources, output_dir=None, macros=None,                                          include_dirs=None, debug=0, extra_preargs=None,                                          extra_postargs=None, depends=None):    import multiprocessing    from setuptools._distutils.ccompiler import CCompiler    from setuptools._distutils import log    # å¤åˆ¶åŸå§‹å®ç°    original_compile = CCompiler._compile    def _compile_single(source):        return original_compile(self, source, output_dir, macros, include_dirs,                               debug, extra_preargs, extra_postargs, depends)    # ä½¿ç”¨å¤šè¿›ç¨‹ç¼–è¯‘    if not sources:        return    num_jobs = multiprocessing.cpu_count()    log.info(f&quot;Using &#123;num_jobs&#125; parallel jobs for compilation&quot;)        import multiprocessing.pool    pool = multiprocessing.pool.ThreadPool(num_jobs)    try:        pool.map(_compile_single, sources)    finally:        pool.close()        pool.join()# åº”ç”¨å¹¶è¡Œç¼–è¯‘è¡¥ä¸import setuptools._distutils.ccompilersetuptools._distutils.ccompiler.CCompiler._compile = parallel_compile_test_parallel_compile# æ‰©å±•æ¨¡å—ext_modules = [    Pybind11Extension(        &quot;example.core&quot;,        sorted(glob.glob(&quot;src/core/*.cpp&quot;)),        include_dirs=[&quot;src/include&quot;],        libraries=[&quot;my_custom_lib&quot;],        library_dirs=[&quot;lib&quot;],        extra_compile_args=[&quot;-O3&quot;, &quot;-std=c++17&quot;, &quot;-Wall&quot;],        extra_link_args=[&quot;-Wl,-rpath,$ORIGIN/lib&quot;],    ),    Pybind11Extension(        &quot;example.utils&quot;,        sorted(glob.glob(&quot;src/utils/*.cpp&quot;)),        include_dirs=[&quot;src/include&quot;],        extra_compile_args=[&quot;-O3&quot;, &quot;-std=c++17&quot;],    ),]setup(    name=&quot;example&quot;,    version=&quot;1.0.0&quot;,    author=&quot;Your Name&quot;,    author_email=&quot;your.email@example.com&quot;,    description=&quot;pybind11ç¤ºä¾‹é¡¹ç›®&quot;,    long_description=open(&quot;README.md&quot;).read(),    long_description_content_type=&quot;text/markdown&quot;,    url=&quot;https://github.com/yourusername/example&quot;,    ext_modules=ext_modules,    cmdclass=&#123;&quot;build_ext&quot;: build_ext&#125;,    zip_safe=False,    packages=[&quot;example&quot;],    package_dir=&#123;&quot;example&quot;: &quot;python/example&quot;&#125;,    package_data=&#123;&quot;example&quot;: [&quot;py.typed&quot;]&#125;,    classifiers=[        &quot;Programming Language :: C++&quot;,        &quot;Programming Language :: Python :: 3&quot;,        &quot;License :: OSI Approved :: MIT License&quot;,        &quot;Operating System :: OS Independent&quot;,    ],    python_requires=&quot;&gt;=3.8&quot;,    install_requires=[&quot;numpy&gt;=1.21&quot;],    extras_require=&#123;        &quot;dev&quot;: [            &quot;pytest&gt;=6.0&quot;,            &quot;pytest-cov&gt;=2.0&quot;,            &quot;black&gt;=21.0&quot;,            &quot;flake8&gt;=3.9&quot;,        ]    &#125;,)\nè¿”å›å€¼ç­–ç•¥\n1. ç­–ç•¥æ¦‚è¿°\n\n\n\nç­–ç•¥\næè¿°\n\n\n\n\nreturn_value_policy::take_ownership\næ¥ç®¡ç°æœ‰å¯¹è±¡çš„æ‰€æœ‰æƒï¼ŒPython ä¼šåœ¨å¼•ç”¨è®¡æ•°ä¸ºé›¶æ—¶åˆ é™¤å¯¹è±¡\n\n\nreturn_value_policy::copy\nåˆ›å»ºè¿”å›å¯¹è±¡çš„å‰¯æœ¬ï¼Œç”± Python æ‹¥æœ‰\n\n\nreturn_value_policy::move\nä½¿ç”¨ std::move è½¬ç§»å†…å®¹åˆ°æ–°å®ä¾‹\n\n\nreturn_value_policy::reference\nå¼•ç”¨ç°æœ‰å¯¹è±¡ä½†ä¸æ¥ç®¡æ‰€æœ‰æƒ\n\n\nreturn_value_policy::reference_internal\nå¼•ç”¨å†…éƒ¨å¯¹è±¡ï¼Œç¡®ä¿çˆ¶å¯¹è±¡å­˜æ´»\n\n\nreturn_value_policy::automatic\nè‡ªåŠ¨é€‰æ‹©ç­–ç•¥ï¼ˆé»˜è®¤ï¼‰\n\n\nreturn_value_policy::automatic_reference\nç±»ä¼¼ automaticï¼Œä½†å¯¹æŒ‡é’ˆä½¿ç”¨ reference ç­–ç•¥\n\n\n\n2. ä½¿ç”¨ç¤ºä¾‹\n#include &lt;pybind11/pybind11.h&gt;#include &lt;memory&gt;namespace py = pybind11;class MyClass &#123;public:    MyClass(int value) : value(value) &#123;&#125;    int get_value() const &#123; return value; &#125;    private:    int value;&#125;;// é™æ€å¯¹è±¡ - ä½¿ç”¨referenceç­–ç•¥MyClass static_instance(42);MyClass&amp; get_static_instance() &#123;    return static_instance;&#125;// åŠ¨æ€åˆ†é… - ä½¿ç”¨take_ownershipç­–ç•¥MyClass* create_instance(int value) &#123;    return new MyClass(value);&#125;// å†…éƒ¨å¯¹è±¡ - ä½¿ç”¨reference_internalç­–ç•¥class Container &#123;public:    Container() : internal(100) &#123;&#125;    MyClass&amp; get_internal() &#123; return internal; &#125;    private:    MyClass internal;&#125;;PYBIND11_MODULE(example, m) &#123;    py::class_&lt;MyClass&gt;(m, &quot;MyClass&quot;)        .def(py::init&lt;int&gt;())        .def(&quot;get_value&quot;, &amp;MyClass::get_value);        py::class_&lt;Container&gt;(m, &quot;Container&quot;)        .def(py::init&lt;&gt;())        .def(&quot;get_internal&quot;, &amp;Container::get_internal,              py::return_value_policy::reference_internal);        // é™æ€å¯¹è±¡ - ä½¿ç”¨referenceç­–ç•¥    m.def(&quot;get_static_instance&quot;, &amp;get_static_instance,           py::return_value_policy::reference);        // åŠ¨æ€å¯¹è±¡ - ä½¿ç”¨take_ownershipç­–ç•¥    m.def(&quot;create_instance&quot;, &amp;create_instance,           py::return_value_policy::take_ownership);        // æ™ºèƒ½æŒ‡é’ˆ - è‡ªåŠ¨å¤„ç†    m.def(&quot;create_shared&quot;, []() &#123;        return std::make_shared&lt;MyClass&gt;(200);    &#125;);&#125;\n3. å¸¸è§é”™è¯¯åŠè§£å†³æ–¹æ¡ˆ\né”™è¯¯ç¤ºä¾‹ï¼š\n// å±é™©ï¼é™æ€å¯¹è±¡ä½¿ç”¨é»˜è®¤ç­–ç•¥ä¼šå¯¼è‡´double freem.def(&quot;get_static&quot;, &amp;get_static_instance);  // é”™è¯¯\næ­£ç¡®åšæ³•ï¼š\n// æ­£ç¡®ï¼šä½¿ç”¨referenceç­–ç•¥m.def(&quot;get_static&quot;, &amp;get_static_instance, py::return_value_policy::reference);\næ™ºèƒ½æŒ‡é’ˆ\n1. py::smart_holderï¼ˆæ¨èï¼‰\npybind11 v3 å¼•å…¥çš„æ™ºèƒ½æŒæœ‰è€…ï¼Œæ”¯æŒåŒå‘è½¬æ¢ï¼š\n#include &lt;pybind11/pybind11.h&gt;#include &lt;memory&gt;namespace py = pybind11;class MyClass &#123;public:    MyClass(int value) : value(value) &#123;&#125;    int get_value() const &#123; return value; &#125;    private:    int value;&#125;;PYBIND11_MODULE(example, m) &#123;    // ä½¿ç”¨py::smart_holder    py::class_&lt;MyClass, py::smart_holder&gt;(m, &quot;MyClass&quot;)        .def(py::init&lt;int&gt;())        .def(&quot;get_value&quot;, &amp;MyClass::get_value);        // æ”¯æŒunique_ptrå’Œshared_ptråŒå‘è½¬æ¢    m.def(&quot;create_unique&quot;, []() &#123;        return std::make_unique&lt;MyClass&gt;(10);    &#125;);        m.def(&quot;create_shared&quot;, []() &#123;        return std::make_shared&lt;MyClass&gt;(20);    &#125;);        m.def(&quot;process_unique&quot;, [](std::unique_ptr&lt;MyClass&gt; ptr) &#123;        return ptr-&gt;get_value() * 2;    &#125;);        m.def(&quot;process_shared&quot;, [](std::shared_ptr&lt;MyClass&gt; ptr) &#123;        return ptr-&gt;get_value() * 3;    &#125;);&#125;\nPython ä½¿ç”¨ï¼š\nimport example# ä»Pythonä¼ é€’åˆ°C++obj = example.MyClass(5)print(example.process_unique(obj))  # è¾“å‡ºï¼š10ï¼ˆobjä¸å†æœ‰æ•ˆï¼‰obj2 = example.MyClass(6)print(example.process_shared(obj2))  # è¾“å‡ºï¼š18ï¼ˆobj2ä»ç„¶æœ‰æ•ˆï¼‰# ä»C++è¿”å›unique_obj = example.create_unique()shared_obj = example.create_shared()\n2. std::unique_ptr\n#include &lt;pybind11/pybind11.h&gt;#include &lt;memory&gt;namespace py = pybind11;class MyClass &#123;public:    MyClass(int value) : value(value) &#123;&#125;    int get_value() const &#123; return value; &#125;    private:    int value;&#125;;PYBIND11_MODULE(example, m) &#123;    py::class_&lt;MyClass&gt;(m, &quot;MyClass&quot;)        .def(py::init&lt;int&gt;())        .def(&quot;get_value&quot;, &amp;MyClass::get_value);        // è¿”å›unique_ptr    m.def(&quot;create&quot;, []() &#123;        return std::make_unique&lt;MyClass&gt;(10);    &#125;);        // æ¥å—unique_ptrï¼ˆä¼šè½¬ç§»æ‰€æœ‰æƒï¼‰    m.def(&quot;take_ownership&quot;, [](std::unique_ptr&lt;MyClass&gt; ptr) &#123;        return ptr-&gt;get_value();    &#125;);&#125;\n3. std::shared_ptr\n#include &lt;pybind11/pybind11.h&gt;#include &lt;memory&gt;namespace py = pybind11;class MyClass &#123;public:    MyClass(int value) : value(value) &#123;&#125;    int get_value() const &#123; return value; &#125;    private:    int value;&#125;;PYBIND11_MODULE(example, m) &#123;    // ä½¿ç”¨shared_pträ½œä¸ºæŒæœ‰è€…    py::class_&lt;MyClass, std::shared_ptr&lt;MyClass&gt;&gt;(m, &quot;MyClass&quot;)        .def(py::init&lt;int&gt;())        .def(&quot;get_value&quot;, &amp;MyClass::get_value);        m.def(&quot;create&quot;, []() &#123;        return std::make_shared&lt;MyClass&gt;(10);    &#125;);        m.def(&quot;share&quot;, [](std::shared_ptr&lt;MyClass&gt; ptr) &#123;        return ptr;  // å…±äº«æ‰€æœ‰æƒ    &#125;);&#125;\n4. è‡ªå®šä¹‰æ™ºèƒ½æŒ‡é’ˆ\n#include &lt;pybind11/pybind11.h&gt;#include &lt;memory&gt;namespace py = pybind11;// è‡ªå®šä¹‰æ™ºèƒ½æŒ‡é’ˆtemplate &lt;typename T&gt;class MySmartPtr &#123;public:    MySmartPtr(T* ptr) : ptr(ptr) &#123;&#125;    ~MySmartPtr() &#123; delete ptr; &#125;        T* get() const &#123; return ptr; &#125;    T&amp; operator*() const &#123; return *ptr; &#125;    T* operator-&gt;() const &#123; return ptr; &#125;    private:    T* ptr;&#125;;class MyClass &#123;public:    MyClass(int value) : value(value) &#123;&#125;    int get_value() const &#123; return value; &#125;    private:    int value;&#125;;// å£°æ˜è‡ªå®šä¹‰æŒæœ‰è€…ç±»å‹PYBIND11_DECLARE_HOLDER_TYPE(T, MySmartPtr&lt;T&gt;)// ç‰¹åŒ–holder_helperï¼ˆå¦‚æœéœ€è¦ï¼‰namespace pybind11 &#123; namespace detail &#123;    template &lt;typename T&gt;    struct holder_helper&lt;MySmartPtr&lt;T&gt;&gt; &#123;        static const T* get(const MySmartPtr&lt;T&gt;&amp; p) &#123; return p.get(); &#125;    &#125;;&#125;&#125;PYBIND11_MODULE(example, m) &#123;    py::class_&lt;MyClass, MySmartPtr&lt;MyClass&gt;&gt;(m, &quot;MyClass&quot;)        .def(py::init&lt;int&gt;())        .def(&quot;get_value&quot;, &amp;MyClass::get_value);        m.def(&quot;create&quot;, []() &#123;        return MySmartPtr&lt;MyClass&gt;(new MyClass(10));    &#125;);&#125;\nç±»å‹è½¬æ¢\n1. åŸºç¡€ç±»å‹è½¬æ¢\npybind11 æ”¯æŒä»¥ä¸‹åŸºç¡€ç±»å‹çš„è‡ªåŠ¨è½¬æ¢ï¼š\n\n\n\nC++ ç±»å‹\nPython ç±»å‹\n\n\n\n\nbool\nbool\n\n\nchar\nstr (é•¿åº¦ 1)\n\n\nsigned char\nint\n\n\nunsigned char\nint\n\n\nshort\nint\n\n\nunsigned short\nint\n\n\nint\nint\n\n\nunsigned int\nint\n\n\nlong\nint\n\n\nunsigned long\nint\n\n\nlong long\nint\n\n\nunsigned long long\nint\n\n\nfloat\nfloat\n\n\ndouble\nfloat\n\n\nlong double\nfloat\n\n\nconst char*\nstr\n\n\nstd::string\nstr\n\n\nstd::wstring\nstr (UTF-8)\n\n\n\n2. STL å®¹å™¨è½¬æ¢\néœ€è¦åŒ…å«pybind11/stl.hå¤´æ–‡ä»¶ï¼š\n#include &lt;pybind11/pybind11.h&gt;#include &lt;pybind11/stl.h&gt;#include &lt;vector&gt;#include &lt;list&gt;#include &lt;map&gt;#include &lt;set&gt;#include &lt;unordered_map&gt;#include &lt;unordered_set&gt;namespace py = pybind11;// å‘é‡è½¬æ¢std::vector&lt;int&gt; double_vector(const std::vector&lt;int&gt;&amp; v) &#123;    std::vector&lt;int&gt; result;    for (int x : v) &#123;        result.push_back(x * 2);    &#125;    return result;&#125;// æ˜ å°„è½¬æ¢std::map&lt;std::string, int&gt; count_words(const std::vector&lt;std::string&gt;&amp; words) &#123;    std::map&lt;std::string, int&gt; counts;    for (const auto&amp; word : words) &#123;        counts[word]++;    &#125;    return counts;&#125;// é›†åˆè½¬æ¢std::set&lt;int&gt; unique_elements(const std::vector&lt;int&gt;&amp; v) &#123;    return std::set&lt;int&gt;(v.begin(), v.end());&#125;PYBIND11_MODULE(example, m) &#123;    m.def(&quot;double_vector&quot;, &amp;double_vector);    m.def(&quot;count_words&quot;, &amp;count_words);    m.def(&quot;unique_elements&quot;, &amp;unique_elements);&#125;\nPython ä½¿ç”¨ï¼š\nimport example# å‘é‡è½¬æ¢print(example.double_vector([1, 2, 3, 4]))  # è¾“å‡ºï¼š[2, 4, 6, 8]# æ˜ å°„è½¬æ¢words = [&quot;apple&quot;, &quot;banana&quot;, &quot;apple&quot;, &quot;orange&quot;]print(example.count_words(words))  # è¾“å‡ºï¼š&#123;&#x27;apple&#x27;: 2, &#x27;banana&#x27;: 1, &#x27;orange&#x27;: 1&#125;# é›†åˆè½¬æ¢print(example.unique_elements([1, 2, 2, 3, 3, 3]))  # è¾“å‡ºï¼š&#123;1, 2, 3&#125;\n3. å­—ç¬¦ä¸²å’Œå­—èŠ‚è½¬æ¢\n#include &lt;pybind11/pybind11.h&gt;#include &lt;string&gt;#include &lt;vector&gt;namespace py = pybind11;// å­—ç¬¦ä¸²å¤„ç†std::string reverse_string(const std::string&amp; s) &#123;    return std::string(s.rbegin(), s.rend());&#125;// å­—èŠ‚å¤„ç†std::vector&lt;uint8_t&gt; process_bytes(const std::vector&lt;uint8_t&gt;&amp; data) &#123;    std::vector&lt;uint8_t&gt; result;    for (uint8_t byte : data) &#123;        result.push_back(byte ^ 0xAA);  // ç®€å•çš„XORåŠ å¯†    &#125;    return result;&#125;PYBIND11_MODULE(example, m) &#123;    m.def(&quot;reverse_string&quot;, &amp;reverse_string);    m.def(&quot;process_bytes&quot;, &amp;process_bytes);&#125;\n4. æ—¶é—´ç±»å‹è½¬æ¢\néœ€è¦åŒ…å«pybind11/chrono.hå¤´æ–‡ä»¶ï¼š\n#include &lt;pybind11/pybind11.h&gt;#include &lt;pybind11/chrono.h&gt;#include &lt;chrono&gt;#include &lt;ctime&gt;namespace py = pybind11;using namespace std::chrono;// æ—¶é—´ç‚¹è½¬æ¢system_clock::time_point add_seconds(system_clock::time_point tp, int seconds) &#123;    return tp + seconds(seconds);&#125;// æ—¶é—´æ®µè½¬æ¢seconds time_difference(system_clock::time_point start, system_clock::time_point end) &#123;    return duration_cast&lt;seconds&gt;(end - start);&#125;PYBIND11_MODULE(example, m) &#123;    m.def(&quot;add_seconds&quot;, &amp;add_seconds);    m.def(&quot;time_difference&quot;, &amp;time_difference);&#125;\nPython ä½¿ç”¨ï¼š\nimport exampleimport datetime# æ—¶é—´ç‚¹è½¬æ¢now = datetime.datetime.now()later = example.add_seconds(now, 3600)  # åŠ 1å°æ—¶print(later)# æ—¶é—´æ®µè½¬æ¢start = datetime.datetime(2023, 1, 1)end = datetime.datetime(2023, 1, 2)diff = example.time_difference(start, end)print(diff.total_seconds())  # è¾“å‡ºï¼š86400.0\nåµŒå…¥ Python è§£é‡Šå™¨\n1. åŸºç¡€åµŒå…¥\nCMake é…ç½®ï¼š\ncmake_minimum_required(VERSION 3.15...3.27)project(embedded_example LANGUAGES CXX)find_package(pybind11 CONFIG REQUIRED)add_executable(embedded_example main.cpp)target_link_libraries(embedded_example PRIVATE pybind11::embed)\nC++ ä»£ç ï¼š\n#include &lt;pybind11/embed.h&gt;#include &lt;iostream&gt;namespace py = pybind11;int main() &#123;    // å¯åŠ¨Pythonè§£é‡Šå™¨    py::scoped_interpreter guard&#123;&#125;;        try &#123;        // æ‰§è¡ŒPythonä»£ç         py::print(&quot;Hello from embedded Python!&quot;);                // ä½¿ç”¨Pythonæ ‡å‡†åº“        py::module math = py::module::import(&quot;math&quot;);        double result = math.attr(&quot;sqrt&quot;)(25.0).cast&lt;double&gt;();        std::cout &lt;&lt; &quot;sqrt(25) = &quot; &lt;&lt; result &lt;&lt; std::endl;                // æ‰§è¡Œå¤šè¡ŒPythonä»£ç         py::exec(R&quot;(            import sys            print(f&quot;Python version: &#123;sys.version&#125;&quot;)                        def add(a, b):                return a + b                        result = add(3, 4)            print(f&quot;3 + 4 = &#123;result&#125;&quot;)        )&quot;);                // è°ƒç”¨Pythonå‡½æ•°        auto add = py::eval(&quot;add&quot;).cast&lt;py::function&gt;();        int sum_result = add(5, 6).cast&lt;int&gt;();        std::cout &lt;&lt; &quot;5 + 6 = &quot; &lt;&lt; sum_result &lt;&lt; std::endl;            &#125; catch (const py::error_already_set&amp; e) &#123;        std::cerr &lt;&lt; &quot;Python error: &quot; &lt;&lt; e.what() &lt;&lt; std::endl;        return 1;    &#125;        // è§£é‡Šå™¨ä¼šåœ¨guardææ„æ—¶è‡ªåŠ¨å…³é—­    return 0;&#125;\n2. åµŒå…¥æ¨¡å—\n#include &lt;pybind11/embed.h&gt;#include &lt;pybind11/pybind11.h&gt;namespace py = pybind11;// åµŒå…¥çš„C++æ¨¡å—PYBIND11_EMBEDDED_MODULE(embedded_module, m) &#123;    m.def(&quot;multiply&quot;, [](int a, int b) &#123;        return a * b;    &#125;);        m.def(&quot;greet&quot;, [](const std::string&amp; name) &#123;        return &quot;Hello, &quot; + name + &quot;!&quot;;    &#125;);&#125;int main() &#123;    py::scoped_interpreter guard&#123;&#125;;        try &#123;        // å¯¼å…¥åµŒå…¥çš„æ¨¡å—        py::module em = py::module::import(&quot;embedded_module&quot;);                // è°ƒç”¨åµŒå…¥æ¨¡å—çš„å‡½æ•°        int product = em.attr(&quot;multiply&quot;)(3, 4).cast&lt;int&gt;();        std::cout &lt;&lt; &quot;3 * 4 = &quot; &lt;&lt; product &lt;&lt; std::endl;                std::string greeting = em.attr(&quot;greet&quot;)(&quot;World&quot;).cast&lt;std::string&gt;();        std::cout &lt;&lt; greeting &lt;&lt; std::endl;                // åœ¨Pythonä¸­ä½¿ç”¨åµŒå…¥æ¨¡å—        py::exec(R&quot;(            result = embedded_module.multiply(5, 6)            print(f&quot;5 * 6 = &#123;result&#125;&quot;)                        message = embedded_module.greet(&quot;Python&quot;)            print(message)        )&quot;);            &#125; catch (const py::error_already_set&amp; e) &#123;        std::cerr &lt;&lt; &quot;Error: &quot; &lt;&lt; e.what() &lt;&lt; std::endl;        return 1;    &#125;        return 0;&#125;\n3. å¯¼å…¥æœ¬åœ° Python æ–‡ä»¶\n#include &lt;pybind11/embed.h&gt;#include &lt;iostream&gt;#include &lt;filesystem&gt;namespace py = pybind11;namespace fs = std::filesystem;int main() &#123;    py::scoped_interpreter guard&#123;&#125;;        try &#123;        // æ·»åŠ å½“å‰ç›®å½•åˆ°Pythonè·¯å¾„        py::module sys = py::module::import(&quot;sys&quot;);        sys.attr(&quot;path&quot;).cast&lt;py::list&gt;().append(fs::current_path().string());                // å¯¼å…¥æœ¬åœ°Pythonæ¨¡å—        py::module my_module = py::module::import(&quot;my_python_module&quot;);                // è°ƒç”¨Pythonå‡½æ•°        int result = my_module.attr(&quot;my_function&quot;)(10, 20).cast&lt;int&gt;();        std::cout &lt;&lt; &quot;Result from Python: &quot; &lt;&lt; result &lt;&lt; std::endl;            &#125; catch (const py::error_already_set&amp; e) &#123;        std::cerr &lt;&lt; &quot;Error: &quot; &lt;&lt; e.what() &lt;&lt; std::endl;        return 1;    &#125;        return 0;&#125;\nå¤šçº¿ç¨‹ä¸ GIL ç®¡ç†\n1. GIL é‡Šæ”¾ä¸è·å–\n#include &lt;pybind11/pybind11.h&gt;#include &lt;pybind11/functional.h&gt;#include &lt;thread&gt;#include &lt;chrono&gt;#include &lt;iostream&gt;namespace py = pybind11;// é•¿æ—¶é—´è¿è¡Œçš„C++å‡½æ•° - åº”è¯¥é‡Šæ”¾GILvoid long_running_task() &#123;    // é‡Šæ”¾GIL    py::gil_scoped_release release;        std::cout &lt;&lt; &quot;Long running task started (thread: &quot;               &lt;&lt; std::this_thread::get_id() &lt;&lt; &quot;)&quot; &lt;&lt; std::endl;        // æ¨¡æ‹Ÿé•¿æ—¶é—´è®¡ç®—    for (int i = 0; i &lt; 5; ++i) &#123;        std::this_thread::sleep_for(std::chrono::seconds(1));        std::cout &lt;&lt; &quot;Task progress: &quot; &lt;&lt; (i + 1) &lt;&lt; &quot;/5&quot; &lt;&lt; std::endl;    &#125;        std::cout &lt;&lt; &quot;Long running task completed&quot; &lt;&lt; std::endl;        // GILä¼šåœ¨releaseææ„æ—¶è‡ªåŠ¨é‡æ–°è·å–&#125;// ä½¿ç”¨call_guardè‡ªåŠ¨ç®¡ç†GILvoid task_with_guard() &#123;    std::cout &lt;&lt; &quot;Task with guard started&quot; &lt;&lt; std::endl;    std::this_thread::sleep_for(std::chrono::seconds(3));    std::cout &lt;&lt; &quot;Task with guard completed&quot; &lt;&lt; std::endl;&#125;// å¤šçº¿ç¨‹å‡½æ•°void run_in_threads() &#123;    std::thread t1(long_running_task);    std::thread t2(long_running_task);        t1.join();    t2.join();&#125;PYBIND11_MODULE(example, m) &#123;    // ç›´æ¥é‡Šæ”¾GIL    m.def(&quot;long_running_task&quot;, &amp;long_running_task);        // ä½¿ç”¨call_guardé‡Šæ”¾GIL    m.def(&quot;task_with_guard&quot;, &amp;task_with_guard,           py::call_guard&lt;py::gil_scoped_release&gt;());        // å¤šçº¿ç¨‹ç¤ºä¾‹    m.def(&quot;run_in_threads&quot;, &amp;run_in_threads);        // çº¿ç¨‹å®‰å…¨çš„å‡½æ•°è°ƒç”¨    m.def(&quot;thread_safe_function&quot;, [](int value) &#123;        // åœ¨å…³é”®éƒ¨åˆ†è·å–GIL        py::gil_scoped_acquire acquire;        py::print(&quot;Thread-safe function called with value:&quot;, value);    &#125;);&#125;\nPython ä½¿ç”¨ï¼š\nimport exampleimport threadingimport time# æµ‹è¯•é•¿æ—¶é—´ä»»åŠ¡print(&quot;Testing long running task...&quot;)thread1 = threading.Thread(target=example.long_running_task)thread2 = threading.Thread(target=example.long_running_task)thread1.start()thread2.start()# ä¸»çº¿ç¨‹å¯ä»¥ç»§ç»­æ‰§è¡Œå…¶ä»–ä»»åŠ¡for i in range(3):    print(f&quot;Main thread working... &#123;i&#125;&quot;)    time.sleep(1)thread1.join()thread2.join()# æµ‹è¯•å¸¦guardçš„ä»»åŠ¡print(&quot;Testing task with guard...&quot;)example.task_with_guard()# æµ‹è¯•å¤šçº¿ç¨‹å‡½æ•°print(&quot;Testing run in threads...&quot;)example.run_in_threads()\n2. çº¿ç¨‹å±€éƒ¨å­˜å‚¨\n#include &lt;pybind11/pybind11.h&gt;#include &lt;thread&gt;#include &lt;mutex&gt;#include &lt;iostream&gt;namespace py = pybind11;// çº¿ç¨‹å±€éƒ¨å­˜å‚¨thread_local int thread_counter = 0;std::mutex cout_mutex;void thread_function(int id) &#123;    // é‡Šæ”¾GIL    py::gil_scoped_release release;        for (int i = 0; i &lt; 5; ++i) &#123;        thread_counter++;                // å®‰å…¨çš„è¾“å‡º        std::lock_guard&lt;std::mutex&gt; lock(cout_mutex);        std::cout &lt;&lt; &quot;Thread &quot; &lt;&lt; id &lt;&lt; &quot;: counter = &quot; &lt;&lt; thread_counter &lt;&lt; std::endl;                std::this_thread::sleep_for(std::chrono::milliseconds(100));    &#125;&#125;void start_threads() &#123;    std::thread t1(thread_function, 1);    std::thread t2(thread_function, 2);        t1.join();    t2.join();&#125;PYBIND11_MODULE(example, m) &#123;    m.def(&quot;start_threads&quot;, &amp;start_threads);&#125;\n3. å¼‚æ­¥ä»»åŠ¡\n#include &lt;pybind11/pybind11.h&gt;#include &lt;pybind11/functional.h&gt;#include &lt;thread&gt;#include &lt;future&gt;#include &lt;iostream&gt;namespace py = pybind11;// å¼‚æ­¥æ‰§è¡Œå‡½æ•°std::future&lt;int&gt; async_task(int x, int y) &#123;    return std::async(std::launch::async, [x, y]() &#123;        // é‡Šæ”¾GIL        py::gil_scoped_release release;                std::cout &lt;&lt; &quot;Async task started (thread: &quot;                   &lt;&lt; std::this_thread::get_id() &lt;&lt; &quot;)&quot; &lt;&lt; std::endl;                // æ¨¡æ‹Ÿè®¡ç®—        std::this_thread::sleep_for(std::chrono::seconds(2));        return x + y;    &#125;);&#125;// å¼‚æ­¥å›è°ƒvoid async_callback(py::function callback, int x, int y) &#123;    std::thread([callback, x, y]() &#123;        // é‡Šæ”¾GIL        py::gil_scoped_release release;                std::cout &lt;&lt; &quot;Callback task started&quot; &lt;&lt; std::endl;        std::this_thread::sleep_for(std::chrono::seconds(2));                // è®¡ç®—ç»“æœ        int result = x * y;                // è°ƒç”¨å›è°ƒå‡½æ•°æ—¶é‡æ–°è·å–GIL        py::gil_scoped_acquire acquire;        callback(result);    &#125;).detach();&#125;PYBIND11_MODULE(example, m) &#123;    m.def(&quot;async_task&quot;, [](int x, int y) &#123;        auto future = async_task(x, y);        return future.get();    &#125;);        m.def(&quot;async_callback&quot;, &amp;async_callback);&#125;\nPython ä½¿ç”¨ï¼š\nimport exampleimport time# æµ‹è¯•å¼‚æ­¥ä»»åŠ¡print(&quot;Testing async task...&quot;)result = example.async_task(3, 4)print(f&quot;Async result: &#123;result&#125;&quot;)# æµ‹è¯•å¼‚æ­¥å›è°ƒdef on_complete(result):    print(f&quot;Callback received: &#123;result&#125;&quot;)print(&quot;Testing async callback...&quot;)example.async_callback(on_complete, 5, 6)print(&quot;Callback task started (will complete in 2 seconds)&quot;)# ç­‰å¾…å›è°ƒå®Œæˆtime.sleep(3)\nå­è§£é‡Šå™¨\n1. åŸºç¡€å­è§£é‡Šå™¨ä½¿ç”¨\n#include &lt;pybind11/embed.h&gt;#include &lt;pybind11/subinterpreter.h&gt;#include &lt;iostream&gt;namespace py = pybind11;int main() &#123;    // åˆå§‹åŒ–ä¸»è§£é‡Šå™¨    py::scoped_interpreter main_guard&#123;&#125;;        try &#123;        std::cout &lt;&lt; &quot;Main interpreter started&quot; &lt;&lt; std::endl;                // åˆ›å»ºå­è§£é‡Šå™¨        py::subinterpreter sub = py::subinterpreter::create();                &#123;            // æ¿€æ´»å­è§£é‡Šå™¨            py::subinterpreter_scoped_activate activate(sub);                        std::cout &lt;&lt; &quot;Sub-interpreter activated&quot; &lt;&lt; std::endl;                        // åœ¨å­è§£é‡Šå™¨ä¸­æ‰§è¡Œä»£ç             py::exec(R&quot;(                import sys                print(f&quot;Sub-interpreter Python version: &#123;sys.version&#125;&quot;)                counter = 42            )&quot;);                        // è·å–å˜é‡å€¼            int counter = py::eval(&quot;counter&quot;).cast&lt;int&gt;();            std::cout &lt;&lt; &quot;Sub-interpreter counter: &quot; &lt;&lt; counter &lt;&lt; std::endl;        &#125;                std::cout &lt;&lt; &quot;Sub-interpreter deactivated&quot; &lt;&lt; std::endl;                // ä¸»è§£é‡Šå™¨ä¸å—å½±å“        py::exec(&quot;print(&#x27;Back to main interpreter&#x27;)&quot;);            &#125; catch (const py::error_already_set&amp; e) &#123;        std::cerr &lt;&lt; &quot;Error: &quot; &lt;&lt; e.what() &lt;&lt; std::endl;        return 1;    &#125;        return 0;&#125;\n2. å¤šçº¿ç¨‹å­è§£é‡Šå™¨\n#include &lt;pybind11/embed.h&gt;#include &lt;pybind11/subinterpreter.h&gt;#include &lt;thread&gt;#include &lt;iostream&gt;namespace py = pybind11;void run_in_subinterpreter(py::subinterpreter sub, int id) &#123;    try &#123;        // æ¿€æ´»å­è§£é‡Šå™¨        py::subinterpreter_scoped_activate activate(sub);                std::cout &lt;&lt; &quot;Thread &quot; &lt;&lt; id &lt;&lt; &quot; started in sub-interpreter&quot; &lt;&lt; std::endl;                // æ‰§è¡ŒPythonä»£ç         py::exec(R&quot;(            import time            import threading                        def task():                for i in range(3):                    print(f&quot;Task &#123;id&#125; iteration &#123;i&#125; (thread: &#123;threading.get_ident()&#125;)&quot;)                    time.sleep(1)                        task()        )&quot;);                std::cout &lt;&lt; &quot;Thread &quot; &lt;&lt; id &lt;&lt; &quot; completed&quot; &lt;&lt; std::endl;            &#125; catch (const py::error_already_set&amp; e) &#123;        std::cerr &lt;&lt; &quot;Thread &quot; &lt;&lt; id &lt;&lt; &quot; error: &quot; &lt;&lt; e.what() &lt;&lt; std::endl;    &#125;&#125;int main() &#123;    py::scoped_interpreter main_guard&#123;&#125;;        try &#123;        // åˆ›å»ºå¤šä¸ªå­è§£é‡Šå™¨        py::subinterpreter sub1 = py::subinterpreter::create();        py::subinterpreter sub2 = py::subinterpreter::create();                // åœ¨ä¸åŒçº¿ç¨‹ä¸­è¿è¡Œå­è§£é‡Šå™¨        std::thread t1(run_in_subinterpreter, std::move(sub1), 1);        std::thread t2(run_in_subinterpreter, std::move(sub2), 2);                t1.join();        t2.join();            &#125; catch (const py::error_already_set&amp; e) &#123;        std::cerr &lt;&lt; &quot;Main error: &quot; &lt;&lt; e.what() &lt;&lt; std::endl;        return 1;    &#125;        return 0;&#125;\n3. å­è§£é‡Šå™¨å®‰å…¨æœ€ä½³å®è·µ\n#include &lt;pybind11/embed.h&gt;#include &lt;pybind11/subinterpreter.h&gt;#include &lt;thread&gt;#include &lt;mutex&gt;#include &lt;iostream&gt;namespace py = pybind11;// çº¿ç¨‹å®‰å…¨çš„å­è§£é‡Šå™¨ç®¡ç†å™¨class SubinterpreterManager &#123;public:    SubinterpreterManager() : main_guard_&#123;&#125; &#123;&#125;        py::subinterpreter create_subinterpreter() &#123;        std::lock_guard&lt;std::mutex&gt; lock(mutex_);        return py::subinterpreter::create();    &#125;    private:    py::scoped_interpreter main_guard_;    std::mutex mutex_;&#125;;// å®‰å…¨çš„ä»»åŠ¡å‡½æ•°void safe_task(py::subinterpreter sub, const std::string&amp; name) &#123;    try &#123;        // å­è§£é‡Šå™¨ä½œç”¨åŸŸ        py::subinterpreter_scoped_activate activate(sub);                // ä»»åŠ¡é€»è¾‘        py::exec(R&quot;(            import time                        def safe_operation(name):                result = []                for i in range(5):                    result.append(f&quot;&#123;name&#125;: &#123;i&#125;&quot;)                    time.sleep(0.1)                return result                        result = safe_operation(name)            print(f&quot;Task &#123;name&#125; completed with &#123;len(result)&#125; items&quot;)        )&quot;);            &#125; catch (const py::error_already_set&amp; e) &#123;        std::cerr &lt;&lt; &quot;Task &quot; &lt;&lt; name &lt;&lt; &quot; failed: &quot; &lt;&lt; e.what() &lt;&lt; std::endl;    &#125;&#125;int main() &#123;    SubinterpreterManager manager;        // åˆ›å»ºå¹¶è¿è¡Œå¤šä¸ªå­è§£é‡Šå™¨ä»»åŠ¡    std::vector&lt;std::thread&gt; threads;    for (int i = 0; i &lt; 3; ++i) &#123;        py::subinterpreter sub = manager.create_subinterpreter();        threads.emplace_back(safe_task, std::move(sub), &quot;task_&quot; + std::to_string(i));    &#125;        // ç­‰å¾…æ‰€æœ‰çº¿ç¨‹å®Œæˆ    for (auto&amp; t : threads) &#123;        t.join();    &#125;        return 0;&#125;\nè‡ªå®šä¹‰ç±»å‹è½¬æ¢\n1. åŸºç¡€è‡ªå®šä¹‰è½¬æ¢å™¨\n#include &lt;pybind11/pybind11.h&gt;#include &lt;string&gt;#include &lt;sstream&gt;namespace py = pybind11;// è‡ªå®šä¹‰ç±»å‹struct Point &#123;    int x;    int y;        Point(int x = 0, int y = 0) : x(x), y(y) &#123;&#125;        std::string to_string() const &#123;        std::stringstream ss;        ss &lt;&lt; &quot;(&quot; &lt;&lt; x &lt;&lt; &quot;, &quot; &lt;&lt; y &lt;&lt; &quot;)&quot;;        return ss.str();    &#125;&#125;;// è‡ªå®šä¹‰ç±»å‹è½¬æ¢å™¨namespace pybind11 &#123; namespace detail &#123;    template &lt;&gt; struct type_caster&lt;Point&gt; &#123;    public:        PYBIND11_TYPE_CASTER(Point, _(&quot;Point&quot;));                // ä»Pythonå¯¹è±¡è½¬æ¢åˆ°C++        bool load(handle src, bool) &#123;            if (!src.is_dict()) return false;                        py::dict obj = src.cast&lt;py::dict&gt;();            value.x = obj[&quot;x&quot;].cast&lt;int&gt;();            value.y = obj[&quot;y&quot;].cast&lt;int&gt;();            return true;        &#125;                // ä»C++è½¬æ¢åˆ°Pythonå¯¹è±¡        static handle cast(const Point&amp; p, return_value_policy /* policy */, handle /* parent */) &#123;            py::dict obj;            obj[&quot;x&quot;] = p.x;            obj[&quot;y&quot;] = p.y;            return obj.release();        &#125;    &#125;;&#125;&#125;PYBIND11_MODULE(example, m) &#123;    // ä½¿ç”¨è‡ªå®šä¹‰è½¬æ¢å™¨    m.def(&quot;add_points&quot;, [](const Point&amp; a, const Point&amp; b) &#123;        return Point(a.x + b.x, a.y + b.y);    &#125;);        m.def(&quot;print_point&quot;, [](const Point&amp; p) &#123;        py::print(p.to_string());    &#125;);&#125;\nPython ä½¿ç”¨ï¼š\nimport example# åˆ›å»ºPointå¯¹è±¡ï¼ˆé€šè¿‡å­—å…¸ï¼‰p1 = &#123;&quot;x&quot;: 1, &quot;y&quot;: 2&#125;p2 = &#123;&quot;x&quot;: 3, &quot;y&quot;: 4&#125;# ä½¿ç”¨è‡ªå®šä¹‰è½¬æ¢result = example.add_points(p1, p2)print(result)  # è¾“å‡ºï¼š&#123;&#x27;x&#x27;: 4, &#x27;y&#x27;: 6&#125;example.print_point(result)  # è¾“å‡ºï¼š(4, 6)\n2. æ”¯æŒå¤šç§ Python ç±»å‹çš„è½¬æ¢å™¨\n#include &lt;pybind11/pybind11.h&gt;#include &lt;pybind11/stl.h&gt;#include &lt;string&gt;#include &lt;vector&gt;namespace py = pybind11;struct Rectangle &#123;    int x, y, width, height;        Rectangle(int x=0, int y=0, int w=0, int h=0)         : x(x), y(y), width(w), height(h) &#123;&#125;        int area() const &#123; return width * height; &#125;&#125;;namespace pybind11 &#123; namespace detail &#123;    template &lt;&gt; struct type_caster&lt;Rectangle&gt; &#123;    public:        PYBIND11_TYPE_CASTER(Rectangle, _(&quot;Rectangle&quot;));                bool load(handle src, bool) &#123;            // æ”¯æŒå­—å…¸            if (src.is_dict()) &#123;                py::dict obj = src.cast&lt;py::dict&gt;();                value.x = obj[&quot;x&quot;].cast&lt;int&gt;();                value.y = obj[&quot;y&quot;].cast&lt;int&gt;();                value.width = obj[&quot;width&quot;].cast&lt;int&gt;();                value.height = obj[&quot;height&quot;].cast&lt;int&gt;();                return true;            &#125;            // æ”¯æŒå…ƒç»„            else if (src.is_tuple()) &#123;                py::tuple obj = src.cast&lt;py::tuple&gt;();                if (obj.size() != 4) return false;                value.x = obj[0].cast&lt;int&gt;();                value.y = obj[1].cast&lt;int&gt;();                value.width = obj[2].cast&lt;int&gt;();                value.height = obj[3].cast&lt;int&gt;();                return true;            &#125;            // æ”¯æŒåˆ—è¡¨            else if (src.is_list()) &#123;                py::list obj = src.cast&lt;py::list&gt;();                if (obj.size() != 4) return false;                value.x = obj[0].cast&lt;int&gt;();                value.y = obj[1].cast&lt;int&gt;();                value.width = obj[2].cast&lt;int&gt;();                value.height = obj[3].cast&lt;int&gt;();                return true;            &#125;                        return false;        &#125;                static handle cast(const Rectangle&amp; r, return_value_policy /* policy */, handle /* parent */) &#123;            py::dict obj;            obj[&quot;x&quot;] = r.x;            obj[&quot;y&quot;] = r.y;            obj[&quot;width&quot;] = r.width;            obj[&quot;height&quot;] = r.height;            obj[&quot;area&quot;] = r.area();            return obj.release();        &#125;    &#125;;&#125;&#125;PYBIND11_MODULE(example, m) &#123;    m.def(&quot;rectangle_area&quot;, [](const Rectangle&amp; r) &#123;        return r.area();    &#125;);        m.def(&quot;expand_rectangle&quot;, [](const Rectangle&amp; r, int amount) &#123;        return Rectangle(            r.x - amount,            r.y - amount,            r.width + 2 * amount,            r.height + 2 * amount        );    &#125;);&#125;\nPython ä½¿ç”¨ï¼š\nimport example# æ”¯æŒå¤šç§è¾“å…¥ç±»å‹rect1 = &#123;&quot;x&quot;: 0, &quot;y&quot;: 0, &quot;width&quot;: 10, &quot;height&quot;: 20&#125;rect2 = (10, 10, 5, 5)rect3 = [20, 20, 8, 8]print(example.rectangle_area(rect1))  # è¾“å‡ºï¼š200print(example.rectangle_area(rect2))  # è¾“å‡ºï¼š25print(example.rectangle_area(rect3))  # è¾“å‡ºï¼š64# æ‰©å±•çŸ©å½¢expanded = example.expand_rectangle(rect1, 2)print(expanded)# è¾“å‡ºï¼š&#123;&#x27;x&#x27;: -2, &#x27;y&#x27;: -2, &#x27;width&#x27;: 14, &#x27;height&#x27;: 24, &#x27;area&#x27;: 336&#125;\n3. ç»§æ‰¿ç±»å‹çš„è½¬æ¢å™¨\n#include &lt;pybind11/pybind11.h&gt;#include &lt;string&gt;#include &lt;memory&gt;namespace py = pybind11;// åŸºç±»struct Shape &#123;    virtual ~Shape() = default;    virtual std::string name() const = 0;    virtual double area() const = 0;&#125;;// æ´¾ç”Ÿç±»struct Circle : public Shape &#123;    double radius;        Circle(double r) : radius(r) &#123;&#125;        std::string name() const override &#123; return &quot;Circle&quot;; &#125;    double area() const override &#123; return 3.14159 * radius * radius; &#125;&#125;;struct Square : public Shape &#123;    double side;        Square(double s) : side(s) &#123;&#125;        std::string name() const override &#123; return &quot;Square&quot;; &#125;    double area() const override &#123; return side * side; &#125;&#125;;// åŸºç±»è½¬æ¢å™¨namespace pybind11 &#123; namespace detail &#123;    template &lt;&gt; struct type_caster&lt;std::shared_ptr&lt;Shape&gt;&gt; &#123;    public:        PYBIND11_TYPE_CASTER(std::shared_ptr&lt;Shape&gt;, _(&quot;Shape&quot;));                bool load(handle src, bool) &#123;            if (!src.is_dict()) return false;                        py::dict obj = src.cast&lt;py::dict&gt;();            std::string type = obj[&quot;type&quot;].cast&lt;std::string&gt;();                        if (type == &quot;circle&quot;) &#123;                double radius = obj[&quot;radius&quot;].cast&lt;double&gt;();                value = std::make_shared&lt;Circle&gt;(radius);            &#125; else if (type == &quot;square&quot;) &#123;                double side = obj[&quot;side&quot;].cast&lt;double&gt;();                value = std::make_shared&lt;Square&gt;(side);            &#125; else &#123;                return false;            &#125;                        return true;        &#125;                static handle cast(const std::shared_ptr&lt;Shape&gt;&amp; shape,                           return_value_policy /* policy */, handle /* parent */) &#123;            py::dict obj;                        if (auto circle = std::dynamic_pointer_cast&lt;Circle&gt;(shape)) &#123;                obj[&quot;type&quot;] = &quot;circle&quot;;                obj[&quot;radius&quot;] = circle-&gt;radius;            &#125; else if (auto square = std::dynamic_pointer_cast&lt;Square&gt;(shape)) &#123;                obj[&quot;type&quot;] = &quot;square&quot;;                obj[&quot;side&quot;] = square-&gt;side;            &#125;                        obj[&quot;name&quot;] = shape-&gt;name();            obj[&quot;area&quot;] = shape-&gt;area();                        return obj.release();        &#125;    &#125;;&#125;&#125;PYBIND11_MODULE(example, m) &#123;    m.def(&quot;shape_info&quot;, [](const std::shared_ptr&lt;Shape&gt;&amp; shape) &#123;        return py::make_tuple(shape-&gt;name(), shape-&gt;area());    &#125;);        m.def(&quot;create_shape&quot;, [](const std::string&amp; type, double param) &#123;        if (type == &quot;circle&quot;) &#123;            return std::make_shared&lt;Circle&gt;(param);        &#125; else if (type == &quot;square&quot;) &#123;            return std::make_shared&lt;Square&gt;(param);        &#125;        throw std::invalid_argument(&quot;Unknown shape type&quot;);    &#125;);&#125;\nå…¶ä»–é«˜çº§ç‰¹æ€§\n1. å±æ€§è£…é¥°å™¨\n#include &lt;pybind11/pybind11.h&gt;#include &lt;string&gt;namespace py = pybind11;class Person &#123;public:    Person(const std::string&amp; name, int age)         : name(name), age(age) &#123;&#125;        std::string get_name() const &#123; return name; &#125;    void set_name(const std::string&amp; new_name) &#123; name = new_name; &#125;        int get_age() const &#123; return age; &#125;    void set_age(int new_age) &#123;         if (new_age &lt; 0) throw std::invalid_argument(&quot;å¹´é¾„ä¸èƒ½ä¸ºè´Ÿæ•°&quot;);        age = new_age;    &#125;        std::string get_full_info() const &#123;        return name + &quot;, &quot; + std::to_string(age) + &quot;å²&quot;;    &#125;    private:    std::string name;    int age;&#125;;PYBIND11_MODULE(example, m) &#123;    py::class_&lt;Person&gt;(m, &quot;Person&quot;)        .def(py::init&lt;const std::string&amp;, int&gt;())                // å¯è¯»å¯å†™å±æ€§        .def_property(&quot;name&quot;, &amp;Person::get_name, &amp;Person::set_name)                // å¸¦éªŒè¯çš„å±æ€§        .def_property(&quot;age&quot;, &amp;Person::get_age, &amp;Person::set_age)                // åªè¯»å±æ€§        .def_property_readonly(&quot;full_info&quot;, &amp;Person::get_full_info)                // é™æ€å±æ€§        .def_readwrite_static(&quot;species&quot;, []() &#123; return &quot;äººç±»&quot;; &#125;);&#125;\n2. æ–¹æ³•è£…é¥°å™¨\n#include &lt;pybind11/pybind11.h&gt;#include &lt;pybind11/functional.h&gt;#include &lt;string&gt;#include &lt;chrono&gt;namespace py = pybind11;// è®¡æ—¶è£…é¥°å™¨template &lt;typename Func&gt;auto timing_decorator(Func&amp;&amp; func) &#123;    return [func = std::forward&lt;Func&gt;(func)](auto&amp;&amp;... args) &#123;        auto start = std::chrono::high_resolution_clock::now();                auto result = func(std::forward&lt;decltype(args)&gt;(args)...);                auto end = std::chrono::high_resolution_clock::now();        auto duration = std::chrono::duration_cast&lt;std::chrono::microseconds&gt;(            end - start        );                py::print(&quot;å‡½æ•°æ‰§è¡Œæ—¶é—´:&quot;, duration.count(), &quot;å¾®ç§’&quot;);        return result;    &#125;;&#125;// ç¼“å­˜è£…é¥°å™¨template &lt;typename Func&gt;auto cache_decorator(Func&amp;&amp; func) &#123;    std::unordered_map&lt;std::string, py::object&gt; cache;        return [func = std::forward&lt;Func&gt;(func), cache = std::move(cache)](        const std::string&amp; key, auto&amp;&amp;... args    ) mutable &#123;        if (cache.find(key) != cache.end()) &#123;            py::print(&quot;ç¼“å­˜å‘½ä¸­:&quot;, key);            return cache[key];        &#125;                py::object result = func(key, std::forward&lt;decltype(args)&gt;(args)...);        cache[key] = result;        py::print(&quot;ç¼“å­˜æœªå‘½ä¸­ï¼Œè®¡ç®—ç»“æœ:&quot;, key);        return result;    &#125;;&#125;PYBIND11_MODULE(example, m) &#123;    // åŸå§‹å‡½æ•°    auto expensive_function = [](const std::string&amp; data) &#123;        // æ¨¡æ‹Ÿè€—æ—¶è®¡ç®—        std::this_thread::sleep_for(std::chrono::milliseconds(100));        return &quot;å¤„ç†ç»“æœ: &quot; + data;    &#125;;        // ä½¿ç”¨è£…é¥°å™¨    m.def(&quot;process_data&quot;, timing_decorator(expensive_function));    m.def(&quot;cached_process&quot;, cache_decorator(expensive_function));&#125;\n3. è‡ªå®šä¹‰å¼‚å¸¸\n#include &lt;pybind11/pybind11.h&gt;#include &lt;stdexcept&gt;#include &lt;string&gt;namespace py = pybind11;// è‡ªå®šä¹‰å¼‚å¸¸ç±»å‹class ValidationError : public std::runtime_error &#123;public:    ValidationError(const std::string&amp; message)         : std::runtime_error(message) &#123;&#125;&#125;;class DatabaseError : public std::runtime_error &#123;public:    DatabaseError(const std::string&amp; message, int code)         : std::runtime_error(message), error_code(code) &#123;&#125;        int get_code() const &#123; return error_code; &#125;    private:    int error_code;&#125;;PYBIND11_MODULE(example, m) &#123;    // ç»‘å®šè‡ªå®šä¹‰å¼‚å¸¸    auto validation_error = py::register_exception&lt;ValidationError&gt;(m, &quot;ValidationError&quot;);    auto db_error = py::register_exception&lt;DatabaseError&gt;(m, &quot;DatabaseError&quot;);        // ä¸ºå¼‚å¸¸æ·»åŠ é¢å¤–æ–¹æ³•    db_error.def(&quot;get_code&quot;, &amp;DatabaseError::get_code);        // ä½¿ç”¨è‡ªå®šä¹‰å¼‚å¸¸çš„å‡½æ•°    m.def(&quot;validate_age&quot;, [](int age) &#123;        if (age &lt; 0) &#123;            throw ValidationError(&quot;å¹´é¾„ä¸èƒ½ä¸ºè´Ÿæ•°&quot;);        &#125;        if (age &gt; 150) &#123;            throw ValidationError(&quot;å¹´é¾„ä¸èƒ½è¶…è¿‡150&quot;);        &#125;    &#125;);        m.def(&quot;connect_to_db&quot;, [](const std::string&amp; host) &#123;        if (host.empty()) &#123;            throw DatabaseError(&quot;æ•°æ®åº“ä¸»æœºä¸èƒ½ä¸ºç©º&quot;, 1001);        &#125;        if (host != &quot;localhost&quot;) &#123;            throw DatabaseError(&quot;è¿æ¥å¤±è´¥: æœªçŸ¥ä¸»æœº&quot;, 1002);        &#125;        return &quot;è¿æ¥æˆåŠŸ&quot;;    &#125;);&#125;\nPython ä½¿ç”¨ï¼š\nimport exampletry:    example.validate_age(-5)except example.ValidationError as e:    print(f&quot;éªŒè¯é”™è¯¯: &#123;e&#125;&quot;)try:    example.connect_to_db(&quot;invalid_host&quot;)except example.DatabaseError as e:    print(f&quot;æ•°æ®åº“é”™è¯¯: &#123;e&#125;, é”™è¯¯ç : &#123;e.get_code()&#125;&quot;)\n4. ä¸Šä¸‹æ–‡ç®¡ç†å™¨\n#include &lt;pybind11/pybind11.h&gt;#include &lt;pybind11/functional.h&gt;#include &lt;iostream&gt;#include &lt;chrono&gt;namespace py = pybind11;class Timer &#123;public:    Timer() : start_time(std::chrono::high_resolution_clock::now()) &#123;        std::cout &lt;&lt; &quot;è®¡æ—¶å™¨å¼€å§‹&quot; &lt;&lt; std::endl;    &#125;        ~Timer() &#123;        auto end_time = std::chrono::high_resolution_clock::now();        auto duration = std::chrono::duration_cast&lt;std::chrono::milliseconds&gt;(            end_time - start_time        );        std::cout &lt;&lt; &quot;è®¡æ—¶å™¨ç»“æŸï¼Œè€—æ—¶: &quot; &lt;&lt; duration.count() &lt;&lt; &quot;æ¯«ç§’&quot; &lt;&lt; std::endl;    &#125;        void reset() &#123;        start_time = std::chrono::high_resolution_clock::now();        std::cout &lt;&lt; &quot;è®¡æ—¶å™¨é‡ç½®&quot; &lt;&lt; std::endl;    &#125;    private:    std::chrono::high_resolution_clock::time_point start_time;&#125;;PYBIND11_MODULE(example, m) &#123;    py::class_&lt;Timer&gt;(m, &quot;Timer&quot;)        .def(py::init&lt;&gt;())        .def(&quot;reset&quot;, &amp;Timer::reset)                // å®ç°ä¸Šä¸‹æ–‡ç®¡ç†å™¨æ¥å£        .def(&quot;__enter__&quot;, [](Timer&amp; self) &#123;            return &amp;self;        &#125;)        .def(&quot;__exit__&quot;, [](Timer&amp; self, py::object type, py::object value, py::object traceback) &#123;            // __exit__æ–¹æ³•çš„è¿”å›å€¼è¡¨ç¤ºæ˜¯å¦å¤„ç†å¼‚å¸¸            return py::none();        &#125;);&#125;\nPython ä½¿ç”¨ï¼š\nimport exampleimport time# ä½¿ç”¨ä¸Šä¸‹æ–‡ç®¡ç†å™¨with example.Timer() as timer:    time.sleep(1)    timer.reset()    time.sleep(0.5)# è¾“å‡ºï¼š# è®¡æ—¶å™¨å¼€å§‹# è®¡æ—¶å™¨é‡ç½®# è®¡æ—¶å™¨ç»“æŸï¼Œè€—æ—¶: 500æ¯«ç§’\n5. è¿­ä»£å™¨æ”¯æŒ\n#include &lt;pybind11/pybind11.h&gt;#include &lt;vector&gt;#include &lt;string&gt;namespace py = pybind11;class NumberSequence &#123;public:    NumberSequence(int start, int end)         : start_(start), end_(end), current_(start) &#123;&#125;        // è¿­ä»£å™¨æ¥å£    int next() &#123;        if (current_ &gt; end_) &#123;            throw py::stop_iteration();        &#125;        return current_++;    &#125;        // é‡ç½®è¿­ä»£å™¨    void reset() &#123;        current_ = start_;    &#125;    private:    int start_;    int end_;    int current_;&#125;;PYBIND11_MODULE(example, m) &#123;    py::class_&lt;NumberSequence&gt;(m, &quot;NumberSequence&quot;)        .def(py::init&lt;int, int&gt;())        .def(&quot;reset&quot;, &amp;NumberSequence::reset)                // å®ç°è¿­ä»£å™¨åè®®        .def(&quot;__iter__&quot;, [](NumberSequence&amp; self) &#123;            self.reset();            return &amp;self;        &#125;)        .def(&quot;__next__&quot;, &amp;NumberSequence::next);        // èŒƒå›´è¿­ä»£å™¨ç¤ºä¾‹    m.def(&quot;range_generator&quot;, [](int n) &#123;        return py::make_iterator(range(0, n).begin(), range(0, n).end());    &#125;, py::keep_alive&lt;0, 1&gt;());&#125;\nPython ä½¿ç”¨ï¼š\nimport example# ä½¿ç”¨è‡ªå®šä¹‰è¿­ä»£å™¨seq = example.NumberSequence(1, 5)for num in seq:    print(num)  # è¾“å‡ºï¼š1, 2, 3, 4, 5# ä½¿ç”¨èŒƒå›´ç”Ÿæˆå™¨for i in example.range_generator(3):    print(i)  # è¾“å‡ºï¼š0, 1, 2\næ€»ç»“\næœ¬è¡¥å……æŒ‡å—æ¶µç›–äº† pybind11 å®˜æ–¹æ–‡æ¡£ä¸­çš„æ‰€æœ‰é‡è¦é«˜çº§ç‰¹æ€§ï¼š\næ ¸å¿ƒè¦ç‚¹\n\n\né«˜çº§ç±»ç‰¹æ€§ï¼šåŠ¨æ€å±æ€§ã€ç»§æ‰¿ä¸å¤šæ€ã€è¿ç®—ç¬¦é‡è½½ã€æšä¸¾ç»‘å®š\n\n\næ„å»ºç³»ç»Ÿï¼šCMakeã€pyproject.tomlã€setuptools çš„é«˜çº§é…ç½®\n\n\nå†…å­˜ç®¡ç†ï¼šè¿”å›å€¼ç­–ç•¥ã€æ™ºèƒ½æŒ‡é’ˆï¼ˆsmart_holderã€unique_ptrã€shared_ptrï¼‰\n\n\nç±»å‹ç³»ç»Ÿï¼šåŸºç¡€ç±»å‹è½¬æ¢ã€STL å®¹å™¨ã€è‡ªå®šä¹‰ç±»å‹è½¬æ¢å™¨\n\n\nåµŒå…¥ä¸æ‰©å±•ï¼šPython è§£é‡Šå™¨åµŒå…¥ã€å­è§£é‡Šå™¨ã€å¤šçº¿ç¨‹ GIL ç®¡ç†\n\n\né«˜çº§åŠŸèƒ½ï¼šå±æ€§è£…é¥°å™¨ã€æ–¹æ³•è£…é¥°å™¨ã€è‡ªå®šä¹‰å¼‚å¸¸ã€ä¸Šä¸‹æ–‡ç®¡ç†å™¨ã€è¿­ä»£å™¨\n\n\næœ€ä½³å®è·µ\n\n\nå†…å­˜å®‰å…¨ï¼šæ­£ç¡®ä½¿ç”¨è¿”å›å€¼ç­–ç•¥ï¼Œä¼˜å…ˆä½¿ç”¨ smart_holder\n\n\næ€§èƒ½ä¼˜åŒ–ï¼šåˆç†é‡Šæ”¾ GILï¼Œä½¿ç”¨å¤šçº¿ç¨‹å’Œå¼‚æ­¥ä»»åŠ¡\n\n\nç±»å‹å®‰å…¨ï¼šä½¿ç”¨å¼ºç±»å‹è½¬æ¢ï¼Œé¿å…éšå¼è½¬æ¢é”™è¯¯\n\n\nä»£ç ç»„ç»‡ï¼šæ¨¡å—åŒ–è®¾è®¡ï¼Œåˆ†ç¦»å®ç°å’Œç»‘å®šä»£ç \n\n\né”™è¯¯å¤„ç†ï¼šä½¿ç”¨è‡ªå®šä¹‰å¼‚å¸¸ï¼Œæä¾›è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯\n\n\nè¿›é˜¶å­¦ä¹ \n\n\næ€§èƒ½è°ƒä¼˜ï¼šä½¿ç”¨ LTO ä¼˜åŒ–ã€ç¼“å­˜æœºåˆ¶ã€å¼‚æ­¥ç¼–ç¨‹\n\n\nè°ƒè¯•æŠ€å·§ï¼šGDB è°ƒè¯•ã€Python è°ƒè¯•å™¨é›†æˆ\n\n\næµ‹è¯•ç­–ç•¥ï¼šå•å…ƒæµ‹è¯•ã€é›†æˆæµ‹è¯•ã€æ€§èƒ½æµ‹è¯•\n\n\néƒ¨ç½²æ–¹æ¡ˆï¼šwheel æ‰“åŒ…ã€conda åŒ…ã€Docker å®¹å™¨åŒ–\n\n\npybind11 ä¸º C++ å’Œ Python çš„æ— ç¼é›†æˆæä¾›äº†å¼ºå¤§çš„æ”¯æŒï¼ŒæŒæ¡è¿™äº›é«˜çº§ç‰¹æ€§å°†å¸®åŠ©æ‚¨å¼€å‘å‡ºæ›´åŠ é«˜æ•ˆã€å¥å£®çš„è·¨è¯­è¨€åº”ç”¨ç¨‹åºã€‚\nDate: October 16, 2025\nCode: https://github.com/pybind/pybind11\n","categories":["ç¼–ç¨‹"],"tags":["python","C++"]},{"title":"PyBind11ä½¿ç”¨æŒ‡åŒ—","url":"/2025/09/09/C++/pybind11%20%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/","content":"\nå¦‚é¢˜ï¼Œç»“åˆå®˜æ–¹æ–‡æ¡£ä¸ç½‘ç»œå¸–å­ï¼Œåˆ©ç”¨AIæ•´ç†\n\n\npybind11 ä½¿ç”¨æŒ‡å—\nç›®å½•\n\n\nç®€ä»‹\n\n\nå®‰è£…\n\n\nåŸºç¡€ç”¨æ³•\n\n\nè¿›é˜¶ç”¨æ³•\n\n\né«˜çº§ç‰¹æ€§\n\n\nå®é™…æ¡ˆä¾‹\n\n\næœ€ä½³å®è·µ\n\n\nå¸¸è§é—®é¢˜\n\n\nç®€ä»‹\npybind11 æ˜¯ä¸€ä¸ªè½»é‡çº§çš„ä»…å¤´æ–‡ä»¶ C++ åº“ï¼Œç”¨äºå°† C++ ä»£ç æš´éœ²ç»™ Python è°ƒç”¨ï¼Œæˆ–è€…åœ¨ C++ ä¸­è°ƒç”¨ Python ä»£ç ã€‚å®ƒæ¯”ä¼ ç»Ÿçš„ Boost.Python æ›´ç®€æ´é«˜æ•ˆï¼Œé€‚ç”¨äºç°ä»£ C++ï¼ˆC++11 åŠä»¥ä¸Šï¼‰ã€‚\næ ¸å¿ƒç‰¹æ€§\n\n\nå‡½æ•°ç»‘å®šï¼šå°† C++ å‡½æ•°æš´éœ²ç»™ Python\n\n\nç±»ç»‘å®šï¼šå°† C++ ç±»åŠå…¶æ–¹æ³•æš´éœ²ç»™ Python\n\n\næ•°æ®ç±»å‹è½¬æ¢ï¼šæ”¯æŒåŸºæœ¬ç±»å‹ã€STL å®¹å™¨ã€NumPy æ•°ç»„ç­‰\n\n\nå¼‚å¸¸å¤„ç†ï¼šC++ å¼‚å¸¸ä¸ Python å¼‚å¸¸çš„è½¬æ¢\n\n\nç»§æ‰¿æ”¯æŒï¼šæ”¯æŒ C++ ç±»ç»§æ‰¿å’Œ Python ç»§æ‰¿ C++ ç±»\n\n\nè¿ç®—ç¬¦é‡è½½ï¼šæ”¯æŒ C++ è¿ç®—ç¬¦åœ¨ Python ä¸­çš„ä½¿ç”¨\n\n\nä¼˜åŠ¿\n\n\nä»…å¤´æ–‡ä»¶ï¼šæ— éœ€é“¾æ¥é¢å¤–åº“ï¼Œç¼–è¯‘ç®€å•\n\n\nç°ä»£ C++ï¼šå……åˆ†åˆ©ç”¨ C++11/14/17 ç‰¹æ€§\n\n\nè‡ªåŠ¨ç±»å‹æ¨æ–­ï¼šå‡å°‘æ ·æ¿ä»£ç \n\n\né«˜æ€§èƒ½ï¼šæ¥è¿‘åŸç”Ÿ C++ æ€§èƒ½\n\n\næ˜“äºä½¿ç”¨ï¼šç®€æ´çš„ API è®¾è®¡\n\n\nå®‰è£…\nä½¿ç”¨ pip å®‰è£…\npip install pybind11\nä»æºç å®‰è£…ï¼ˆæ¨èï¼‰\ngit clone https://github.com/pybind/pybind11.gitcd pybind11mkdir build &amp;&amp; cd buildcmake ..make install\néªŒè¯å®‰è£…\npython -m pybind11 --includes\næˆåŠŸå®‰è£…ä¼šæ˜¾ç¤ºå¤´æ–‡ä»¶è·¯å¾„ï¼Œä¾‹å¦‚ï¼š\n-I/usr/local/include/python3.8 -I/usr/local/include/pybind11\nåŸºç¡€ç”¨æ³•\n1. ç®€å•å‡½æ•°ç»‘å®š\nåˆ›å»ºä¸€ä¸ªç®€å•çš„ C++ å‡½æ•°å¹¶æš´éœ²ç»™ Pythonã€‚\nç¤ºä¾‹ä»£ç ï¼šexample.cpp\n#include &lt;pybind11/pybind11.h&gt;// ç®€å•çš„åŠ æ³•å‡½æ•°int add(int a, int b) &#123;    return a + b;&#125;// æ¨¡å—å®šä¹‰PYBIND11_MODULE(example, m) &#123;    m.doc() = &quot;pybind11ç¤ºä¾‹æ¨¡å—&quot;;  // æ¨¡å—æ–‡æ¡£å­—ç¬¦ä¸²        // ç»‘å®šå‡½æ•°    m.def(&quot;add&quot;, &amp;add, &quot;ä¸€ä¸ªåŠ æ³•å‡½æ•°&quot;,           pybind11::arg(&quot;a&quot;), pybind11::arg(&quot;b&quot;));&#125;\nç¼–è¯‘æ–¹æ³•\nLinux/macOSï¼š\nc++ -O3 -Wall -shared -std=c++11 -fPIC $(python3 -m pybind11 --includes) example.cpp -o example$(python3-config --extension-suffix)\nWindowsï¼ˆMSVCï¼‰ï¼š\ncl /EHsc /LD /I C:\\path\\to\\Python\\include /I C:\\path\\to\\pybind11\\include example.cpp /link /LIBPATH:C:\\path\\to\\Python\\libs\nPython ä¸­ä½¿ç”¨\nimport exampleprint(example.add(3, 4))  # è¾“å‡ºï¼š7print(example.add(a=5, b=6))  # è¾“å‡ºï¼š11ï¼ˆå…³é”®å­—å‚æ•°ï¼‰\n2. ä½¿ç”¨ setuptools ç¼–è¯‘\nåˆ›å»ºsetup.pyæ–‡ä»¶ï¼š\nfrom setuptools import setupfrom pybind11.setup_helpers import Pybind11Extensionext_modules = [    Pybind11Extension(        &quot;example&quot;,        [&quot;example.cpp&quot;],        extra_compile_args=[&quot;-O3&quot;, &quot;-std=c++11&quot;]    ),]setup(    name=&quot;example&quot;,    ext_modules=ext_modules,    zip_safe=False,)\nç¼–è¯‘å®‰è£…ï¼š\npython setup.py build_ext --inplace\n3. å¸¦é»˜è®¤å‚æ•°çš„å‡½æ•°\n#include &lt;pybind11/pybind11.h&gt;int add(int a, int b = 10) &#123;    return a + b;&#125;PYBIND11_MODULE(example, m) &#123;    m.def(&quot;add&quot;, &amp;add, &quot;å¸¦é»˜è®¤å‚æ•°çš„åŠ æ³•å‡½æ•°&quot;,          pybind11::arg(&quot;a&quot;), pybind11::arg(&quot;b&quot;) = 10);&#125;\nPython ä½¿ç”¨ï¼š\nimport exampleprint(example.add(5))      # è¾“å‡ºï¼š15ï¼ˆä½¿ç”¨é»˜è®¤å‚æ•°b=10ï¼‰print(example.add(5, 3))   # è¾“å‡ºï¼š8\n4. æš´éœ²å˜é‡\n#include &lt;pybind11/pybind11.h&gt;namespace py = pybind11;PYBIND11_MODULE(example, m) &#123;    m.attr(&quot;the_answer&quot;) = 42;    m.attr(&quot;what&quot;) = &quot;World&quot;;        const char* version = &quot;1.0.0&quot;;    m.attr(&quot;version&quot;) = version;&#125;\nPython ä½¿ç”¨ï¼š\nimport exampleprint(example.the_answer)  # è¾“å‡ºï¼š42print(example.what)        # è¾“å‡ºï¼šWorldprint(example.version)     # è¾“å‡ºï¼š1.0.0\nè¿›é˜¶ç”¨æ³•\n1. ç±»ç»‘å®š\nå°† C++ ç±»æš´éœ²ç»™ Pythonã€‚\nç¤ºä¾‹ä»£ç \n#include &lt;pybind11/pybind11.h&gt;#include &lt;string&gt;namespace py = pybind11;// C++ç±»class Pet &#123;public:    Pet(const std::string&amp; name) : name(name) &#123;&#125;        void set_name(const std::string&amp; new_name) &#123;        name = new_name;    &#125;        std::string get_name() const &#123;        return name;    &#125;        std::string speak() const &#123;        return &quot;Woof!&quot;;    &#125;private:    std::string name;&#125;;// æ´¾ç”Ÿç±»class Dog : public Pet &#123;public:    Dog(const std::string&amp; name) : Pet(name) &#123;&#125;        std::string speak() const override &#123;        return &quot;æ±ªæ±ªï¼&quot;;    &#125;        void wag_tail() &#123;        // æ‘‡å°¾å·´çš„å®ç°    &#125;&#125;;PYBIND11_MODULE(example, m) &#123;    // ç»‘å®šåŸºç±»    py::class_&lt;Pet&gt;(m, &quot;Pet&quot;)        .def(py::init&lt;const std::string&amp;&gt;(), &quot;å® ç‰©ç±»æ„é€ å‡½æ•°&quot;)        .def(&quot;set_name&quot;, &amp;Pet::set_name, &quot;è®¾ç½®å® ç‰©åå­—&quot;)        .def(&quot;get_name&quot;, &amp;Pet::get_name, &quot;è·å–å® ç‰©åå­—&quot;)        .def(&quot;speak&quot;, &amp;Pet::speak, &quot;å® ç‰©å«å£°&quot;)        .def_readwrite(&quot;name&quot;, &amp;Pet::name, &quot;å® ç‰©åå­—å±æ€§&quot;);        // ç»‘å®šæ´¾ç”Ÿç±»    py::class_&lt;Dog, Pet&gt;(m, &quot;Dog&quot;)        .def(py::init&lt;const std::string&amp;&gt;(), &quot;ç‹—ç±»æ„é€ å‡½æ•°&quot;)        .def(&quot;speak&quot;, &amp;Dog::speak, &quot;ç‹—å«å£°&quot;)        .def(&quot;wag_tail&quot;, &amp;Dog::wag_tail, &quot;æ‘‡å°¾å·´&quot;);&#125;\nPython ä½¿ç”¨\nimport example# åˆ›å»ºPetå¯¹è±¡pet = example.Pet(&quot;å°çŒ«&quot;)print(pet.get_name())  # è¾“å‡ºï¼šå°çŒ«print(pet.speak())     # è¾“å‡ºï¼šWoof!# åˆ›å»ºDogå¯¹è±¡ï¼ˆç»§æ‰¿è‡ªPetï¼‰dog = example.Dog(&quot;å°ç‹—&quot;)print(dog.get_name())  # è¾“å‡ºï¼šå°ç‹—print(dog.speak())     # è¾“å‡ºï¼šæ±ªæ±ªï¼ï¼ˆå¤šæ€ï¼‰dog.wag_tail()\n2. å‡½æ•°é‡è½½\n#include &lt;pybind11/pybind11.h&gt;#include &lt;string&gt;namespace py = pybind11;// é‡è½½å‡½æ•°int add(int a, int b) &#123;    return a + b;&#125;double add(double a, double b) &#123;    return a + b;&#125;std::string add(const std::string&amp; a, const std::string&amp; b) &#123;    return a + b;&#125;PYBIND11_MODULE(example, m) &#123;    // ç»‘å®šé‡è½½å‡½æ•°    m.def(&quot;add&quot;, py::overload_cast&lt;int, int&gt;(&amp;add), &quot;æ•´æ•°åŠ æ³•&quot;);    m.def(&quot;add&quot;, py::overload_cast&lt;double, double&gt;(&amp;add), &quot;æµ®ç‚¹æ•°åŠ æ³•&quot;);    m.def(&quot;add&quot;, py::overload_cast&lt;const std::string&amp;, const std::string&amp;&gt;(&amp;add), &quot;å­—ç¬¦ä¸²è¿æ¥&quot;);&#125;\n3. é™æ€æ–¹æ³•å’Œå±æ€§\n#include &lt;pybind11/pybind11.h&gt;namespace py = pybind11;class MathUtils &#123;public:    static int square(int x) &#123;        return x * x;    &#125;        static double pi;&#125;;double MathUtils::pi = 3.1415926535;PYBIND11_MODULE(example, m) &#123;    py::class_&lt;MathUtils&gt;(m, &quot;MathUtils&quot;)        .def_static(&quot;square&quot;, &amp;MathUtils::square, &quot;è®¡ç®—å¹³æ–¹&quot;)        .def_readwrite_static(&quot;pi&quot;, &amp;MathUtils::pi, &quot;åœ†å‘¨ç‡&quot;);&#125;\nPython ä½¿ç”¨ï¼š\nimport exampleprint(example.MathUtils.square(5))  # è¾“å‡ºï¼š25print(example.MathUtils.pi)        # è¾“å‡ºï¼š3.1415926535\n4. å¼‚å¸¸å¤„ç†\n#include &lt;pybind11/pybind11.h&gt;#include &lt;stdexcept&gt;namespace py = pybind11;int divide(int a, int b) &#123;    if (b == 0) &#123;        throw std::runtime_error(&quot;é™¤é›¶é”™è¯¯ï¼&quot;);    &#125;    return a / b;&#125;PYBIND11_MODULE(example, m) &#123;    m.def(&quot;divide&quot;, &amp;divide, &quot;é™¤æ³•å‡½æ•°&quot;);&#125;\nPython ä¸­æ•è·å¼‚å¸¸ï¼š\nimport exampletry:    result = example.divide(10, 0)except RuntimeError as e:    print(f&quot;æ•è·å¼‚å¸¸ï¼š&#123;e&#125;&quot;)  # è¾“å‡ºï¼šæ•è·å¼‚å¸¸ï¼šé™¤é›¶é”™è¯¯ï¼\né«˜çº§ç‰¹æ€§\n1. STL å®¹å™¨æ”¯æŒ\néœ€è¦åŒ…å«é¢å¤–çš„å¤´æ–‡ä»¶ï¼š\n#include &lt;pybind11/pybind11.h&gt;#include &lt;pybind11/stl.h&gt;  // æ”¯æŒSTLå®¹å™¨#include &lt;vector&gt;#include &lt;map&gt;#include &lt;string&gt;namespace py = pybind11;// å¤„ç†vectorstd::vector&lt;int&gt; double_list(const std::vector&lt;int&gt;&amp; lst) &#123;    std::vector&lt;int&gt; result;    for (int x : lst) &#123;        result.push_back(x * 2);    &#125;    return result;&#125;// å¤„ç†mapstd::map&lt;std::string, int&gt; count_words(const std::vector&lt;std::string&gt;&amp; words) &#123;    std::map&lt;std::string, int&gt; counts;    for (const auto&amp; word : words) &#123;        counts[word]++;    &#125;    return counts;&#125;PYBIND11_MODULE(example, m) &#123;    m.def(&quot;double_list&quot;, &amp;double_list, &quot;å°†åˆ—è¡¨ä¸­çš„æ¯ä¸ªå…ƒç´ ç¿»å€&quot;);    m.def(&quot;count_words&quot;, &amp;count_words, &quot;ç»Ÿè®¡å•è¯å‡ºç°æ¬¡æ•°&quot;);&#125;\nPython ä½¿ç”¨ï¼š\nimport example# æµ‹è¯•vectorresult = example.double_list([1, 2, 3, 4])print(result)  # è¾“å‡ºï¼š[2, 4, 6, 8]# æµ‹è¯•mapwords = [&quot;apple&quot;, &quot;banana&quot;, &quot;apple&quot;, &quot;orange&quot;, &quot;banana&quot;, &quot;apple&quot;]counts = example.count_words(words)print(counts)  # è¾“å‡ºï¼š&#123;&#x27;apple&#x27;: 3, &#x27;banana&#x27;: 2, &#x27;orange&#x27;: 1&#125;\n2. NumPy æ•°ç»„æ”¯æŒ\n#include &lt;pybind11/pybind11.h&gt;#include &lt;pybind11/numpy.h&gt;namespace py = pybind11;// çŸ©é˜µåŠ æ³•py::array_t&lt;double&gt; add_matrices(py::array_t&lt;double&gt; a, py::array_t&lt;double&gt; b) &#123;    // è·å–æ•°ç»„ä¿¡æ¯    py::buffer_info a_info = a.request();    py::buffer_info b_info = b.request();        // æ£€æŸ¥ç»´åº¦å’Œå¤§å°    if (a_info.ndim != 2 || b_info.ndim != 2) &#123;        throw std::runtime_error(&quot;æ•°ç»„å¿…é¡»æ˜¯äºŒç»´çš„&quot;);    &#125;        if (a_info.shape[0] != b_info.shape[0] || a_info.shape[1] != b_info.shape[1]) &#123;        throw std::runtime_error(&quot;æ•°ç»„å½¢çŠ¶ä¸åŒ¹é…&quot;);    &#125;        // åˆ›å»ºç»“æœæ•°ç»„    auto result = py::array_t&lt;double&gt;(a_info.shape);    py::buffer_info res_info = result.request();        // è·å–æŒ‡é’ˆ    double *a_ptr = static_cast&lt;double *&gt;(a_info.ptr);    double *b_ptr = static_cast&lt;double *&gt;(b_info.ptr);    double *res_ptr = static_cast&lt;double *&gt;(res_info.ptr);        // æ‰§è¡ŒåŠ æ³•    size_t size = a_info.shape[0] * a_info.shape[1];    for (size_t i = 0; i &lt; size; i++) &#123;        res_ptr[i] = a_ptr[i] + b_ptr[i];    &#125;        return result;&#125;PYBIND11_MODULE(example, m) &#123;    m.def(&quot;add_matrices&quot;, &amp;add_matrices, &quot;çŸ©é˜µåŠ æ³•&quot;);&#125;\nPython ä½¿ç”¨ï¼š\nimport exampleimport numpy as npa = np.array([[1.0, 2.0], [3.0, 4.0]])b = np.array([[5.0, 6.0], [7.0, 8.0]])result = example.add_matrices(a, b)print(result)# è¾“å‡ºï¼š# [[ 6.  8.]#  [10. 12.]]\n3. åœ¨ C++ ä¸­è°ƒç”¨ Python\n#include &lt;pybind11/embed.h&gt;  // å¿…é¡»åŒ…å«è¿™ä¸ªå¤´æ–‡ä»¶#include &lt;iostream&gt;#include &lt;string&gt;namespace py = pybind11;int main() &#123;    // å¯åŠ¨Pythonè§£é‡Šå™¨    py::scoped_interpreter guard&#123;&#125;;        try &#123;        // å¯¼å…¥Pythonæ¨¡å—        py::module sys = py::module::import(&quot;sys&quot;);        py::module math = py::module::import(&quot;math&quot;);        py::module json = py::module::import(&quot;json&quot;);                // è°ƒç”¨Pythonå‡½æ•°        double sqrt_result = math.attr(&quot;sqrt&quot;)(2.0).cast&lt;double&gt;();        std::cout &lt;&lt; &quot;sqrt(2) = &quot; &lt;&lt; sqrt_result &lt;&lt; std::endl;                // åˆ›å»ºPythonå­—å…¸        py::dict person;        person[&quot;name&quot;] = &quot;å¼ ä¸‰&quot;;        person[&quot;age&quot;] = 30;        person[&quot;city&quot;] = &quot;åŒ—äº¬&quot;;                // ä½¿ç”¨jsonæ¨¡å—åºåˆ—åŒ–        std::string json_str = json.attr(&quot;dumps&quot;)(person).cast&lt;std::string&gt;();        std::cout &lt;&lt; &quot;JSON: &quot; &lt;&lt; json_str &lt;&lt; std::endl;                // æ‰§è¡ŒPythonä»£ç         py::exec(R&quot;(            print(&quot;Hello from Python!&quot;)            result = 1 + 2 + 3            print(f&quot;1 + 2 + 3 = &#123;result&#125;&quot;)        )&quot;);            &#125; catch (const py::error_already_set&amp; e) &#123;        std::cerr &lt;&lt; &quot;Python error: &quot; &lt;&lt; e.what() &lt;&lt; std::endl;        return 1;    &#125;        return 0;&#125;\n4. è¿ç®—ç¬¦é‡è½½\n#include &lt;pybind11/pybind11.h&gt;#include &lt;pybind11/operators.h&gt;namespace py = pybind11;class Vector2 &#123;public:    float x, y;        Vector2(float x = 0, float y = 0) : x(x), y(y) &#123;&#125;        Vector2 operator+(const Vector2&amp; other) const &#123;        return Vector2(x + other.x, y + other.y);    &#125;        Vector2 operator*(float scalar) const &#123;        return Vector2(x * scalar, y * scalar);    &#125;        bool operator==(const Vector2&amp; other) const &#123;        return x == other.x &amp;&amp; y == other.y;    &#125;        std::string to_string() const &#123;        return &quot;(&quot; + std::to_string(x) + &quot;, &quot; + std::to_string(y) + &quot;)&quot;;    &#125;&#125;;PYBIND11_MODULE(example, m) &#123;    py::class_&lt;Vector2&gt;(m, &quot;Vector2&quot;)        .def(py::init&lt;float, float&gt;(), &quot;äºŒç»´å‘é‡&quot;)        .def_readwrite(&quot;x&quot;, &amp;Vector2::x)        .def_readwrite(&quot;y&quot;, &amp;Vector2::y)        .def(&quot;__str__&quot;, &amp;Vector2::to_string)                // è¿ç®—ç¬¦é‡è½½        .def(py::self + py::self)          // + è¿ç®—ç¬¦        .def(py::self * float())           // * è¿ç®—ç¬¦ï¼ˆå‘é‡ * æ ‡é‡ï¼‰        .def(float() * py::self)           // * è¿ç®—ç¬¦ï¼ˆæ ‡é‡ * å‘é‡ï¼‰        .def(py::self == py::self);        // == è¿ç®—ç¬¦&#125;\nPython ä½¿ç”¨ï¼š\nimport examplev1 = example.Vector2(1, 2)v2 = example.Vector2(3, 4)v3 = v1 + v2print(v3)  # è¾“å‡ºï¼š(4.000000, 6.000000)v4 = v1 * 2print(v4)  # è¾“å‡ºï¼š(2.000000, 4.000000)v5 = 3 * v2print(v5)  # è¾“å‡ºï¼š(9.000000, 12.000000)print(v1 == v2)  # è¾“å‡ºï¼šFalse\nå®é™…æ¡ˆä¾‹\næ¡ˆä¾‹ 1ï¼šé«˜æ€§èƒ½æ•°å€¼è®¡ç®—\n#include &lt;pybind11/pybind11.h&gt;#include &lt;pybind11/numpy.h&gt;#include &lt;vector&gt;namespace py = pybind11;// è®¡ç®—æ•°ç»„çš„ç§»åŠ¨å¹³å‡å€¼py::array_t&lt;double&gt; moving_average(py::array_t&lt;double&gt; data, int window_size) &#123;    py::buffer_info buf = data.request();        if (buf.ndim != 1) &#123;        throw std::runtime_error(&quot;åªæ”¯æŒä¸€ç»´æ•°ç»„&quot;);    &#125;        size_t n = buf.size;    if (window_size &gt; n) &#123;        throw std::runtime_error(&quot;çª—å£å¤§å°ä¸èƒ½å¤§äºæ•°ç»„é•¿åº¦&quot;);    &#125;        auto result = py::array_t&lt;double&gt;(n - window_size + 1);    py::buffer_info res_buf = result.request();        double *data_ptr = static_cast&lt;double *&gt;(buf.ptr);    double *res_ptr = static_cast&lt;double *&gt;(res_buf.ptr);        // è®¡ç®—åˆå§‹çª—å£    double sum = 0;    for (int i = 0; i &lt; window_size; i++) &#123;        sum += data_ptr[i];    &#125;    res_ptr[0] = sum / window_size;        // æ»‘åŠ¨çª—å£    for (size_t i = 1; i &lt;= n - window_size; i++) &#123;        sum = sum - data_ptr[i-1] + data_ptr[i + window_size - 1];        res_ptr[i] = sum / window_size;    &#125;        return result;&#125;PYBIND11_MODULE(performance, m) &#123;    m.def(&quot;moving_average&quot;, &amp;moving_average, &quot;è®¡ç®—ç§»åŠ¨å¹³å‡å€¼&quot;,          py::arg(&quot;data&quot;), py::arg(&quot;window_size&quot;));&#125;\næ¡ˆä¾‹ 2ï¼šå›¾åƒå¤„ç†ç®—æ³•\n#include &lt;pybind11/pybind11.h&gt;#include &lt;pybind11/numpy.h&gt;#include &lt;algorithm&gt;namespace py = pybind11;// å›¾åƒç°åº¦åŒ–py::array_t&lt;uint8_t&gt; rgb_to_gray(py::array_t&lt;uint8_t&gt; image) &#123;    py::buffer_info buf = image.request();        if (buf.ndim != 3 || buf.shape[2] != 3) &#123;        throw std::runtime_error(&quot;è¾“å…¥å¿…é¡»æ˜¯RGBå›¾åƒ&quot;);    &#125;        size_t height = buf.shape[0];    size_t width = buf.shape[1];        auto gray = py::array_t&lt;uint8_t&gt;(&#123;height, width&#125;);    py::buffer_info gray_buf = gray.request();        uint8_t *img_ptr = static_cast&lt;uint8_t *&gt;(buf.ptr);    uint8_t *gray_ptr = static_cast&lt;uint8_t *&gt;(gray_buf.ptr);        for (size_t i = 0; i &lt; height; i++) &#123;        for (size_t j = 0; j &lt; width; j++) &#123;            size_t idx = i * width * 3 + j * 3;            uint8_t r = img_ptr[idx];            uint8_t g = img_ptr[idx + 1];            uint8_t b = img_ptr[idx + 2];                        // ç°åº¦åŒ–å…¬å¼            gray_ptr[i * width + j] = static_cast&lt;uint8_t&gt;(                0.299 * r + 0.587 * g + 0.114 * b            );        &#125;    &#125;        return gray;&#125;PYBIND11_MODULE(imageprocessing, m) &#123;    m.def(&quot;rgb_to_gray&quot;, &amp;rgb_to_gray, &quot;RGBå›¾åƒè½¬ç°åº¦å›¾åƒ&quot;);&#125;\næ¡ˆä¾‹ 3ï¼šæ•°æ®ç»“æ„åŒ…è£…\n#include &lt;pybind11/pybind11.h&gt;#include &lt;pybind11/stl.h&gt;#include &lt;queue&gt;#include &lt;stack&gt;#include &lt;unordered_map&gt;namespace py = pybind11;// æ ˆæ•°æ®ç»“æ„template &lt;typename T&gt;class Stack &#123;private:    std::stack&lt;T&gt; stack_;    public:    void push(const T&amp; value) &#123;        stack_.push(value);    &#125;        T pop() &#123;        if (stack_.empty()) &#123;            throw std::runtime_error(&quot;æ ˆä¸ºç©º&quot;);        &#125;        T top = stack_.top();        stack_.pop();        return top;    &#125;        T top() const &#123;        if (stack_.empty()) &#123;            throw std::runtime_error(&quot;æ ˆä¸ºç©º&quot;);        &#125;        return stack_.top();    &#125;        bool empty() const &#123;        return stack_.empty();    &#125;        size_t size() const &#123;        return stack_.size();    &#125;&#125;;// é˜Ÿåˆ—æ•°æ®ç»“æ„template &lt;typename T&gt;class Queue &#123;private:    std::queue&lt;T&gt; queue_;    public:    void enqueue(const T&amp; value) &#123;        queue_.push(value);    &#125;        T dequeue() &#123;        if (queue_.empty()) &#123;            throw std::runtime_error(&quot;é˜Ÿåˆ—ä¸ºç©º&quot;);        &#125;        T front = queue_.front();        queue_.pop();        return front;    &#125;        T front() const &#123;        if (queue_.empty()) &#123;            throw std::runtime_error(&quot;é˜Ÿåˆ—ä¸ºç©º&quot;);        &#125;        return queue_.front();    &#125;        bool empty() const &#123;        return queue_.empty();    &#125;        size_t size() const &#123;        return queue_.size();    &#125;&#125;;PYBIND11_MODULE(datastructures, m) &#123;    // ç»‘å®šæ ˆ    py::class_&lt;Stack&lt;int&gt;&gt;(m, &quot;IntStack&quot;)        .def(py::init&lt;&gt;())        .def(&quot;push&quot;, &amp;Stack&lt;int&gt;::push)        .def(&quot;pop&quot;, &amp;Stack&lt;int&gt;::pop)        .def(&quot;top&quot;, &amp;Stack&lt;int&gt;::top)        .def(&quot;empty&quot;, &amp;Stack&lt;int&gt;::empty)        .def(&quot;size&quot;, &amp;Stack&lt;int&gt;::size);        // ç»‘å®šé˜Ÿåˆ—    py::class_&lt;Queue&lt;std::string&gt;&gt;(m, &quot;StringQueue&quot;)        .def(py::init&lt;&gt;())        .def(&quot;enqueue&quot;, &amp;Queue&lt;std::string&gt;::enqueue)        .def(&quot;dequeue&quot;, &amp;Queue&lt;std::string&gt;::dequeue)        .def(&quot;front&quot;, &amp;Queue&lt;std::string&gt;::front)        .def(&quot;empty&quot;, &amp;Queue&lt;std::string&gt;::empty)        .def(&quot;size&quot;, &amp;Queue&lt;std::string&gt;::size);&#125;\næœ€ä½³å®è·µ\n1. ä»£ç ç»„ç»‡\næ¨èçš„é¡¹ç›®ç»“æ„ï¼š\nproject/â”œâ”€â”€ src/â”‚   â”œâ”€â”€ mymodule/â”‚   â”‚   â”œâ”€â”€ core/â”‚   â”‚   â”‚   â”œâ”€â”€ algorithm.cppâ”‚   â”‚   â”‚   â”œâ”€â”€ algorithm.hâ”‚   â”‚   â”‚   â”œâ”€â”€ data_structures.cppâ”‚   â”‚   â”‚   â””â”€â”€ data_structures.hâ”‚   â”‚   â””â”€â”€ bindings.cpp      # pybind11ç»‘å®šä»£ç â”‚   â””â”€â”€ CMakeLists.txtâ”œâ”€â”€ tests/â”‚   â”œâ”€â”€ test_basic.pyâ”‚   â””â”€â”€ test_advanced.pyâ”œâ”€â”€ setup.pyâ”œâ”€â”€ CMakeLists.txtâ””â”€â”€ README.md\n2. æ€§èƒ½ä¼˜åŒ–\nç¼–è¯‘ä¼˜åŒ–ï¼š\n# ä½¿ç”¨æœ€é«˜ä¼˜åŒ–çº§åˆ«c++ -O3 -Wall -shared -std=c++17 -fPIC ...# ä½¿ç”¨é“¾æ¥æ—¶é—´ä¼˜åŒ–ï¼ˆLTOï¼‰c++ -O3 -flto -Wall -shared -std=c++17 -fPIC ...\nå†…å­˜ç®¡ç†ï¼š\n// ä½¿ç”¨æ™ºèƒ½æŒ‡é’ˆ#include &lt;memory&gt;class MyClass &#123;    // ...&#125;;PYBIND11_MODULE(example, m) &#123;    py::class_&lt;MyClass, std::shared_ptr&lt;MyClass&gt;&gt;(m, &quot;MyClass&quot;)        .def(py::init&lt;&gt;())        // ...        ;&#125;\n3. é”™è¯¯å¤„ç†\n#include &lt;pybind11/pybind11.h&gt;#include &lt;stdexcept&gt;namespace py = pybind11;void process_data(const std::vector&lt;int&gt;&amp; data) &#123;    if (data.empty()) &#123;        throw std::invalid_argument(&quot;æ•°æ®ä¸èƒ½ä¸ºç©º&quot;);    &#125;        if (data.size() &gt; 1000000) &#123;        throw std::length_error(&quot;æ•°æ®é‡è¿‡å¤§&quot;);    &#125;        // å¤„ç†æ•°æ®...&#125;PYBIND11_MODULE(example, m) &#123;    m.def(&quot;process_data&quot;, [](const std::vector&lt;int&gt;&amp; data) &#123;        try &#123;            process_data(data);        &#125; catch (const std::invalid_argument&amp; e) &#123;            throw py::value_error(e.what());        &#125; catch (const std::length_error&amp; e) &#123;            throw py::overflow_error(e.what());        &#125; catch (const std::exception&amp; e) &#123;            throw py::runtime_error(e.what());        &#125;    &#125;);&#125;\n4. æ–‡æ¡£ç”Ÿæˆ\nä½¿ç”¨ doxygen é£æ ¼çš„æ³¨é‡Šï¼š\n/** * @brief è®¡ç®—ä¸¤ä¸ªæ•°çš„å’Œ *  * @param a ç¬¬ä¸€ä¸ªæ•´æ•° * @param b ç¬¬äºŒä¸ªæ•´æ•° * @return int ä¸¤æ•°ä¹‹å’Œ *  * @note è¿™æ˜¯ä¸€ä¸ªç®€å•çš„åŠ æ³•å‡½æ•° * @throw std::invalid_argument å¦‚æœè¾“å…¥å‚æ•°æ— æ•ˆ */int add(int a, int b) &#123;    if (a &lt; 0 || b &lt; 0) &#123;        throw std::invalid_argument(&quot;è¾“å…¥å¿…é¡»æ˜¯éè´Ÿæ•°&quot;);    &#125;    return a + b;&#125;\n5. æµ‹è¯•ç­–ç•¥\nPython æµ‹è¯•ç¤ºä¾‹ï¼š\nimport unittestimport exampleclass TestExampleModule(unittest.TestCase):    def test_add(self):        self.assertEqual(example.add(2, 3), 5)        self.assertEqual(example.add(-1, 1), 0)            def test_add_with_defaults(self):        self.assertEqual(example.add(5), 15)  # 5 + 10            def test_divide(self):        self.assertEqual(example.divide(10, 2), 5)                with self.assertRaises(RuntimeError):            example.divide(10, 0)if __name__ == &#x27;__main__&#x27;:    unittest.main()\n6. ç‰ˆæœ¬æ§åˆ¶\nsetup.py ç‰ˆæœ¬ç®¡ç†ï¼š\nsetup(    name=&quot;mypackage&quot;,    version=&quot;1.2.3&quot;,    author=&quot;Your Name&quot;,    author_email=&quot;your.email@example.com&quot;,    description=&quot;A pybind11 example package&quot;,    long_description=open(&quot;README.md&quot;).read(),    long_description_content_type=&quot;text/markdown&quot;,    url=&quot;https://github.com/yourusername/mypackage&quot;,    ext_modules=ext_modules,    classifiers=[        &quot;Programming Language :: C++&quot;,        &quot;Programming Language :: Python :: 3&quot;,        &quot;License :: OSI Approved :: MIT License&quot;,        &quot;Operating System :: OS Independent&quot;,    ],    python_requires=&#x27;&gt;=3.6&#x27;,)\nå¸¸è§é—®é¢˜\n1. ç¼–è¯‘é”™è¯¯\né—®é¢˜ï¼š fatal error: pybind11/pybind11.h: No such file or directory\nè§£å†³æ–¹æ¡ˆï¼š\n# æ£€æŸ¥pybind11æ˜¯å¦æ­£ç¡®å®‰è£…python -m pybind11 --includes# å¦‚æœä½¿ç”¨æºç å®‰è£…ï¼ŒæŒ‡å®šå¤´æ–‡ä»¶è·¯å¾„c++ -I/path/to/pybind11/include ...\n2. é“¾æ¥é”™è¯¯\né—®é¢˜ï¼š æ‰¾ä¸åˆ° Python åº“\nè§£å†³æ–¹æ¡ˆï¼š\n# Linux/macOSc++ ... $(python3-config --ldflags)# Windowscl ... /link /LIBPATH:C:\\Python\\libs python39.lib\n3. ç±»å‹è½¬æ¢é—®é¢˜\né—®é¢˜ï¼š Python å’Œ C++ ä¹‹é—´çš„ç±»å‹ä¸åŒ¹é…\nè§£å†³æ–¹æ¡ˆï¼š\n// ä½¿ç”¨æ˜¾å¼ç±»å‹è½¬æ¢py::object result = some_python_function();int value = result.cast&lt;int&gt;();// æˆ–è€…ä½¿ç”¨å®‰å…¨è½¬æ¢if (py::isinstance&lt;py::int_&gt;(result)) &#123;    int value = result.cast&lt;int&gt;();&#125; else &#123;    throw std::runtime_error(&quot;ç±»å‹ä¸åŒ¹é…&quot;);&#125;\n4. GIL ç®¡ç†\né—®é¢˜ï¼š åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸­çš„æ€§èƒ½é—®é¢˜\nè§£å†³æ–¹æ¡ˆï¼š\n#include &lt;pybind11/pybind11.h&gt;#include &lt;pybind11/functional.h&gt;#include &lt;thread&gt;namespace py = pybind11;void long_running_task() &#123;    // é‡Šæ”¾GIL    py::gil_scoped_release release;        // æ‰§è¡Œé•¿æ—¶é—´ä»»åŠ¡    for (int i = 0; i &lt; 1000000000; i++) &#123;        // ...    &#125;        // GILä¼šåœ¨releaseå¯¹è±¡ææ„æ—¶è‡ªåŠ¨é‡æ–°è·å–&#125;PYBIND11_MODULE(example, m) &#123;    m.def(&quot;long_running_task&quot;, &amp;long_running_task);&#125;\n5. å†…å­˜æ³„æ¼\né—®é¢˜ï¼š Python å¯¹è±¡æ²¡æœ‰è¢«æ­£ç¡®é‡Šæ”¾\nè§£å†³æ–¹æ¡ˆï¼š\n// ä½¿ç”¨æ™ºèƒ½æŒ‡é’ˆ#include &lt;memory&gt;class MyClass &#123;    // ...&#125;;PYBIND11_MODULE(example, m) &#123;    py::class_&lt;MyClass, std::shared_ptr&lt;MyClass&gt;&gt;(m, &quot;MyClass&quot;)        .def(py::init&lt;&gt;())        // ...        ;&#125;\npybind11 ä½¿ç”¨æŒ‡å— - å®˜æ–¹æ–‡æ¡£è¡¥å……å†…å®¹\nç›®å½•\n\n\né«˜çº§ç±»ç‰¹æ€§\n\n\næ„å»ºç³»ç»Ÿè¯¦è§£\n\n\nè¿”å›å€¼ç­–ç•¥\n\n\næ™ºèƒ½æŒ‡é’ˆ\n\n\nç±»å‹è½¬æ¢\n\n\nåµŒå…¥ Python è§£é‡Šå™¨\n\n\nå¤šçº¿ç¨‹ä¸ GIL ç®¡ç†\n\n\nå­è§£é‡Šå™¨\n\n\nè‡ªå®šä¹‰ç±»å‹è½¬æ¢\n\n\nå…¶ä»–é«˜çº§ç‰¹æ€§\n\n\né«˜çº§ç±»ç‰¹æ€§\n1. åŠ¨æ€å±æ€§\né»˜è®¤æƒ…å†µä¸‹ï¼ŒC++ ç±»åœ¨ Python ä¸­ä¸æ”¯æŒåŠ¨æ€æ·»åŠ å±æ€§ã€‚è¦å¯ç”¨æ­¤åŠŸèƒ½ï¼Œéœ€è¦ä½¿ç”¨py::dynamic_attræ ‡ç­¾ï¼š\n#include &lt;pybind11/pybind11.h&gt;namespace py = pybind11;class Pet &#123;public:    Pet(const std::string&amp; name) : name(name) &#123;&#125;        std::string get_name() const &#123; return name; &#125;    void set_name(const std::string&amp; new_name) &#123; name = new_name; &#125;private:    std::string name;&#125;;PYBIND11_MODULE(example, m) &#123;    py::class_&lt;Pet&gt;(m, &quot;Pet&quot;, py::dynamic_attr())        .def(py::init&lt;const std::string&amp;&gt;())        .def(&quot;get_name&quot;, &amp;Pet::get_name)        .def(&quot;set_name&quot;, &amp;Pet::set_name)        .def_readwrite(&quot;name&quot;, &amp;Pet::name);&#125;\nPython ä½¿ç”¨ï¼š\nimport examplep = example.Pet(&quot;å°ç‹—&quot;)p.age = 2  # åŠ¨æ€æ·»åŠ å±æ€§p.color = &quot;æ£•è‰²&quot;  # åŠ¨æ€æ·»åŠ å±æ€§print(p.name)   # è¾“å‡ºï¼šå°ç‹—print(p.age)    # è¾“å‡ºï¼š2print(p.color)  # è¾“å‡ºï¼šæ£•è‰²\n2. ç»§æ‰¿ä¸è‡ªåŠ¨å‘ä¸‹è½¬å‹\nå¯¹äºå¤šæ€ç±»ï¼ˆå«æœ‰è™šå‡½æ•°ï¼‰ï¼Œpybind11 ä¼šè‡ªåŠ¨è¿›è¡Œå‘ä¸‹è½¬å‹ï¼š\n#include &lt;pybind11/pybind11.h&gt;#include &lt;string&gt;namespace py = pybind11;class Animal &#123;public:    virtual ~Animal() = default;    virtual std::string speak() const = 0;&#125;;class Dog : public Animal &#123;public:    std::string speak() const override &#123;        return &quot;æ±ªæ±ªï¼&quot;;    &#125;&#125;;class Cat : public Animal &#123;public:    std::string speak() const override &#123;        return &quot;å–µå–µï¼&quot;;    &#125;&#125;;// è¿”å›åŸºç±»æŒ‡é’ˆAnimal* create_animal(const std::string&amp; type) &#123;    if (type == &quot;dog&quot;) return new Dog();    if (type == &quot;cat&quot;) return new Cat();    throw std::invalid_argument(&quot;æœªçŸ¥åŠ¨ç‰©ç±»å‹&quot;);&#125;PYBIND11_MODULE(example, m) &#123;    py::class_&lt;Animal&gt;(m, &quot;Animal&quot;)        .def(&quot;speak&quot;, &amp;Animal::speak);        py::class_&lt;Dog, Animal&gt;(m, &quot;Dog&quot;)        .def(py::init&lt;&gt;());        py::class_&lt;Cat, Animal&gt;(m, &quot;Cat&quot;)        .def(py::init&lt;&gt;());        m.def(&quot;create_animal&quot;, &amp;create_animal,           py::return_value_policy::take_ownership);&#125;\nPython ä½¿ç”¨ï¼š\nimport exampleanimal = example.create_animal(&quot;dog&quot;)print(type(animal))  # è¾“å‡ºï¼š&lt;class &#x27;example.Dog&#x27;&gt;ï¼ˆè‡ªåŠ¨å‘ä¸‹è½¬å‹ï¼‰print(animal.speak())  # è¾“å‡ºï¼šæ±ªæ±ªï¼\n3. è¿ç®—ç¬¦é‡è½½\nä½¿ç”¨pybind11/operators.hå¤´æ–‡ä»¶æ”¯æŒè¿ç®—ç¬¦é‡è½½ï¼š\n#include &lt;pybind11/pybind11.h&gt;#include &lt;pybind11/operators.h&gt;namespace py = pybind11;class Vector2 &#123;public:    float x, y;        Vector2(float x = 0, float y = 0) : x(x), y(y) &#123;&#125;        Vector2 operator+(const Vector2&amp; other) const &#123;        return Vector2(x + other.x, y + other.y);    &#125;        Vector2 operator*(float scalar) const &#123;        return Vector2(x * scalar, y * scalar);    &#125;        bool operator==(const Vector2&amp; other) const &#123;        return x == other.x &amp;&amp; y == other.y;    &#125;&#125;;PYBIND11_MODULE(example, m) &#123;    py::class_&lt;Vector2&gt;(m, &quot;Vector2&quot;)        .def(py::init&lt;float, float&gt;())        .def_readwrite(&quot;x&quot;, &amp;Vector2::x)        .def_readwrite(&quot;y&quot;, &amp;Vector2::y)                // è¿ç®—ç¬¦é‡è½½        .def(py::self + py::self)          // + è¿ç®—ç¬¦        .def(py::self * float())           // * è¿ç®—ç¬¦ï¼ˆå‘é‡ * æ ‡é‡ï¼‰        .def(float() * py::self)           // * è¿ç®—ç¬¦ï¼ˆæ ‡é‡ * å‘é‡ï¼‰        .def(py::self == py::self);        // == è¿ç®—ç¬¦&#125;\n4. æšä¸¾ç±»å‹ç»‘å®š\nä½¿ç”¨py::native_enumç»‘å®š C++ æšä¸¾åˆ° Python åŸç”Ÿæšä¸¾ï¼š\n#include &lt;pybind11/pybind11.h&gt;#include &lt;pybind11/native_enum.h&gt;namespace py = pybind11;class Pet &#123;public:    enum class Kind &#123;        Dog,        Cat,        Bird    &#125;;        enum Attributes &#123;        None = 0,        Friendly = 1 &lt;&lt; 0,        Playful = 1 &lt;&lt; 1,        Lazy = 1 &lt;&lt; 2    &#125;;        Pet(const std::string&amp; name, Kind kind)         : name(name), kind(kind), attributes(None) &#123;&#125;        std::string name;    Kind kind;    Attributes attributes;&#125;;PYBIND11_MODULE(example, m) &#123;    py::class_&lt;Pet&gt;(m, &quot;Pet&quot;)        .def(py::init&lt;const std::string&amp;, Pet::Kind&gt;())        .def_readwrite(&quot;name&quot;, &amp;Pet::name)        .def_readwrite(&quot;kind&quot;, &amp;Pet::kind)        .def_readwrite(&quot;attributes&quot;, &amp;Pet::attributes);        // ç»‘å®šæšä¸¾    py::native_enum&lt;Pet::Kind&gt;(m, &quot;Kind&quot;)        .value(&quot;Dog&quot;, Pet::Kind::Dog)        .value(&quot;Cat&quot;, Pet::Kind::Cat)        .value(&quot;Bird&quot;, Pet::Kind::Bird)        .export_values()        .finalize();        py::native_enum&lt;Pet::Attributes&gt;(m, &quot;Attributes&quot;)        .value(&quot;None&quot;, Pet::Attributes::None)        .value(&quot;Friendly&quot;, Pet::Attributes::Friendly)        .value(&quot;Playful&quot;, Pet::Attributes::Playful)        .value(&quot;Lazy&quot;, Pet::Attributes::Lazy)        .export_values()        .finalize();&#125;\næ„å»ºç³»ç»Ÿè¯¦è§£\n1. CMake æ„å»º\nåŸºç¡€ CMakeLists.txtï¼š\ncmake_minimum_required(VERSION 3.15...3.27)project(example LANGUAGES CXX)# æŸ¥æ‰¾pybind11find_package(pybind11 CONFIG REQUIRED)# åˆ›å»ºPythonæ‰©å±•æ¨¡å—pybind11_add_module(example example.cpp)# å®‰è£…åˆ°å½“å‰ç›®å½•install(TARGETS example DESTINATION .)\né«˜çº§ CMake é…ç½®ï¼š\ncmake_minimum_required(VERSION 3.15...3.27)project(example LANGUAGES CXX)# è®¾ç½®C++æ ‡å‡†set(CMAKE_CXX_STANDARD 17)set(CMAKE_CXX_STANDARD_REQUIRED ON)set(CMAKE_CXX_EXTENSIONS OFF)# æŸ¥æ‰¾Pythonfind_package(Python COMPONENTS Interpreter Development REQUIRED)# æŸ¥æ‰¾pybind11find_package(pybind11 CONFIG REQUIRED)# åˆ›å»ºæ‰©å±•æ¨¡å—pybind11_add_module(example     src/bindings.cpp    src/algorithm.cpp    src/data_structures.cpp)# è®¾ç½®ç¼–è¯‘é€‰é¡¹target_compile_options(example PRIVATE    -O3    -Wall    -Wextra    -Wpedantic)# è®¾ç½®é“¾æ¥é€‰é¡¹target_link_libraries(example PRIVATE    pybind11::module    my_custom_library)# è®¾ç½®å®‰è£…è·¯å¾„install(TARGETS example     DESTINATION $&#123;CMAKE_CURRENT_SOURCE_DIR&#125;)\n2. pyproject.toml æ„å»º\nä½¿ç”¨ scikit-build-coreï¼š\n[build-system]requires = [&quot;scikit-build-core&gt;=0.5&quot;, &quot;pybind11&gt;=2.11&quot;]build-backend = &quot;scikit_build_core.build&quot;[project]name = &quot;example&quot;version = &quot;0.1.0&quot;authors = [    &#123; name = &quot;Your Name&quot;, email = &quot;your.email@example.com&quot; &#125;]description = &quot;pybind11ç¤ºä¾‹é¡¹ç›®&quot;long_description = file: &quot;README.md&quot;long_description_content_type = &quot;text/markdown&quot;requires-python = &quot;&gt;=3.8&quot;\nä½¿ç”¨ meson-pythonï¼š\n[build-system]requires = [&quot;meson-python&gt;=0.12&quot;, &quot;pybind11&gt;=2.11&quot;]build-backend = &quot;mesonpy&quot;[project]name = &quot;example&quot;version = &quot;0.1.0&quot;\n3. setuptools æ„å»ºé«˜çº§é…ç½®\nfrom setuptools import setup, Extensionfrom pybind11.setup_helpers import Pybind11Extension, build_extfrom pybind11 import get_cmake_dirimport glob# å¹¶è¡Œç¼–è¯‘def parallel_compile_test_parallel_compile(self, sources, output_dir=None, macros=None,                                          include_dirs=None, debug=0, extra_preargs=None,                                          extra_postargs=None, depends=None):    import multiprocessing    from setuptools._distutils.ccompiler import CCompiler    from setuptools._distutils import log    # å¤åˆ¶åŸå§‹å®ç°    original_compile = CCompiler._compile    def _compile_single(source):        return original_compile(self, source, output_dir, macros, include_dirs,                               debug, extra_preargs, extra_postargs, depends)    # ä½¿ç”¨å¤šè¿›ç¨‹ç¼–è¯‘    if not sources:        return    num_jobs = multiprocessing.cpu_count()    log.info(f&quot;Using &#123;num_jobs&#125; parallel jobs for compilation&quot;)        import multiprocessing.pool    pool = multiprocessing.pool.ThreadPool(num_jobs)    try:        pool.map(_compile_single, sources)    finally:        pool.close()        pool.join()# åº”ç”¨å¹¶è¡Œç¼–è¯‘è¡¥ä¸import setuptools._distutils.ccompilersetuptools._distutils.ccompiler.CCompiler._compile = parallel_compile_test_parallel_compile# æ‰©å±•æ¨¡å—ext_modules = [    Pybind11Extension(        &quot;example.core&quot;,        sorted(glob.glob(&quot;src/core/*.cpp&quot;)),        include_dirs=[&quot;src/include&quot;],        libraries=[&quot;my_custom_lib&quot;],        library_dirs=[&quot;lib&quot;],        extra_compile_args=[&quot;-O3&quot;, &quot;-std=c++17&quot;, &quot;-Wall&quot;],        extra_link_args=[&quot;-Wl,-rpath,$ORIGIN/lib&quot;],    ),    Pybind11Extension(        &quot;example.utils&quot;,        sorted(glob.glob(&quot;src/utils/*.cpp&quot;)),        include_dirs=[&quot;src/include&quot;],        extra_compile_args=[&quot;-O3&quot;, &quot;-std=c++17&quot;],    ),]setup(    name=&quot;example&quot;,    version=&quot;1.0.0&quot;,    author=&quot;Your Name&quot;,    author_email=&quot;your.email@example.com&quot;,    description=&quot;pybind11ç¤ºä¾‹é¡¹ç›®&quot;,    long_description=open(&quot;README.md&quot;).read(),    long_description_content_type=&quot;text/markdown&quot;,    url=&quot;https://github.com/yourusername/example&quot;,    ext_modules=ext_modules,    cmdclass=&#123;&quot;build_ext&quot;: build_ext&#125;,    zip_safe=False,    packages=[&quot;example&quot;],    package_dir=&#123;&quot;example&quot;: &quot;python/example&quot;&#125;,    package_data=&#123;&quot;example&quot;: [&quot;py.typed&quot;]&#125;,    classifiers=[        &quot;Programming Language :: C++&quot;,        &quot;Programming Language :: Python :: 3&quot;,        &quot;License :: OSI Approved :: MIT License&quot;,        &quot;Operating System :: OS Independent&quot;,    ],    python_requires=&quot;&gt;=3.8&quot;,    install_requires=[&quot;numpy&gt;=1.21&quot;],    extras_require=&#123;        &quot;dev&quot;: [            &quot;pytest&gt;=6.0&quot;,            &quot;pytest-cov&gt;=2.0&quot;,            &quot;black&gt;=21.0&quot;,            &quot;flake8&gt;=3.9&quot;,        ]    &#125;,)\nè¿”å›å€¼ç­–ç•¥\n1. ç­–ç•¥æ¦‚è¿°\n\n\n\nç­–ç•¥\næè¿°\n\n\n\n\nreturn_value_policy::take_ownership\næ¥ç®¡ç°æœ‰å¯¹è±¡çš„æ‰€æœ‰æƒï¼ŒPython ä¼šåœ¨å¼•ç”¨è®¡æ•°ä¸ºé›¶æ—¶åˆ é™¤å¯¹è±¡\n\n\nreturn_value_policy::copy\nåˆ›å»ºè¿”å›å¯¹è±¡çš„å‰¯æœ¬ï¼Œç”± Python æ‹¥æœ‰\n\n\nreturn_value_policy::move\nä½¿ç”¨ std::move è½¬ç§»å†…å®¹åˆ°æ–°å®ä¾‹\n\n\nreturn_value_policy::reference\nå¼•ç”¨ç°æœ‰å¯¹è±¡ä½†ä¸æ¥ç®¡æ‰€æœ‰æƒ\n\n\nreturn_value_policy::reference_internal\nå¼•ç”¨å†…éƒ¨å¯¹è±¡ï¼Œç¡®ä¿çˆ¶å¯¹è±¡å­˜æ´»\n\n\nreturn_value_policy::automatic\nè‡ªåŠ¨é€‰æ‹©ç­–ç•¥ï¼ˆé»˜è®¤ï¼‰\n\n\nreturn_value_policy::automatic_reference\nç±»ä¼¼ automaticï¼Œä½†å¯¹æŒ‡é’ˆä½¿ç”¨ reference ç­–ç•¥\n\n\n\n2. ä½¿ç”¨ç¤ºä¾‹\n#include &lt;pybind11/pybind11.h&gt;#include &lt;memory&gt;namespace py = pybind11;class MyClass &#123;public:    MyClass(int value) : value(value) &#123;&#125;    int get_value() const &#123; return value; &#125;    private:    int value;&#125;;// é™æ€å¯¹è±¡ - ä½¿ç”¨referenceç­–ç•¥MyClass static_instance(42);MyClass&amp; get_static_instance() &#123;    return static_instance;&#125;// åŠ¨æ€åˆ†é… - ä½¿ç”¨take_ownershipç­–ç•¥MyClass* create_instance(int value) &#123;    return new MyClass(value);&#125;// å†…éƒ¨å¯¹è±¡ - ä½¿ç”¨reference_internalç­–ç•¥class Container &#123;public:    Container() : internal(100) &#123;&#125;    MyClass&amp; get_internal() &#123; return internal; &#125;    private:    MyClass internal;&#125;;PYBIND11_MODULE(example, m) &#123;    py::class_&lt;MyClass&gt;(m, &quot;MyClass&quot;)        .def(py::init&lt;int&gt;())        .def(&quot;get_value&quot;, &amp;MyClass::get_value);        py::class_&lt;Container&gt;(m, &quot;Container&quot;)        .def(py::init&lt;&gt;())        .def(&quot;get_internal&quot;, &amp;Container::get_internal,              py::return_value_policy::reference_internal);        // é™æ€å¯¹è±¡ - ä½¿ç”¨referenceç­–ç•¥    m.def(&quot;get_static_instance&quot;, &amp;get_static_instance,           py::return_value_policy::reference);        // åŠ¨æ€å¯¹è±¡ - ä½¿ç”¨take_ownershipç­–ç•¥    m.def(&quot;create_instance&quot;, &amp;create_instance,           py::return_value_policy::take_ownership);        // æ™ºèƒ½æŒ‡é’ˆ - è‡ªåŠ¨å¤„ç†    m.def(&quot;create_shared&quot;, []() &#123;        return std::make_shared&lt;MyClass&gt;(200);    &#125;);&#125;\n3. å¸¸è§é”™è¯¯åŠè§£å†³æ–¹æ¡ˆ\né”™è¯¯ç¤ºä¾‹ï¼š\n// å±é™©ï¼é™æ€å¯¹è±¡ä½¿ç”¨é»˜è®¤ç­–ç•¥ä¼šå¯¼è‡´double freem.def(&quot;get_static&quot;, &amp;get_static_instance);  // é”™è¯¯\næ­£ç¡®åšæ³•ï¼š\n// æ­£ç¡®ï¼šä½¿ç”¨referenceç­–ç•¥m.def(&quot;get_static&quot;, &amp;get_static_instance, py::return_value_policy::reference);\næ™ºèƒ½æŒ‡é’ˆ\n1. py::smart_holderï¼ˆæ¨èï¼‰\npybind11 v3 å¼•å…¥çš„æ™ºèƒ½æŒæœ‰è€…ï¼Œæ”¯æŒåŒå‘è½¬æ¢ï¼š\n#include &lt;pybind11/pybind11.h&gt;#include &lt;memory&gt;namespace py = pybind11;class MyClass &#123;public:    MyClass(int value) : value(value) &#123;&#125;    int get_value() const &#123; return value; &#125;    private:    int value;&#125;;PYBIND11_MODULE(example, m) &#123;    // ä½¿ç”¨py::smart_holder    py::class_&lt;MyClass, py::smart_holder&gt;(m, &quot;MyClass&quot;)        .def(py::init&lt;int&gt;())        .def(&quot;get_value&quot;, &amp;MyClass::get_value);        // æ”¯æŒunique_ptrå’Œshared_ptråŒå‘è½¬æ¢    m.def(&quot;create_unique&quot;, []() &#123;        return std::make_unique&lt;MyClass&gt;(10);    &#125;);        m.def(&quot;create_shared&quot;, []() &#123;        return std::make_shared&lt;MyClass&gt;(20);    &#125;);        m.def(&quot;process_unique&quot;, [](std::unique_ptr&lt;MyClass&gt; ptr) &#123;        return ptr-&gt;get_value() * 2;    &#125;);        m.def(&quot;process_shared&quot;, [](std::shared_ptr&lt;MyClass&gt; ptr) &#123;        return ptr-&gt;get_value() * 3;    &#125;);&#125;\nPython ä½¿ç”¨ï¼š\nimport example# ä»Pythonä¼ é€’åˆ°C++obj = example.MyClass(5)print(example.process_unique(obj))  # è¾“å‡ºï¼š10ï¼ˆobjä¸å†æœ‰æ•ˆï¼‰obj2 = example.MyClass(6)print(example.process_shared(obj2))  # è¾“å‡ºï¼š18ï¼ˆobj2ä»ç„¶æœ‰æ•ˆï¼‰# ä»C++è¿”å›unique_obj = example.create_unique()shared_obj = example.create_shared()\n2. std::unique_ptr\n#include &lt;pybind11/pybind11.h&gt;#include &lt;memory&gt;namespace py = pybind11;class MyClass &#123;public:    MyClass(int value) : value(value) &#123;&#125;    int get_value() const &#123; return value; &#125;    private:    int value;&#125;;PYBIND11_MODULE(example, m) &#123;    py::class_&lt;MyClass&gt;(m, &quot;MyClass&quot;)        .def(py::init&lt;int&gt;())        .def(&quot;get_value&quot;, &amp;MyClass::get_value);        // è¿”å›unique_ptr    m.def(&quot;create&quot;, []() &#123;        return std::make_unique&lt;MyClass&gt;(10);    &#125;);        // æ¥å—unique_ptrï¼ˆä¼šè½¬ç§»æ‰€æœ‰æƒï¼‰    m.def(&quot;take_ownership&quot;, [](std::unique_ptr&lt;MyClass&gt; ptr) &#123;        return ptr-&gt;get_value();    &#125;);&#125;\n3. std::shared_ptr\n#include &lt;pybind11/pybind11.h&gt;#include &lt;memory&gt;namespace py = pybind11;class MyClass &#123;public:    MyClass(int value) : value(value) &#123;&#125;    int get_value() const &#123; return value; &#125;    private:    int value;&#125;;PYBIND11_MODULE(example, m) &#123;    // ä½¿ç”¨shared_pträ½œä¸ºæŒæœ‰è€…    py::class_&lt;MyClass, std::shared_ptr&lt;MyClass&gt;&gt;(m, &quot;MyClass&quot;)        .def(py::init&lt;int&gt;())        .def(&quot;get_value&quot;, &amp;MyClass::get_value);        m.def(&quot;create&quot;, []() &#123;        return std::make_shared&lt;MyClass&gt;(10);    &#125;);        m.def(&quot;share&quot;, [](std::shared_ptr&lt;MyClass&gt; ptr) &#123;        return ptr;  // å…±äº«æ‰€æœ‰æƒ    &#125;);&#125;\n4. è‡ªå®šä¹‰æ™ºèƒ½æŒ‡é’ˆ\n#include &lt;pybind11/pybind11.h&gt;#include &lt;memory&gt;namespace py = pybind11;// è‡ªå®šä¹‰æ™ºèƒ½æŒ‡é’ˆtemplate &lt;typename T&gt;class MySmartPtr &#123;public:    MySmartPtr(T* ptr) : ptr(ptr) &#123;&#125;    ~MySmartPtr() &#123; delete ptr; &#125;        T* get() const &#123; return ptr; &#125;    T&amp; operator*() const &#123; return *ptr; &#125;    T* operator-&gt;() const &#123; return ptr; &#125;    private:    T* ptr;&#125;;class MyClass &#123;public:    MyClass(int value) : value(value) &#123;&#125;    int get_value() const &#123; return value; &#125;    private:    int value;&#125;;// å£°æ˜è‡ªå®šä¹‰æŒæœ‰è€…ç±»å‹PYBIND11_DECLARE_HOLDER_TYPE(T, MySmartPtr&lt;T&gt;)// ç‰¹åŒ–holder_helperï¼ˆå¦‚æœéœ€è¦ï¼‰namespace pybind11 &#123; namespace detail &#123;    template &lt;typename T&gt;    struct holder_helper&lt;MySmartPtr&lt;T&gt;&gt; &#123;        static const T* get(const MySmartPtr&lt;T&gt;&amp; p) &#123; return p.get(); &#125;    &#125;;&#125;&#125;PYBIND11_MODULE(example, m) &#123;    py::class_&lt;MyClass, MySmartPtr&lt;MyClass&gt;&gt;(m, &quot;MyClass&quot;)        .def(py::init&lt;int&gt;())        .def(&quot;get_value&quot;, &amp;MyClass::get_value);        m.def(&quot;create&quot;, []() &#123;        return MySmartPtr&lt;MyClass&gt;(new MyClass(10));    &#125;);&#125;\nç±»å‹è½¬æ¢\n1. åŸºç¡€ç±»å‹è½¬æ¢\npybind11 æ”¯æŒä»¥ä¸‹åŸºç¡€ç±»å‹çš„è‡ªåŠ¨è½¬æ¢ï¼š\n\n\n\nC++ ç±»å‹\nPython ç±»å‹\n\n\n\n\nbool\nbool\n\n\nchar\nstr (é•¿åº¦ 1)\n\n\nsigned char\nint\n\n\nunsigned char\nint\n\n\nshort\nint\n\n\nunsigned short\nint\n\n\nint\nint\n\n\nunsigned int\nint\n\n\nlong\nint\n\n\nunsigned long\nint\n\n\nlong long\nint\n\n\nunsigned long long\nint\n\n\nfloat\nfloat\n\n\ndouble\nfloat\n\n\nlong double\nfloat\n\n\nconst char*\nstr\n\n\nstd::string\nstr\n\n\nstd::wstring\nstr (UTF-8)\n\n\n\n2. STL å®¹å™¨è½¬æ¢\néœ€è¦åŒ…å«pybind11/stl.hå¤´æ–‡ä»¶ï¼š\n#include &lt;pybind11/pybind11.h&gt;#include &lt;pybind11/stl.h&gt;#include &lt;vector&gt;#include &lt;list&gt;#include &lt;map&gt;#include &lt;set&gt;#include &lt;unordered_map&gt;#include &lt;unordered_set&gt;namespace py = pybind11;// å‘é‡è½¬æ¢std::vector&lt;int&gt; double_vector(const std::vector&lt;int&gt;&amp; v) &#123;    std::vector&lt;int&gt; result;    for (int x : v) &#123;        result.push_back(x * 2);    &#125;    return result;&#125;// æ˜ å°„è½¬æ¢std::map&lt;std::string, int&gt; count_words(const std::vector&lt;std::string&gt;&amp; words) &#123;    std::map&lt;std::string, int&gt; counts;    for (const auto&amp; word : words) &#123;        counts[word]++;    &#125;    return counts;&#125;// é›†åˆè½¬æ¢std::set&lt;int&gt; unique_elements(const std::vector&lt;int&gt;&amp; v) &#123;    return std::set&lt;int&gt;(v.begin(), v.end());&#125;PYBIND11_MODULE(example, m) &#123;    m.def(&quot;double_vector&quot;, &amp;double_vector);    m.def(&quot;count_words&quot;, &amp;count_words);    m.def(&quot;unique_elements&quot;, &amp;unique_elements);&#125;\nPython ä½¿ç”¨ï¼š\nimport example# å‘é‡è½¬æ¢print(example.double_vector([1, 2, 3, 4]))  # è¾“å‡ºï¼š[2, 4, 6, 8]# æ˜ å°„è½¬æ¢words = [&quot;apple&quot;, &quot;banana&quot;, &quot;apple&quot;, &quot;orange&quot;]print(example.count_words(words))  # è¾“å‡ºï¼š&#123;&#x27;apple&#x27;: 2, &#x27;banana&#x27;: 1, &#x27;orange&#x27;: 1&#125;# é›†åˆè½¬æ¢print(example.unique_elements([1, 2, 2, 3, 3, 3]))  # è¾“å‡ºï¼š&#123;1, 2, 3&#125;\n3. å­—ç¬¦ä¸²å’Œå­—èŠ‚è½¬æ¢\n#include &lt;pybind11/pybind11.h&gt;#include &lt;string&gt;#include &lt;vector&gt;namespace py = pybind11;// å­—ç¬¦ä¸²å¤„ç†std::string reverse_string(const std::string&amp; s) &#123;    return std::string(s.rbegin(), s.rend());&#125;// å­—èŠ‚å¤„ç†std::vector&lt;uint8_t&gt; process_bytes(const std::vector&lt;uint8_t&gt;&amp; data) &#123;    std::vector&lt;uint8_t&gt; result;    for (uint8_t byte : data) &#123;        result.push_back(byte ^ 0xAA);  // ç®€å•çš„XORåŠ å¯†    &#125;    return result;&#125;PYBIND11_MODULE(example, m) &#123;    m.def(&quot;reverse_string&quot;, &amp;reverse_string);    m.def(&quot;process_bytes&quot;, &amp;process_bytes);&#125;\n4. æ—¶é—´ç±»å‹è½¬æ¢\néœ€è¦åŒ…å«pybind11/chrono.hå¤´æ–‡ä»¶ï¼š\n#include &lt;pybind11/pybind11.h&gt;#include &lt;pybind11/chrono.h&gt;#include &lt;chrono&gt;#include &lt;ctime&gt;namespace py = pybind11;using namespace std::chrono;// æ—¶é—´ç‚¹è½¬æ¢system_clock::time_point add_seconds(system_clock::time_point tp, int seconds) &#123;    return tp + seconds(seconds);&#125;// æ—¶é—´æ®µè½¬æ¢seconds time_difference(system_clock::time_point start, system_clock::time_point end) &#123;    return duration_cast&lt;seconds&gt;(end - start);&#125;PYBIND11_MODULE(example, m) &#123;    m.def(&quot;add_seconds&quot;, &amp;add_seconds);    m.def(&quot;time_difference&quot;, &amp;time_difference);&#125;\nPython ä½¿ç”¨ï¼š\nimport exampleimport datetime# æ—¶é—´ç‚¹è½¬æ¢now = datetime.datetime.now()later = example.add_seconds(now, 3600)  # åŠ 1å°æ—¶print(later)# æ—¶é—´æ®µè½¬æ¢start = datetime.datetime(2023, 1, 1)end = datetime.datetime(2023, 1, 2)diff = example.time_difference(start, end)print(diff.total_seconds())  # è¾“å‡ºï¼š86400.0\nåµŒå…¥ Python è§£é‡Šå™¨\n1. åŸºç¡€åµŒå…¥\nCMake é…ç½®ï¼š\ncmake_minimum_required(VERSION 3.15...3.27)project(embedded_example LANGUAGES CXX)find_package(pybind11 CONFIG REQUIRED)add_executable(embedded_example main.cpp)target_link_libraries(embedded_example PRIVATE pybind11::embed)\nC++ ä»£ç ï¼š\n#include &lt;pybind11/embed.h&gt;#include &lt;iostream&gt;namespace py = pybind11;int main() &#123;    // å¯åŠ¨Pythonè§£é‡Šå™¨    py::scoped_interpreter guard&#123;&#125;;        try &#123;        // æ‰§è¡ŒPythonä»£ç         py::print(&quot;Hello from embedded Python!&quot;);                // ä½¿ç”¨Pythonæ ‡å‡†åº“        py::module math = py::module::import(&quot;math&quot;);        double result = math.attr(&quot;sqrt&quot;)(25.0).cast&lt;double&gt;();        std::cout &lt;&lt; &quot;sqrt(25) = &quot; &lt;&lt; result &lt;&lt; std::endl;                // æ‰§è¡Œå¤šè¡ŒPythonä»£ç         py::exec(R&quot;(            import sys            print(f&quot;Python version: &#123;sys.version&#125;&quot;)                        def add(a, b):                return a + b                        result = add(3, 4)            print(f&quot;3 + 4 = &#123;result&#125;&quot;)        )&quot;);                // è°ƒç”¨Pythonå‡½æ•°        auto add = py::eval(&quot;add&quot;).cast&lt;py::function&gt;();        int sum_result = add(5, 6).cast&lt;int&gt;();        std::cout &lt;&lt; &quot;5 + 6 = &quot; &lt;&lt; sum_result &lt;&lt; std::endl;            &#125; catch (const py::error_already_set&amp; e) &#123;        std::cerr &lt;&lt; &quot;Python error: &quot; &lt;&lt; e.what() &lt;&lt; std::endl;        return 1;    &#125;        // è§£é‡Šå™¨ä¼šåœ¨guardææ„æ—¶è‡ªåŠ¨å…³é—­    return 0;&#125;\n2. åµŒå…¥æ¨¡å—\n#include &lt;pybind11/embed.h&gt;#include &lt;pybind11/pybind11.h&gt;namespace py = pybind11;// åµŒå…¥çš„C++æ¨¡å—PYBIND11_EMBEDDED_MODULE(embedded_module, m) &#123;    m.def(&quot;multiply&quot;, [](int a, int b) &#123;        return a * b;    &#125;);        m.def(&quot;greet&quot;, [](const std::string&amp; name) &#123;        return &quot;Hello, &quot; + name + &quot;!&quot;;    &#125;);&#125;int main() &#123;    py::scoped_interpreter guard&#123;&#125;;        try &#123;        // å¯¼å…¥åµŒå…¥çš„æ¨¡å—        py::module em = py::module::import(&quot;embedded_module&quot;);                // è°ƒç”¨åµŒå…¥æ¨¡å—çš„å‡½æ•°        int product = em.attr(&quot;multiply&quot;)(3, 4).cast&lt;int&gt;();        std::cout &lt;&lt; &quot;3 * 4 = &quot; &lt;&lt; product &lt;&lt; std::endl;                std::string greeting = em.attr(&quot;greet&quot;)(&quot;World&quot;).cast&lt;std::string&gt;();        std::cout &lt;&lt; greeting &lt;&lt; std::endl;                // åœ¨Pythonä¸­ä½¿ç”¨åµŒå…¥æ¨¡å—        py::exec(R&quot;(            result = embedded_module.multiply(5, 6)            print(f&quot;5 * 6 = &#123;result&#125;&quot;)                        message = embedded_module.greet(&quot;Python&quot;)            print(message)        )&quot;);            &#125; catch (const py::error_already_set&amp; e) &#123;        std::cerr &lt;&lt; &quot;Error: &quot; &lt;&lt; e.what() &lt;&lt; std::endl;        return 1;    &#125;        return 0;&#125;\n3. å¯¼å…¥æœ¬åœ° Python æ–‡ä»¶\n#include &lt;pybind11/embed.h&gt;#include &lt;iostream&gt;#include &lt;filesystem&gt;namespace py = pybind11;namespace fs = std::filesystem;int main() &#123;    py::scoped_interpreter guard&#123;&#125;;        try &#123;        // æ·»åŠ å½“å‰ç›®å½•åˆ°Pythonè·¯å¾„        py::module sys = py::module::import(&quot;sys&quot;);        sys.attr(&quot;path&quot;).cast&lt;py::list&gt;().append(fs::current_path().string());                // å¯¼å…¥æœ¬åœ°Pythonæ¨¡å—        py::module my_module = py::module::import(&quot;my_python_module&quot;);                // è°ƒç”¨Pythonå‡½æ•°        int result = my_module.attr(&quot;my_function&quot;)(10, 20).cast&lt;int&gt;();        std::cout &lt;&lt; &quot;Result from Python: &quot; &lt;&lt; result &lt;&lt; std::endl;            &#125; catch (const py::error_already_set&amp; e) &#123;        std::cerr &lt;&lt; &quot;Error: &quot; &lt;&lt; e.what() &lt;&lt; std::endl;        return 1;    &#125;        return 0;&#125;\nå¤šçº¿ç¨‹ä¸ GIL ç®¡ç†\n1. GIL é‡Šæ”¾ä¸è·å–\n#include &lt;pybind11/pybind11.h&gt;#include &lt;pybind11/functional.h&gt;#include &lt;thread&gt;#include &lt;chrono&gt;#include &lt;iostream&gt;namespace py = pybind11;// é•¿æ—¶é—´è¿è¡Œçš„C++å‡½æ•° - åº”è¯¥é‡Šæ”¾GILvoid long_running_task() &#123;    // é‡Šæ”¾GIL    py::gil_scoped_release release;        std::cout &lt;&lt; &quot;Long running task started (thread: &quot;               &lt;&lt; std::this_thread::get_id() &lt;&lt; &quot;)&quot; &lt;&lt; std::endl;        // æ¨¡æ‹Ÿé•¿æ—¶é—´è®¡ç®—    for (int i = 0; i &lt; 5; ++i) &#123;        std::this_thread::sleep_for(std::chrono::seconds(1));        std::cout &lt;&lt; &quot;Task progress: &quot; &lt;&lt; (i + 1) &lt;&lt; &quot;/5&quot; &lt;&lt; std::endl;    &#125;        std::cout &lt;&lt; &quot;Long running task completed&quot; &lt;&lt; std::endl;        // GILä¼šåœ¨releaseææ„æ—¶è‡ªåŠ¨é‡æ–°è·å–&#125;// ä½¿ç”¨call_guardè‡ªåŠ¨ç®¡ç†GILvoid task_with_guard() &#123;    std::cout &lt;&lt; &quot;Task with guard started&quot; &lt;&lt; std::endl;    std::this_thread::sleep_for(std::chrono::seconds(3));    std::cout &lt;&lt; &quot;Task with guard completed&quot; &lt;&lt; std::endl;&#125;// å¤šçº¿ç¨‹å‡½æ•°void run_in_threads() &#123;    std::thread t1(long_running_task);    std::thread t2(long_running_task);        t1.join();    t2.join();&#125;PYBIND11_MODULE(example, m) &#123;    // ç›´æ¥é‡Šæ”¾GIL    m.def(&quot;long_running_task&quot;, &amp;long_running_task);        // ä½¿ç”¨call_guardé‡Šæ”¾GIL    m.def(&quot;task_with_guard&quot;, &amp;task_with_guard,           py::call_guard&lt;py::gil_scoped_release&gt;());        // å¤šçº¿ç¨‹ç¤ºä¾‹    m.def(&quot;run_in_threads&quot;, &amp;run_in_threads);        // çº¿ç¨‹å®‰å…¨çš„å‡½æ•°è°ƒç”¨    m.def(&quot;thread_safe_function&quot;, [](int value) &#123;        // åœ¨å…³é”®éƒ¨åˆ†è·å–GIL        py::gil_scoped_acquire acquire;        py::print(&quot;Thread-safe function called with value:&quot;, value);    &#125;);&#125;\nPython ä½¿ç”¨ï¼š\nimport exampleimport threadingimport time# æµ‹è¯•é•¿æ—¶é—´ä»»åŠ¡print(&quot;Testing long running task...&quot;)thread1 = threading.Thread(target=example.long_running_task)thread2 = threading.Thread(target=example.long_running_task)thread1.start()thread2.start()# ä¸»çº¿ç¨‹å¯ä»¥ç»§ç»­æ‰§è¡Œå…¶ä»–ä»»åŠ¡for i in range(3):    print(f&quot;Main thread working... &#123;i&#125;&quot;)    time.sleep(1)thread1.join()thread2.join()# æµ‹è¯•å¸¦guardçš„ä»»åŠ¡print(&quot;Testing task with guard...&quot;)example.task_with_guard()# æµ‹è¯•å¤šçº¿ç¨‹å‡½æ•°print(&quot;Testing run in threads...&quot;)example.run_in_threads()\n2. çº¿ç¨‹å±€éƒ¨å­˜å‚¨\n#include &lt;pybind11/pybind11.h&gt;#include &lt;thread&gt;#include &lt;mutex&gt;#include &lt;iostream&gt;namespace py = pybind11;// çº¿ç¨‹å±€éƒ¨å­˜å‚¨thread_local int thread_counter = 0;std::mutex cout_mutex;void thread_function(int id) &#123;    // é‡Šæ”¾GIL    py::gil_scoped_release release;        for (int i = 0; i &lt; 5; ++i) &#123;        thread_counter++;                // å®‰å…¨çš„è¾“å‡º        std::lock_guard&lt;std::mutex&gt; lock(cout_mutex);        std::cout &lt;&lt; &quot;Thread &quot; &lt;&lt; id &lt;&lt; &quot;: counter = &quot; &lt;&lt; thread_counter &lt;&lt; std::endl;                std::this_thread::sleep_for(std::chrono::milliseconds(100));    &#125;&#125;void start_threads() &#123;    std::thread t1(thread_function, 1);    std::thread t2(thread_function, 2);        t1.join();    t2.join();&#125;PYBIND11_MODULE(example, m) &#123;    m.def(&quot;start_threads&quot;, &amp;start_threads);&#125;\n3. å¼‚æ­¥ä»»åŠ¡\n#include &lt;pybind11/pybind11.h&gt;#include &lt;pybind11/functional.h&gt;#include &lt;thread&gt;#include &lt;future&gt;#include &lt;iostream&gt;namespace py = pybind11;// å¼‚æ­¥æ‰§è¡Œå‡½æ•°std::future&lt;int&gt; async_task(int x, int y) &#123;    return std::async(std::launch::async, [x, y]() &#123;        // é‡Šæ”¾GIL        py::gil_scoped_release release;                std::cout &lt;&lt; &quot;Async task started (thread: &quot;                   &lt;&lt; std::this_thread::get_id() &lt;&lt; &quot;)&quot; &lt;&lt; std::endl;                // æ¨¡æ‹Ÿè®¡ç®—        std::this_thread::sleep_for(std::chrono::seconds(2));        return x + y;    &#125;);&#125;// å¼‚æ­¥å›è°ƒvoid async_callback(py::function callback, int x, int y) &#123;    std::thread([callback, x, y]() &#123;        // é‡Šæ”¾GIL        py::gil_scoped_release release;                std::cout &lt;&lt; &quot;Callback task started&quot; &lt;&lt; std::endl;        std::this_thread::sleep_for(std::chrono::seconds(2));                // è®¡ç®—ç»“æœ        int result = x * y;                // è°ƒç”¨å›è°ƒå‡½æ•°æ—¶é‡æ–°è·å–GIL        py::gil_scoped_acquire acquire;        callback(result);    &#125;).detach();&#125;PYBIND11_MODULE(example, m) &#123;    m.def(&quot;async_task&quot;, [](int x, int y) &#123;        auto future = async_task(x, y);        return future.get();    &#125;);        m.def(&quot;async_callback&quot;, &amp;async_callback);&#125;\nPython ä½¿ç”¨ï¼š\nimport exampleimport time# æµ‹è¯•å¼‚æ­¥ä»»åŠ¡print(&quot;Testing async task...&quot;)result = example.async_task(3, 4)print(f&quot;Async result: &#123;result&#125;&quot;)# æµ‹è¯•å¼‚æ­¥å›è°ƒdef on_complete(result):    print(f&quot;Callback received: &#123;result&#125;&quot;)print(&quot;Testing async callback...&quot;)example.async_callback(on_complete, 5, 6)print(&quot;Callback task started (will complete in 2 seconds)&quot;)# ç­‰å¾…å›è°ƒå®Œæˆtime.sleep(3)\nå­è§£é‡Šå™¨\n1. åŸºç¡€å­è§£é‡Šå™¨ä½¿ç”¨\n#include &lt;pybind11/embed.h&gt;#include &lt;pybind11/subinterpreter.h&gt;#include &lt;iostream&gt;namespace py = pybind11;int main() &#123;    // åˆå§‹åŒ–ä¸»è§£é‡Šå™¨    py::scoped_interpreter main_guard&#123;&#125;;        try &#123;        std::cout &lt;&lt; &quot;Main interpreter started&quot; &lt;&lt; std::endl;                // åˆ›å»ºå­è§£é‡Šå™¨        py::subinterpreter sub = py::subinterpreter::create();                &#123;            // æ¿€æ´»å­è§£é‡Šå™¨            py::subinterpreter_scoped_activate activate(sub);                        std::cout &lt;&lt; &quot;Sub-interpreter activated&quot; &lt;&lt; std::endl;                        // åœ¨å­è§£é‡Šå™¨ä¸­æ‰§è¡Œä»£ç             py::exec(R&quot;(                import sys                print(f&quot;Sub-interpreter Python version: &#123;sys.version&#125;&quot;)                counter = 42            )&quot;);                        // è·å–å˜é‡å€¼            int counter = py::eval(&quot;counter&quot;).cast&lt;int&gt;();            std::cout &lt;&lt; &quot;Sub-interpreter counter: &quot; &lt;&lt; counter &lt;&lt; std::endl;        &#125;                std::cout &lt;&lt; &quot;Sub-interpreter deactivated&quot; &lt;&lt; std::endl;                // ä¸»è§£é‡Šå™¨ä¸å—å½±å“        py::exec(&quot;print(&#x27;Back to main interpreter&#x27;)&quot;);            &#125; catch (const py::error_already_set&amp; e) &#123;        std::cerr &lt;&lt; &quot;Error: &quot; &lt;&lt; e.what() &lt;&lt; std::endl;        return 1;    &#125;        return 0;&#125;\n2. å¤šçº¿ç¨‹å­è§£é‡Šå™¨\n#include &lt;pybind11/embed.h&gt;#include &lt;pybind11/subinterpreter.h&gt;#include &lt;thread&gt;#include &lt;iostream&gt;namespace py = pybind11;void run_in_subinterpreter(py::subinterpreter sub, int id) &#123;    try &#123;        // æ¿€æ´»å­è§£é‡Šå™¨        py::subinterpreter_scoped_activate activate(sub);                std::cout &lt;&lt; &quot;Thread &quot; &lt;&lt; id &lt;&lt; &quot; started in sub-interpreter&quot; &lt;&lt; std::endl;                // æ‰§è¡ŒPythonä»£ç         py::exec(R&quot;(            import time            import threading                        def task():                for i in range(3):                    print(f&quot;Task &#123;id&#125; iteration &#123;i&#125; (thread: &#123;threading.get_ident()&#125;)&quot;)                    time.sleep(1)                        task()        )&quot;);                std::cout &lt;&lt; &quot;Thread &quot; &lt;&lt; id &lt;&lt; &quot; completed&quot; &lt;&lt; std::endl;            &#125; catch (const py::error_already_set&amp; e) &#123;        std::cerr &lt;&lt; &quot;Thread &quot; &lt;&lt; id &lt;&lt; &quot; error: &quot; &lt;&lt; e.what() &lt;&lt; std::endl;    &#125;&#125;int main() &#123;    py::scoped_interpreter main_guard&#123;&#125;;        try &#123;        // åˆ›å»ºå¤šä¸ªå­è§£é‡Šå™¨        py::subinterpreter sub1 = py::subinterpreter::create();        py::subinterpreter sub2 = py::subinterpreter::create();                // åœ¨ä¸åŒçº¿ç¨‹ä¸­è¿è¡Œå­è§£é‡Šå™¨        std::thread t1(run_in_subinterpreter, std::move(sub1), 1);        std::thread t2(run_in_subinterpreter, std::move(sub2), 2);                t1.join();        t2.join();            &#125; catch (const py::error_already_set&amp; e) &#123;        std::cerr &lt;&lt; &quot;Main error: &quot; &lt;&lt; e.what() &lt;&lt; std::endl;        return 1;    &#125;        return 0;&#125;\n3. å­è§£é‡Šå™¨å®‰å…¨æœ€ä½³å®è·µ\n#include &lt;pybind11/embed.h&gt;#include &lt;pybind11/subinterpreter.h&gt;#include &lt;thread&gt;#include &lt;mutex&gt;#include &lt;iostream&gt;namespace py = pybind11;// çº¿ç¨‹å®‰å…¨çš„å­è§£é‡Šå™¨ç®¡ç†å™¨class SubinterpreterManager &#123;public:    SubinterpreterManager() : main_guard_&#123;&#125; &#123;&#125;        py::subinterpreter create_subinterpreter() &#123;        std::lock_guard&lt;std::mutex&gt; lock(mutex_);        return py::subinterpreter::create();    &#125;    private:    py::scoped_interpreter main_guard_;    std::mutex mutex_;&#125;;// å®‰å…¨çš„ä»»åŠ¡å‡½æ•°void safe_task(py::subinterpreter sub, const std::string&amp; name) &#123;    try &#123;        // å­è§£é‡Šå™¨ä½œç”¨åŸŸ        py::subinterpreter_scoped_activate activate(sub);                // ä»»åŠ¡é€»è¾‘        py::exec(R&quot;(            import time                        def safe_operation(name):                result = []                for i in range(5):                    result.append(f&quot;&#123;name&#125;: &#123;i&#125;&quot;)                    time.sleep(0.1)                return result                        result = safe_operation(name)            print(f&quot;Task &#123;name&#125; completed with &#123;len(result)&#125; items&quot;)        )&quot;);            &#125; catch (const py::error_already_set&amp; e) &#123;        std::cerr &lt;&lt; &quot;Task &quot; &lt;&lt; name &lt;&lt; &quot; failed: &quot; &lt;&lt; e.what() &lt;&lt; std::endl;    &#125;&#125;int main() &#123;    SubinterpreterManager manager;        // åˆ›å»ºå¹¶è¿è¡Œå¤šä¸ªå­è§£é‡Šå™¨ä»»åŠ¡    std::vector&lt;std::thread&gt; threads;    for (int i = 0; i &lt; 3; ++i) &#123;        py::subinterpreter sub = manager.create_subinterpreter();        threads.emplace_back(safe_task, std::move(sub), &quot;task_&quot; + std::to_string(i));    &#125;        // ç­‰å¾…æ‰€æœ‰çº¿ç¨‹å®Œæˆ    for (auto&amp; t : threads) &#123;        t.join();    &#125;        return 0;&#125;\nè‡ªå®šä¹‰ç±»å‹è½¬æ¢\n1. åŸºç¡€è‡ªå®šä¹‰è½¬æ¢å™¨\n#include &lt;pybind11/pybind11.h&gt;#include &lt;string&gt;#include &lt;sstream&gt;namespace py = pybind11;// è‡ªå®šä¹‰ç±»å‹struct Point &#123;    int x;    int y;        Point(int x = 0, int y = 0) : x(x), y(y) &#123;&#125;        std::string to_string() const &#123;        std::stringstream ss;        ss &lt;&lt; &quot;(&quot; &lt;&lt; x &lt;&lt; &quot;, &quot; &lt;&lt; y &lt;&lt; &quot;)&quot;;        return ss.str();    &#125;&#125;;// è‡ªå®šä¹‰ç±»å‹è½¬æ¢å™¨namespace pybind11 &#123; namespace detail &#123;    template &lt;&gt; struct type_caster&lt;Point&gt; &#123;    public:        PYBIND11_TYPE_CASTER(Point, _(&quot;Point&quot;));                // ä»Pythonå¯¹è±¡è½¬æ¢åˆ°C++        bool load(handle src, bool) &#123;            if (!src.is_dict()) return false;                        py::dict obj = src.cast&lt;py::dict&gt;();            value.x = obj[&quot;x&quot;].cast&lt;int&gt;();            value.y = obj[&quot;y&quot;].cast&lt;int&gt;();            return true;        &#125;                // ä»C++è½¬æ¢åˆ°Pythonå¯¹è±¡        static handle cast(const Point&amp; p, return_value_policy /* policy */, handle /* parent */) &#123;            py::dict obj;            obj[&quot;x&quot;] = p.x;            obj[&quot;y&quot;] = p.y;            return obj.release();        &#125;    &#125;;&#125;&#125;PYBIND11_MODULE(example, m) &#123;    // ä½¿ç”¨è‡ªå®šä¹‰è½¬æ¢å™¨    m.def(&quot;add_points&quot;, [](const Point&amp; a, const Point&amp; b) &#123;        return Point(a.x + b.x, a.y + b.y);    &#125;);        m.def(&quot;print_point&quot;, [](const Point&amp; p) &#123;        py::print(p.to_string());    &#125;);&#125;\nPython ä½¿ç”¨ï¼š\nimport example# åˆ›å»ºPointå¯¹è±¡ï¼ˆé€šè¿‡å­—å…¸ï¼‰p1 = &#123;&quot;x&quot;: 1, &quot;y&quot;: 2&#125;p2 = &#123;&quot;x&quot;: 3, &quot;y&quot;: 4&#125;# ä½¿ç”¨è‡ªå®šä¹‰è½¬æ¢result = example.add_points(p1, p2)print(result)  # è¾“å‡ºï¼š&#123;&#x27;x&#x27;: 4, &#x27;y&#x27;: 6&#125;example.print_point(result)  # è¾“å‡ºï¼š(4, 6)\n2. æ”¯æŒå¤šç§ Python ç±»å‹çš„è½¬æ¢å™¨\n#include &lt;pybind11/pybind11.h&gt;#include &lt;pybind11/stl.h&gt;#include &lt;string&gt;#include &lt;vector&gt;namespace py = pybind11;struct Rectangle &#123;    int x, y, width, height;        Rectangle(int x=0, int y=0, int w=0, int h=0)         : x(x), y(y), width(w), height(h) &#123;&#125;        int area() const &#123; return width * height; &#125;&#125;;namespace pybind11 &#123; namespace detail &#123;    template &lt;&gt; struct type_caster&lt;Rectangle&gt; &#123;    public:        PYBIND11_TYPE_CASTER(Rectangle, _(&quot;Rectangle&quot;));                bool load(handle src, bool) &#123;            // æ”¯æŒå­—å…¸            if (src.is_dict()) &#123;                py::dict obj = src.cast&lt;py::dict&gt;();                value.x = obj[&quot;x&quot;].cast&lt;int&gt;();                value.y = obj[&quot;y&quot;].cast&lt;int&gt;();                value.width = obj[&quot;width&quot;].cast&lt;int&gt;();                value.height = obj[&quot;height&quot;].cast&lt;int&gt;();                return true;            &#125;            // æ”¯æŒå…ƒç»„            else if (src.is_tuple()) &#123;                py::tuple obj = src.cast&lt;py::tuple&gt;();                if (obj.size() != 4) return false;                value.x = obj[0].cast&lt;int&gt;();                value.y = obj[1].cast&lt;int&gt;();                value.width = obj[2].cast&lt;int&gt;();                value.height = obj[3].cast&lt;int&gt;();                return true;            &#125;            // æ”¯æŒåˆ—è¡¨            else if (src.is_list()) &#123;                py::list obj = src.cast&lt;py::list&gt;();                if (obj.size() != 4) return false;                value.x = obj[0].cast&lt;int&gt;();                value.y = obj[1].cast&lt;int&gt;();                value.width = obj[2].cast&lt;int&gt;();                value.height = obj[3].cast&lt;int&gt;();                return true;            &#125;                        return false;        &#125;                static handle cast(const Rectangle&amp; r, return_value_policy /* policy */, handle /* parent */) &#123;            py::dict obj;            obj[&quot;x&quot;] = r.x;            obj[&quot;y&quot;] = r.y;            obj[&quot;width&quot;] = r.width;            obj[&quot;height&quot;] = r.height;            obj[&quot;area&quot;] = r.area();            return obj.release();        &#125;    &#125;;&#125;&#125;PYBIND11_MODULE(example, m) &#123;    m.def(&quot;rectangle_area&quot;, [](const Rectangle&amp; r) &#123;        return r.area();    &#125;);        m.def(&quot;expand_rectangle&quot;, [](const Rectangle&amp; r, int amount) &#123;        return Rectangle(            r.x - amount,            r.y - amount,            r.width + 2 * amount,            r.height + 2 * amount        );    &#125;);&#125;\nPython ä½¿ç”¨ï¼š\nimport example# æ”¯æŒå¤šç§è¾“å…¥ç±»å‹rect1 = &#123;&quot;x&quot;: 0, &quot;y&quot;: 0, &quot;width&quot;: 10, &quot;height&quot;: 20&#125;rect2 = (10, 10, 5, 5)rect3 = [20, 20, 8, 8]print(example.rectangle_area(rect1))  # è¾“å‡ºï¼š200print(example.rectangle_area(rect2))  # è¾“å‡ºï¼š25print(example.rectangle_area(rect3))  # è¾“å‡ºï¼š64# æ‰©å±•çŸ©å½¢expanded = example.expand_rectangle(rect1, 2)print(expanded)# è¾“å‡ºï¼š&#123;&#x27;x&#x27;: -2, &#x27;y&#x27;: -2, &#x27;width&#x27;: 14, &#x27;height&#x27;: 24, &#x27;area&#x27;: 336&#125;\n3. ç»§æ‰¿ç±»å‹çš„è½¬æ¢å™¨\n#include &lt;pybind11/pybind11.h&gt;#include &lt;string&gt;#include &lt;memory&gt;namespace py = pybind11;// åŸºç±»struct Shape &#123;    virtual ~Shape() = default;    virtual std::string name() const = 0;    virtual double area() const = 0;&#125;;// æ´¾ç”Ÿç±»struct Circle : public Shape &#123;    double radius;        Circle(double r) : radius(r) &#123;&#125;        std::string name() const override &#123; return &quot;Circle&quot;; &#125;    double area() const override &#123; return 3.14159 * radius * radius; &#125;&#125;;struct Square : public Shape &#123;    double side;        Square(double s) : side(s) &#123;&#125;        std::string name() const override &#123; return &quot;Square&quot;; &#125;    double area() const override &#123; return side * side; &#125;&#125;;// åŸºç±»è½¬æ¢å™¨namespace pybind11 &#123; namespace detail &#123;    template &lt;&gt; struct type_caster&lt;std::shared_ptr&lt;Shape&gt;&gt; &#123;    public:        PYBIND11_TYPE_CASTER(std::shared_ptr&lt;Shape&gt;, _(&quot;Shape&quot;));                bool load(handle src, bool) &#123;            if (!src.is_dict()) return false;                        py::dict obj = src.cast&lt;py::dict&gt;();            std::string type = obj[&quot;type&quot;].cast&lt;std::string&gt;();                        if (type == &quot;circle&quot;) &#123;                double radius = obj[&quot;radius&quot;].cast&lt;double&gt;();                value = std::make_shared&lt;Circle&gt;(radius);            &#125; else if (type == &quot;square&quot;) &#123;                double side = obj[&quot;side&quot;].cast&lt;double&gt;();                value = std::make_shared&lt;Square&gt;(side);            &#125; else &#123;                return false;            &#125;                        return true;        &#125;                static handle cast(const std::shared_ptr&lt;Shape&gt;&amp; shape,                           return_value_policy /* policy */, handle /* parent */) &#123;            py::dict obj;                        if (auto circle = std::dynamic_pointer_cast&lt;Circle&gt;(shape)) &#123;                obj[&quot;type&quot;] = &quot;circle&quot;;                obj[&quot;radius&quot;] = circle-&gt;radius;            &#125; else if (auto square = std::dynamic_pointer_cast&lt;Square&gt;(shape)) &#123;                obj[&quot;type&quot;] = &quot;square&quot;;                obj[&quot;side&quot;] = square-&gt;side;            &#125;                        obj[&quot;name&quot;] = shape-&gt;name();            obj[&quot;area&quot;] = shape-&gt;area();                        return obj.release();        &#125;    &#125;;&#125;&#125;PYBIND11_MODULE(example, m) &#123;    m.def(&quot;shape_info&quot;, [](const std::shared_ptr&lt;Shape&gt;&amp; shape) &#123;        return py::make_tuple(shape-&gt;name(), shape-&gt;area());    &#125;);        m.def(&quot;create_shape&quot;, [](const std::string&amp; type, double param) &#123;        if (type == &quot;circle&quot;) &#123;            return std::make_shared&lt;Circle&gt;(param);        &#125; else if (type == &quot;square&quot;) &#123;            return std::make_shared&lt;Square&gt;(param);        &#125;        throw std::invalid_argument(&quot;Unknown shape type&quot;);    &#125;);&#125;\nå…¶ä»–é«˜çº§ç‰¹æ€§\n1. å±æ€§è£…é¥°å™¨\n#include &lt;pybind11/pybind11.h&gt;#include &lt;string&gt;namespace py = pybind11;class Person &#123;public:    Person(const std::string&amp; name, int age)         : name(name), age(age) &#123;&#125;        std::string get_name() const &#123; return name; &#125;    void set_name(const std::string&amp; new_name) &#123; name = new_name; &#125;        int get_age() const &#123; return age; &#125;    void set_age(int new_age) &#123;         if (new_age &lt; 0) throw std::invalid_argument(&quot;å¹´é¾„ä¸èƒ½ä¸ºè´Ÿæ•°&quot;);        age = new_age;    &#125;        std::string get_full_info() const &#123;        return name + &quot;, &quot; + std::to_string(age) + &quot;å²&quot;;    &#125;    private:    std::string name;    int age;&#125;;PYBIND11_MODULE(example, m) &#123;    py::class_&lt;Person&gt;(m, &quot;Person&quot;)        .def(py::init&lt;const std::string&amp;, int&gt;())                // å¯è¯»å¯å†™å±æ€§        .def_property(&quot;name&quot;, &amp;Person::get_name, &amp;Person::set_name)                // å¸¦éªŒè¯çš„å±æ€§        .def_property(&quot;age&quot;, &amp;Person::get_age, &amp;Person::set_age)                // åªè¯»å±æ€§        .def_property_readonly(&quot;full_info&quot;, &amp;Person::get_full_info)                // é™æ€å±æ€§        .def_readwrite_static(&quot;species&quot;, []() &#123; return &quot;äººç±»&quot;; &#125;);&#125;\n2. æ–¹æ³•è£…é¥°å™¨\n#include &lt;pybind11/pybind11.h&gt;#include &lt;pybind11/functional.h&gt;#include &lt;string&gt;#include &lt;chrono&gt;namespace py = pybind11;// è®¡æ—¶è£…é¥°å™¨template &lt;typename Func&gt;auto timing_decorator(Func&amp;&amp; func) &#123;    return [func = std::forward&lt;Func&gt;(func)](auto&amp;&amp;... args) &#123;        auto start = std::chrono::high_resolution_clock::now();                auto result = func(std::forward&lt;decltype(args)&gt;(args)...);                auto end = std::chrono::high_resolution_clock::now();        auto duration = std::chrono::duration_cast&lt;std::chrono::microseconds&gt;(            end - start        );                py::print(&quot;å‡½æ•°æ‰§è¡Œæ—¶é—´:&quot;, duration.count(), &quot;å¾®ç§’&quot;);        return result;    &#125;;&#125;// ç¼“å­˜è£…é¥°å™¨template &lt;typename Func&gt;auto cache_decorator(Func&amp;&amp; func) &#123;    std::unordered_map&lt;std::string, py::object&gt; cache;        return [func = std::forward&lt;Func&gt;(func), cache = std::move(cache)](        const std::string&amp; key, auto&amp;&amp;... args    ) mutable &#123;        if (cache.find(key) != cache.end()) &#123;            py::print(&quot;ç¼“å­˜å‘½ä¸­:&quot;, key);            return cache[key];        &#125;                py::object result = func(key, std::forward&lt;decltype(args)&gt;(args)...);        cache[key] = result;        py::print(&quot;ç¼“å­˜æœªå‘½ä¸­ï¼Œè®¡ç®—ç»“æœ:&quot;, key);        return result;    &#125;;&#125;PYBIND11_MODULE(example, m) &#123;    // åŸå§‹å‡½æ•°    auto expensive_function = [](const std::string&amp; data) &#123;        // æ¨¡æ‹Ÿè€—æ—¶è®¡ç®—        std::this_thread::sleep_for(std::chrono::milliseconds(100));        return &quot;å¤„ç†ç»“æœ: &quot; + data;    &#125;;        // ä½¿ç”¨è£…é¥°å™¨    m.def(&quot;process_data&quot;, timing_decorator(expensive_function));    m.def(&quot;cached_process&quot;, cache_decorator(expensive_function));&#125;\n3. è‡ªå®šä¹‰å¼‚å¸¸\n#include &lt;pybind11/pybind11.h&gt;#include &lt;stdexcept&gt;#include &lt;string&gt;namespace py = pybind11;// è‡ªå®šä¹‰å¼‚å¸¸ç±»å‹class ValidationError : public std::runtime_error &#123;public:    ValidationError(const std::string&amp; message)         : std::runtime_error(message) &#123;&#125;&#125;;class DatabaseError : public std::runtime_error &#123;public:    DatabaseError(const std::string&amp; message, int code)         : std::runtime_error(message), error_code(code) &#123;&#125;        int get_code() const &#123; return error_code; &#125;    private:    int error_code;&#125;;PYBIND11_MODULE(example, m) &#123;    // ç»‘å®šè‡ªå®šä¹‰å¼‚å¸¸    auto validation_error = py::register_exception&lt;ValidationError&gt;(m, &quot;ValidationError&quot;);    auto db_error = py::register_exception&lt;DatabaseError&gt;(m, &quot;DatabaseError&quot;);        // ä¸ºå¼‚å¸¸æ·»åŠ é¢å¤–æ–¹æ³•    db_error.def(&quot;get_code&quot;, &amp;DatabaseError::get_code);        // ä½¿ç”¨è‡ªå®šä¹‰å¼‚å¸¸çš„å‡½æ•°    m.def(&quot;validate_age&quot;, [](int age) &#123;        if (age &lt; 0) &#123;            throw ValidationError(&quot;å¹´é¾„ä¸èƒ½ä¸ºè´Ÿæ•°&quot;);        &#125;        if (age &gt; 150) &#123;            throw ValidationError(&quot;å¹´é¾„ä¸èƒ½è¶…è¿‡150&quot;);        &#125;    &#125;);        m.def(&quot;connect_to_db&quot;, [](const std::string&amp; host) &#123;        if (host.empty()) &#123;            throw DatabaseError(&quot;æ•°æ®åº“ä¸»æœºä¸èƒ½ä¸ºç©º&quot;, 1001);        &#125;        if (host != &quot;localhost&quot;) &#123;            throw DatabaseError(&quot;è¿æ¥å¤±è´¥: æœªçŸ¥ä¸»æœº&quot;, 1002);        &#125;        return &quot;è¿æ¥æˆåŠŸ&quot;;    &#125;);&#125;\nPython ä½¿ç”¨ï¼š\nimport exampletry:    example.validate_age(-5)except example.ValidationError as e:    print(f&quot;éªŒè¯é”™è¯¯: &#123;e&#125;&quot;)try:    example.connect_to_db(&quot;invalid_host&quot;)except example.DatabaseError as e:    print(f&quot;æ•°æ®åº“é”™è¯¯: &#123;e&#125;, é”™è¯¯ç : &#123;e.get_code()&#125;&quot;)\n4. ä¸Šä¸‹æ–‡ç®¡ç†å™¨\n#include &lt;pybind11/pybind11.h&gt;#include &lt;pybind11/functional.h&gt;#include &lt;iostream&gt;#include &lt;chrono&gt;namespace py = pybind11;class Timer &#123;public:    Timer() : start_time(std::chrono::high_resolution_clock::now()) &#123;        std::cout &lt;&lt; &quot;è®¡æ—¶å™¨å¼€å§‹&quot; &lt;&lt; std::endl;    &#125;        ~Timer() &#123;        auto end_time = std::chrono::high_resolution_clock::now();        auto duration = std::chrono::duration_cast&lt;std::chrono::milliseconds&gt;(            end_time - start_time        );        std::cout &lt;&lt; &quot;è®¡æ—¶å™¨ç»“æŸï¼Œè€—æ—¶: &quot; &lt;&lt; duration.count() &lt;&lt; &quot;æ¯«ç§’&quot; &lt;&lt; std::endl;    &#125;        void reset() &#123;        start_time = std::chrono::high_resolution_clock::now();        std::cout &lt;&lt; &quot;è®¡æ—¶å™¨é‡ç½®&quot; &lt;&lt; std::endl;    &#125;    private:    std::chrono::high_resolution_clock::time_point start_time;&#125;;PYBIND11_MODULE(example, m) &#123;    py::class_&lt;Timer&gt;(m, &quot;Timer&quot;)        .def(py::init&lt;&gt;())        .def(&quot;reset&quot;, &amp;Timer::reset)                // å®ç°ä¸Šä¸‹æ–‡ç®¡ç†å™¨æ¥å£        .def(&quot;__enter__&quot;, [](Timer&amp; self) &#123;            return &amp;self;        &#125;)        .def(&quot;__exit__&quot;, [](Timer&amp; self, py::object type, py::object value, py::object traceback) &#123;            // __exit__æ–¹æ³•çš„è¿”å›å€¼è¡¨ç¤ºæ˜¯å¦å¤„ç†å¼‚å¸¸            return py::none();        &#125;);&#125;\nPython ä½¿ç”¨ï¼š\nimport exampleimport time# ä½¿ç”¨ä¸Šä¸‹æ–‡ç®¡ç†å™¨with example.Timer() as timer:    time.sleep(1)    timer.reset()    time.sleep(0.5)# è¾“å‡ºï¼š# è®¡æ—¶å™¨å¼€å§‹# è®¡æ—¶å™¨é‡ç½®# è®¡æ—¶å™¨ç»“æŸï¼Œè€—æ—¶: 500æ¯«ç§’\n5. è¿­ä»£å™¨æ”¯æŒ\n#include &lt;pybind11/pybind11.h&gt;#include &lt;vector&gt;#include &lt;string&gt;namespace py = pybind11;class NumberSequence &#123;public:    NumberSequence(int start, int end)         : start_(start), end_(end), current_(start) &#123;&#125;        // è¿­ä»£å™¨æ¥å£    int next() &#123;        if (current_ &gt; end_) &#123;            throw py::stop_iteration();        &#125;        return current_++;    &#125;        // é‡ç½®è¿­ä»£å™¨    void reset() &#123;        current_ = start_;    &#125;    private:    int start_;    int end_;    int current_;&#125;;PYBIND11_MODULE(example, m) &#123;    py::class_&lt;NumberSequence&gt;(m, &quot;NumberSequence&quot;)        .def(py::init&lt;int, int&gt;())        .def(&quot;reset&quot;, &amp;NumberSequence::reset)                // å®ç°è¿­ä»£å™¨åè®®        .def(&quot;__iter__&quot;, [](NumberSequence&amp; self) &#123;            self.reset();            return &amp;self;        &#125;)        .def(&quot;__next__&quot;, &amp;NumberSequence::next);        // èŒƒå›´è¿­ä»£å™¨ç¤ºä¾‹    m.def(&quot;range_generator&quot;, [](int n) &#123;        return py::make_iterator(range(0, n).begin(), range(0, n).end());    &#125;, py::keep_alive&lt;0, 1&gt;());&#125;\nPython ä½¿ç”¨ï¼š\nimport example# ä½¿ç”¨è‡ªå®šä¹‰è¿­ä»£å™¨seq = example.NumberSequence(1, 5)for num in seq:    print(num)  # è¾“å‡ºï¼š1, 2, 3, 4, 5# ä½¿ç”¨èŒƒå›´ç”Ÿæˆå™¨for i in example.range_generator(3):    print(i)  # è¾“å‡ºï¼š0, 1, 2\næ€»ç»“\næœ¬è¡¥å……æŒ‡å—æ¶µç›–äº† pybind11 å®˜æ–¹æ–‡æ¡£ä¸­çš„æ‰€æœ‰é‡è¦é«˜çº§ç‰¹æ€§ï¼š\næ ¸å¿ƒè¦ç‚¹\n\n\né«˜çº§ç±»ç‰¹æ€§ï¼šåŠ¨æ€å±æ€§ã€ç»§æ‰¿ä¸å¤šæ€ã€è¿ç®—ç¬¦é‡è½½ã€æšä¸¾ç»‘å®š\n\n\næ„å»ºç³»ç»Ÿï¼šCMakeã€pyproject.tomlã€setuptools çš„é«˜çº§é…ç½®\n\n\nå†…å­˜ç®¡ç†ï¼šè¿”å›å€¼ç­–ç•¥ã€æ™ºèƒ½æŒ‡é’ˆï¼ˆsmart_holderã€unique_ptrã€shared_ptrï¼‰\n\n\nç±»å‹ç³»ç»Ÿï¼šåŸºç¡€ç±»å‹è½¬æ¢ã€STL å®¹å™¨ã€è‡ªå®šä¹‰ç±»å‹è½¬æ¢å™¨\n\n\nåµŒå…¥ä¸æ‰©å±•ï¼šPython è§£é‡Šå™¨åµŒå…¥ã€å­è§£é‡Šå™¨ã€å¤šçº¿ç¨‹ GIL ç®¡ç†\n\n\né«˜çº§åŠŸèƒ½ï¼šå±æ€§è£…é¥°å™¨ã€æ–¹æ³•è£…é¥°å™¨ã€è‡ªå®šä¹‰å¼‚å¸¸ã€ä¸Šä¸‹æ–‡ç®¡ç†å™¨ã€è¿­ä»£å™¨\n\n\næœ€ä½³å®è·µ\n\n\nå†…å­˜å®‰å…¨ï¼šæ­£ç¡®ä½¿ç”¨è¿”å›å€¼ç­–ç•¥ï¼Œä¼˜å…ˆä½¿ç”¨ smart_holder\n\n\næ€§èƒ½ä¼˜åŒ–ï¼šåˆç†é‡Šæ”¾ GILï¼Œä½¿ç”¨å¤šçº¿ç¨‹å’Œå¼‚æ­¥ä»»åŠ¡\n\n\nç±»å‹å®‰å…¨ï¼šä½¿ç”¨å¼ºç±»å‹è½¬æ¢ï¼Œé¿å…éšå¼è½¬æ¢é”™è¯¯\n\n\nä»£ç ç»„ç»‡ï¼šæ¨¡å—åŒ–è®¾è®¡ï¼Œåˆ†ç¦»å®ç°å’Œç»‘å®šä»£ç \n\n\né”™è¯¯å¤„ç†ï¼šä½¿ç”¨è‡ªå®šä¹‰å¼‚å¸¸ï¼Œæä¾›è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯\n\n\nè¿›é˜¶å­¦ä¹ \n\n\næ€§èƒ½è°ƒä¼˜ï¼šä½¿ç”¨ LTO ä¼˜åŒ–ã€ç¼“å­˜æœºåˆ¶ã€å¼‚æ­¥ç¼–ç¨‹\n\n\nè°ƒè¯•æŠ€å·§ï¼šGDB è°ƒè¯•ã€Python è°ƒè¯•å™¨é›†æˆ\n\n\næµ‹è¯•ç­–ç•¥ï¼šå•å…ƒæµ‹è¯•ã€é›†æˆæµ‹è¯•ã€æ€§èƒ½æµ‹è¯•\n\n\néƒ¨ç½²æ–¹æ¡ˆï¼šwheel æ‰“åŒ…ã€conda åŒ…ã€Docker å®¹å™¨åŒ–\n\n\npybind11 ä¸º C++ å’Œ Python çš„æ— ç¼é›†æˆæä¾›äº†å¼ºå¤§çš„æ”¯æŒï¼ŒæŒæ¡è¿™äº›é«˜çº§ç‰¹æ€§å°†å¸®åŠ©æ‚¨å¼€å‘å‡ºæ›´åŠ é«˜æ•ˆã€å¥å£®çš„è·¨è¯­è¨€åº”ç”¨ç¨‹åºã€‚\nDate: October 16, 2025\nCode: https://github.com/pybind/pybind11\næ€»ç»“\npybind11 æ˜¯ä¸€ä¸ªå¼ºå¤§è€Œçµæ´»çš„å·¥å…·ï¼Œå®ƒè®© C++ å’Œ Python ä¹‹é—´çš„äº’æ“ä½œå˜å¾—ç®€å•é«˜æ•ˆã€‚é€šè¿‡æœ¬æŒ‡å—ï¼Œä½ åº”è¯¥å·²ç»æŒæ¡äº†ï¼š\n\n\nåŸºç¡€æ¦‚å¿µï¼špybind11 çš„æ ¸å¿ƒåŠŸèƒ½å’Œä¼˜åŠ¿\n\n\nå®‰è£…é…ç½®ï¼šå¦‚ä½•åœ¨ä¸åŒå¹³å°ä¸Šå®‰è£…å’Œé…ç½® pybind11\n\n\nå‡½æ•°ç»‘å®šï¼šå°† C++ å‡½æ•°æš´éœ²ç»™ Python çš„å„ç§æ–¹æ³•\n\n\nç±»ç»‘å®šï¼šå°† C++ ç±»åŠå…¶æ–¹æ³•ã€å±æ€§æš´éœ²ç»™ Python\n\n\né«˜çº§ç‰¹æ€§ï¼šSTL å®¹å™¨æ”¯æŒã€NumPy é›†æˆã€è¿ç®—ç¬¦é‡è½½ç­‰\n\n\nå®é™…åº”ç”¨ï¼šæ€§èƒ½ä¼˜åŒ–ã€é”™è¯¯å¤„ç†ã€æµ‹è¯•ç­–ç•¥ç­‰æœ€ä½³å®è·µ\n\n\nè¿›ä¸€æ­¥å­¦ä¹ èµ„æº\n\n\nå®˜æ–¹æ–‡æ¡£ï¼šhttps://pybind11.readthedocs.io/\n\n\nGitHub ä»“åº“ï¼šhttps://github.com/pybind/pybind11\n\n\nç¤ºä¾‹é¡¹ç›®ï¼š\n\n\nhttps://github.com/pybind/python_example\n\n\nhttps://github.com/pybind/cmake_example\n\n\næ¨èä¹¦ç±\n\n\nã€ŠPython Cookbookã€‹ï¼ˆç¬¬ 3 ç‰ˆï¼‰- David Beazley\n\n\nã€ŠC++ Concurrency in Actionã€‹- Anthony Williams\n\n\nã€ŠEffective Modern C++ã€‹- Scott Meyers\n\n\npybind11 ä¸º C++ å’Œ Python å¼€å‘è€…æä¾›äº†ä¸€ä¸ªå¼ºå¤§çš„æ¡¥æ¢ï¼Œåˆç†ä½¿ç”¨å¯ä»¥å……åˆ†å‘æŒ¥ä¸¤ç§è¯­è¨€çš„ä¼˜åŠ¿ï¼Œå¼€å‘å‡ºé«˜æ€§èƒ½ã€æ˜“ç»´æŠ¤çš„åº”ç”¨ç¨‹åºã€‚\nDate: October 16, 2025\nCode: https://github.com/pybind/pybind11\n","categories":["ç¼–ç¨‹"],"tags":["python","C++"]},{"title":"VScodeä¸­é…ç½®MSVC","url":"/2025/06/07/C++/vscode%E4%B8%AD%E9%85%8D%E7%BD%AEMSVC/","content":"\nè§‰å¾—VS2022æœ‰ç‚¹é‡ï¼Œä¾¿åœ¨vscodeä¸­å†™C++é¡¹ç›®ï¼Œæ”¶é›†èµ„æ–™ï¼Œç»“åˆaiæ•´ç†å‡ºè®°å½•\n\n\nvscodeä¸­é…ç½®MSVC\nä¸€ã€å‰ç½®çŸ¥è¯†ï¼ˆç†è§£ç¯å¢ƒé…ç½®çš„åŸºç¡€ï¼‰\n\n\nC/C++ç¼–è¯‘å™¨ä¸IDEçš„åŒºåˆ«\n\nç¼–è¯‘å™¨ï¼šè´Ÿè´£å°†ä»£ç ç¼–è¯‘ä¸ºå¯æ‰§è¡Œæ–‡ä»¶ï¼Œå¸¸ç”¨ç±»å‹åŒ…æ‹¬GCCã€MinGWã€MSVCï¼ˆæœ¬æ–‡æ ¸å¿ƒä½¿ç”¨MSVCï¼‰ï¼›\nIDEï¼šé›†æˆå¼€å‘ç¯å¢ƒï¼ˆå¦‚Codeblocksã€VS Codeã€Dev C++ï¼‰ï¼Œä»…æä¾›ç¼–è¾‘ã€è°ƒè¯•ç•Œé¢ï¼Œéœ€ä¾èµ–ç¼–è¯‘å™¨æ‰èƒ½è¿è¡Œä»£ç ï¼›\nå…¼å®¹æ€§ï¼šä»…ä½¿ç”¨æ ‡å‡†åº“çš„ä»£ç å¯è·¨ç¼–è¯‘å™¨è¿è¡Œï¼Œä½¿ç”¨ç‰¹å®šç¼–è¯‘å™¨ç‹¬æœ‰åº“çš„ä»£ç éœ€å¯¹åº”ç¼–è¯‘å™¨ï¼ˆç”šè‡³ç‰ˆæœ¬ï¼‰ã€‚\n\n\n\nWindowsç¯å¢ƒå˜é‡è¯¦è§£\n\nå®šä¹‰ï¼šæ“ä½œç³»ç»Ÿä¸­å­˜å‚¨åº”ç”¨ç¨‹åºæ‰€éœ€ä¿¡æ¯çš„å¯¹è±¡ï¼Œå¯ç†è§£ä¸ºâ€œè·¯å¾„æŒ‡é’ˆâ€ï¼›\nåˆ†ç±»ï¼š\n\nç”¨æˆ·å˜é‡ï¼šä»…å¯¹å½“å‰ç™»å½•ç”¨æˆ·ç”Ÿæ•ˆï¼Œä¼˜å…ˆçº§é«˜äºç³»ç»Ÿå˜é‡ï¼›\nç³»ç»Ÿå˜é‡ï¼šå¯¹æ‰€æœ‰ç”¨æˆ·ç”Ÿæ•ˆï¼›\n\n\næ ¸å¿ƒä½œç”¨ï¼šç®€åŒ–è·¯å¾„è°ƒç”¨ï¼ˆå¦‚å°†exeæ‰€åœ¨ç›®å½•åŠ å…¥Pathå˜é‡åï¼Œæ— éœ€è¾“å…¥å®Œæ•´è·¯å¾„å³å¯è°ƒç”¨exeï¼‰ï¼›\nå…³é”®æ“ä½œï¼š\n\næŸ¥çœ‹å˜é‡ï¼šå‘½ä»¤è¡Œè¾“å…¥echo %å˜é‡å%ï¼ˆå¦‚echo %SystemRoot%ï¼Œè¾“å‡ºC:\\WINDOWSï¼‰ï¼›\né‡è¦å˜é‡ï¼šPathï¼ˆå­˜å‚¨äºŒè¿›åˆ¶å¯æ‰§è¡Œæ–‡ä»¶ç›®å½•ï¼Œå¤šä»¥â€œbinâ€ç»“å°¾ï¼‰ã€è‡ªå®šä¹‰å˜é‡ï¼ˆå¦‚JAVA_HOMEï¼Œç”¨äºç»Ÿä¸€è·¯å¾„å¼•ç”¨ï¼‰ã€‚\n\n\n\n\n\näºŒã€å®‰è£…æ­¥éª¤ï¼ˆç¯å¢ƒé…ç½®çš„å‰æï¼‰\n\n\nå®‰è£…VS Code\n\næ“ä½œï¼šè‡ªè¡Œä¸‹è½½å®‰è£…ï¼Œå®‰è£…åè‡ªåŠ¨æ·»åŠ ç¯å¢ƒå˜é‡ï¼Œéœ€é‡å¯ç”µè„‘ç”Ÿæ•ˆã€‚\n\n\n\nå®‰è£…Visual Studioï¼ˆæ ¸å¿ƒä¾èµ–ï¼‰\n\nç‰ˆæœ¬é€‰æ‹©ï¼šä¸‹è½½Visual Studio Installerï¼Œé€‰æ‹©Visual Studio Community 2022ï¼ˆ17.7.4ç‰ˆï¼‰ï¼ˆå…è´¹ï¼Œé€‚ç”¨äºå­¦ç”Ÿã€å¼€æºå‚ä¸è€…ï¼‰ï¼›\nå¿…é€‰ç»„ä»¶ï¼šå‹¾é€‰**â€œä½¿ç”¨Cçš„æ¡Œé¢å¼€å‘â€**ï¼ˆè¯¥ç»„ä»¶åŒ…å«MSVCå·¥å…·é“¾å’ŒWindows SDKï¼Œæ˜¯ç¼–è¯‘Cä»£ç çš„æ ¸å¿ƒï¼‰ï¼›\nç³»ç»Ÿé€‚é…ï¼ˆWindows 10ç”¨æˆ·ï¼‰ï¼šåœ¨â€œå®‰è£…è¯¦ç»†ä¿¡æ¯â€ä¸­ï¼Œå–æ¶ˆå‹¾é€‰â€œWindows 11 SDKâ€ï¼Œå¹¶å‹¾é€‰â€œWindows 10 SDKâ€ï¼ˆå¦‚ç‰ˆæœ¬10.0.20348.0ï¼‰ï¼›\nå®‰è£…è·¯å¾„ï¼š\n\n2022ç‰ˆé»˜è®¤è·¯å¾„ï¼šC:\\Program Files\\Microsoft Visual Studio\\2022\\Communityï¼›\n2019åŠä»¥ä¸‹ç‰ˆè·¯å¾„ï¼šC:\\Program Files (x86)\\Microsoft Visual Studio\\2019\\Communityï¼ˆè·¯å¾„å«â€œ(x86)â€ï¼‰ï¼›\n\n\n\n\n\nä¸‰ã€é…ç½®ç³»ç»Ÿç¯å¢ƒå˜é‡ï¼ˆVS Codeç¼–è¯‘çš„å…³é”®ï¼‰\n\næ·»åŠ MSVCç¼–è¯‘å™¨(cl.exe)æ‰€åœ¨çš„ç›®å½•,MSVC,win sdkçš„å¤´æ–‡ä»¶å’Œåº“æ–‡ä»¶æ‰€åœ¨ç›®å½•\n\néœ€æ·»åŠ 7æ¡ç³»ç»Ÿç¯å¢ƒå˜é‡ï¼Œå…¶ä¸­å‰4æ¡ä¸ºåŸºç¡€å˜é‡ï¼ˆéœ€æŒ‰å®é™…å®‰è£…è·¯å¾„ä¿®æ”¹ï¼‰ï¼Œå3æ¡ä¾èµ–å‰4æ¡çš„è·¯å¾„ï¼Œå…·ä½“å¦‚ä¸‹è¡¨ï¼š\n\n\n\nå˜é‡ç±»åˆ«\nå˜é‡å\nå˜é‡å€¼ï¼ˆä»¥2022ç‰ˆä¸ºä¾‹ï¼‰\n\n\n\n\nåŸºç¡€å˜é‡\nVCTools(Visual Studioçš„VCå·¥å…·ç›®å½•)\nC:\\Program Files\\Microsoft Visual Studio\\2022\\Community\\VC\\Tools\n\n\nåŸºç¡€å˜é‡\nWIN10KITS\nC:\\Program Files (x86)\\Windows Kits\\10\n\n\nåŸºç¡€å˜é‡\nMSVC_VERSION\n14.37.32822\n\n\nåŸºç¡€å˜é‡\nWIN_SDK_VERSION\n10.0.20348.0\n\n\næ ¸å¿ƒå˜é‡\nINCLUDE\n%VCTools%\\MSVC%MSVC_VERSION%\\include;%WIN10KITS%\\Include%WIN_SDK_VERSION%\\ucrt;%WIN10KITS%\\Include%WIN_SDK_VERSION%\\um;%WIN10KITS%\\Include%WIN_SDK_VERSION%\\shared;\n\n\næ ¸å¿ƒå˜é‡\nLIB\n%WIN10KITS%\\Lib%WIN_SDK_VERSION%\\um\\x64;%WIN10KITS%\\Lib%WIN_SDK_VERSION%\\ucrt\\x64;%VCTools%\\MSVC%MSVC_VERSION%\\lib\\x64;\n\n\nPathæ–°å¢\nPath\n%VCTools%\\MSVC%MSVC_VERSION%\\bin\\Hostx64\\x64\n\n\n\nå››ã€éªŒè¯ç¯å¢ƒå˜é‡ï¼ˆç¡®ä¿é…ç½®æœ‰æ•ˆï¼‰\næ‰“å¼€Windowså‘½ä»¤æç¤ºç¬¦ï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤éªŒè¯é…ç½®æ˜¯å¦æˆåŠŸï¼Œè¾“å‡ºç»“æœéœ€ä¸é¢„æœŸä¸€è‡´ï¼š\n\n\nè¾“å…¥clï¼šè¾“å‡ºâ€œç”¨äºx64çš„Microsoft Â® C/C++ä¼˜åŒ–ç¼–è¯‘å™¨19.37.32824ç‰ˆ ç‰ˆæƒæ‰€æœ‰Â© Microsoft Corporationâ€ï¼Œè¯´æ˜ç¼–è¯‘å™¨å¯æ­£å¸¸è°ƒç”¨ï¼›\n\n\nè¾“å…¥echo %MSVC_VERSION%ï¼šè¾“å‡ºè®¾å®šçš„MSVCç‰ˆæœ¬ï¼ˆå¦‚14.37.32822ï¼‰ï¼›\n\n\nè¾“å…¥echo %WIN_SDK_VERSION%ï¼šè¾“å‡ºè®¾å®šçš„SDKç‰ˆæœ¬ï¼ˆå¦‚10.0.20348.0ï¼‰ï¼›\n\n\nè¾“å…¥echo %INCLUDE%ï¼šè¾“å‡ºå®Œæ•´çš„å¤´æ–‡ä»¶ç›®å½•åˆ—è¡¨ï¼Œä¸”è·¯å¾„ä¸é…ç½®çš„ä¸€è‡´ã€‚\n\n\näº”ã€VS Codeé…ç½®ï¼ˆç”Ÿæˆç¼–è¯‘æ‰€éœ€æ–‡ä»¶ï¼‰\n\n\nåˆ›å»ºé¡¹ç›®ç›®å½•ä¸æ–‡ä»¶\n\næ‰“å¼€å‘½ä»¤æç¤ºç¬¦ï¼Œä¾æ¬¡æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š\n\nmkdir CppTestï¼šåˆ›å»ºåä¸ºâ€œCppTestâ€çš„é¡¹ç›®æ–‡ä»¶å¤¹ï¼›\ncd CppTestï¼šè¿›å…¥è¯¥æ–‡ä»¶å¤¹ï¼›\ntype nul &gt; hello.cppï¼šåˆ›å»ºç©ºçš„C++æ–‡ä»¶â€œhello.cppâ€ï¼›\ncode .ï¼šç”¨VS Codeæ‰“å¼€å½“å‰ç›®å½•ï¼ˆå¼¹å‡ºâ€œä¿¡ä»»æ–‡ä»¶å¤¹â€å¼¹çª—æ—¶ï¼Œé€‰æ‹©â€œä¿¡ä»»â€ï¼‰ã€‚\n\n\n\n\n\nå®‰è£…å¿…è¦æ’ä»¶\n\nåœ¨VS Codeæ‰©å±•å¸‚åœºæœç´¢å¹¶å®‰è£…C/C++ Extension Pack\n\n\n\nç”Ÿæˆé…ç½®æ–‡ä»¶\n\n\nç”Ÿæˆc_cpp_properties.jsonï¼š\n\nåœ¨VS Codeé¡¶éƒ¨æœç´¢æ¡†è¾“å…¥&gt; Edit Configurations (UI)ï¼ˆéœ€å…ˆæ‰“å¼€hello.cppæ–‡ä»¶ï¼‰ï¼›\nç‚¹å‡»é«˜äº®é€‰é¡¹ï¼Œå¼¹å‡ºé…ç½®ç•Œé¢åç›´æ¥å…³é—­ï¼ŒVS Codeä¼šåœ¨é¡¹ç›®ç›®å½•ä¸‹ç”Ÿæˆéšè—æ–‡ä»¶å¤¹.vscodeï¼Œå¹¶è‡ªåŠ¨åˆ›å»ºc_cpp_properties.jsonï¼ˆé»˜è®¤é…ç½®compilerPathä¸ºcl.exeï¼ŒcppStandardä¸ºc++11ï¼‰ï¼›\n\n\n\nç”Ÿæˆtasks.jsonï¼š\n\nåœ¨æœç´¢æ¡†è¾“å…¥&gt; Default Build Taskï¼›\né€‰æ‹©C/C++ cl.exe ç”Ÿæˆæ´»åŠ¨æ–‡ä»¶ï¼ŒVS Codeä¼šåœ¨.vscodeæ–‡ä»¶å¤¹ä¸­è‡ªåŠ¨ç”Ÿæˆtasks.jsonï¼ˆåŒ…å«ç¼–è¯‘å‘½ä»¤cl.exeåŠå‚æ•°ï¼Œå¦‚/ziï¼ˆç”Ÿæˆè°ƒè¯•ä¿¡æ¯ï¼‰ã€/EHscï¼ˆå¯ç”¨C++å¼‚å¸¸å¤„ç†ï¼‰ï¼‰\n\n&#123;\t&quot;version&quot;: &quot;2.0.0&quot;,\t&quot;tasks&quot;: [\t\t&#123;\t\t\t&quot;type&quot;: &quot;cppbuild&quot;,\t\t\t&quot;label&quot;: &quot;C/C++: cl.exe build active file&quot;,     #ç”¨æ¥æ ‡è¯†tasks.jsonæ–‡ä»¶\t\t\t&quot;command&quot;: &quot;cl.exe&quot;,\t\t\t&quot;args&quot;: [\t\t\t\t&quot;/Zi&quot;,\t\t\t\t&quot;/EHsc&quot;,\t\t\t\t&quot;/nologo&quot;,\t\t\t\t&quot;/Fe$&#123;fileDirname&#125;\\\\$&#123;fileBasenameNoExtension&#125;.exe&quot;,\t\t\t\t&quot;$&#123;file&#125;&quot;\t\t\t],\t\t\t&quot;options&quot;: &#123;\t\t\t\t&quot;cwd&quot;: &quot;$&#123;fileDirname&#125;&quot;\t\t\t&#125;,\t\t\t&quot;problemMatcher&quot;: [\t\t\t\t&quot;$msCompile&quot;\t\t\t],\t\t\t&quot;group&quot;: &#123;\t\t\t\t&quot;kind&quot;: &quot;build&quot;,\t\t\t\t&quot;isDefault&quot;: true\t\t\t&#125;,\t\t\t&quot;detail&quot;: &quot;compiler: cl.exe&quot;\t\t&#125;\t]&#125;\n\n\nç”Ÿæˆlaunch.json\n\n\n&#123;    &quot;version&quot;: &quot;0.2.0&quot;,    &quot;configurations&quot;: [        &#123;            &quot;name&quot;: &quot;(Windows) Launch&quot;,            &quot;type&quot;: &quot;cppvsdbg&quot;,            &quot;request&quot;: &quot;launch&quot;,            &quot;program&quot;: &quot;$&#123;fileDirname&#125;/$&#123;fileBasenameNoExtension&#125;.exe&quot;,            &quot;args&quot;: [],            &quot;stopAtEntry&quot;: false,            &quot;cwd&quot;: &quot;$&#123;fileDirname&#125;&quot;,            &quot;environment&quot;: [],            &quot;console&quot;: &quot;externalTerminal&quot;,            &quot;preLaunchTask&quot;: &quot;C/C++: cl.exe build active file&quot;        &#125;    ]&#125;è¿™æ˜¯ç”¨æ¥å¯åŠ¨ tasks.jsonç”Ÿæˆçš„exeæ–‡ä»¶å…¶ä¸­preLaunchTaskå‚æ•°æ˜¯æŒ‡åœ¨å¯åŠ¨launch.jsonæ–‡ä»¶é‡Œçš„å·¥å…·,å…ˆå¯åŠ¨å¯¹åº”tasks.jsoné‡Œçš„å·¥å…·\n\n\nå…­ã€è¿è¡Œæµ‹è¯•ï¼ˆéªŒè¯ç¯å¢ƒæ˜¯å¦å¯ç”¨ï¼‰\n\n\nç¼–å†™æµ‹è¯•ä»£ç ï¼šåœ¨hello.cppä¸­å†™å…¥ä»¥ä¸‹Hello Worldç¨‹åºï¼š\n#include &lt;iostream&gt;using namespace std;void main()&#123;    cout&lt;&lt;&quot;Hello World&quot;&lt;&lt;endl;&#125;\n\n\næ‰§è¡Œç¨‹åºï¼š\n\nç‚¹å‡»VS Codeèœå•æ â€œè¿è¡Œâ€â†’â€œä»¥éè°ƒè¯•æ¨¡å¼è¿è¡Œâ€ï¼›\nå¼¹å‡ºè°ƒè¯•å™¨é€‰æ‹©æ¡†ï¼Œé€‰æ‹©â€œC/C++ (Windows)â€ï¼›\nç»“æœï¼šæ§åˆ¶å°è¾“å‡ºâ€œHello Worldâ€ï¼Œè¯´æ˜ç¯å¢ƒé…ç½®æˆåŠŸã€‚\n\n\n\nä¸ƒã€å¸¸è§ç–‘é—®\n\n\nä¸ºä½•Visual Studioæ— éœ€æ‰‹åŠ¨é…ç½®å³å¯è¿è¡ŒC++ç¨‹åºï¼Ÿ\n\nç­”ï¼šVisual Studioåœ¨åˆ›å»ºé¡¹ç›®æ—¶ï¼Œä¼šè‡ªåŠ¨é…ç½®å¤´æ–‡ä»¶ç›®å½•ã€åº“ç›®å½•ç­‰ï¼ˆå¦‚â€œVC++ç›®å½•â€ä¸­çš„$(VC_LibraryPath_x64)ã€$(WindowsSDK_IncludePath)ç­‰å†…éƒ¨å˜é‡ï¼‰ï¼Œè€ŒVS Codeéœ€æ‰‹åŠ¨å®šä¹‰è¿™äº›è·¯å¾„ã€‚\n\n\n\n\nå…³é”®é—®é¢˜\né—®é¢˜1ï¼šåœ¨Windows 10ç³»ç»Ÿä¸­å®‰è£…Visual Studioä»¥é…ç½®VS Codeçš„C++ï¼ˆMSVCï¼‰ç¯å¢ƒæ—¶ï¼Œéœ€æ³¨æ„å“ªäº›å…³é”®é€‰é¡¹ï¼Œé¿å…åç»­ç¼–è¯‘å‡ºé”™ï¼Ÿ\nç­”ï¼šéœ€æ³¨æ„3ä¸ªå…³é”®é€‰é¡¹ï¼š\n\n\nç‰ˆæœ¬é€‰æ‹©ï¼šé€‰æ‹©Visual Studio Community 2022ï¼ˆ17.7.4ç‰ˆï¼Œå…è´¹ä¸”åŠŸèƒ½æ»¡è¶³éœ€æ±‚ï¼‰ï¼Œé¿å…å®‰è£…ä»˜è´¹çš„Enterpriseæˆ–Professionalç‰ˆï¼›\n\n\nç»„ä»¶å‹¾é€‰ï¼šå¿…é¡»å‹¾é€‰**â€œä½¿ç”¨Cçš„æ¡Œé¢å¼€å‘â€**ï¼ˆè¯¥ç»„ä»¶åŒ…å«MSVCå·¥å…·é“¾å’ŒWindows SDKï¼Œæ˜¯ç¼–è¯‘Cä»£ç çš„æ ¸å¿ƒä¾èµ–ï¼Œè‹¥ä¸å‹¾é€‰åˆ™ç¼ºå°‘ç¼–è¯‘å™¨å’Œåº“æ–‡ä»¶ï¼‰ï¼›\n\n\nSDKé€‚é…ï¼šåœ¨â€œå®‰è£…è¯¦ç»†ä¿¡æ¯â€ä¸­ï¼Œå–æ¶ˆå‹¾é€‰â€œWindows 11 SDKâ€ï¼Œå¹¶å‹¾é€‰Windows 10 SDKï¼ˆå¦‚ç‰ˆæœ¬10.0.20348.0ï¼‰ï¼ˆWindows 11 SDKåœ¨Windows 10ç³»ç»Ÿä¸­å…¼å®¹æ€§æœªçŸ¥ï¼Œå¯èƒ½å¯¼è‡´ç¼–è¯‘å¤±è´¥ï¼‰ã€‚\n\n\né—®é¢˜2ï¼šé…ç½®VS Codeçš„C++ï¼ˆMSVCï¼‰ç¯å¢ƒæ—¶ï¼Œä¸ºä½•å¿…é¡»æ·»åŠ INCLUDEå’ŒLIBè¿™ä¸¤ä¸ªç³»ç»Ÿç¯å¢ƒå˜é‡ï¼Ÿå®ƒä»¬çš„è·¯å¾„ç”±å“ªäº›éƒ¨åˆ†æ„æˆï¼ˆä»¥2022ç‰ˆä¸ºä¾‹ï¼‰ï¼Ÿ\nç­”ï¼šï¼ˆ1ï¼‰æ·»åŠ åŸå› ï¼š\nINCLUDEå’ŒLIBæ˜¯MSVCç¼–è¯‘å™¨å’Œé“¾æ¥å™¨çš„æ ¸å¿ƒä¾èµ–å˜é‡â€”â€”INCLUDEç”¨äºå‘Šè¯‰ç¼–è¯‘å™¨å¤´æ–‡ä»¶ï¼ˆ.hï¼‰çš„æŸ¥æ‰¾è·¯å¾„ï¼Œç¡®ä¿ä»£ç ä¸­#include &lt;iostream&gt;ç­‰æŒ‡ä»¤èƒ½æ‰¾åˆ°å¯¹åº”æ–‡ä»¶ï¼›LIBç”¨äºå‘Šè¯‰é“¾æ¥å™¨åº“æ–‡ä»¶ï¼ˆ.libï¼‰çš„æŸ¥æ‰¾è·¯å¾„ï¼Œç¡®ä¿ç¼–è¯‘åçš„ç›®æ ‡æ–‡ä»¶èƒ½æ­£ç¡®é“¾æ¥ç³»ç»Ÿæˆ–ç¬¬ä¸‰æ–¹åº“ï¼Œé¿å…â€œæ— æ³•è§£æçš„å¤–éƒ¨ç¬¦å·â€ç­‰é”™è¯¯ã€‚\nï¼ˆ2ï¼‰è·¯å¾„æ„æˆï¼ˆä»¥2022ç‰ˆã€MSVCç‰ˆæœ¬14.37.32822ã€SDKç‰ˆæœ¬10.0.20348.0ä¸ºä¾‹ï¼‰ï¼š\n\n\nINCLUDEè·¯å¾„ï¼š%VCTools%\\MSVC\\%MSVC_VERSION%\\includeï¼ˆMSVCè‡ªå¸¦å¤´æ–‡ä»¶ï¼‰ + %WIN10KITS%\\Include\\%WIN_SDK_VERSION%\\ucrtï¼ˆSDKé€šç”¨CRTå¤´æ–‡ä»¶ï¼‰ + %WIN10KITS%\\Include\\%WIN_SDK_VERSION%\\umï¼ˆSDKç”¨æˆ·æ¨¡å¼å¤´æ–‡ä»¶ï¼‰ + %WIN10KITS%\\Include\\%WIN_SDK_VERSION%\\sharedï¼ˆSDKå…±äº«å¤´æ–‡ä»¶ï¼‰ï¼›\n\n\nLIBè·¯å¾„ï¼š%WIN10KITS%\\Lib\\%WIN_SDK_VERSION%\\um\\x64ï¼ˆSDKç”¨æˆ·æ¨¡å¼åº“æ–‡ä»¶ï¼Œx64æ¶æ„ï¼‰ + %WIN10KITS%\\Lib\\%WIN_SDK_VERSION%\\ucrt\\x64ï¼ˆSDKé€šç”¨CRTåº“æ–‡ä»¶ï¼Œx64æ¶æ„ï¼‰ + %VCTools%\\MSVC\\%MSVC_VERSION%\\lib\\x64ï¼ˆMSVCè‡ªå¸¦åº“æ–‡ä»¶ï¼Œx64æ¶æ„ï¼‰ã€‚\n\n\né—®é¢˜3ï¼šåœ¨VS Codeä¸­å®Œæˆç³»ç»Ÿç¯å¢ƒå˜é‡é…ç½®åï¼Œå¦‚ä½•é€šè¿‡å…·ä½“æ“ä½œç”Ÿæˆç¼–è¯‘æ‰€éœ€çš„é…ç½®æ–‡ä»¶ï¼Œå¹¶æˆåŠŸè¿è¡Œç¬¬ä¸€ä¸ªC++ç¨‹åºï¼Ÿ\nç­”ï¼šå…·ä½“æ­¥éª¤åˆ†3æ­¥ï¼š\n\n\nç”Ÿæˆé…ç½®æ–‡ä»¶ï¼š\n\nç”Ÿæˆc_cpp_properties.jsonï¼šæ‰“å¼€é¡¹ç›®ä¸­çš„hello.cppæ–‡ä»¶ï¼Œåœ¨VS Codeé¡¶éƒ¨æœç´¢æ¡†è¾“å…¥&gt; Edit Configurations (UI)ï¼Œç‚¹å‡»é«˜äº®é€‰é¡¹åç›´æ¥å…³é—­ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨åœ¨.vscodeæ–‡ä»¶å¤¹ä¸­ç”Ÿæˆè¯¥æ–‡ä»¶ï¼ˆé»˜è®¤é…ç½®ç¼–è¯‘å™¨è·¯å¾„ä¸ºcl.exeï¼Œé€‚é…MSVCï¼‰ï¼›\nç”Ÿæˆtasks.jsonï¼šåœ¨æœç´¢æ¡†è¾“å…¥&gt; Default Build Taskï¼Œé€‰æ‹©C/C++ cl.exe ç”Ÿæˆæ´»åŠ¨æ–‡ä»¶ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨ç”Ÿæˆè¯¥æ–‡ä»¶ï¼ˆåŒ…å«cl.exeçš„ç¼–è¯‘å‚æ•°ï¼Œå¦‚/Fe${fileDirname}\\\\${fileBasenameNoExtension}.exeï¼ŒæŒ‡å®šè¾“å‡ºexeè·¯å¾„ï¼‰ï¼›\n\n\n\nç¼–å†™æµ‹è¯•ä»£ç ï¼šåœ¨hello.cppä¸­å†™å…¥Hello Worldç¨‹åºï¼ˆéœ€åŒ…å«&lt;iostream&gt;å¤´æ–‡ä»¶ï¼Œä½¿ç”¨coutè¾“å‡ºï¼‰ï¼›\n\n\nè¿è¡Œç¨‹åºï¼š\n\nç‚¹å‡»VS Codeèœå•æ â€œè¿è¡Œâ€â†’â€œä»¥éè°ƒè¯•æ¨¡å¼è¿è¡Œâ€ï¼›\nåœ¨å¼¹å‡ºçš„è°ƒè¯•å™¨é€‰æ‹©æ¡†ä¸­ï¼Œé€‰æ‹©â€œC/C++ (Windows)â€ï¼›\næŸ¥çœ‹ç»“æœï¼šæ§åˆ¶å°è¾“å‡ºâ€œHello Worldâ€ï¼Œè¯´æ˜ç¨‹åºè¿è¡ŒæˆåŠŸï¼Œç¯å¢ƒé…ç½®å®Œæˆã€‚\n\n\n\n","categories":["ç¼–ç¨‹"],"tags":["å·¥å…·"]},{"title":"ä¸ä»mainå¼€å§‹æ‰§è¡ŒC++ç¨‹åº","url":"/2025/08/09/C++/%E5%A6%82%E4%BD%95%E8%AE%A9C++%E7%A8%8B%E5%BA%8F%E4%B8%8D%E4%BB%8Emain%E5%BC%80%E5%A7%8B%E6%89%A7%E8%A1%8C/","content":"\nåœ¨çœ‹è’‹ç‚ç‚è€å¸ˆçš„OSè¯¾åä¸€æ®µæ—¶é—´è®°å½•ä¸‹çš„æ“ä½œï¼Œè®°å¾—å½“æ—¶å®ç°äº†å¦ä¸€ç§ä½œæ³•ï¼Œä½†æœªåŠæ—¶è®°å½•ï¼Œç°åœ¨ä¹Ÿå¿˜äº†æ€ä¹ˆå¤åˆ»ğŸ˜…\n\n\nå¦‚ä½•è®©C/C++ç¨‹åºä¸ä»mainå¼€å§‹æ‰§è¡Œ\nä¸€ã€æ ¸å¿ƒæ“ä½œæ­¥éª¤ï¼ˆä»¥ GCC/G++ ä¸ºä¾‹ï¼‰\nä»¥test.cppä¸ºä¾‹ï¼Œä»£ç éœ€æ‰‹åŠ¨å®šä¹‰_startï¼ˆæ±‡ç¼–çº§å…¥å£ï¼Œéœ€å¤„ç†ç³»ç»Ÿè°ƒç”¨ï¼‰ï¼Œè€Œémainã€‚\n1. ç¼–å†™ç¤ºä¾‹ä»£ç \n_startæ˜¯ Linux å†…æ ¸è§„å®šçš„ç¨‹åºå…¥å£ï¼ˆELF æ–‡ä»¶æ ¼å¼å®šä¹‰ï¼‰ï¼Œéœ€ç”¨æ±‡ç¼–æˆ–å†…åµŒæ±‡ç¼–å®ç°ç³»ç»Ÿè°ƒç”¨ï¼ˆå¦‚exitï¼‰ï¼Œå¦åˆ™ç¨‹åºä¼šå´©æºƒã€‚\n// test.cppvoid _start() &#123;    // å†…åµŒæ±‡ç¼–ï¼šè°ƒç”¨Linuxç³»ç»Ÿè°ƒç”¨ exit(0)ï¼Œé¿å…ç¨‹åºå¼‚å¸¸é€€å‡º    asm volatile (        &quot;mov $60, %rax;&quot;  // ç³»ç»Ÿè°ƒç”¨å·ï¼š60å¯¹åº”exit        &quot;mov $0, %rdi;&quot;   // é€€å‡ºç ï¼š0ï¼ˆæˆåŠŸï¼‰        &quot;syscall;&quot;        // è§¦å‘ç³»ç»Ÿè°ƒç”¨    );&#125;\n2. ç¼–è¯‘ä¸é“¾æ¥å‚æ•°\nå…³é”®å‚æ•°ç”¨äºç¦ç”¨è‡ªåŠ¨é“¾æ¥çš„åˆå§‹åŒ–ä»£ç å’ŒæŒ‡å®šå…¥å£ç‚¹ï¼Œåˆ†ä¸¤æ­¥æ‰§è¡Œæˆ–åˆå¹¶ä¸ºä¸€æ¡å‘½ä»¤ï¼š\n\n\nåˆ†æ­¥æ‰§è¡Œï¼š\n\nç¼–è¯‘ä¸ºç›®æ ‡æ–‡ä»¶ï¼ˆä»…ç¼–è¯‘ï¼Œä¸é“¾æ¥ï¼‰ï¼šg++ -c test.cpp -o test.o\né“¾æ¥ä¸ºå¯æ‰§è¡Œæ–‡ä»¶ï¼ˆç¦ç”¨ libc å’Œ crt0ï¼‰ï¼šld -o test test.o -nostdlib -e _start\n\n\n\nåˆå¹¶æ‰§è¡Œï¼ˆæ›´ç®€æ´ï¼‰ï¼š\ng++ -o test test.cpp -nostdlib -e _start\n\n\ng++ test.cpp -nostartfiles -nostdlib -static -o test\n\n\n\n\n\nå‚æ•°\nä½œç”¨è¯´æ˜\n\n\n\n\n-nostdlib\nä¸é“¾æ¥ C æ ‡å‡†åº“ï¼ˆlibcï¼‰å’Œè¿è¡Œæ—¶åˆå§‹åŒ–ä»£ç ï¼ˆcrt0ã€crtbegin ç­‰ï¼‰ï¼Œè¿™æ˜¯æ ¸å¿ƒ\n\n\n-e _start\næ˜¾å¼æŒ‡å®šç¨‹åºå…¥å£ç‚¹ä¸º_startï¼ˆé»˜è®¤å…¥å£ç”± crt0 å®šä¹‰ï¼Œæœ€ç»ˆè°ƒç”¨mainï¼‰\n\n\n\näºŒã€å¿…é¡»æ³¨æ„çš„ 3 ä¸ªå…³é”®ç‚¹\n\n\nä¸èƒ½ä½¿ç”¨ä»»ä½• C++/C æ ‡å‡†åº“åŠŸèƒ½\nç”±äº-nostdlibç¦ç”¨äº† libcï¼Œcoutã€printfã€newã€mallocã€stringç­‰æ‰€æœ‰ä¾èµ–æ ‡å‡†åº“çš„ä»£ç éƒ½ä¼šç¼–è¯‘å¤±è´¥ï¼Œç”šè‡³returnè¯­å¥ä¹Ÿæ— æ•ˆï¼ˆéœ€æ‰‹åŠ¨è°ƒç”¨ç³»ç»Ÿè°ƒç”¨é€€å‡ºï¼‰ã€‚\n\n\nå¿…é¡»æ‰‹åŠ¨å¤„ç†ç¨‹åºé€€å‡º\nå†…æ ¸è¦æ±‚ç¨‹åºé€šè¿‡ç³»ç»Ÿè°ƒç”¨ï¼ˆå¦‚exitï¼‰ç»ˆæ­¢ï¼Œè‹¥_startæ‰§è¡Œå®Œç›´æ¥è¿”å›ï¼Œä¼šè§¦å‘å†…æ ¸å¼‚å¸¸ï¼ˆæ®µé”™è¯¯ï¼‰ã€‚ç¤ºä¾‹ä¸­é€šè¿‡å†…åµŒæ±‡ç¼–è°ƒç”¨exit(0)ï¼Œæ˜¯å”¯ä¸€æ­£ç¡®çš„é€€å‡ºæ–¹å¼ã€‚\n\n\nC++ çš„ â€œé«˜çº§ç‰¹æ€§â€ å¤±æ•ˆ\næ²¡æœ‰è¿è¡Œæ—¶åˆå§‹åŒ–ä»£ç ï¼ˆcrt0ï¼‰ï¼ŒC++ çš„å…¨å±€å¯¹è±¡æ„é€  / ææ„ã€è™šå‡½æ•°è¡¨åˆå§‹åŒ–ã€å¼‚å¸¸å¤„ç†ï¼ˆtry/catchï¼‰ç­‰åŠŸèƒ½å…¨éƒ¨æ— æ³•å·¥ä½œï¼Œä»£ç æœ¬è´¨é€€åŒ–ä¸º â€œç”¨ C++ è¯­æ³•å†™çš„æ±‡ç¼–çº§ç¨‹åºâ€ã€‚\n\n\nä¸‰ã€èƒŒåçš„åº•å±‚åŸç†\næ ¸å¿ƒæ˜¯æ­å¼€ â€œmain å‡½æ•°æ˜¯å…¥å£â€ çš„å‡è±¡ï¼Œç†è§£ç¨‹åºä»å†…æ ¸åŠ è½½åˆ°æ‰§è¡Œmainçš„å®Œæ•´é“¾è·¯ï¼š\n\n\nå†…æ ¸åŠ è½½ç¨‹åºæ—¶çš„å…¥å£æ˜¯_start\nLinux ä¸‹å¯æ‰§è¡Œæ–‡ä»¶ä¸º ELF æ ¼å¼ï¼ŒELF å¤´ä¸­ä¼šè®°å½• â€œç¨‹åºå…¥å£åœ°å€â€ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œé“¾æ¥å™¨ä¼šå°†å…¥å£åœ°å€è®¾ä¸ºcrt0.oï¼ˆC è¿è¡Œæ—¶åˆå§‹åŒ–æ–‡ä»¶ï¼‰ä¸­çš„_startç¬¦å·ï¼Œè¿™æ˜¯å†…æ ¸æ‰§è¡Œçš„ç¬¬ä¸€ä¸ªå‡½æ•°ï¼Œè€Œémainã€‚\n\n\nmainæ˜¯è¢«crt0è°ƒç”¨çš„ â€œç”¨æˆ·çº§å…¥å£â€\né»˜è®¤æµç¨‹ï¼ˆæœªç¦ç”¨Â [1] æ—¶ï¼‰ï¼šå†…æ ¸åŠ è½½â†’æ‰§è¡Œcrt0çš„_startâ†’åˆå§‹åŒ–libcï¼ˆå †ã€å…¨å±€å˜é‡ã€I/Oç­‰ï¼‰â†’è°ƒç”¨mainâ†’mainè¿”å›åè°ƒç”¨exitâ†’ç¨‹åºç»ˆæ­¢\nå¯è§ï¼Œmainæ˜¯ crt0 ä¸ºç”¨æˆ·ä»£ç æä¾›çš„ â€œå°è£…å…¥å£â€ï¼Œè€Œéå†…æ ¸ç›´æ¥è°ƒç”¨çš„å…¥å£ã€‚\n\n\n-nostdlibå’Œ-e _startçš„æœ¬è´¨\n\n-nostdlibå»æ‰äº† crt0 è¿™ä¸ª â€œä¸­é—´å±‚â€ï¼Œè®©ç¨‹åºç›´æ¥å¯¹æ¥å†…æ ¸ï¼›\n-e _startå‘Šè¯‰é“¾æ¥å™¨ï¼šâ€œä¸ç”¨ crt0 çš„_start äº†ï¼Œç”¨æˆ‘è‡ªå·±å®šä¹‰çš„_start ä½œä¸º ELF å…¥å£â€ã€‚\n\n\n\n\nè¿™ç§æ“ä½œçš„æœ¬è´¨æ˜¯è·³è¿‡ C/C++ è¿è¡Œæ—¶çš„å°è£…ï¼Œç›´æ¥ä¸æ“ä½œç³»ç»Ÿå†…æ ¸äº¤äº’ï¼Œå®ƒæš´éœ²äº†ç¨‹åºæ‰§è¡Œçš„åº•å±‚çœŸç›¸ï¼šå†…æ ¸åªè®¤ ELF å¤´æŒ‡å®šçš„å…¥å£ï¼ˆé»˜è®¤_startï¼‰ï¼Œmainåªæ˜¯è¿è¡Œæ—¶åº“ä¸ºå¼€å‘è€…æä¾›çš„ä¾¿æ·æ¥å£\n\n\n\n\ncrt0ï¼ˆC Runtime Zeroï¼‰æ˜¯C/C++ ç¨‹åºè¿è¡Œæ—¶çš„ â€œåˆå§‹åŒ–å¯åŠ¨ä»£ç â€ï¼Œæ˜¯è¿æ¥æ“ä½œç³»ç»Ÿå†…æ ¸ä¸ç”¨æˆ·ä»£ç ï¼ˆå¦‚mainå‡½æ•°ï¼‰çš„å…³é”®ä¸­é—´å±‚ï¼Œé»˜è®¤ç”±ç¼–è¯‘å™¨å·¥å…·é“¾ï¼ˆå¦‚ GCCï¼‰è‡ªåŠ¨é“¾æ¥ï¼Œå¼€å‘è€…é€šå¸¸æ„ŸçŸ¥ä¸åˆ°å®ƒçš„å­˜åœ¨ã€‚ â†©ï¸\n\n\n\n","categories":["ç¼–ç¨‹"],"tags":["C++"]},{"title":"å››å…ƒå¼:æ“ä½œç¬¦ä¸è¡¨ç¤ºæ–¹æ³•","url":"/2025/10/20/compiler_principle/%E5%9B%9B%E5%85%83%E5%BC%8F/","content":"\nå››å…ƒå¼æ“ä½œç¬¦çš„ç§ç±»ä¸å¯¹åº”è¡¨ç¤ºæ–¹æ³•\n\n\nå››å…ƒå¼ï¼šæ“ä½œç¬¦ä¸è¡¨ç¤ºæ–¹æ³•\nå››å…ƒå¼åŸºæœ¬æ¦‚å¿µ\nå››å…ƒå¼æ˜¯ç¼–è¯‘è¿‡ç¨‹ä¸­ä½¿ç”¨çš„ä¸€ç§ä¸­é—´ä»£ç å½¢å¼ï¼Œå®ƒå°†ä»£ç åˆ†è§£ä¸ºä¸€ç³»åˆ—åŸºæœ¬æ“ä½œï¼Œæ¯ä¸ªæ“ä½œç”±å››ä¸ªéƒ¨åˆ†ç»„æˆï¼š\n(æ“ä½œç¬¦, æ“ä½œæ•°1, æ“ä½œæ•°2, ç»“æœ)\nè¿™ç§ç»“æ„ç±»ä¼¼äºæ±‡ç¼–è¯­è¨€ï¼Œä¾¿äºåç»­çš„ä»£ç ä¼˜åŒ–å’Œç›®æ ‡ä»£ç ç”Ÿæˆã€‚\nå››å…ƒå¼æ“ä½œç¬¦åˆ†ç±»\n1. ç®—æœ¯è¿ç®—æ“ä½œç¬¦\nç”¨äºæ‰§è¡ŒåŸºæœ¬çš„æ•°å­¦è¿ç®—ï¼š\n\n\n\næ“ä½œç¬¦\nå«ä¹‰\nç¤ºä¾‹\nè¯´æ˜\n\n\n\n\n+\nåŠ æ³•\n(+, a, b, t1)\nt1 = a + b\n\n\n-\nå‡æ³•\n(-, a, b, t1)\nt1 = a - b\n\n\n*\nä¹˜æ³•\n(*, a, b, t1)\nt1 = a * b\n\n\n/\né™¤æ³•\n(/, a, b, t1)\nt1 = a / b\n\n\n%\nå–æ¨¡\n(%, a, b, t1)\nt1 = a % b\n\n\nU-\nä¸€å…ƒè´Ÿå·\n(U-, a, null, t1)\nt1 = -a\n\n\n\n2. å…³ç³»è¿ç®—æ“ä½œç¬¦\nç”¨äºæ¯”è¾ƒä¸¤ä¸ªå€¼ï¼Œç»“æœé€šå¸¸æ˜¯å¸ƒå°”å€¼ï¼ˆ0æˆ–1ï¼‰ï¼š\n\n\n\næ“ä½œç¬¦\nå«ä¹‰\nç¤ºä¾‹\nè¯´æ˜\n\n\n\n\n&gt;\nå¤§äº\n(&gt;, a, b, t1)\nt1 = (a &gt; b) ? 1 : 0\n\n\n&lt;\nå°äº\n(&lt;, a, b, t1)\nt1 = (a &lt; b) ? 1 : 0\n\n\n&gt;=\nå¤§äºç­‰äº\n(&gt;=, a, b, t1)\nt1 = (a &gt;= b) ? 1 : 0\n\n\n&lt;=\nå°äºç­‰äº\n(&lt;=, a, b, t1)\nt1 = (a &lt;= b) ? 1 : 0\n\n\n==\nç­‰äº\n(==, a, b, t1)\nt1 = (a == b) ? 1 : 0\n\n\n!=\nä¸ç­‰äº\n(!=, a, b, t1)\nt1 = (a != b) ? 1 : 0\n\n\n\n3. é€»è¾‘è¿ç®—æ“ä½œç¬¦\nç”¨äºæ‰§è¡Œå¸ƒå°”é€»è¾‘è¿ç®—ï¼š\n\n\n\næ“ä½œç¬¦\nå«ä¹‰\nç¤ºä¾‹\nè¯´æ˜\n\n\n\n\n&amp;&amp;\né€»è¾‘ä¸\n(&amp;&amp;, a, b, t1)\nt1 = a &amp;&amp; b\n\n\n||\né€»è¾‘æˆ–\n`(\n\n\n\n!\né€»è¾‘é\n(!, a, null, t1)\nt1 = !a\n\n\n\n4. èµ‹å€¼æ“ä½œç¬¦\nç”¨äºå°†å€¼èµ‹ç»™å˜é‡ï¼š\n\n\n\næ“ä½œç¬¦\nå«ä¹‰\nç¤ºä¾‹\nè¯´æ˜\n\n\n\n\n=\nèµ‹å€¼\n(=, a, null, b)\nb = a\n\n\n\n5. æ§åˆ¶æµæ“ä½œç¬¦\nç”¨äºæ§åˆ¶ç¨‹åºçš„æ‰§è¡Œé¡ºåºï¼š\n\n\n\næ“ä½œç¬¦\nå«ä¹‰\nç¤ºä¾‹\nè¯´æ˜\n\n\n\n\njmp\næ— æ¡ä»¶è·³è½¬\n(jmp, null, null, L1)\nè·³è½¬åˆ°æ ‡ç­¾L1\n\n\njnz\néé›¶è·³è½¬\n(jnz, a, null, L1)\nå¦‚æœaâ‰ 0ï¼Œè·³è½¬åˆ°L1\n\n\njz\né›¶è·³è½¬\n(jz, a, null, L1)\nå¦‚æœa=0ï¼Œè·³è½¬åˆ°L1\n\n\nje\nç­‰äºè·³è½¬\n(je, a, b, L1)\nå¦‚æœa==bï¼Œè·³è½¬åˆ°L1\n\n\njne\nä¸ç­‰äºè·³è½¬\n(jne, a, b, L1)\nå¦‚æœa!=bï¼Œè·³è½¬åˆ°L1\n\n\njg\nå¤§äºè·³è½¬\n(jg, a, b, L1)\nå¦‚æœa&gt;bï¼Œè·³è½¬åˆ°L1\n\n\njl\nå°äºè·³è½¬\n(jl, a, b, L1)\nå¦‚æœa&lt;bï¼Œè·³è½¬åˆ°L1\n\n\njge\nå¤§äºç­‰äºè·³è½¬\n(jge, a, b, L1)\nå¦‚æœa&gt;=bï¼Œè·³è½¬åˆ°L1\n\n\njle\nå°äºç­‰äºè·³è½¬\n(jle, a, b, L1)\nå¦‚æœa&lt;=bï¼Œè·³è½¬åˆ°L1\n\n\n\n6. å‡½æ•°è°ƒç”¨æ“ä½œç¬¦\nç”¨äºå‡½æ•°çš„è°ƒç”¨å’Œè¿”å›ï¼š\n\n\n\næ“ä½œç¬¦\nå«ä¹‰\nç¤ºä¾‹\nè¯´æ˜\n\n\n\n\nparam\nå‚æ•°ä¼ é€’\n(param, a, null, null)\nå°†aä½œä¸ºå‚æ•°ä¼ é€’\n\n\ncall\nå‡½æ•°è°ƒç”¨\n(call, func, null, t1)\nè°ƒç”¨å‡½æ•°funcï¼Œç»“æœå­˜t1\n\n\nret\nè¿”å›\n(ret, a, null, null)\nä»å‡½æ•°è¿”å›açš„å€¼\n\n\n\n7. æ•°ç»„æ“ä½œç¬¦\nç”¨äºæ•°ç»„å…ƒç´ çš„è®¿é—®ï¼š\n\n\n\næ“ä½œç¬¦\nå«ä¹‰\nç¤ºä¾‹\nè¯´æ˜\n\n\n\n\n[]\næ•°ç»„è®¿é—®\n([], arr, i, t1)\nt1 = arr[i]\n\n\n[]=\næ•°ç»„èµ‹å€¼\n([]=, arr, i, val)\narr[i] = val\n\n\n\n8. å…¶ä»–æ“ä½œç¬¦\n\n\n\næ“ä½œç¬¦\nå«ä¹‰\nç¤ºä¾‹\nè¯´æ˜\n\n\n\n\nlabel\næ ‡ç­¾å®šä¹‰\n(label, null, null, L1)\nå®šä¹‰æ ‡ç­¾L1\n\n\nread\nè¯»æ“ä½œ\n(read, null, null, a)\nä»è¾“å…¥è¯»å–å€¼åˆ°a\n\n\nwrite\nå†™æ“ä½œ\n(write, a, null, null)\nå°†açš„å€¼è¾“å‡º\n\n\n\nä¸åŒæƒ…å†µçš„è¡¨ç¤ºæ–¹æ³•ç¤ºä¾‹\n1. è¡¨è¾¾å¼è®¡ç®—\nå¯¹äºè¡¨è¾¾å¼ x = (a + b) * c - dï¼š\n(+, a, b, t1)      ; t1 = a + b(*, t1, c, t2)     ; t2 = t1 * c(-, t2, d, t3)     ; t3 = t2 - d(=, t3, null, x)   ; x = t3\n2. æ¡ä»¶è¯­å¥\nå¯¹äº if (a &gt; b) then x = 1 else x = 0ï¼š\n(&gt;, a, b, t1)      ; t1 = (a &gt; b) ? 1 : 0(jz, t1, null, L1) ; å¦‚æœt1=0ï¼Œè·³è½¬åˆ°L1(=, 1, null, x)    ; x = 1(jmp, null, null, L2) ; è·³è½¬åˆ°L2(label, null, null, L1) ; æ ‡ç­¾L1(=, 0, null, x)    ; x = 0(label, null, null, L2) ; æ ‡ç­¾L2\n3. å¾ªç¯è¯­å¥\nå¯¹äº while (i &lt; 10) { i = i + 1; }ï¼š\n(label, null, null, L1) ; å¾ªç¯å¼€å§‹æ ‡ç­¾(&lt;, i, 10, t1)     ; t1 = (i &lt; 10) ? 1 : 0(jz, t1, null, L2) ; å¦‚æœi&gt;=10ï¼Œé€€å‡ºå¾ªç¯(+, i, 1, t2)      ; t2 = i + 1(=, t2, null, i)   ; i = t2(jmp, null, null, L1) ; è·³å›å¾ªç¯å¼€å§‹(label, null, null, L2) ; å¾ªç¯ç»“æŸæ ‡ç­¾\n4. å‡½æ•°è°ƒç”¨\nå¯¹äº y = func(a, b)ï¼š\n(param, a, null, null) ; ä¼ é€’ç¬¬ä¸€ä¸ªå‚æ•°a(param, b, null, null) ; ä¼ é€’ç¬¬äºŒä¸ªå‚æ•°b(call, func, null, y)  ; è°ƒç”¨å‡½æ•°funcï¼Œç»“æœå­˜åˆ°y\n","categories":["ç¼–è¯‘åŸç†"]},{"title":"æ–‡æ³•ä¸è¯­è¨€","url":"/2025/10/20/compiler_principle/%E6%96%87%E6%B3%95%E4%B8%8E%E8%AF%AD%E8%A8%80/","content":"\nç¼–è¯‘åŸç†æ–‡æ³•è¯­è¨€çš„ç›¸å…³æ¦‚å¿µ\n\n\næ–‡æ³•ä¸è¯­è¨€\n2.1 å¼•è¨€ï¼šæ–‡æ³•çš„â€œç¼–è¯‘è§’è‰²â€\næ–‡æ³•æ˜¯ç¼–è¯‘è¿‡ç¨‹â€œè¯­æ³•åˆ†æé˜¶æ®µâ€çš„å½¢å¼åŒ–å·¥å…·ï¼Œæ ¸å¿ƒä½œç”¨æ˜¯å°†â€œè‡ªç„¶è¯­è¨€å¼çš„è¯­æ³•è§„åˆ™â€è½¬åŒ–ä¸ºâ€œæœºå™¨å¯æ¨å¯¼çš„ä¸¥æ ¼è§„åˆ™â€ã€‚\n\n\nç¼–è¯‘æµç¨‹ä¸­ï¼Œè¯æ³•åˆ†æå¤„ç†â€œæ­£åˆ™æ–‡æ³•ï¼ˆ3å‹ï¼‰â€ï¼ˆæè¿°æ ‡è¯†ç¬¦ã€å…³é”®å­—ç­‰è¯æ³•å•å…ƒçš„æ¨¡å¼ï¼‰ï¼›è¯­æ³•åˆ†æå¤„ç†â€œä¸Šä¸‹æ–‡æ— å…³æ–‡æ³•ï¼ˆ2å‹ï¼‰â€ï¼ˆæè¿°è¡¨è¾¾å¼ã€è¯­å¥ç­‰è¯­æ³•ç»“æ„ï¼‰ã€‚\n\n\nç¨‹åºè®¾è®¡è¯­è¨€éœ€â€œæ— æ­§ä¹‰â€ï¼šè‹¥è¯­æ³•å­˜åœ¨æ­§ä¹‰ï¼ˆå¦‚â€œid+id*idæœ‰ä¸¤ç§è§£é‡Šâ€ï¼‰ï¼Œç¼–è¯‘å™¨æ— æ³•ç¡®å®šä»£ç çš„é€»è¾‘ç»“æ„ï¼Œå› æ­¤å¿…é¡»ç”¨â€œå½¢å¼åŒ–æ–‡æ³•â€ä¸¥æ ¼çº¦æŸè¯­æ³•ã€‚\n\n\n2.2 å­—æ¯è¡¨-ç¬¦å·ä¸²-è¿ç®—ï¼ˆå½¢å¼è¯­è¨€åŸºç¡€ï¼‰\nè¿™æ˜¯â€œç”¨æ•°å­¦ç¬¦å·æè¿°è¯­è¨€â€çš„åº•å±‚é€»è¾‘ï¼Œéœ€æ˜ç¡®é›†åˆã€åºåˆ—ã€è¿ç®—çš„å½¢å¼åŒ–å®šä¹‰ï¼š\nï¼ˆ1ï¼‰å­—æ¯è¡¨ï¼ˆÎ£ï¼‰\n\n\nå®šä¹‰ï¼šéç©ºæœ‰é™çš„ç¬¦å·é›†åˆã€‚ä¾‹ï¼šÎ£â‚ = {0, 1}ï¼ˆäºŒè¿›åˆ¶å­—æ¯è¡¨ï¼‰ï¼›Î£â‚‚ = {a, b, ..., z}ï¼ˆå°å†™å­—æ¯è¡¨ï¼‰ï¼›Î£â‚ƒ = {id, +, *, (, )}ï¼ˆæŸç®—æœ¯è¡¨è¾¾å¼çš„ç»ˆç»“ç¬¦é›†åˆï¼‰ã€‚\n\n\nï¼ˆ2ï¼‰ç¬¦å·ä¸²ï¼ˆStringï¼‰\n\n\nå®šä¹‰ï¼šè®¾Î£ä¸ºå­—æ¯è¡¨ï¼Œç¬¦å·ä¸²xæ˜¯Î£ä¸­ç¬¦å·çš„æœ‰é™åºåˆ—ã€‚\n\né•¿åº¦ï¼š|x|è¡¨ç¤ºç¬¦å·ä¸²çš„ç¬¦å·ä¸ªæ•°ã€‚ä¾‹ï¼šx = abcï¼Œåˆ™|x| = 3ï¼›\nç©ºä¸²ï¼šÎµï¼ˆé•¿åº¦ä¸º0çš„ç¬¦å·ä¸²ï¼Œ|Îµ| = 0ï¼‰ã€‚\n\n\n\nï¼ˆ3ï¼‰ç¬¦å·ä¸²çš„è¿ç®—\n\n\nè¿æ¥ï¼ˆConcatenationï¼‰ï¼šè‹¥x = &quot;ab&quot;ï¼Œy = &quot;cd&quot;ï¼Œåˆ™xÂ·y = &quot;abcd&quot;ï¼ˆç®€è®°ä¸ºxyï¼‰ã€‚æ€§è´¨ï¼šä¸æ»¡è¶³äº¤æ¢å¾‹ï¼ˆxy â‰  yxï¼Œé™¤éx=yæˆ–ç‰¹æ®Šæ„é€ ï¼‰ã€‚\n\n\nå¹‚ï¼ˆPowerï¼‰ï¼š\n\nxâ° = Îµï¼ˆç©ºä¸²ï¼‰ï¼›\nxÂ¹ = xï¼›\nxâ¿ = xâ¿â»Â¹ Â· xï¼ˆé€’å½’å®šä¹‰ï¼Œä¾‹ï¼šx=&quot;ab&quot;ï¼Œåˆ™xÂ²=&quot;abab&quot;ï¼‰ã€‚\n\n\n\né—­åŒ…ï¼ˆClosureï¼‰ï¼š\n\næ˜Ÿé—­åŒ…ï¼ˆÎ£*ï¼‰ï¼šÎ£ä¸­ç¬¦å·ç»„æˆçš„**æ‰€æœ‰å¯èƒ½çš„ç¬¦å·ä¸²ï¼ˆå«ç©ºä¸²Îµï¼‰**çš„é›†åˆã€‚ä¾‹ï¼šÎ£ = {a, b}ï¼Œåˆ™Î£* = {Îµ, a, b, aa, ab, ba, bb, aaa, ...}ã€‚\næ­£é—­åŒ…ï¼ˆÎ£+ï¼‰ï¼šÎ£ä¸­ç¬¦å·ç»„æˆçš„æ‰€æœ‰éç©ºç¬¦å·ä¸²çš„é›†åˆï¼ˆå³Î£* - {Îµ}ï¼‰ã€‚ä¾‹ï¼šÎ£ = {a, b}ï¼Œåˆ™Î£+ = {a, b, aa, ab, ba, bb, ...}ã€‚\n\n\n\n2.3 æ–‡æ³•æ¨¡å‹â˜…ï¼ˆå½¢å¼åŒ–å››å…ƒç»„ï¼‰\næ–‡æ³•æ˜¯æè¿°è¯­è¨€è¯­æ³•çš„å››å…ƒç»„ G = (VN, VT, P, S)ï¼Œå„ç»„ä»¶éœ€ç»“åˆâ€œç®—æœ¯è¡¨è¾¾å¼æ–‡æ³•â€å®ä¾‹ç†è§£ï¼š\nï¼ˆ1ï¼‰éç»ˆç»“ç¬¦ï¼ˆVNï¼šNon-terminal Symbolsï¼‰\n\n\nå®šä¹‰ï¼šè¯­æ³•å˜é‡ï¼Œè¡¨ç¤ºâ€œè¯­æ³•èŒƒç•´/ä¸­é—´æ¨å¯¼ç»“æœâ€ï¼Œæœ€ç»ˆä¸ä¼šå‡ºç°åœ¨â€œè¯­è¨€çš„å¥å­â€ä¸­ã€‚\n\n\nä¾‹ï¼šæè¿°â€œç®—æœ¯è¡¨è¾¾å¼â€çš„æ–‡æ³•ä¸­ï¼ŒV_N = {E, T, F}ï¼ˆEè¡¨ç¤ºâ€œè¡¨è¾¾å¼â€ï¼ŒTè¡¨ç¤ºâ€œé¡¹â€ï¼ŒFè¡¨ç¤ºâ€œå› å­â€ï¼‰ã€‚\n\n\nï¼ˆ2ï¼‰ç»ˆç»“ç¬¦ï¼ˆVTï¼šTerminal Symbolsï¼‰\n\n\nå®šä¹‰ï¼šè¯­æ³•çš„æœ€å°å•ä½ï¼Œæ˜¯è¯­è¨€çš„â€œæœ€ç»ˆç¬¦å·â€ï¼Œæ— æ³•å†è¢«æ¨å¯¼åˆ†è§£ã€‚\n\n\nä¾‹ï¼šç®—æœ¯è¡¨è¾¾å¼æ–‡æ³•ä¸­ï¼ŒV_T = {id, +, *, (, )}ï¼ˆidä¸ºæ ‡è¯†ç¬¦ï¼Œ+/*ä¸ºè¿ç®—ç¬¦ï¼Œ()ä¸ºæ‹¬å·ï¼‰ã€‚\n\n\nï¼ˆ3ï¼‰äº§ç”Ÿå¼ï¼ˆPï¼šProductionsï¼‰\n\n\nå½¢å¼ï¼šÎ± â†’ Î²ï¼ˆè¯»ä½œâ€œÎ±å®šä¹‰ä¸ºÎ²â€ï¼‰ï¼Œè¡¨ç¤ºâ€œç”¨Î²æ›¿æ¢Î±â€ã€‚\n\nÎ±ï¼ˆå·¦éƒ¨ï¼‰ï¼šè‡³å°‘åŒ…å«ä¸€ä¸ªéç»ˆç»“ç¬¦ï¼ˆå¦åˆ™æ— æ³•æ¨å¯¼ï¼‰ï¼›\nÎ²ï¼ˆå³éƒ¨ï¼‰ï¼šå¯ç”±â€œç»ˆç»“ç¬¦ã€éç»ˆç»“ç¬¦çš„ä»»æ„ç»„åˆâ€æˆ–ç©ºä¸²Îµç»„æˆã€‚\n\n\n\nä¾‹ï¼šç®—æœ¯è¡¨è¾¾å¼çš„æ ¸å¿ƒäº§ç”Ÿå¼ï¼š\n\nE â†’ E + Tï¼ˆâ€œè¡¨è¾¾å¼å¯ä»¥æ˜¯â€˜è¡¨è¾¾å¼ + é¡¹â€™â€ï¼‰ï¼›\nT â†’ T * Fï¼ˆâ€œé¡¹å¯ä»¥æ˜¯â€˜é¡¹ * å› å­â€™â€ï¼‰ï¼›\nF â†’ (E)ï¼ˆâ€œå› å­å¯ä»¥æ˜¯â€˜æ‹¬å·ä¸­çš„è¡¨è¾¾å¼â€™â€ï¼‰ï¼›\nF â†’ idï¼ˆâ€œå› å­å¯ä»¥æ˜¯â€˜æ ‡è¯†ç¬¦â€™â€ï¼‰ã€‚\n\n\n\nï¼ˆ4ï¼‰å¼€å§‹ç¬¦å·ï¼ˆSï¼šStart Symbolï¼‰\n\n\nå®šä¹‰ï¼šV_Nä¸­æŒ‡å®šçš„â€œèµ·å§‹è¯­æ³•å˜é‡â€ï¼Œæ‰€æœ‰æ¨å¯¼ä»Så¼€å§‹ã€‚\n\n\nä¾‹ï¼šç®—æœ¯è¡¨è¾¾å¼æ–‡æ³•ä¸­ï¼ŒS = Eï¼ˆæ¨å¯¼ä»â€œè¡¨è¾¾å¼Eâ€å¼€å§‹ï¼‰ã€‚\n\n\n2.4 æ¨å¯¼ä¸å¥å‹ï¼ˆæ–‡æ³•çš„â€œåŠ¨æ€æ¨å¯¼è¿‡ç¨‹â€ï¼‰\næ¨å¯¼æ˜¯â€œä»å¼€å§‹ç¬¦å·å‡ºå‘ï¼Œç”¨äº§ç”Ÿå¼é€æ­¥æ›¿æ¢éç»ˆç»“ç¬¦â€çš„è¿‡ç¨‹ï¼›å¥å‹å’Œå¥å­æ˜¯æ¨å¯¼çš„â€œä¸­é—´/æœ€ç»ˆç»“æœâ€ï¼Œéœ€ç”¨æ¨å¯¼ç¬¦å·ï¼ˆâ‡’ã€â‡’*ã€â‡’+ï¼‰å½¢å¼åŒ–æè¿°ï¼š\nï¼ˆ1ï¼‰æ¨å¯¼ç¬¦å·\n\n\nÎ± â‡’ Î²ï¼šä¸€æ­¥æ¨å¯¼ï¼ˆç”¨ä¸€æ¡äº§ç”Ÿå¼ï¼Œå°†Î±ä¸­çš„æŸéƒ¨åˆ†æ›¿æ¢ä¸ºÎ²ï¼‰ï¼›\n\n\nÎ± â‡’* Î²ï¼šé›¶æ­¥æˆ–å¤šæ­¥æ¨å¯¼ï¼ˆÎ±å¯ç›´æ¥ç­‰äºÎ²ï¼Œæˆ–ç»è‹¥å¹²æ­¥æ¨å¯¼å¾—åˆ°Î²ï¼‰ï¼›\n\n\nÎ± â‡’+ Î²ï¼šä¸€æ­¥æˆ–å¤šæ­¥æ¨å¯¼ï¼ˆÎ±ç»è‡³å°‘ä¸€æ­¥æ¨å¯¼å¾—åˆ°Î²ï¼‰ã€‚\n\n\nï¼ˆ2ï¼‰æ¨å¯¼ç±»å‹\n\n\næœ€å·¦æ¨å¯¼ï¼šæ¯æ¬¡ä¼˜å…ˆæ›¿æ¢â€œæœ€å·¦ä¾§â€çš„éç»ˆç»“ç¬¦ï¼›\n\n\næœ€å³æ¨å¯¼ï¼ˆè§„èŒƒæ¨å¯¼ï¼‰ï¼šæ¯æ¬¡ä¼˜å…ˆæ›¿æ¢â€œæœ€å³ä¾§â€çš„éç»ˆç»“ç¬¦ï¼ˆç¼–è¯‘ä¸­â€œè¯­æ³•åˆ†æâ€çš„æ ¸å¿ƒæ–¹å¼ï¼Œå¯¹åº”â€œè§„èŒƒå½’çº¦â€ï¼‰ã€‚\n\n\nï¼ˆ3ï¼‰å¥å‹ä¸å¥å­\n\n\nå¥å‹ï¼šè‹¥S â‡’* Î±ä¸”Î± âˆˆ (V_N âˆª V_T)*ï¼ˆÎ±å«ç»ˆç»“ç¬¦æˆ–éç»ˆç»“ç¬¦ï¼‰ï¼Œåˆ™Î±æ˜¯å¥å‹ï¼›\n\n\nå¥å­ï¼šè‹¥S â‡’* Î±ä¸”Î± âˆˆ V_T*ï¼ˆÎ±ä»…å«ç»ˆç»“ç¬¦ï¼‰ï¼Œåˆ™Î±æ˜¯å¥å­ï¼ˆè¯­è¨€çš„â€œåˆæ³•æœ€ç»ˆå½¢å¼â€ï¼‰ã€‚\n\n\nå®ä¾‹ï¼šç®—æœ¯è¡¨è¾¾å¼çš„æœ€å·¦æ¨å¯¼\næ–‡æ³•ï¼šE â†’ E+T | Tï¼›T â†’ T*F | Fï¼›F â†’ (E) | idã€‚æ¨å¯¼å¥å­id+id*idçš„æœ€å·¦æ¨å¯¼è¿‡ç¨‹ï¼š\n\n\nE â‡’ E+Tï¼ˆç”¨Eâ†’E+Tï¼Œæ›¿æ¢æœ€å·¦çš„Eï¼‰ï¼›\n\n\nT+T â‡’ F+Tï¼ˆç”¨Tâ†’Fï¼Œæ›¿æ¢æœ€å·¦çš„Tï¼‰ï¼›\n\n\nid+T â‡’ id+T*Fï¼ˆç”¨Tâ†’T*Fï¼Œæ›¿æ¢æœ€å·¦çš„Tï¼‰ï¼›\n\n\nid+F*F â‡’ id+id*Fï¼ˆç”¨Fâ†’idï¼Œæ›¿æ¢æœ€å·¦çš„Fï¼‰ï¼›\n\n\nid+id*idï¼ˆç”¨Fâ†’idï¼Œæ›¿æ¢æœ€å·¦çš„Fï¼‰ã€‚\n\n\n\n\nä¸­é—´ç»“æœå¦‚E+Tã€T+Tã€id+Tã€id+T*Fã€id+F*Fã€id+id*Féƒ½æ˜¯å¥å‹ï¼ˆå«éç»ˆç»“ç¬¦ï¼‰ï¼›\n\n\næœ€ç»ˆç»“æœid+id*idæ˜¯å¥å­ï¼ˆä»…å«ç»ˆç»“ç¬¦ï¼‰ã€‚\n\n\n2.5 æ–‡æ³•çš„ç±»å‹ï¼ˆä¹”å§†æ–¯åŸºåˆ†ç±»ï¼‰\nä¹”å§†æ–¯åŸºå°†æ–‡æ³•åˆ†ä¸º4ç±»ï¼ˆé™åˆ¶é€æ¸ä¸¥æ ¼ï¼Œå‘ˆâ€œåŒ…å«å…³ç³»ï¼š3å‹ âŠ‚ 2å‹ âŠ‚ 1å‹ âŠ‚ 0å‹â€ï¼‰ï¼Œæ ¸å¿ƒåŒºåˆ«æ˜¯â€œäº§ç”Ÿå¼çš„é™åˆ¶è§„åˆ™â€ï¼Œéœ€ç»“åˆè‡ªåŠ¨æœºã€è¯­è¨€ç±»å‹è”åŠ¨ç†è§£ï¼š\n\n\n\næ–‡æ³•ç±»å‹\nåˆ«ç§°\näº§ç”Ÿå¼é™åˆ¶\nç”Ÿæˆçš„è¯­è¨€\nå¯¹åº”è‡ªåŠ¨æœº\nç¼–è¯‘ä¸­çš„åº”ç”¨\n\n\n\n\n0å‹ï¼ˆæ— é™åˆ¶ï¼‰\nçŸ­è¯­ç»“æ„æ–‡æ³•ï¼ˆPSGï¼‰\nÎ±â†’Î²ï¼Œå…¶ä¸­Î±è‡³å°‘å«ä¸€ä¸ªéç»ˆç»“ç¬¦ï¼ŒÎ²ä¸º(V_NâˆªV_T)*ä¸­ä»»æ„ä¸²ï¼ˆå¯å«Îµï¼‰\né€’å½’å¯æšä¸¾è¯­è¨€\nå›¾çµæœº\nç†è®ºåŸºç¡€ï¼Œæ— ç›´æ¥ç¼–è¯‘åº”ç”¨\n\n\n1å‹ï¼ˆä¸Šä¸‹æ–‡æœ‰å…³ï¼‰\nä¸Šä¸‹æ–‡æœ‰å…³æ–‡æ³•ï¼ˆCSGï¼‰\nÎ±â†’Î²æ»¡è¶³`\nÎ±\nâ‰¤\nÎ²\n\n\n2å‹ï¼ˆä¸Šä¸‹æ–‡æ— å…³ï¼‰\nä¸Šä¸‹æ–‡æ— å…³æ–‡æ³•ï¼ˆCFGï¼‰\näº§ç”Ÿå¼å·¦éƒ¨ä¸ºå•ä¸ªéç»ˆç»“ç¬¦ï¼ˆå³Aâ†’Î²ï¼ŒAâˆˆV_Nï¼ŒÎ²âˆˆ(V_NâˆªV_T)*ï¼‰\nä¸Šä¸‹æ–‡æ— å…³è¯­è¨€\nä¸‹æ¨è‡ªåŠ¨æœºï¼ˆPDAï¼‰\næè¿°ç¨‹åºè®¾è®¡è¯­è¨€çš„è¯­æ³•æ ¸å¿ƒï¼ˆå¦‚è¡¨è¾¾å¼ã€è¯­å¥ã€å‡½æ•°å®šä¹‰ï¼‰\n\n\n3å‹ï¼ˆæ­£åˆ™æ–‡æ³•ï¼‰\næ­£åˆ™æ–‡æ³•ï¼ˆRGï¼‰\näº§ç”Ÿå¼ä¸ºå·¦çº¿æ€§ï¼ˆAâ†’Ba æˆ– Aâ†’aï¼‰æˆ–å³çº¿æ€§ï¼ˆAâ†’aB æˆ– Aâ†’aï¼‰ï¼Œå…¶ä¸­A,BâˆˆV_Nï¼ŒaâˆˆV_Tâˆª{Îµ} å³ä¾§æœ€å¤šä¸€ä¸ªéç»ˆç»“ç¬¦ä¸”å¿…é¡»åœ¨æœ€å·¦æˆ–æœ€å³\næ­£åˆ™è¯­è¨€\næœ‰é™è‡ªåŠ¨æœºï¼ˆFAï¼‰\næè¿°è¯æ³•è§„åˆ™ï¼ˆå¦‚æ ‡è¯†ç¬¦ã€å…³é”®å­—ã€å¸¸æ•°çš„æ¨¡å¼ï¼‰\n\n\n\n2.6 æ–‡æ³•çš„æ„é€ ä¸ç®€åŒ–â˜…\nï¼ˆ1ï¼‰æ–‡æ³•æ„é€ ï¼šâ€œè‡ªç„¶è¯­è¨€â†’äº§ç”Ÿå¼â€çš„è½¬åŒ–\néœ€å°†â€œè¯­æ³•è§„åˆ™çš„è‡ªç„¶æè¿°â€è½¬åŒ–ä¸ºâ€œå½¢å¼åŒ–äº§ç”Ÿå¼â€ï¼Œæ ¸å¿ƒæ˜¯è®¾è®¡éç»ˆç»“ç¬¦åŒæ­¥è¯­æ³•ç»“æ„ã€‚\n\n\nä¾‹1ï¼šæ„é€ è¯­è¨€ L = {aâ¿bâ¿ | nâ‰¥1}ï¼ˆâ€œnä¸ªaåè·Ÿnä¸ªbâ€çš„æ‰€æœ‰ä¸²ï¼‰çš„æ–‡æ³•ã€‚æ€è·¯ï¼šç”¨éç»ˆç»“ç¬¦SåŒæ­¥aå’Œbçš„æ•°é‡ï¼Œäº§ç”Ÿå¼éœ€ä¿è¯â€œæ¯ç”Ÿæˆä¸€ä¸ªaï¼Œå°±å¯¹åº”ç”Ÿæˆä¸€ä¸ªbâ€ã€‚æ–‡æ³•ï¼šG = ({S}, {a, b}, {Sâ†’aSb | ab}, S)ã€‚æ¨å¯¼éªŒè¯ï¼šn=1æ—¶ï¼ŒSâ‡’abï¼›n=2æ—¶ï¼ŒSâ‡’aSbâ‡’aabbbï¼Œç¬¦åˆaâ¿bâ¿ã€‚\n\n\nä¾‹2ï¼šæ„é€ â€œä»¥å­—æ¯å¼€å¤´ï¼Œåè·Ÿå­—æ¯æˆ–æ•°å­—â€çš„æ ‡è¯†ç¬¦æ–‡æ³•ã€‚æ€è·¯ï¼šç”¨Iè¡¨ç¤ºâ€œæ ‡è¯†ç¬¦â€ï¼ŒLè¡¨ç¤ºâ€œå­—æ¯â€ï¼ŒDè¡¨ç¤ºâ€œæ•°å­—â€ï¼Œé€šè¿‡äº§ç”Ÿå¼ä¸²è”ç»“æ„ã€‚æ–‡æ³•ï¼šG = ({I, L, D}, {a,...,z,0,...,9}, {Iâ†’LI | L, Lâ†’LI | LD | L | D}, I)ï¼ˆLå¯æ¨å¯¼ä¸ºå­—æ¯æˆ–æ•°å­—ï¼ŒIä»¥Lå¼€å¤´ï¼Œåè·ŸLæˆ–Dï¼‰ã€‚\n\n\nï¼ˆ2ï¼‰æ–‡æ³•ç®€åŒ–ï¼šæ¶ˆé™¤å†—ä½™ï¼Œä¾¿äºåˆ†æ\néœ€æ¶ˆé™¤æ— ç”¨ç¬¦å·ã€Îµäº§ç”Ÿå¼ã€å•äº§ç”Ÿå¼ï¼Œä½¿æ–‡æ³•æ›´ç®€æ´ã€‚\n\n\næ¶ˆé™¤æ— ç”¨ç¬¦å·ï¼šæ— ç”¨ç¬¦å·åŒ…æ‹¬â€œä¸å¯è¾¾ç¬¦å·â€ï¼ˆä»Sæ¨å¯¼ä¸å‡ºçš„ç¬¦å·ï¼‰å’Œâ€œä¸å¯ç»ˆæ­¢ç¬¦å·â€ï¼ˆæ— æ³•æ¨å¯¼å‡ºç»ˆç»“ç¬¦ä¸²çš„ç¬¦å·ï¼‰ã€‚ä¾‹ï¼šæ–‡æ³•G = ({S, A, B, C}, {a, b}, {Sâ†’aA, Aâ†’bB, Bâ†’aA, Câ†’aB}, S)ã€‚\n\nâ€œä¸å¯è¾¾ç¬¦å·â€ï¼šCï¼ˆSæ— æ³•æ¨å¯¼å‡ºCï¼‰ï¼Œéœ€åˆ é™¤å«Cçš„äº§ç”Ÿå¼ï¼›\nç®€åŒ–åæ–‡æ³•ï¼šG' = ({S, A, B}, {a, b}, {Sâ†’aA, Aâ†’bB, Bâ†’aA}, S)ã€‚\n\n\n\næ¶ˆé™¤Îµäº§ç”Ÿå¼ï¼šè‹¥äº§ç”Ÿå¼å«Aâ†’Îµï¼ˆAéå¼€å§‹ç¬¦å·ï¼‰ï¼Œéœ€å°†å…¶ä»–äº§ç”Ÿå¼ä¸­Açš„å‡ºç°æ›¿æ¢ä¸ºÎµçš„å¯èƒ½ã€‚ä¾‹ï¼šæ–‡æ³•G = ({S, A}, {a, b}, {Sâ†’aA | Îµ, Aâ†’b | Îµ}, S)ã€‚\n\nå› Aâ†’Îµï¼ŒSâ†’aAå¯æ¨å¯¼å‡ºSâ†’aï¼ˆå½“Aâ†’Îµæ—¶ï¼‰ï¼›\nç®€åŒ–åæ–‡æ³•ï¼šG' = ({S, A}, {a, b}, {Sâ†’aA | a | Îµ, Aâ†’b}, S)ã€‚\n\n\n\næ¶ˆé™¤å•äº§ç”Ÿå¼ï¼ˆå½¢å¦‚Aâ†’Bï¼ŒA,BâˆˆV_Nï¼‰ï¼šéœ€å°†Açš„äº§ç”Ÿå¼æ›¿æ¢ä¸ºBçš„æ‰€æœ‰â€œéå•äº§ç”Ÿå¼â€ã€‚ä¾‹ï¼šæ–‡æ³•G = ({S, A, B}, {a, b}, {Sâ†’A, Aâ†’B | a, Bâ†’b | A}, S)ã€‚\n\nSâ†’Aç­‰ä»·äºSâ†’B | aï¼ˆå› Aâ†’B | aï¼‰ï¼›\nAâ†’Bç­‰ä»·äºAâ†’b | aï¼ˆå› Bâ†’b | Aï¼Œä½†Aâ†’Aæ˜¯æ— ç”¨å¾ªç¯ï¼Œæœ€ç»ˆä¿ç•™Aâ†’b | aï¼‰ï¼›\nç®€åŒ–åæ–‡æ³•ï¼šG' = ({S, A, B}, {a, b}, {Sâ†’B | a, Aâ†’b | a, Bâ†’b | a}, S)ã€‚\n\n\n\n2.7 è¯­æ³•æ ‘ï¼ˆæ¨å¯¼çš„â€œå¯è§†åŒ–è¡¨ç¤ºâ€ï¼‰\nè¯­æ³•æ ‘ï¼ˆæ¨å¯¼æ ‘ï¼‰æ˜¯ç›´è§‚å±•ç¤ºæ¨å¯¼å±‚æ¬¡ç»“æ„çš„æ ‘ç»“æ„ï¼Œå„èŠ‚ç‚¹ä¸æ–‡æ³•ç»„ä»¶ä¸€ä¸€å¯¹åº”ï¼š\n\n\næ ¹èŠ‚ç‚¹ï¼šå¼€å§‹ç¬¦å·Sï¼›\n\n\nå†…éƒ¨èŠ‚ç‚¹ï¼šéç»ˆç»“ç¬¦ï¼ˆå¯¹åº”äº§ç”Ÿå¼å·¦éƒ¨ï¼‰ï¼›\n\n\nå¶èŠ‚ç‚¹ï¼šç»ˆç»“ç¬¦æˆ–ç©ºä¸²Îµï¼ˆå¯¹åº”äº§ç”Ÿå¼å³éƒ¨çš„ç¬¦å·ï¼‰ã€‚\n\n\nå®ä¾‹ï¼šè¡¨è¾¾å¼id+id*idçš„è¯­æ³•æ ‘\nåŸºäºæ–‡æ³•Eâ†’E+T | Tï¼›Tâ†’T*F | Fï¼›Fâ†’(E) | idï¼Œè¯­æ³•æ ‘ç»“æ„ä¸ºï¼š\ngraph TD    E --&gt; E1[E]    E --&gt; op_plus[+]    E --&gt; T1[T]    E1 --&gt; T2[T]    T2 --&gt; F1[F]    F1 --&gt; id1[id]    T1 --&gt; T3[T]    T1 --&gt; op_mul[*]    T1 --&gt; F2[F]    T3 --&gt; F3[F]    F3 --&gt; id2[id]    F2 --&gt; id3[id]\nè¯­æ³•æ ‘çš„ä½œç”¨ï¼š\n\n\nç›´è§‚å±•ç¤ºâ€œè¯­æ³•å±‚æ¬¡â€ï¼ˆå¦‚â€œä¹˜æ³•å…ˆäºåŠ æ³•â€çš„ç»“æ„ï¼‰ï¼›\n\n\nåˆ¤æ–­æ–‡æ³•äºŒä¹‰æ€§ï¼ˆè‹¥ä¸€ä¸ªå¥å­å¯¹åº”å¤šæ£µè¯­æ³•æ ‘ï¼Œæ–‡æ³•æ˜¯äºŒä¹‰çš„ï¼‰ã€‚\n\n\n2.8 æ–‡æ³•çš„äºŒä¹‰æ€§ï¼ˆå…³é”®é—®é¢˜ä¸è§£å†³ï¼‰\nè‹¥ä¸€ä¸ªæ–‡æ³•å­˜åœ¨æŸä¸ªå¥å­æœ‰â€œå¤šæ£µè¯­æ³•æ ‘â€æˆ–â€œå¤šç§æœ€å·¦/æœ€å³æ¨å¯¼â€ï¼Œåˆ™ç§°è¯¥æ–‡æ³•æ˜¯äºŒä¹‰çš„ã€‚\nï¼ˆ1ï¼‰äºŒä¹‰æ€§å®ä¾‹ï¼šè¡¨è¾¾å¼æ–‡æ³•\næ–‡æ³•G = ({E}, {id, +, *, (, )}, {Eâ†’E+E | E*E | (E) | id}, E)å¯¹å¥å­id+id*idå­˜åœ¨ä¸¤ç§æœ€å·¦æ¨å¯¼ï¼š\n\n\næ¨å¯¼1ï¼ˆå…ˆåŠ åä¹˜ï¼‰ï¼šE â‡’ E+E â‡’ id+E â‡’ id+E*E â‡’ id+id*E â‡’ id+id*idã€‚\n\n\næ¨å¯¼2ï¼ˆå…ˆä¹˜ååŠ ï¼‰ï¼šE â‡’ E*E â‡’ E+E*E â‡’ id+E*E â‡’ id+id*E â‡’ id+id*idã€‚\n\n\nå¯¹åº”çš„ä¸¤æ£µè¯­æ³•æ ‘ä¹Ÿä¸åŒï¼Œå› æ­¤è¯¥æ–‡æ³•æ˜¯äºŒä¹‰çš„ã€‚\nï¼ˆ2ï¼‰æ¶ˆé™¤äºŒä¹‰æ€§ï¼šæ”¹å†™æ–‡æ³•ï¼ˆè§„å®šä¼˜å…ˆçº§/ç»“åˆæ€§ï¼‰\né€šè¿‡â€œåˆ†å±‚äº§ç”Ÿå¼â€è®©äº§ç”Ÿå¼éšå«â€œè¿ç®—ç¬¦ä¼˜å…ˆçº§/ç»“åˆæ€§â€ï¼Œä»è€Œæ¶ˆé™¤æ­§ä¹‰ã€‚\nä¾‹ï¼šè§„å®šâ€œ*ä¼˜å…ˆçº§é«˜äº+ï¼Œä¸”å‡ä¸ºå·¦ç»“åˆâ€ï¼Œæ”¹å†™æ–‡æ³•ä¸ºï¼š\nE â†’ E+T | T       ï¼ˆ`+`å·¦ç»“åˆï¼Œä¼˜å…ˆçº§ä½äº`*`ï¼‰T â†’ T*F | F       ï¼ˆ`*`å·¦ç»“åˆï¼Œä¼˜å…ˆçº§é«˜äº`+`ï¼‰F â†’ (E) | id      ï¼ˆæœ€åº•å±‚å› å­ï¼‰\næ­¤æ—¶ï¼Œå¥å­id+id*idçš„æœ€å·¦æ¨å¯¼å”¯ä¸€ï¼šE â‡’ E+T â‡’ T+T â‡’ F+T â‡’ id+T â‡’ id+T*F â‡’ id+F*F â‡’ id+id*F â‡’ id+id*idï¼Œä¸”ä»…å¯¹åº”ä¸€æ£µè¯­æ³•æ ‘ï¼Œæ¶ˆé™¤äº†äºŒä¹‰æ€§ã€‚\n","categories":["ç¼–è¯‘åŸç†"]},{"title":"MySQL åŸºç¡€æŒ‡ä»¤","url":"/2024/06/12/db_note/MySQL-%E5%9F%BA%E7%A1%80%E6%8C%87%E4%BB%A4/","content":"\nä»‹ç»äº†MySQLä¸€äº›åŸºç¡€æŒ‡ä»¤,å¢åˆ æ”¹æŸ¥\n\n\nMySQL\nå‡†å¤‡å·¥ä½œ\n\n\næ·»åŠ ç¯å¢ƒå˜é‡\n\n\nåˆå§‹åŒ–MySQL\nmysqld --initialize-insecure\nè¯¥å‘½ä»¤åœ¨å®‰å…¨æ€§æ–¹é¢å­˜åœ¨ç¼ºé™·ï¼Œä¸»è¦ç”¨äºå¼€å‘å’Œæµ‹è¯•ç¯å¢ƒ\n\n\næ³¨å†ŒMySQLæœåŠ¡\nmysqld -install\n\n\nå¯åŠ¨/åœæ­¢ MySQLæœåŠ¡\nnet start mysqlnet stop mysql\n\n\nä¿®æ”¹é»˜è®¤è´¦æˆ·å¯†ç \nmysqladmin -u root password xxxx\n\n\nç™»å½•MySQL\nmysql -uroot -pxxxx [-hæ•°æ®åº“æœåŠ¡å™¨IPåœ°å€ -Pç«¯å£å·]\n\n\nå¸è½½MySQL\nnet stop mysqlmysqld -remove mysql\n\n\nSQLåˆ†ç±»\n\n\nDDL:Data Definition Language      å®šä¹‰æ•°æ®åº“å¯¹è±¡\n\n\nDML :Data Manipulation Language   æ“ä½œæ•°æ®ï¼Œè¿›è¡Œå¢åˆ æ”¹\n\n\nDQL:Data Query Language                  æŸ¥è¯¢æ•°æ®åº“ä¸­çš„è®°å½•\n\n\nDCL:Data Control Language                åˆ›å»ºæ•°æ®åº“çš„ç”¨æˆ·ï¼Œæ§åˆ¶è®¿é—®æƒé™\n\n\nåŸºç¡€è¯­æ³•\n\nä»¥åˆ†å·ç»“å°¾ï¼Œä¸åŒºåˆ†å¤§å°å†™\n\nDDL\n\n\næŸ¥è¯¢æ•°æ®åº“\n\n\nshow databases;\n\n\nåˆ›å»ºæ•°æ®åº“\n\n\ncreate database filename;create database if not exists filename; #å¦‚æœä¸å­˜åœ¨åä¸ºfilenameçš„æ•°æ®åº“å°±è¿›è¡Œåˆ›å»º\n\n\nåˆ‡æ¢æ•°æ®åº“\n\n\nuse filename;\n\n\næŸ¥çœ‹å½“å‰æ­£åœ¨ä½¿ç”¨çš„æ•°æ®åº“\n\n\nselect database();\n\n\nåˆ é™¤æ•°æ®åº“\n\n\ndrop database filename;drop database if exists filename;\nè¡¨æ“ä½œ\ncreate table è¡¨å(\t\tå­—æ®µ1 å­—æ®µç±»å‹ [çº¦æŸ] [comment å­—æ®µ1æ³¨è§£],    \tå­—æ®µ2 å­—æ®µç±»å‹ [çº¦æŸ] [comment å­—æ®µ2æ³¨è§£])[comment è¡¨æ³¨è§£];\n\n\n\nçº¦æŸ\næè¿°\nå…³é”®å­—\n\n\n\n\néç©ºçº¦æŸ\né™åˆ¶è¯¥å­—æ®µå€¼ä¸èƒ½ä¸ºnull\nnot null\n\n\nå”¯ä¸€çº¦æŸ\nä¿è¯å­—æ®µçš„æ‰€æœ‰æ•°æ®éƒ½æ˜¯å”¯ä¸€çš„\nunique\n\n\nä¸»é”®çº¦æŸ\nä¸»é”®æ˜¯ä¸€è¡Œæ•°æ®çš„å”¯ä¸€æ ‡è¯†ï¼Œè¦æ±‚éç©ºä¸”å”¯ä¸€\nprimary key    ï¼ˆauto_incrementè‡ªå¢ï¼‰\n\n\né»˜è®¤çº¦æŸ\nä¿å­˜æ•°æ®æ—¶ï¼Œå¦‚æœæœªæŒ‡å®šè¯¥å­—æ®µå€¼ï¼Œåˆ™é‡‡ç”¨é»˜è®¤å€¼\ndefault\n\n\nå¤–é”®çº¦æŸ\nè®©ä¸¤å¼ è¡¨çš„æ•°æ®å»ºç«‹è¿æ¥ï¼Œä¿è¯æ•°æ®çš„ä¸€è‡´æ€§å’Œå®Œæ•´æ€§\nforeign key\n\n\n\ncreat table tb_user(\tid int primary key auto_increment comment &#x27;IDï¼Œå”¯ä¸€æ ‡è¯†&#x27;,    username varchar(20) not null unique comment &#x27;ç”¨æˆ·å&#x27;,    name varchar(10) not null comment &#x27;å§“å&#x27;,    age int comment &#x27;å¹´é¾„&#x27;,    gender char(1) default &#x27;ç”·&#x27; comment &#x27;æ€§åˆ«&#x27;)comment &#x27;ç”¨æˆ·è¡¨&#x27;\n\n\næŸ¥è¯¢\n\n\n-- æŸ¥çœ‹å½“ä¸‹æ•°æ®åº“çš„è¡¨show tables;-- æŸ¥çœ‹æŒ‡å®šè¡¨ç»“æ„desc tablename;--  æŸ¥çœ‹æ•°æ®åº“çš„å»ºè¡¨è¯­å¥show create table tablename;\n\n\nä¿®æ”¹\n\n\n-- ä¸ºè¡¨example æ·»åŠ å­—æ®µ qq varchar(11)alter table example add qq varchar(11) comment &#x27;QQ&#x27;;-- ä¿®æ”¹example å­—æ®µç±»å‹ qq varchar(13)alter table example modify qq varchar(13) comment &#x27;QQ&#x27;;-- ä¿®æ”¹example å­—æ®µåqqä¸ºqq_numalter table example change qq qq_num varchar(13) comment &#x27;QQ&#x27;;-- åˆ é™¤qq_numå­—æ®µalter table example drop column qq_num;-- å°†example è¡¨åä¿®æ”¹ä¸ºhellorename table example to hello;\n\n\nåˆ é™¤\n\n\n-- åˆ é™¤ example è¡¨drop table if exists eample;\nDML\n\n\ninsertè¯­å¥\n\n\n--  ä¸º example è¡¨çš„ usernameï¼Œnameï¼Œgender å­—æ®µæ’å…¥å€¼insert into example(username, name, gender) values (&#x27;tinali&#x27;,&#x27; æçº³é‡Œ&#x27;,1);-- ä¸º example è¡¨çš„ æ‰€æœ‰å­—æ®µ æ’å…¥å€¼insert into example values(null,null,null,&#x27;tinali&#x27;,&#x27; æçº³é‡Œ&#x27;,1);-- æ‰¹é‡ä¸º example è¡¨çš„ usernameï¼Œnameï¼Œgenderå­—æ®µæ’å…¥æ•°æ®insert into example(username, name, gender) values (&#x27;tinali&#x27;,&#x27;æçº³é‡Œ&#x27;,1),(&#x27;å®¡åˆ¤å®˜&#x27;,&#x27;é‚£ç»´è±ç‰¹&#x27;,1);\n\n\nupdateè¯­å¥\n\n\n-- å°† example ä¸­IDä¸º1çš„ name å­—æ®µ æ›´æ–°ä¸º å¼ ä¸‰,username å­—æ®µæ›´æ–°ä¸º helloupdate example set name = &#x27;å¼ ä¸‰&#x27;, username = &#x27;hello&#x27; where id = 1;-- å°†example ä¸­æ‰€æœ‰ gender å­—æ®µæ”¹ä¸º 1update example set gender = 1;\n\n\ndeleteè¯­å¥\n\n\ndelete from è¡¨å [where æ¡ä»¶];-- åˆ é™¤ example ä¸­IDä¸º1çš„ä¿¡æ¯delete from example where id = 1;-- åˆ é™¤è¡¨ä¸­æ‰€æœ‰ä¿¡æ¯delete from example;\nDQL\n\n\nåŸºæœ¬æŸ¥è¯¢\n\n\n-- æŸ¥è¯¢ç‰¹å®šå­—æ®µ nameï¼Œentrydate å¹¶è¿”å›select name,entrydate from example;-- æŸ¥è¯¢è¿”å›æ‰€æœ‰å­—æ®µ (é€šé…ç¬¦)select * from example;-- æŸ¥è¯¢ç‰¹å®šå­—æ®µ nameï¼Œentrydate å¹¶èµ·åˆ«åselect name as å§“å,entrydate as å…¥èŒæ—¥æœŸ from example;-- æŸ¥è¯¢jobå­—æ®µçš„è®°å½•ï¼ˆä¸é‡å¤ï¼‰select distinct job from example;\n\n\næ¡ä»¶æŸ¥è¯¢ï¼ˆwhereï¼‰\n\n\n-- select å­—æ®µåˆ—è¡¨ from è¡¨å where æ¡ä»¶åˆ—è¡¨-- æŸ¥è¯¢ name ä¸º ä¸‰å­æ›° çš„è®°å½•select * from example where name = &#x27;ä¸‰å­æ›°&#x27;;-- æŸ¥è¯¢ id å°äºç­‰äº5 çš„è®°å½•select * from example where id &lt;= 5;-- æŸ¥è¯¢ job ä¸ºç©ºå€¼çš„è®°å½•select * from example where job is null;-- æŸ¥è¯¢ job éç©ºå€¼çš„è®°å½•select * from example where job is not null;-- æŸ¥è¯¢ password ä¸æ˜¯ 123456select * from example where password != &#x27;123456&#x27;;-- æŸ¥è¯¢ age åœ¨ 20 åˆ° 30 ä¹‹é—´çš„è®°å½•select * from example where age &gt;= 20 &amp;&amp; age &lt;= 30;-- æŸ¥è¯¢id ä¸º1ï¼Œ2ï¼Œ3çš„è®°å½•select * from example where id in (1,2,3)l;-- æŸ¥è¯¢ name ä¸ºä¸¤ä¸ªå­—çš„è®°å½• ï¼ˆä¸¤æ¡ä¸‹åˆ’çº¿ï¼‰select * from example where name like &#x27;__&#x27;;-- æŸ¥è¯¢ name å­—æ®µä¸­ç¬¬ä¸€ä¸ªå­—ä¸º å¼  çš„è®°å½•select * from example where name like &#x27;å¼ %&#x27;_å¯æ›¿ä»£ä¸€ä¸ªå­—ç¬¦  %å¯æ›¿ä»£éšæœºæ•°ç›®çš„å­—ç¬¦\n\n\nåˆ†ç»„æŸ¥è¯¢ï¼ˆgroud byï¼‰\n\nèšåˆå‡½æ•° count max min avg sum\n\n\n\n-- select èšåˆå‡½æ•° from è¡¨å -- ç»Ÿè®¡ id å­—æ®µæ•°çš„æ•°ç›®select count(id) from example;\n-- select å­—æ®µåˆ—è¡¨ from è¡¨å [where æ¡ä»¶] group by åˆ†ç»„å­—æ®µå[having åˆ†ç»„åçš„è¿‡æ»¤çš„æ¡ä»¶];-- æ ¹æ® gender åˆ†ç»„ï¼Œç»Ÿè®¡ç”·å¥³å‘˜å·¥çš„æ•°é‡select gender,count(*) from example group by gender;-- æŸ¥è¯¢ age åœ¨30ï¼ˆåŒ…å«ï¼‰ä»¥å‰çš„å‘˜å·¥ï¼Œå¹¶å¯¹jobè¿›è¡Œåˆ†ç»„ï¼Œè·å¾—æ•°é‡å¤§äºç­‰äº2çš„jobæ•°æ®select job,count(*) from example where age &lt;= 30 group by job having count(*) &gt;= 2;\n\n\næ’åºæŸ¥è¯¢ï¼ˆorder byï¼‰\n\n\n--select å­—æ®µåˆ—è¡¨ from è¡¨å [where æ¡ä»¶åˆ—è¡¨][group by åˆ†ç»„å­—æ®µ] order by å­—æ®µ1 æ’åºæ–¹æ³•1--æ ¹æ®å¹´é¾„è¿›è¡Œå‡åºæ’åº  (é™åºdesc)select * from example order by age asc;\n\n\nåˆ†é¡µæŸ¥è¯¢ï¼ˆlimitï¼‰\n\n\n-- select å­—æ®µåˆ—è¡¨ from è¡¨å limit èµ·å§‹ç´¢å¼•ï¼ŒæŸ¥è¯¢è®°å½•æ•°;-- ä» èµ·å§‹ç´¢å¼•ä¸º0ï¼Œå¼€å§‹æŸ¥è¯¢ï¼Œæ¯å¤œå±•ç¤ºäº”æ¡æ•°æ®select * from example limit 0,5;-- æŸ¥è¯¢ç¬¬ä¸€é¡µæ•°æ®ï¼Œæ¯é¡µå±•ç¤ºäº”æ¡æ•°æ®select * from example limit 0,5;-- æŸ¥è¯¢ç¬¬äºŒï¼Œæ¯é¡µå±•ç¤ºäº”æ¡æ•°æ®select * from example limit 5,5;\n","categories":["ç¼–ç¨‹"],"tags":["MySQL"]},{"title":"C++/Linux åˆ›å»ºdaemonè¿›ç¨‹","url":"/2025/08/15/linux/C++Linux%20%E5%88%9B%E5%BB%BAdaemon%E8%BF%9B%E7%A8%8B/","content":"å¦‚ä½•ä½¿ç”¨ C++ åœ¨ Linux ç¯å¢ƒä¸‹åˆ›å»ºä¸€ä¸ªå®ˆæŠ¤è¿›ç¨‹\n\nåœ¨ Linux ç¯å¢ƒä¸‹ï¼Œå®ˆæŠ¤è¿›ç¨‹æ˜¯ä¸€ç§åœ¨åå°è¿è¡Œï¼Œä¸ä¸ä»»ä½•ç»ˆç«¯å…³è”ï¼Œç‹¬ç«‹äºæ§åˆ¶ç»ˆç«¯å¹¶ä¸”å‘¨æœŸæ€§æ‰§è¡Œä»»åŠ¡æˆ–ç­‰å¾…å¤„ç†æŸäº›äº‹ä»¶çš„è¿›ç¨‹ã€‚ä»¥ä¸‹æ˜¯ä½¿ç”¨ C++ ç¼–å†™å°†ä¸€ä¸ªè¿›ç¨‹è½¬æ¢ä¸ºå®ˆæŠ¤è¿›ç¨‹çš„ç¤ºä¾‹ä»£ç ï¼Œå¹¶å¯¹å…³é”®æ­¥éª¤è¿›è¡Œè§£é‡Šï¼š\n#include &lt;iostream&gt;#include &lt;unistd.h&gt;#include &lt;sys/types.h&gt;#include &lt;sys/stat.h&gt;#include &lt;fcntl.h&gt;#include &lt;cstdlib&gt;#include &lt;cerrno&gt;// å‡½æ•°ç”¨äºå°†å½“å‰è¿›ç¨‹è½¬æ¢ä¸ºå®ˆæŠ¤è¿›ç¨‹bool daemonize() &#123;    // ç¬¬ä¸€æ­¥ï¼šåˆ›å»ºå­è¿›ç¨‹ï¼Œçˆ¶è¿›ç¨‹é€€å‡º    pid_t pid = fork();    if (pid &lt; 0) &#123;        std::cerr &lt;&lt; &quot;fork error: &quot; &lt;&lt; errno &lt;&lt; std::endl;        return false;    &#125; else if (pid &gt; 0) &#123;        // çˆ¶è¿›ç¨‹ç›´æ¥é€€å‡ºï¼Œè®©å­è¿›ç¨‹ç»§ç»­æ‰§è¡Œ        exit(EXIT_SUCCESS);    &#125;    // æ­¤æ—¶å­è¿›ç¨‹æˆä¸ºæ–°çš„ä¼šè¯ç»„é•¿å’Œè¿›ç¨‹ç»„é•¿    // ç¬¬äºŒæ­¥ï¼šåˆ›å»ºæ–°ä¼šè¯    pid = setsid();    if (pid &lt; 0) &#123;        std::cerr &lt;&lt; &quot;setsid error: &quot; &lt;&lt; errno &lt;&lt; std::endl;        return false;    &#125;    // ç¬¬ä¸‰æ­¥ï¼šæ”¹å˜å·¥ä½œç›®å½•    if (chdir(&quot;/&quot;) &lt; 0) &#123;        std::cerr &lt;&lt; &quot;chdir error: &quot; &lt;&lt; errno &lt;&lt; std::endl;        return false;    &#125;    // ç¬¬å››æ­¥ï¼šè®¾ç½®æ–‡ä»¶æƒé™æ©ç     umask(0);    // ç¬¬äº”æ­¥ï¼šå…³é—­æ ‡å‡†è¾“å…¥ã€è¾“å‡ºå’Œé”™è¯¯è¾“å‡ºï¼Œå¹¶é‡æ–°å®šå‘åˆ°/dev/null    close(STDIN_FILENO);    int fd = open(&quot;/dev/null&quot;, O_RDWR);    if (fd != STDIN_FILENO) &#123;        return false;    &#125;    if (dup2(fd, STDOUT_FILENO) != STDOUT_FILENO) &#123;        return false;    &#125;    if (dup2(fd, STDERR_FILENO) != STDERR_FILENO) &#123;        return false;    &#125;    if (fd &gt; STDERR_FILENO) &#123;        close(fd);    &#125;    return true;&#125;int main() &#123;    if (daemonize()) &#123;        std::cout &lt;&lt; &quot;Process has been daemonized successfully.&quot; &lt;&lt; std::endl;        // è¿™é‡Œå¯ä»¥ç¼–å†™å®ˆæŠ¤è¿›ç¨‹çš„å…·ä½“ä»»åŠ¡é€»è¾‘ï¼Œæ¯”å¦‚å®šæ—¶æ‰§è¡ŒæŸäº›æ“ä½œ        while (true) &#123;            // æ¨¡æ‹Ÿå®ˆæŠ¤è¿›ç¨‹æ‰§è¡Œä»»åŠ¡ï¼Œè¿™é‡Œç®€å•ç¡çœ 10ç§’            sleep(10);            std::cout &lt;&lt; &quot;Daemon is working...&quot; &lt;&lt; std::endl;        &#125;    &#125; else &#123;        std::cerr &lt;&lt; &quot;Failed to daemonize the process.&quot; &lt;&lt; std::endl;    &#125;    return 0;&#125;\nä»£ç è§£é‡Š\n\n\nåˆ›å»ºå­è¿›ç¨‹å¹¶é€€å‡ºçˆ¶è¿›ç¨‹ï¼šä½¿ç”¨ fork() å‡½æ•°åˆ›å»ºä¸€ä¸ªå­è¿›ç¨‹ã€‚çˆ¶è¿›ç¨‹è°ƒç”¨ exit(EXIT_SUCCESS) é€€å‡ºï¼Œè¿™æ ·å­è¿›ç¨‹å°±ä¸å†æ˜¯æ§åˆ¶ç»ˆç«¯çš„å‰å°è¿›ç¨‹ï¼Œå¹¶ä¸”å¯ä»¥é¿å…åœ¨çˆ¶è¿›ç¨‹é€€å‡ºæ—¶ï¼Œå­è¿›ç¨‹æˆä¸ºå­¤å„¿è¿›ç¨‹è€Œè¢« init è¿›ç¨‹æ”¶å…»å¹¶å—åˆ°ä¸å¿…è¦çš„ç»ˆç«¯æ§åˆ¶ã€‚\n\n\nåˆ›å»ºæ–°ä¼šè¯ï¼šè°ƒç”¨ setsid() å‡½æ•°ï¼Œä½¿å­è¿›ç¨‹æˆä¸ºæ–°ä¼šè¯çš„ç»„é•¿ï¼ŒåŒæ—¶ä¹Ÿæ˜¯æ–°è¿›ç¨‹ç»„çš„ç»„é•¿ã€‚è¿™æ ·åšå¯ä»¥è®©å®ˆæŠ¤è¿›ç¨‹è„±ç¦»åŸä¼šè¯çš„æ§åˆ¶ï¼Œå¹¶ä¸”ä¸å†æœ‰æ§åˆ¶ç»ˆç«¯ï¼Œä»è€Œå®ç°åå°ç‹¬ç«‹è¿è¡Œã€‚\n\n\næ”¹å˜å·¥ä½œç›®å½•ï¼šä½¿ç”¨ chdir(&quot;/&quot;) å°†å½“å‰å·¥ä½œç›®å½•æ›´æ”¹ä¸ºæ ¹ç›®å½• / ã€‚è¿™æ˜¯ä¸ºäº†é˜²æ­¢å®ˆæŠ¤è¿›ç¨‹é•¿æ—¶é—´è¿è¡Œæ—¶ï¼Œå…¶å·¥ä½œç›®å½•æ‰€åœ¨çš„æ–‡ä»¶ç³»ç»Ÿè¢«å¸è½½è€Œå¯¼è‡´è¿›ç¨‹å‡ºç°å¼‚å¸¸ã€‚ä¹Ÿå¯ä»¥æ ¹æ®å®é™…éœ€æ±‚å°†å·¥ä½œç›®å½•è®¾ç½®ä¸ºå…¶ä»–åˆé€‚çš„ç›®å½•ã€‚\n\n\nè®¾ç½®æ–‡ä»¶æƒé™æ©ç ï¼šé€šè¿‡ umask(0) å°†æ–‡ä»¶æƒé™æ©ç è®¾ç½®ä¸º 0ï¼Œè¿™æ ·å®ˆæŠ¤è¿›ç¨‹åœ¨åˆ›å»ºæ–‡ä»¶æˆ–ç›®å½•æ—¶ï¼Œå¯ä»¥å®Œå…¨æŒ‰ç…§æŒ‡å®šçš„æƒé™æ¥åˆ›å»ºï¼Œè€Œä¸ä¼šå—åˆ°é»˜è®¤æ©ç çš„å½±å“ã€‚\n\n\nå…³é—­å¹¶é‡æ–°å®šå‘æ ‡å‡†æ–‡ä»¶æè¿°ç¬¦ï¼šå®ˆæŠ¤è¿›ç¨‹ä¸åº”è¯¥ä¸ç»ˆç«¯æœ‰äº¤äº’ï¼Œæ‰€ä»¥å…³é—­æ ‡å‡†è¾“å…¥ï¼ˆSTDIN_FILENOï¼‰ã€æ ‡å‡†è¾“å‡ºï¼ˆSTDOUT_FILENOï¼‰å’Œæ ‡å‡†é”™è¯¯è¾“å‡ºï¼ˆSTDERR_FILENOï¼‰ï¼Œå¹¶å°†å®ƒä»¬é‡æ–°å®šå‘åˆ° /dev/null ã€‚/dev/null æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„è®¾å¤‡æ–‡ä»¶ï¼Œå†™å…¥å®ƒçš„æ•°æ®ä¼šè¢«ä¸¢å¼ƒï¼Œè¯»å–å®ƒä¼šç«‹å³è¿”å›æ–‡ä»¶ç»“æŸæ ‡å¿—ã€‚\n\n\nint daemon(int nochdir,int noclose)\nnochdir: ç”¨äºæŒ‡å®šæ˜¯å¦æ”¹å˜å½“å‰çš„å·¥ä½œç›®å½•, å¦‚æœ ä¸º0 åˆ™å°†å·¥ä½œç›®å½•è®¾ç½®ä¸ºæ ¹ç›®å½•ï¼ˆâ€/â€œ), å¦åˆ™ä¾æ—§ä½¿ç”¨å½“å‰ç›®å½•ä½œä¸ºå·¥ä½œç›®å½•\nnoclose: å‚æ•°ä¸º0ï¼Œåˆ™å°†æ ‡å‡†è¾“å…¥è¾“å‡ºå’Œæ ‡å‡†é”™è¯¯è¾“å‡ºé‡å®šå‘è‡³â€/dev/nullâ€œæ–‡ä»¶\n","categories":["ç¼–ç¨‹"],"tags":["C++","Linux"]},{"title":"GDBçš„ä½¿ç”¨åŠå¸¸ç”¨å‘½ä»¤","url":"/2025/07/12/linux/GDB%E7%9A%84%E4%BD%BF%E7%94%A8%E5%8F%8A%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/","content":"å¦‚ä½•ä½¿ç”¨ GDB è°ƒè¯• C/C++ ç¨‹åºåŠå¸¸ç”¨å‘½ä»¤è¯¦è§£\n \nä¸€ã€GDB åœ¨ä¸åŒåœºæ™¯ä¸‹çš„ä½¿ç”¨æ–¹æ³•åŠå¸¸ç”¨å‘½ä»¤\nåœºæ™¯ 1ï¼šåŸºç¡€ç¨‹åºè°ƒè¯•ï¼ˆå•è¿›ç¨‹ã€æ— å¤æ‚é€»è¾‘ï¼‰\né€‚ç”¨äºè°ƒè¯•ç®€å•çš„å•æ–‡ä»¶ç¨‹åºï¼Œå®šä½è¯­æ³•å¤–çš„é€»è¾‘é”™è¯¯ï¼ˆå¦‚å˜é‡è®¡ç®—é”™è¯¯ã€å¾ªç¯å¼‚å¸¸ç­‰ï¼‰ã€‚\næ ¸å¿ƒæµç¨‹ä¸å‘½ä»¤ï¼š\n\n\nç¼–è¯‘å¸¦è°ƒè¯•ä¿¡æ¯çš„ç¨‹åº\nå¿…é¡»åœ¨ç¼–è¯‘æ—¶æ·»åŠ -gé€‰é¡¹ï¼ˆç”Ÿæˆè°ƒè¯•ç¬¦å·ï¼ŒåŒ…å«å˜é‡åã€è¡Œå·ç­‰ä¿¡æ¯ï¼‰ï¼Œå¦åˆ™ GDB æ— æ³•æ­£å¸¸è°ƒè¯•ã€‚ç¤ºä¾‹ï¼šgcc -g -o test test.cï¼ˆC ç¨‹åºï¼‰ï¼›g++ -g -o test test.cppï¼ˆC++ ç¨‹åºï¼‰ã€‚\n\n\nå¯åŠ¨ GDB\n\nå‘½ä»¤ï¼šgdb ./testï¼ˆç›´æ¥å¯åŠ¨è°ƒè¯•ï¼‰ï¼›æˆ–gdb -q ./testï¼ˆå®‰é™æ¨¡å¼ï¼Œä¸æ˜¾ç¤º GDB ç‰ˆæœ¬ä¿¡æ¯ï¼‰ã€‚\né€€å‡º GDBï¼šquitï¼ˆç¼©å†™qï¼‰ã€‚\næŸ¥çœ‹å‘½ä»¤å¸®åŠ©ï¼šhelp &lt;å‘½ä»¤&gt;ï¼ˆç¼©å†™hï¼‰ï¼Œå¦‚help breakå¯æŸ¥çœ‹æ–­ç‚¹å‘½ä»¤è¯´æ˜ã€‚\n\n\n\næŸ¥çœ‹æºä»£ç \n\nlist &lt;ä½ç½®&gt;ï¼ˆç¼©å†™lï¼‰ï¼šæ˜¾ç¤ºæŒ‡å®šä½ç½®çš„æºä»£ç ï¼Œå¦‚l 10æ˜¾ç¤ºç¬¬ 10 è¡Œé™„è¿‘ä»£ç ï¼Œl mainæ˜¾ç¤º main å‡½æ•°ä»£ç ï¼Œé»˜è®¤æ¯æ¬¡æ˜¾ç¤º 10 è¡Œã€‚\nlist &lt;start&gt;,&lt;end&gt;ï¼šæ˜¾ç¤ºä» start åˆ° end çš„æºä»£ç ï¼Œå¦‚l 5,20æ˜¾ç¤º 5-20 è¡Œã€‚\nshow listsizeï¼šæŸ¥çœ‹listå‘½ä»¤æ¯æ¬¡æ˜¾ç¤ºçš„è¡Œæ•°ï¼ˆé»˜è®¤ 10 è¡Œï¼‰ï¼›set listsize &lt;N&gt;ï¼šè®¾ç½®æ¯æ¬¡æ˜¾ç¤º N è¡Œï¼Œå¦‚set listsize 20ã€‚\n\n\n\nè®¾ç½®æ–­ç‚¹\næ–­ç‚¹æ˜¯è°ƒè¯•çš„æ ¸å¿ƒï¼Œç”¨äºåœ¨æŒ‡å®šä½ç½®æš‚åœç¨‹åºæ‰§è¡Œã€‚\n\n\nåŸºç¡€æ–­ç‚¹ï¼šbreak ä½ç½®ï¼ˆç¼©å†™bï¼‰ï¼Œä½ç½®æ”¯æŒè¡Œå·ï¼ˆb 10ï¼‰ã€æ–‡ä»¶å + è¡Œå·ï¼ˆb test.c:20ï¼‰ã€å‡½æ•°åï¼ˆb mainï¼‰ã€åœ°å€ï¼ˆb *0x400520ï¼‰ã€‚\n\n\nä¸´æ—¶æ–­ç‚¹ï¼štbreak ä½ç½®ï¼ˆç¼©å†™tbï¼‰ï¼Œè§¦å‘ä¸€æ¬¡åè‡ªåŠ¨åˆ é™¤ã€‚\n\n\næ¡ä»¶æ–­ç‚¹ï¼šbreak ä½ç½® if æ¡ä»¶ï¼Œä»…å½“æ¡ä»¶æ»¡è¶³æ—¶ä¸­æ–­ï¼Œå¦‚break test.c:20 if i == 10ã€‚\n\n\næ–­ç‚¹è§¦å‘åè‡ªåŠ¨æ‰§è¡Œå‘½ä»¤ï¼šbreak ä½ç½® command &lt;å‘½ä»¤åºåˆ—&gt; end, å¦‚åœ¨ test.c:10 è®¾ç½®æ–­ç‚¹åï¼Œè‡ªåŠ¨æ‰“å° i å’Œè°ƒç”¨æ ˆï¼š\nb test.c:10commandp ibtend\n\n\n\n\næ–­ç‚¹ç®¡ç†\n\næŸ¥çœ‹æ–­ç‚¹ï¼šinfo breakpointsï¼ˆç¼©å†™info bï¼‰ï¼Œæ˜¾ç¤ºæ‰€æœ‰æ–­ç‚¹ç¼–å·ã€çŠ¶æ€ã€å‘½ä¸­æ¬¡æ•°ç­‰ã€‚\nåˆ é™¤æ–­ç‚¹ï¼šdelete æ–­ç‚¹ç¼–å·ï¼ˆç¼©å†™dï¼‰ï¼Œå¦‚d 1åˆ é™¤ç¼–å· 1 çš„æ–­ç‚¹ï¼›dä¸å¸¦å‚æ•°åˆ é™¤æ‰€æœ‰ã€‚\nç¦ç”¨ / å¯ç”¨æ–­ç‚¹ï¼šdisable æ–­ç‚¹ç¼–å·ï¼ˆç¼©å†™disï¼‰ã€enable æ–­ç‚¹ç¼–å·ï¼ˆç¼©å†™enï¼‰ï¼›enable once æ–­ç‚¹ç¼–å·ä»…ç”Ÿæ•ˆä¸€æ¬¡ã€‚\næ¸…é™¤æŒ‡å®šä½ç½®æ–­ç‚¹ï¼šclear &lt;ä½ç½®&gt;ï¼Œå¦‚clear mainåˆ é™¤ main å‡½æ•°å…¥å£çš„æ–­ç‚¹ã€‚\n\n\n\nè¿è¡Œç¨‹åº\n\nå¯åŠ¨ç¨‹åºï¼šrun [å‚æ•°]ï¼ˆç¼©å†™rï¼‰ï¼Œå¦‚run 10 20ä¼ é€’å‘½ä»¤è¡Œå‚æ•°ã€‚\nå¯åŠ¨å¹¶åœ¨ main å‡½æ•°ç¬¬ä¸€è¡Œä¸­æ–­ï¼šstartã€‚\nç¨‹åºä¸­æ–­åç»§ç»­æ‰§è¡Œï¼šcontinueï¼ˆç¼©å†™cï¼‰ï¼Œæ‰§è¡Œåˆ°ä¸‹ä¸€ä¸ªæ–­ç‚¹ã€‚\n\n\n\nå•æ­¥æ‰§è¡Œ\n\nnextï¼ˆç¼©å†™nï¼‰ï¼šæ‰§è¡Œå½“å‰è¡Œï¼Œä¸è¿›å…¥å‡½æ•°è°ƒç”¨ã€‚\nstepï¼ˆç¼©å†™sï¼‰ï¼šæ‰§è¡Œå½“å‰è¡Œï¼Œè¿›å…¥å‡½æ•°è°ƒç”¨ã€‚\næŒ‰æ±‡ç¼–æŒ‡ä»¤å•æ­¥ï¼šnextiï¼ˆniï¼‰ã€stepiï¼ˆsiï¼‰ï¼Œåˆ†åˆ«å¯¹åº”ä¸è¿›å…¥å’Œè¿›å…¥å‡½æ•°çš„æ±‡ç¼–çº§æ‰§è¡Œã€‚\nè·³å‡ºå½“å‰å‡½æ•°ï¼šfinishï¼Œæ‰§è¡Œå®Œå½“å‰å‡½æ•°å¹¶è¿”å›åˆ°è°ƒç”¨å¤„ã€‚\næ‰§è¡Œåˆ°æŒ‡å®šè¡Œï¼šuntil &lt;è¡Œå·&gt;ï¼ˆç¼©å†™uï¼‰ï¼Œé€‚åˆå¿«é€Ÿè·³è¿‡å¾ªç¯ã€‚\n\n\n\næŸ¥çœ‹ / ä¿®æ”¹å˜é‡\n\næŸ¥çœ‹å˜é‡ / è¡¨è¾¾å¼ï¼šprint å˜é‡/è¡¨è¾¾å¼ï¼ˆç¼©å†™pï¼‰ï¼Œå¦‚p a + bï¼›æŒ‰æ ¼å¼æ‰“å°ï¼ˆxåå…­è¿›åˆ¶ã€dåè¿›åˆ¶ç­‰ï¼‰ï¼šp /x numã€‚\næ‰“å°æ•°ç»„ï¼šprint *æ•°ç»„å@é•¿åº¦ï¼Œå¦‚p *arr@5æ‰“å°æ•°ç»„å‰ 5 ä¸ªå…ƒç´ ã€‚\nä¿®æ”¹å˜é‡ï¼šset variable å˜é‡å=å€¼ï¼ˆç¼©å†™set varï¼‰ï¼Œå¦‚set var i=5ã€‚\nè‡ªåŠ¨æ˜¾ç¤ºå˜é‡ï¼šdisplay å˜é‡åï¼ˆç¼©å†™dispï¼‰ï¼Œç¨‹åºæ¯æ¬¡ä¸­æ–­æ—¶è‡ªåŠ¨æ‰“å°ï¼›undisplay ç¼–å·å–æ¶ˆã€‚\næŸ¥çœ‹å±€éƒ¨å˜é‡ï¼šinfo localsï¼›æŸ¥çœ‹å‡½æ•°å‚æ•°ï¼šinfo argsã€‚\næŸ¥çœ‹å˜é‡ç±»å‹ï¼šwhatis å˜é‡ï¼ˆå¦‚whatis ptrï¼‰ï¼›æŸ¥çœ‹è¯¦ç»†ç±»å‹å®šä¹‰ï¼šptype å˜é‡/ç±»å‹ï¼ˆå¦‚ptype struct Studentï¼‰ã€‚\n\n\n\næŸ¥çœ‹è°ƒç”¨æ ˆ\n\nbacktraceï¼ˆç¼©å†™btï¼‰ï¼šæŸ¥çœ‹å‡½æ•°è°ƒç”¨é“¾ï¼›bt Næ˜¾ç¤ºå‰ N å±‚ï¼Œbt -Næ˜¾ç¤ºå N å±‚ã€‚\nåˆ‡æ¢æ ˆå¸§ï¼šframe Nï¼ˆç¼©å†™f Nï¼‰ï¼ŒæŸ¥çœ‹ç¬¬ N å±‚æ ˆçš„å±€éƒ¨å˜é‡ï¼›up &lt;N&gt;ã€down &lt;N&gt;ä¸Šä¸‹ç§»åŠ¨æ ˆå¸§ã€‚\næŸ¥çœ‹å½“å‰æ ˆå¸§è¯¦æƒ…ï¼šinfo frameï¼ˆç¼©å†™info fï¼‰ã€‚\n\n\n\nåœºæ™¯ 2ï¼šå¤šçº¿ç¨‹ç¨‹åºè°ƒè¯•\nå¤šçº¿ç¨‹ç¨‹åºæ˜“å‡ºç°ç«æ€æ¡ä»¶ã€æ­»é”ç­‰é—®é¢˜ï¼ŒGDB æä¾›ä¸“é—¨çš„å¤šçº¿ç¨‹è°ƒè¯•å‘½ä»¤ã€‚\næ ¸å¿ƒå‘½ä»¤ï¼š\n\n\næŸ¥çœ‹çº¿ç¨‹ä¿¡æ¯ï¼šinfo threadsï¼Œæ˜¾ç¤ºæ‰€æœ‰çº¿ç¨‹ç¼–å·ã€çŠ¶æ€ã€å½“å‰æ‰§è¡Œä½ç½®ï¼ˆ*æ ‡è®°å½“å‰çº¿ç¨‹ï¼‰ã€‚\n\n\nåˆ‡æ¢çº¿ç¨‹ï¼šthread çº¿ç¨‹ç¼–å·ï¼Œå¦‚thread 2åˆ‡æ¢åˆ°çº¿ç¨‹ 2ã€‚\n\n\nå¯¹çº¿ç¨‹æ‰§è¡Œå‘½ä»¤ï¼šthread apply &lt;çº¿ç¨‹å·&gt; &lt;å‘½ä»¤&gt;ï¼Œå¦‚thread apply 2 btæ‰“å°çº¿ç¨‹ 2 çš„è°ƒç”¨æ ˆï¼›thread apply all btæ‰“å°æ‰€æœ‰çº¿ç¨‹æ ˆã€‚\n\n\næ§åˆ¶çº¿ç¨‹è°ƒåº¦ï¼šset scheduler-locking [on|off|step]\n\nonï¼šä»…å½“å‰çº¿ç¨‹æ‰§è¡Œï¼Œå…¶ä»–çº¿ç¨‹æš‚åœï¼ˆé¿å…å¹²æ‰°ï¼‰ï¼›\noffï¼šæ‰€æœ‰çº¿ç¨‹æ­£å¸¸è°ƒåº¦ï¼ˆé»˜è®¤ï¼‰ï¼›\nstepï¼šå•æ­¥æ‰§è¡Œæ—¶ä»…å½“å‰çº¿ç¨‹ç§»åŠ¨ã€‚\n\n\n\nåœºæ™¯ 3ï¼šç¨‹åºå´©æºƒå®šä½ï¼ˆCore Dump è°ƒè¯•ï¼‰\nå½“ç¨‹åºå› å†…å­˜é”™è¯¯ï¼ˆå¦‚æ®µé”™è¯¯ï¼‰å´©æºƒæ—¶ï¼Œå¯ç”Ÿæˆcoreæ–‡ä»¶ï¼ˆå†…å­˜è½¬å‚¨ï¼‰ï¼Œé€šè¿‡ GDB åˆ†æå´©æºƒåŸå› ã€‚\næ ¸å¿ƒæµç¨‹ï¼š\n\n\nå¼€å¯ Core Dump åŠŸèƒ½\n\nä¸´æ—¶å¼€å¯ï¼šulimit -c unlimitedï¼ˆå½“å‰ç»ˆç«¯æœ‰æ•ˆï¼‰ï¼›\næ°¸ä¹…å¼€å¯ï¼šä¿®æ”¹/etc/security/limits.confï¼Œæ·»åŠ * soft core unlimitedï¼ˆéœ€é‡å¯ï¼‰ã€‚\n\n\n\nç”Ÿæˆå¹¶åˆ†æ core æ–‡ä»¶\nç¨‹åºå´©æºƒåç”Ÿæˆcore.PIDæ–‡ä»¶ï¼Œç”¨ GDB åŠ è½½ï¼šgdb ./ç¨‹åºå coreæ–‡ä»¶ï¼ˆå¦‚gdb ./test core.12345ï¼‰ã€‚åŠ è½½åæ‰§è¡Œbacktraceï¼ˆbtï¼‰ï¼ŒæŸ¥çœ‹å´©æºƒæ—¶çš„è°ƒç”¨æ ˆï¼Œå®šä½å´©æºƒä½ç½®ã€‚\n\nè¡¥å……å‘½ä»¤ï¼šcore-file &lt;coreæ–‡ä»¶&gt;ï¼Œåœ¨ GDB äº¤äº’ç•Œé¢ä¸­åŠ è½½ core æ–‡ä»¶ã€‚\n\n\n\nåœ¨ä½¿ç”¨ systemd ä½œä¸ºåˆå§‹åŒ–ç³»ç»Ÿçš„ Linux å‘è¡Œç‰ˆä½¿ç”¨coredumpctlæ¥å¤„ç†ç¨‹åºå´©æºƒ\ncoredumpctl list  #åˆ—å‡ºæ‰€æœ‰core dumpè®°å½•coredumpctl list program_name #æŒ‰ç¨‹åºåç­›é€‰coredumpctl list --since &quot;1 hour ago&quot; #æŒ‰æ—¶é—´coredumpctl gdb program_name pid  #é€šè¿‡gdbè¿›è¡Œè°ƒè¯•\nåœºæ™¯ 4ï¼šè¿œç¨‹è°ƒè¯•ï¼ˆå¦‚åµŒå…¥å¼è®¾å¤‡ã€æœåŠ¡å™¨ç¨‹åºï¼‰\né€‚ç”¨äºè°ƒè¯•è¿è¡Œåœ¨è¿œç¨‹è®¾å¤‡ä¸Šçš„ç¨‹åºï¼Œæœ¬åœ°é€šè¿‡ GDB è¿æ¥è¿œç¨‹è¿›ç¨‹ã€‚\næ ¸å¿ƒæµç¨‹ï¼š\n\n\nè¿œç¨‹ç«¯å¯åŠ¨ GDB Server\nè¿œç¨‹è®¾å¤‡å®‰è£…gdbserverï¼Œå¯åŠ¨å‘½ä»¤ï¼šgdbserver è¿œç¨‹IP:ç«¯å£ ç¨‹åºåï¼ˆå¦‚gdbserver 192.168.1.100:1234 ./testï¼‰ã€‚\n\n\næœ¬åœ° GDB è¿æ¥è¿œç¨‹\næœ¬åœ°å¯åŠ¨ GDBï¼šgdb ./testï¼Œæ‰§è¡Œtarget remote è¿œç¨‹IP:ç«¯å£ï¼ˆå¦‚target remote 192.168.1.100:1234ï¼‰ï¼Œè¿æ¥åå³å¯åƒè°ƒè¯•æœ¬åœ°ç¨‹åºä¸€æ ·æ“ä½œã€‚\n\n\nåœºæ™¯ 5ï¼šå†…å­˜ä¸å¯„å­˜å™¨è°ƒè¯•\nç”¨äºç›´æ¥æ£€æŸ¥å†…å­˜æ•°æ®æˆ– CPU å¯„å­˜å™¨çŠ¶æ€ï¼Œé€‚åˆè°ƒè¯•å†…å­˜é”™è¯¯ï¼ˆå¦‚è¶Šç•Œã€é‡æŒ‡é’ˆï¼‰ã€‚\næ ¸å¿ƒå‘½ä»¤ï¼š\n\n\næŸ¥çœ‹å†…å­˜ï¼šx/&lt;n&gt;&lt;f&gt;&lt;u&gt; åœ°å€ï¼ˆxå³ examineï¼‰\n\nnï¼šå•å…ƒæ•°ï¼›fï¼šæ ¼å¼ï¼ˆx/d/u/o/t/c/fï¼‰ï¼›uï¼šå•å…ƒå¤§å°ï¼ˆb/h/w/gï¼‰ã€‚\nç¤ºä¾‹ï¼šx/10xw 0x7fffffffde40ï¼ˆä»¥ 16 è¿›åˆ¶æ˜¾ç¤º 10 ä¸ª 4 å­—èŠ‚å•å…ƒï¼‰ï¼›x/s åœ°å€ä»¥å­—ç¬¦ä¸²æ ¼å¼æŸ¥çœ‹ã€‚\n\n\n\næŸ¥çœ‹å¯„å­˜å™¨\n\ninfo registersï¼šæ˜¾ç¤ºæ‰€æœ‰é€šç”¨å¯„å­˜å™¨ï¼›info registers &lt;å¯„å­˜å™¨å&gt;ï¼šæ˜¾ç¤ºæŒ‡å®šå¯„å­˜å™¨ï¼ˆå¦‚info registers ripï¼‰ã€‚\nä¿®æ”¹å¯„å­˜å™¨ï¼šset $&lt;å¯„å­˜å™¨&gt;=&lt;å€¼&gt;ï¼Œå¦‚set $rip=0x400520ï¼ˆè°¨æ…ä½¿ç”¨ï¼‰ã€‚\n\n\n\nåœºæ™¯ 6ï¼šå¤šè¿›ç¨‹è°ƒè¯•\né’ˆå¯¹fork()åˆ›å»ºçš„å¤šè¿›ç¨‹ç¨‹åºï¼Œæ§åˆ¶è·Ÿè¸ªçˆ¶è¿›ç¨‹æˆ–å­è¿›ç¨‹ã€‚\næ ¸å¿ƒå‘½ä»¤ï¼š\n\n\nset follow-fork-mode [parent|child]ï¼šè®¾ç½®fork()åè·Ÿè¸ªçš„è¿›ç¨‹ï¼ˆé»˜è®¤è·Ÿè¸ªçˆ¶è¿›ç¨‹ï¼‰ã€‚\n\n\nset detach-on-fork [on|off]ï¼šè®¾ç½®æ˜¯å¦åˆ†ç¦»æœªè·Ÿè¸ªçš„è¿›ç¨‹ï¼ˆé»˜è®¤åˆ†ç¦»ï¼Œæœªè·Ÿè¸ªè¿›ç¨‹ç»§ç»­è¿è¡Œï¼‰ã€‚\n\n\ninfo inferiorsï¼šæ˜¾ç¤ºæ‰€æœ‰è¿›ç¨‹ä¿¡æ¯ï¼›inferior &lt;è¿›ç¨‹å·&gt;ï¼šåˆ‡æ¢åˆ°æŒ‡å®šè¿›ç¨‹ã€‚\n\n\näºŒã€GDB ä½¿ç”¨æ³¨æ„äº‹é¡¹\n\n\nç¼–è¯‘å¿…é¡»å¸¦-gé€‰é¡¹\nè‹¥æœªåŠ -gï¼ŒGDB æ— æ³•è¯†åˆ«è¡Œå·ã€å˜é‡åç­‰è°ƒè¯•ä¿¡æ¯ï¼Œåªèƒ½çœ‹åˆ°æ±‡ç¼–ä»£ç ï¼Œå¤±å»è°ƒè¯•æ„ä¹‰ã€‚\n\n\né¿å…é«˜ä¼˜åŒ–çº§åˆ«ç¼–è¯‘\nç”¨-O2ã€-O3ç­‰ä¼˜åŒ–é€‰é¡¹ç¼–è¯‘æ—¶ï¼Œç¼–è¯‘å™¨å¯èƒ½åˆ é™¤å˜é‡ã€é‡æ’ä»£ç ï¼Œå¯¼è‡´ GDB æ— æ³•æŸ¥çœ‹å˜é‡æˆ–å•æ­¥æ··ä¹±ã€‚è°ƒè¯•æ—¶å»ºè®®ç”¨-O0ï¼ˆæ— ä¼˜åŒ–ï¼‰ã€‚\n\n\nå¤„ç†ä¿¡å·æ—¶éœ€è°¨æ…\nç¨‹åºå¯èƒ½æ”¶åˆ°ä¿¡å·ï¼ˆå¦‚SIGINTã€SIGSEGVï¼‰ï¼Œé»˜è®¤ GDB ä¼šæ•è·å¹¶ä¸­æ–­ã€‚å¯é€šè¿‡handle ä¿¡å· åŠ¨ä½œè®¾ç½®ï¼š\n\nå¦‚handle SIGINT nostopï¼ˆæ”¶åˆ°Ctrl+Cæ—¶ä¸ä¸­æ–­ï¼‰ï¼›handle SIGSEGV stop printï¼ˆæ®µé”™è¯¯æ—¶ä¸­æ–­å¹¶æ‰“å°ï¼‰ã€‚\n\n\n\nåŒºåˆ†nextä¸step\n\nnextï¼šä¸è¿›å…¥å‡½æ•°ï¼Œé€‚åˆå¿«é€Ÿè·³è¿‡ï¼›stepï¼šè¿›å…¥å‡½æ•°ï¼Œé€‚åˆè°ƒè¯•å‡½æ•°å†…éƒ¨é€»è¾‘ã€‚æ–°æ‰‹æ˜“æ··æ·†å¯¼è‡´æ•ˆç‡ä½ã€‚\n\n\n\nCore æ–‡ä»¶çš„å­˜å‚¨ä¸æ¸…ç†\ncore æ–‡ä»¶å¯èƒ½å¾ˆå¤§ï¼ˆä¸ç¨‹åºå†…å­˜å ç”¨ä¸€è‡´ï¼‰ï¼Œç”Ÿäº§ç¯å¢ƒéœ€é™åˆ¶å¤§å°ï¼ˆå¦‚ulimit -c 1024ï¼‰ï¼Œå¹¶åŠæ—¶æ¸…ç†æ— ç”¨æ–‡ä»¶ã€‚\n\n\nè¿œç¨‹è°ƒè¯•éœ€ä¿æŒç¨‹åºä¸€è‡´æ€§\næœ¬åœ°ä¸è¿œç¨‹ç¨‹åºéœ€ä¸ºåŒä¸€æºç ã€åŒä¸€ç¼–è¯‘é€‰é¡¹ç¼–è¯‘ï¼Œå¦åˆ™è°ƒè¯•ä¿¡æ¯ä¸åŒ¹é…ã€‚\n\n\nä¸‰ã€GDB æ‰©å±•çŸ¥è¯†ç‚¹\n1. ç›‘è§†ç‚¹ï¼ˆé«˜çº§æ–­ç‚¹ï¼‰\n\n\nwatch å˜é‡ï¼šå˜é‡è¢«ä¿®æ”¹æ—¶ä¸­æ–­ï¼›\n\n\nrwatch å˜é‡ï¼šå˜é‡è¢«è¯»å–æ—¶ä¸­æ–­ï¼›\n\n\nawatch å˜é‡ï¼šå˜é‡è¢«è¯»å–æˆ–ä¿®æ”¹æ—¶ä¸­æ–­ã€‚ç¤ºä¾‹ï¼šwatch countï¼Œå½“countå€¼å˜åŒ–æ—¶è‡ªåŠ¨ä¸­æ–­ï¼Œæ— éœ€æ‰‹åŠ¨è®¾ç½®æ–­ç‚¹ã€‚\n\n\n2. GDB è„šæœ¬ä¸è‡ªåŠ¨åŒ–\n\n\n.gdbinité…ç½®æ–‡ä»¶ï¼šå¯åŠ¨ GDB æ—¶è‡ªåŠ¨åŠ è½½ï¼Œå¯å®šä¹‰åˆ«åæˆ–è‡ªåŠ¨æ‰§è¡Œå‘½ä»¤ã€‚ç¤ºä¾‹ï¼šåœ¨~/.gdbinitä¸­æ·»åŠ alias ll = info localsï¼ˆç”¨llå¿«é€ŸæŸ¥çœ‹å±€éƒ¨å˜é‡ï¼‰ã€‚\n\n\nè‡ªå®šä¹‰å‘½ä»¤ï¼šé€šè¿‡ define å‘½ä»¤å\nå®šä¹‰æ‰¹é‡æ“ä½œï¼Œå¦‚ï¼š\ndefine dbg  bt          # æ‰“å°è°ƒç”¨æ ˆ  info locals # æ‰“å°å±€éƒ¨å˜é‡  print i     # æ‰“å°å˜é‡iend\næ‰§è¡Œdbgå³å¯ä¸€æ¬¡æ€§æ‰§è¡Œä¸Šè¿°å‘½ä»¤ã€‚\n\n\n3. å®è°ƒè¯•\nC/C++ å®åœ¨é¢„å¤„ç†é˜¶æ®µå±•å¼€ï¼Œé»˜è®¤ GDB æ— æ³•è°ƒè¯•ã€‚éœ€ç¼–è¯‘æ—¶æ·»åŠ -ggdb3ï¼ˆæ›´è¯¦ç»†è°ƒè¯•ä¿¡æ¯ï¼‰å’Œ-fmacro-prefix-map=.=ï¼ˆä¿ç•™å®è·¯å¾„ï¼‰ï¼Œç„¶åï¼š\n\n\ninfo macro å®åï¼šæŸ¥çœ‹å®å®šä¹‰ï¼›\n\n\nmacro expand å®è°ƒç”¨ï¼šæŸ¥çœ‹å®å±•å¼€ç»“æœã€‚\n\n\n4. æ–­ç‚¹ä¿å­˜ä¸æ¢å¤\n\n\nsave breakpoints &lt;æ–‡ä»¶&gt;ï¼šå°†å½“å‰æ–­ç‚¹ä¿å­˜åˆ°æ–‡ä»¶ï¼ˆå¦‚save breakpoints bps.txtï¼‰ï¼›\n\n\nsource &lt;æ–‡ä»¶&gt;ï¼šæ¢å¤æ–­ç‚¹ï¼ˆå¦‚source bps.txtï¼‰ã€‚\n\n\n5. ä¸ IDE é›†æˆ\nGDB å¯ä¸ VS Codeã€Clion ç­‰ IDE é›†æˆï¼Œé€šè¿‡å›¾å½¢ç•Œé¢æ“ä½œï¼ˆç‚¹å‡»è®¾ç½®æ–­ç‚¹ã€å•æ­¥ï¼‰ï¼Œåº•å±‚ä¾èµ– GDB æ ¸å¿ƒåŠŸèƒ½ã€‚ä»¥ VS Code ä¸ºä¾‹ï¼Œéœ€åœ¨.vscode/launch.jsonä¸­é…ç½®miDebuggerPathä¸º GDB è·¯å¾„ã€‚\n","categories":["ç¼–ç¨‹"],"tags":["C++","å·¥å…·","GDB"]},{"title":"Gitçš„ä½¿ç”¨","url":"/2025/08/15/linux/Git%20%E5%91%BD%E4%BB%A4%E5%A4%A7%E5%85%A8/","content":"\nè®°å½•gitçš„ä½¿ç”¨\n\n \nGit å‘½ä»¤å¤§å…¨\n\næœ¬æ–‡åŸºäºçŸ¥ä¹æ–‡ç« ã€ŠGit å‘½ä»¤å¤§å…¨ã€‹ï¼ˆåŸæ–‡é“¾æ¥ï¼‰æ•´ç†ï¼Œæ¶µç›– Git æ ¸å¿ƒæ“ä½œå‘½ä»¤ã€å¸¸è§é—®é¢˜è§£å†³æ–¹æ¡ˆï¼Œå¹¶è¡¥å……å®ç”¨æ‰©å±•çŸ¥è¯†\n\nä¸€ã€åˆå§‹åŒ–ä¸é…ç½®\n1. æ ¸å¿ƒå‘½ä»¤æ•´ç†ï¼ˆåŸæ–‡å†…å®¹ï¼‰\n# åˆå§‹åŒ–æœ¬åœ° Git ä»“åº“ï¼ˆåœ¨å½“å‰ç›®å½•åˆ›å»º .git æ–‡ä»¶å¤¹ï¼‰git init# é…ç½®å…¨å±€ç”¨æˆ·åï¼ˆæ‰€æœ‰ä»“åº“ç”Ÿæ•ˆï¼‰git config --global user.name &quot;ä½ çš„ç”¨æˆ·å&quot;# é…ç½®å…¨å±€é‚®ç®±ï¼ˆä¸ Git å¹³å°è´¦å·é‚®ç®±ä¸€è‡´ï¼Œç”¨äºèº«ä»½è¯†åˆ«ï¼‰git config --global user.email &quot;ä½ çš„é‚®ç®±@xxx.com&quot;# å¼€å¯å‘½ä»¤è‡ªåŠ¨ç€è‰²ï¼ˆgit statusã€git log ç­‰è¾“å‡ºæ›´æ˜“è¯»ï¼‰git config --global color.ui truegit config --global color.status autogit config --global color.diff autogit config --global color.branch autogit config --global color.interactive auto# ç§»é™¤å…¨å±€ HTTP ä»£ç†é…ç½®ï¼ˆè§£å†³ä»£ç†å¤±æ•ˆå¯¼è‡´çš„è¿æ¥é—®é¢˜ï¼‰git config --global --unset http.proxy\n2. è¡¥å……çŸ¥è¯†ä¸æ‰©å±•\n\n\né…ç½®ä½œç”¨åŸŸåŒºåˆ«ï¼š\n\n--globalï¼šå…¨å±€é…ç½®ï¼ˆä¿å­˜åœ¨ ~/.gitconfig æˆ– C:\\Users\\ç”¨æˆ·å\\.gitconfigï¼‰ï¼Œå¯¹å½“å‰ç”¨æˆ·æ‰€æœ‰ä»“åº“ç”Ÿæ•ˆï¼›\n--localï¼šä»“åº“çº§é…ç½®ï¼ˆä¿å­˜åœ¨å½“å‰ä»“åº“çš„ .git/configï¼‰ï¼Œä»…å¯¹å½“å‰ä»“åº“ç”Ÿæ•ˆï¼Œä¼˜å…ˆçº§é«˜äº --globalï¼›\n--systemï¼šç³»ç»Ÿçº§é…ç½®ï¼ˆä¿å­˜åœ¨ /etc/gitconfig æˆ– Git å®‰è£…ç›®å½•/etc/gitconfigï¼‰ï¼Œå¯¹æ‰€æœ‰ç”¨æˆ·ç”Ÿæ•ˆï¼ˆéœ€ç®¡ç†å‘˜æƒé™ï¼‰ã€‚\nç¤ºä¾‹ï¼šä¸ºå½“å‰ä»“åº“å•ç‹¬é…ç½®é‚®ç®±\n\ngit config --local user.email &quot;ä»“åº“ä¸“å±é‚®ç®±@xxx.com&quot;\n\n\næŸ¥çœ‹é…ç½®ï¼š\ngit config --list  # æŸ¥çœ‹æ‰€æœ‰ç”Ÿæ•ˆçš„é…ç½®ï¼ˆæŒ‰ä¼˜å…ˆçº§æ’åºï¼‰git config user.name  # æŸ¥çœ‹æŒ‡å®šé…ç½®é¡¹ï¼ˆå¦‚ç”¨æˆ·åï¼‰\n\n\nå¸¸ç”¨è¾…åŠ©é…ç½®ï¼š\n# é…ç½®é»˜è®¤æ–‡æœ¬ç¼–è¾‘å™¨ï¼ˆè§£å†³ commit æ—¶ç¼–è¾‘å™¨å¼‚å¸¸é—®é¢˜ï¼‰git config --global core.editor &quot;code --wait&quot;  # VS Code ä¸ºä¾‹# é…ç½®æ¢è¡Œç¬¦è‡ªåŠ¨è½¬æ¢ï¼ˆé¿å…è·¨ç³»ç»Ÿåä½œæ¢è¡Œç¬¦å†²çªï¼‰git config --global core.autocrlf true  # Windows ä¸‹ï¼›Linux/macOS ä¸‹è®¾ä¸º input\n\n\näºŒã€å…‹éš†ã€çŠ¶æ€ä¸æäº¤\n1. æ ¸å¿ƒå‘½ä»¤æ•´ç†ï¼ˆåŸæ–‡å†…å®¹ï¼‰\n# å…‹éš†è¿œç¨‹ä»“åº“ï¼ˆSSH åœ°å€ç¤ºä¾‹ï¼Œä¹Ÿå¯ä½¿ç”¨ HTTPS åœ°å€ï¼‰git clone git+ssh://git@192.168.53.168/VT.git# æŸ¥çœ‹å½“å‰ä»“åº“çŠ¶æ€ï¼ˆæ˜¾ç¤ºä¿®æ”¹æœªæš‚å­˜ã€æš‚å­˜æœªæäº¤çš„æ–‡ä»¶ï¼‰git status# å•ä¸ªæ–‡ä»¶æ·»åŠ åˆ°æš‚å­˜åŒºï¼ˆè·Ÿè¸ªæ–‡ä»¶å˜æ›´ï¼‰git add xyz.txt# å½“å‰ç›®å½•æ‰€æœ‰ä¿®æ”¹/æ–°å¢æ–‡ä»¶æ·»åŠ åˆ°æš‚å­˜åŒºï¼ˆä¸å«è¢«å¿½ç•¥æ–‡ä»¶ï¼‰git add .# æäº¤æš‚å­˜åŒºæ–‡ä»¶ï¼ˆ-m åä¸ºæäº¤è¯´æ˜ï¼Œéœ€æ¸…æ™°æè¿°å˜æ›´å†…å®¹ï¼‰git commit -m &quot;feat: æ–°å¢ç™»å½•åŠŸèƒ½&quot;# ä¿®æ”¹ä¸Šä¸€æ¬¡æäº¤ï¼ˆä»…é€‚ç”¨äºæœªæ¨é€åˆ°è¿œç¨‹çš„æäº¤ï¼Œé¿å…ä¿®æ”¹å†å²ï¼‰git commit --amend -m &quot;feat: æ–°å¢ç™»å½•åŠŸèƒ½ï¼ˆè¡¥å……å¯†ç éªŒè¯ï¼‰&quot;# è·³è¿‡æš‚å­˜åŒºï¼Œç›´æ¥æäº¤å·²è·Ÿè¸ªæ–‡ä»¶çš„ä¿®æ”¹ï¼ˆæœªè·Ÿè¸ªæ–‡ä»¶éœ€å…ˆ git addï¼‰git commit -am &quot;fix: ä¿®å¤ç™»å½•æŒ‰é’®ç‚¹å‡»æ— å“åº”é—®é¢˜&quot;\n2. è¡¥å……çŸ¥è¯†ä¸æ‰©å±•\n\n\nå…‹éš†çš„æ‰©å±•ç”¨æ³•ï¼š\n# å…‹éš†æŒ‡å®šåˆ†æ”¯ï¼ˆé¿å…å…‹éš†å…¨éƒ¨åˆ†æ”¯å ç”¨ç©ºé—´ï¼‰git clone -b åˆ†æ”¯å è¿œç¨‹ä»“åº“åœ°å€# ç¤ºä¾‹ï¼šå…‹éš†è¿œç¨‹ develop åˆ†æ”¯git clone -b develop https://github.com/xxx/xxx.git# æµ…å…‹éš†ï¼ˆä»…æ‹‰å–æœ€è¿‘ N æ¬¡æäº¤ï¼Œé€‚åˆå¤§å‹ä»“åº“æé€Ÿï¼‰git clone --depth 1 è¿œç¨‹ä»“åº“åœ°å€  # ä»…æ‹‰å–æœ€è¿‘ 1 æ¬¡æäº¤\n\n\næš‚å­˜åŒºç†è§£ï¼š\næš‚å­˜åŒºï¼ˆIndexï¼‰æ˜¯ Git ç‰¹æœ‰çš„â€œä¸­é—´å±‚â€ï¼Œç”¨äºä¸´æ—¶å­˜æ”¾å¾…æäº¤çš„å˜æ›´ã€‚é€šè¿‡ git add å°†å˜æ›´å­˜å…¥æš‚å­˜åŒºï¼Œgit commit å°†æš‚å­˜åŒºå†…å®¹æäº¤åˆ°æœ¬åœ°ä»“åº“ã€‚å¥½å¤„æ˜¯å¯åˆ†æ‰¹æ¬¡æäº¤ä¸åŒæ–‡ä»¶çš„å˜æ›´ï¼ˆä¾‹å¦‚ï¼šå…ˆæäº¤åŠŸèƒ½ä»£ç ï¼Œå†æäº¤æ–‡æ¡£ï¼‰ã€‚\n\n\næäº¤ä¿¡æ¯è§„èŒƒï¼š\næ¨èéµå¾ª Angular æäº¤è§„èŒƒï¼Œæ ¼å¼ï¼šç±»å‹(èŒƒå›´): æè¿°\n\nç±»å‹ï¼šfeatï¼ˆæ–°åŠŸèƒ½ï¼‰ã€fixï¼ˆbug ä¿®å¤ï¼‰ã€docsï¼ˆæ–‡æ¡£ä¿®æ”¹ï¼‰ã€styleï¼ˆä»£ç æ ¼å¼è°ƒæ•´ï¼Œæ— é€»è¾‘å˜æ›´ï¼‰ã€refactorï¼ˆé‡æ„ï¼‰ã€testï¼ˆæµ‹è¯•ä»£ç ï¼‰ã€choreï¼ˆæ„å»º/å·¥å…·é…ç½®ï¼‰ï¼›\nç¤ºä¾‹ï¼šfix(login): ä¿®å¤æ‰‹æœºå·æ ¼å¼éªŒè¯é”™è¯¯\n\n\n\nä¸‰ã€æ–‡ä»¶åˆ é™¤ä¸é‡å‘½å\n1. æ ¸å¿ƒå‘½ä»¤æ•´ç†ï¼ˆåŸæ–‡å†…å®¹ï¼‰\n# ä»æš‚å­˜åŒºå’Œå·¥ä½œåŒºåŒæ—¶åˆ é™¤æ–‡ä»¶ï¼ˆéœ€è°¨æ…ï¼Œåˆ é™¤åéœ€ commit ç”Ÿæ•ˆï¼‰git rm xxx.txt# é€’å½’åˆ é™¤ç›®å½•ï¼ˆå«å­ç›®å½•ä¸‹æ‰€æœ‰æ–‡ä»¶ï¼‰git rm -r docs/# é‡å‘½åæ–‡ä»¶ï¼ˆç­‰ä»·äº â€œmv æ—§å æ–°å + git add æ–°å + git rm æ—§åâ€ï¼‰git mv README.md README_2.0.md\n2. è¡¥å……çŸ¥è¯†ä¸æ‰©å±•\n\n\nä»…ä»æš‚å­˜åŒºåˆ é™¤ï¼ˆä¿ç•™å·¥ä½œåŒºæ–‡ä»¶ï¼‰ï¼š\nè‹¥è¯¯å°†ä¸éœ€è¦è·Ÿè¸ªçš„æ–‡ä»¶ git addï¼Œå¯ä»æš‚å­˜åŒºç§»é™¤ä½†ä¿ç•™æœ¬åœ°æ–‡ä»¶ï¼š\ngit rm --cached ä¸éœ€è¦è·Ÿè¸ªçš„æ–‡ä»¶.txt\n\n\nåˆ é™¤å·²æäº¤çš„æ–‡ä»¶ï¼ˆä¿ç•™æœ¬åœ°å‰¯æœ¬ï¼‰ï¼š\nè‹¥æ–‡ä»¶å·²æäº¤åˆ°ä»“åº“ï¼Œæƒ³åœæ­¢è·Ÿè¸ªä½†ä¿ç•™æœ¬åœ°æ–‡ä»¶ï¼š\ngit rm --cached å·²æäº¤æ–‡ä»¶.txtgit commit -m &quot;chore: åœæ­¢è·Ÿè¸ªå·²æäº¤æ–‡ä»¶.txt&quot;\n\n\né‡å‘½åçš„æ³¨æ„äº‹é¡¹ï¼š\nGit å¯¹æ–‡ä»¶åå¤§å°å†™ä¸æ•æ„Ÿï¼ˆå¦‚ ReadMe.md ä¸ README.md è§†ä¸ºåŒä¸€æ–‡ä»¶ï¼‰ï¼Œè‹¥éœ€ä¿®æ”¹æ–‡ä»¶åå¤§å°å†™ï¼Œéœ€å…ˆåˆ é™¤æ—§åå†æ·»åŠ æ–°åï¼š\ngit rm ReadMe.mdmv ReadMe.md README.mdgit add README.md\n\n\nå››ã€æ—¥å¿—æŸ¥çœ‹ä¸æ˜¾ç¤º\n1. æ ¸å¿ƒå‘½ä»¤æ•´ç†ï¼ˆåŸæ–‡å†…å®¹ï¼‰\n# æ˜¾ç¤ºå®Œæ•´æäº¤æ—¥å¿—ï¼ˆæŒ‰æ—¶é—´å€’åºï¼Œå«ä½œè€…ã€æ—¶é—´ã€æäº¤ IDã€è¯´æ˜ï¼‰git log# æ˜¾ç¤ºæœ€è¿‘ 1 æ¬¡æäº¤git log -1# æ˜¾ç¤ºæœ€è¿‘ 5 æ¬¡æäº¤git log -5# æ˜¾ç¤ºæ—¥å¿—åŠæ¯æ¬¡æäº¤çš„å˜æ›´æ–‡ä»¶ï¼ˆå«æ–°å¢/åˆ é™¤/ä¿®æ”¹çš„æ–‡ä»¶æ•°ï¼‰git log --stat# æ˜¾ç¤ºæ—¥å¿—åŠæ¯æ¬¡æäº¤çš„å…·ä½“ä»£ç å˜æ›´ï¼ˆ-p æ˜¾ç¤ºè¡¥ä¸ï¼Œ-m æ˜¾ç¤ºåˆå¹¶æäº¤çš„åŒæ–¹ä¿¡æ¯ï¼‰git log -p -m# å›¾å½¢åŒ–æ˜¾ç¤ºæäº¤å†å²ï¼ˆå«åˆ†æ”¯åˆå¹¶çº¿ï¼Œ%h æ˜¾ç¤ºçŸ­æäº¤ IDï¼Œ%s æ˜¾ç¤ºæäº¤è¯´æ˜ï¼‰git log --pretty=format:&#x27;%h %s&#x27; --graph# æŸ¥çœ‹æŒ‡å®šæäº¤çš„å®Œæ•´å†…å®¹ï¼ˆéœ€è¾“å…¥å®Œæ•´æäº¤ IDï¼Œæˆ–å‰ 4-6 ä½å³å¯ï¼‰git show dfb02e6e4f2f7b573337763e5c0013802e392818git show dfb02  # çŸ­ ID ç¤ºä¾‹# æŸ¥çœ‹å½“å‰ HEAD æŒ‡å‘çš„æäº¤è¯¦æƒ…ï¼ˆHEAD æ˜¯å½“å‰åˆ†æ”¯çš„â€œæŒ‡é’ˆâ€ï¼‰git show HEAD# æŸ¥çœ‹ä¸Šä¸€ä¸ªç‰ˆæœ¬çš„æäº¤ï¼ˆHEAD^ ç­‰ä»·äº HEAD~1ï¼‰git show HEAD^# æŸ¥çœ‹ä¸Šä¸Šä¸Šæ¬¡ç‰ˆæœ¬çš„æäº¤ï¼ˆHEAD~3 è¡¨ç¤ºå¾€å‰æ•° 3 ä¸ªç‰ˆæœ¬ï¼‰git show HEAD~3\n2. è¡¥å……çŸ¥è¯†ä¸æ‰©å±•\n\n\nå¸¸ç”¨æ—¥å¿—è¿‡æ»¤ä¸æ ¼å¼åŒ–ï¼š\n# æŒ‰ä½œè€…ç­›é€‰æ—¥å¿—ï¼ˆæŸ¥æ‰¾æŒ‡å®šäººæäº¤çš„è®°å½•ï¼‰git log --author=&quot;å¼ ä¸‰&quot;# æŒ‰æ—¶é—´ç­›é€‰æ—¥å¿—ï¼ˆæŸ¥æ‰¾è¿‘ 3 å¤©çš„æäº¤ï¼‰git log --since=&quot;3 days ago&quot;# æŸ¥æ‰¾ 2024-01-01 åˆ° 2024-05-01 ä¹‹é—´çš„æäº¤git log --since=&quot;2024-01-01&quot; --until=&quot;2024-05-01&quot;# æŒ‰æäº¤è¯´æ˜ç­›é€‰ï¼ˆæŸ¥æ‰¾å«â€œç™»å½•â€å…³é”®è¯çš„æäº¤ï¼‰git log --grep=&quot;ç™»å½•&quot;# ç®€æ´æ—¥å¿—ï¼ˆä¸€è¡Œæ˜¾ç¤ºä¸€ä¸ªæäº¤ï¼Œå¸¸ç”¨ï¼ï¼‰git log --oneline  # ç­‰ä»·äº --pretty=oneline --abbrev-commit# å›¾å½¢åŒ–ç®€æ´æ—¥å¿—ï¼ˆæŸ¥çœ‹åˆ†æ”¯å…³ç³»æ›´ç›´è§‚ï¼‰git log --oneline --graph --all  # --all æ˜¾ç¤ºæ‰€æœ‰åˆ†æ”¯çš„æ—¥å¿—\n\n\næŸ¥çœ‹ç‰¹å®šæ–‡ä»¶çš„æäº¤å†å²ï¼š\nè·Ÿè¸ªå•ä¸ªæ–‡ä»¶çš„ä¿®æ”¹è®°å½•ï¼ˆé€‚åˆæ’æŸ¥â€œè°æ”¹äº†è¿™ä¸ªæ–‡ä»¶â€ï¼‰ï¼š\ngit log -p README.md  # æ˜¾ç¤º README.md çš„æ‰€æœ‰ä¿®æ”¹å†å²åŠä»£ç å˜æ›´git log --follow README.md  # è·Ÿè¸ªæ–‡ä»¶é‡å‘½ååçš„å†å²ï¼ˆé»˜è®¤ä¸è·Ÿè¸ªï¼‰\n\n\näº”ã€æ ‡ç­¾ç®¡ç†\n1. æ ¸å¿ƒå‘½ä»¤æ•´ç†ï¼ˆåŸæ–‡å†…å®¹ï¼‰\n# æŸ¥çœ‹æœ¬åœ°æ‰€æœ‰æ ‡ç­¾ï¼ˆæŒ‰å­—æ¯é¡ºåºæ’åˆ—ï¼‰git tag# åˆ›å»ºå¸¦æ³¨é‡Šçš„æ ‡ç­¾ï¼ˆ-a è¡¨ç¤º annotatedï¼Œå«ä½œè€…ã€æ—¶é—´ã€è¯´æ˜ï¼Œæ¨èç”¨äºç‰ˆæœ¬å‘å¸ƒï¼‰git tag -a v2.0 -m &quot;ç‰ˆæœ¬ 2.0ï¼šæ–°å¢æ”¯ä»˜åŠŸèƒ½&quot;# æ˜¾ç¤ºæ ‡ç­¾å¯¹åº”çš„æäº¤è¯¦æƒ…ï¼ˆå«æ ‡ç­¾è¯´æ˜ã€æäº¤å†…å®¹ï¼‰git show v2.0# æŸ¥çœ‹æ ‡ç­¾ v2.0 å¯¹åº”çš„æ‰€æœ‰æäº¤æ—¥å¿—git log v2.0# æ¨é€æ‰€æœ‰æœ¬åœ°æ ‡ç­¾åˆ°è¿œç¨‹ä»“åº“ï¼ˆæ ‡ç­¾ä¸ä¼šéš git push è‡ªåŠ¨æ¨é€ï¼‰git push --tags\n2. è¡¥å……çŸ¥è¯†ä¸æ‰©å±•\n\n\næ ‡ç­¾çš„ä¸¤ç§ç±»å‹ï¼š\n\nå¸¦æ³¨é‡Šæ ‡ç­¾ï¼ˆAnnotatedï¼‰ï¼šgit tag -a åˆ›å»ºï¼Œå«å®Œæ•´å…ƒæ•°æ®ï¼ˆä½œè€…ã€æ—¶é—´ã€è¯´æ˜ï¼‰ï¼Œä¼šè¢« Git æ°¸ä¹…è·Ÿè¸ªï¼Œé€‚åˆæ­£å¼ç‰ˆæœ¬ï¼ˆå¦‚ v1.0ã€v2.0ï¼‰ï¼›\nè½»é‡æ ‡ç­¾ï¼ˆLightweightï¼‰ï¼šä»…ä¸ºæäº¤ ID çš„â€œåˆ«åâ€ï¼Œæ— å…ƒæ•°æ®ï¼Œé€‚åˆä¸´æ—¶æ ‡è®°ï¼ˆå¦‚æµ‹è¯•ç‰ˆæœ¬ï¼‰ï¼šgit tag v2.0-beta  # åˆ›å»ºè½»é‡æ ‡ç­¾git tag -d v2.0-beta  # åˆ é™¤è½»é‡æ ‡ç­¾ï¼ˆä¸åˆ é™¤å¸¦æ³¨é‡Šæ ‡ç­¾å‘½ä»¤ä¸€è‡´ï¼‰\n\n\n\n\næ¨é€æŒ‡å®šæ ‡ç­¾åˆ°è¿œç¨‹ï¼š\nè‹¥ä¸æƒ³æ¨é€æ‰€æœ‰æ ‡ç­¾ï¼Œå¯æŒ‡å®šå•ä¸ªæ ‡ç­¾ï¼š\ngit push origin v2.0  # ä»…æ¨é€æ ‡ç­¾ v2.0 åˆ°è¿œç¨‹\n\n\nåˆ é™¤è¿œç¨‹æ ‡ç­¾ï¼š\néœ€å…ˆåˆ é™¤æœ¬åœ°æ ‡ç­¾ï¼Œå†æ¨é€â€œåˆ é™¤æŒ‡ä»¤â€åˆ°è¿œç¨‹ï¼š\ngit tag -d v2.0  # åˆ é™¤æœ¬åœ°æ ‡ç­¾git push origin :refs/tags/v2.0  # åˆ é™¤è¿œç¨‹æ ‡ç­¾\n\n\næ£€å‡ºæ ‡ç­¾ï¼ˆæŸ¥çœ‹å†å²ç‰ˆæœ¬ï¼‰ï¼š\næ ‡ç­¾æ˜¯â€œé™æ€å¿«ç…§â€ï¼Œæ£€å‡ºåä¼šè¿›å…¥ detached HEAD çŠ¶æ€ï¼ˆæ— åˆ†æ”¯å…³è”ï¼‰ï¼Œè‹¥éœ€ä¿®æ”¹ï¼Œéœ€åˆ›å»ºæ–°åˆ†æ”¯ï¼š\ngit checkout v2.0  # æ£€å‡ºæ ‡ç­¾ v2.0ï¼ˆè¿›å…¥ detached HEAD çŠ¶æ€ï¼‰git checkout -b fix-v2.0 v2.0  # åŸºäºæ ‡ç­¾åˆ›å»ºæ–°åˆ†æ”¯ï¼Œç”¨äºä¿®å¤æ—§ç‰ˆæœ¬é—®é¢˜\n\n\nå…­ã€å·®å¼‚æ¯”è¾ƒï¼ˆdiffï¼‰\n1. æ ¸å¿ƒå‘½ä»¤æ•´ç†ï¼ˆåŸæ–‡å†…å®¹ï¼‰\n# æ˜¾ç¤ºå·¥ä½œåŒºä¸æš‚å­˜åŒºçš„å·®å¼‚ï¼ˆæœª git add çš„ä¿®æ”¹ï¼‰git diff# æ˜¾ç¤ºæš‚å­˜åŒºä¸æœ¬åœ°ä»“åº“çš„å·®å¼‚ï¼ˆå·² git add ä½†æœª git commit çš„ä¿®æ”¹ï¼‰git diff --cached# æ˜¾ç¤ºå·¥ä½œåŒºä¸ä¸Šä¸€æ¬¡æäº¤ï¼ˆHEAD^ï¼‰çš„å·®å¼‚git diff HEAD^# æ˜¾ç¤ºå·¥ä½œåŒºä¸ HEAD ç‰ˆæœ¬ä¸­æŒ‡å®šç›®å½•ï¼ˆlib/ï¼‰çš„å·®å¼‚git diff HEAD -- ./lib# æ˜¾ç¤ºè¿œç¨‹ master åˆ†æ”¯ä¸æœ¬åœ° master åˆ†æ”¯çš„å·®å¼‚ï¼ˆéœ€å…ˆ git fetchï¼‰git diff origin/master..master# ä»…æ˜¾ç¤ºå·®å¼‚æ–‡ä»¶åˆ—è¡¨ï¼ˆä¸æ˜¾ç¤ºå…·ä½“ä»£ç å˜æ›´ï¼Œé€‚åˆå¿«é€Ÿæ’æŸ¥ï¼‰git diff origin/master..master --stat\n2. è¡¥å……çŸ¥è¯†ä¸æ‰©å±•\n\n\næ¯”è¾ƒåˆ†æ”¯/æäº¤çš„å·®å¼‚ï¼š\n# æ¯”è¾ƒä¸¤ä¸ªåˆ†æ”¯çš„å·®å¼‚ï¼ˆå¦‚ feature/login ä¸ masterï¼‰git diff feature/login..master# æ¯”è¾ƒä¸¤ä¸ªæäº¤ä¹‹é—´çš„å·®å¼‚ï¼ˆéœ€è¾“å…¥ä¸¤ä¸ªæäº¤ IDï¼‰git diff dfb02..a8c3f  # æ˜¾ç¤º dfb02 åˆ° a8c3f ä¹‹é—´çš„å˜æ›´# æ¯”è¾ƒæŒ‡å®šæ–‡ä»¶åœ¨ä¸¤ä¸ªåˆ†æ”¯ä¸­çš„å·®å¼‚git diff feature/login master -- ./src/login.js\n\n\nå¿½ç•¥ç©ºç™½å­—ç¬¦å·®å¼‚ï¼š\nè‹¥ä»£ç ä»…è°ƒæ•´äº†ç©ºæ ¼/æ¢è¡Œï¼ˆæ— é€»è¾‘å˜æ›´ï¼‰ï¼Œå¯å¿½ç•¥ç©ºç™½å·®å¼‚ï¼š\ngit diff -w  # -w å¿½ç•¥æ‰€æœ‰ç©ºç™½å·®å¼‚git diff --ignore-space-at-eol  # ä»…å¿½ç•¥è¡Œå°¾ç©ºç™½å·®å¼‚\n\n\nä½¿ç”¨å·¥å…·å¯è§†åŒ– diffï¼š\nè‹¥è§‰å¾—å‘½ä»¤è¡Œ diff ä¸ç›´è§‚ï¼Œå¯ä½¿ç”¨å›¾å½¢åŒ–å·¥å…·ï¼ˆå¦‚ VS Codeï¼‰ï¼š\ngit difftool  # è°ƒç”¨é»˜è®¤å›¾å½¢åŒ–å·¥å…·æ˜¾ç¤ºå·®å¼‚git difftool --tool=vscode  # æŒ‡å®š VS Code ä¸º diff å·¥å…·\n\n\nä¸ƒã€è¿œç¨‹ä»“åº“æ“ä½œ\n1. æ ¸å¿ƒå‘½ä»¤æ•´ç†ï¼ˆåŸæ–‡å†…å®¹ï¼‰\n# æ·»åŠ è¿œç¨‹ä»“åº“ï¼ˆå‘½åä¸º originï¼Œé€šå¸¸ä¸ºé»˜è®¤è¿œç¨‹ä»“åº“åï¼‰git remote add origin git+ssh://git@192.168.53.168/VT.git# è·å–è¿œç¨‹ä»“åº“çš„æ‰€æœ‰æ›´æ–°ï¼ˆä¸åˆå¹¶åˆ°æœ¬åœ°åˆ†æ”¯ï¼Œä»…æ›´æ–°æœ¬åœ°ç¼“å­˜çš„è¿œç¨‹åˆ†æ”¯ï¼‰git fetch# è·å–è¿œç¨‹æ›´æ–°å¹¶æ¸…ç†æœ¬åœ°ç¼“å­˜ä¸­å·²è¢«è¿œç¨‹åˆ é™¤çš„åˆ†æ”¯ï¼ˆé¿å…æ— æ•ˆåˆ†æ”¯æ®‹ç•™ï¼‰git fetch --prune# æ‹‰å–è¿œç¨‹ master åˆ†æ”¯å¹¶åˆå¹¶åˆ°å½“å‰æœ¬åœ°åˆ†æ”¯ï¼ˆç­‰ä»·äº git fetch + git mergeï¼‰git pull origin master# æ¨é€å½“å‰æœ¬åœ°åˆ†æ”¯åˆ°è¿œç¨‹ master åˆ†æ”¯ï¼ˆè‹¥è¿œç¨‹æ— è¯¥åˆ†æ”¯åˆ™è‡ªåŠ¨åˆ›å»ºï¼‰git push origin master# åˆ é™¤è¿œç¨‹åˆ†æ”¯ï¼ˆhotfixes/BJVEP933ï¼Œæ ¼å¼ï¼šorigin:è¿œç¨‹åˆ†æ”¯åï¼‰git push origin :hotfixes/BJVEP933\n2. è¡¥å……çŸ¥è¯†ä¸æ‰©å±•\n\n\næŸ¥çœ‹è¿œç¨‹ä»“åº“ä¿¡æ¯ï¼š\ngit remote  # æŸ¥çœ‹æ‰€æœ‰è¿œç¨‹ä»“åº“åï¼ˆå¦‚ originï¼‰git remote -v  # æŸ¥çœ‹è¿œç¨‹ä»“åº“çš„è¯¦ç»†åœ°å€ï¼ˆfetch æ‹‰å–åœ°å€ã€push æ¨é€åœ°å€ï¼‰git remote show origin  # æŸ¥çœ‹ origin è¿œç¨‹ä»“åº“çš„è¯¦ç»†ä¿¡æ¯ï¼ˆå«åˆ†æ”¯å…³è”ã€æäº¤çŠ¶æ€ï¼‰\n\n\nä¿®æ”¹è¿œç¨‹ä»“åº“åœ°å€ï¼š\nè‹¥è¿œç¨‹ä»“åº“åœ°å€å˜æ›´ï¼ˆå¦‚ Git æœåŠ¡å™¨è¿ç§»ï¼‰ï¼Œæ— éœ€åˆ é™¤é‡å»ºï¼Œç›´æ¥ä¿®æ”¹ï¼š\n# æ–¹æ³• 1ï¼šä¿®æ”¹åœ°å€git remote set-url origin æ–°çš„è¿œç¨‹åœ°å€# æ–¹æ³• 2ï¼šå…ˆåˆ é™¤æ—§åœ°å€ï¼Œå†æ·»åŠ æ–°åœ°å€git remote remove origingit remote add origin æ–°çš„è¿œç¨‹åœ°å€\n\n\nSSH ä¸ HTTPS åœ°å€çš„åŒºåˆ«ï¼š\n\n\n\nç±»å‹\nä¼˜åŠ¿\nåŠ£åŠ¿\né€‚ç”¨åœºæ™¯\n\n\n\n\nSSH\næ— éœ€æ¯æ¬¡è¾“å…¥è´¦å·å¯†ç ï¼ˆé…ç½® SSH å¯†é’¥åï¼‰\néœ€æå‰é…ç½® SSH å¯†é’¥ï¼Œé¦–æ¬¡ setup ç¨å¤æ‚\né•¿æœŸå¼€å‘çš„ä¸ªäºº/å›¢é˜Ÿä»“åº“\n\n\nHTTPS\næ— éœ€é…ç½®å¯†é’¥ï¼Œç›´æ¥è¾“å…¥è´¦å·å¯†ç å³å¯è¿æ¥\næ¯æ¬¡æ¨é€éœ€è¾“å…¥è´¦å·å¯†ç ï¼ˆå¯é…ç½®å‡­æ®ç¼“å­˜ï¼‰\nä¸´æ—¶å…‹éš†ã€å…¬å…±ä»“åº“è®¿é—®\n\n\n\n\n\nå®‰å…¨æ¨é€æ›¿ä»£ git push --forceï¼š\nåŸæ–‡æç¤ºæ…ç”¨ git push --forceï¼ˆå¯èƒ½è¦†ç›–è¿œç¨‹æäº¤ï¼‰ï¼Œæ¨èæ›´å®‰å…¨çš„ --force-with-leaseï¼š\ngit push --force-with-lease origin master\nä½œç”¨ï¼šä»…å½“è¿œç¨‹åˆ†æ”¯æœªè¢«ä»–äººä¿®æ”¹æ—¶æ‰å¼ºåˆ¶æ¨é€ï¼Œè‹¥ä»–äººå·²æäº¤ï¼Œä¼šæç¤ºå†²çªï¼Œé¿å…è¯¯åˆ ä»–äººä»£ç ã€‚\n\n\nå…³è”æœ¬åœ°åˆ†æ”¯ä¸è¿œç¨‹åˆ†æ”¯ï¼š\né¦–æ¬¡æ¨é€æœ¬åœ°åˆ†æ”¯åˆ°è¿œç¨‹æ—¶ï¼Œå»ºè®®å…³è”åˆ†æ”¯ï¼ˆåç»­å¯ç›´æ¥ git pull/pushï¼Œæ— éœ€æŒ‡å®šè¿œç¨‹åˆ†æ”¯ï¼‰ï¼š\ngit push -u origin æœ¬åœ°åˆ†æ”¯å  # -u ç­‰ä»·äº --set-upstream# ç¤ºä¾‹ï¼šæ¨é€æœ¬åœ° feature/pay åˆ†æ”¯å¹¶å…³è”è¿œç¨‹åŒååˆ†æ”¯git push -u origin feature/pay\n\n\nå…«ã€åˆ†æ”¯ç®¡ç†\n1. æ ¸å¿ƒå‘½ä»¤æ•´ç†ï¼ˆåŸæ–‡å†…å®¹ï¼‰\n# æŸ¥çœ‹æœ¬åœ°æ‰€æœ‰åˆ†æ”¯ï¼ˆå½“å‰åˆ†æ”¯å‰å¸¦ * æ ‡è®°ï¼‰git branch# æŸ¥çœ‹åŒ…å«æŒ‡å®šæäº¤ï¼ˆ50089 ä¸ºçŸ­æäº¤ IDï¼‰çš„æ‰€æœ‰æœ¬åœ°åˆ†æ”¯git branch --contains 50089# æŸ¥çœ‹æ‰€æœ‰åˆ†æ”¯ï¼ˆæœ¬åœ° + è¿œç¨‹ï¼Œè¿œç¨‹åˆ†æ”¯ä»¥ remotes/origin/ å¼€å¤´ï¼‰git branch -a# ä»…æŸ¥çœ‹æ‰€æœ‰è¿œç¨‹åˆ†æ”¯git branch -r# æŸ¥çœ‹å·²åˆå¹¶åˆ°å½“å‰åˆ†æ”¯çš„æ‰€æœ‰æœ¬åœ°åˆ†æ”¯ï¼ˆå¯å®‰å…¨åˆ é™¤ï¼‰git branch --merged# æŸ¥çœ‹æœªåˆå¹¶åˆ°å½“å‰åˆ†æ”¯çš„æ‰€æœ‰æœ¬åœ°åˆ†æ”¯ï¼ˆåˆ é™¤éœ€è°¨æ…ï¼‰git branch --no-merged# é‡å‘½åæœ¬åœ°åˆ†æ”¯ï¼ˆå°† master é‡å‘½åä¸º master_copyï¼Œéœ€åœ¨éç›®æ ‡åˆ†æ”¯ä¸‹æ“ä½œï¼‰git branch -m master master_copy# åˆ é™¤æœ¬åœ°åˆ†æ”¯ï¼ˆä»…å½“åˆ†æ”¯å·²åˆå¹¶åˆ°å…¶ä»–åˆ†æ”¯æ—¶ç”Ÿæ•ˆï¼Œé¿å…è¯¯åˆ æœªåˆå¹¶ä»£ç ï¼‰git branch -d hotfixes/BJVEP933# å¼ºåˆ¶åˆ é™¤æœ¬åœ°åˆ†æ”¯ï¼ˆæ— è®ºæ˜¯å¦åˆå¹¶ï¼Œç”¨äºåˆ é™¤ç¡®å®šæ— ç”¨çš„åˆ†æ”¯ï¼‰git branch -D hotfixes/BJVEP933\n2. è¡¥å……çŸ¥è¯†ä¸æ‰©å±•\n\n\nGit 2.23+ æ–°å‘½ä»¤ï¼šgit switch ä¸ git restoreï¼š\nGit æ–°å¢æ›´ç›´è§‚çš„åˆ†æ”¯åˆ‡æ¢å‘½ä»¤ git switchï¼ˆæ›¿ä»£ git checkout çš„åˆ†æ”¯åˆ‡æ¢åŠŸèƒ½ï¼‰ï¼š\ngit switch master  # åˆ‡æ¢åˆ°å·²å­˜åœ¨çš„ master åˆ†æ”¯git switch -c feature/pay  # åˆ›å»ºå¹¶åˆ‡æ¢åˆ° feature/pay åˆ†æ”¯ï¼ˆ-c ç­‰ä»·äº --createï¼‰git switch -c feature/pay origin/feature/pay  # åŸºäºè¿œç¨‹åˆ†æ”¯åˆ›å»ºæœ¬åœ°åˆ†æ”¯å¹¶åˆ‡æ¢\n\n\næŸ¥çœ‹åˆ†æ”¯å…³è”çŠ¶æ€ï¼š\næŸ¥çœ‹æœ¬åœ°åˆ†æ”¯ä¸è¿œç¨‹åˆ†æ”¯çš„å…³è”å…³ç³»ï¼ˆæ˜¯å¦å·² --set-upstreamï¼‰ï¼š\ngit branch -vv  # æ˜¾ç¤ºæ¯ä¸ªåˆ†æ”¯çš„å…³è”è¿œç¨‹åˆ†æ”¯åŠæäº¤å·®å¼‚\n\n\næ¸…ç†æœ¬åœ°æ— æ•ˆåˆ†æ”¯ï¼š\nå½“è¿œç¨‹åˆ†æ”¯è¢«åˆ é™¤åï¼Œæœ¬åœ° git branch -a ä»ä¼šæ˜¾ç¤º remotes/origin/å·²åˆ é™¤åˆ†æ”¯ï¼Œå¯é€šè¿‡ä»¥ä¸‹å‘½ä»¤æ¸…ç†ï¼š\ngit fetch --prune  # æ¸…ç†æœ¬åœ°ç¼“å­˜çš„è¿œç¨‹å·²åˆ é™¤åˆ†æ”¯# æˆ–æ‰‹åŠ¨åˆ é™¤æœ¬åœ°è·Ÿè¸ªçš„æ— æ•ˆè¿œç¨‹åˆ†æ”¯git branch -r | grep -v &#x27;origin/master&#x27; | xargs -I &#123;&#125; git branch --delete --remotes &#123;&#125;\n\n\nä¹ã€åˆ†æ”¯æ£€å‡ºä¸åˆå¹¶\n1. æ ¸å¿ƒå‘½ä»¤æ•´ç†ï¼ˆåŸæ–‡å†…å®¹ï¼‰\n# åˆ›å»ºå¹¶åˆ‡æ¢åˆ°æ–°åˆ†æ”¯ï¼ˆmaster_copyï¼Œç­‰ä»·äº git branch master_copy + git checkout master_copyï¼‰git checkout -b master_copy# ä»è¿œç¨‹ develop åˆ†æ”¯åˆ›å»ºæœ¬åœ° devel åˆ†æ”¯å¹¶åˆ‡æ¢git checkout -b devel origin/develop# æ£€å‡ºå·²å­˜åœ¨çš„åˆ†æ”¯ï¼ˆfeatures/performanceï¼‰git checkout features/performance# è·Ÿè¸ªè¿œç¨‹åˆ†æ”¯ï¼ˆå°†æœ¬åœ° hotfixes/BJVEP933 ä¸è¿œç¨‹åŒååˆ†æ”¯å…³è”ï¼Œåç»­å¯ç›´æ¥ git pull/pushï¼‰git checkout --track hotfixes/BJVEP933# åˆ‡æ¢åˆ°æ ‡ç­¾ç‰ˆæœ¬ï¼ˆv2.0ï¼Œä¼šè¿›å…¥ detached HEAD çŠ¶æ€ï¼‰git checkout v2.0# å›é€€å•ä¸ªæ–‡ä»¶åˆ°ä¸Šä¸€æ¬¡æäº¤çš„çŠ¶æ€ï¼ˆæ”¾å¼ƒå·¥ä½œåŒºä¿®æ”¹ï¼Œéœ€è°¨æ…ï¼‰git checkout -- README.md# å°†è¿œç¨‹ master åˆ†æ”¯åˆå¹¶åˆ°å½“å‰æœ¬åœ°åˆ†æ”¯git merge origin/master# åº”ç”¨æŒ‡å®šæäº¤ï¼ˆff44785404a8e ä¸ºæäº¤ IDï¼‰åˆ°å½“å‰åˆ†æ”¯ï¼ˆå¸¸ç”¨äºè·¨åˆ†æ”¯å¤ç”¨å•ä¸ªæäº¤ï¼‰git cherry-pick ff44785404a8e\n2. è¡¥å……çŸ¥è¯†ä¸æ‰©å±•\n\n\ngit merge ä¸ git rebase çš„åŒºåˆ«ï¼ˆæ ¸å¿ƒæ‰©å±•ï¼ï¼‰ï¼š\nä¸¤è€…å‡ç”¨äºåˆå¹¶åˆ†æ”¯ï¼Œä½†æäº¤å†å²ä¸åŒï¼Œé€‚ç”¨åœºæ™¯ä¸åŒï¼š\n\n\n\næ“ä½œ\næäº¤å†å²\né€‚ç”¨åœºæ™¯\né£é™©\n\n\n\n\ngit merge\nä¿ç•™åˆ†æ”¯åˆå¹¶è®°å½•ï¼ˆç”Ÿæˆä¸€ä¸ªâ€œåˆå¹¶æäº¤â€ï¼‰ï¼Œå†å²æ›´å®Œæ•´\nå›¢é˜Ÿåä½œçš„å…¬å…±åˆ†æ”¯ï¼ˆå¦‚ masterï¼‰åˆå¹¶åŠŸèƒ½åˆ†æ”¯\næ— ï¼ˆä¸ä¿®æ”¹å·²æœ‰æäº¤å†å²ï¼‰\n\n\ngit rebase\nå°†å½“å‰åˆ†æ”¯çš„æäº¤â€œç§»æ¤â€åˆ°ç›®æ ‡åˆ†æ”¯æœ«å°¾ï¼Œå†å²æ›´ç®€æ´ï¼ˆæ— åˆå¹¶æäº¤ï¼‰\nä¸ªäººå¼€å‘åˆ†æ”¯ï¼ˆå¦‚ feature/*ï¼‰åˆå¹¶åˆ° master å‰æ•´ç†å†å²\næœ‰ï¼ˆä¿®æ”¹å·²æœ‰æäº¤å†å²ï¼Œç¦æ­¢å¯¹å·²æ¨é€åˆ°è¿œç¨‹çš„å…¬å…±åˆ†æ”¯ä½¿ç”¨ï¼‰\n\n\n\nç¤ºä¾‹ï¼šå°† feature/login åˆ†æ”¯åˆå¹¶åˆ° master\n# æ–¹æ³• 1ï¼šmergeï¼ˆä¿ç•™åˆå¹¶è®°å½•ï¼‰git checkout mastergit pull origin mastergit merge feature/logingit push origin master# æ–¹æ³• 2ï¼šrebaseï¼ˆæ•´ç†å†å²ï¼Œä»…ç”¨äºä¸ªäººåˆ†æ”¯ï¼‰git checkout feature/logingit rebase master  # è§£å†³å†²çªågit checkout mastergit merge feature/login  # æ­¤æ—¶ä¸ºâ€œå¿«è¿›åˆå¹¶â€ï¼Œæ— åˆå¹¶æäº¤git push origin master\n\n\ngit cherry-pick é«˜çº§ç”¨æ³•ï¼š\n# åº”ç”¨å¤šä¸ªè¿ç»­æäº¤ï¼ˆä» a8c3f åˆ° dfb02ï¼Œå·¦å¼€å³é—­ï¼Œå³åŒ…å« dfb02 ä¸åŒ…å« a8c3fï¼‰git cherry-pick a8c3f..dfb02# åº”ç”¨æäº¤æ—¶ä¿ç•™åŸä½œè€…ä¿¡æ¯git cherry-pick -x ff44785  # -x ä¼šåœ¨æäº¤è¯´æ˜ä¸­æ·»åŠ â€œ(cherry picked from commit ...)â€# è§£å†³ cherry-pick å†²çªåç»§ç»­git cherry-pick --continue# æ”¾å¼ƒ cherry-pickgit cherry-pick --abort\n\n\nåˆå¹¶å†²çªè§£å†³æ­¥éª¤ï¼ˆåŸæ–‡æœªè¯¦ç»†è¯´æ˜ï¼Œè¡¥å……æ ¸å¿ƒæµç¨‹ï¼‰ï¼š\nå½“ git merge æˆ– git rebase å‡ºç°å†²çªæ—¶ï¼ŒæŒ‰ä»¥ä¸‹æ­¥éª¤è§£å†³ï¼š\n\næŸ¥çœ‹å†²çªæ–‡ä»¶ï¼šå†²çªæ–‡ä»¶ä¸­ä¼šç”¨ &lt;&lt;&lt;&lt;&lt;&lt;&lt; HEADï¼ˆå½“å‰åˆ†æ”¯å†…å®¹ï¼‰ã€=======ï¼ˆç›®æ ‡åˆ†æ”¯å†…å®¹ï¼‰ã€&gt;&gt;&gt;&gt;&gt;&gt;&gt; åˆ†æ”¯å æ ‡è®°å†²çªåŒºåŸŸï¼›\nç¼–è¾‘å†²çªæ–‡ä»¶ï¼šåˆ é™¤å†²çªæ ‡è®°ï¼Œä¿ç•™æ­£ç¡®çš„ä»£ç ï¼›\næ ‡è®°å†²çªå·²è§£å†³ï¼šgit add å†²çªæ–‡ä»¶è·¯å¾„ï¼›\nç»§ç»­åˆå¹¶/å˜åŸºï¼š\n\nè‹¥ä¸º git mergeï¼šgit commit -m &quot;merge: è§£å†³ä¸ master åˆ†æ”¯çš„å†²çª&quot;ï¼ˆæˆ– Git è‡ªåŠ¨æç¤ºæäº¤ï¼‰ï¼›\nè‹¥ä¸º git rebaseï¼šgit rebase --continueï¼›\n\n\nï¼ˆå¯é€‰ï¼‰æ”¾å¼ƒåˆå¹¶/å˜åŸºï¼šgit merge --abort æˆ– git rebase --abortã€‚\n\n\n\nåã€ç‰ˆæœ¬æ§åˆ¶æ“ä½œï¼ˆreset/rebase/revertï¼‰\n1. æ ¸å¿ƒå‘½ä»¤æ•´ç†ï¼ˆåŸæ–‡å†…å®¹ï¼‰\n# é‡ç½®å½“å‰åˆ†æ”¯åˆ° HEAD çŠ¶æ€ï¼ˆ--hard ä¼šæ”¾å¼ƒå·¥ä½œåŒºå’Œæš‚å­˜åŒºçš„æ‰€æœ‰ä¿®æ”¹ï¼Œéœ€æåº¦è°¨æ…ï¼ï¼‰git reset --hard HEAD# å˜åŸºæ“ä½œï¼ˆæ•´ç†æäº¤å†å²ï¼Œé»˜è®¤åŸºäºå½“å‰åˆ†æ”¯çš„ä¸Šæ¸¸åˆ†æ”¯ï¼Œéœ€ç»“åˆ -i ä½¿ç”¨ï¼‰git rebase# æ’¤é”€æŒ‡å®šæäº¤ï¼ˆåˆ›å»ºä¸€ä¸ªæ–°æäº¤æŠµæ¶ˆåŸæäº¤çš„å˜æ›´ï¼Œä¸ä¿®æ”¹å†å²ï¼Œé€‚åˆå·²æ¨é€çš„æäº¤ï¼‰git revert dfb02e6e4f2f7b573337763e5c0013802e392818\n2. è¡¥å……çŸ¥è¯†ä¸æ‰©å±•\n\n\ngit reset çš„ä¸‰ç§æ¨¡å¼ï¼ˆæ ¸å¿ƒåŒºåˆ«ï¼ï¼‰ï¼š\ngit reset ç”¨äºâ€œå›æ»šâ€ç‰ˆæœ¬ï¼Œä¸åŒæ¨¡å¼å¯¹å·¥ä½œåŒºã€æš‚å­˜åŒºçš„å½±å“ä¸åŒï¼š\n\n\n\næ¨¡å¼\nå·¥ä½œåŒº\næš‚å­˜åŒº\næœ¬åœ°ä»“åº“\né€‚ç”¨åœºæ™¯\n\n\n\n\n--soft\nä¿ç•™ä¿®æ”¹\nä¿ç•™ä¿®æ”¹\nå›æ»šåˆ°æŒ‡å®šç‰ˆæœ¬\næ’¤é”€ git commitï¼Œä½†ä¿ç•™å·² git add çš„å†…å®¹ï¼ˆå¦‚æäº¤ä¿¡æ¯å†™é”™ï¼‰\n\n\n--mixedï¼ˆé»˜è®¤ï¼‰\nä¿ç•™ä¿®æ”¹\nå›æ»š\nå›æ»šåˆ°æŒ‡å®šç‰ˆæœ¬\næ’¤é”€ git commit å’Œ git addï¼Œä½†ä¿ç•™å·¥ä½œåŒºä¿®æ”¹ï¼ˆå¦‚è¯¯ add ä¸éœ€è¦çš„æ–‡ä»¶ï¼‰\n\n\n--hard\nå›æ»šï¼ˆåˆ é™¤ä¿®æ”¹ï¼‰\nå›æ»š\nå›æ»šåˆ°æŒ‡å®šç‰ˆæœ¬\nå½»åº•æ”¾å¼ƒæ‰€æœ‰ä¿®æ”¹ï¼Œå›åˆ°æŒ‡å®šç‰ˆæœ¬ï¼ˆå¦‚ä»£ç å®Œå…¨é”™è¯¯ï¼Œéœ€ä»å¤´å¼€å§‹ï¼‰\n\n\n\nç¤ºä¾‹ï¼š\ngit reset --soft HEAD~1  # æ’¤é”€ä¸Šä¸€æ¬¡ commitï¼Œä¿ç•™æš‚å­˜åŒºï¼ˆåŸæ–‡ FAQ 4 ç”¨åˆ°ï¼‰git reset --mixed HEAD~1  # æ’¤é”€ä¸Šä¸€æ¬¡ commit å’Œ addï¼Œä¿ç•™å·¥ä½œåŒºgit reset --hard HEAD~1  # æ’¤é”€ä¸Šä¸€æ¬¡ commitã€addï¼Œä¸”åˆ é™¤å·¥ä½œåŒºä¿®æ”¹ï¼ˆå±é™©ï¼ï¼‰\n\n\ngit rebase -iï¼ˆäº¤äº’å¼å˜åŸºï¼Œæ•´ç†æäº¤å†å²ï¼‰ï¼š\nç”¨äºåˆå¹¶å¤šä¸ªå°æäº¤ã€ä¿®æ”¹æäº¤è¯´æ˜ã€åˆ é™¤æ— ç”¨æäº¤ï¼Œä»…é€‚ç”¨äºæœªæ¨é€åˆ°è¿œç¨‹çš„åˆ†æ”¯ï¼š\n# æ•´ç†æœ€è¿‘ 3 æ¬¡æäº¤ï¼ˆHEAD~3 è¡¨ç¤ºå¾€å‰æ•° 3 ä¸ªç‰ˆæœ¬ï¼‰git rebase -i HEAD~3\næ‰§è¡Œåä¼šè¿›å…¥ç¼–è¾‘å™¨ï¼Œæ˜¾ç¤ºæœ€è¿‘ 3 æ¬¡æäº¤ï¼Œæ¯è¡Œå¼€å¤´ä¸º pickï¼ˆä¿ç•™è¯¥æäº¤ï¼‰ï¼Œå¯ä¿®æ”¹ä¸ºï¼š\n\nrewordï¼ˆä¿®æ”¹æäº¤è¯´æ˜ï¼‰ï¼›\nsquashï¼ˆå°†å½“å‰æäº¤åˆå¹¶åˆ°ä¸Šä¸€ä¸ªæäº¤ï¼‰ï¼›\ndropï¼ˆåˆ é™¤å½“å‰æäº¤ï¼‰ï¼›\nä¿å­˜åæŒ‰æç¤ºå®Œæˆå˜åŸºï¼Œæœ€ç»ˆå°†å¤šä¸ªå°æäº¤åˆå¹¶ä¸ºä¸€ä¸ªæ¸…æ™°çš„æäº¤ã€‚\n\n\n\ngit revert ä¸ git reset çš„åŒºåˆ«ï¼š\n\n\n\næ“ä½œ\nå¯¹å†å²çš„å½±å“\né€‚ç”¨åœºæ™¯\né£é™©\n\n\n\n\ngit revert\nåˆ›å»ºæ–°æäº¤æŠµæ¶ˆåŸæäº¤ï¼Œä¸ä¿®æ”¹å†å²\næ’¤é”€å·²æ¨é€åˆ°è¿œç¨‹çš„æäº¤ï¼ˆé¿å…å½±å“ä»–äººï¼‰\næ— \n\n\ngit reset\nç›´æ¥ä¿®æ”¹åˆ†æ”¯æŒ‡é’ˆï¼Œåˆ é™¤å†å²æäº¤\næ’¤é”€æœªæ¨é€åˆ°è¿œç¨‹çš„æœ¬åœ°æäº¤\næœ‰ï¼ˆä¿®æ”¹å†å²ï¼Œè¿œç¨‹å·²æœ‰çš„æäº¤æ— æ³•ç”¨ reset æ’¤é”€ï¼‰\n\n\n\nç¤ºä¾‹ï¼šæ’¤é”€å·²æ¨é€çš„æäº¤ dfb02\ngit revert dfb02  # ä¼šè‡ªåŠ¨åˆ›å»ºä¸€ä¸ªæ–°æäº¤ï¼Œè¯´æ˜ä¸ºâ€œRevert &quot;åŸæäº¤è¯´æ˜&quot;â€git push origin master  # æ¨é€æ–°æäº¤åˆ°è¿œç¨‹ï¼Œå®Œæˆæ’¤é”€\n\n\nåä¸€ã€æš‚å­˜ä¸æ¢å¤ï¼ˆstashï¼‰\n1. æ ¸å¿ƒå‘½ä»¤æ•´ç†ï¼ˆåŸæ–‡å†…å®¹ï¼‰\n# æš‚å­˜å½“å‰å·¥ä½œåŒºå’Œæš‚å­˜åŒºçš„æ‰€æœ‰ä¿®æ”¹ï¼ˆæœªæäº¤çš„å†…å®¹ï¼‰ï¼Œä¿å­˜ä¸ºä¸€ä¸ªâ€œå¿«ç…§â€git stash# æŸ¥çœ‹æ‰€æœ‰æš‚å­˜çš„å¿«ç…§åˆ—è¡¨ï¼ˆæŒ‰åˆ›å»ºæ—¶é—´æ’åºï¼Œstash@&#123;0&#125; ä¸ºæœ€æ–°ï¼‰git stash list# æŸ¥çœ‹æŒ‡å®š stash å¿«ç…§çš„å…·ä½“å†…å®¹ï¼ˆstash@&#123;0&#125; ä¸ºæœ€æ–°å¿«ç…§ï¼‰git stash show -p stash@&#123;0&#125;# åº”ç”¨æŒ‡å®š stash å¿«ç…§åˆ°å½“å‰å·¥ä½œåŒºï¼ˆåº”ç”¨åå¿«ç…§ä»ä¿ç•™ï¼‰git stash apply stash@&#123;0&#125;\n2. è¡¥å……çŸ¥è¯†ä¸æ‰©å±•\n\n\nstash çš„å¸¸ç”¨æ‰©å±•å‘½ä»¤ï¼š\n# æš‚å­˜æ—¶æ·»åŠ å¤‡æ³¨ï¼ˆæ–¹ä¾¿åç»­è¯†åˆ«å¿«ç…§å†…å®¹ï¼Œæ¨èï¼ï¼‰git stash save &quot;å¼€å‘åˆ°ä¸€åŠçš„ç™»å½•åŠŸèƒ½&quot;# åº”ç”¨æœ€æ–°å¿«ç…§å¹¶åˆ é™¤è¯¥å¿«ç…§ï¼ˆç­‰ä»·äº apply + dropï¼Œå¸¸ç”¨ï¼‰git stash pop  # åº”ç”¨ stash@&#123;0&#125; å¹¶åˆ é™¤git stash pop stash@&#123;1&#125;  # åº”ç”¨ stash@&#123;1&#125; å¹¶åˆ é™¤# åˆ é™¤æŒ‡å®šå¿«ç…§ï¼ˆæ— éœ€åº”ç”¨æ—¶ï¼‰git stash drop stash@&#123;0&#125;# åˆ é™¤æ‰€æœ‰å¿«ç…§ï¼ˆæ¸…ç†æ— ç”¨ stashï¼‰git stash clear# åŸºäº stash å¿«ç…§åˆ›å»ºæ–°åˆ†æ”¯ï¼ˆé€‚ç”¨äºå¿«ç…§å†…å®¹å¤æ‚ï¼Œé¿å…ä¸å½“å‰åˆ†æ”¯å†²çªï¼‰git stash branch new-branch stash@&#123;0&#125;\n\n\nstash çš„æ³¨æ„äº‹é¡¹ï¼š\n\nstash ä»…æš‚å­˜å·²è·Ÿè¸ªæ–‡ä»¶çš„ä¿®æ”¹å’Œæš‚å­˜åŒºçš„å˜æ›´ï¼Œæœªè·Ÿè¸ªçš„æ–°æ–‡ä»¶ä¸ä¼šè¢«æš‚å­˜ï¼›\nè‹¥éœ€æš‚å­˜æœªè·Ÿè¸ªæ–‡ä»¶ï¼Œéœ€åŠ  -uï¼ˆâ€“include-untrackedï¼‰ï¼šgit stash -u  # æš‚å­˜å·²è·Ÿè¸ªæ–‡ä»¶ä¿®æ”¹ + æœªè·Ÿè¸ªæ–‡ä»¶\n\nè‹¥éœ€æš‚å­˜å¿½ç•¥æ–‡ä»¶ï¼ˆ.gitignore ä¸­çš„æ–‡ä»¶ï¼‰ï¼Œéœ€åŠ  -aï¼ˆâ€“allï¼‰ï¼šgit stash -a  # æš‚å­˜æ‰€æœ‰ä¿®æ”¹ï¼ˆå·²è·Ÿè¸ª + æœªè·Ÿè¸ª + å¿½ç•¥æ–‡ä»¶ï¼‰\n\n\n\n\nåäºŒã€æ–‡ä»¶æŸ¥æ‰¾ä¸æ—¥å¿—è¾…åŠ©\n1. æ ¸å¿ƒå‘½ä»¤æ•´ç†ï¼ˆåŸæ–‡å†…å®¹ï¼‰\n# åœ¨æ‰€æœ‰è·Ÿè¸ªæ–‡ä»¶ä¸­æŸ¥æ‰¾å«â€œdelete fromâ€å…³é”®è¯çš„å†…å®¹ï¼ˆæ”¯æŒæ­£åˆ™ï¼‰git grep &quot;delete from&quot;# æŸ¥æ‰¾åŒæ—¶åŒ…å«â€œ#defineâ€å’Œâ€œSORT_DIRENTâ€çš„å†…å®¹ï¼ˆ--and è¡¨ç¤ºé€»è¾‘ä¸ï¼‰git grep -e &#x27;#define&#x27; --and -e SORT_DIRENT# åˆ—å‡ºå½“å‰æš‚å­˜åŒºï¼ˆIndexï¼‰ä¸­çš„æ‰€æœ‰æ–‡ä»¶ï¼ˆå³å·²è·Ÿè¸ªçš„æ–‡ä»¶ï¼‰git ls-files# æ˜¾ç¤ºæœ€è¿‘ä¿®æ”¹è¿‡çš„æ–‡ä»¶å†å²ï¼ˆå«æ¯æ¬¡ä¿®æ”¹çš„æäº¤ä¿¡æ¯ï¼‰git whatchanged# æŸ¥çœ‹æ‰€æœ‰å¼•ç”¨çš„å†å²è®°å½•ï¼ˆåŒ…æ‹¬å·²åˆ é™¤çš„åˆ†æ”¯ã€reset å›æ»šçš„æäº¤ï¼Œæ¯” git log æ›´å…¨é¢ï¼‰git reflog# æŸ¥çœ‹ HEAD å¼•ç”¨å†å²ä¸­ç¬¬ 5 ä¸ªçŠ¶æ€çš„æäº¤è¯¦æƒ…git show HEAD@&#123;5&#125;# æŸ¥çœ‹ master åˆ†æ”¯æ˜¨å¤©çš„çŠ¶æ€å¯¹åº”çš„æäº¤è¯¦æƒ…git show master@&#123;yesterday&#125;\n2. è¡¥å……çŸ¥è¯†ä¸æ‰©å±•\n\n\ngit grep é«˜çº§ç”¨æ³•ï¼š\n# ä»…æ˜¾ç¤ºåŒ¹é…è¡Œçš„è¡Œå·git grep -n &quot;delete from&quot;# æ˜¾ç¤ºåŒ¹é…æ–‡ä»¶çš„æ–‡ä»¶åï¼Œä¸æ˜¾ç¤ºå…·ä½“è¡Œå†…å®¹git grep -l &quot;delete from&quot;# åœ¨æŒ‡å®šåˆ†æ”¯ï¼ˆå¦‚ developï¼‰ä¸­æŸ¥æ‰¾å…³é”®è¯git grep &quot;delete from&quot; develop# åœ¨æŒ‡å®šç›®å½•ï¼ˆå¦‚ src/ï¼‰ä¸­æŸ¥æ‰¾å…³é”®è¯git grep &quot;delete from&quot; src/\n\n\ngit reflog çš„å…³é”®ä½œç”¨ï¼š\ngit reflog è®°å½•äº† Git ä»“åº“ä¸­æ‰€æœ‰å¼•ç”¨ï¼ˆHEADã€åˆ†æ”¯ã€æ ‡ç­¾ï¼‰çš„å˜æ›´å†å²ï¼Œæ˜¯â€œæ•‘å›è¯¯åˆ å†…å®¹â€çš„æ ¸å¿ƒå·¥å…·ï¼š\n\næ¢å¤è¯¯åˆ çš„åˆ†æ”¯ï¼šé€šè¿‡ git reflog æ‰¾åˆ°åˆ†æ”¯åˆ é™¤å‰çš„æœ€åä¸€ä¸ªæäº¤ IDï¼Œå†åˆ›å»ºåˆ†æ”¯ï¼ˆåŸæ–‡ FAQ 6 ç”¨åˆ°ï¼‰ï¼›\næ¢å¤ git reset --hard è¯¯åˆ çš„å·¥ä½œåŒºï¼šæ‰¾åˆ° reset å‰çš„æäº¤ IDï¼Œç”¨ git reset --hard æäº¤ID æ¢å¤ï¼›\nç¤ºä¾‹ï¼šæ¢å¤è¯¯åˆ çš„ feature/pay åˆ†æ”¯\n\ngit reflog  # æ‰¾åˆ° feature/pay åˆ†æ”¯æœ€åçš„æäº¤ IDï¼Œå¦‚ a8c3fgit checkout -b feature/pay a8c3f  # åŸºäºè¯¥æäº¤é‡å»ºåˆ†æ”¯\n\n\nåä¸‰ã€ä½å±‚æ“ä½œï¼ˆäº†è§£å³å¯ï¼‰\n1. æ ¸å¿ƒå‘½ä»¤æ•´ç†ï¼ˆåŸæ–‡å†…å®¹ï¼‰\n# ä»¥æ–‡æœ¬å›¾ç¤ºæ˜¾ç¤ºåˆ†æ”¯å…³ç³»ï¼ˆå«æäº¤ä¿¡æ¯ï¼‰git show-branch# æ˜¾ç¤ºæ‰€æœ‰åˆ†æ”¯ï¼ˆæœ¬åœ° + è¿œç¨‹ï¼‰çš„å…³ç³»å›¾ç¤ºgit show-branch --all# æŸ¥çœ‹ HEAD æŒ‡å‘çš„æäº¤å¯¹è±¡ä¸‹çš„æ–‡ä»¶ç»“æ„ï¼ˆå«æ–‡ä»¶ç±»å‹ã€SHA1 å€¼ã€æ–‡ä»¶åï¼‰git ls-tree HEAD# æŸ¥çœ‹æ ‡ç­¾ v2.0 å¯¹åº”çš„æäº¤å¯¹è±¡çš„ SHA1 å€¼ï¼ˆå°†å¼•ç”¨è½¬æ¢ä¸ºå…·ä½“æäº¤ IDï¼‰git rev-parse v2.0# æ˜¾ç¤ºæŒ‡å®šæäº¤ï¼ˆ2be7fcb476ï¼‰çš„ç®€åŒ–åŸå§‹ä¿¡æ¯ï¼ˆä¸å«ä»£ç å˜æ›´ï¼Œä»…å…ƒæ•°æ®ï¼‰git show -s --pretty=raw 2be7fcb476# åƒåœ¾å›æ”¶ï¼ˆä¼˜åŒ–ä»“åº“ï¼Œæ¸…ç†æ— ç”¨å¯¹è±¡ã€åˆå¹¶æ¾æ•£å¯¹è±¡ï¼Œå‡å°ä»“åº“ä½“ç§¯ï¼‰git gc# ä»“åº“å®Œæ•´æ€§æ£€æŸ¥ï¼ˆæ£€æµ‹æŸåçš„å¯¹è±¡æˆ–å¼•ç”¨ï¼Œä¿®å¤ä»“åº“é—®é¢˜ï¼‰git fsck\n2. è¡¥å……çŸ¥è¯†ä¸æ‰©å±•\n\n\nä½å±‚æ“ä½œçš„é€‚ç”¨åœºæ™¯ï¼š\nè¿™äº›å‘½ä»¤ä¸»è¦ç”¨äº Git å†…éƒ¨åŸç†å­¦ä¹ æˆ–ä»“åº“æ•…éšœæ’æŸ¥ï¼Œæ—¥å¸¸å¼€å‘æå°‘ç”¨åˆ°ï¼š\n\ngit gcï¼šå½“ä»“åº“ä½“ç§¯è¿‡å¤§ï¼ˆå¦‚é¢‘ç¹æäº¤å¤§æ–‡ä»¶ï¼‰æ—¶ï¼Œæ‰‹åŠ¨æ‰§è¡Œå¯ä¼˜åŒ–æ€§èƒ½ï¼ŒGit ä¹Ÿä¼šåœ¨åå°è‡ªåŠ¨æ‰§è¡Œï¼›\ngit fsckï¼šå½“ä»“åº“æŠ¥é”™ï¼ˆå¦‚â€œcorrupt objectâ€ï¼‰æ—¶ï¼Œç”¨äºæ£€æµ‹æŸåçš„å¯¹è±¡ï¼Œè‹¥éœ€ä¿®å¤ï¼Œå¯èƒ½éœ€è¦ç»“åˆå¤‡ä»½çš„ .git/objects ç›®å½•ã€‚\n\n\n\nåå››ã€å¸¸è§ Git é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆï¼ˆFAQï¼‰\n1. åŸæ–‡é—®é¢˜æ•´ç†ä¸è¡¥å……\n1.1 fatal: not a git repositoryï¼ˆä¸æ˜¯ Git ä»“åº“ï¼‰\n\n\né”™è¯¯åŸå› ï¼šå½“å‰ç›®å½•æœªåˆå§‹åŒ– Git ä»“åº“ï¼ˆæ—  .git æ–‡ä»¶å¤¹ï¼‰ï¼Œæˆ–åˆ‡æ¢åˆ°äº†éä»“åº“ç›®å½•ã€‚\n\n\nè§£å†³æ–¹æ¡ˆï¼š\n# æ–¹æ¡ˆ 1ï¼šåœ¨å½“å‰ç›®å½•åˆå§‹åŒ–ä»“åº“ï¼ˆæ–°å»ºä»“åº“ï¼‰git init# æ–¹æ¡ˆ 2ï¼šåˆ‡æ¢åˆ°å·²å­˜åœ¨çš„ä»“åº“ç›®å½•ï¼ˆå‡è®¾ä»“åº“åœ¨ ~/project ä¸‹ï¼‰cd ~/project\n\n\n1.2 error: failed to push some refs to ...ï¼ˆæ¨é€å¤±è´¥ï¼‰\n\n\né”™è¯¯åŸå› ï¼šè¿œç¨‹åˆ†æ”¯æœ‰æœ¬åœ°æœªåŒæ­¥çš„æ–°æäº¤ï¼ˆæœ¬åœ°åˆ†æ”¯è½åäºè¿œç¨‹ï¼‰ï¼ŒGit é˜²æ­¢è¦†ç›–è¿œç¨‹ä»£ç è€Œæ‹’ç»æ¨é€ã€‚\n\n\nè§£å†³æ–¹æ¡ˆï¼ˆåŸæ–‡è¡¥å……ï¼‰ï¼š\n# æ–¹æ¡ˆ 1ï¼šæ‹‰å–è¿œç¨‹æ›´æ–°å¹¶åˆå¹¶ï¼ˆæ¨èï¼Œä¿ç•™åˆå¹¶è®°å½•ï¼‰git pull origin åˆ†æ”¯å  # å¦‚ git pull origin master# è§£å†³åˆå¹¶å†²çªåï¼Œå†æ¨é€git push origin åˆ†æ”¯å# æ–¹æ¡ˆ 2ï¼šæ‹‰å–è¿œç¨‹æ›´æ–°å¹¶å˜åŸºï¼ˆæ•´ç†å†å²ï¼Œä»…ç”¨äºä¸ªäººåˆ†æ”¯ï¼‰git pull --rebase origin åˆ†æ”¯å# è§£å†³å˜åŸºå†²çªåï¼Œå†æ¨é€git push origin åˆ†æ”¯å# æ–¹æ¡ˆ 3ï¼šå¼ºåˆ¶æ¨é€ï¼ˆä»…å½“è¿œç¨‹åˆ†æ”¯æ— ä»–äººä¿®æ”¹æ—¶ä½¿ç”¨ï¼Œæåº¦è°¨æ…ï¼ï¼‰git push --force-with-lease origin åˆ†æ”¯å  # æ¯” --force æ›´å®‰å…¨\n\n\n1.3 å¦‚ä½•æ’¤é”€ git addï¼Ÿï¼ˆå–æ¶ˆæš‚å­˜ï¼‰\n\n\nè§£å†³æ–¹æ¡ˆï¼ˆåŸæ–‡ + è¡¥å……ï¼‰ï¼š\n# æ–¹æ¡ˆ 1ï¼šé€‚ç”¨äºæ‰€æœ‰ Git ç‰ˆæœ¬ï¼ˆåŸæ–‡æ–¹æ¡ˆï¼‰git reset HEAD æ–‡ä»¶å  # å¦‚ git reset HEAD login.jsgit reset HEAD .  # æ’¤é”€å½“å‰ç›®å½•æ‰€æœ‰æ–‡ä»¶çš„æš‚å­˜# æ–¹æ¡ˆ 2ï¼šé€‚ç”¨äº Git 2.23+ï¼ˆæ›´ç›´è§‚ï¼‰git restore --staged æ–‡ä»¶å  # å¦‚ git restore --staged login.js\n\n\n1.4 å¦‚ä½•æ’¤é”€ git commitï¼Ÿï¼ˆæœªæ¨é€ï¼‰\n\n\né”™è¯¯åœºæ™¯ï¼šæäº¤ä¿¡æ¯å†™é”™ï¼Œæˆ–æ¼åŠ æ–‡ä»¶ï¼Œä¸”æœªæ¨é€åˆ°è¿œç¨‹ã€‚\n\n\nè§£å†³æ–¹æ¡ˆï¼ˆåŸæ–‡ + è¡¥å……ï¼‰ï¼š\n# æ–¹æ¡ˆ 1ï¼šä¿ç•™ä¿®æ”¹ï¼Œå›åˆ° commit å‰çš„æš‚å­˜çŠ¶æ€ï¼ˆåŸæ–‡æ–¹æ¡ˆï¼‰git reset --soft HEAD~1# æ–¹æ¡ˆ 2ï¼šä¿ç•™ä¿®æ”¹ï¼Œå›åˆ° commit å‰çš„å·¥ä½œåŒºçŠ¶æ€ï¼ˆå–æ¶ˆæš‚å­˜ï¼‰git reset --mixed HEAD~1  # ç­‰ä»·äº git reset HEAD~1ï¼ˆé»˜è®¤ --mixedï¼‰# æ–¹æ¡ˆ 3ï¼šç›´æ¥ä¿®æ”¹ä¸Šä¸€æ¬¡æäº¤ï¼ˆæ¨èï¼Œé¿å…å¤šä¸€æ¬¡ reset è®°å½•ï¼‰git commit --amend -m &quot;ä¿®æ­£åçš„æäº¤è¯´æ˜&quot;# è‹¥æ¼åŠ æ–‡ä»¶ï¼Œå…ˆ add å† amendgit add æ¼åŠ çš„æ–‡ä»¶.txtgit commit --amend --no-edit  # --no-edit ä¿ç•™åŸæäº¤è¯´æ˜\n\n\n1.5 å¦‚ä½•åˆ é™¤æŸæ¬¡ commitï¼Ÿï¼ˆæœªæ¨é€ï¼‰\n\n\né”™è¯¯åœºæ™¯ï¼šæŸæ¬¡æäº¤æœ‰è¯¯ï¼ˆå¦‚åŒ…å«æ•æ„Ÿä¿¡æ¯ï¼‰ï¼Œä¸”æœªæ¨é€åˆ°è¿œç¨‹ã€‚\n\n\nè§£å†³æ–¹æ¡ˆï¼ˆåŸæ–‡ + è¡¥å……ï¼‰ï¼š\n# æ–¹æ¡ˆ 1ï¼šäº¤äº’å¼å˜åŸºï¼ˆåŸæ–‡æ–¹æ¡ˆï¼Œæ¨èï¼‰git rebase -i HEAD~N  # N ä¸ºâ€œå½“å‰ç‰ˆæœ¬åˆ°ç›®æ ‡æäº¤â€çš„è·ç¦»ï¼ˆå¦‚åˆ é™¤æœ€è¿‘ç¬¬ 3 æ¬¡æäº¤ï¼ŒN=3ï¼‰# ç¼–è¾‘ç•Œé¢ä¸­ï¼Œå°†ç›®æ ‡æäº¤å‰çš„â€œpickâ€æ”¹ä¸ºâ€œdropâ€ï¼Œä¿å­˜é€€å‡º# è‹¥å‡ºç°å†²çªï¼Œè§£å†³åæ‰§è¡Œ git rebase --continue# æ–¹æ¡ˆ 2ï¼šreset å›æ»šï¼ˆé€‚ç”¨äºåˆ é™¤æœ€è¿‘çš„æäº¤ï¼‰git reset --hard ç›®æ ‡æäº¤ID  # å›æ»šåˆ°ç›®æ ‡æäº¤ï¼Œåˆ é™¤åç»­æ‰€æœ‰æäº¤# ç¤ºä¾‹ï¼šåˆ é™¤æœ€è¿‘ 2 æ¬¡æäº¤ï¼Œå›æ»šåˆ° HEAD~2 å¯¹åº”çš„æäº¤git reset --hard HEAD~2\n\n\nè­¦å‘Šï¼šä¸¥ç¦å¯¹å·²æ¨é€åˆ°è¿œç¨‹çš„æäº¤ä½¿ç”¨æ­¤æ–¹æ³•ï¼Œä¼šå¯¼è‡´å›¢é˜Ÿå†å²æ··ä¹±ï¼\n\n\n1.6 å¦‚ä½•æ¢å¤è¢«åˆ é™¤çš„åˆ†æ”¯ï¼Ÿ\n\n\nå‰æï¼šè¢«åˆ é™¤çš„åˆ†æ”¯æ›¾æœ‰æäº¤è®°å½•ï¼ˆå¯é€šè¿‡ git reflog æ‰¾åˆ°ï¼‰ã€‚\n\n\nè§£å†³æ–¹æ¡ˆï¼ˆåŸæ–‡ + è¡¥å……ï¼‰ï¼š\n# æ­¥éª¤ 1ï¼šæŸ¥çœ‹æ‰€æœ‰å¼•ç”¨å†å²ï¼Œæ‰¾åˆ°è¢«åˆ é™¤åˆ†æ”¯çš„æœ€åä¸€ä¸ªæäº¤ IDï¼ˆå¦‚ a8c3fï¼‰git reflog# æ­¥éª¤ 2ï¼šåŸºäºè¯¥æäº¤ ID é‡å»ºåˆ†æ”¯git checkout -b è¢«åˆ é™¤çš„åˆ†æ”¯å æäº¤ID  # å¦‚ git checkout -b feature/pay a8c3f# æ­¥éª¤ 3ï¼šï¼ˆè‹¥åˆ†æ”¯å·²æ¨é€åˆ°è¿œç¨‹ï¼‰é‡æ–°æ¨é€åˆ†æ”¯git push -u origin è¢«åˆ é™¤çš„åˆ†æ”¯å\n\n\n1.7 Git ä»“åº“çªç„¶å¾ˆå¤§ï¼Œæ€ä¹ˆæ’æŸ¥ï¼Ÿ\n\n\nåŸå› ï¼šä»“åº“ä¸­å­˜åœ¨å¤§æ–‡ä»¶ï¼ˆå¦‚å‹ç¼©åŒ…ã€æ—¥å¿—ï¼‰ï¼Œæˆ–å†å²æäº¤ä¸­åŒ…å«å¤§æ–‡ä»¶ã€‚\n\n\nè§£å†³æ–¹æ¡ˆï¼ˆåŸæ–‡ + è¡¥å……ï¼‰ï¼š\n# æ­¥éª¤ 1ï¼šæŸ¥çœ‹ä»“åº“ä¸­æœ€å¤§çš„ 20 ä¸ªæ–‡ä»¶ï¼ˆåŸæ–‡æ–¹æ¡ˆï¼‰git rev-list --objects --all | sort -k 2 | \\git cat-file --batch-check=&#x27;%(objecttype) %(objectname) %(objectsize) %(rest)&#x27; | \\grep ^blob | sort -k3 -n | tail -20# æ­¥éª¤ 2ï¼šåˆ é™¤å¤§æ–‡ä»¶ï¼ˆè‹¥æ–‡ä»¶æœªæäº¤ï¼Œç›´æ¥åˆ é™¤å¹¶æ·»åŠ åˆ° .gitignoreï¼‰rm å¤§æ–‡ä»¶è·¯å¾„echo &quot;å¤§æ–‡ä»¶è·¯å¾„&quot; &gt;&gt; .gitignoregit add .gitignoregit commit -m &quot;chore: å¿½ç•¥å¤§æ–‡ä»¶å¹¶åˆ é™¤&quot;# æ­¥éª¤ 3ï¼šè‹¥å¤§æ–‡ä»¶å·²æäº¤åˆ°å†å²ï¼Œéœ€æ¸…ç†å†å²ï¼ˆéœ€è°¨æ…ï¼Œä¼šä¿®æ”¹å†å²ï¼ï¼‰# ä½¿ç”¨ BFG Repo-Cleaner å·¥å…·ï¼ˆæ¯” git filter-branch æ›´å¿«ï¼‰# 1. å®‰è£… BFGï¼šhttps://rtyley.github.io/bfg-repo-cleaner/# 2. æ¸…ç†å†å²ä¸­çš„å¤§æ–‡ä»¶ï¼ˆå¦‚å¤§äº 100MB çš„æ–‡ä»¶ï¼‰bfg --strip-blobs-bigger-than 100M ä»“åº“è·¯å¾„# 3. ä¼˜åŒ–ä»“åº“git gc --prune=now --aggressive# 4. å¼ºåˆ¶æ¨é€ä¿®æ”¹åçš„å†å²ï¼ˆä»…åœ¨ä¸ªäººä»“åº“æˆ–å›¢é˜Ÿç¡®è®¤åæ‰§è¡Œï¼‰git push --force-with-lease origin master\n\n\n1.8 You have not concluded your mergeï¼ˆæœªå®Œæˆåˆå¹¶ï¼‰\n\n\né”™è¯¯åŸå› ï¼šä¸Šä¸€æ¬¡ git merge å‡ºç°å†²çªï¼Œæœªè§£å†³å®Œå°±ä¸­æ–­äº†æ“ä½œã€‚\n\n\nè§£å†³æ–¹æ¡ˆï¼ˆåŸæ–‡ + è¡¥å……ï¼‰ï¼š\n# æ–¹æ¡ˆ 1ï¼šæ”¾å¼ƒä¸Šä¸€æ¬¡åˆå¹¶ï¼Œå›åˆ°åˆå¹¶å‰çŠ¶æ€ï¼ˆæ¨èï¼Œé‡æ–°åˆå¹¶ï¼‰git merge --abort# æ–¹æ¡ˆ 2ï¼šç»§ç»­å®Œæˆåˆå¹¶ï¼ˆè‹¥å·²è§£å†³å†²çªï¼‰git add å†²çªæ–‡ä»¶è·¯å¾„  # æ ‡è®°å†²çªå·²è§£å†³git commit -m &quot;merge: å®Œæˆä¸ master åˆ†æ”¯çš„åˆå¹¶ï¼ˆè§£å†³å†²çªï¼‰&quot;\n\n\n1.9 detached HEADï¼ˆHEAD è„±ç¦»åˆ†æ”¯ï¼‰\n\n\nå«ä¹‰ï¼šHEAD ç›´æ¥æŒ‡å‘æŸä¸ªæäº¤ IDï¼Œè€Œéåˆ†æ”¯æŒ‡é’ˆï¼ˆå¸¸è§äºæ£€å‡ºæ ‡ç­¾ã€æ—§æäº¤ï¼‰ï¼Œæ­¤æ—¶ä¿®æ”¹æ— æ³•ç›´æ¥æäº¤åˆ°åˆ†æ”¯ã€‚\n\n\nè§£å†³æ–¹æ¡ˆï¼ˆåŸæ–‡ + è¡¥å……ï¼‰ï¼š\n# æ–¹æ¡ˆ 1ï¼šå›åˆ°å·²å­˜åœ¨çš„åˆ†æ”¯ï¼ˆå¦‚ masterï¼Œä¸¢å¼ƒ detached çŠ¶æ€çš„ä¿®æ”¹ï¼‰git checkout master# æ–¹æ¡ˆ 2ï¼šåŸºäºå½“å‰ detached çŠ¶æ€åˆ›å»ºæ–°åˆ†æ”¯ï¼ˆä¿ç•™ä¿®æ”¹ï¼Œæ¨èï¼‰git checkout -b new-branch  # æ–°å»ºåˆ†æ”¯å¹¶åˆ‡æ¢ï¼Œä¿®æ”¹ä¼šä¿ç•™åœ¨æ–°åˆ†æ”¯# æ–¹æ¡ˆ 3ï¼šè‹¥éœ€å°†ä¿®æ”¹æäº¤åˆ°å·²æœ‰åˆ†æ”¯ï¼ˆå¦‚ feature/payï¼‰git stash  # æš‚å­˜å½“å‰ä¿®æ”¹git checkout feature/pay  # åˆ‡æ¢åˆ°ç›®æ ‡åˆ†æ”¯git stash pop  # æ¢å¤ä¿®æ”¹git commit -m &quot;feat: ä» detached çŠ¶æ€æ¢å¤çš„ä¿®æ”¹&quot;\n\n\n1.10 å¿˜è®°æŸæ¬¡ commit ID æ€ä¹ˆåŠï¼Ÿ\n\n\nè§£å†³æ–¹æ¡ˆï¼ˆåŸæ–‡ + è¡¥å……ï¼‰ï¼š\n# æ–¹æ¡ˆ 1ï¼šæŸ¥çœ‹æ‰€æœ‰æäº¤å†å²ï¼ˆå«æäº¤ IDã€è¯´æ˜ï¼‰git log --oneline  # ç®€æ´æ˜¾ç¤ºï¼Œå¿«é€ŸæŸ¥æ‰¾# æ–¹æ¡ˆ 2ï¼šæŸ¥çœ‹æ‰€æœ‰å¼•ç”¨å†å²ï¼ˆåŒ…æ‹¬å·²åˆ é™¤çš„æäº¤ã€reset è®°å½•ï¼‰git reflog  # æ‰¾åˆ°ç›®æ ‡æäº¤çš„ IDï¼ˆå¦‚ a8c3fï¼‰# æ–¹æ¡ˆ 3ï¼šæŒ‰ä½œè€…/æ—¶é—´/å…³é”®è¯ç­›é€‰ï¼ˆç¼©å°èŒƒå›´ï¼‰git log --author=&quot;å¼ ä¸‰&quot; --since=&quot;1 week ago&quot; --grep=&quot;ç™»å½•&quot;\n\n\n2. è¡¥å……å¸¸è§é—®é¢˜\n2.1 å¦‚ä½•å¿½ç•¥å·²è·Ÿè¸ªçš„æ–‡ä»¶ï¼Ÿ\n\n\né—®é¢˜åœºæ™¯ï¼šå·² git add çš„æ–‡ä»¶ï¼ˆå¦‚é…ç½®æ–‡ä»¶ config.iniï¼‰ï¼Œåç»­æƒ³å¿½ç•¥ä½†ä¸åˆ é™¤æœ¬åœ°æ–‡ä»¶ã€‚\n\n\nè§£å†³æ–¹æ¡ˆï¼š\n# æ­¥éª¤ 1ï¼šä»æš‚å­˜åŒºç§»é™¤æ–‡ä»¶ï¼ˆä¿ç•™æœ¬åœ°æ–‡ä»¶ï¼‰git rm --cached config.ini# æ­¥éª¤ 2ï¼šå°†æ–‡ä»¶æ·»åŠ åˆ° .gitignoreecho &quot;config.ini&quot; &gt;&gt; .gitignore# æ­¥éª¤ 3ï¼šæäº¤ä¿®æ”¹git add .gitignoregit commit -m &quot;chore: å¿½ç•¥å·²è·Ÿè¸ªçš„ config.ini æ–‡ä»¶&quot;\n\n\næ³¨æ„ï¼š.gitignore ä»…å¯¹æœªè·Ÿè¸ªæ–‡ä»¶ç”Ÿæ•ˆï¼Œå·²è·Ÿè¸ªæ–‡ä»¶éœ€å…ˆ git rm --cachedã€‚\n\n\n2.2 å¦‚ä½•æ¢å¤è¢« git checkout -- æ–‡ä»¶ è¯¯åˆ çš„ä¿®æ”¹ï¼Ÿ\n\n\né—®é¢˜åœºæ™¯ï¼šæ‰§è¡Œ git checkout -- æ–‡ä»¶å åï¼Œå·¥ä½œåŒºä¿®æ”¹è¢«åˆ é™¤ï¼Œæœªæäº¤ä¹Ÿæœª stashã€‚\n\n\nè§£å†³æ–¹æ¡ˆï¼š\nè‹¥ä¿®æ”¹æœªè¢« git addï¼ŒGit æ— æ³•ç›´æ¥æ¢å¤ï¼Œä½†å¯å°è¯•é€šè¿‡ç¼–è¾‘å™¨çš„â€œæœ¬åœ°å†å²â€ï¼ˆå¦‚ VS Code çš„â€œæ–‡ä»¶ &gt; æ¢å¤æ–‡ä»¶â€ï¼‰æ¢å¤ï¼Œæˆ–ä½¿ç”¨ç¬¬ä¸‰æ–¹æ•°æ®æ¢å¤å·¥å…·ã€‚\n\n\né¢„é˜²ï¼šæ‰§è¡Œ git checkout -- æ–‡ä»¶ å‰ï¼Œå…ˆç”¨ git status ç¡®è®¤ä¿®æ”¹æ˜¯å¦éœ€è¦ä¿ç•™ï¼Œé‡è¦ä¿®æ”¹å…ˆ git stashã€‚\n\n\nåäº”ã€å®ç”¨æç¤ºä¸å·¥ä½œæµå»ºè®®\n1. åŸæ–‡æç¤ºè¡¥å……\n\n\nå–„ç”¨ git stashï¼šåˆ‡æ¢åˆ†æ”¯å‰è‹¥æœ‰æœªæäº¤çš„ä¿®æ”¹ï¼Œç”¨ git stash save &quot;å¤‡æ³¨&quot; æš‚å­˜ï¼Œé¿å…ä¿®æ”¹ä¸¢å¤±ï¼›\n\n\næ…ç”¨ git push --forceï¼šä¼˜å…ˆä½¿ç”¨ git push --force-with-leaseï¼Œè‹¥å¿…é¡» forceï¼Œéœ€å…ˆç¡®è®¤è¿œç¨‹åˆ†æ”¯æ— ä»–äººä¿®æ”¹ï¼›\n\n\nå®šæœŸä¼˜åŒ–ä»“åº“ï¼šæ‰§è¡Œ git gc æ¸…ç†æ— ç”¨å¯¹è±¡ï¼Œgit fetch --prune æ¸…ç†æ— æ•ˆè¿œç¨‹åˆ†æ”¯ï¼›\n\n\nå¯è§†åŒ–å·¥å…·è¾…åŠ©ï¼šæ–°æ‰‹æ¨èä½¿ç”¨ Sourcetreeï¼ˆå…è´¹ï¼‰ã€GitKrakenï¼ˆä»˜è´¹ï¼‰ï¼Œæˆ– IDE å†…ç½® Git å·¥å…·ï¼ˆVS Codeã€IntelliJ IDEAï¼‰ï¼Œé™ä½å‘½ä»¤è¡Œæ“ä½œé—¨æ§›ã€‚\n\n\n2. è¡¥å……ï¼šå¸¸ç”¨ Git å·¥ä½œæµ\n\n\n1. GitHub Flowï¼ˆç®€æ´ï¼Œé€‚ç”¨äºæŒç»­éƒ¨ç½²ï¼‰ï¼š\n\nä» main åˆ†æ”¯åˆ›å»º feature/bugfix åˆ†æ”¯ï¼›\næœ¬åœ°å¼€å‘ï¼Œé¢‘ç¹æäº¤å¹¶æ¨é€åˆ°è¿œç¨‹åŒååˆ†æ”¯ï¼›\nå¼€å‘å®Œæˆåï¼Œæäº¤ Pull Requestï¼ˆPRï¼‰ï¼›\nä»£ç å®¡æ ¸é€šè¿‡åï¼Œåˆå¹¶åˆ° main åˆ†æ”¯ï¼›\nåˆå¹¶ååˆ é™¤ feature/bugfix åˆ†æ”¯ï¼Œmain åˆ†æ”¯è‡ªåŠ¨éƒ¨ç½²ã€‚\n\n\n\n2. Git Flowï¼ˆè§„èŒƒï¼Œé€‚ç”¨äºç‰ˆæœ¬åŒ–å‘å¸ƒï¼‰ï¼š\næ ¸å¿ƒåˆ†æ”¯ï¼š\n\nmainï¼šç”Ÿäº§ç¯å¢ƒåˆ†æ”¯ï¼Œä»…å­˜æ”¾ç¨³å®šç‰ˆæœ¬ï¼›\ndevelopï¼šå¼€å‘ç¯å¢ƒåˆ†æ”¯ï¼Œé›†æˆå„åŠŸèƒ½åˆ†æ”¯ï¼›\nfeature/*ï¼šåŠŸèƒ½å¼€å‘åˆ†æ”¯ï¼ˆä» develop åˆ›å»ºï¼Œåˆå¹¶å› developï¼‰ï¼›\nhotfix/*ï¼šç”Ÿäº§ç¯å¢ƒç´§æ€¥ä¿®å¤åˆ†æ”¯ï¼ˆä» main åˆ›å»ºï¼Œåˆå¹¶å› main å’Œ developï¼‰ï¼›\nrelease/*ï¼šç‰ˆæœ¬å‘å¸ƒåˆ†æ”¯ï¼ˆä» develop åˆ›å»ºï¼Œåˆå¹¶å› main å’Œ developï¼Œå¹¶æ‰“æ ‡ç­¾ï¼‰ã€‚\n\n\n\n","categories":["ç¼–ç¨‹"],"tags":["å·¥å…·","Git"]},{"title":"IOå¤ç”¨+å®šæ—¶","url":"/2025/08/12/linux/IO%E5%A4%8D%E7%94%A8%20+%20%E5%AE%9A%E6%97%B6/","content":"\nå­¦ä¹ IOå¤ç”¨å’Œå®šæ—¶æ“ä½œæ—¶ï¼Œåˆ©ç”¨AIç”Ÿæˆçš„ç¤ºä¾‹\n\n\nIOå¤ç”¨ + å®šæ—¶\n#include &lt;chrono&gt;#include &lt;cerrno&gt;#include &lt;cstdio&gt;#include &lt;sys/epoll.h&gt;// å®šä¹‰è¶…æ—¶æ—¶é—´å¸¸é‡ï¼ˆ5ç§’ï¼‰const std::chrono::steady_clock::duration TIMEOUT = std::chrono::milliseconds(5000);// é¢„è®¡ç®—è¶…æ—¶æ¯«ç§’æ•°ï¼Œé¿å…é‡å¤è½¬æ¢const int TIMEOUT_MS = std::chrono::duration_cast&lt;std::chrono::milliseconds&gt;(TIMEOUT).count();int main() &#123;    // å‡è®¾å·²åˆå§‹åŒ–epfdã€eventså’ŒMAX_EVENTS_NUM    int epfd = -1;    struct epoll_event events[1024];  // ç¤ºä¾‹å¤§å°    const int MAX_EVENTS_NUM = 1024;    int timeout = TIMEOUT_MS;  // åˆå§‹è¶…æ—¶æ—¶é—´    std::chrono::steady_clock::time_point start;    std::chrono::steady_clock::time_point end;    while (true) &#123;        start = std::chrono::steady_clock::now();        int event_count = epoll_wait(epfd, events, MAX_EVENTS_NUM, timeout);        // å¤„ç†epoll_waité”™è¯¯        if (event_count &lt; 0) &#123;            if (errno != EINTR) &#123;  // éä¿¡å·ä¸­æ–­çš„é”™è¯¯æ‰é€€å‡º                std::perror(&quot;epoll_wait failed&quot;);                break;            &#125;            // ä¿¡å·ä¸­æ–­åˆ™ç»§ç»­ç­‰å¾…ï¼Œä¸ä¿®æ”¹è¶…æ—¶æ—¶é—´            continue;        &#125;        // å¤„ç†è¶…æ—¶æƒ…å†µ        else if (event_count == 0) &#123;            // è¶…æ—¶åé‡ç½®è¶…æ—¶æ—¶é—´            timeout = TIMEOUT_MS;            // å¯ä»¥æ·»åŠ è¶…æ—¶å¤„ç†é€»è¾‘            continue;        &#125;        // è®¡ç®—å®é™…ç­‰å¾…æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰        end = std::chrono::steady_clock::now();        auto elapsed = std::chrono::duration_cast&lt;std::chrono::milliseconds&gt;(end - start).count();                // æ›´æ–°å‰©ä½™è¶…æ—¶æ—¶é—´        timeout -= static_cast&lt;int&gt;(elapsed);        // ç¡®ä¿è¶…æ—¶æ—¶é—´ä¸ä¼šä¸ºè´Ÿ        if (timeout &lt; 0) &#123;            timeout = 0;        &#125;        // å¤„ç†äº‹ä»¶ï¼ˆç¤ºä¾‹ï¼‰        // handle_events(events, event_count);    &#125;    return 0;&#125;\næ ¸å¿ƒé€»è¾‘ï¼šç”¨ epoll_wait çš„â€œè¶…æ—¶â€å®ç°å®šæ—¶\nepoll_wait æ˜¯ Linux ä¸‹ I/O å¤ç”¨çš„æ ¸å¿ƒç³»ç»Ÿè°ƒç”¨ï¼Œå®ƒæœ‰ä¸€ä¸ªè¶…æ—¶å‚æ•°ï¼ˆä»£ç é‡Œçš„ timeoutï¼‰ï¼š\n\n\nå¦‚æœåœ¨ timeout æ—¶é—´å†…ï¼Œæ²¡æœ‰ I/O äº‹ä»¶å°±ç»ªï¼Œepoll_wait ä¼šè¿”å› 0ï¼Œè¡¨ç¤ºâ€œè¶…æ—¶â€ã€‚\n\n\nå¦‚æœæœ‰ I/O äº‹ä»¶å°±ç»ªï¼Œepoll_wait ä¼šè¿”å›å°±ç»ªçš„äº‹ä»¶æ•°é‡ï¼ˆå¤§äº 0ï¼‰ï¼Œå¹¶æå‰è¿”å›ã€‚\n\n\nä»£ç æ­£æ˜¯åˆ©ç”¨â€œepoll_wait è¶…æ—¶è¿”å› 0â€è¿™ä¸ªç‰¹æ€§ï¼Œæ¥å®ç°å®šæ—¶è§¦å‘ã€‚\nä»¥ä¸‹æ˜¯è¿™ç§ â€œIO å¤ç”¨ + å®šæ—¶â€ æ¨¡å¼çš„å…¸å‹åº”ç”¨åœºæ™¯ï¼š\n\n\né«˜æ€§èƒ½ç½‘ç»œæœåŠ¡å™¨\n\n\n\n\nåœºæ™¯æè¿°ï¼šå¦‚ Web æœåŠ¡å™¨ã€æ¸¸æˆæœåŠ¡å™¨ç­‰ï¼Œéœ€è¦åŒæ—¶å¤„ç†å¤§é‡å®¢æˆ·ç«¯è¿æ¥ï¼ˆI/O äº‹ä»¶ï¼‰ï¼ŒåŒæ—¶è¿˜éœ€æ‰§è¡Œå®šæ—¶ä»»åŠ¡ï¼ˆå¦‚å®šæ—¶æ¸…ç†ç©ºé—²è¿æ¥ã€å®šæ—¶æ¨é€å¿ƒè·³åŒ…ã€å®šæ—¶ç»Ÿè®¡æœåŠ¡å™¨çŠ¶æ€ç­‰ï¼‰ã€‚\n\n\nç¤ºä¾‹ï¼šä¸€ä¸ª Web æœåŠ¡å™¨ï¼Œæ—¢éœ€è¦å¤„ç†å®¢æˆ·ç«¯çš„ HTTP è¯·æ±‚ï¼ˆI/O äº‹ä»¶ï¼‰ï¼Œåˆéœ€è¦æ¯ 5 ç§’æ£€æŸ¥ä¸€æ¬¡æ‰€æœ‰è¿æ¥ï¼Œå…³é—­é•¿æ—¶é—´æ— æ´»åŠ¨çš„è¿æ¥ï¼ˆå®šæ—¶ä»»åŠ¡ï¼‰ã€‚ä½¿ç”¨è¯¥æ¨¡å¼å¯ä»¥åœ¨åŒä¸€ä¸ªçº¿ç¨‹ä¸­é«˜æ•ˆå®Œæˆè¿™ä¸¤ç±»æ“ä½œï¼Œé¿å…å¤šçº¿ç¨‹å¼€é”€ã€‚\n\n\n\n\nç½‘ç»œç›‘æ§ä¸ç®¡ç†ç³»ç»Ÿ\n\n\n\n\nåœºæ™¯æè¿°ï¼šéœ€è¦ç›‘æ§å¤šä¸ªç½‘ç»œè®¾å¤‡çš„çŠ¶æ€ï¼ˆé€šè¿‡ I/O è¯»å–è®¾å¤‡æ•°æ®ï¼‰ï¼ŒåŒæ—¶å®šæ—¶ç”Ÿæˆç›‘æ§æŠ¥å‘Šã€å®šæ—¶å‘é€å‘Šè­¦ä¿¡æ¯ã€‚\n\n\nç¤ºä¾‹ï¼šä¸€ä¸ªæœåŠ¡å™¨é›†ç¾¤ç›‘æ§ç³»ç»Ÿï¼Œéœ€è¦å®æ—¶ç›‘å¬å„æœåŠ¡å™¨çš„çŠ¶æ€å˜åŒ–ï¼ˆI/O äº‹ä»¶ï¼‰ï¼ŒåŒæ—¶æ¯ 1 åˆ†é’Ÿç”Ÿæˆä¸€æ¬¡æ€§èƒ½ç»Ÿè®¡æŠ¥è¡¨ï¼ˆå®šæ—¶ä»»åŠ¡ï¼‰\n\n\n","categories":["ç¼–ç¨‹"],"tags":["C++","Linux"]},{"title":"IOå¤šè·¯å¤ç”¨","url":"/2025/08/16/linux/IO%E5%A4%9A%E8%B7%AF%E5%A4%8D%E7%94%A8/","content":"\nLinuxå¹³å°ä¸‹çš„ä¸‰ç§å¤šè·¯å¤ç”¨æŠ€æœ¯ï¼Œç»“åˆAIè¿›è¡Œæ•´ç†\n\n\nIOå¤šè·¯å¤ç”¨\nIO å¤ç”¨ï¼ˆIO Multiplexingï¼‰ æ˜¯ä¸€ç§é«˜æ•ˆå¤„ç†å¤š IO äº‹ä»¶çš„æ ¸å¿ƒæŠ€æœ¯ï¼Œå…¶æ ¸å¿ƒæ€æƒ³æ˜¯é€šè¿‡å•ä¸ªè¿›ç¨‹ / çº¿ç¨‹åŒæ—¶ç›‘è§†å¤šä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼ˆFile Descriptorï¼Œå¦‚ Socketã€æ–‡ä»¶ã€ç®¡é“ç­‰ï¼‰ï¼Œå½“æŸä¸ªæè¿°ç¬¦å°±ç»ªï¼ˆå¯è¯» / å¯å†™ / å¼‚å¸¸ï¼‰æ—¶ï¼Œä¸»åŠ¨é€šçŸ¥ç¨‹åºè¿›è¡Œå¤„ç†ã€‚è¿™ç§æ¨¡å¼é¿å…äº†ä¼ ç»Ÿ â€œä¸€è¿æ¥ä¸€çº¿ç¨‹â€ æ¨¡å‹çš„èµ„æºæµªè´¹ï¼ˆçº¿ç¨‹åˆ›å»ºé”€æ¯å¼€é”€ã€ä¸Šä¸‹æ–‡åˆ‡æ¢æˆæœ¬ï¼‰ï¼Œç‰¹åˆ«é€‚åˆé«˜å¹¶å‘åœºæ™¯ï¼ˆå¦‚ç™¾ä¸‡çº§ TCP è¿æ¥çš„æœåŠ¡å™¨ï¼‰ã€‚\nä¸€ã€IO å¤ç”¨çš„æ ¸å¿ƒä»·å€¼\nåœ¨ç½‘ç»œç¼–ç¨‹ä¸­ï¼Œä¼ ç»Ÿå¤„ç†å¤šå®¢æˆ·ç«¯è¿æ¥çš„æ–¹å¼æ˜¯ â€œæ¯è¿æ¥åˆ›å»ºä¸€ä¸ªçº¿ç¨‹â€ï¼Œä½†å­˜åœ¨æ˜æ˜¾ç¼ºé™·ï¼š\n\n\nçº¿ç¨‹æ•°é‡æœ‰é™ï¼ˆå—ç³»ç»Ÿèµ„æºé™åˆ¶ï¼Œé€šå¸¸ä¸Šé™ä¸ºå‡ ä¸‡ï¼‰ï¼Œæ— æ³•æ”¯æ’‘é«˜å¹¶å‘ï¼›\n\n\nçº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢å¼€é”€å¤§ï¼ŒCPU åˆ©ç”¨ç‡ä½ï¼›\n\n\nå†…å­˜æ¶ˆè€—é«˜ï¼ˆæ¯ä¸ªçº¿ç¨‹é»˜è®¤æ ˆç©ºé—´é€šå¸¸ä¸º 1MBï¼‰ã€‚\n\n\nIO å¤ç”¨æŠ€æœ¯é€šè¿‡å•çº¿ç¨‹ / å°‘é‡çº¿ç¨‹ç›‘è§†å¤§é‡ IO æè¿°ç¬¦ï¼Œä»…åœ¨æè¿°ç¬¦å°±ç»ªæ—¶æ‰è¿›è¡Œå¤„ç†ï¼Œå¤§å¹…é™ä½èµ„æºæ¶ˆè€—ï¼Œå¯è½»æ¾æ”¯æ’‘åä¸‡ç”šè‡³ç™¾ä¸‡çº§å¹¶å‘è¿æ¥ã€‚\näºŒã€å¸¸ç”¨ IO å¤ç”¨å‡½æ•°åŠç”¨æ³•\nLinux å¹³å°ä¸‹å¸¸ç”¨çš„ IO å¤ç”¨å‡½æ•°æœ‰selectã€pollã€epollï¼ˆæ€§èƒ½æœ€ä¼˜ï¼Œæœ€å¸¸ç”¨ï¼‰ï¼ŒWindows å¹³å°å¯¹åº”æœ‰WSAEventSelectå’ŒIOCPï¼ˆIO å®Œæˆç«¯å£ï¼‰ã€‚ä»¥ä¸‹ä»¥ Linux ä¸ºä¸»å±•å¼€è®²è§£ï¼š\n1. selectï¼šæœ€ç»å…¸çš„ IO å¤ç”¨å‡½æ•°\nselectæ˜¯ POSIX æ ‡å‡†å®šä¹‰çš„ IO å¤ç”¨å‡½æ•°ï¼Œé€šè¿‡è½®è¯¢æ–¹å¼ç›‘è§†å¤šä¸ªæ–‡ä»¶æè¿°ç¬¦çš„å¯è¯»ã€å¯å†™å’Œå¼‚å¸¸äº‹ä»¶ã€‚\nå‡½æ•°åŸå‹\n#include &lt;sys/select.h&gt;#include &lt;sys/time.h&gt;int select(int nfds,            fd_set *readfds,   // å…³æ³¨â€œå¯è¯»â€äº‹ä»¶çš„æè¿°ç¬¦é›†åˆ           fd_set *writefds,  // å…³æ³¨â€œå¯å†™â€äº‹ä»¶çš„æè¿°ç¬¦é›†åˆ           fd_set *exceptfds, // å…³æ³¨â€œå¼‚å¸¸â€äº‹ä»¶çš„æè¿°ç¬¦é›†åˆ           struct timeval *timeout); // è¶…æ—¶æ—¶é—´ï¼ˆNULLè¡¨ç¤ºé˜»å¡ç­‰å¾…ï¼‰\næ ¸å¿ƒå‚æ•°è¯´æ˜\n\n\nnfdsï¼šéœ€è¦ç›‘è§†çš„æœ€å¤§æ–‡ä»¶æè¿°ç¬¦å€¼ + 1ï¼ˆå› ä¸ºæè¿°ç¬¦ä» 0 å¼€å§‹ç¼–å·ï¼‰ï¼›\n\n\nfd_setï¼šæè¿°ç¬¦é›†åˆï¼ˆæœ¬è´¨æ˜¯ä½å›¾ï¼‰ï¼Œéœ€é€šè¿‡å®æ“ä½œï¼š\n\nFD_ZERO(fd_set *)ï¼šæ¸…ç©ºé›†åˆï¼›\nFD_SET(int fd, fd_set *)ï¼šå°† fd åŠ å…¥é›†åˆï¼›\nFD_CLR(int fd, fd_set *)ï¼šä»é›†åˆä¸­ç§»é™¤ fdï¼›\nFD_ISSET(int fd, fd_set *)ï¼šæ£€æŸ¥ fd æ˜¯å¦åœ¨å°±ç»ªé›†åˆä¸­ï¼›\n\n\n\ntimeoutï¼šè¶…æ—¶è®¾ç½®ï¼ˆstruct timeval { long tv_sec; long tv_usec; }ï¼‰ï¼ŒNULLè¡¨ç¤ºæ°¸ä¹…é˜»å¡ï¼Œtv_sec=0ä¸”tv_usec=0è¡¨ç¤ºéé˜»å¡ã€‚\n\n\nè¿”å›å€¼\n\n\næˆåŠŸï¼šå°±ç»ªçš„æè¿°ç¬¦æ€»æ•°ï¼›\n\n\nå¤±è´¥ï¼š-1ï¼ˆéœ€é€šè¿‡errnoåˆ¤æ–­é”™è¯¯ï¼Œå¦‚EINTRè¡¨ç¤ºè¢«ä¿¡å·ä¸­æ–­ï¼‰ï¼›\n\n\nè¶…æ—¶ï¼š0ã€‚\n\n\nç¤ºä¾‹ä»£ç ï¼ˆç”¨ select å¤„ç†å¤šå®¢æˆ·ç«¯è¿æ¥ï¼‰\n#include &lt;sys/select.h&gt;#include &lt;sys/socket.h&gt;#include &lt;netinet/in.h&gt;#include &lt;unistd.h&gt;#include &lt;iostream&gt;#include &lt;vector&gt;#include &lt;cstring&gt;int main() &#123;    // 1. åˆ›å»ºç›‘å¬Socket    int listen_fd = socket(AF_INET, SOCK_STREAM, 0);    if (listen_fd == -1) &#123; perror(&quot;socket&quot;); return -1; &#125;    // ç»‘å®šåœ°å€å’Œç«¯å£    struct sockaddr_in serv_addr;    memset(&amp;serv_addr, 0, sizeof(serv_addr));    serv_addr.sin_family = AF_INET;    serv_addr.sin_addr.s_addr = INADDR_ANY;    serv_addr.sin_port = htons(8080);    if (bind(listen_fd, (struct sockaddr*)&amp;serv_addr, sizeof(serv_addr)) == -1) &#123;        perror(&quot;bind&quot;); return -1;    &#125;    // å¼€å§‹ç›‘å¬    listen(listen_fd, 1024);    std::cout &lt;&lt; &quot;Server listening on port 8080...\\n&quot;;    fd_set read_fds;       // å…³æ³¨çš„å¯è¯»äº‹ä»¶é›†åˆ    int max_fd = listen_fd; // å½“å‰æœ€å¤§æè¿°ç¬¦    std::vector&lt;int&gt; client_fds; // ä¿å­˜å®¢æˆ·ç«¯è¿æ¥    while (true) &#123;        // æ¯æ¬¡è°ƒç”¨selectå‰éœ€é‡ç½®é›†åˆï¼ˆå› ä¸ºselectä¼šä¿®æ”¹é›†åˆï¼‰        FD_ZERO(&amp;read_fds);        FD_SET(listen_fd, &amp;read_fds); // ç›‘å¬SocketåŠ å…¥å¯è¯»é›†åˆ        // å°†æ‰€æœ‰å®¢æˆ·ç«¯SocketåŠ å…¥å¯è¯»é›†åˆ        for (int fd : client_fds) &#123;            FD_SET(fd, &amp;read_fds);            if (fd &gt; max_fd) max_fd = fd;        &#125;        // è°ƒç”¨selectï¼Œé˜»å¡ç­‰å¾…äº‹ä»¶ï¼ˆè¶…æ—¶è®¾ä¸ºNULLè¡¨ç¤ºæ°¸ä¹…é˜»å¡ï¼‰        int ready = select(max_fd + 1, &amp;read_fds, NULL, NULL, NULL);        if (ready == -1) &#123;            perror(&quot;select&quot;);            continue;        &#125; else if (ready == 0) &#123;            continue; // è¶…æ—¶ï¼Œç»§ç»­ç­‰å¾…        &#125;        // å¤„ç†ç›‘å¬Socketçš„å¯è¯»äº‹ä»¶ï¼ˆæ–°å®¢æˆ·ç«¯è¿æ¥ï¼‰        if (FD_ISSET(listen_fd, &amp;read_fds)) &#123;            struct sockaddr_in client_addr;            socklen_t addr_len = sizeof(client_addr);            int client_fd = accept(listen_fd, (struct sockaddr*)&amp;client_addr, &amp;addr_len);            if (client_fd == -1) &#123;                perror(&quot;accept&quot;);                continue;            &#125;            client_fds.push_back(client_fd);            std::cout &lt;&lt; &quot;New client connected, fd: &quot; &lt;&lt; client_fd &lt;&lt; &quot;\\n&quot;;            ready--; // å‡å°‘å°±ç»ªè®¡æ•°ï¼Œé¿å…é‡å¤å¤„ç†        &#125;        // å¤„ç†å®¢æˆ·ç«¯Socketçš„å¯è¯»äº‹ä»¶ï¼ˆæ•°æ®åˆ°æ¥ï¼‰        if (ready &gt; 0) &#123;            for (auto it = client_fds.begin(); it != client_fds.end();) &#123;                int fd = *it;                if (FD_ISSET(fd, &amp;read_fds)) &#123;                    char buf[1024] = &#123;0&#125;;                    ssize_t n = recv(fd, buf, sizeof(buf)-1, 0);                    if (n &lt;= 0) &#123; // è¿æ¥å…³é—­æˆ–é”™è¯¯                        std::cout &lt;&lt; &quot;Client disconnected, fd: &quot; &lt;&lt; fd &lt;&lt; &quot;\\n&quot;;                        close(fd);                        it = client_fds.erase(it);                    &#125; else &#123; // æ¥æ”¶æ•°æ®                        std::cout &lt;&lt; &quot;Received from fd &quot; &lt;&lt; fd &lt;&lt; &quot;: &quot; &lt;&lt; buf &lt;&lt; &quot;\\n&quot;;                        send(fd, &quot;Received&quot;, 8, 0); // ç®€å•å›æ˜¾                        it++;                    &#125;                    ready--;                    if (ready == 0) break; // æ‰€æœ‰å°±ç»ªäº‹ä»¶å¤„ç†å®Œæ¯•                &#125; else &#123;                    it++;                &#125;            &#125;        &#125;    &#125;    close(listen_fd);    return 0;&#125;\nä¼˜ç¼ºç‚¹\n\n\nä¼˜ç‚¹ï¼šè·¨å¹³å°ï¼ˆLinux/Windows/BSD å‡æ”¯æŒï¼‰ï¼Œå®ç°ç®€å•ï¼›\n\n\nç¼ºç‚¹ï¼š\n\næè¿°ç¬¦æ•°é‡é™åˆ¶ï¼ˆé»˜è®¤ä¸Šé™ä¸º 1024ï¼Œå¯é€šè¿‡ä¿®æ”¹å†…æ ¸å‚æ•°FD_SETSIZEè°ƒæ•´ï¼Œä½†ä¸æ¨èï¼‰ï¼›\næ¯æ¬¡è°ƒç”¨éœ€é‡ç½®fd_setï¼Œæ•ˆç‡ä½ï¼›\néœ€éå†æ‰€æœ‰æè¿°ç¬¦æ£€æŸ¥å°±ç»ªçŠ¶æ€ï¼Œéšæè¿°ç¬¦å¢å¤šæ€§èƒ½ä¸‹é™ã€‚\n\n\n\n2. pollï¼šselect çš„æ”¹è¿›ç‰ˆ\npollè§£å†³äº†selectçš„æè¿°ç¬¦æ•°é‡é™åˆ¶é—®é¢˜ï¼Œç”¨ç»“æ„ä½“æ•°ç»„æ›¿ä»£ä½å›¾å­˜å‚¨æè¿°ç¬¦ï¼Œæ”¯æŒåŠ¨æ€æ‰©å±•ã€‚\nå‡½æ•°åŸå‹\n#include &lt;poll.h&gt;int poll(struct pollfd *fds, nfds_t nfds, int timeout);\næ ¸å¿ƒå‚æ•°è¯´æ˜\n\n\nstruct pollfdï¼šæè¿°ç¬¦åŠäº‹ä»¶çš„ç»“æ„ä½“ï¼š\nstruct pollfd &#123;    int fd;         // è¦ç›‘è§†çš„æ–‡ä»¶æè¿°ç¬¦ï¼ˆ-1è¡¨ç¤ºå¿½ç•¥ï¼‰    short events;   // å…³æ³¨çš„äº‹ä»¶ï¼ˆè¾“å…¥å‚æ•°ï¼‰    short revents;  // å®é™…å‘ç”Ÿçš„äº‹ä»¶ï¼ˆè¾“å‡ºå‚æ•°ï¼‰&#125;;\n\n\nå¸¸ç”¨eventsï¼šPOLLINï¼ˆå¯è¯»ï¼‰ã€POLLOUTï¼ˆå¯å†™ï¼‰ã€POLLERRï¼ˆé”™è¯¯ï¼‰ã€POLLHUPï¼ˆæŒ‚æ–­ï¼‰ï¼›\n\n\n\n\nnfdsï¼šfdsæ•°ç»„çš„é•¿åº¦ï¼›\n\n\ntimeoutï¼šè¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼Œ-1 è¡¨ç¤ºæ°¸ä¹…é˜»å¡ï¼Œ0 è¡¨ç¤ºéé˜»å¡ï¼‰ã€‚\n\n\nè¿”å›å€¼\n\n\næˆåŠŸï¼šå°±ç»ªçš„æè¿°ç¬¦æ€»æ•°ï¼›\n\n\nå¤±è´¥ï¼š-1ï¼›\n\n\nè¶…æ—¶ï¼š0ã€‚\n\n\nç¤ºä¾‹ä»£ç ï¼ˆç”¨ poll å¤„ç†å¤šå®¢æˆ·ç«¯ï¼‰\n#include &lt;poll.h&gt;#include &lt;sys/socket.h&gt;#include &lt;netinet/in.h&gt;#include &lt;unistd.h&gt;#include &lt;iostream&gt;#include &lt;vector&gt;#include &lt;cstring&gt;int main() &#123;    // 1. åˆ›å»ºç›‘å¬Socketï¼ˆåŒä¸Šï¼Œçœç•¥ç»‘å®š/ç›‘å¬ä»£ç ï¼‰    int listen_fd = ...;     std::vector&lt;struct pollfd&gt; fds;    // æ·»åŠ ç›‘å¬Socketåˆ°pollé›†åˆ    fds.push_back(&#123;listen_fd, POLLIN, 0&#125;);    while (true) &#123;        // è°ƒç”¨pollï¼Œé˜»å¡ç­‰å¾…äº‹ä»¶        int ready = poll(fds.data(), fds.size(), -1);        if (ready == -1) &#123; perror(&quot;poll&quot;); continue; &#125;        // éå†æ‰€æœ‰æè¿°ç¬¦æ£€æŸ¥å°±ç»ªäº‹ä»¶        for (size_t i = 0; i &lt; fds.size() &amp;&amp; ready &gt; 0; i++) &#123;            if (fds[i].revents == 0) continue;            // å¤„ç†ç›‘å¬Socketçš„å¯è¯»äº‹ä»¶ï¼ˆæ–°è¿æ¥ï¼‰            if (fds[i].fd == listen_fd) &#123;                int client_fd = accept(listen_fd, NULL, NULL);                if (client_fd != -1) &#123;                    fds.push_back(&#123;client_fd, POLLIN, 0&#125;);                    std::cout &lt;&lt; &quot;New client, fd: &quot; &lt;&lt; client_fd &lt;&lt; &quot;\\n&quot;;                &#125;                ready--;            &#125;             // å¤„ç†å®¢æˆ·ç«¯Socketçš„å¯è¯»äº‹ä»¶            else if (fds[i].revents &amp; POLLIN) &#123;                char buf[1024] = &#123;0&#125;;                ssize_t n = recv(fds[i].fd, buf, sizeof(buf)-1, 0);                if (n &lt;= 0) &#123; // è¿æ¥å…³é—­                    close(fds[i].fd);                    // ç”¨æœ€åä¸€ä¸ªå…ƒç´ è¦†ç›–å½“å‰ä½ç½®ï¼Œå‡å°‘vectorç§»åŠ¨å¼€é”€                    fds[i] = fds.back();                    fds.pop_back();                &#125; else &#123; // æ¥æ”¶æ•°æ®                    std::cout &lt;&lt; &quot;Received: &quot; &lt;&lt; buf &lt;&lt; &quot;\\n&quot;;                    send(fds[i].fd, &quot;OK&quot;, 2, 0);                &#125;                ready--;            &#125;        &#125;    &#125;    close(listen_fd);    return 0;&#125;\nä¼˜ç¼ºç‚¹\n\n\nä¼˜ç‚¹ï¼š\n\næ— æè¿°ç¬¦æ•°é‡é™åˆ¶ï¼ˆä»…å—ç³»ç»Ÿå†…å­˜é™åˆ¶ï¼‰ï¼›\næ— éœ€æ¯æ¬¡é‡ç½®äº‹ä»¶é›†åˆï¼ˆreventsç”±å†…æ ¸å¡«å……ï¼Œeventsä¿æŒä¸å˜ï¼‰ï¼›\n\n\n\nç¼ºç‚¹ï¼š\n\nä»éœ€éå†æ‰€æœ‰æè¿°ç¬¦æ£€æŸ¥å°±ç»ªçŠ¶æ€ï¼ˆå¤§æ•°é‡æ—¶æ•ˆç‡ä½ï¼‰ï¼›\nè·¨å¹³å°æ€§ç•¥å·®ï¼ˆWindows éœ€æ¨¡æ‹Ÿå®ç°ï¼‰ã€‚\n\n\n\n3. epollï¼šLinux é«˜æ€§èƒ½ IO å¤ç”¨ï¼ˆæ¨èï¼‰\nepollæ˜¯ Linux 2.6 å†…æ ¸åå¼•å…¥çš„é«˜æ€§èƒ½ IO å¤ç”¨æœºåˆ¶ï¼Œé‡‡ç”¨å†…æ ¸äº‹ä»¶è¡¨å’Œå›è°ƒé€šçŸ¥æ¨¡å¼ï¼Œé¿å…äº†select/pollçš„è½®è¯¢å¼€é”€ï¼Œæ˜¯é«˜å¹¶å‘æœåŠ¡å™¨çš„é¦–é€‰ã€‚\næ ¸å¿ƒå‡½æ•°\n\n\nepoll_createï¼šåˆ›å»º epoll å®ä¾‹ï¼ˆå†…æ ¸äº‹ä»¶è¡¨ï¼‰\n#include &lt;sys/epoll.h&gt;int epoll_create(int size); // sizeï¼šæ—©æœŸå†…æ ¸ç”¨äºæŒ‡å®šäº‹ä»¶è¡¨å¤§å°ï¼Œç°åœ¨å·²å¿½ç•¥ï¼ˆä¼ &gt;0å³å¯ï¼‰\n\n\nepoll_ctlï¼šæ“ä½œäº‹ä»¶è¡¨ï¼ˆæ·»åŠ  / ä¿®æ”¹ / åˆ é™¤æè¿°ç¬¦åŠäº‹ä»¶ï¼‰\nint epoll_ctl(int epfd, int op, int fd, struct epoll_event *event);\n\n\nepfdï¼šepoll_createè¿”å›çš„å®ä¾‹å¥æŸ„ï¼›\n\n\nopï¼šæ“ä½œç±»å‹ï¼šEPOLL_CTL_ADDï¼ˆæ·»åŠ ï¼‰ã€EPOLL_CTL_MODï¼ˆä¿®æ”¹ï¼‰ã€EPOLL_CTL_DELï¼ˆåˆ é™¤ï¼‰ï¼›\n\n\nfdï¼šè¦æ“ä½œçš„æ–‡ä»¶æè¿°ç¬¦ï¼›\n\n\nstruct epoll_eventï¼šäº‹ä»¶ç»“æ„ï¼š\nstruct epoll_event &#123;    uint32_t events;  // å…³æ³¨çš„äº‹ä»¶    epoll_data_t data; // ç”¨æˆ·æ•°æ®ï¼ˆé€šå¸¸å­˜fdæˆ–è‡ªå®šä¹‰æŒ‡é’ˆï¼‰&#125;;typedef union epoll_data &#123;    void *ptr;    int fd;    uint32_t u32;    uint64_t u64;&#125; epoll_data_t;\nå¸¸ç”¨eventsï¼šEPOLLINï¼ˆå¯è¯»ï¼‰ã€EPOLLOUTï¼ˆå¯å†™ï¼‰ã€EPOLLETï¼ˆè¾¹ç¼˜è§¦å‘ï¼‰ã€EPOLLONESHOTï¼ˆåªè§¦å‘ä¸€æ¬¡ï¼‰ã€‚\n\n\n\n\nepoll_waitï¼šç­‰å¾…äº‹ä»¶å°±ç»ª\nint epoll_wait(int epfd, struct epoll_event *events, int maxevents, int timeout);\n\n\neventsï¼šè¾“å‡ºå‚æ•°ï¼Œä¿å­˜å°±ç»ªçš„äº‹ä»¶ï¼›\n\n\nmaxeventsï¼šæœ€å¤šå¤„ç†çš„äº‹ä»¶æ•°ï¼ˆéœ€â‰¤epoll_createçš„ sizeï¼‰ï¼›\n\n\ntimeoutï¼šè¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼Œ-1 è¡¨ç¤ºé˜»å¡ï¼Œ0 è¡¨ç¤ºéé˜»å¡ï¼‰ã€‚\n\n\nè¿”å›å€¼ï¼šå°±ç»ªçš„äº‹ä»¶æ•°ï¼ˆ0 è¡¨ç¤ºè¶…æ—¶ï¼Œ-1 è¡¨ç¤ºé”™è¯¯ï¼‰ã€‚\n\n\n\n\nepoll_create1 - åˆ›å»º epoll å®ä¾‹\nint epoll_create1(int flags);\n\n\nflagsï¼šå¯ä»¥æ˜¯ 0ï¼ˆä¸epoll_createç›¸åŒï¼‰æˆ–EPOLL_CLOEXECï¼ˆè¿›ç¨‹æ‰§è¡Œ exec æ—¶è‡ªåŠ¨å…³é—­ epoll å®ä¾‹ï¼‰\n\n\nè¿”å›å€¼ï¼šæˆåŠŸè¿”å› epoll æ–‡ä»¶æè¿°ç¬¦ï¼Œå¤±è´¥è¿”å› - 1\n\n\n\n\nå…³é”®ç‰¹æ€§ï¼šè¾¹ç¼˜è§¦å‘ï¼ˆETï¼‰ä¸æ°´å¹³è§¦å‘ï¼ˆLTï¼‰\n\n\næ°´å¹³è§¦å‘ï¼ˆLTï¼Œé»˜è®¤ï¼‰ï¼šåªè¦æè¿°ç¬¦æœ‰æœªå¤„ç†çš„æ•°æ®ï¼ˆå¦‚å¯è¯»ï¼‰ï¼Œepoll_waitå°±ä¼šæŒç»­é€šçŸ¥ï¼›\n\n\nè¾¹ç¼˜è§¦å‘ï¼ˆETï¼‰ï¼šä»…åœ¨æè¿°ç¬¦çŠ¶æ€ä» â€œæœªå°±ç»ªâ€ å˜ä¸º â€œå°±ç»ªâ€ æ—¶é€šçŸ¥ä¸€æ¬¡ï¼ˆéœ€ä¸€æ¬¡æ€§å¤„ç†å®Œæ‰€æœ‰æ•°æ®ï¼Œå¦åˆ™å¯èƒ½é—æ¼äº‹ä»¶ï¼‰ã€‚\n\n\nET æ¨¡å¼æ•ˆç‡æ›´é«˜ï¼ˆå‡å°‘é€šçŸ¥æ¬¡æ•°ï¼‰ï¼Œä½†ç¼–ç¨‹å¤æ‚åº¦é«˜ï¼ˆéœ€ç¡®ä¿æ•°æ®è¯»å®Œï¼‰ã€‚\nç¤ºä¾‹ä»£ç ï¼ˆepoll + ET æ¨¡å¼å¤„ç†å¤šå®¢æˆ·ç«¯ï¼‰\n#include &lt;sys/epoll.h&gt;#include &lt;sys/socket.h&gt;#include &lt;netinet/in.h&gt;#include &lt;unistd.h&gt;#include &lt;iostream&gt;#include &lt;vector&gt;#include &lt;cstring&gt;// ä¸€æ¬¡æ€§è¯»å–æ‰€æœ‰æ•°æ®ï¼ˆETæ¨¡å¼å¿…éœ€ï¼‰ssize_t read_all(int fd, char *buf, size_t len) &#123;    ssize_t total = 0;    while (total &lt; len) &#123;        ssize_t n = recv(fd, buf + total, len - total, 0);        if (n &lt; 0) &#123;            if (errno == EAGAIN || errno == EWOULDBLOCK) break; // æ•°æ®å·²è¯»å®Œ            return -1; // é”™è¯¯        &#125; else if (n == 0) return total; // è¿æ¥å…³é—­        total += n;    &#125;    return total;&#125;int main() &#123;    // 1. åˆ›å»ºç›‘å¬Socketï¼ˆåŒä¸Šï¼Œçœç•¥ç»‘å®š/ç›‘å¬ï¼‰    int listen_fd = ...;    // 2. åˆ›å»ºepollå®ä¾‹    int epfd = epoll_create(1024); // å‚æ•°&gt;0å³å¯    if (epfd == -1) &#123; perror(&quot;epoll_create&quot;); return -1; &#125;    // 3. å‘epollæ·»åŠ ç›‘å¬Socketï¼ˆLTæ¨¡å¼ï¼Œé»˜è®¤ï¼‰    struct epoll_event ev;    ev.events = EPOLLIN; // å…³æ³¨å¯è¯»äº‹ä»¶    ev.data.fd = listen_fd;    if (epoll_ctl(epfd, EPOLL_CTL_ADD, listen_fd, &amp;ev) == -1) &#123;        perror(&quot;epoll_ctl&quot;); return -1;    &#125;    const int MAX_EVENTS = 1024;    struct epoll_event events[MAX_EVENTS]; // å­˜æ”¾å°±ç»ªäº‹ä»¶    while (true) &#123;        // 4. ç­‰å¾…äº‹ä»¶å°±ç»ªï¼ˆé˜»å¡ï¼‰        int ready = epoll_wait(epfd, events, MAX_EVENTS, -1);        if (ready == -1) &#123; perror(&quot;epoll_wait&quot;); continue; &#125;        // 5. å¤„ç†å°±ç»ªäº‹ä»¶        for (int i = 0; i &lt; ready; i++) &#123;            int fd = events[i].data.fd;            // æ–°å®¢æˆ·ç«¯è¿æ¥            if (fd == listen_fd) &#123;                int client_fd = accept(listen_fd, NULL, NULL);                if (client_fd == -1) &#123; perror(&quot;accept&quot;); continue; &#125;                // è®¾ä¸ºéé˜»å¡ï¼ˆETæ¨¡å¼å¿…é¡»ï¼Œé¿å…è¯»æ•°æ®æ—¶é˜»å¡ï¼‰                int flags = fcntl(client_fd, F_GETFL);                fcntl(client_fd, F_SETFL, flags | O_NONBLOCK);                // å‘epollæ·»åŠ å®¢æˆ·ç«¯Socketï¼ˆETæ¨¡å¼ï¼‰                ev.events = EPOLLIN | EPOLLET; // å¯è¯» + è¾¹ç¼˜è§¦å‘                ev.data.fd = client_fd;                epoll_ctl(epfd, EPOLL_CTL_ADD, client_fd, &amp;ev);                std::cout &lt;&lt; &quot;New client, fd: &quot; &lt;&lt; client_fd &lt;&lt; &quot;\\n&quot;;            &#125;            // å®¢æˆ·ç«¯æ•°æ®å¯è¯»            else if (events[i].events &amp; EPOLLIN) &#123;                char buf[1024] = &#123;0&#125;;                ssize_t n = read_all(fd, buf, sizeof(buf)-1); // ä¸€æ¬¡æ€§è¯»å®Œ                if (n &lt;= 0) &#123; // è¿æ¥å…³é—­æˆ–é”™è¯¯                    close(fd);                    epoll_ctl(epfd, EPOLL_CTL_DEL, fd, NULL); // ä»epollç§»é™¤                    std::cout &lt;&lt; &quot;Client disconnected, fd: &quot; &lt;&lt; fd &lt;&lt; &quot;\\n&quot;;                &#125; else &#123;                    std::cout &lt;&lt; &quot;Received: &quot; &lt;&lt; buf &lt;&lt; &quot;\\n&quot;;                    send(fd, &quot;OK&quot;, 2, 0);                &#125;            &#125;        &#125;    &#125;    close(epfd);    close(listen_fd);    return 0;&#125;\nä¼˜ç¼ºç‚¹\n\n\nä¼˜ç‚¹ï¼š\n\né«˜æ•ˆï¼šå†…æ ¸é€šè¿‡å›è°ƒç›´æ¥é€šçŸ¥å°±ç»ªäº‹ä»¶ï¼Œæ— éœ€è½®è¯¢æ‰€æœ‰æè¿°ç¬¦ï¼›\næ”¯æŒæµ·é‡æè¿°ç¬¦ï¼ˆåä¸‡ / ç™¾ä¸‡çº§ï¼Œä»…å—å†…å­˜é™åˆ¶ï¼‰ï¼›\nè¾¹ç¼˜è§¦å‘æ¨¡å¼å‡å°‘å†—ä½™é€šçŸ¥ï¼Œé€‚åˆé«˜å¹¶å‘ï¼›\n\n\n\nç¼ºç‚¹ï¼š\n\nä»…æ”¯æŒ Linux å¹³å°ï¼ˆä¸è·¨å¹³å°ï¼‰ï¼›\nET æ¨¡å¼ç¼–ç¨‹å¤æ‚ï¼ˆéœ€å¤„ç†éé˜»å¡ IO å’Œæ•°æ®å®Œæ•´æ€§ï¼‰ã€‚\n\n\n\nä¸‰ã€æ³¨æ„äº‹é¡¹\n\n\næè¿°ç¬¦ç®¡ç†ï¼š\n\nselect/polléœ€æ‰‹åŠ¨ç»´æŠ¤æè¿°ç¬¦é›†åˆï¼Œepollé€šè¿‡epoll_ctlåŠ¨æ€ç®¡ç†ï¼›\nå…³é—­æè¿°ç¬¦å‰éœ€ä» IO å¤ç”¨é›†åˆä¸­ç§»é™¤ï¼ˆé¿å… â€œåƒµå°¸æè¿°ç¬¦â€ å¯¼è‡´é”™è¯¯ï¼‰ã€‚\n\n\n\néé˜»å¡ IO é…åˆï¼š\n\nè¾¹ç¼˜è§¦å‘ï¼ˆETï¼‰æ¨¡å¼å¿…é¡»ç»“åˆéé˜»å¡ IOï¼ˆO_NONBLOCKï¼‰ï¼Œå¦åˆ™å¯èƒ½å› ä¸€æ¬¡è¯» / å†™æœªå®Œæˆè€Œé˜»å¡ï¼›\næ°´å¹³è§¦å‘ï¼ˆLTï¼‰å¯é…åˆé˜»å¡ IOï¼Œä½†éé˜»å¡ IO æ›´çµæ´»ã€‚\n\n\n\näº‹ä»¶ç±»å‹é€‰æ‹©ï¼š\n\né¿å…è¿‡åº¦å…³æ³¨EPOLLOUTï¼ˆå¯å†™äº‹ä»¶ï¼‰ï¼šSocket é»˜è®¤å¯å†™ï¼Œä¼šå¯¼è‡´epoll_waité¢‘ç¹è§¦å‘ï¼Œé€šå¸¸ä»…åœ¨å‘é€æ•°æ®æ—¶ä¸´æ—¶æ·»åŠ ï¼›\nç”¨EPOLLONESHOTç¡®ä¿ä¸€ä¸ªäº‹ä»¶ä»…è¢«ä¸€ä¸ªçº¿ç¨‹å¤„ç†ï¼ˆå¤šçº¿ç¨‹åœºæ™¯ï¼‰ã€‚\n\n\n\nè·¨å¹³å°å…¼å®¹ï¼š\n\nselectæ˜¯å”¯ä¸€è·¨æ‰€æœ‰å¹³å°çš„ IO å¤ç”¨å‡½æ•°ï¼›\nè·¨å¹³å°å¼€å‘å¯ä½¿ç”¨å°è£…åº“ï¼ˆå¦‚ Boost.Asioã€libuvï¼‰ï¼Œç»Ÿä¸€æŠ½è±¡ä¸åŒç³»ç»Ÿçš„ IO å¤ç”¨æœºåˆ¶ã€‚\n\n\n\næ€§èƒ½è¯¯åŒºï¼š\n\nå°å¹¶å‘åœºæ™¯ï¼ˆ&lt;1000 è¿æ¥ï¼‰ï¼Œselect/pollä¸epollæ€§èƒ½å·®å¼‚ä¸å¤§ï¼›\né¿å…åœ¨epollä¸­é¢‘ç¹æ·»åŠ  / åˆ é™¤æè¿°ç¬¦ï¼ˆå¼€é”€è¾ƒé«˜ï¼Œå¯ç”¨EPOLLONESHOTæ›¿ä»£ï¼‰ã€‚\n\n\n\nå››ã€å…¸å‹ä½¿ç”¨åœºæ™¯\n\n\né«˜å¹¶å‘ TCP æœåŠ¡å™¨ï¼ˆå¦‚ Web æœåŠ¡å™¨ã€å³æ—¶é€šè®¯æœåŠ¡å™¨ï¼‰ï¼šéœ€åŒæ—¶å¤„ç†æ•°ä¸‡è‡³ç™¾ä¸‡çº§å®¢æˆ·ç«¯è¿æ¥ï¼Œepollï¼ˆLinuxï¼‰æˆ–kqueueï¼ˆBSDï¼‰æ˜¯æœ€ä¼˜é€‰æ‹©ã€‚\n\n\nå¤š IO è®¾å¤‡ç›‘æ§ï¼ˆå¦‚åŒæ—¶å¤„ç† Socketã€ç®¡é“ã€æ–‡ä»¶ï¼‰ï¼špollæˆ–epollå¯ç»Ÿä¸€ç®¡ç†ä¸åŒç±»å‹çš„æ–‡ä»¶æè¿°ç¬¦ã€‚\n\n\nä½èµ„æºç¯å¢ƒï¼ˆå¦‚åµŒå…¥å¼è®¾å¤‡ï¼‰ï¼šselectå®ç°ç®€å•ï¼Œèµ„æºå ç”¨å°‘ï¼Œé€‚åˆè½»é‡çº§åœºæ™¯ã€‚\n\n\néé˜»å¡ IO é…åˆï¼šä¸éé˜»å¡ Socket ç»“åˆï¼Œå®ç° â€œéé˜»å¡ + IO å¤ç”¨â€ çš„é«˜æ•ˆæ¨¡å‹ï¼ˆå¦‚ Nginx çš„äº‹ä»¶é©±åŠ¨æ¨¡å‹ï¼‰ã€‚\n\n\næ€»ç»“\nIO å¤ç”¨æ˜¯ C++ é«˜æ€§èƒ½ç½‘ç»œç¼–ç¨‹çš„åŸºçŸ³ï¼Œå…¶æ ¸å¿ƒæ˜¯é€šè¿‡å•çº¿ç¨‹ / å°‘é‡çº¿ç¨‹é«˜æ•ˆå¤„ç†å¤š IO äº‹ä»¶ã€‚é€‰æ‹©å“ªç§å‡½æ•°éœ€ç»“åˆå¹³å°ã€å¹¶å‘é‡å’Œå¤æ‚åº¦ï¼š\n\n\nè·¨å¹³å°ã€è½»é‡çº§åœºæ™¯â†’selectï¼›\n\n\nä¸­ç­‰å¹¶å‘ã€éœ€çªç ´æè¿°ç¬¦é™åˆ¶â†’pollï¼›\n\n\né«˜å¹¶å‘ï¼ˆLinuxï¼‰ã€è¿½æ±‚æè‡´æ€§èƒ½â†’epollï¼ˆæ¨èï¼‰ã€‚\n\n\nå®é™…å¼€å‘ä¸­ï¼Œå»ºè®®ä½¿ç”¨æˆç†Ÿçš„ç½‘ç»œåº“ï¼ˆå¦‚ Boost.Asioã€muduoï¼‰ï¼Œå®ƒä»¬å·²å°è£… IO å¤ç”¨ç»†èŠ‚ï¼ŒåŒæ—¶æä¾›è·¨å¹³å°æ”¯æŒå’Œæ›´é«˜å±‚æ¬¡çš„æŠ½è±¡ï¼Œé™ä½å¼€å‘éš¾åº¦ã€‚\n","categories":["ç¼–ç¨‹"],"tags":["C++","Linux"]},{"title":"Linuxä¸­å­¤å„¿è¿›ç¨‹çš„ppid","url":"/2025/08/21/linux/Linux%E4%B8%AD%E5%AD%A4%E5%84%BF%E8%BF%9B%E7%A8%8B%E7%9A%84ppid/","content":"è®°å½•è’‹ç‚ç‚è€å¸ˆOSè¯¾ä¸Šçš„å­¤å„¿è¿›ç¨‹é—®é¢˜\n \n\n\nå­¤å„¿è¿›ç¨‹çš„å†…æ ¸å¤„ç†é€»è¾‘\nå½“çˆ¶è¿›ç¨‹ç»ˆæ­¢æ—¶ï¼Œå†…æ ¸ä¼šè§¦å‘do_exit()ç³»ç»Ÿè°ƒç”¨ï¼Œå…¶ä¸­åŒ…å«å¯¹å…¶å­è¿›ç¨‹çš„ â€œé¢†å…»â€ å¤„ç†é€»è¾‘ã€‚å…·ä½“æ¥è¯´ï¼Œå†…æ ¸ä¼šéå†è¯¥çˆ¶è¿›ç¨‹çš„æ‰€æœ‰å­è¿›ç¨‹ï¼ˆé€šè¿‡è¿›ç¨‹æè¿°ç¬¦task_structçš„childrené“¾è¡¨ï¼‰ï¼Œå¹¶ä¸ºæ¯ä¸ªå­è¿›ç¨‹é‡æ–°è®¾ç½®çˆ¶è¿›ç¨‹ IDï¼ˆPPIDï¼‰ã€‚è¿™ä¸€è¿‡ç¨‹ç”±å†…æ ¸å‡½æ•°reparent_children()å®Œæˆï¼Œå…¶æ ¸å¿ƒç›®æ ‡æ˜¯ç¡®ä¿æ¯ä¸ªè¿›ç¨‹å§‹ç»ˆæœ‰ä¸€ä¸ªæœ‰æ•ˆçš„çˆ¶è¿›ç¨‹ï¼Œä»¥é¿å…èµ„æºæ³„æ¼ã€‚\n\n\nä¸ºä½•é€šå¸¸æŒ‡å‘ 1 å·è¿›ç¨‹ï¼Ÿ\n1 å·è¿›ç¨‹ï¼ˆä¼ ç»Ÿä¸Šæ˜¯initï¼Œç°ä»£ç³»ç»Ÿä¸­å¤šä¸ºsystemdï¼‰æ˜¯ Linux ç”¨æˆ·æ€çš„ç¬¬ä¸€ä¸ªè¿›ç¨‹ï¼Œç”±å†…æ ¸ç›´æ¥åˆ›å»ºï¼ˆstart_kernel()é˜¶æ®µåˆå§‹åŒ–ï¼‰ã€‚å…¶è®¾è®¡ç‰¹æ€§æ˜¯ï¼š\n\nå¸¸é©»å†…å­˜ï¼ˆç”Ÿå‘½å‘¨æœŸä¸ç³»ç»Ÿä¸€è‡´ï¼‰\nä¼šä¸»åŠ¨è°ƒç”¨wait()ç³»åˆ—ç³»ç»Ÿè°ƒç”¨å›æ”¶æ‰€æœ‰å­è¿›ç¨‹èµ„æºå› æ­¤ï¼Œå†…æ ¸é»˜è®¤å°†å­¤å„¿è¿›ç¨‹çš„ PPID é‡ç½®ä¸º 1 å·è¿›ç¨‹ï¼Œåˆ©ç”¨å…¶ç‰¹æ€§ä¿è¯å­¤å„¿è¿›ç¨‹ç»ˆæ­¢åèƒ½è¢«åŠæ—¶å›æ”¶ï¼Œé¿å…æˆä¸ºåƒµå°¸è¿›ç¨‹ï¼ˆZçŠ¶æ€ï¼‰ã€‚\n\n\n\né1å·è¿›ç¨‹çš„ç‰¹æ®Šåœºæ™¯\né 1 å·è¿›ç¨‹æˆä¸ºé¢†å…»è€…ï¼Œæœ¬è´¨ä¸Šä¸ Linux çš„è¿›ç¨‹å‘½åç©ºé—´ï¼ˆprocess namespaceï¼‰ æœºåˆ¶ç›¸å…³ï¼š\n\næ¯ä¸ªå‘½åç©ºé—´ï¼ˆå¦‚å®¹å™¨ç¯å¢ƒã€ç”¨æˆ·ä¼šè¯ï¼‰éƒ½æœ‰ç‹¬ç«‹çš„è¿›ç¨‹ ID ç©ºé—´ï¼Œå…¶ä¸­ä¹Ÿä¼šå­˜åœ¨ä¸€ä¸ª â€œå‘½åç©ºé—´å†…çš„ 1 å·è¿›ç¨‹â€ï¼ˆå³è¯¥å‘½åç©ºé—´çš„åˆå§‹åŒ–è¿›ç¨‹ï¼‰ã€‚\nå½“å­¤å„¿è¿›ç¨‹ä½äºéåˆå§‹å‘½åç©ºé—´æ—¶ï¼Œå†…æ ¸ä¼šå°†å…¶ PPID é‡ç½®ä¸ºè¯¥å‘½åç©ºé—´å†…çš„ 1 å·è¿›ç¨‹ï¼Œè€Œéå…¨å±€ 1 å·è¿›ç¨‹ã€‚ä¾‹å¦‚ï¼š\nå®¹å™¨ç¯å¢ƒä¸­ï¼Œå®¹å™¨å†…çš„ 1 å·è¿›ç¨‹ï¼ˆå¦‚containerd-shimæˆ–å®¹å™¨å†…çš„initï¼‰ä¼šé¢†å…»å®¹å™¨å†…çš„å­¤å„¿è¿›ç¨‹ã€‚\nç”¨æˆ·ä¼šè¯ä¸­ï¼Œsystemd --userè¿›ç¨‹ï¼ˆå¯èƒ½æ˜¯ 1867 å·ï¼‰ä½œä¸ºç”¨æˆ·ä¼šè¯å‘½åç©ºé—´çš„åˆå§‹åŒ–è¿›ç¨‹ï¼Œä¼šé¢†å…»è¯¥ä¼šè¯å†…çš„å­¤å„¿è¿›ç¨‹ã€‚\n\n\n\næ˜¯å¦ä¼šæŒ‡å‘å…¶ä»–è¿›ç¨‹ï¼Ÿ\nç†è®ºä¸Šï¼Œå†…æ ¸åªä¼šé€‰æ‹©å‘½åç©ºé—´å†…çš„ 1 å·è¿›ç¨‹ä½œä¸ºé¢†å…»è€…ï¼Œè€Œéä»»æ„è¿›ç¨‹ã€‚è¿™æ˜¯å› ä¸ºï¼š\n\né¢†å…»è€…å¿…é¡»å…·å¤‡ â€œä¸ä¼šä¸»åŠ¨é€€å‡ºâ€ ä¸” â€œä¼šå¤„ç†å­è¿›ç¨‹å›æ”¶â€ çš„ç‰¹æ€§ï¼Œæ™®é€šç”¨æˆ·è¿›ç¨‹ä¸æ»¡è¶³è¿™ä¸€è¦æ±‚ã€‚\nå†…æ ¸é€šè¿‡find_new_reaper()å‡½æ•°ç¡®å®šé¢†å…»è€…ï¼Œè¯¥å‡½æ•°çš„é€»è¾‘æ˜¯ï¼šåœ¨å½“å‰å‘½åç©ºé—´ä¸­å¯»æ‰¾ â€œæœ€é¡¶å±‚â€ çš„ init ç±»è¿›ç¨‹ï¼ˆå³å‘½åç©ºé—´å†…çš„ 1 å·è¿›ç¨‹ï¼‰ã€‚\n\n\n\n","categories":["ç¼–ç¨‹"],"tags":["C++","Linux"]},{"title":"SSHçš„ç”Ÿæˆä¸é…ç½®","url":"/2025/07/28/linux/SSH%E7%9A%84%E7%94%9F%E6%88%90%E4%B8%8E%E9%85%8D%E7%BD%AE/","content":"è®°å½•SSHçš„ç”¨æ³•\n \nSSHçš„ç”Ÿæˆä¸é…ç½®\nç”Ÿæˆ\n1.æ£€æŸ¥Linuxä¸­æ˜¯å¦æœ‰ssh\n#æ£€æŸ¥æ˜¯å¦å®‰è£…ssh -V#æ£€æŸ¥æ˜¯å¦æ­£åœ¨è¿è¡Œsudo systemctl status sshd #å¯åŠ¨sshsudo systemctl start sshd#è®¾ç½®ä¸ºå¼€æœºè‡ªå¯sudo systemctl enable sshd\n2.ç”Ÿæˆå¯†é’¥å¯¹\n#è¯¥ç®—æ³•æ›´å®‰å…¨é«˜æ•ˆssh-keygen -t ed25519#è‹¥ä¸æ”¯æŒet25519ssh-keygen -t rsa -b 4096\nä¹‹åä¸€ç›´æŒ‰å›è½¦å³å¯,ç”Ÿæˆçš„å…¬é’¥å’Œç§é’¥ä¼šé»˜è®¤ä¿å­˜è‡³~/.sshç›®å½•ä¸‹\né…ç½®\n\nå°†æœ¬æœºå…¬é’¥éƒ¨ç½²åˆ°æœåŠ¡å™¨,å®ç°æ— å¯†ç ç™»å½•\n\næ³•ä¸€:ssh-copy-id\nssh-copy-id -i ~/.ssh/id_ed25519.pub ç”¨æˆ·å@æœåŠ¡å™¨IP\n\n\næ— å‚æ•° i ä¼šé»˜è®¤å°è¯•å¤åˆ¶å½“å‰ç”¨æˆ·ç›®å½•ä¸‹çš„é»˜è®¤å…¬é’¥æ–‡ä»¶ï¼ˆé€šå¸¸æ˜¯ ~/.ssh/id_rsa.pubï¼Œå¦‚æœå­˜åœ¨çš„è¯ï¼‰\n\n\n**æ³•äºŒ:**æ‰‹åŠ¨ä¸Šä¼ \n# å°†æœ¬åœ°å…¬é’¥å†…å®¹ä¼ åˆ°æœåŠ¡å™¨çš„authorized_keyscat ~/.ssh/id_ed25519.pub | ssh ç”¨æˆ·å@æœåŠ¡å™¨IP &quot;cat &gt;&gt; ~/.ssh/authorized_keys &amp;&amp; chmod 600 ~/.ssh/authorized_keys&quot;\n**æ³•ä¸‰:**ä½¿ç”¨scp\nscp ~/.ssh/æœ¬åœ°å…¬é’¥æ–‡ä»¶å è¿œç¨‹ç”¨æˆ·å@è¿œç¨‹æœåŠ¡å™¨IP:~/ç›®æ ‡è·¯å¾„\nä¹‹åå†æŠŠä¼ è¾“è¿‡å»çš„å…¬é’¥å†™å…¥authorized_keysæ–‡ä»¶ä¸­\nå¸¸è§é—®é¢˜è§£å†³\n\n\næƒé™é”™è¯¯ï¼šè‹¥æç¤º â€œPermission deniedâ€ï¼Œæ£€æŸ¥æœåŠ¡å™¨~/.sshå’Œauthorized_keysçš„æƒé™æ˜¯å¦ä¸º 700 å’Œ 600ã€‚\n\n\nç«¯å£é—®é¢˜ï¼šæœåŠ¡å™¨ SSH ç«¯å£éé»˜è®¤æ—¶ï¼Œè¿æ¥éœ€æŒ‡å®šç«¯å£ï¼šssh -p 2222 ç”¨æˆ·å@IPï¼Œæˆ–åœ¨configä¸­é…ç½®Portã€‚\n\n\nå¯†é’¥æœªç”Ÿæ•ˆï¼šé‡å¯æœåŠ¡å™¨ SSH æœåŠ¡ï¼šsudo systemctl restart sshdï¼ˆLinuxï¼‰ã€‚\n\n\n","categories":["ç¼–ç¨‹"],"tags":["å·¥å…·","SSH"]},{"title":"TCPã€UDPæ•°æ®è¯»å†™åŸºç¡€","url":"/2025/07/28/linux/TCP,UDP%E6%95%B0%E6%8D%AE%E8%AF%BB%E5%86%99%E5%9F%BA%E7%A1%80/","content":"å¦‚ä½•ä½¿ç”¨ C++ è¿›è¡Œ TCP å’Œ UDP æ•°æ®è¯»å†™çš„åŸºç¡€çŸ¥è¯†\n \nä¸€ã€é€šç”¨æ•°æ®è¯»å†™åŸºç¡€ï¼ˆTCP/UDP å‡éœ€æŒæ¡ï¼‰\næ— è®ºä½¿ç”¨ä½•ç§åè®®ï¼Œç½‘ç»œæ•°æ®è¯»å†™éƒ½éœ€å¤„ç†å­—èŠ‚åºè½¬æ¢ã€æ•°æ®åºåˆ—åŒ–å’Œé”™è¯¯å¤„ç†ï¼Œè¿™æ˜¯è·¨å¹³å°é€šä¿¡çš„åŸºç¡€ã€‚\n1. å­—èŠ‚åºè½¬æ¢ï¼ˆè§£å†³ä¸»æœºä¸ç½‘ç»œå­—èŠ‚åºå·®å¼‚ï¼‰\nç½‘ç»œåè®®è§„å®šä½¿ç”¨å¤§ç«¯å­—èŠ‚åºï¼ˆç½‘ç»œå­—èŠ‚åºï¼‰ï¼Œä¸»æœºå­—èŠ‚åºå¯èƒ½ä¸ºå¤§ç«¯æˆ–å°ç«¯ï¼ˆå¦‚ x86 ä¸ºå°ç«¯ï¼‰ï¼Œéœ€é€šè¿‡ä»¥ä¸‹å‡½æ•°è½¬æ¢ï¼š\n\n\nuint16_t htons(uint16_t hostshort)ï¼šä¸»æœºâ†’ç½‘ç»œå­—èŠ‚åºï¼ˆ16 ä½ï¼Œå¦‚ç«¯å£å·ï¼‰\n\n\nuint32_t htonl(uint32_t hostlong)ï¼šä¸»æœºâ†’ç½‘ç»œå­—èŠ‚åºï¼ˆ32 ä½ï¼Œå¦‚ IPv4 åœ°å€ï¼‰\n\n\nuint16_t ntohs(uint16_t netshort)ï¼šç½‘ç»œâ†’ä¸»æœºå­—èŠ‚åºï¼ˆ16 ä½ï¼‰\n\n\nuint32_t ntohl(uint32_t netlong)ï¼šç½‘ç»œâ†’ä¸»æœºå­—èŠ‚åºï¼ˆ32 ä½ï¼‰\n\n\nè¿›é˜¶åœºæ™¯ï¼š\n\n\n64 ä½æ•°æ®ï¼šPOSIX æä¾›htobe64/be64tohï¼ˆå¤§ç«¯ï¼‰ã€htole64/le64tohï¼ˆå°ç«¯ï¼‰ï¼ŒWindows éœ€æ‰‹åŠ¨å®ç°ã€‚\n\n\næµ®ç‚¹æ•°ï¼šæ— æ ‡å‡†è½¬æ¢å‡½æ•°ï¼Œéœ€é€šè¿‡æŒ‡é’ˆè½¬æ¢ä¸ºå­—èŠ‚æ•°ç»„ä¼ è¾“ï¼ˆä¾èµ– IEEE 754 å…¼å®¹ï¼‰ã€‚\n\n\nç¤ºä¾‹ï¼š\nint port = 8080;sockaddr_in addr;addr.sin_port = htons(port);  // ç«¯å£å¿…é¡»ç”¨ç½‘ç»œå­—èŠ‚åº\n2. æ•°æ®åºåˆ—åŒ–ä¸ç¼“å†²åŒºç®¡ç†\nç½‘ç»œä¼ è¾“çš„æ˜¯å­—èŠ‚æµï¼Œéœ€é€šè¿‡ç¼“å†²åŒºå¤„ç†ï¼Œç»“æ„åŒ–æ•°æ®éœ€åºåˆ—åŒ–ä»¥é¿å…å¯¹é½å’Œå­—èŠ‚åºé—®é¢˜ã€‚\næ ¸å¿ƒå‡½æ•°ï¼š\n\n\nmemcpy(void *dest, const void *src, size_t n)ï¼šæ‹·è´å­—èŠ‚ï¼ˆç”¨äºåºåˆ—åŒ–ï¼‰\n\n\nmemset(void *s, int c, size_t n)ï¼šåˆå§‹åŒ–ç¼“å†²åŒºï¼ˆå¦‚æ¸…ç©ºæ¥æ”¶ç¼“å†²åŒºï¼‰\n\n\nstrlen(const char *s)ï¼šè®¡ç®—å­—ç¬¦ä¸²é•¿åº¦ï¼ˆç”¨äºå‘é€å­—ç¬¦ä¸²ï¼‰\n\n\nåºåˆ—åŒ–æ–¹æ¡ˆï¼š\n\n\næ‰‹åŠ¨åºåˆ—åŒ–ï¼šæ‹†åˆ†ç»“æ„ä½“æˆå‘˜ï¼Œè½¬æ¢å­—èŠ‚åºåå†™å…¥ç¼“å†²åŒºï¼š\nstruct Msg &#123; int len; short type; &#125;;char buf[6];int net_len = htonl(msg.len);short net_type = htons(msg.type);memcpy(buf, &amp;net_len, 4);memcpy(buf+4, &amp;net_type, 2);\n\n\nåè®®åº“ï¼šProtobufã€FlatBuffers ç­‰è‡ªåŠ¨å¤„ç†å¯¹é½å’Œå­—èŠ‚åºã€‚\n\n\nç¼“å†²åŒºç­–ç•¥ï¼š\n\n\nåŠ¨æ€ç¼“å†²åŒºï¼šä½¿ç”¨vector&lt;char&gt;é¿å…æ ˆæº¢å‡ºï¼Œé€‚åˆæ¥æ”¶æœªçŸ¥é•¿åº¦æ•°æ®ã€‚\n\n\nåˆ†æ•£ - èšé›† IOï¼šé€šè¿‡iovecå’Œsendmsg/recvmsgå‡å°‘å†…å­˜æ‹·è´ï¼š\nstruct iovec iov[2];  // åˆ†æ•£å‘é€æ¶ˆæ¯å¤´å’Œæ¶ˆæ¯ä½“iov[0].iov_base = &amp;header;iov[0].iov_len = sizeof(header);iov[1].iov_base = data;iov[1].iov_len = data_len;struct msghdr msg;msg.msg_iov = iov;msg.msg_iovlen = 2;sendmsg(sockfd, &amp;msg, 0);\n\n\n3. é€šç”¨é”™è¯¯å¤„ç†\nç½‘ç»œå‡½æ•°å¤±è´¥æ—¶è¿”å› - 1ï¼Œéœ€é€šè¿‡é”™è¯¯ç å®šä½é—®é¢˜ï¼š\n\n\nLinuxï¼šerrnoï¼ˆå¦‚EINTRã€ECONNRESETï¼‰\n\n\nWindowsï¼šWSAGetLastError()ï¼ˆå¦‚WSAECONNRESETï¼‰\n\n\nå¸¸è§é”™è¯¯ï¼š\n\n\nEINTRï¼šæ“ä½œè¢«ä¿¡å·ä¸­æ–­ï¼ˆéœ€é‡è¯•ï¼‰\n\n\nEWOULDBLOCKï¼šéé˜»å¡æ¨¡å¼ä¸‹æ— æ•°æ®ï¼ˆéœ€ç­‰å¾…ï¼‰\n\n\nECONNRESETï¼šè¿æ¥è¢«å¯¹æ–¹é‡ç½®\n\n\nENOTCONNï¼šTCP æœªè¿æ¥æˆ– UDP æœªæŒ‡å®šç›®æ ‡\n\n\näºŒã€TCP æ•°æ®è¯»å†™ï¼ˆé¢å‘è¿æ¥çš„å­—èŠ‚æµï¼‰\nTCP æ˜¯å¯é çš„é¢å‘è¿æ¥åè®®ï¼Œæ•°æ®æ— è¾¹ç•Œï¼Œéœ€é€šè¿‡åº”ç”¨å±‚åè®®ç•Œå®šæ¶ˆæ¯è¾¹ç•Œã€‚\n1. æ ¸å¿ƒè¯»å†™å‡½æ•°\n\n\nå‘é€ï¼šssize_t send(int sockfd, const void *buf, size_t len, int flags)\n\nå‚æ•°ï¼šsockfdï¼ˆå·²è¿æ¥çš„ TCP socketï¼‰ã€ç¼“å†²åŒºã€é•¿åº¦ã€æ ‡å¿—ï¼ˆé€šå¸¸ 0ï¼‰ã€‚\nè¿”å›å€¼ï¼šå®é™…å‘é€å­—èŠ‚æ•°ï¼ˆå¯èƒ½å°äºlenï¼‰ï¼›å¤±è´¥è¿”å› - 1ã€‚\næ ‡å¿—ï¼šMSG_NOSIGNALï¼ˆLinuxï¼‰ï¼šé¿å…å¯¹æ–¹å…³é—­æ—¶è§¦å‘ SIGPIPEã€‚\n\n\n\næ¥æ”¶ï¼šssize_t recv(int sockfd, void *buf, size_t len, int flags)\n\nå‚æ•°ï¼šsockfdã€æ¥æ”¶ç¼“å†²åŒºã€é•¿åº¦ã€æ ‡å¿—ï¼ˆé€šå¸¸ 0ï¼‰ã€‚\nè¿”å›å€¼ï¼šå®é™…æ¥æ”¶å­—èŠ‚æ•°ï¼›0 è¡¨ç¤ºå¯¹æ–¹æ­£å¸¸å…³é—­ï¼›-1 è¡¨ç¤ºé”™è¯¯ã€‚\næ ‡å¿—ï¼šMSG_PEEKï¼ˆé¢„è§ˆæ•°æ®ä¸ç§»é™¤ï¼‰ã€‚\n\n\n\nMSG_OOB\n\n\nå‘é€ / æ¥æ”¶å¸¦å¤–æ•°æ®ï¼ˆOut-of-Band dataï¼‰ï¼Œç”¨äºä¼ è¾“ç´§æ€¥æ•°æ®ã€‚å¸¦å¤–æ•°æ®å…·æœ‰æ›´é«˜çš„ä¼˜å…ˆçº§ï¼Œå¯ç»•è¿‡å¸¸è§„æ•°æ®æµçš„æ’é˜Ÿæœºåˆ¶ã€‚\n\n\nMSG_PEEK\n\n\nä»…é€‚ç”¨äº recv()ï¼šæŸ¥çœ‹ç¼“å†²åŒºä¸­çš„æ•°æ®ï¼Œä½†ä¸ä¼šå°†å…¶ä»ç¼“å†²åŒºä¸­ç§»é™¤ï¼ˆå³æ•°æ®ä»ç„¶å¯ä»¥è¢«åç»­çš„ recv() è°ƒç”¨è¯»å–ï¼‰ã€‚\n\n\nå¯¹ send() æ— æ•ˆã€‚\n\n\nMSG_WAITALL\n\n\nä»…é€‚ç”¨äº recv()ï¼šè¦æ±‚å‡½æ•°é˜»å¡ç›´åˆ°æ¥æ”¶åˆ° len å‚æ•°æŒ‡å®šçš„å…¨éƒ¨æ•°æ®ï¼ˆé™¤éå‘ç”Ÿé”™è¯¯æˆ–è¿æ¥å…³é—­ï¼‰ã€‚\n\n\næ³¨æ„ï¼šå³ä½¿è®¾ç½®äº†æ­¤æ ‡å¿—ï¼Œä¹Ÿå¯èƒ½å› ä¿¡å·ä¸­æ–­ã€è¿æ¥å…³é—­ç­‰åŸå› å¯¼è‡´å®é™…æ¥æ”¶çš„æ•°æ®å°‘äº lenã€‚\n\n\nä»…é€‚ç”¨äº send() çš„æ ‡å¿—\nMSG_DONTROUTE\n\n\nå‘ŠçŸ¥å†…æ ¸ä¸ä½¿ç”¨è·¯ç”±è¡¨ï¼Œç›´æ¥å°†æ•°æ®å‘é€åˆ°æœ¬åœ°ç½‘ç»œä¸Šçš„ä¸»æœºï¼ˆä»…é€‚ç”¨äº UDP æˆ–åŸå§‹å¥—æ¥å­—ï¼‰ã€‚\n\n\nMSG_NOSIGNAL\n\n\nå½“è¿æ¥å·²å…³é—­æ—¶ï¼Œå‘é€æ•°æ®ä¸ä¼šäº§ç”Ÿ SIGPIPE ä¿¡å·ï¼ˆé»˜è®¤æƒ…å†µä¸‹ä¼šäº§ç”Ÿè¯¥ä¿¡å·å¯¼è‡´ç¨‹åºç»ˆæ­¢ï¼‰ã€‚\n\n\n2. å…³é”®ç‰¹æ€§ä¸å®ç°\n\n\nå­—èŠ‚æµæ— è¾¹ç•Œï¼šéœ€åº”ç”¨å±‚å®šä¹‰æ¶ˆæ¯æ ¼å¼ï¼Œå¸¸è§æ–¹æ¡ˆï¼š\n\n\n**å›ºå®šé•¿åº¦:**ç´¯è®¡è¯»å–åˆ°æŒ‡å®šé•¿åº¦åå¤„ç†ï¼š\nssize_t recv_fixed(int sockfd, char *buf, size_t fixed_len) &#123;    size_t total = 0;    while (total &lt; fixed_len) &#123;        ssize_t n = recv(sockfd, buf + total, fixed_len - total, 0);        if (n &lt;= 0) return n;  // é”™è¯¯æˆ–è¿æ¥å…³é—­        total += n;    &#125;    return total;&#125;\n\n\n**é•¿åº¦å‰ç¼€:**å…ˆè¯»é•¿åº¦å­—æ®µï¼Œå†è¯»å¯¹åº”æ•°æ®ï¼š\nstd::vector&lt;char&gt; recv_with_header(int sockfd) &#123;    uint32_t net_len;    if (recv_fixed(sockfd, (char*)&amp;net_len, 4) != 4) return &#123;&#125;;    size_t len = ntohl(net_len);    std::vector&lt;char&gt; data(len);    recv_fixed(sockfd, data.data(), len);    return data;&#125;\n\n\nåˆ†éš”ç¬¦ï¼šå¦‚\\r\\nï¼ˆHTTP å¤´éƒ¨æ–¹å¼ï¼‰ã€‚\n\n\n\n\nå¾ªç¯è¯»å†™ï¼šsend/recvå¯èƒ½ä¸ä¸€æ¬¡æ€§å¤„ç†å…¨éƒ¨æ•°æ®ï¼Œéœ€å¾ªç¯è°ƒç”¨ï¼š\nssize_t send_all(int sockfd, const void *buf, size_t len) &#123;    size_t total_sent = 0;    while (total_sent &lt; len) &#123;        ssize_t sent = send(sockfd, (char*)buf + total_sent, len - total_sent, 0);        if (sent == -1) return -1;        total_sent += sent;    &#125;    return total_sent;&#125;\n\n\n3. è¿æ¥å¼‚å¸¸å¤„ç†\n\n\nåŠå…³é—­ï¼šå¯¹æ–¹shutdown(SHUT_WR)åï¼Œrecvè¿”å› 0ï¼ˆå¯ç»§ç»­å‘é€æ•°æ®ï¼‰ã€‚\n\n\né‡ç½®è¿æ¥ï¼šrecvè¿”å› - 1 ä¸”errno=ECONNRESETï¼Œéœ€å…³é—­ socket å¹¶é‡è¿ã€‚\n\n\nè¶…æ—¶è®¾ç½®:  é€šè¿‡SO_RCVTIMEO/SO_SNDTIMEOè®¾ç½®è¯»å†™è¶…æ—¶ï¼š\nstruct timeval timeout = &#123;5, 0&#125;;  // 5ç§’è¶…æ—¶setsockopt(sockfd, SOL_SOCKET, SO_RCVTIMEO, &amp;timeout, sizeof(timeout));\n\n\nä¸‰ã€UDP æ•°æ®è¯»å†™ï¼ˆæ— è¿æ¥çš„æ•°æ®åŒ…ï¼‰\nUDP æ˜¯ä¸å¯é çš„æ— è¿æ¥åè®®ï¼Œæ•°æ®æœ‰è¾¹ç•Œï¼ˆä¸€æ¬¡å‘é€å¯¹åº”ä¸€æ¬¡æ¥æ”¶ï¼‰ï¼Œæ— éœ€å»ºç«‹è¿æ¥ã€‚\n1. æ ¸å¿ƒè¯»å†™å‡½æ•°\n\n\nå‘é€ï¼šssize_t sendto(int sockfd, const void *buf, size_t len, int flags, const struct sockaddr *dest_addr, socklen_t addrlen)\n\nå‚æ•°ï¼šsockfdï¼ˆUDP socketï¼‰ã€ç¼“å†²åŒºã€é•¿åº¦ã€æ ‡å¿—ã€ç›®æ ‡åœ°å€åŠé•¿åº¦ã€‚\nè¿”å›å€¼ï¼šæˆåŠŸè¿”å›å‘é€å­—èŠ‚æ•°ï¼ˆç­‰äºlenï¼‰ï¼›å¤±è´¥è¿”å› - 1ã€‚\n\n\n\næ¥æ”¶ï¼šssize_t recvfrom(int sockfd, void *buf, size_t len, int flags, struct sockaddr *src_addr, socklen_t *addrlen)\n\nå‚æ•°ï¼šsockfdã€æ¥æ”¶ç¼“å†²åŒºã€é•¿åº¦ã€æ ‡å¿—ã€å‘é€æ–¹åœ°å€ï¼ˆè¾“å‡ºï¼‰åŠé•¿åº¦ï¼ˆè¾“å…¥è¾“å‡ºï¼‰ã€‚\nè¿”å›å€¼ï¼šæ¥æ”¶å­—èŠ‚æ•°ï¼ˆâ‰¤lenï¼‰ï¼›å¤±è´¥è¿”å› - 1ã€‚\n\n\n\n2. å…³é”®ç‰¹æ€§ä¸å®ç°\n\n\næ•°æ®æŠ¥è¾¹ç•Œï¼šä¸€æ¬¡sendtoçš„æ•°æ®å¯è¢«recvfromå®Œæ•´æ¥æ”¶ï¼ˆç¼“å†²åŒºè¶³å¤Ÿæ—¶ï¼‰ã€‚\n\n\né•¿åº¦é™åˆ¶ï¼šè¶…è¿‡ MTUï¼ˆé€šå¸¸ 1500 å­—èŠ‚ï¼‰ä¼šåˆ†ç‰‡ï¼Œå»ºè®®å•åŒ…â‰¤1472 å­—èŠ‚ï¼ˆ1500-20IP å¤´ - 8UDP å¤´ï¼‰ã€‚\n\n\næˆªæ–­æ£€æµ‹ï¼šMSG_TRUNCæ ‡å¿—å¯æ£€æµ‹æ•°æ®æ˜¯å¦è¢«æˆªæ–­ï¼š\nsocklen_t addrlen = sizeof(addr);ssize_t n = recvfrom(sockfd, buf, len, MSG_TRUNC, &amp;addr, &amp;addrlen);if (n == len &amp;&amp; (flags &amp; MSG_TRUNC)) &#123; /* æ•°æ®è¢«æˆªæ–­ */ &#125;\n\n\n3. è¿æ¥åŒ– UDPï¼ˆConnected UDPï¼‰\né€šè¿‡connectç»‘å®šå›ºå®šç›®æ ‡åœ°å€åï¼Œå¯ä½¿ç”¨send/recvç®€åŒ–æ“ä½œï¼ˆä»ä¸º UDP ç‰¹æ€§ï¼‰ï¼š\nstruct sockaddr_in dest_addr;// åˆå§‹åŒ–ç›®æ ‡åœ°å€...connect(udp_sockfd, (struct sockaddr*)&amp;dest_addr, sizeof(dest_addr));send(udp_sockfd, buf, len, 0);  // æ— éœ€é‡å¤æŒ‡å®šåœ°å€\n4. å¯é æ€§å¢å¼º\nUDP æœ¬èº«ä¸å¯é ï¼Œéœ€åº”ç”¨å±‚è¡¥å……æœºåˆ¶ï¼š\n\n\nåºå·ä¸ç¡®è®¤ï¼ˆé‡ä¼ è¶…æ—¶æœªç¡®è®¤çš„åŒ…ï¼‰\n\n\næ ¡éªŒå’Œï¼ˆæ£€æµ‹æ•°æ®æŸåï¼‰\n\n\næµé‡æ§åˆ¶ï¼ˆé¿å…æ¥æ”¶æ–¹æº¢å‡ºï¼‰\n\n\nå››ã€é«˜çº§å‡½æ•°ä¸æ€§èƒ½ä¼˜åŒ–\n\n\nssize_t sendmsg(int sockfd, const struct msghdr *msg, int flags)ï¼šæ”¯æŒåˆ†æ•£å‘é€ï¼ˆå¤šä¸ªç¼“å†²åŒºæ•°æ®åˆå¹¶å‘é€ï¼‰ï¼Œé€‚åˆå‘é€å¤æ‚æ•°æ®ç»“æ„ã€‚\n\n\nssize_t recvmsg(int sockfd, struct msghdr *msg, int flags)ï¼šæ”¯æŒèšé›†æ¥æ”¶ï¼ˆå°†æ•°æ®åˆ†æ•£åˆ°å¤šä¸ªç¼“å†²åŒºï¼‰ï¼Œå¸¸ç”¨äºæ¥æ”¶å¸¦è¾…åŠ©æ•°æ®ï¼ˆå¦‚æ§åˆ¶ä¿¡æ¯ï¼‰çš„æ•°æ®åŒ…ã€‚\n\n\nssize_t sendfile(int out_fd, int in_fd, off_t *offset, size_t count)ï¼ˆLinuxï¼‰ï¼šé›¶æ‹·è´å‘é€æ–‡ä»¶ï¼Œç›´æ¥ä»æ–‡ä»¶æè¿°ç¬¦in_fdå‘é€åˆ°socketï¼ˆout_fdï¼‰ï¼Œå‡å°‘ç”¨æˆ·æ€ä¸å†…æ ¸æ€æ‹·è´ï¼Œæ•ˆç‡æé«˜ã€‚\n\n\næ€§èƒ½ä¼˜åŒ–ï¼š\n\n\nTCPï¼šç¦ç”¨ Nagle ç®—æ³•ï¼ˆTCP_NODELAYï¼‰å‡å°‘å»¶è¿Ÿï¼›å¢å¤§ç¼“å†²åŒºï¼ˆSO_SNDBUF/SO_RCVBUFï¼‰æé«˜ååé‡ã€‚\n\n\nUDPï¼šé¿å…ç¢ç‰‡åŒ–ï¼›æ‰¹é‡å‘é€å‡å°‘ç³»ç»Ÿè°ƒç”¨ã€‚\n\n\nIO æ¨¡å‹ï¼šé«˜å¹¶å‘åœºæ™¯ä½¿ç”¨éé˜»å¡ IO+epollï¼ˆLinuxï¼‰/kqueueï¼ˆBSDï¼‰ã€‚\n\n\näº”ã€è·¨å¹³å°å…¼å®¹æ€§\n\n\nWindows éœ€åˆå§‹åŒ–å¥—æ¥å­—åº“ï¼ˆWSAStartupï¼‰ï¼ŒLinux æ— éœ€ã€‚\n\n\né”™è¯¯å¤„ç†ï¼šWindows ç”¨WSAGetLastError()ï¼ŒLinux ç”¨errnoã€‚\n\n\nå…³é—­ socketï¼šWindows ç”¨closesocketï¼ŒLinux ç”¨closeã€‚\n\n\nå…¼å®¹ä»£ç ç¤ºä¾‹ï¼š\n#ifdef _WIN32#include &lt;winsock2.h&gt;#define close closesocket#else#include &lt;unistd.h&gt;#include &lt;errno.h&gt;#endifint get_last_error() &#123;#ifdef _WIN32    return WSAGetLastError();#else    return errno;#endif&#125;\n\n\nTCPï¼šç”¨send/recvï¼Œé¢å‘è¿æ¥ï¼Œéœ€å¤„ç†å­—èŠ‚æµæ— è¾¹ç•Œé—®é¢˜ï¼Œé€‚åˆå¯é ä¼ è¾“ï¼ˆå¦‚ HTTPï¼‰ã€‚\n\n\nUDPï¼šç”¨sendto/recvfromï¼Œæ— è¿æ¥ï¼Œä¿ç•™æ•°æ®æŠ¥è¾¹ç•Œï¼Œé€‚åˆå®æ—¶åœºæ™¯ï¼ˆå¦‚è§†é¢‘æµï¼‰ã€‚\n\n\né€šç”¨åŸºç¡€ï¼šå­—èŠ‚åºè½¬æ¢ã€åºåˆ—åŒ–ã€ç¼“å†²åŒºç®¡ç†å’Œé”™è¯¯å¤„ç†æ˜¯æ ¸å¿ƒå‰æã€‚\n\n\n","categories":["ç¼–ç¨‹"],"tags":["C++","Linux","ç½‘ç»œ"]},{"title":"SocketåŸºç¡€æ¦‚å¿µ","url":"/2025/08/15/linux/Socket%20%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5/","content":"socketåŸºç¡€æ¦‚å¿µ\n \nåœ¨ç½‘ç»œç¼–ç¨‹ä¸­ï¼ŒSocketï¼ˆå¥—æ¥å­—ï¼‰ æ˜¯è¿›ç¨‹é—´é€šä¿¡çš„æŠ½è±¡æ¥å£ï¼Œç”¨äºå®ç°ä¸åŒä¸»æœºæˆ–åŒä¸€ä¸»æœºå†…ä¸åŒè¿›ç¨‹ä¹‹é—´çš„ç½‘ç»œæ•°æ®ä¼ è¾“ã€‚å®ƒæ˜¯ TCP/IP åè®®æ ˆçš„ç¼–ç¨‹æ¥å£ï¼Œç°ä»£ C++ ç½‘ç»œå¼€å‘ä¸­ä¾ç„¶æ˜¯æ ¸å¿ƒåŸºç¡€ï¼ˆå°½ç®¡å¸¸è¢«å°è£…ä¸ºæ›´é«˜å±‚åº“å¦‚ Boost.Asioï¼‰ã€‚\nä¸€ã€Socket æ ¸å¿ƒæ¦‚å¿µ\n\n\næœ¬è´¨ï¼šSocket æ˜¯ä¸€ä¸ª â€œæ–‡ä»¶æè¿°ç¬¦â€ï¼ˆLinux/Unixï¼‰æˆ– â€œå¥æŸ„â€ï¼ˆWindowsï¼‰ï¼Œä»£è¡¨ä¸€ä¸ªç½‘ç»œé€šä¿¡ç«¯ç‚¹ï¼Œé€šè¿‡å®ƒå¯è¿›è¡Œæ•°æ®çš„å‘é€ / æ¥æ”¶ã€‚\n\n\nåˆ†ç±»ï¼š\n\næµå¼å¥—æ¥å­—ï¼ˆSOCK_STREAMï¼‰ï¼šåŸºäº TCP åè®®ï¼Œæä¾›å¯é ã€æœ‰åºã€åŒå‘çš„å­—èŠ‚æµä¼ è¾“ï¼ˆæ— æ•°æ®ä¸¢å¤± / é‡å¤ï¼Œé€‚åˆæ–‡ä»¶ä¼ è¾“ã€HTTP ç­‰ï¼‰ã€‚\næ•°æ®æŠ¥å¥—æ¥å­—ï¼ˆSOCK_DGRAMï¼‰ï¼šåŸºäº UDP åè®®ï¼Œæä¾›æ— è¿æ¥ã€ä¸å¯é çš„æ•°æ®åŒ…ä¼ è¾“ï¼ˆé€Ÿåº¦å¿«ï¼Œé€‚åˆè§†é¢‘é€šè¯ã€DNS ç­‰ï¼‰ã€‚\nåŸå§‹å¥—æ¥å­—ï¼ˆSOCK_RAWï¼‰ï¼šç›´æ¥æ“ä½œåº•å±‚åè®®ï¼ˆå¦‚ IPï¼‰ï¼Œç”¨äºç½‘ç»œè¯Šæ–­æˆ–è‡ªå®šä¹‰åè®®ï¼ˆéœ€ç®¡ç†å‘˜æƒé™ï¼‰ã€‚\n\n\n\né€šä¿¡æ¨¡å‹ï¼š\n\nTCP é‡‡ç”¨ â€œå®¢æˆ·ç«¯ - æœåŠ¡å™¨â€ æ¨¡å‹ï¼Œéœ€å…ˆå»ºç«‹è¿æ¥ï¼ˆä¸‰æ¬¡æ¡æ‰‹ï¼‰ï¼Œå†ä¼ è¾“æ•°æ®ã€‚\nUDP æ— è¿æ¥ï¼Œç›´æ¥å‘é€æ•°æ®åŒ…ï¼Œæ— éœ€æå‰å»ºç«‹è¿æ¥ã€‚\n\n\n\näºŒã€æ ¸å¿ƒå‡½æ•°è§£æï¼ˆåŸºäº TCPï¼Œç°ä»£ C++ è§†è§’ï¼‰\nä»¥ä¸‹å‡½æ•°æ˜¯ TCP é€šä¿¡çš„æ ¸å¿ƒï¼Œä¸»è¦ç”¨äºæœåŠ¡å™¨ç«¯å’Œå®¢æˆ·ç«¯çš„è¿æ¥å»ºç«‹è¿‡ç¨‹ã€‚\n1. socket()ï¼šåˆ›å»ºå¥—æ¥å­—\nä½œç”¨ï¼šåˆå§‹åŒ–ä¸€ä¸ªå¥—æ¥å­—ï¼Œè¿”å›å…¶æè¿°ç¬¦ï¼ˆåç»­æ“ä½œçš„å¥æŸ„ï¼‰ã€‚\nå‡½æ•°åŸå‹ï¼š\n#include &lt;sys/socket.h&gt;int socket(int domain, int type, int protocol);\nå‚æ•°è§£æï¼š\n\n\ndomainï¼šåœ°å€æ—ï¼ˆåè®®æ—ï¼‰ï¼ŒæŒ‡å®šç½‘ç»œå±‚åè®®ã€‚å¸¸è§å€¼ï¼š\n\nAF_INETï¼šIPv4 åè®®ï¼ˆæœ€å¸¸ç”¨ï¼‰ã€‚\nAF_INET6ï¼šIPv6 åè®®ã€‚\nAF_UNIXï¼šæœ¬åœ°è¿›ç¨‹é—´é€šä¿¡ï¼ˆUnix åŸŸå¥—æ¥å­—ï¼‰ã€‚\n\n\n\ntypeï¼šå¥—æ¥å­—ç±»å‹ï¼ŒæŒ‡å®šä¼ è¾“å±‚åè®®ç‰¹æ€§ï¼š\n\nSOCK_STREAMï¼šTCP æµå¼å¥—æ¥å­—ã€‚\nSOCK_DGRAMï¼šUDP æ•°æ®æŠ¥å¥—æ¥å­—ã€‚\n\n\n\nprotocolï¼šå…·ä½“åè®®ï¼ˆé€šå¸¸ä¸º 0ï¼Œç”±ç³»ç»Ÿæ ¹æ®å‰ä¸¤ä¸ªå‚æ•°è‡ªåŠ¨é€‰æ‹©ï¼‰ã€‚\n\n\nè¿”å›å€¼ï¼šæˆåŠŸè¿”å›éè´Ÿå¥—æ¥å­—æè¿°ç¬¦ï¼ˆsockfdï¼‰ï¼Œå¤±è´¥è¿”å› - 1ï¼ˆéœ€æ£€æŸ¥errnoï¼‰ã€‚\nç°ä»£ C++ å®è·µï¼šç”¨æ™ºèƒ½æŒ‡é’ˆï¼ˆå¦‚std::unique_ptrï¼‰é…åˆè‡ªå®šä¹‰åˆ é™¤å™¨ç®¡ç†sockfdï¼Œé¿å…èµ„æºæ³„æ¼ï¼š\n// è‡ªå®šä¹‰åˆ é™¤å™¨ï¼šå…³é—­å¥—æ¥å­—auto socket_deleter = [](int fd) &#123;   if (fd != -1) ::close(fd); &#125;;using UniqueSocket = std::unique_ptr&lt;int, decltype(socket_deleter)&gt;;// åˆ›å»ºå¥—æ¥å­—UniqueSocket create_socket() &#123;  int sockfd = ::socket(AF_INET, SOCK_STREAM, 0);  if (sockfd == -1) &#123;    throw std::runtime_error(&quot;socket creation failed: &quot; + std::string(strerror(errno)));  &#125;  return UniqueSocket(new int(sockfd), socket_deleter);&#125;\n2. bind()ï¼šç»‘å®šåœ°å€ä¸ç«¯å£\nä½œç”¨ï¼šå°†å¥—æ¥å­—ä¸ç‰¹å®šçš„ IP åœ°å€å’Œç«¯å£å·ç»‘å®šï¼ˆä¸»è¦ç”¨äºæœåŠ¡å™¨ç«¯ï¼Œå®¢æˆ·ç«¯é€šå¸¸ä¸ç»‘å®šï¼Œç”±ç³»ç»Ÿè‡ªåŠ¨åˆ†é…ç«¯å£ï¼‰ã€‚\nå‡½æ•°åŸå‹ï¼š\nint bind(int sockfd, const struct sockaddr* addr, socklen_t addrlen);\nå‚æ•°è§£æï¼š\n\n\nsockfdï¼šsocket()è¿”å›çš„å¥—æ¥å­—æè¿°ç¬¦ã€‚\n\n\naddrï¼šæŒ‡å‘åœ°å€ç»“æ„çš„æŒ‡é’ˆï¼ˆéœ€æ ¹æ®domainé€‰æ‹©å¯¹åº”ç±»å‹ï¼Œå¦‚ IPv4 ç”¨sockaddr_inï¼‰ã€‚\n\n\naddrlenï¼šåœ°å€ç»“æ„çš„å¤§å°ï¼ˆå­—èŠ‚æ•°ï¼‰ã€‚\n\n\nåœ°å€ç»“æ„å¤„ç†ï¼ˆä»¥ IPv4 ä¸ºä¾‹ï¼‰ï¼šsockaddræ˜¯é€šç”¨åœ°å€ç»“æ„ï¼Œå®é™…ä½¿ç”¨æ—¶éœ€è½¬æ¢ä¸ºå…·ä½“åè®®çš„ç»“æ„ï¼ˆå¦‚sockaddr_inï¼‰ï¼š\nstruct sockaddr_in &#123;  sa_family_t     sin_family;  // åœ°å€æ—ï¼ˆå¿…é¡»ä¸ºAF_INETï¼‰  uint16_t        sin_port;    // ç«¯å£å·ï¼ˆéœ€è½¬æ¢ä¸ºç½‘ç»œå­—èŠ‚åºï¼‰  struct in_addr  sin_addr;    // IPåœ°å€ï¼ˆéœ€è½¬æ¢ä¸ºç½‘ç»œå­—èŠ‚åºï¼‰  char            sin_zero[8]; // å¡«å……å­—æ®µï¼ˆé€šå¸¸ä¸º0ï¼‰&#125;;\nå­—èŠ‚åºè½¬æ¢ï¼šç½‘ç»œåè®®ä½¿ç”¨å¤§ç«¯å­—èŠ‚åºï¼ˆç½‘ç»œå­—èŠ‚åºï¼‰ï¼Œè€Œä¸»æœºå¯èƒ½æ˜¯å°ç«¯ / å¤§ç«¯ï¼Œéœ€ç”¨å‡½æ•°è½¬æ¢ï¼š\n\n\nhtons()ï¼šä¸»æœºå­—èŠ‚åºâ†’ç½‘ç»œå­—èŠ‚åºï¼ˆ16 ä½ï¼Œç”¨äºç«¯å£ï¼‰ã€‚\n\n\nhtonl()ï¼šä¸»æœºå­—èŠ‚åºâ†’ç½‘ç»œå­—èŠ‚åºï¼ˆ32 ä½ï¼Œç”¨äº IPv4 åœ°å€ï¼‰ã€‚\n\n\ninet_pton()ï¼šå­—ç¬¦ä¸² IPï¼ˆå¦‚ â€œ127.0.0.1â€ï¼‰â†’ç½‘ç»œå­—èŠ‚åºçš„æ•´æ•°ï¼ˆç°ä»£ C++ æ¨èï¼Œæ›¿ä»£æ—§çš„inet_addr()ï¼‰ã€‚\n\n\nç¤ºä¾‹ï¼š\n// ç»‘å®šåˆ°IPv4åœ°å€127.0.0.1:8080struct sockaddr_in server_addr;memset(&amp;server_addr, 0, sizeof(server_addr));server_addr.sin_family = AF_INET;server_addr.sin_port = htons(8080); // ç«¯å£è½¬æ¢ä¸ºç½‘ç»œå­—èŠ‚åº// IPåœ°å€è½¬æ¢ï¼ˆ&quot;0.0.0.0&quot;è¡¨ç¤ºç›‘å¬æ‰€æœ‰ç½‘ç»œæ¥å£ï¼‰if (inet_pton(AF_INET, &quot;0.0.0.0&quot;, &amp;server_addr.sin_addr) &lt;= 0) &#123;  throw std::runtime_error(&quot;invalid IP address: &quot; + std::string(strerror(errno)));&#125;// ç»‘å®šif (::bind(sockfd, reinterpret_cast&lt;struct sockaddr*&gt;(&amp;server_addr), sizeof(server_addr)) == -1) &#123;  throw std::runtime_error(&quot;bind failed: &quot; + std::string(strerror(errno)));&#125;\n3. listen()ï¼šç›‘å¬è¿æ¥ï¼ˆæœåŠ¡å™¨ç«¯ï¼‰\nä½œç”¨ï¼šå°†å¥—æ¥å­—è½¬ä¸º â€œç›‘å¬çŠ¶æ€â€ï¼Œå…è®¸æ¥æ”¶å®¢æˆ·ç«¯çš„è¿æ¥è¯·æ±‚ï¼ˆä»…ç”¨äº TCP æœåŠ¡å™¨ç«¯çš„sockfdï¼‰ã€‚\nå‡½æ•°åŸå‹ï¼š\nint listen(int sockfd, int backlog);\nå‚æ•°è§£æï¼š\n\n\nsockfdï¼šå·²ç»‘å®šçš„å¥—æ¥å­—æè¿°ç¬¦ï¼ˆbind()ä¹‹åï¼‰ã€‚\n\n\nbacklogï¼šæœªå®Œæˆè¿æ¥é˜Ÿåˆ—ï¼ˆä¸‰æ¬¡æ¡æ‰‹æœªå®Œæˆï¼‰çš„æœ€å¤§é•¿åº¦ï¼ˆè¶…è¿‡åˆ™å®¢æˆ·ç«¯è¿æ¥å¤±è´¥ï¼‰ã€‚å®é™…å€¼å—ç³»ç»Ÿé™åˆ¶ï¼ˆå¦‚/proc/sys/net/core/somaxconnï¼‰ï¼Œç°ä»£ç³»ç»Ÿé€šå¸¸å»ºè®®è®¾ä¸º 128 æˆ–æ›´é«˜ã€‚\n\n\nè¿”å›å€¼ï¼šæˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› - 1ã€‚\næ³¨æ„ï¼šlisten()ä¸é˜»å¡ï¼Œä»…è®¾ç½®å¥—æ¥å­—çŠ¶æ€ã€‚åç»­éœ€é€šè¿‡accept()è·å–å®é™…è¿æ¥ã€‚\n4. accept()ï¼šæ¥å—è¿æ¥ï¼ˆæœåŠ¡å™¨ç«¯ï¼‰\nä½œç”¨ï¼šä»listen()åˆ›å»ºçš„è¿æ¥é˜Ÿåˆ—ä¸­å–å‡ºä¸€ä¸ªå·²å®Œæˆçš„è¿æ¥ï¼Œè¿”å›ä¸€ä¸ªæ–°çš„å¥—æ¥å­—æè¿°ç¬¦ï¼ˆç”¨äºä¸è¯¥å®¢æˆ·ç«¯é€šä¿¡ï¼‰ã€‚\nå‡½æ•°åŸå‹ï¼š\nint accept(int sockfd, struct sockaddr* addr, socklen_t* addrlen);\nå‚æ•°è§£æï¼š\n\n\nsockfdï¼šå¤„äºç›‘å¬çŠ¶æ€çš„å¥—æ¥å­—ï¼ˆç›‘å¬å¥—æ¥å­—ï¼‰ã€‚\n\n\naddrï¼šè¾“å‡ºå‚æ•°ï¼Œç”¨äºå­˜å‚¨å®¢æˆ·ç«¯çš„åœ°å€ä¿¡æ¯ï¼ˆå¯è®¾ä¸ºnullptrå¿½ç•¥ï¼‰ã€‚\n\n\naddrlenï¼šè¾“å…¥è¾“å‡ºå‚æ•°ï¼Œä¼ å…¥addrçš„å¤§å°ï¼Œè¾“å‡ºå®é™…å­˜å‚¨çš„åœ°å€é•¿åº¦ï¼ˆå¯è®¾ä¸ºnullptrï¼‰ã€‚\n\n\nè¿”å›å€¼ï¼šæˆåŠŸè¿”å›æ–°çš„å¥—æ¥å­—æè¿°ç¬¦ï¼ˆclient_fdï¼Œç”¨äºä¸å®¢æˆ·ç«¯é€šä¿¡ï¼‰ï¼Œå¤±è´¥è¿”å› - 1ã€‚\nç‰¹æ€§ï¼šaccept()é»˜è®¤æ˜¯é˜»å¡å‡½æ•°ï¼Œç›´åˆ°æœ‰å®¢æˆ·ç«¯è¿æ¥åˆ°è¾¾æ‰è¿”å›ã€‚ç°ä»£ C++ ä¸­å¯ç»“åˆéé˜»å¡ I/O æˆ–å¤šçº¿ç¨‹å¤„ç†ï¼ˆå¦‚ç”¨std::threadä¸ºæ¯ä¸ªæ–°è¿æ¥åˆ›å»ºçº¿ç¨‹ï¼‰ã€‚\nç¤ºä¾‹ï¼š\nstruct sockaddr_in client_addr;socklen_t client_addr_len = sizeof(client_addr);// é˜»å¡ç­‰å¾…å®¢æˆ·ç«¯è¿æ¥int client_fd = ::accept(listen_fd, reinterpret_cast&lt;struct sockaddr*&gt;(&amp;client_addr), &amp;client_addr_len);if (client_fd == -1) &#123;  throw std::runtime_error(&quot;accept failed: &quot; + std::string(strerror(errno)));&#125;// æ‰“å°å®¢æˆ·ç«¯ä¿¡æ¯ï¼ˆå°†ç½‘ç»œå­—èŠ‚åºè½¬ä¸ºå­—ç¬¦ä¸²ï¼‰char client_ip[INET_ADDRSTRLEN];inet_ntop(AF_INET, &amp;client_addr.sin_addr, client_ip, INET_ADDRSTRLEN);uint16_t client_port = ntohs(client_addr.sin_port); // ç½‘ç»œå­—èŠ‚åºâ†’ä¸»æœºå­—èŠ‚åºstd::cout &lt;&lt; &quot;New connection from &quot; &lt;&lt; client_ip &lt;&lt; &quot;:&quot; &lt;&lt; client_port &lt;&lt; std::endl;\n5. connect()ï¼šå‘èµ·è¿æ¥ï¼ˆå®¢æˆ·ç«¯ï¼‰\nä½œç”¨ï¼šå®¢æˆ·ç«¯é€šè¿‡è¯¥å‡½æ•°å‘æœåŠ¡å™¨å‘èµ· TCP è¿æ¥ï¼ˆä¸‰æ¬¡æ¡æ‰‹çš„è§¦å‘ç‚¹ï¼‰ã€‚\nå‡½æ•°åŸå‹ï¼š\nint connect(int sockfd, const struct sockaddr* addr, socklen_t addrlen);\nå‚æ•°è§£æï¼š\n\n\nsockfdï¼šå®¢æˆ·ç«¯çš„å¥—æ¥å­—æè¿°ç¬¦ï¼ˆsocket()åˆ›å»ºï¼Œé€šå¸¸ä¸bind()ï¼‰ã€‚\n\n\naddrï¼šæœåŠ¡å™¨çš„åœ°å€ç»“æ„ï¼ˆåŒ…å«æœåŠ¡å™¨ IP å’Œç«¯å£ï¼‰ã€‚\n\n\naddrlenï¼šæœåŠ¡å™¨åœ°å€ç»“æ„çš„å¤§å°ã€‚\n\n\nè¿”å›å€¼ï¼šæˆåŠŸè¿”å› 0ï¼ˆè¿æ¥å»ºç«‹ï¼‰ï¼Œå¤±è´¥è¿”å› - 1ï¼ˆå¦‚æœåŠ¡å™¨æœªç›‘å¬ã€ç½‘ç»œä¸å¯è¾¾ç­‰ï¼‰ã€‚\nç‰¹æ€§ï¼šé»˜è®¤æ˜¯é˜»å¡å‡½æ•°ï¼Œç›´åˆ°è¿æ¥å»ºç«‹æˆ–å¤±è´¥æ‰è¿”å›ã€‚éé˜»å¡æ¨¡å¼ä¸‹ï¼Œå¯èƒ½è¿”å›EINPROGRESSï¼ˆè¿æ¥æ­£åœ¨å»ºç«‹ï¼‰ï¼Œéœ€é€šè¿‡select()/poll()ç­‰æ£€æŸ¥çŠ¶æ€ã€‚\nç¤ºä¾‹ï¼š\n// å®¢æˆ·ç«¯è¿æ¥æœåŠ¡å™¨ï¼ˆ127.0.0.1:8080ï¼‰struct sockaddr_in server_addr;memset(&amp;server_addr, 0, sizeof(server_addr));server_addr.sin_family = AF_INET;server_addr.sin_port = htons(8080);// è½¬æ¢æœåŠ¡å™¨IPif (inet_pton(AF_INET, &quot;127.0.0.1&quot;, &amp;server_addr.sin_addr) &lt;= 0) &#123;  throw std::runtime_error(&quot;invalid server IP&quot;);&#125;// å‘èµ·è¿æ¥if (::connect(client_fd, reinterpret_cast&lt;struct sockaddr*&gt;(&amp;server_addr), sizeof(server_addr)) == -1) &#123;  throw std::runtime_error(&quot;connect failed: &quot; + std::string(strerror(errno)));&#125;\nä¸‰ã€ç°ä»£ C++ æœ€ä½³å®è·µ\n\n\nèµ„æºç®¡ç†ï¼šç”¨ RAIIï¼ˆå¦‚æ™ºèƒ½æŒ‡é’ˆã€è‡ªå®šä¹‰å°è£…ç±»ï¼‰ç®¡ç†sockfdï¼Œé¿å…æ‰‹åŠ¨close()å¯¼è‡´çš„æ³„æ¼ã€‚\n\n\né”™è¯¯å¤„ç†ï¼šç”¨å¼‚å¸¸ï¼ˆstd::runtime_errorï¼‰æ›¿ä»£ä¼ ç»Ÿçš„if-elseæ£€æŸ¥ï¼Œæé«˜ä»£ç å¯è¯»æ€§ã€‚\n\n\nç±»å‹å®‰å…¨ï¼šç”¨reinterpret_castæ˜¾å¼è½¬æ¢åœ°å€ç»“æ„ï¼Œé¿å…éšå¼è½¬æ¢é”™è¯¯ã€‚\n\n\nå¼‚æ­¥æ“ä½œï¼šç»“åˆ Boost.Asio æˆ– C++20 çš„std::netï¼ˆææ¡ˆé˜¶æ®µï¼‰å®ç°éé˜»å¡ I/Oï¼Œé¿å…çº¿ç¨‹é˜»å¡ã€‚\n\n\nè·¨å¹³å°ï¼šå°è£…ç³»ç»Ÿå·®å¼‚ï¼ˆå¦‚ Windows çš„WSASendä¸ Linux çš„sendï¼‰ï¼Œç”¨æ¡ä»¶ç¼–è¯‘æˆ–è·¨å¹³å°åº“ã€‚\n\n\nå››ã€æ€»ç»“\nsocket()/bind()/listen()/accept()/connect()æ˜¯ TCP é€šä¿¡çš„ â€œéª¨æ¶â€ï¼šæœåŠ¡å™¨é€šè¿‡socket()åˆ›å»ºå¥—æ¥å­—â†’bind()ç»‘å®šåœ°å€â†’listen()ç›‘å¬â†’accept()æ¥å—è¿æ¥ï¼›å®¢æˆ·ç«¯é€šè¿‡socket()åˆ›å»ºå¥—æ¥å­—â†’connect()è¿æ¥æœåŠ¡å™¨ã€‚ç†è§£è¿™äº›å‡½æ•°çš„å‚æ•°å’Œäº¤äº’æµç¨‹ï¼Œæ˜¯æŒæ¡ç½‘ç»œç¼–ç¨‹çš„åŸºç¡€ã€‚ç°ä»£ C++ é€šè¿‡å°è£…å’ŒæŠ½è±¡ï¼ˆå¦‚æ™ºèƒ½æŒ‡é’ˆã€å¼‚å¸¸ï¼‰ï¼Œå¯è®©è¿™äº›åº•å±‚æ“ä½œæ›´å®‰å…¨ã€æ˜“ç»´æŠ¤ã€‚\né™„: socket é€‰é¡¹\n\n\n\né€‰é¡¹å\næ•°æ®ç±»å‹\nåŠŸèƒ½æè¿°\nå¯æ“ä½œï¼ˆget/setï¼‰\nå¤‡æ³¨\n\n\n\n\nSOL_SOCKET çº§åˆ«ï¼ˆé€šç”¨é€‰é¡¹ï¼‰\n\n\n\n\n\n\nSO_DEBUG\nint (0 / é 0)\nå¯ç”¨è°ƒè¯•æ¨¡å¼ï¼Œå†…æ ¸è®°å½•å¥—æ¥å­—è°ƒè¯•ä¿¡æ¯\nget/set\nä»…è¶…çº§ç”¨æˆ·å¯è®¾ç½®\n\n\nSO_REUSEADDR\nint (0 / é 0)\nå…è®¸é‡ç”¨æœ¬åœ°åœ°å€å’Œç«¯å£ï¼ˆå¦‚ TIME_WAIT çŠ¶æ€ç«¯å£å¤ç”¨ï¼‰\nget/set\néœ€åœ¨ bind å‰è®¾ç½®ï¼Œè§£å†³ â€œåœ°å€å·²è¢«ä½¿ç”¨â€ é”™è¯¯\n\n\nSO_REUSEPORT\nint (0 / é 0)\nå…è®¸å¤šä¸ªå¥—æ¥å­—ç»‘å®šåˆ°åŒä¸€ç«¯å£ï¼ˆéœ€åŒ UIDï¼Œå†…æ ¸åˆ†å‘æ•°æ®ï¼‰\nget/set\néƒ¨åˆ†ç³»ç»Ÿæ”¯æŒï¼ˆå¦‚ Linux 3.9+ï¼‰ï¼Œå¸¸ç”¨äºå¤šè¿›ç¨‹ç›‘å¬åŒä¸€ç«¯å£\n\n\nSO_KEEPALIVE\nint (0 / é 0)\nå¯ç”¨ TCP ä¿æ´»æœºåˆ¶ï¼Œå®šæœŸæ£€æµ‹å¯¹ç«¯æ˜¯å¦å­˜æ´»\nget/set\nè¶…æ—¶æ—¶é—´ç”±ç³»ç»Ÿé…ç½®ï¼ˆé€šå¸¸ 2 å°æ—¶æ— æ´»åŠ¨åè§¦å‘ï¼‰\n\n\nSO_DONTROUTE\nint (0 / é 0)\nç¦æ­¢è·¯ç”±ï¼Œæ•°æ®ä»…åœ¨æœ¬åœ°å­ç½‘ä¼ è¾“\nget/set\nç”¨äºæœ¬åœ°é€šä¿¡æˆ–è¯Šæ–­\n\n\nSO_BROADCAST\nint (0 / é 0)\nå…è®¸å‘é€å¹¿æ’­æŠ¥æ–‡\nget/set\nä»…é€‚ç”¨äº UDPï¼Œéœ€åœ¨ sendto å‰è®¾ç½®\n\n\nSO_SNDBUF\nint\nè®¾ç½® / è·å–å‘é€ç¼“å†²åŒºå¤§å°ï¼ˆå­—èŠ‚ï¼‰\nget/set\nå†…æ ¸å¯èƒ½è°ƒæ•´å®é™…å¤§å°ï¼ˆä¸è¶…è¿‡ç³»ç»Ÿä¸Šé™ï¼‰\n\n\nSO_RCVBUF\nint\nè®¾ç½® / è·å–æ¥æ”¶ç¼“å†²åŒºå¤§å°ï¼ˆå­—èŠ‚ï¼‰\nget/set\nå½±å“æ¥æ”¶æ€§èƒ½å’Œæ‹¥å¡æ§åˆ¶ï¼Œå»ºè®®åœ¨ connect/bind å‰è®¾ç½®\n\n\nSO_SNDTIMEO\nstruct timeval\nè®¾ç½®å‘é€æ“ä½œï¼ˆsend/sendtoï¼‰çš„è¶…æ—¶æ—¶é—´\nget/set\nè¶…æ—¶åè¿”å› EAGAIN/EWOULDBLOCK\n\n\nSO_RCVTIMEO\nstruct timeval\nè®¾ç½®æ¥æ”¶æ“ä½œï¼ˆrecv/recvfromï¼‰çš„è¶…æ—¶æ—¶é—´\nget/set\nåŒ SO_SNDTIMEO\n\n\nSO_TYPE\nint\nè·å–å¥—æ¥å­—ç±»å‹ï¼ˆå¦‚ SOCK_STREAMã€SOCK_DGRAMï¼‰\ngetï¼ˆä¸å¯ setï¼‰\nç”¨äºåˆ¤æ–­å¥—æ¥å­—æ˜¯ TCP è¿˜æ˜¯ UDP\n\n\nSO_ERROR\nint\nè·å–å¥—æ¥å­—ä¸Šçš„å¾…å¤„ç†é”™è¯¯ï¼ˆå¦‚è¿æ¥å¤±è´¥åŸå› ï¼‰\ngetï¼ˆä¸å¯ setï¼‰\nå¸¸ç”¨äºéé˜»å¡ connect åçš„é”™è¯¯æ£€æŸ¥\n\n\nSO_LINGER\nstruct linger\næ§åˆ¶ close æ—¶çš„å»¶è¿Ÿå…³é—­è¡Œä¸ºï¼ˆç­‰å¾…æœªå‘é€æ•°æ®ï¼‰\nget/set\nstruct linger {int l_onoff; int l_linger;}ï¼Œl_onoff=1 å¯ç”¨ï¼Œl_linger ä¸ºç­‰å¾…ç§’æ•°\n\n\nSO_PASSCRED\nint (0 / é 0)\nå…è®¸æ¥æ”¶è¾…åŠ©æ•°æ®ä¸­çš„å‡­è¯ä¿¡æ¯ï¼ˆå¦‚ UID/GIDï¼‰\nget/set\nç”¨äº Unix åŸŸå¥—æ¥å­—çš„æƒé™éªŒè¯\n\n\nSO_PEERCRED\nstruct ucred\nè·å–å¯¹ç«¯ Unix åŸŸå¥—æ¥å­—çš„ç”¨æˆ·å‡­è¯ï¼ˆUID/GID/PIDï¼‰\ngetï¼ˆä¸å¯ setï¼‰\nä»…é€‚ç”¨äºå·²è¿æ¥çš„ Unix åŸŸå¥—æ¥å­—\n\n\nIPPROTO_IP çº§åˆ«ï¼ˆIPv4 é€‰é¡¹ï¼‰\n\n\n\n\n\n\nIP_HDRINCL\nint (0 / é 0)\nåº”ç”¨ç¨‹åºè‡ªè¡Œæ„é€  IP å¤´éƒ¨ï¼Œä¸ä¾èµ–å†…æ ¸\nget/set\nä»…è¶…çº§ç”¨æˆ·å¯è®¾ç½®ï¼Œç”¨äºè‡ªå®šä¹‰ IP æŠ¥æ–‡\n\n\nIP_OPTIONS\nvoid *\nè®¾ç½® / è·å– IP é€‰é¡¹ï¼ˆå¦‚æºè·¯ç”±ã€è®°å½•è·¯ç”±ï¼‰\nget/set\né€‰é¡¹æ•°æ®éœ€ç¬¦åˆ IP åè®®è§„èŒƒï¼Œé•¿åº¦æœ‰é™åˆ¶\n\n\nIP_TOS\nint\nè®¾ç½® / è·å– IP æœåŠ¡ç±»å‹ï¼ˆTOSï¼‰ï¼Œæ§åˆ¶è·¯ç”±ä¼˜å…ˆçº§\nget/set\nå€¼ä¸º 0~255ï¼Œå…·ä½“å«ä¹‰è§ RFC è§„èŒƒ\n\n\nIP_TTL\nint\nè®¾ç½® / è·å– IP ç”Ÿå­˜æ—¶é—´ï¼ˆTTLï¼‰ï¼Œé™åˆ¶æŠ¥æ–‡è½¬å‘è·³æ•°\nget/set\né€šå¸¸è®¾ä¸º 64ã€128 ç­‰ï¼Œè¶…è¿‡ TTL åˆ™æŠ¥æ–‡è¢«ä¸¢å¼ƒ\n\n\nIP_MULTICAST_TTL\nu_char\nè®¾ç½®å¤šæ’­æŠ¥æ–‡çš„ TTL å€¼\nget/set\næ§åˆ¶å¤šæ’­èŒƒå›´ï¼ˆ0 = æœ¬åœ°ï¼Œ1 = åŒä¸€å­ç½‘ï¼Œâ€¦ï¼Œ255 = å…¨å±€ï¼‰\n\n\nIP_MULTICAST_LOOP\nu_char (0/1)\nå¯ç”¨å¤šæ’­æŠ¥æ–‡å›ç¯ï¼ˆæœ¬åœ°å‘é€çš„å¤šæ’­è‡ªå·±èƒ½å¦æ¥æ”¶ï¼‰\nget/set\né»˜è®¤ 1ï¼ˆå¯ç”¨ï¼‰ï¼Œå¤šæ’­åº”ç”¨éœ€æ ¹æ®éœ€æ±‚å…³é—­\n\n\nIP_ADD_MEMBERSHIP\nstruct ip_mreq\nåŠ å…¥å¤šæ’­ç»„\nsetï¼ˆä¸å¯ getï¼‰\nstruct ip_mreq åŒ…å«å¤šæ’­ç»„ IP å’Œæœ¬åœ°æ¥å£ IP\n\n\nIP_DROP_MEMBERSHIP\nstruct ip_mreq\né€€å‡ºå¤šæ’­ç»„\nsetï¼ˆä¸å¯ getï¼‰\nåŒ IP_ADD_MEMBERSHIP\n\n\nIPPROTO_TCP çº§åˆ«ï¼ˆTCP é€‰é¡¹ï¼‰\n\n\n\n\n\n\nTCP_NODELAY\nint (0 / é 0)\nç¦ç”¨ Nagle ç®—æ³•ï¼ˆç«‹å³å‘é€å°æ•°æ®åŒ…ï¼Œä¸å»¶è¿Ÿåˆå¹¶ï¼‰\nget/set\né€‚ç”¨äºä½å»¶è¿Ÿåœºæ™¯ï¼ˆå¦‚å®æ—¶é€šä¿¡ï¼‰ï¼Œå¯èƒ½å¢åŠ ç½‘ç»œæ‹¥å¡\n\n\nTCP_MAXSEG\nint\nè®¾ç½® / è·å– TCP æœ€å¤§æ®µå¤§å°ï¼ˆMSSï¼‰\nget/set\né€šå¸¸ç”±å†…æ ¸åå•†ï¼Œæ‰‹åŠ¨è®¾ç½®éœ€è°¨æ…\n\n\nTCP_CORK\nint (0 / é 0)\nå¯ç”¨ â€œå¡å­â€ æ¨¡å¼ï¼Œç´¯ç§¯æ•°æ®åä¸€æ¬¡æ€§å‘é€ï¼ˆç±»ä¼¼ Nagle ä½†æ›´æ¿€è¿›ï¼‰\nget/set\né€‚ç”¨äºæ‰¹é‡æ•°æ®å‘é€ï¼Œéœ€åœ¨å®Œæˆåå…³é—­ï¼ˆé¿å…å»¶è¿Ÿï¼‰\n\n\nTCP_KEEPIDLE\nint\nè®¾ç½® TCP ä¿æ´»æ¢æµ‹çš„ç©ºé—²æ—¶é—´ï¼ˆç§’ï¼‰\nget/set\néœ€ SO_KEEPALIVE å¯ç”¨ï¼Œé»˜è®¤ 7200 ç§’ï¼ˆ2 å°æ—¶ï¼‰\n\n\nTCP_KEEPINTVL\nint\nè®¾ç½® TCP ä¿æ´»æ¢æµ‹çš„é—´éš”æ—¶é—´ï¼ˆç§’ï¼‰\nget/set\næ¢æµ‹æœªå“åº”æ—¶ï¼Œé—´éš”å¤šä¹…å†æ¬¡å‘é€ï¼Œé»˜è®¤ 75 ç§’\n\n\nTCP_KEEPCNT\nint\nè®¾ç½® TCP ä¿æ´»æ¢æµ‹çš„æœ€å¤§é‡è¯•æ¬¡æ•°\nget/set\nè¶…è¿‡æ¬¡æ•°åˆ™åˆ¤å®šå¯¹ç«¯ä¸å¯è¾¾ï¼Œé»˜è®¤ 9 æ¬¡\n\n\n\nè¯´æ˜\n\n\né€‰é¡¹çº§åˆ«è¯´æ˜ï¼šSOL_SOCKETä¸ºé€šç”¨é€‰é¡¹ï¼ŒIPPROTO_IPä¸º IPv4 åè®®é€‰é¡¹ï¼ŒIPPROTO_TCPä¸º TCP åè®®é€‰é¡¹ï¼Œè¿˜æœ‰IPPROTO_UDPï¼ˆUDP é€‰é¡¹ï¼Œè¾ƒå°‘ç”¨ï¼‰ç­‰ã€‚\n\n\néƒ¨åˆ†é€‰é¡¹ä¸ºç³»ç»Ÿç‰¹å®šï¼ˆå¦‚SO_REUSEPORTåœ¨ä¸åŒ OS ä¸Šè¡Œä¸ºå¯èƒ½ä¸åŒï¼‰ï¼Œä½¿ç”¨å‰éœ€å‚è€ƒç›®æ ‡ç³»ç»Ÿçš„manæ‰‹å†Œã€‚\n\n\nå¤šæ’­ç›¸å…³é€‰é¡¹ï¼ˆå¦‚IP_ADD_MEMBERSHIPï¼‰éœ€ç»“åˆå¤šæ’­åœ°å€ï¼ˆ224.0.0.0~239.255.255.255ï¼‰ä½¿ç”¨ã€‚\n\n\n","categories":["ç¼–ç¨‹"],"tags":["C++","Linux","ç½‘ç»œ"]},{"title":"fcntlå‡½æ•°","url":"/2025/08/18/linux/fcntl%E5%87%BD%E6%95%B0/","content":"ä½¿ç”¨åœºæ™¯å’Œç›¸å…³ç”¨æ³•\n \nfcntlå‡½æ•°\nä¸€ã€fcntl å‡½æ•°åŸºç¡€\n#include &lt;fcntl.h&gt;int fcntl(int fd, int cmd, ... /* å¯é€‰å‚æ•° arg */ );\n\n\nè¿”å›å€¼ï¼šæˆåŠŸæ—¶è¿”å›ä¸ cmd ç›¸å…³çš„å€¼ï¼ˆå¦‚æ ‡å¿—ã€æ–‡ä»¶æè¿°ç¬¦ï¼‰ï¼Œå¤±è´¥è¿”å› -1 å¹¶è®¾ç½® errnoã€‚\n\n\næ ¸å¿ƒä½œç”¨ï¼šé€šè¿‡ cmd å‘½ä»¤å¯¹ fdï¼ˆæ–‡ä»¶æè¿°ç¬¦ï¼‰æ‰§è¡Œæ§åˆ¶æ“ä½œï¼Œæ¶µç›–æ–‡ä»¶çŠ¶æ€ã€I/O æ¨¡å¼ã€é”æœºåˆ¶ç­‰ã€‚\n\n\näºŒã€ä¸ O_NONBLOCK ç›¸å…³çš„æ“ä½œï¼ˆæ–‡ä»¶çŠ¶æ€æ ‡å¿—ï¼‰\nO_NONBLOCK æ˜¯ éé˜»å¡æ¨¡å¼æ ‡å¿—ï¼Œç”¨äºè®¾ç½®æ–‡ä»¶æè¿°ç¬¦çš„ I/O è¡Œä¸ºï¼š\n\n\né˜»å¡æ¨¡å¼ï¼ˆé»˜è®¤ï¼‰ï¼šå½“æ‰§è¡Œ read/write ç­‰æ“ä½œæ—¶ï¼Œè‹¥æš‚æ—¶æ— æ³•å®Œæˆï¼ˆå¦‚æ— æ•°æ®å¯è¯»ã€ç¼“å†²åŒºæ»¡ï¼‰ï¼Œè¿›ç¨‹ä¼šè¿›å…¥ç¡çœ ç­‰å¾…ã€‚\n\n\néé˜»å¡æ¨¡å¼ï¼ˆO_NONBLOCKï¼‰ï¼šæ“ä½œæ— æ³•ç«‹å³å®Œæˆæ—¶ï¼Œå‡½æ•°ä¼šç«‹å³è¿”å› -1 å¹¶è®¾ç½® errno ä¸º EAGAIN æˆ– EWOULDBLOCKï¼Œä¸é˜»å¡è¿›ç¨‹ã€‚\n\n\nç›¸å…³ cmd å‘½ä»¤ï¼š\n\n\nF_GETFLï¼šè·å–å½“å‰æ–‡ä»¶çŠ¶æ€æ ‡å¿—ï¼ˆåŒ…å«æ˜¯å¦è®¾ç½® O_NONBLOCKï¼‰\nint flags = fcntl(fd, F_GETFL, 0);  // 0 è¡¨ç¤ºæ— é¢å¤–å‚æ•°if (flags == -1) &#123;    perror(&quot;fcntl F_GETFL failed&quot;);&#125;\n\n\nF_SETFLï¼šè®¾ç½®æ–‡ä»¶çŠ¶æ€æ ‡å¿—ï¼ˆç”¨äºå¼€å¯ / å…³é—­ O_NONBLOCKï¼‰\n// å¼€å¯éé˜»å¡æ¨¡å¼ï¼ˆä¿ç•™åŸæœ‰æ ‡å¿—ï¼Œæ·»åŠ  O_NONBLOCKï¼‰int new_flags = flags | O_NONBLOCK;if (fcntl(fd, F_SETFL, new_flags) == -1) &#123;    perror(&quot;fcntl F_SETFL failed&quot;);&#125;// å…³é—­éé˜»å¡æ¨¡å¼ï¼ˆæ¸…é™¤ O_NONBLOCK æ ‡å¿—ï¼‰new_flags = flags &amp; ~O_NONBLOCK;fcntl(fd, F_SETFL, new_flags);\n\n\né€‚ç”¨åœºæ™¯ï¼š\n\n\nç½‘ç»œå¥—æ¥å­—ï¼ˆsocketï¼‰ï¼šé¿å… recv/send é˜»å¡å¯¼è‡´è¿›ç¨‹å¡æ­»ã€‚\n\n\nç®¡é“ï¼ˆpipeï¼‰ã€FIFOï¼šå¤„ç†è¯»å†™ç«¯ä¸åŒæ­¥çš„æƒ…å†µã€‚\n\n\nè®¾å¤‡æ–‡ä»¶ï¼ˆå¦‚ç»ˆç«¯ã€ä¸²å£ï¼‰ï¼šå®æ—¶å“åº” I/O çŠ¶æ€å˜åŒ–ã€‚\n\n\nä¸‰ã€æ–‡ä»¶é”æ“ä½œï¼ˆè¿›ç¨‹é—´åŒæ­¥ï¼‰\nfcntl æ”¯æŒå¯¹æ–‡ä»¶çš„éƒ¨åˆ†æˆ–å…¨éƒ¨å†…å®¹åŠ é”ï¼Œé¿å…å¤šè¿›ç¨‹ç«äº‰ã€‚ç›¸å…³ cmd å‘½ä»¤éœ€é…åˆ struct flock ç»“æ„ä½“ä½¿ç”¨ï¼š\nstruct flock &#123;    short l_type;   // é”ç±»å‹ï¼šF_RDLCKï¼ˆè¯»é”ï¼‰ã€F_WRLCKï¼ˆå†™é”ï¼‰ã€F_UNLCKï¼ˆè§£é”ï¼‰    short l_whence; // åç§»åŸºå‡†ï¼šSEEK_SETï¼ˆæ–‡ä»¶å¤´ï¼‰ã€SEEK_CURï¼ˆå½“å‰ä½ç½®ï¼‰ã€SEEK_ENDï¼ˆæ–‡ä»¶å°¾ï¼‰    off_t l_start;  // é”çš„èµ·å§‹åç§»é‡    off_t l_len;    // é”çš„é•¿åº¦ï¼ˆ0 è¡¨ç¤ºè‡³æ–‡ä»¶æœ«å°¾ï¼‰    pid_t l_pid;    // æŒæœ‰é”çš„è¿›ç¨‹ IDï¼ˆä»… F_GETLK æ—¶æœ‰æ•ˆï¼‰&#125;;\n\n\nF_GETLKï¼šæ£€æŸ¥é”å†²çªï¼ˆè·å–å½“å‰é˜»å¡å½“å‰é”è¯·æ±‚çš„é”ä¿¡æ¯ï¼‰\nstruct flock lock;lock.l_type = F_WRLCK;  // å°è¯•è·å–å†™é”lock.l_whence = SEEK_SET;lock.l_start = 0;lock.l_len = 0;         // é”æ•´ä¸ªæ–‡ä»¶if (fcntl(fd, F_GETLK, &amp;lock) == -1) &#123;    perror(&quot;fcntl F_GETLK failed&quot;);&#125;if (lock.l_type != F_UNLCK) &#123;    // å­˜åœ¨å†²çªçš„é”ï¼Œlock.l_pid ä¸ºæŒæœ‰é”çš„è¿›ç¨‹&#125;\n\n\nF_SETLKï¼šè®¾ç½®æˆ–é‡Šæ”¾é”ï¼ˆéé˜»å¡æ¨¡å¼ï¼Œå¤±è´¥ç«‹å³è¿”å›ï¼‰\n// åŠ å†™é”lock.l_type = F_WRLCK;if (fcntl(fd, F_SETLK, &amp;lock) == -1) &#123;    if (errno == EAGAIN || errno == EACCES) &#123;        // é”è¢«å ç”¨ï¼Œæ— æ³•è·å–    &#125;&#125;// è§£é”lock.l_type = F_UNLCK;fcntl(fd, F_SETLK, &amp;lock);\n\n\nF_SETLKWï¼šè®¾ç½®æˆ–é‡Šæ”¾é”ï¼ˆé˜»å¡æ¨¡å¼ï¼Œè‹¥æ— æ³•è·å–åˆ™ç­‰å¾…ï¼‰\n// ç­‰å¾…è·å–é”ï¼Œç›´åˆ°æˆåŠŸæˆ–è¢«ä¿¡å·ä¸­æ–­if (fcntl(fd, F_SETLKW, &amp;lock) == -1) &#123;    perror(&quot;fcntl F_SETLKW failed&quot;);&#125;\n\n\nå››ã€æ–‡ä»¶æè¿°ç¬¦ç®¡ç†\n\n\nF_DUPFDï¼šå¤åˆ¶æ–‡ä»¶æè¿°ç¬¦ï¼ˆç±»ä¼¼ dupï¼‰\n// ç”Ÿæˆä¸€ä¸ª &gt;= min_fd çš„æ–°æè¿°ç¬¦ï¼Œä¸åŸ fd æŒ‡å‘åŒä¸€æ–‡ä»¶int new_fd = fcntl(old_fd, F_DUPFD, min_fd);\n\n\nF_DUPFD_CLOEXECï¼šå¤åˆ¶æè¿°ç¬¦å¹¶è®¾ç½® FD_CLOEXEC æ ‡å¿—\n// æ–°æè¿°ç¬¦åœ¨è¿›ç¨‹æ‰§è¡Œ exec æ—¶è‡ªåŠ¨å…³é—­ï¼Œé¿å…èµ„æºæ³„æ¼int new_fd = fcntl(old_fd, F_DUPFD_CLOEXEC, min_fd);\n\n\nF_GETFD/F_SETFDï¼šè·å– / è®¾ç½®æ–‡ä»¶æè¿°ç¬¦æ ‡å¿—ï¼ˆä»… FD_CLOEXEC æœ‰æ•ˆï¼‰\n// è·å–æ ‡å¿—int fd_flags = fcntl(fd, F_GETFD);// è®¾ç½® FD_CLOEXECï¼ˆexec æ—¶å…³é—­ï¼‰fcntl(fd, F_SETFD, fd_flags | FD_CLOEXEC);\n\n\näº”ã€å¼‚æ­¥ I/O ä¸ä¿¡å·é€šçŸ¥\n\n\nF_SETOWNï¼šè®¾ç½®æ¥æ”¶ SIGIO å’Œ SIGURG ä¿¡å·çš„è¿›ç¨‹ / è¿›ç¨‹ç»„\n// æŒ‡å®šè¿›ç¨‹ ID æ¥æ”¶ä¿¡å·ï¼ˆè´Ÿæ•°è¡¨ç¤ºè¿›ç¨‹ç»„ IDï¼‰fcntl(fd, F_SETOWN, pid);\n\n\nF_GETOWNï¼šè·å–å½“å‰æ¥æ”¶ä¿¡å·çš„è¿›ç¨‹ / è¿›ç¨‹ç»„ ID\npid_t owner = fcntl(fd, F_GETOWN);\n\n\nF_SETFL é…åˆ O_ASYNCï¼šå¼€å¯å¼‚æ­¥ I/O é€šçŸ¥ï¼ˆæ•°æ®å¯è¯» / å¯å†™æ—¶è§¦å‘ SIGIOï¼‰\nint flags = fcntl(fd, F_GETFL);fcntl(fd, F_SETFL, flags | O_ASYNC | O_NONBLOCK);  // åŒæ—¶å¼€å¯å¼‚æ­¥å’Œéé˜»å¡\n\n\nå…­ã€å…¶ä»–ç³»ç»Ÿç›¸å…³å‘½ä»¤\n\n\nF_GETPIPE_SZ/F_SETPIPE_SZï¼šè·å– / è®¾ç½®ç®¡é“ï¼ˆpipeï¼‰çš„ç¼“å†²åŒºå¤§å°\nint pipe_size = fcntl(fd, F_GETPIPE_SZ);  // è·å–å¤§å°fcntl(fd, F_SETPIPE_SZ, new_size);        // è®¾ç½®å¤§å°ï¼ˆéœ€æƒé™ï¼‰\n\n\nF_ADD_SEALS/F_GET_SEALSï¼šä¸ºæ–‡ä»¶æ·»åŠ  / æŸ¥è¯¢ â€œå¯†å°â€ æ ‡å¿—ï¼ˆé™åˆ¶ä¿®æ”¹ï¼‰\n// æ·»åŠ å†™å¯†å°ï¼ˆç¦æ­¢åç»­å†™å…¥ï¼‰fcntl(fd, F_ADD_SEALS, F_SEAL_WRITE);// æŸ¥è¯¢å½“å‰å¯†å°æ ‡å¿—int seals = fcntl(fd, F_GET_SEALS);\n\n\nF_GETLEASE/F_SETLEASEï¼šè·å– / è®¾ç½®æ–‡ä»¶ç§Ÿçº¦ï¼ˆåè°ƒè¿›ç¨‹é—´æ–‡ä»¶è®¿é—®ï¼‰\n// è®¾ç½®è¯»ç§Ÿçº¦ï¼ˆå…¶ä»–è¿›ç¨‹å†™æ“ä½œä¼šè§¦å‘é€šçŸ¥ï¼‰fcntl(fd, F_SETLEASE, F_RDLEASE);\n\n\nfcntl æ˜¯ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§çš„å¤šç”¨é€”å‡½æ•°ï¼Œæ ¸å¿ƒèƒ½åŠ›åŒ…æ‹¬ï¼š\n\n\næ§åˆ¶ I/O æ¨¡å¼ï¼ˆå¦‚ O_NONBLOCK éé˜»å¡ï¼‰ï¼›\n\n\nè¿›ç¨‹é—´æ–‡ä»¶é”ï¼ˆè¯»é”ã€å†™é”ï¼‰ï¼›\n\n\næ–‡ä»¶æè¿°ç¬¦ç®¡ç†ï¼ˆå¤åˆ¶ã€æ ‡å¿—è®¾ç½®ï¼‰ï¼›\n\n\nå¼‚æ­¥ I/O ä¿¡å·é€šçŸ¥ï¼›\n\n\nç³»ç»Ÿç‰¹å®šæ‰©å±•åŠŸèƒ½ï¼ˆç®¡é“å¤§å°ã€æ–‡ä»¶å¯†å°ç­‰ï¼‰ã€‚\n\n\nä½¿ç”¨æ—¶éœ€æ³¨æ„ï¼šä¸åŒ Unix/Linux ç³»ç»Ÿå¯¹å‘½ä»¤çš„æ”¯æŒå¯èƒ½æœ‰å·®å¼‚ï¼Œå»ºè®®é€šè¿‡ man 2 fcntl æŸ¥çœ‹æœ¬åœ°ç³»ç»Ÿçš„è¯¦ç»†æ–‡æ¡£ã€‚éé˜»å¡æ¨¡å¼ï¼ˆO_NONBLOCKï¼‰å¸¸ä¸ I/O å¤šè·¯å¤ç”¨ï¼ˆselect/poll/epollï¼‰ç»“åˆï¼Œæ˜¯é«˜æ€§èƒ½ç½‘ç»œç¼–ç¨‹çš„åŸºç¡€ã€‚\n","categories":["ç¼–ç¨‹"],"tags":["C++","Linux"]},{"title":"Vimçš„ç›¸å…³ç”¨æ³•","url":"/2025/05/15/linux/Vim%E7%9B%B8%E5%85%B3%E5%91%BD%E4%BB%A4/","content":"\nvimçš„ç”¨æ³•\n\n \nä¸€ã€Vim åŸºç¡€è®¤çŸ¥ä¸æ ¸å¿ƒæ¨¡å¼\n1. Vim ç®€ä»‹ä¸å­¦ä¹ èµ„æº\n\n\nå®šä½ï¼šLinux ç³»ç»Ÿä¸Šçš„é«˜æ•ˆæ–‡æœ¬ç¼–è¾‘å™¨ï¼Œæ”¯æŒå¤šæ¨¡å¼æ“ä½œï¼Œä¸”å¤šæ•°ä¸»æµ IDE å¯å®‰è£… Vim æ’ä»¶å®ç°å…¼å®¹ã€‚\n\n\næƒå¨å­¦ä¹ èµ„æ–™ï¼šVim å†…ç½®å¸®åŠ©æ–‡æ¡£ï¼Œå¯åŠ¨ Vim åè¾“å…¥:helpå³å¯æŸ¥çœ‹ï¼ˆè‹±æ–‡ï¼‰ï¼›ä¹Ÿå¯é€šè¿‡ç§‘å­¦ä¸Šç½‘è·å–æ›´å¤šæ¼”å˜å†å²ä¸å­¦ä¹ èµ„æºã€‚\n\n\næ ¸å¿ƒé…ç½®æ–‡ä»¶ï¼šLinux ç³»ç»Ÿä¸­ä¸º~/.vimrcï¼ˆå®¶ç›®å½•ä¸‹çš„éšè—æ–‡ä»¶ï¼Œä¸å­˜åœ¨å¯æ‰‹åŠ¨åˆ›å»ºï¼‰ï¼Œå¯é…ç½®æ˜¾ç¤ºè¡Œå·ã€å¿«æ·é”®æ˜ å°„ã€æ’ä»¶ç­‰ï¼Œä¾‹å¦‚å°†ESCé”®æ˜ å°„ä¸ºè¿ç»­ä¸¤æ¬¡jé”®ï¼šinoremap jj &lt;Esc&gt;ã€‚\n\n\n2. Vim å››å¤§æ ¸å¿ƒæ¨¡å¼\n\n\n\næ¨¡å¼åç§°\nè¿›å…¥æ–¹å¼\næ ¸å¿ƒåŠŸèƒ½\né€€å‡ºæ–¹å¼\n\n\n\n\næ­£å¸¸æ¨¡å¼\nVim å¯åŠ¨é»˜è®¤è¿›å…¥ï¼›å…¶ä»–æ¨¡å¼æŒ‰ESCï¼ˆæˆ–jjï¼‰\næµè§ˆæ–‡ä»¶ã€å…‰æ ‡ç§»åŠ¨ã€å¤åˆ¶ / ç²˜è´´ / åˆ é™¤ç­‰æ“ä½œ\næŒ‰i/I/a/A/o/Oç­‰è¿›å…¥æ’å…¥æ¨¡å¼ï¼›æŒ‰:æˆ–/è¿›å…¥å‘½ä»¤æ¨¡å¼\n\n\næ’å…¥æ¨¡å¼\næ­£å¸¸æ¨¡å¼ä¸‹æŒ‰i/I/a/A/o/O/s/S\nè¾“å…¥ã€ç¼–è¾‘æ–‡æœ¬\næŒ‰ESCè¿”å›æ­£å¸¸æ¨¡å¼\n\n\nå‘½ä»¤æ¨¡å¼\næ­£å¸¸æ¨¡å¼ä¸‹æŒ‰:ï¼ˆå†’å·ï¼‰æˆ–/ï¼ˆæ–œæ ï¼‰\næ‰§è¡Œæ–‡ä»¶æ“ä½œã€ç¯å¢ƒè®¾ç½®ã€æŸ¥æ‰¾æ›¿æ¢ç­‰æŒ‡ä»¤\næ‰§è¡ŒæŒ‡ä»¤åè‡ªåŠ¨è¿”å›æ­£å¸¸æ¨¡å¼ï¼›æœªæ‰§è¡ŒæŒ‡ä»¤æŒ‰ESCè¿”å›\n\n\nå¯è§†æ¨¡å¼\næ­£å¸¸æ¨¡å¼ä¸‹æŒ‰vï¼ˆå­—ç¬¦å¯è§†ï¼‰ã€Vï¼ˆè¡Œå¯è§†ï¼‰ã€Ctrl+vï¼ˆå—çŠ¶å¯è§†ï¼‰\né€‰ä¸­æ–‡æœ¬ï¼ˆç±»ä¼¼é¼ æ ‡é€‰æ‹©ï¼‰ï¼Œä¾¿äºæ‰¹é‡æ“ä½œ\næŒ‰ESCï¼ˆæˆ–jjï¼‰è¿”å›æ­£å¸¸æ¨¡å¼ï¼›å†æ¬¡æŒ‰å¯¹åº”æ¨¡å¼é”®é€€å‡º\n\n\n\näºŒã€Vim æ–‡ä»¶æ“ä½œï¼šæ‰“å¼€ã€åˆ‡æ¢ä¸åˆ†å±\n1. æ‰“å¼€æ–‡ä»¶\n\n\næ‰“å¼€å•ä¸ªæ–‡ä»¶ï¼šç»ˆç«¯è¾“å…¥vim æ–‡ä»¶åï¼Œç¤ºä¾‹ï¼švim file1ï¼ˆæ‰“å¼€åä¸ºfile1çš„æ–‡ä»¶ï¼‰ã€‚\n\n\næ‰“å¼€å¤šä¸ªæ–‡ä»¶ï¼šç»ˆç«¯è¾“å…¥vim æ–‡ä»¶å1 æ–‡ä»¶å2 ...ï¼Œç¤ºä¾‹ï¼švim file1 file2ï¼ˆæ‰“å¼€file1å’Œfile2ï¼Œé»˜è®¤æ˜¾ç¤ºç¬¬ä¸€ä¸ªæ–‡ä»¶ï¼‰ã€‚\n\n\n2. å¤šæ–‡ä»¶åˆ‡æ¢ä¸ç®¡ç†\n\n\næŸ¥çœ‹å·²æ‰“å¼€æ–‡ä»¶åˆ—è¡¨ï¼šæ­£å¸¸æ¨¡å¼ä¸‹æŒ‰:è¿›å…¥å‘½ä»¤æ¨¡å¼ï¼Œè¾“å…¥:lsï¼Œä¼šæ˜¾ç¤ºæ‰€æœ‰æ‰“å¼€æ–‡ä»¶çš„åºå·ä¸æ–‡ä»¶åã€‚\n\n\nåˆ‡æ¢æ–‡ä»¶ï¼šå‘½ä»¤æ¨¡å¼ä¸‹è¾“å…¥:båºå·ï¼ˆbå³bufferï¼‰ï¼Œç¤ºä¾‹ï¼š:b2ï¼ˆåˆ‡æ¢åˆ°åºå·ä¸º 2 çš„æ–‡ä»¶ï¼‰ï¼›ä¹Ÿå¯è¾“å…¥:bnï¼ˆåˆ‡æ¢åˆ°ä¸‹ä¸€ä¸ªæ–‡ä»¶ï¼‰ã€:bpï¼ˆåˆ‡æ¢åˆ°ä¸Šä¸€ä¸ªæ–‡ä»¶ï¼‰ã€‚\n\n\n3. åˆ†å±æ“ä½œ\nï¼ˆ1ï¼‰ç»ˆç«¯å¯åŠ¨æ—¶ç›´æ¥åˆ†å±\n\n\nå·¦å³åˆ†å±ï¼šç»ˆç«¯è¾“å…¥vim -On æ–‡ä»¶å1 æ–‡ä»¶å2 ...ï¼ˆOä¸ºå¤§å†™ï¼Œnä¸ºæ–‡ä»¶æ•°é‡ï¼‰ï¼Œç¤ºä¾‹ï¼švim -O2 file1 file2ï¼ˆå·¦å³åˆ†å±æ˜¾ç¤ºfile1å’Œfile2ï¼‰ã€‚\n\n\nä¸Šä¸‹åˆ†å±ï¼šç»ˆç«¯è¾“å…¥vim -on æ–‡ä»¶å1 æ–‡ä»¶å2 ...ï¼ˆoä¸ºå°å†™ï¼Œnä¸ºæ–‡ä»¶æ•°é‡ï¼‰ï¼Œç¤ºä¾‹ï¼švim -o2 file1 file2ï¼ˆä¸Šä¸‹åˆ†å±æ˜¾ç¤ºfile1å’Œfile2ï¼‰ã€‚\n\n\nï¼ˆ2ï¼‰Vim å†…éƒ¨åˆ†å±\n\n\n\nåˆ†å±ç±»å‹\næ“ä½œå‘½ä»¤\nç¤ºä¾‹\n\n\n\n\nä¸Šä¸‹åˆ†å‰²å½“å‰æ–‡ä»¶\næ­£å¸¸æ¨¡å¼ä¸‹æŒ‰Ctrl + w s\næŒ‰Ctrl + wåæ¾å¼€ï¼Œå†æŒ‰sï¼Œå½“å‰æ–‡ä»¶ä¸Šä¸‹åˆ†å±\n\n\nä¸Šä¸‹åˆ†å‰²å¹¶æ‰“å¼€æ–°æ–‡ä»¶\nå‘½ä»¤æ¨¡å¼è¾“å…¥:sp æ–‡ä»¶å\n:sp file3ï¼ˆå½“å‰æ–‡ä»¶ä¸file3ä¸Šä¸‹åˆ†å±ï¼‰\n\n\nå·¦å³åˆ†å‰²å½“å‰æ–‡ä»¶\næ­£å¸¸æ¨¡å¼ä¸‹æŒ‰Ctrl + w v\næŒ‰Ctrl + wåæ¾å¼€ï¼Œå†æŒ‰vï¼Œå½“å‰æ–‡ä»¶å·¦å³åˆ†å±\n\n\nå·¦å³åˆ†å‰²å¹¶æ‰“å¼€æ–°æ–‡ä»¶\nå‘½ä»¤æ¨¡å¼è¾“å…¥:vsp æ–‡ä»¶å\n:vsp file3ï¼ˆå½“å‰æ–‡ä»¶ä¸file3å·¦å³åˆ†å±ï¼‰\n\n\n\nï¼ˆ3ï¼‰åˆ†å±åˆ‡æ¢ä¸å…³é—­\n\n\nå…‰æ ‡åˆ‡æ¢ï¼šæ­£å¸¸æ¨¡å¼ä¸‹æŒ‰Ctrl + wåï¼ŒæŒ‰hï¼ˆå·¦å±ï¼‰ã€lï¼ˆå³å±ï¼‰ã€jï¼ˆä¸‹å±ï¼‰ã€kï¼ˆä¸Šå±ï¼‰ï¼Œç¤ºä¾‹ï¼šCtrl + w hï¼ˆå…‰æ ‡ç§»åˆ°å·¦ä¾§åˆ†å±ï¼‰ã€‚\n\n\nåˆ†å±ç§»åŠ¨ï¼šæ­£å¸¸æ¨¡å¼ä¸‹æŒ‰Ctrl + wåï¼ŒæŒ‰Hï¼ˆå½“å‰åˆ†å±ç§»åˆ°æœ€å·¦ï¼‰ã€Lï¼ˆå½“å‰åˆ†å±ç§»åˆ°æœ€å³ï¼‰ã€Jï¼ˆå½“å‰åˆ†å±ç§»åˆ°æœ€ä¸‹ï¼‰ã€Kï¼ˆå½“å‰åˆ†å±ç§»åˆ°æœ€ä¸Šï¼‰ï¼Œç¤ºä¾‹ï¼šCtrl + w Hï¼ˆå½“å‰åˆ†å±ç§»åˆ°å·¦ä¾§ï¼‰ã€‚\n\n\nå…³é—­åˆ†å±ï¼šæ­£å¸¸æ¨¡å¼ä¸‹æŒ‰Ctrl + w cï¼ˆå…³é—­å½“å‰åˆ†å±ï¼‰ï¼›æŒ‰Ctrl + w qï¼ˆå…³é—­å½“å‰åˆ†å±ï¼Œè‹¥ä¸ºæœ€åä¸€ä¸ªåˆ†å±åˆ™é€€å‡º Vimï¼‰ã€‚\n\n\nä¸‰ã€Vim é€€å‡ºä¸æ–‡ä»¶ä¿å­˜å‘½ä»¤\n\n\n\nå‘½ä»¤\nåŠŸèƒ½æè¿°\n\n\n\n\n:w\nä¿å­˜å½“å‰æ–‡ä»¶ä¿®æ”¹ï¼Œä¸é€€å‡º\n\n\n:w!\nå¼ºåˆ¶ä¿å­˜å½“å‰æ–‡ä»¶ä¿®æ”¹ï¼Œä¸é€€å‡ºï¼ˆé€‚ç”¨äºåªè¯»æ–‡ä»¶ç­‰åœºæ™¯ï¼‰\n\n\n:w æ–‡ä»¶å\nå°†å½“å‰æ–‡ä»¶ä¿®æ”¹ä¿å­˜ä¸ºæ–°æ–‡ä»¶ï¼ˆå¦å­˜ä¸ºï¼‰\n\n\n:q\né€€å‡º Vimï¼Œä»…é€‚ç”¨äºæœªä¿®æ”¹çš„æ–‡ä»¶\n\n\n:q!\nå¼ºåˆ¶é€€å‡º Vimï¼Œä¸ä¿å­˜ä»»ä½•ä¿®æ”¹\n\n\n:qa!\nå¼ºåˆ¶é€€å‡ºæ‰€æœ‰æ‰“å¼€çš„æ–‡ä»¶ï¼Œä¸ä¿å­˜ä»»ä½•ä¿®æ”¹\n\n\n:wq\nä¿å­˜å½“å‰æ–‡ä»¶ä¿®æ”¹å¹¶é€€å‡º Vim\n\n\n:x\nä¿å­˜å½“å‰æ–‡ä»¶ä¿®æ”¹å¹¶é€€å‡º Vimï¼ˆä¸:wqåŠŸèƒ½ç±»ä¼¼ï¼Œä»…æ–‡ä»¶æœ‰ä¿®æ”¹æ—¶æ‰ä¿å­˜ï¼‰\n\n\n:e æ–‡ä»¶å\nåœ¨å½“å‰ Vim çª—å£æ‰“å¼€æ–°æ–‡ä»¶\n\n\n:e!\næ”¾å¼ƒå½“å‰æ–‡ä»¶æ‰€æœ‰ä¿®æ”¹ï¼Œæ¢å¤åˆ°ä¸Šæ¬¡ä¿å­˜çŠ¶æ€\n\n\n:saveas æ–‡ä»¶å\nå°†å½“å‰æ–‡ä»¶å¦å­˜ä¸ºæŒ‡å®šæ–‡ä»¶åï¼Œä¿ç•™åŸæ–‡ä»¶\n\n\nZZ\næ­£å¸¸æ¨¡å¼ä¸‹è¿ç»­æŒ‰ä¸¤æ¬¡å¤§å†™Zï¼Œä¿å­˜ä¿®æ”¹å¹¶é€€å‡ºï¼ˆå¿«æ·æ“ä½œï¼‰\n\n\n\nå››ã€Vim æ’å…¥æ¨¡å¼ï¼šæ–‡æœ¬ç¼–è¾‘ä¸å¿«æ·è¿›å…¥\n1. ä»æ­£å¸¸æ¨¡å¼è¿›å…¥æ’å…¥æ¨¡å¼çš„å‘½ä»¤\n\n\n\nå‘½ä»¤\nåŠŸèƒ½æè¿°\n\n\n\n\ni\nåœ¨å…‰æ ‡æ‰€åœ¨å­—ç¬¦å‰æ’å…¥æ–‡æœ¬\n\n\nI\nåœ¨å…‰æ ‡æ‰€åœ¨è¡Œçš„è¡Œé¦–æ’å…¥æ–‡æœ¬\n\n\na\nåœ¨å…‰æ ‡æ‰€åœ¨å­—ç¬¦åæ’å…¥æ–‡æœ¬\n\n\nA\nåœ¨å…‰æ ‡æ‰€åœ¨è¡Œçš„è¡Œå°¾æ’å…¥æ–‡æœ¬\n\n\no\nåœ¨å…‰æ ‡æ‰€åœ¨è¡Œä¸‹æ–¹æ–°å»ºä¸€è¡Œï¼Œåœ¨è¡Œé¦–æ’å…¥æ–‡æœ¬\n\n\nO\nåœ¨å…‰æ ‡æ‰€åœ¨è¡Œä¸Šæ–¹æ–°å»ºä¸€è¡Œï¼Œåœ¨è¡Œé¦–æ’å…¥æ–‡æœ¬\n\n\ns\nåˆ é™¤å…‰æ ‡æ‰€åœ¨å­—ç¬¦ï¼Œç„¶åæ’å…¥æ–‡æœ¬\n\n\nS\nåˆ é™¤å…‰æ ‡æ‰€åœ¨æ•´è¡Œï¼Œç„¶ååœ¨è¯¥è¡Œé¦–æ’å…¥æ–‡æœ¬\n\n\ncw\nåˆ é™¤å…‰æ ‡å¤„åˆ°å½“å‰å•è¯ç»“å°¾çš„å­—ç¬¦ï¼Œç„¶åæ’å…¥æ–‡æœ¬\n\n\n\näº”ã€Vim å‘½ä»¤æ¨¡å¼ï¼šç¯å¢ƒè®¾ç½®ã€æŸ¥æ‰¾æ›¿æ¢ä¸ Linux å‘½ä»¤è°ƒç”¨\n1. æ–‡æœ¬æ˜¾ç¤ºä¸è¡Œå·è®¾ç½®\n\n\n\nå‘½ä»¤\nåŠŸèƒ½æè¿°\n\n\n\n\n:set nu\næ˜¾ç¤ºæ–‡æœ¬è¡Œå·\n\n\n:set nonu\nå–æ¶ˆæ˜¾ç¤ºè¡Œå·\n\n\n:n\nå¿«é€Ÿå®šä½åˆ°ç¬¬nè¡Œï¼ˆnä¸ºæ•°å­—ï¼‰\n\n\n\n2. æ–‡æœ¬æŸ¥æ‰¾ä¸å¤§å°å†™è®¾ç½®\nè‹¥éœ€ ç²¾å‡†åŒ¹é…ç‹¬ç«‹å•è¯ï¼ˆä»…åŒ¹é… test æœ¬èº«ï¼Œä¸åŒ…å«å‰åå­—ç¬¦ï¼‰ï¼Œéœ€ç”¨å•è¯è¾¹ç•Œæ ‡è®° \\&lt; å’Œ \\&gt;    è¾“å…¥ /ï¼ˆæ­£å‘æŸ¥æ‰¾ï¼‰æˆ– ?ï¼ˆåå‘æŸ¥æ‰¾ï¼‰\n\n\n\nå‘½ä»¤\nåŠŸèƒ½æè¿°\nç¤ºä¾‹\n\n\n\n\n/ç›®æ ‡å­—ç¬¦ä¸²\nä»å…‰æ ‡ä½ç½®å‘åæŸ¥æ‰¾ç›®æ ‡å­—ç¬¦ä¸²ï¼ŒåŒ¹é…ç»“æœé«˜äº®\n/Vimï¼ˆæŸ¥æ‰¾æ‰€æœ‰ â€œVimâ€ï¼ŒæŒ‰nè·³è½¬åˆ°ä¸‹ä¸€ä¸ªï¼ŒNè·³è½¬åˆ°ä¸Šä¸€ä¸ªï¼‰\n\n\n:set ic\næŸ¥æ‰¾æ—¶å¿½ç•¥å¤§å°å†™\nè¾“å…¥:set icåï¼ŒæŸ¥æ‰¾ â€œvimâ€ ä¼šåŒ¹é… â€œVimâ€â€œVIMâ€ ç­‰\n\n\n:set noic\næŸ¥æ‰¾æ—¶åŒºåˆ†å¤§å°å†™\nè¾“å…¥:set noicåï¼ŒæŸ¥æ‰¾ â€œvimâ€ ä»…åŒ¹é… â€œvimâ€\n\n\n\n3. æ–‡æœ¬åˆ é™¤ä¸æ›¿æ¢\nï¼ˆ1ï¼‰å¤šè¡Œåˆ é™¤\n\n\nå‘½ä»¤æ ¼å¼ï¼š:n1,n2dï¼ˆn1ä¸ºèµ·å§‹è¡Œå·ï¼Œn2ä¸ºç»“æŸè¡Œå·ï¼Œdä¸ºåˆ é™¤å…³é”®å­—ï¼‰\n\n\nç¤ºä¾‹ï¼š:3,5dï¼ˆåˆ é™¤ç¬¬ 3 è¡Œåˆ°ç¬¬ 5 è¡Œçš„æ–‡æœ¬ï¼‰\n\n\nï¼ˆ2ï¼‰æ–‡æœ¬æ›¿æ¢\n\n\nå‘½ä»¤æ ¼å¼ï¼š:{ä½œç”¨èŒƒå›´}s/{ç›®æ ‡å­—ç¬¦ä¸²}/{æ›¿æ¢å­—ç¬¦ä¸²}/{æ›¿æ¢æ ‡å¿—}\n\n\nè¯¦ç»†ç¤ºä¾‹ï¼š\n\n\n\n\n\nå‘½ä»¤\nä½œç”¨èŒƒå›´\næ›¿æ¢æ ‡å¿—å«ä¹‰\nåŠŸèƒ½æè¿°\n\n\n\n\n:s/zempty/handsome/g\nå½“å‰è¡Œ\ngï¼ˆå…¨å±€æ›¿æ¢ï¼‰\nå°†å½“å‰è¡Œæ‰€æœ‰ â€œzemptyâ€ æ›¿æ¢ä¸º â€œhandsomeâ€\n\n\n:%s/zempty/handsome/g\nå…¨æ–‡ï¼ˆ%è¡¨ç¤ºï¼‰\ngï¼ˆå…¨å±€æ›¿æ¢ï¼‰\nå°†å…¨æ–‡æ‰€æœ‰ â€œzemptyâ€ æ›¿æ¢ä¸º â€œhandsomeâ€\n\n\n:2,4s/zempty/handsome/g\nç¬¬ 2-4 è¡Œ\ngï¼ˆå…¨å±€æ›¿æ¢ï¼‰\nå°†ç¬¬ 2-4 è¡Œæ‰€æœ‰ â€œzemptyâ€ æ›¿æ¢ä¸º â€œhandsomeâ€\n\n\n:'&lt;,'&gt;s/zempty/handsome/g\nå¯è§†æ¨¡å¼é€‰åŒº\ngï¼ˆå…¨å±€æ›¿æ¢ï¼‰\nå¯è§†æ¨¡å¼é€‰ä¸­æ–‡æœ¬åï¼Œè¾“å…¥:, è‡ªåŠ¨è¡¥å…¨:'&lt;,'&gt;, å†è¾“å…¥å‘½ä»¤ï¼Œæ›¿æ¢é€‰åŒºå†… â€œzemptyâ€ ä¸º â€œhandsomeâ€\n\n\n:s/zempty/handsome\nå½“å‰è¡Œ\næ— ï¼ˆä»…æ›¿æ¢ç¬¬ä¸€æ¬¡åŒ¹é…ï¼‰\nå°†å½“å‰è¡Œç¬¬ä¸€ä¸ª â€œzemptyâ€ æ›¿æ¢ä¸º â€œhandsomeâ€\n\n\n:%s/zempty/handsome/i\nå…¨æ–‡\niï¼ˆå¿½ç•¥å¤§å°å†™ï¼‰\nå…¨æ–‡æ›¿æ¢ â€œzemptyâ€ ä¸º â€œhandsomeâ€ï¼Œå¿½ç•¥å¤§å°å†™\n\n\n:%s/zempty/handsome/gi\nå…¨æ–‡\ng+iï¼ˆå…¨å±€ + å¿½ç•¥å¤§å°å†™ï¼‰\nå…¨æ–‡æ›¿æ¢æ‰€æœ‰ â€œzemptyâ€ï¼ˆå¿½ç•¥å¤§å°å†™ï¼‰ä¸º â€œhandsomeâ€\n\n\n:%s/zempty/handsome/gc\nå…¨æ–‡\ng+cï¼ˆå…¨å±€ + ç¡®è®¤ï¼‰\nå…¨æ–‡æ›¿æ¢ â€œzemptyâ€ ä¸º â€œhandsomeâ€ï¼Œæ¯å¤„åŒ¹é…éœ€ç¡®è®¤ï¼ˆæŒ‰yç¡®è®¤ï¼Œnè·³è¿‡ï¼Œaå…¨æ›¿æ¢ï¼Œqé€€å‡ºï¼‰\n\n\n\n4. Vim ä¸­è°ƒç”¨ Linux å‘½ä»¤\nï¼ˆ1ï¼‰æ‰§è¡Œ Linux å‘½ä»¤å¹¶æŸ¥çœ‹ç»“æœï¼ˆä¸æ’å…¥æ–‡æœ¬ï¼‰\n\n\nå‘½ä»¤æ ¼å¼ï¼š:!Linuxå‘½ä»¤ï¼ˆ!ä¸ºè°ƒç”¨å¤–éƒ¨å‘½ä»¤çš„æ ‡å¿—ï¼‰\n\n\nç¤ºä¾‹ï¼š\n\n:!dateï¼šæ‰§è¡Œdateå‘½ä»¤ï¼Œæ˜¾ç¤ºå½“å‰ç³»ç»Ÿæ—¶é—´ï¼ŒæŒ‰Enterè¿”å› Vim ç¼–è¾‘ç•Œé¢ã€‚\n:!lsï¼šæ‰§è¡Œlså‘½ä»¤ï¼Œæ˜¾ç¤ºå½“å‰ç›®å½•ä¸‹çš„æ–‡ä»¶åˆ—è¡¨ï¼ŒæŒ‰Enterè¿”å› Vimã€‚\n:!pwdï¼šæ‰§è¡Œpwdå‘½ä»¤ï¼Œæ˜¾ç¤ºå½“å‰å·¥ä½œç›®å½•è·¯å¾„ï¼ŒæŒ‰Enterè¿”å› Vimã€‚\n\n\n\nï¼ˆ2ï¼‰æ‰§è¡Œ Linux å‘½ä»¤å¹¶å°†ç»“æœæ’å…¥æ–‡æœ¬\n\n\nå‘½ä»¤æ ¼å¼ï¼š:r !Linuxå‘½ä»¤ï¼ˆrä¸º â€œè¯»å–â€ æ ‡å¿—ï¼Œå°†å‘½ä»¤ç»“æœè¯»å–åˆ°æ–‡æœ¬ä¸­ï¼‰\n\n\nç¤ºä¾‹ï¼š\n\n:r !dateï¼šæ‰§è¡Œdateå‘½ä»¤ï¼Œå°†å½“å‰æ—¶é—´æ’å…¥åˆ°å…‰æ ‡æ‰€åœ¨ä½ç½®ï¼ˆå¦‚å…‰æ ‡åœ¨ç¬¬ 5 è¡Œï¼Œæ—¶é—´ä¼šæ’å…¥åˆ°ç¬¬ 5 è¡Œä¹‹åï¼‰ã€‚\n:r !cat file2ï¼šæ‰§è¡Œcat file2å‘½ä»¤ï¼Œå°†file2çš„å†…å®¹æ’å…¥åˆ°å…‰æ ‡æ‰€åœ¨ä½ç½®ã€‚\n:r !ls -lï¼šæ‰§è¡Œls -lå‘½ä»¤ï¼Œå°†ç›®å½•ä¸‹æ–‡ä»¶çš„è¯¦ç»†ä¿¡æ¯ï¼ˆæƒé™ã€å¤§å°ç­‰ï¼‰æ’å…¥åˆ°æ–‡æœ¬ä¸­ã€‚\n\n\n\n5. è‡ªå®šä¹‰å¿«æ·é”®ä¸æ–‡æœ¬ç¼©å†™\nï¼ˆ1ï¼‰è‡ªå®šä¹‰å¿«æ·é”®ï¼ˆmapå‘½ä»¤ï¼‰\n\n\nå‘½ä»¤æ ¼å¼ï¼š:map å¿«æ·é”® æ“ä½œåºåˆ—ï¼ˆå¿«æ·é”®éœ€ç”¨Ctrl + v + æŒ‰é”®ç”Ÿæˆï¼Œå¦‚Ctrl + méœ€æŒ‰Ctrl + v + mæ˜¾ç¤ºä¸º^Mï¼‰\n\n\nç¤ºä¾‹ï¼š\n\n:map ^M I#&lt;ESC&gt;ï¼š^Mä»£è¡¨Ctrl + mï¼ŒæŒ‰è¯¥å¿«æ·é”®å¯åœ¨å…‰æ ‡æ‰€åœ¨è¡Œé¦–æ’å…¥#ï¼ˆæ³¨é‡Šç¬¦å·ï¼‰ï¼Œå¹¶è¿”å›æ­£å¸¸æ¨¡å¼ã€‚\n:map ^D Ahelloworld&lt;ESC&gt;ï¼š^Dä»£è¡¨Ctrl + dï¼ŒæŒ‰è¯¥å¿«æ·é”®å¯åœ¨å…‰æ ‡æ‰€åœ¨è¡Œå°¾æ·»åŠ  â€œhelloworldâ€ï¼Œå¹¶è¿”å›æ­£å¸¸æ¨¡å¼ã€‚\n\n\n\nï¼ˆ2ï¼‰æ–‡æœ¬ç¼©å†™ï¼ˆabå‘½ä»¤ï¼‰\n\n\nå‘½ä»¤æ ¼å¼ï¼š:ab ç¼©å†™ å®Œæ•´æ–‡æœ¬ï¼ˆæ’å…¥æ¨¡å¼ä¸‹è¾“å…¥ç¼©å†™ï¼Œä¼šè‡ªåŠ¨æ›¿æ¢ä¸ºå®Œæ•´æ–‡æœ¬ï¼‰\n\n\nç¤ºä¾‹ï¼š\n\n:ab email xxx@gmail.comï¼šè®¾ç½®åï¼Œåœ¨æ’å…¥æ¨¡å¼è¾“å…¥ â€œemailâ€ï¼Œä¼šè‡ªåŠ¨æ›¿æ¢ä¸º â€œxxx@gmail.comâ€ï¼Œé€‚ç”¨äºé¢‘ç¹è¾“å…¥çš„é•¿æ–‡æœ¬ã€‚\n\n\n\nå…­ã€Vim æ­£å¸¸æ¨¡å¼ï¼šå…‰æ ‡ç§»åŠ¨ã€å¤åˆ¶ç²˜è´´ä¸æ–‡æœ¬æ“ä½œ\n\n\n\nç§»åŠ¨ç±»å‹\nå¿«æ·é”®\nåŠŸèƒ½\n\n\n\n\nåŸºç¡€æ–¹å‘ç§»åŠ¨\nh/j/k/l\nå·¦ / ä¸‹ / ä¸Š / å³ç§»åŠ¨å…‰æ ‡\n\n\nè¡Œå†…ç§»åŠ¨\n0\nç§»åŠ¨åˆ°è¡Œé¦–\n\n\nè¡Œå†…ç§»åŠ¨\n^\nç§»åŠ¨åˆ°æœ¬è¡Œç¬¬ä¸€ä¸ªéç©ºç™½å­—ç¬¦\n\n\nè¡Œå†…ç§»åŠ¨\n$\nç§»åŠ¨åˆ°è¡Œå°¾\n\n\nè¡Œå†…ç§»åŠ¨\ng_\nç§»åŠ¨åˆ°æœ¬è¡Œæœ€åä¸€ä¸ªéç©ºç™½å­—ç¬¦\n\n\nå•è¯ç§»åŠ¨\nw\nç§»åŠ¨åˆ°ä¸‹ä¸€ä¸ªå•è¯å¼€å¤´\n\n\nå•è¯ç§»åŠ¨\ne\nç§»åŠ¨åˆ°ä¸‹ä¸€ä¸ªå•è¯ç»“å°¾\n\n\nå­—ç¬¦å®šä½ç§»åŠ¨\nfaï¼ˆa ä¸ºç›®æ ‡å­—ç¬¦ï¼‰\nç§»åŠ¨åˆ°æœ¬è¡Œä¸‹ä¸€ä¸ª â€œaâ€ å¤„\n\n\nå­—ç¬¦å®šä½ç§»åŠ¨\nnfaï¼ˆn ä¸ºæ¬¡æ•°ï¼‰\nç§»åŠ¨åˆ°æœ¬è¡Œç¬¬ n ä¸ª â€œaâ€ å¤„\n\n\nå­—ç¬¦å®šä½ç§»åŠ¨\nFa\nç§»åŠ¨åˆ°æœ¬è¡Œä¸Šä¸€ä¸ª â€œaâ€ å¤„\n\n\nå­—ç¬¦å®šä½ç§»åŠ¨\nnFa\nç§»åŠ¨åˆ°æœ¬è¡Œç¬¬ n ä¸ª â€œaâ€ï¼ˆå‘å‰æ‰¾ï¼‰\n\n\nå­—ç¬¦å®šä½ç§»åŠ¨\nta\nç§»åŠ¨åˆ° â€œaâ€ çš„å‰ä¸€ä¸ªå­—ç¬¦\n\n\nå­—ç¬¦å®šä½ç§»åŠ¨\nnta\nç§»åŠ¨åˆ°ç¬¬ n ä¸ª â€œaâ€ çš„å‰ä¸€ä¸ªå­—ç¬¦\n\n\nå­—ç¬¦å®šä½ç§»åŠ¨\nTa\nç§»åŠ¨åˆ° â€œaâ€ çš„å‰ä¸€ä¸ªå­—ç¬¦ï¼ˆå‘å‰æ‰¾ï¼‰\n\n\nå­—ç¬¦å®šä½ç§»åŠ¨\nnTa\nç§»åŠ¨åˆ°ç¬¬ n ä¸ª â€œaâ€ çš„å‰ä¸€ä¸ªå­—ç¬¦ï¼ˆå‘å‰æ‰¾ï¼‰\n\n\nå­—ç¬¦å®šä½è·³è½¬\n;/,\nf/F/t/T åï¼Œè·³è½¬åˆ°ä¸‹ä¸€ä¸ª / ä¸Šä¸€ä¸ªç›®æ ‡å­—ç¬¦\n\n\nè·¨è¡Œç§»åŠ¨\nnG\nå®šä½åˆ°ç¬¬ n è¡Œé¦–\n\n\nè·¨è¡Œç§»åŠ¨\ngg\nå®šä½åˆ°ç¬¬ä¸€è¡Œé¦–\n\n\nè·¨è¡Œç§»åŠ¨\nG\nå®šä½åˆ°æœ€åä¸€è¡Œé¦–\n\n\n\n","categories":["ç¼–ç¨‹"],"tags":["å·¥å…·","Linux"]},{"title":"è·å–å’Œè®¾ç½®socketé€‰é¡¹","url":"/2025/07/31/linux/get%20setsockopt/","content":"å¦‚ä½•ä½¿ç”¨ C++ è¿›è¡Œ TCP å’Œ UDP æ•°æ®è¯»å†™çš„åŸºç¡€çŸ¥è¯†\n\nget/setsockopt\ngetsockopt å’Œ setsockopt æ˜¯å¥—æ¥å­—ç¼–ç¨‹ä¸­ç”¨äºè·å–å’Œè®¾ç½®å¥—æ¥å­—é€‰é¡¹çš„ä¸¤ä¸ªé‡è¦ç³»ç»Ÿè°ƒç”¨ï¼Œå®ƒä»¬å…è®¸å¼€å‘è€…é…ç½®å’ŒæŸ¥è¯¢å¥—æ¥å­—çš„å„ç§å‚æ•°ï¼Œä»¥æ§åˆ¶ç½‘ç»œé€šä¿¡çš„è¡Œä¸ºã€‚\nå‡½æ•°åŸå‹\n#include &lt;sys/socket.h&gt;// è·å–å¥—æ¥å­—é€‰é¡¹int getsockopt(int sockfd, int level, int optname,                void *optval, socklen_t *optlen);// è®¾ç½®å¥—æ¥å­—é€‰é¡¹int setsockopt(int sockfd, int level, int optname,                const void *optval, socklen_t optlen);\nå‚æ•°è¯´æ˜\n\n\nsockfdï¼šå¥—æ¥å­—æè¿°ç¬¦ï¼Œæ ‡è¯†è¦æ“ä½œçš„å¥—æ¥å­—ã€‚\n\n\nlevelï¼šé€‰é¡¹æ‰€åœ¨çš„åè®®å±‚çº§ï¼Œå¸¸è§å€¼åŒ…æ‹¬ï¼š\n\nSOL_SOCKETï¼šé€šç”¨å¥—æ¥å­—é€‰é¡¹ï¼ˆé€‚ç”¨äºæ‰€æœ‰åè®®ï¼‰\nIPPROTO_TCPï¼šTCP åè®®ç‰¹å®šé€‰é¡¹\nIPPROTO_IPï¼šIP åè®®ç‰¹å®šé€‰é¡¹\nå…¶ä»–åè®®ï¼ˆå¦‚ IPPROTO_UDPã€IPPROTO_IPV6 ç­‰ï¼‰\n\n\n\noptnameï¼šè¦è·å–æˆ–è®¾ç½®çš„å…·ä½“é€‰é¡¹åç§°ï¼ˆä¸ level å¯¹åº”ï¼‰ã€‚\n\n\noptvalï¼š\n\nå¯¹äº setsockoptï¼šæŒ‡å‘è¦è®¾ç½®çš„é€‰é¡¹å€¼çš„ç¼“å†²åŒº\nå¯¹äº getsockoptï¼šæŒ‡å‘å­˜å‚¨è·å–ç»“æœçš„ç¼“å†²åŒº\n\n\n\noptlenï¼š\n\nå¯¹äº setsockoptï¼šæŒ‡å®š optval ç¼“å†²åŒºçš„é•¿åº¦\nå¯¹äº getsockoptï¼šè¾“å…¥æ—¶æŒ‡å®šç¼“å†²åŒºé•¿åº¦ï¼Œè¾“å‡ºæ—¶è¿”å›å®é™…è¯»å–çš„é•¿åº¦\n\n\n\nè¿”å›å€¼\n\n\næˆåŠŸï¼šè¿”å› 0\n\n\nå¤±è´¥ï¼šè¿”å› -1ï¼Œå¹¶è®¾ç½® errno\n\n\nå¸¸ç”¨é€‰é¡¹ç¤ºä¾‹\n1. SOL_SOCKET å±‚çº§ï¼ˆé€šç”¨é€‰é¡¹ï¼‰\n\n\nSO_REUSEADDRï¼šå…è®¸é‡ç”¨æœ¬åœ°åœ°å€å’Œç«¯å£\nint reuse = 1;setsockopt(sockfd, SOL_SOCKET, SO_REUSEADDR, &amp;reuse, sizeof(reuse));\n\n\nSO_RCVBUF / SO_SNDBUFï¼šè·å– / è®¾ç½®æ¥æ”¶ / å‘é€ç¼“å†²åŒºå¤§å°\nint bufsize;socklen_t len = sizeof(bufsize);getsockopt(sockfd, SOL_SOCKET, SO_RCVBUF, &amp;bufsize, &amp;len);\n\n\nSO_KEEPALIVEï¼šå¯ç”¨ TCP ä¿æ´»æœºåˆ¶\nint keepalive = 1;setsockopt(sockfd, SOL_SOCKET, SO_KEEPALIVE, &amp;keepalive, sizeof(keepalive));\n\n\n2. IPPROTO_TCP å±‚çº§ï¼ˆTCP é€‰é¡¹ï¼‰\n\n\nTCP_NODELAYï¼šç¦ç”¨ Nagle ç®—æ³•ï¼ˆå‡å°‘å»¶è¿Ÿï¼Œå¯èƒ½å¢åŠ å¸¦å®½æ¶ˆè€—ï¼‰\nint nodelay = 1;setsockopt(sockfd, IPPROTO_TCP, TCP_NODELAY, &amp;nodelay, sizeof(nodelay));\n\n\n3. IPPROTO_IP å±‚çº§ï¼ˆIP é€‰é¡¹ï¼‰\n\n\nIP_TTLï¼šè®¾ç½® IP æ•°æ®åŒ…çš„ç”Ÿå­˜æ—¶é—´ï¼ˆTTLï¼‰\nint ttl = 64;setsockopt(sockfd, IPPROTO_IP, IP_TTL, &amp;ttl, sizeof(ttl));\n\n\nä½¿ç”¨åœºæ™¯\n\n\nç½‘ç»œæ€§èƒ½ä¼˜åŒ–ï¼šè°ƒæ•´ç¼“å†²åŒºå¤§å°ã€å¯ç”¨ / ç¦ç”¨ç‰¹å®šç®—æ³•\n\n\nè¿æ¥ç®¡ç†ï¼šè®¾ç½®è¶…æ—¶ã€æ§åˆ¶åœ°å€é‡ç”¨\n\n\nåè®®è¡Œä¸ºå®šåˆ¶ï¼šå¦‚ TCP ä¿æ´»ã€Nagle ç®—æ³•ç­‰\n\n\nè°ƒè¯•ä¸ç›‘æ§ï¼šè·å–å¥—æ¥å­—å½“å‰çŠ¶æ€ä¿¡æ¯\n\n\næ³¨æ„äº‹é¡¹\n\n\né€‰é¡¹çš„å¯ç”¨æ€§å–å†³äºç³»ç»Ÿå’Œåè®®æ ˆå®ç°\n\n\næŸäº›é€‰é¡¹åªèƒ½åœ¨ç‰¹å®šé˜¶æ®µè®¾ç½®ï¼ˆå¦‚ SO_REUSEADDR é€šå¸¸åœ¨ç»‘å®šå‰è®¾ç½®ï¼‰\n\n\nå¯¹äºæ•°å€¼å‹é€‰é¡¹ï¼Œé€šå¸¸ä½¿ç”¨ int ç±»å‹å­˜å‚¨å€¼\n\n\né”™è¯¯å¤„ç†å¾ˆé‡è¦ï¼Œéœ€æ£€æŸ¥è¿”å›å€¼å¹¶å¤„ç†å¯èƒ½çš„é”™è¯¯\n\n\n","categories":["ç¼–ç¨‹"],"tags":["C++","Linux"]},{"title":"Linux ä¿¡å·","url":"/2025/08/28/linux/linux%E4%BF%A1%E5%8F%B7/","content":"è®°å½•linuxç³»ç»Ÿä¸­ä¿¡å·çš„ç›¸å…³æ¦‚å¿µå’Œç”¨æ³•\n \nä¸€ã€ä¿¡å·çš„åŸºæœ¬æ¦‚å¿µ\nä¿¡å·ï¼ˆSignalï¼‰æ˜¯Linuxç³»ç»Ÿä¸­è¿›ç¨‹é—´å¼‚æ­¥é€šä¿¡çš„æ ¸å¿ƒæœºåˆ¶ï¼Œç”¨äºé€šçŸ¥è¿›ç¨‹å‘ç”Ÿç‰¹å®šäº‹ä»¶ï¼ˆå¦‚ç”¨æˆ·è¾“å…¥ã€é”™è¯¯ã€è¿›ç¨‹çŠ¶æ€å˜åŒ–ç­‰ï¼‰ã€‚è¿›ç¨‹æ”¶åˆ°ä¿¡å·åä¼šä¸­æ–­å½“å‰æ‰§è¡Œæµç¨‹ï¼Œè½¬è€Œå»æ‰§è¡Œé¢„è®¾çš„å¤„ç†é€»è¾‘ã€‚\n1. ä¿¡å·æœ¬è´¨ä¸ç‰¹æ€§\n\n\nå¼‚æ­¥æ€§ï¼šä¿¡å·å¯åœ¨ä»»æ„æ—¶åˆ»è§¦å‘ï¼Œä¸å—è¿›ç¨‹æ‰§è¡Œæµç¨‹æ§åˆ¶ã€‚\n\n\nä¸å¯é æ€§ï¼šæ ‡å‡†ä¿¡å·ï¼ˆ1-31ï¼‰ä¸æ”¯æŒæ’é˜Ÿï¼Œå¤šæ¬¡å‘é€åŒä¸€ä¿¡å·å¯èƒ½è¢«åˆå¹¶ï¼›å®æ—¶ä¿¡å·ï¼ˆ34-64ï¼ŒSIGRTMIN~SIGRTMAXï¼‰æ”¯æŒæ’é˜Ÿå’Œæºå¸¦æ•°æ®ï¼Œæ›´å¯é ã€‚\n\n\nä¸å¯å±è”½æ€§ï¼šSIGKILLï¼ˆ9ï¼‰å’ŒSIGSTOPï¼ˆ19ï¼‰æ— æ³•è¢«æ•è·ã€å¿½ç•¥æˆ–ä¿®æ”¹å¤„ç†æ–¹å¼ï¼Œç”¨äºå¼ºåˆ¶ç»ˆæ­¢/æš‚åœè¿›ç¨‹ã€‚\n\n\n2. ä¿¡å·æ¥æº\n\n\nç¡¬ä»¶è§¦å‘ï¼šå¦‚é”®ç›˜è¾“å…¥ï¼ˆCtrl+Cäº§ç”ŸSIGINTï¼‰ã€æ®µé”™è¯¯ï¼ˆSIGSEGVï¼‰ã€ç®—æœ¯é”™è¯¯ï¼ˆSIGFPEï¼‰ã€‚\n\n\nè½¯ä»¶è§¦å‘ï¼šå¦‚killå‘½ä»¤ã€kill()å‡½æ•°å‘é€ä¿¡å·ï¼Œå­è¿›ç¨‹ç»ˆæ­¢ï¼ˆSIGCHLDï¼‰ï¼Œå®šæ—¶å™¨åˆ°æœŸï¼ˆSIGALRMï¼‰ï¼Œå‘å…³é—­çš„å¥—æ¥å­—å†™æ•°æ®ï¼ˆSIGPIPEï¼‰ç­‰ã€‚\n\n\näºŒã€ä¿¡å·å¤„ç†æ ¸å¿ƒå‡½æ•°ä¸ç»“æ„ä½“\nLinuxæä¾›äº†ä¸€ç³»åˆ—ä¿¡å·å¤„ç†å‡½æ•°ï¼Œå…¶ä¸­sigactionæ˜¯POSIXæ ‡å‡†æ¨èçš„æ¥å£ï¼ˆåŠŸèƒ½æœ€å…¨é¢ï¼‰ï¼Œé…åˆå…¶ä»–å‡½æ•°å¯å®ç°çµæ´»çš„ä¿¡å·æ§åˆ¶ã€‚\n1. sigactionå‡½æ•°ï¼ˆæ¨èä½¿ç”¨ï¼‰\nåŠŸèƒ½ï¼šè®¾ç½®æˆ–è·å–ä¿¡å·çš„å¤„ç†æ–¹å¼ï¼ˆæ›¿ä»£æ—§çš„signal()å‡½æ•°ï¼Œæ”¯æŒæ›´å¤šæ§åˆ¶é€‰é¡¹ï¼‰ã€‚\nåŸå‹ï¼š\n#include &lt;signal.h&gt;int sigaction(int signum, const struct sigaction* act, struct sigaction* oldact);\nå‚æ•°ï¼š\n\n\nsignumï¼šç›®æ ‡ä¿¡å·ç¼–å·ï¼ˆå¦‚SIGINTã€SIGPIPEï¼‰ã€‚\n\n\nactï¼šéç©ºæ—¶ï¼ŒæŒ‡å®šæ–°çš„ä¿¡å·å¤„ç†é…ç½®ï¼ˆstruct sigactionç±»å‹ï¼‰ã€‚\n\n\noldactï¼šéç©ºæ—¶ï¼Œä¿å­˜ä¹‹å‰çš„å¤„ç†é…ç½®ï¼ˆç”¨äºæ¢å¤ï¼‰ã€‚\nè¿”å›å€¼ï¼šæˆåŠŸè¿”å›0ï¼Œå¤±è´¥è¿”å›-1ï¼ˆè®¾ç½®errnoï¼‰ã€‚\n\n\n2. struct sigactionç»“æ„ä½“\nç”¨äºæè¿°ä¿¡å·çš„å¤„ç†é€»è¾‘ï¼Œå®šä¹‰å¦‚ä¸‹ï¼š\nstruct sigaction &#123;    // ä¿¡å·å¤„ç†å‡½æ•°ï¼ˆäºŒé€‰ä¸€ï¼‰    void (*sa_handler)(int);          // ç®€åŒ–ç‰ˆï¼šä»…æ¥æ”¶ä¿¡å·ç¼–å·    void (*sa_sigaction)(int, siginfo_t*, void*);  // æ‰©å±•ç‰ˆï¼šéœ€é…åˆSA_SIGINFOæ ‡å¿—        sigset_t sa_mask;                 // å¤„ç†ä¿¡å·æ—¶é˜»å¡çš„å…¶ä»–ä¿¡å·    int sa_flags;                     // æ§åˆ¶ä¿¡å·å¤„ç†è¡Œä¸ºçš„æ ‡å¿—ä½    void (*sa_restorer)(void);        // å·²åºŸå¼ƒï¼ˆæ— éœ€ä½¿ç”¨ï¼‰&#125;;\næˆå‘˜è¯¦è§£ï¼š\n\n\nsa_handlerï¼šç®€åŒ–å¤„ç†å‡½æ•°ï¼Œå‚æ•°ä¸ºä¿¡å·ç¼–å·ã€‚å¯è®¾ä¸ºSIG_IGNï¼ˆå¿½ç•¥ä¿¡å·ï¼‰ã€SIG_DFLï¼ˆé»˜è®¤è¡Œä¸ºï¼‰æˆ–è‡ªå®šä¹‰å‡½æ•°ã€‚\n\n\nsa_sigactionï¼šæ‰©å±•å¤„ç†å‡½æ•°ï¼ˆéœ€sa_flagsè®¾ç½®SA_SIGINFOï¼‰ï¼Œå¯è·å–ä¿¡å·è¯¦ç»†ä¿¡æ¯ï¼ˆsiginfo_tï¼‰ã€‚\n\n\nsa_maskï¼šä¿¡å·é›†ï¼ˆsigset_tï¼‰ï¼Œè¡¨ç¤ºå¤„ç†å½“å‰ä¿¡å·æ—¶éœ€é˜»å¡çš„å…¶ä»–ä¿¡å·ï¼ˆé¿å…åµŒå¥—å¤„ç†ï¼‰ã€‚\n\n\nsa_flagsï¼šæ ‡å¿—ä½ï¼ˆå¯ç»„åˆï¼‰ï¼š\n\nSA_RESTARTï¼šè¢«ä¿¡å·ä¸­æ–­çš„ç³»ç»Ÿè°ƒç”¨ï¼ˆå¦‚readã€acceptï¼‰è‡ªåŠ¨é‡å¯ï¼ˆé¿å…EINTRé”™è¯¯ï¼‰ã€‚\nSA_SIGINFOï¼šä½¿ç”¨sa_sigactionä½œä¸ºå¤„ç†å‡½æ•°ã€‚\nSA_NOCLDSTOPï¼šSIGCHLDä»…åœ¨å­è¿›ç¨‹ç»ˆæ­¢æ—¶é€šçŸ¥ï¼ˆå¿½ç•¥æš‚åœäº‹ä»¶ï¼‰ã€‚\n\n\n\n3. siginfo_tç»“æ„ä½“ï¼ˆæ‰©å±•ä¿¡æ¯è½½ä½“ï¼‰\nå½“ä½¿ç”¨sa_sigactionæ—¶ï¼Œç”¨äºä¼ é€’ä¿¡å·è¯¦ç»†ä¿¡æ¯ï¼š\ntypedef struct &#123;    int      si_signo;   // ä¿¡å·ç¼–å·    int      si_code;    // ä¿¡å·äº§ç”ŸåŸå› ï¼ˆå¦‚SI_USERè¡¨ç¤ºç”¨æˆ·å‘é€ï¼‰    pid_t    si_pid;     // å‘é€ä¿¡å·çš„è¿›ç¨‹ID    uid_t    si_uid;     // å‘é€è¿›ç¨‹çš„ç”¨æˆ·ID    void*    si_addr;    // å¼•å‘ä¿¡å·çš„åœ°å€ï¼ˆå¦‚SIGSEGVçš„é”™è¯¯åœ°å€ï¼‰    int      si_status;  // å­è¿›ç¨‹é€€å‡ºçŠ¶æ€ï¼ˆSIGCHLDä¸“ç”¨ï¼‰    union sigval si_value; // é™„åŠ æ•°æ®ï¼ˆå®æ—¶ä¿¡å·ä¸“ç”¨ï¼‰&#125; siginfo_t;\n4. ä¿¡å·é›†æ“ä½œå‡½æ•°ï¼ˆsigset_tï¼‰\nsigset_tæ˜¯è¡¨ç¤ºâ€œä¿¡å·é›†â€çš„ä½æ©ç ç±»å‹ï¼Œéœ€é€šè¿‡ä»¥ä¸‹å‡½æ•°æ“ä½œï¼š\n\n\nsigemptyset(sigset_t *set)ï¼šåˆå§‹åŒ–ä¿¡å·é›†ä¸ºç©ºã€‚\n\n\nsigfillset(sigset_t *set)ï¼šåˆå§‹åŒ–ä¿¡å·é›†åŒ…å«æ‰€æœ‰ä¿¡å·ã€‚\n\n\nsigaddset(sigset_t *set, int signum)ï¼šæ·»åŠ ä¿¡å·åˆ°é›†åˆã€‚\n\n\nsigdelset(sigset_t *set, int signum)ï¼šä»é›†åˆç§»é™¤ä¿¡å·ã€‚\n\n\nsigismember(const sigset_t *set, int signum)ï¼šåˆ¤æ–­ä¿¡å·æ˜¯å¦åœ¨é›†åˆä¸­ï¼ˆè¿”å›1/0/-1ï¼‰ã€‚\n\n\n5. å…¶ä»–æ ¸å¿ƒå‡½æ•°\n\n\n\nå‡½æ•°åŸå‹\nåŠŸèƒ½\nå…³é”®å‚æ•°\n\n\n\n\nint sigprocmask(int how, const sigset_t *set, sigset_t *oldset)\nä¿®æ”¹è¿›ç¨‹çš„ä¿¡å·æ©ç ï¼ˆå…¨å±€é˜»å¡ä¿¡å·ï¼‰\nhowï¼šSIG_BLOCKï¼ˆæ·»åŠ é˜»å¡ï¼‰ã€SIG_UNBLOCKï¼ˆè§£é™¤é˜»å¡ï¼‰ã€SIG_SETMASKï¼ˆæ›¿æ¢æ©ç ï¼‰\n\n\nint sigpending(sigset_t *set)\nè·å–å½“å‰è¿›ç¨‹ä¸­â€œå·²äº§ç”Ÿä½†æœªå¤„ç†â€çš„ä¿¡å·ï¼ˆpendingé›†ï¼‰\n-\n\n\nint kill(pid_t pid, int sig)\nå‘æŒ‡å®šè¿›ç¨‹å‘é€ä¿¡å·\npidï¼šç›®æ ‡è¿›ç¨‹IDï¼ˆpid&gt;0æŒ‡å®šè¿›ç¨‹ï¼Œpid=0åŒç»„è¿›ç¨‹ï¼‰\n\n\nint raise(int sig)\nå‘å½“å‰è¿›ç¨‹å‘é€ä¿¡å·ï¼ˆç­‰ä»·äºkill(getpid(), sig)ï¼‰\n-\n\n\nint sigwait(const sigset_t *set, int *sig)\nåŒæ­¥ç­‰å¾…ä¿¡å·ï¼ˆå°†å¼‚æ­¥ä¿¡å·è½¬ä¸ºåŒæ­¥å¤„ç†ï¼‰\néœ€å…ˆé€šè¿‡sigprocmaské˜»å¡ç›®æ ‡ä¿¡å·\n\n\nint sigqueue(pid_t pid, int sig, const union sigval value)\nå‘è¿›ç¨‹å‘é€å¸¦æ•°æ®çš„å®æ—¶ä¿¡å·\nvalueï¼šé™„åŠ æ•°æ®ï¼ˆsival_intæˆ–sival_ptrï¼‰\n\n\n\n6. å…¼å®¹æ€§å‡½æ•°signal()\næ—©æœŸæ¥å£ï¼ŒåŠŸèƒ½ç®€åŒ–ä½†è·¨ç³»ç»Ÿè¡Œä¸ºå¯èƒ½ä¸ä¸€è‡´ï¼š\nvoid (*signal(int signum, void (*handler)(int)))(int);\nå±€é™æ€§ï¼šä¸æ”¯æŒsa_maskå’Œsa_flagsï¼Œä¿¡å·å¤„ç†æœŸé—´ä»…é˜»å¡å½“å‰ä¿¡å·ï¼Œéƒ¨åˆ†ç³»ç»Ÿä¼šè‡ªåŠ¨é‡ç½®ä¸ºé»˜è®¤è¡Œä¸ºã€‚ä»…æ¨èç”¨äºç®€å•æ¼”ç¤ºï¼Œå®é™…å¼€å‘ä¼˜å…ˆç”¨sigactionã€‚\nä¸‰ã€å¸¸ç”¨ä¿¡å·è¯¦è§£ï¼ˆç½‘ç»œç¼–ç¨‹é«˜é¢‘åœºæ™¯ï¼‰\nç³»ç»Ÿå®šä¹‰äº†64ç§ä¿¡å·ï¼Œä»¥ä¸‹ä¸ºç½‘ç»œç¼–ç¨‹ä¸­éœ€é‡ç‚¹å…³æ³¨çš„ä¿¡å·ï¼š\n\n\n\nç¼–å·\nä¿¡å·å\nè§¦å‘åœºæ™¯\né»˜è®¤è¡Œä¸º\nç½‘ç»œç¼–ç¨‹ä¸­çš„æ„ä¹‰\n\n\n\n\n2\nSIGINT\nCtrl+Cç»ˆç«¯ä¸­æ–­\nç»ˆæ­¢è¿›ç¨‹\néœ€æ•è·ä»¥ä¼˜é›…å…³é—­è¿æ¥ï¼ˆå¦‚é‡Šæ”¾socketï¼‰\n\n\n3\nSIGQUIT\nCtrl+\\ç»ˆç«¯é€€å‡º\nç»ˆæ­¢+æ ¸å¿ƒè½¬å‚¨\nåŒä¸Šï¼Œå¯ç”¨äºå¼ºåˆ¶é€€å‡ºå¹¶ç”Ÿæˆè°ƒè¯•ä¿¡æ¯\n\n\n6\nSIGABRT\nè°ƒç”¨abort()\nç»ˆæ­¢+æ ¸å¿ƒè½¬å‚¨\næ£€æµ‹åˆ°ä¸¥é‡é”™è¯¯ï¼ˆå¦‚å†…å­˜ç ´åï¼‰æ—¶è§¦å‘\n\n\n8\nSIGFPE\nç®—æœ¯é”™è¯¯ï¼ˆé™¤é›¶ã€æº¢å‡ºï¼‰\nç»ˆæ­¢+æ ¸å¿ƒè½¬å‚¨\nåè®®è§£æä¸­çš„æ•°å€¼è®¡ç®—é”™è¯¯\n\n\n10\nSIGUSR1\nç”¨æˆ·è‡ªå®šä¹‰\nç»ˆæ­¢\nè‡ªå®šä¹‰äº‹ä»¶ï¼ˆå¦‚é‡æ–°åŠ è½½é…ç½®ï¼‰\n\n\n12\nSIGUSR2\nç”¨æˆ·è‡ªå®šä¹‰\nç»ˆæ­¢\nä¸SIGUSR1é…åˆåŒºåˆ†ä¸åŒäº‹ä»¶\n\n\n13\nSIGPIPE\nå‘å·²å…³é—­çš„å¥—æ¥å­—å†™æ•°æ®\nç»ˆæ­¢\nå¿…é¡»å¤„ç†ï¼ˆå¿½ç•¥æˆ–æ•è·ï¼‰ï¼Œé¿å…ç¨‹åºæ„å¤–é€€å‡º\n\n\n14\nSIGALRM\nå®šæ—¶å™¨åˆ°æœŸ\nç»ˆæ­¢\nå®ç°ç½‘ç»œè¶…æ—¶ï¼ˆå¦‚connectè¶…æ—¶æ§åˆ¶ï¼‰\n\n\n17\nSIGCHLD\nå­è¿›ç¨‹ç»ˆæ­¢/æš‚åœ\nå¿½ç•¥\néœ€æ•è·ä»¥å›æ”¶å­è¿›ç¨‹ï¼ˆé¿å…åƒµå°¸è¿›ç¨‹ï¼‰\n\n\n16\nSIGURG\nå¥—æ¥å­—æ”¶åˆ°ç´§æ€¥æ•°æ®ï¼ˆOOBï¼‰\nå¿½ç•¥\nå¤„ç†TCPå¸¦å¤–æ•°æ®ï¼ˆå¦‚ç´§æ€¥æŒ‡é’ˆï¼‰\n\n\n20\nSIGTSTP\nCtrl+Zç»ˆç«¯æš‚åœ\næš‚åœè¿›ç¨‹\nåå°æœåŠ¡éœ€å¿½ç•¥ï¼ˆé¿å…æ„å¤–æš‚åœï¼‰\n\n\n\nå…³é”®ä¿¡å·æ·±åº¦è§£æï¼š\n\n\nSIGPIPEï¼ˆ13ï¼‰\nå½“TCPè¿æ¥è¢«å¯¹æ–¹å…³é—­åï¼Œæœ¬åœ°ä»è°ƒç”¨write()/send()æ—¶è§¦å‘ã€‚é»˜è®¤ç»ˆæ­¢è¿›ç¨‹ï¼Œç½‘ç»œç¼–ç¨‹ä¸­å¿…é¡»å¤„ç†ï¼š\n\nå¿½ç•¥ä¿¡å·ï¼šsignal(SIGPIPE, SIG_IGN);ï¼Œæ­¤æ—¶å†™æ“ä½œè¿”å›-1å¹¶è®¾ç½®errno=EPIPEï¼Œä¾¿äºç¨‹åºæ•è·é”™è¯¯ã€‚\næ•è·ä¿¡å·ï¼šåœ¨å¤„ç†å‡½æ•°ä¸­è®°å½•è¿æ¥å¼‚å¸¸æ—¥å¿—ã€‚\n\n\n\nSIGCHLDï¼ˆ17ï¼‰\nå­è¿›ç¨‹ç»ˆæ­¢æ—¶ï¼Œçˆ¶è¿›ç¨‹éœ€å›æ”¶èµ„æºï¼ˆå¦åˆ™å­è¿›ç¨‹å˜ä¸ºåƒµå°¸è¿›ç¨‹ï¼‰ã€‚å¤„ç†æ–¹å¼ï¼š\nvoid handle_sigchld(int sig) &#123;    pid_t pid;    // éé˜»å¡å›æ”¶æ‰€æœ‰ç»ˆæ­¢çš„å­è¿›ç¨‹    while ((pid = waitpid(-1, nullptr, WNOHANG)) &gt; 0) &#123;        // å¤„ç†å­è¿›ç¨‹å›æ”¶é€»è¾‘    &#125;&#125;\n\n\nSIGURGï¼ˆ16ï¼‰\nå¥—æ¥å­—æ”¶åˆ°å¸¦å¤–æ•°æ®æ—¶è§¦å‘ï¼Œéœ€ç»“åˆsocketé€‰é¡¹SO_OOBINLINEä½¿ç”¨ï¼Œåœ¨å¤„ç†å‡½æ•°ä¸­è°ƒç”¨recv()è¯»å–ç´§æ€¥æ•°æ®ã€‚\n\n\nå››ã€å®è·µæ³¨æ„äº‹é¡¹\n\n\nä¿¡å·å¤„ç†å‡½æ•°çš„å¯é‡å…¥æ€§\nä¿¡å·å¤„ç†å‡½æ•°å¯èƒ½ä¸­æ–­ä»»æ„ä»£ç ï¼Œéœ€ä½¿ç”¨å¯é‡å…¥å‡½æ•°ï¼ˆå¦‚writeã€_exitã€sigprocmaskï¼‰ï¼Œé¿å…è°ƒç”¨ä¸å¯é‡å…¥å‡½æ•°ï¼ˆprintfã€mallocã€fopenç­‰ï¼Œå¯èƒ½å¯¼è‡´èµ„æºç«äº‰ï¼‰ã€‚è‹¥éœ€è¾“å‡ºï¼Œå¯ç”¨write(STDOUT_FILENO, ...)æ›¿ä»£printfã€‚\n\n\nå¤šçº¿ç¨‹ä¿¡å·å¤„ç†\nä¿¡å·é»˜è®¤éšæœºæŠ•é€’åˆ°ä»»æ„æœªé˜»å¡è¯¥ä¿¡å·çš„çº¿ç¨‹ï¼Œæ¨èåšæ³•ï¼š\n\nä¸»çº¿ç¨‹é€šè¿‡pthread_sigmaské˜»å¡æ‰€æœ‰ä¿¡å·ã€‚\nåˆ›å»ºä¸“é—¨çš„ä¿¡å·å¤„ç†çº¿ç¨‹ï¼Œç”¨sigwait()åŒæ­¥å¤„ç†ä¿¡å·ï¼ˆé¿å…ä¸­æ–­ä¸šåŠ¡é€»è¾‘ï¼‰ï¼šsigset_t set;sigemptyset(&amp;set);sigaddset(&amp;set, SIGINT);pthread_sigmask(SIG_BLOCK, &amp;set, nullptr); // é˜»å¡SIGINTpthread_t tid;pthread_create(&amp;tid, nullptr, [](void* arg) &#123;    int sig;    while (sigwait((sigset_t*)arg, &amp;sig) == 0) &#123;        // å¤„ç†ä¿¡å·ï¼ˆå¦‚SIGINTï¼‰    &#125;    return nullptr;&#125;, &amp;set);\n\n\n\n\nç³»ç»Ÿè°ƒç”¨ä¸­æ–­ä¸é‡å¯\nç½‘ç»œç¼–ç¨‹ä¸­çš„acceptã€recvã€selectç­‰ç³»ç»Ÿè°ƒç”¨å¯èƒ½è¢«ä¿¡å·ä¸­æ–­ï¼Œè¿”å›-1å¹¶è®¾ç½®errno=EINTRã€‚è§£å†³æ–¹å¼ï¼š\n\nè®¾ç½®sa_flags = SA_RESTARTï¼Œä½¿ç³»ç»Ÿè°ƒç”¨è‡ªåŠ¨é‡å¯ï¼ˆéƒ¨åˆ†è°ƒç”¨å¦‚selectä¸æ”¯æŒï¼Œéœ€æ‰‹åŠ¨é‡è¯•ï¼‰ã€‚\næ‰‹åŠ¨åˆ¤æ–­å¹¶é‡è¯•ï¼šssize_t n;while ((n = recv(fd, buf, sizeof(buf), 0)) == -1 &amp;&amp; errno == EINTR);\n\n\n\n\nå®æ—¶ä¿¡å·vsæ ‡å‡†ä¿¡å·\n\næ ‡å‡†ä¿¡å·ï¼ˆ1~31ï¼‰ï¼šé€‚åˆå¤„ç†æ— éœ€æ’é˜Ÿçš„äº‹ä»¶ï¼ˆå¦‚ä¸­æ–­ã€ç»ˆæ­¢ï¼‰ï¼Œå¤šæ¬¡å‘é€å¯èƒ½åˆå¹¶ã€‚\nå®æ—¶ä¿¡å·ï¼ˆ34~64ï¼‰ï¼šæ”¯æŒæ’é˜Ÿå’Œå¸¦æ•°æ®ï¼Œé€‚åˆéœ€è¦å¯é ä¼ é€’çš„åœºæ™¯ï¼ˆå¦‚å¤šä»»åŠ¡çŠ¶æ€é€šçŸ¥ï¼‰ã€‚\n\n\n\n","categories":["ç¼–ç¨‹"],"tags":["C++","Linux"]},{"title":"linuxæ–‡ä»¶æ“ä½œ","url":"/2025/07/12/linux/open()%E7%B3%BB%E7%BB%9F%E8%B0%83%E7%94%A8/","content":"å¦‚ä½•ä½¿ç”¨ C++ åœ¨ Linux ç¯å¢ƒä¸‹è¿›è¡Œæ–‡ä»¶æ“ä½œ\n\nä¸€ã€open() ç³»ç»Ÿè°ƒç”¨ï¼ˆUnix/Linuxï¼‰\n1. æ ¸å¿ƒçŸ¥è¯†ç‚¹å›é¡¾\n\n\nå‡½æ•°åŸå‹\n#include &lt;fcntl.h&gt;    // å®šä¹‰ O_RDONLYã€O_WRONLY ç­‰æ ‡å¿—#include &lt;sys/types.h&gt;  // å®šä¹‰ mode_t ç±»å‹#include &lt;sys/stat.h&gt;   // å®šä¹‰æ–‡ä»¶æƒé™å®int open(const char *pathname, int flags);int open(const char *pathname, int flags, mode_t mode);\n\n\nå‚æ•°\n\npathnameï¼šè¦æ‰“å¼€æˆ–åˆ›å»ºçš„æ–‡ä»¶è·¯å¾„ï¼ˆç»å¯¹æˆ–ç›¸å¯¹è·¯å¾„ï¼‰\nflagsï¼šå¿…é€‰æ ‡å¿—ï¼Œåªèƒ½é€‰å…¶ä¸€ï¼ˆO_RDONLY/O_WRONLY/O_RDWRï¼‰å’Œå¯é€‰æ ‡å¿—ï¼ˆO_CREATã€O_EXCLã€O_APPENDã€O_TRUNC ç­‰ï¼‰ã€‚\nmodeï¼šå½“ä½¿ç”¨ O_CREAT æ ‡å¿—æ—¶éœ€æŒ‡å®šæƒé™ã€‚åˆ›å»ºæ–‡ä»¶æ—¶çš„æƒé™ï¼ˆå¦‚ 0644ï¼‰ã€‚\n\n\n\nè¿”å›å€¼ï¼šæ–‡ä»¶æè¿°ç¬¦ï¼ˆæ•´æ•°ï¼‰æˆ– -1ï¼ˆå¤±è´¥ï¼‰ã€‚\n\n\nç‰¹ç‚¹ï¼šæ— ç¼“å†²çš„åº•å±‚æ“ä½œï¼Œé€‚åˆè®¾å¤‡é©±åŠ¨ã€éé˜»å¡ I/O ç­‰åœºæ™¯ã€‚\n\n\n2. å…³é”®æ ‡å¿—ä½\n\n\n\næ ‡å¿—\nåŠŸèƒ½æè¿°\n\n\n\n\nO_CREAT\næ–‡ä»¶ä¸å­˜åœ¨æ—¶åˆ›å»º\n\n\nO_EXCL\nä¸ O_CREAT è”ç”¨ï¼Œæ–‡ä»¶å­˜åœ¨åˆ™æŠ¥é”™\n\n\nO_TRUNC\næ‰“å¼€æ—¶æˆªæ–­æ–‡ä»¶\n\n\nO_APPEND\nè¿½åŠ æ¨¡å¼\n\n\nO_NONBLOCK\néé˜»å¡æ¨¡å¼\n\n\n\n3. é”™è¯¯å¤„ç†\nopen() å¤±è´¥æ—¶ä¼šè®¾ç½® errnoï¼Œå¸¸è§é”™è¯¯ç ï¼š\n\n\nENOENTï¼šè·¯å¾„ä¸å­˜åœ¨ï¼ˆæ—  O_CREAT æ ‡å¿—æ—¶ï¼‰ã€‚\n\n\nEACCESï¼šæƒé™ä¸è¶³ï¼ˆå¦‚å°è¯•å†™å…¥åªè¯»æ–‡ä»¶ï¼‰ã€‚\n\n\nEEXISTï¼šæ–‡ä»¶å·²å­˜åœ¨ï¼ˆä½¿ç”¨ O_CREAT | O_EXCL æ—¶ï¼‰ã€‚\n\n\nEISDIRï¼šè·¯å¾„æ˜¯ç›®å½•è€Œéæ–‡ä»¶ã€‚\n\n\n4. ç›¸å…³ç³»ç»Ÿè°ƒç”¨\n\n\nclose(int fd)ï¼šå…³é—­æ–‡ä»¶æè¿°ç¬¦ã€‚\n\n\nread(int fd, void *buf, size_t count)ï¼šä»æ–‡ä»¶è¯»å–æ•°æ®ã€‚\n\n\nwrite(int fd, const void *buf, size_t count)ï¼šå‘æ–‡ä»¶å†™å…¥æ•°æ®ã€‚\n\n\nlseek(int fd, off_t offset, int whence)ï¼šç§»åŠ¨æ–‡ä»¶è¯»å†™ä½ç½®ã€‚\n\n\ncreat(const char *pathname, mode_t mode)ï¼šç­‰ä»·äº open(pathname, O_CREAT | O_WRONLY | O_TRUNC, mode)ã€‚\n\n\n#include &lt;fcntl.h&gt;#include &lt;unistd.h&gt;#include &lt;stdio.h&gt;#include &lt;stdlib.h&gt;int main() &#123;    // æ‰“å¼€æ–‡ä»¶ï¼ˆä¸å­˜åœ¨åˆ™åˆ›å»ºï¼Œå­˜åœ¨åˆ™æˆªæ–­ï¼‰    int fd = open(&quot;test.txt&quot;, O_RDWR | O_CREAT | O_TRUNC, 0644);    if (fd == -1) &#123;        perror(&quot;open failed&quot;);        return EXIT_FAILURE;    &#125;    // å†™å…¥æ•°æ®    const char *data = &quot;Hello, open()!\\n&quot;;    ssize_t bytes_written = write(fd, data, strlen(data));    if (bytes_written == -1) &#123;        perror(&quot;write failed&quot;);        close(fd);        return EXIT_FAILURE;    &#125;    // ç§»åŠ¨æ–‡ä»¶æŒ‡é’ˆåˆ°å¼€å¤´    if (lseek(fd, 0, SEEK_SET) == -1) &#123;        perror(&quot;lseek failed&quot;);        close(fd);        return EXIT_FAILURE;    &#125;    // è¯»å–æ•°æ®    char buffer[100];    ssize_t bytes_read = read(fd, buffer, sizeof(buffer) - 1);    if (bytes_read == -1) &#123;        perror(&quot;read failed&quot;);        close(fd);        return EXIT_FAILURE;    &#125;    buffer[bytes_read] = &#x27;\\0&#x27;;  // ç¡®ä¿å­—ç¬¦ä¸²ä»¥ &#x27;\\0&#x27; ç»“å°¾    printf(&quot;Read: %s&quot;, buffer);    close(fd);  // å…³é—­æ–‡ä»¶æè¿°ç¬¦    return 0;&#125;\näºŒã€C++ æ ‡å‡†åº“ä¸­çš„æ–‡ä»¶æ“ä½œ\nC++ æä¾›äº†æ›´é«˜çº§çš„æ–‡ä»¶æµç±»ï¼ŒåŸºäºå¯¹è±¡å’Œå¼‚å¸¸å¤„ç†ï¼Œé¿å…äº†ç›´æ¥ä½¿ç”¨ç³»ç»Ÿè°ƒç”¨çš„å¤æ‚æ€§ã€‚\n1. &lt;fstream&gt; åº“ï¼ˆæ¨èæ–¹æ¡ˆï¼‰\n\n\nä¸»è¦ç±»\n\nstd::ifstreamï¼šè¾“å…¥æ–‡ä»¶æµï¼ˆåªè¯»ï¼‰ã€‚\nstd::ofstreamï¼šè¾“å‡ºæ–‡ä»¶æµï¼ˆåªå†™ï¼‰ã€‚\nstd::fstreamï¼šè¾“å…¥ / è¾“å‡ºæ–‡ä»¶æµï¼ˆè¯»å†™ï¼‰ã€‚\n\n\n\nç¤ºä¾‹ï¼šæ‰“å¼€æ–‡ä»¶å¹¶è¯»å†™\n#include &lt;fstream&gt;#include &lt;iostream&gt;#include &lt;string&gt;int main() &#123;    // æ‰“å¼€æ–‡ä»¶ï¼ˆä¸å­˜åœ¨åˆ™åˆ›å»ºï¼Œå­˜åœ¨åˆ™æˆªæ–­ï¼‰    std::ofstream outfile(&quot;test.txt&quot;, std::ios::out | std::ios::trunc);    if (!outfile.is_open()) &#123;        std::cerr &lt;&lt; &quot;Failed to open file!&quot; &lt;&lt; std::endl;        return 1;    &#125;    // å†™å…¥æ•°æ®    outfile &lt;&lt; &quot;Hello, C++ file stream!&quot; &lt;&lt; std::endl;    outfile.close();    // è¯»å–æ–‡ä»¶    std::ifstream infile(&quot;test.txt&quot;);    std::string line;    if (infile.is_open()) &#123;        while (std::getline(infile, line)) &#123;            std::cout &lt;&lt; &quot;Read: &quot; &lt;&lt; line &lt;&lt; std::endl;        &#125;        infile.close();    &#125;    return 0;&#125;\n2. æ–‡ä»¶æ‰“å¼€æ¨¡å¼ï¼ˆstd::ios_base::openmodeï¼‰\n\n\n\næ¨¡å¼\nåŠŸèƒ½æè¿°\n\n\n\n\nstd::ios::in\nè¾“å…¥æ¨¡å¼ï¼ˆè¯»å–ï¼‰\n\n\nstd::ios::out\nè¾“å‡ºæ¨¡å¼ï¼ˆå†™å…¥ï¼Œé»˜è®¤æˆªæ–­æ–‡ä»¶ï¼‰\n\n\nstd::ios::app\nè¿½åŠ æ¨¡å¼ï¼ˆå†™å…¥åˆ°æ–‡ä»¶æœ«å°¾ï¼‰\n\n\nstd::ios::ate\næ‰“å¼€åå®šä½åˆ°æ–‡ä»¶æœ«å°¾\n\n\nstd::ios::trunc\næ‰“å¼€æ—¶æˆªæ–­æ–‡ä»¶ï¼ˆè‹¥å·²å­˜åœ¨ï¼‰\n\n\nstd::ios::binary\näºŒè¿›åˆ¶æ¨¡å¼ï¼ˆé¿å…æ–‡æœ¬æ¨¡å¼è½¬æ¢ï¼‰\n\n\n\nä¸‰ã€C++17 åŠä»¥åçš„æ–‡ä»¶ç³»ç»Ÿåº“ï¼ˆ&lt;filesystem&gt;ï¼‰\nC++17 å¼•å…¥äº†æ›´ç°ä»£åŒ–çš„æ–‡ä»¶ç³»ç»Ÿæ“ä½œ APIï¼Œæä¾›è·¯å¾„å¤„ç†ã€æ–‡ä»¶çŠ¶æ€æ£€æŸ¥ç­‰åŠŸèƒ½ã€‚\n1. æ–‡ä»¶æ“ä½œç¤ºä¾‹\n#include &lt;filesystem&gt;#include &lt;fstream&gt;#include &lt;iostream&gt;namespace fs = std::filesystem;int main() &#123;    fs::path filePath = &quot;test.txt&quot;;    // åˆ›å»ºæ–‡ä»¶å¹¶å†™å…¥    if (std::ofstream file(filePath); file.is_open()) &#123;        file &lt;&lt; &quot;Hello, C++17 filesystem!&quot;;        file.close();    &#125;    // æ£€æŸ¥æ–‡ä»¶çŠ¶æ€    if (fs::exists(filePath)) &#123;        std::cout &lt;&lt; &quot;File size: &quot; &lt;&lt; fs::file_size(filePath) &lt;&lt; &quot; bytes&quot; &lt;&lt; std::endl;        fs::remove(filePath);  // åˆ é™¤æ–‡ä»¶    &#125;    return 0;&#125;\n2. ä¼˜åŠ¿\n\n\nè·¨å¹³å°ï¼šè‡ªåŠ¨å¤„ç†ä¸åŒæ“ä½œç³»ç»Ÿçš„è·¯å¾„åˆ†éš”ç¬¦ï¼ˆå¦‚ / å’Œ \\ï¼‰ã€‚\n\n\nå¼‚å¸¸å®‰å…¨ï¼šä½¿ç”¨ RAII ç®¡ç†èµ„æºï¼Œé¿å…æ‰‹åŠ¨å…³é—­æ–‡ä»¶ã€‚\n\n\nåŠŸèƒ½ä¸°å¯Œï¼šæ”¯æŒæ–‡ä»¶éå†ã€æƒé™ç®¡ç†ã€ç¡¬é“¾æ¥æ“ä½œç­‰ã€‚\n\n\n","categories":["ç¼–ç¨‹"],"tags":["C++","Linux"]},{"title":"linuxç®¡é“(pipe)ç³»ç»Ÿè°ƒç”¨","url":"/2025/07/12/linux/pipe()%E7%B3%BB%E7%BB%9F%E8%B0%83%E7%94%A8/","content":"å¦‚ä½•ä½¿ç”¨ C++ åœ¨ Linux ç¯å¢ƒä¸‹è¿›è¡Œç®¡é“(pipe)ç³»ç»Ÿè°ƒç”¨\n \npipe() ç³»ç»Ÿè°ƒç”¨\nåœ¨ Linux ç³»ç»Ÿç¼–ç¨‹ä¸­ï¼Œpipe() æ˜¯ä¸€ä¸ªç³»ç»Ÿè°ƒç”¨ï¼Œç”¨äºåˆ›å»ºä¸€ä¸ªåŒ¿åç®¡é“ï¼Œå®ç°åŒä¸€è¿›ç¨‹æˆ–çˆ¶å­è¿›ç¨‹é—´çš„å•å‘é€šä¿¡ã€‚ç®¡é“æœ‰ä¸¤ä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼šä¸€ä¸ªç”¨äºè¯»å–ï¼ˆè¯»ç«¯ï¼‰ï¼Œä¸€ä¸ªç”¨äºå†™å…¥ï¼ˆå†™ç«¯ï¼‰ã€‚\npipe() å‡½æ•°åŸå‹\n#include &lt;unistd.h&gt;int pipe(int pipefd[2]);\n\n\npipefdæ˜¯ä¸€ä¸ªåŒ…å«ä¸¤ä¸ªæ•´æ•°çš„æ•°ç»„ï¼Œç”¨äºå­˜å‚¨ç®¡é“çš„æ–‡ä»¶æè¿°ç¬¦\n\npipefd[0]ï¼šç®¡é“çš„è¯»ç«¯ï¼Œç”¨äºè¯»å–æ•°æ®\npipefd[1]ï¼šç®¡é“çš„å†™ç«¯ï¼Œç”¨äºå†™å…¥æ•°æ®\n\n\n\nè¿”å›å€¼ï¼šæˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1 å¹¶è®¾ç½® errno\n\n\nä½¿ç”¨æ­¥éª¤\n\n\nåˆ›å»ºç®¡é“ï¼šè°ƒç”¨ pipe() å‡½æ•°\n\n\nåˆ›å»ºå­è¿›ç¨‹ï¼šä½¿ç”¨ fork() åˆ›å»ºå­è¿›ç¨‹ï¼ˆç®¡é“é€šå¸¸ç”¨äºçˆ¶å­è¿›ç¨‹é—´é€šä¿¡ï¼‰\n\n\nå…³é—­ä¸éœ€è¦çš„ç«¯ï¼š\n\nçˆ¶è¿›ç¨‹å…³é—­è¯»ç«¯ï¼ˆpipefd[0]ï¼‰ï¼Œåªå†™\nå­è¿›ç¨‹å…³é—­å†™ç«¯ï¼ˆpipefd[1]ï¼‰ï¼Œåªè¯»ï¼ˆæˆ–æ ¹æ®éœ€æ±‚è°ƒæ•´ï¼Œå¦‚çˆ¶è¿›ç¨‹è¯»ã€å­è¿›ç¨‹å†™ï¼‰\n\n\n\né€šä¿¡ï¼šé€šè¿‡ write() å†™å…¥æ•°æ®ï¼Œread() è¯»å–æ•°æ®\n\n\nå…³é—­ç®¡é“ï¼šé€šä¿¡å®Œæˆåå…³é—­æ‰€æœ‰æ–‡ä»¶æè¿°ç¬¦\n\n\nç¤ºä¾‹ä»£ç \n#include &lt;iostream&gt;#include &lt;cstdlib&gt;#include &lt;unistd.h&gt;#include &lt;cstring&gt;#include &lt;sys/wait.h&gt;#include &lt;string&gt;int main() &#123;    int pipefd[2];    pid_t pid;    char buf[1024];    // 1. åˆ›å»ºç®¡é“    if (pipe(pipefd) == -1) &#123;        std::cerr &lt;&lt; &quot;ç®¡é“åˆ›å»ºå¤±è´¥: &quot; &lt;&lt; std::strerror(errno) &lt;&lt; std::endl;        std::exit(EXIT_FAILURE);    &#125;    // 2. åˆ›å»ºå­è¿›ç¨‹    pid = fork();    if (pid == -1) &#123;        std::cerr &lt;&lt; &quot;è¿›ç¨‹åˆ›å»ºå¤±è´¥: &quot; &lt;&lt; std::strerror(errno) &lt;&lt; std::endl;        std::exit(EXIT_FAILURE);    &#125;    if (pid == 0) &#123;  // å­è¿›ç¨‹ï¼šè¯»æ•°æ®        // 3. å…³é—­å­è¿›ç¨‹ä¸éœ€è¦çš„å†™ç«¯        close(pipefd[1]);        // 4. ä»ç®¡é“è¯»å–æ•°æ®        ssize_t n = read(pipefd[0], buf, sizeof(buf) - 1);        if (n == -1) &#123;            std::cerr &lt;&lt; &quot;è¯»å–å¤±è´¥: &quot; &lt;&lt; std::strerror(errno) &lt;&lt; std::endl;            std::exit(EXIT_FAILURE);        &#125;        buf[n] = &#x27;\\0&#x27;;  // æ·»åŠ å­—ç¬¦ä¸²ç»“æŸç¬¦        std::cout &lt;&lt; &quot;å­è¿›ç¨‹æ”¶åˆ°: &quot; &lt;&lt; buf &lt;&lt; std::endl;        // 5. å…³é—­è¯»ç«¯        close(pipefd[0]);        std::exit(EXIT_SUCCESS);    &#125; else &#123;  // çˆ¶è¿›ç¨‹ï¼šå†™æ•°æ®        // 3. å…³é—­çˆ¶è¿›ç¨‹ä¸éœ€è¦çš„è¯»ç«¯        close(pipefd[0]);        // 4. å‘ç®¡é“å†™å…¥æ•°æ®        std::string msg = &quot;Hello from parent!&quot;;        if (write(pipefd[1], msg.c_str(), msg.length()) == -1) &#123;            std::cerr &lt;&lt; &quot;å†™å…¥å¤±è´¥: &quot; &lt;&lt; std::strerror(errno) &lt;&lt; std::endl;            std::exit(EXIT_FAILURE);        &#125;        // 5. å…³é—­å†™ç«¯ï¼ˆè§¦å‘å­è¿›ç¨‹çš„read()è¿”å›0ï¼‰        close(pipefd[1]);        // ç­‰å¾…å­è¿›ç¨‹ç»“æŸ        wait(NULL);        std::exit(EXIT_SUCCESS);    &#125;&#125;\nä»£ç è¯´æ˜\n\n\nç®¡é“åˆ›å»ºï¼špipe(pipefd) æˆåŠŸåï¼Œpipefd[0] å’Œ pipefd[1] åˆ†åˆ«ä»£è¡¨è¯»ç«¯å’Œå†™ç«¯\n\n\nè¿›ç¨‹é€šä¿¡\n\nçˆ¶è¿›ç¨‹é€šè¿‡ write(pipefd[1], ...) å‘ç®¡é“å†™å…¥æ•°æ®\nå­è¿›ç¨‹é€šè¿‡ read(pipefd[0], ...) ä»ç®¡é“è¯»å–æ•°æ®\n\n\n\nå…³é—­ç«¯çš„é‡è¦æ€§\n\nä¸ä½¿ç”¨çš„ç«¯å¿…é¡»å…³é—­ï¼Œå¦åˆ™å¯èƒ½å¯¼è‡´ read() é˜»å¡ï¼ˆç­‰å¾…æ•°æ®ï¼‰\næ‰€æœ‰å†™ç«¯å…³é—­åï¼Œread() ä¼šè¿”å› 0ï¼ˆè¡¨ç¤ºæ•°æ®ç»“æŸï¼‰\n\n\n\nå•å‘æ€§ï¼šç®¡é“æ˜¯å•å‘çš„ï¼Œæ•°æ®åªèƒ½ä»å†™ç«¯æµå‘è¯»ç«¯\n\n\næ ¸å¿ƒåŸåˆ™ï¼šæŒ‰éœ€ä¿ç•™ï¼ŒåŠæ—¶å…³é—­ï¼Œå…¨é‡æ¸…ç†\n\n\nâ€œå…ˆå…³é—­ï¼Œåé€šä¿¡â€ çš„åŸåˆ™ï¼šè¿›ç¨‹åˆ›å»ºåï¼ˆå¦‚ fork() åï¼‰ï¼Œåº”ç«‹å³å…³é—­ä¸éœ€è¦çš„ç«¯ï¼Œå†è¿›è¡Œè¯»å†™æ“ä½œã€‚ä¾‹å¦‚ï¼š\n\nçˆ¶è¿›ç¨‹è‹¥è´Ÿè´£å†™æ•°æ®ï¼Œåº”å…ˆå…³é—­è¯»ç«¯ï¼ˆpipefd[0]ï¼‰ï¼Œä»…ä¿ç•™å†™ç«¯ï¼ˆpipefd[1]ï¼‰ï¼›\nå­è¿›ç¨‹è‹¥è´Ÿè´£è¯»æ•°æ®ï¼Œåº”å…ˆå…³é—­å†™ç«¯ï¼ˆpipefd[1]ï¼‰ï¼Œä»…ä¿ç•™è¯»ç«¯ï¼ˆpipefd[0]ï¼‰ã€‚é¿å…å›  â€œæœªåŠæ—¶å…³é—­â€ å¯¼è‡´çš„æ„å¤–æ•°æ®äº¤äº’ï¼ˆå¦‚å­è¿›ç¨‹è¯¯å†™æ•°æ®åˆ°æœ¬åº”å…³é—­çš„å†™ç«¯ï¼‰ã€‚\n\n\n\nå†™ç«¯å…³é—­çš„ â€œè§¦å‘ä¿¡å·â€ ä½œç”¨ï¼šå†™ç«¯å®Œæˆæ•°æ®å‘é€åï¼Œå¿…é¡»ä¸»åŠ¨å…³é—­å†™ç«¯ï¼Œè¿™æ˜¯å‘ŠçŸ¥è¯»ç«¯ â€œæ•°æ®å·²å‘é€å®Œæ¯•â€ çš„å”¯ä¸€æ–¹å¼ã€‚è¯»ç«¯é€šè¿‡ read() è¿”å› 0 æ„ŸçŸ¥ â€œæ‰€æœ‰å†™ç«¯å·²å…³é—­â€ï¼Œä»è€Œæ­£å¸¸é€€å‡ºè¯»å–é€»è¾‘ã€‚\n\nåä¾‹ï¼šè‹¥çˆ¶è¿›ç¨‹å†™å®Œæ•°æ®åæœªå…³é—­å†™ç«¯ï¼Œå­è¿›ç¨‹çš„ read() ä¼šä¸€ç›´é˜»å¡ï¼ˆç­‰å¾…æ›´å¤šæ•°æ®ï¼‰ï¼Œå¯¼è‡´å­è¿›ç¨‹æ— æ³•é€€å‡ºã€‚\n\n\n\nå¤šè¿›ç¨‹åä½œæ—¶çš„ â€œå…¨å…³é—­â€ æ£€æŸ¥ï¼šè‹¥å¤šä¸ªè¿›ç¨‹å…±äº«åŒä¸€ç®¡é“çš„å†™ç«¯ï¼ˆå¦‚çˆ¶è¿›ç¨‹å’Œå¤šä¸ªå­è¿›ç¨‹éƒ½å‘ç®¡é“å†™æ•°æ®ï¼‰ï¼Œå¿…é¡»ç¡®ä¿æ‰€æœ‰å†™ç«¯éƒ½å…³é—­åï¼Œè¯»ç«¯æ‰èƒ½æ”¶åˆ° EOFï¼ˆread() è¿”å› 0ï¼‰ã€‚\n\néœ€é€šè¿‡è¿›ç¨‹åŒæ­¥ï¼ˆå¦‚ waitpidï¼‰ç¡®ä¿æ‰€æœ‰å†™è¿›ç¨‹éƒ½å·²å…³é—­å†™ç«¯ï¼Œé¿å…è¯»ç«¯æå‰é€€å‡ºæˆ–é˜»å¡ã€‚\n\n\n\n","categories":["ç¼–ç¨‹"],"tags":["C++","Linux"]},{"title":"åˆ†æ•£ / èšé›† IO","url":"/2025/07/29/linux/%E5%88%86%E6%95%A3%20%20%E8%81%9A%E9%9B%86%20IO/","content":"ç½‘ç»œç¼–ç¨‹ä¸­å¸¸ç”¨çš„åˆ†æ•£ / èšé›† IO æŠ€æœ¯\n \n1. readv ä¸ writevï¼šåˆ†æ•£ / èšé›† I/O\nreadvï¼ˆåˆ†æ•£è¯»ï¼‰å’Œ writevï¼ˆèšé›†å†™ï¼‰æ˜¯ç”¨äºå¤„ç†åˆ†æ•£ç¼“å†²åŒºçš„ I/O å‡½æ•°ï¼Œæ ¸å¿ƒä½œç”¨æ˜¯é€šè¿‡ä¸€æ¬¡ç³»ç»Ÿè°ƒç”¨å®Œæˆå¯¹å¤šä¸ªä¸è¿ç»­ç¼“å†²åŒºçš„è¯»å†™æ“ä½œï¼Œå‡å°‘ç³»ç»Ÿè°ƒç”¨æ¬¡æ•°ï¼ˆç³»ç»Ÿè°ƒç”¨å­˜åœ¨ä¸Šä¸‹æ–‡åˆ‡æ¢å¼€é”€ï¼‰ã€‚\nå‡½æ•°åŸå‹\n#include &lt;sys/uio.h&gt;// ä»fdè¯»å–æ•°æ®ï¼Œåˆ†æ•£å­˜å‚¨åˆ°iovæŒ‡å‘çš„å¤šä¸ªç¼“å†²åŒºssize_t readv(int fd, const struct iovec *iov, int iovcnt);// å°†iovæŒ‡å‘çš„å¤šä¸ªç¼“å†²åŒºæ•°æ®èšé›†åå†™å…¥fdssize_t writev(int fd, const struct iovec *iov, int iovcnt);\nå…³é”®å‚æ•°\n\n\nstruct iovecæè¿°ä¸€ä¸ªç¼“å†²åŒºçš„ç»“æ„ï¼Œå®šä¹‰ä¸ºï¼š\nstruct iovec &#123;    void  *iov_base;  // ç¼“å†²åŒºèµ·å§‹åœ°å€    size_t iov_len;   // ç¼“å†²åŒºé•¿åº¦ï¼ˆå­—èŠ‚æ•°ï¼‰&#125;;\n\n\niovcntï¼šç¼“å†²åŒºæ•°é‡ï¼Œä¸Šé™ç”±ç³»ç»Ÿé™åˆ¶ï¼ˆé€šå¸¸IOV_MAXï¼Œå¦‚ Linux ä¸º 1024ï¼‰ã€‚\n\n\nåŠŸèƒ½ä¸é€‚ç”¨åœºæ™¯\n\n\nreadvï¼šä»æ–‡ä»¶æè¿°ç¬¦fdè¯»å–æ•°æ®ï¼ŒæŒ‰é¡ºåºå¡«å……iovæ•°ç»„ä¸­çš„ç¼“å†²åŒºï¼ˆå‰ä¸€ä¸ªå¡«æ»¡åå†å¡«ä¸‹ä¸€ä¸ªï¼‰ï¼Œè¿”å›å®é™…è¯»å–çš„å­—èŠ‚æ•°ã€‚\n\n\nwritevï¼šå°†iovæ•°ç»„ä¸­æ‰€æœ‰ç¼“å†²åŒºçš„æ•°æ®æŒ‰é¡ºåºæ‹¼æ¥åå†™å…¥fdï¼Œè¿”å›å®é™…å†™å…¥çš„å­—èŠ‚æ•°ã€‚\n\n\nç½‘ç»œç¼–ç¨‹åœºæ™¯ï¼šåœ¨æ„é€ åè®®æŠ¥æ–‡æ—¶ï¼ˆå¦‚ HTTP å“åº”åŒ…å«çŠ¶æ€è¡Œã€å¤´éƒ¨å­—æ®µã€æ­£æ–‡ç­‰å¤šä¸ªç‹¬ç«‹éƒ¨åˆ†ï¼‰ï¼Œå¯é€šè¿‡writevä¸€æ¬¡å‘é€æ‰€æœ‰éƒ¨åˆ†ï¼Œé¿å…å¤šæ¬¡writeè°ƒç”¨çš„å¼€é”€ï¼›åŒç†ï¼Œæ¥æ”¶æŠ¥æ–‡æ—¶è‹¥éœ€æ‹†åˆ†åˆ°ä¸åŒç¼“å†²åŒºï¼ˆå¦‚å¤´éƒ¨å’Œæ­£æ–‡åˆ†ç¦»ï¼‰ï¼Œå¯ä½¿ç”¨readvã€‚\næ³¨æ„äº‹é¡¹\n\n\nè‹¥è¯»å– / å†™å…¥ä¸­é€”å‘ç”Ÿé”™è¯¯ï¼Œä»ä¼šè¿”å›å·²æˆåŠŸå¤„ç†çš„å­—èŠ‚æ•°ï¼ˆéƒ¨åˆ†æˆåŠŸï¼‰ã€‚\n\n\nå¯¹äºéé˜»å¡fdï¼Œè¡Œä¸ºä¸read/writeä¸€è‡´ï¼ˆå¯èƒ½è¿”å›EAGAINæˆ–EWOULDBLOCKï¼‰ã€‚\n\n\n2. dup ä¸ dup2ï¼šæ–‡ä»¶æè¿°ç¬¦å¤åˆ¶\ndup å’Œ dup2 ç”¨äºå¤åˆ¶æ–‡ä»¶æè¿°ç¬¦ï¼Œä½¿æ–°çš„æè¿°ç¬¦ä¸åŸæè¿°ç¬¦æŒ‡å‘åŒä¸€ä¸ªæ–‡ä»¶è¡¨é¡¹ï¼ˆå…±äº«æ–‡ä»¶åç§»é‡ã€æ–‡ä»¶çŠ¶æ€æ ‡å¿—ç­‰ï¼‰ï¼Œæ ¸å¿ƒä½œç”¨æ˜¯å®ç° I/O é‡å®šå‘ã€‚\nå‡½æ•°åŸå‹\n#include &lt;unistd.h&gt;// å¤åˆ¶oldfdï¼Œè¿”å›æœ€å°çš„æœªä½¿ç”¨æè¿°ç¬¦int dup(int oldfd);// å°†newfdé‡å®šå‘ä¸ºoldfdçš„å‰¯æœ¬ï¼ˆè‹¥newfdå·²æ‰“å¼€åˆ™å…ˆå…³é—­ï¼‰int dup2(int oldfd, int newfd);\nåŠŸèƒ½å·®å¼‚\n\n\ndupï¼šè‡ªåŠ¨é€‰æ‹©ä¸€ä¸ªæœ€å°çš„æœªè¢«ä½¿ç”¨çš„æè¿°ç¬¦ä½œä¸ºæ–°æè¿°ç¬¦ï¼Œä¸oldfdæŒ‡å‘åŒä¸€æ–‡ä»¶ã€‚\n\n\ndup2ï¼šæ˜¾å¼æŒ‡å®šæ–°æè¿°ç¬¦newfdï¼Œè‹¥newfdå·²æ‰“å¼€ï¼Œåˆ™å…ˆå…³é—­å®ƒï¼ˆè‹¥newfd == oldfdï¼Œåˆ™ç›´æ¥è¿”å›newfdï¼Œä¸å…³é—­ï¼‰ã€‚\n\n\nç½‘ç»œç¼–ç¨‹åœºæ™¯\n\n\né‡å®šå‘æ ‡å‡† I/Oï¼šä¾‹å¦‚åœ¨ç½‘ç»œæœåŠ¡ä¸­ï¼Œå°†å®¢æˆ·ç«¯socketçš„æè¿°ç¬¦é€šè¿‡dup2(client_fd, STDOUT_FILENO)é‡å®šå‘ä¸ºæ ‡å‡†è¾“å‡ºï¼Œæ­¤æ—¶printfçš„å†…å®¹ä¼šç›´æ¥å‘é€ç»™å®¢æˆ·ç«¯ã€‚\n\n\nç®€åŒ–æ¥å£é€‚é…ï¼šæŸäº›åº“å‡½æ•°ä»…æ”¯æŒå›ºå®šæè¿°ç¬¦ï¼ˆå¦‚æ ‡å‡†è¾“å‡ºï¼‰ï¼Œé€šè¿‡dup2å¯å°†å…¶é€‚é…åˆ° socket æè¿°ç¬¦ã€‚\n\n\næ³¨æ„äº‹é¡¹\n\n\nè‹¥oldfdæ— æ•ˆï¼ˆæœªæ‰“å¼€ï¼‰ï¼Œä¸¤å‡½æ•°å‡è¿”å›-1å¹¶è®¾ç½®errnoä¸ºEBADFã€‚\n\n\ndup2å…³é—­newfdæ—¶è‹¥å¤±è´¥ï¼ˆå¦‚æƒé™é—®é¢˜ï¼‰ï¼Œä¼šè¿”å›-1ï¼Œä½†æ­¤æ—¶newfdå¯èƒ½å·²å¤„äºå…³é—­çŠ¶æ€ï¼Œéœ€æ³¨æ„é”™è¯¯å¤„ç†ã€‚\n\n\n3. sendfileï¼šé›¶æ‹·è´æ–‡ä»¶ä¼ è¾“\nsendfile ç”¨äºåœ¨ä¸¤ä¸ªæ–‡ä»¶æè¿°ç¬¦ä¹‹é—´ç›´æ¥ä¼ è¾“æ•°æ®ï¼Œæ•°æ®æ— éœ€ç»è¿‡ç”¨æˆ·ç©ºé—´ï¼Œå…¨ç¨‹åœ¨å†…æ ¸ç©ºé—´å¤„ç†ï¼Œå±äºé›¶æ‹·è´ï¼ˆzero-copyï¼‰ æŠ€æœ¯ï¼Œå¯å¤§å¹…æå‡å¤§æ–‡ä»¶ä¼ è¾“æ•ˆç‡ã€‚\nå‡½æ•°åŸå‹ï¼ˆLinuxï¼‰\n#include &lt;sys/sendfile.h&gt;// å°†in_fdçš„æ•°æ®ä¼ è¾“åˆ°out_fdï¼Œè¿”å›å®é™…ä¼ è¾“çš„å­—èŠ‚æ•°ssize_t sendfile(int out_fd, int in_fd, off_t *offset, size_t count);\nå…³é”®å‚æ•°ä¸é™åˆ¶\n\n\nin_fdï¼šæºæ–‡ä»¶æè¿°ç¬¦ï¼Œå¿…é¡»æ˜¯æ”¯æŒmmapçš„å¸¸è§„æ–‡ä»¶ï¼ˆä¸èƒ½æ˜¯ socket æˆ–ç®¡é“ï¼‰ã€‚\n\n\nout_fdï¼šç›®æ ‡æ–‡ä»¶æè¿°ç¬¦ï¼Œåœ¨ Linux ä¸­å¿…é¡»æ˜¯ socketï¼ˆå…¶ä»–ç³»ç»Ÿå¯èƒ½æ”¯æŒæ›´å¤šç±»å‹ï¼‰ã€‚\n\n\noffsetï¼šæŒ‡å®šin_fdçš„èµ·å§‹è¯»å–ä½ç½®ï¼Œè‹¥ä¸ä¸ºNULLï¼Œä¼ è¾“åä¼šæ›´æ–°ä¸ºå®é™…ç»“æŸä½ç½®ï¼ˆåŸå­æ“ä½œï¼Œé¿å…å¤šçº¿ç¨‹ç«äº‰ï¼‰ã€‚\n\n\ncountï¼šè®¡åˆ’ä¼ è¾“çš„å­—èŠ‚æ•°ã€‚\n\n\nåŠŸèƒ½ä¸ä¼˜åŠ¿\nä¼ ç»Ÿæ–‡ä»¶ä¼ è¾“æµç¨‹ï¼ˆread + writeï¼‰éœ€è¦ 4 æ¬¡æ•°æ®æ‹·è´ï¼ˆç£ç›˜â†’å†…æ ¸ç¼“å†²åŒºâ†’ç”¨æˆ·ç¼“å†²åŒºâ†’socket ç¼“å†²åŒºâ†’ç½‘å¡ï¼‰å’Œ 2 æ¬¡ç³»ç»Ÿè°ƒç”¨ï¼›è€Œsendfileé€šè¿‡å†…æ ¸ç›´æ¥å°†æ–‡ä»¶æ•°æ®ä»é¡µç¼“å­˜ä¼ è¾“åˆ° socket ç¼“å†²åŒºï¼Œä»…éœ€ 2 æ¬¡æ‹·è´ï¼ˆç£ç›˜â†’å†…æ ¸ç¼“å†²åŒºâ†’socket ç¼“å†²åŒºï¼‰å’Œ 1 æ¬¡ç³»ç»Ÿè°ƒç”¨ï¼Œæ˜¾è‘—å‡å°‘å¼€é”€ã€‚\nç½‘ç»œç¼–ç¨‹åœºæ™¯ï¼šåœ¨æ–‡ä»¶æœåŠ¡å™¨ä¸­ï¼ˆå¦‚ HTTP æœåŠ¡å™¨ä¼ è¾“é™æ€èµ„æºï¼‰ï¼Œsendfileæ˜¯é«˜æ•ˆä¼ è¾“æ–‡ä»¶çš„é¦–é€‰æ–¹å¼ï¼Œæ¯”read + writeç»„åˆæ€§èƒ½æå‡æ˜æ˜¾ã€‚\næ³¨æ„äº‹é¡¹\n\n\nè·¨å¹³å°å·®å¼‚å¤§ï¼šLinux çš„sendfileä¸ BSD çš„sendfileå‚æ•°å’Œè¡Œä¸ºä¸åŒï¼Œç§»æ¤æ—¶éœ€æ³¨æ„ã€‚\n\n\nä¸æ”¯æŒéé˜»å¡ I/Oï¼šè‹¥out_fdä¸ºéé˜»å¡ socket ä¸”æš‚æ—¶æ— æ³•å†™å…¥ï¼Œsendfileå¯èƒ½è¿”å›-1å¹¶è®¾ç½®errnoä¸ºEAGAINï¼Œä½†éƒ¨åˆ†å®ç°å¯èƒ½ä¸æ”¯æŒã€‚\n\n\nin_fdå¿…é¡»æ˜¯å¸¸è§„æ–‡ä»¶ï¼šä¸èƒ½ç”¨äº socket ä¹‹é—´çš„æ•°æ®è½¬å‘ï¼ˆéœ€ç”¨spliceç­‰å…¶ä»–å‡½æ•°ï¼‰ã€‚\n\n\næ€»ç»“\n\n\nreadv/writevï¼šä¼˜åŒ–å¤šç¼“å†²åŒº I/Oï¼Œå‡å°‘ç³»ç»Ÿè°ƒç”¨æ¬¡æ•°ï¼Œé€‚åˆåè®®æŠ¥æ–‡çš„æ‹¼æ¥ / æ‹†åˆ†ã€‚\n\n\ndup/dup2ï¼šå®ç°æ–‡ä»¶æè¿°ç¬¦é‡å®šå‘ï¼Œç®€åŒ– I/O æ¥å£é€‚é…ã€‚\n\n\nsendfileï¼šåˆ©ç”¨é›¶æ‹·è´æŠ€æœ¯é«˜æ•ˆä¼ è¾“æ–‡ä»¶ï¼Œæ˜¯å¤§æ–‡ä»¶ç½‘ç»œä¼ è¾“çš„æ ¸å¿ƒä¼˜åŒ–æ‰‹æ®µã€‚\n\n\n","categories":["ç¼–ç¨‹"],"tags":["C++","Linux"]},{"title":"å¸¸ç”¨å¥—æ¥å­—å‡½æ•°åŸå‹åŠè¯´æ˜","url":"/2025/08/15/linux/%E5%B8%B8%E7%94%A8%E5%A5%97%E6%8E%A5%E5%AD%97%E5%87%BD%E6%95%B0%E5%8E%9F%E5%9E%8B%E5%8F%8A%E8%AF%B4%E6%98%8E/","content":"æ­£å‘å’Œåå‘è·å–ä¸»æœºå’ŒæœåŠ¡ä¿¡æ¯çš„å‡½æ•°ï¼Œä»¥åŠå¥—æ¥å­—é€‰é¡¹è®¾ç½®å’Œè·å–çš„å‡½æ•°åŸå‹åŠè¯´æ˜ã€‚\n \nä¸€ã€æ—©æœŸå¥—æ¥å­—å‡½æ•°åŸå‹åŠè¯´æ˜\n\n[!NOTE]\nä»¥ä¸‹ä»…æ”¯æŒè§£æIPv4 ä¸” ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„\n\n\n\ngetsockname\nåŠŸèƒ½ï¼šè·å–å¥—æ¥å­—æœ¬åœ°ç«¯çš„åœ°å€ä¿¡æ¯åŸå‹ï¼š\n#include &lt;sys/socket.h&gt;int getsockname(int sockfd, struct sockaddr *addr, socklen_t *addrlen);\nè¯´æ˜ï¼šsockfdä¸ºå¥—æ¥å­—æè¿°ç¬¦ï¼Œaddrç”¨äºå­˜å‚¨æœ¬åœ°åœ°å€ï¼Œaddrlenä¼ å…¥åœ°å€ç»“æ„ä½“é•¿åº¦ï¼Œä¼ å‡ºå®é™…é•¿åº¦ã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› - 1ï¼ˆè®¾ç½®errnoï¼‰ã€‚\n\n\ngetpeername\nåŠŸèƒ½ï¼šè·å–å¥—æ¥å­—å¯¹ç«¯çš„åœ°å€ä¿¡æ¯åŸå‹ï¼š\n#include &lt;sys/socket.h&gt;int getpeername(int sockfd, struct sockaddr *addr, socklen_t *addrlen);\nè¯´æ˜ï¼šä»…é€‚ç”¨äºå·²è¿æ¥çš„ TCP å¥—æ¥å­—ï¼ˆconnectæˆ–acceptåï¼‰ï¼Œå‚æ•°å«ä¹‰åŒgetsocknameã€‚\n\n\ngetsockopt\nåŠŸèƒ½ï¼šè·å–å¥—æ¥å­—çš„é€‰é¡¹å€¼åŸå‹ï¼š\n#include &lt;sys/socket.h&gt;int getsockopt(int sockfd, int level, int optname, void *optval, socklen_t *optlen);\nè¯´æ˜ï¼šlevelä¸ºé€‰é¡¹çº§åˆ«ï¼ˆå¦‚SOL_SOCKETã€IPPROTO_TCPï¼‰ï¼Œoptnameä¸ºé€‰é¡¹åï¼Œoptvalå­˜å‚¨ç»“æœï¼Œoptlenä¼ å…¥ç¼“å†²åŒºé•¿åº¦å¹¶ä¼ å‡ºå®é™…ä½¿ç”¨é•¿åº¦ã€‚\n\n\nsetsockopt\nåŠŸèƒ½ï¼šè®¾ç½®å¥—æ¥å­—çš„é€‰é¡¹å€¼åŸå‹ï¼š\n#include &lt;sys/socket.h&gt;int setsockopt(int sockfd, int level, int optname, const void *optval, socklen_t optlen);\nè¯´æ˜ï¼šoptvalä¸ºå¾…è®¾ç½®çš„å€¼ï¼Œoptlenä¸ºå€¼çš„é•¿åº¦ï¼Œå…¶ä»–å‚æ•°åŒgetsockoptã€‚éƒ¨åˆ†é€‰é¡¹éœ€åœ¨bind/connectå‰è®¾ç½®ã€‚\n\n\ngethostbyname\nåŠŸèƒ½ï¼šé€šè¿‡ä¸»æœºåè·å–ä¸»æœºä¿¡æ¯ï¼ˆIPv4ï¼‰åŸå‹ï¼š\n#include &lt;netdb.h&gt;struct hostent *gethostbyname(const char *name);\nè¯´æ˜ï¼šå·²è¿‡æ—¶ï¼ˆä»…æ”¯æŒ IPv4ï¼‰ï¼Œæ¨èä½¿ç”¨getaddrinfoã€‚è¿”å›struct hostentæŒ‡é’ˆï¼Œå¤±è´¥è¿”å›NULLï¼ˆè®¾ç½®h_errnoï¼‰ã€‚\n\n\ngethostbyaddr\nåŠŸèƒ½ï¼šé€šè¿‡ IP åœ°å€è·å–ä¸»æœºåï¼ˆIPv4ï¼‰åŸå‹ï¼š\n#include &lt;netdb.h&gt;struct hostent *gethostbyaddr(const void *addr, socklen_t len, int type);\nè¯´æ˜ï¼šaddrä¸ºç½‘ç»œå­—èŠ‚åºçš„ IP åœ°å€ï¼Œlenä¸ºåœ°å€é•¿åº¦ï¼ˆå¦‚sizeof(struct in_addr)ï¼‰ï¼Œtypeä¸ºåœ°å€æ—ï¼ˆå¦‚AF_INETï¼‰ã€‚å·²è¿‡æ—¶ã€‚\n\n\ngetservbyname\nåŠŸèƒ½ï¼šé€šè¿‡æœåŠ¡åå’Œåè®®è·å–æœåŠ¡ä¿¡æ¯åŸå‹ï¼š\n#include &lt;netdb.h&gt;struct servent *getservbyname(const char *name, const char *proto);\nè¯´æ˜ï¼šnameä¸ºæœåŠ¡åï¼ˆå¦‚&quot;http&quot;ï¼‰ï¼Œprotoä¸ºåè®®ï¼ˆå¦‚&quot;tcp&quot;ï¼Œå¯ä¸ºNULLï¼‰ã€‚è¿”å›struct serventæŒ‡é’ˆï¼ŒåŒ…å«ç«¯å£å·ï¼ˆç½‘ç»œå­—èŠ‚åºï¼‰ã€‚\n\n\ngetservbyport\nåŠŸèƒ½ï¼šé€šè¿‡ç«¯å£å·å’Œåè®®è·å–æœåŠ¡ä¿¡æ¯åŸå‹ï¼š\n#include &lt;netdb.h&gt;struct servent *getservbyport(int port, const char *proto);\nè¯´æ˜ï¼športä¸ºç½‘ç»œå­—èŠ‚åºçš„ç«¯å£å·ï¼ˆéœ€ç”¨htonsè½¬æ¢ï¼‰ï¼Œå…¶ä»–å‚æ•°åŒgetservbynameã€‚\nstruct hostentï¼ˆä¸»æœºä¿¡æ¯ç»“æ„ä½“ï¼‰\nç”¨äºå­˜å‚¨ä¸»æœºçš„ç›¸å…³ä¿¡æ¯ï¼ˆå¦‚ä¸»æœºåã€IP åœ°å€åˆ—è¡¨ç­‰ï¼‰ï¼Œå®šä¹‰åœ¨&lt;netdb.h&gt;ä¸­\nstruct hostent &#123;    char  *h_name;        // ä¸»æœºçš„å®˜æ–¹åç§°ï¼ˆè§„èŒƒåï¼‰    char **h_aliases;     // ä¸»æœºçš„åˆ«ååˆ—è¡¨ï¼ˆä»¥NULLç»“å°¾çš„å­—ç¬¦ä¸²æ•°ç»„ï¼‰    int    h_addrtype;    // åœ°å€ç±»å‹ï¼ˆå¦‚AF_INETè¡¨ç¤ºIPv4ï¼ŒAF_INET6è¡¨ç¤ºIPv6ï¼‰    int    h_length;      // æ¯ä¸ªåœ°å€çš„é•¿åº¦ï¼ˆå­—èŠ‚ï¼‰ï¼Œå¦‚IPv4ä¸º4ï¼ŒIPv6ä¸º16    char **h_addr_list;   // ä¸»æœºçš„IPåœ°å€åˆ—è¡¨ï¼ˆç½‘ç»œå­—èŠ‚åºï¼Œä»¥NULLç»“å°¾çš„æŒ‡é’ˆæ•°ç»„ï¼‰&#125;;\nå­—æ®µè¯´æ˜ï¼š\n\n\nh_nameï¼šä¸»æœºçš„æ­£å¼åç§°ï¼ˆå¦‚www.example.comï¼‰ã€‚\n\n\nh_aliasesï¼šä¸»æœºçš„å…¶ä»–åˆ«åï¼ˆå¦‚example.comå¯èƒ½æ˜¯www.example.comçš„åˆ«åï¼‰ï¼Œæœ€åä¸€ä¸ªå…ƒç´ ä¸ºNULLã€‚\n\n\nh_addrtypeï¼šåœ°å€æ—ç±»å‹ï¼Œé€šå¸¸ä¸ºAF_INETï¼ˆIPv4ï¼‰ï¼Œä½†ç°ä»£ç³»ç»Ÿä¹Ÿå¯èƒ½æ”¯æŒAF_INET6ï¼ˆIPv6ï¼‰ã€‚\n\n\nh_lengthï¼šæ¯ä¸ª IP åœ°å€çš„é•¿åº¦ï¼ˆIPv4 ä¸º 4 å­—èŠ‚ï¼ŒIPv6 ä¸º 16 å­—èŠ‚ï¼‰ã€‚\n\n\nh_addr_listï¼šå­˜å‚¨ä¸»æœºçš„ IP åœ°å€æ•°ç»„ï¼ˆç½‘ç»œå­—èŠ‚åºï¼‰ï¼Œæ¯ä¸ªå…ƒç´ æ˜¯in_addrï¼ˆIPv4ï¼‰æˆ–in6_addrï¼ˆIPv6ï¼‰ç»“æ„ä½“çš„æŒ‡é’ˆã€‚ä¸ºæ–¹ä¾¿ä½¿ç”¨ï¼Œé€šå¸¸ç”¨å®h_addræŒ‡ä»£h_addr_list[0]ï¼ˆç¬¬ä¸€ä¸ª IP åœ°å€ï¼‰ã€‚\n\n\nstruct serventï¼ˆæœåŠ¡ä¿¡æ¯ç»“æ„ä½“ï¼‰\nç”¨äºå­˜å‚¨ç½‘ç»œæœåŠ¡çš„ç›¸å…³ä¿¡æ¯ï¼ˆå¦‚æœåŠ¡åã€ç«¯å£å·ã€åè®®ç­‰ï¼‰ï¼ŒåŒæ ·å®šä¹‰åœ¨&lt;netdb.h&gt;ä¸­ã€‚\nstruct servent &#123;    char  *s_name;        // æœåŠ¡çš„å®˜æ–¹åç§°ï¼ˆè§„èŒƒåï¼‰    char **s_aliases;     // æœåŠ¡çš„åˆ«ååˆ—è¡¨ï¼ˆä»¥NULLç»“å°¾çš„å­—ç¬¦ä¸²æ•°ç»„ï¼‰    int    s_port;        // æœåŠ¡å¯¹åº”çš„ç«¯å£å·ï¼ˆç½‘ç»œå­—èŠ‚åºï¼‰    char  *s_proto;       // æœåŠ¡ä½¿ç”¨çš„åè®®ï¼ˆå¦‚&quot;tcp&quot;æˆ–&quot;udp&quot;ï¼‰&#125;;\nå­—æ®µè¯´æ˜ï¼š\n\n\ns_nameï¼šæœåŠ¡çš„æ­£å¼åç§°ï¼ˆå¦‚&quot;http&quot;ã€&quot;ftp&quot;ï¼‰ã€‚\n\n\ns_aliasesï¼šæœåŠ¡çš„å…¶ä»–åˆ«åï¼ˆå¦‚&quot;www&quot;å¯èƒ½æ˜¯&quot;http&quot;çš„åˆ«åï¼‰ï¼Œæœ€åä¸€ä¸ªå…ƒç´ ä¸ºNULLã€‚\n\n\ns_portï¼šæœåŠ¡å¯¹åº”çš„ç«¯å£å·ï¼Œä»¥ç½‘ç»œå­—èŠ‚åºï¼ˆå¤§ç«¯åºï¼‰å­˜å‚¨ï¼Œä½¿ç”¨æ—¶éœ€é€šè¿‡ntohsè½¬æ¢ä¸ºä¸»æœºå­—èŠ‚åºã€‚\n\n\ns_protoï¼šæœåŠ¡ä½¿ç”¨çš„åè®®ç±»å‹ï¼ˆå¦‚&quot;tcp&quot;ç”¨äºé¢å‘è¿æ¥çš„æœåŠ¡ï¼Œ&quot;udp&quot;ç”¨äºæ— è¿æ¥æœåŠ¡ï¼‰ã€‚\n\n\n\n\näºŒã€ç°ä»£å¥—æ¥å­—å‡½æ•°åŸå‹åŠè¯´æ˜\ngetaddrinfo å‡½æ•°ï¼šæ­£å‘è§£æï¼ˆä¸»æœºåâ†’IP åœ°å€ï¼ŒæœåŠ¡åâ†’ç«¯å£å·ï¼‰\ngetaddrinfoçš„æ ¸å¿ƒåŠŸèƒ½æ˜¯å°†ä¸»æœºåï¼ˆæˆ– IP å­—ç¬¦ä¸²ï¼‰ å’ŒæœåŠ¡åï¼ˆæˆ–ç«¯å£å·å­—ç¬¦ä¸²ï¼‰ è½¬æ¢ä¸ºä¸€ç»„ç”¨äºåˆ›å»ºå¥—æ¥å­—çš„struct sockaddrç»“æ„ï¼ˆå¥—æ¥å­—åœ°å€ç»“æ„ï¼‰ï¼Œæ–¹ä¾¿åç»­çš„bindã€connectç­‰æ“ä½œã€‚\n1. å‡½æ•°åŸå‹\n#include &lt;netdb.h&gt;int getaddrinfo(const char *node, const char *service,                const struct addrinfo *hints,                struct addrinfo **res);\n2. å‚æ•°è¯¦è§£\n\n\n\nå‚æ•°å\nç±»å‹\nå«ä¹‰\n\n\n\n\nnode\nconst char*\nè¾“å…¥å‚æ•°ï¼šä¸»æœºåï¼ˆå¦‚&quot;www.example.com&quot;ï¼‰æˆ– IP åœ°å€å­—ç¬¦ä¸²ï¼ˆå¦‚&quot;192.168.1.1&quot;ï¼‰ã€‚è‹¥ä¸ºNULLï¼Œç»“åˆhints.ai_flagsçš„AI_PASSIVEå¯ç”¨äºæœåŠ¡å™¨ç»‘å®šé€šé…åœ°å€ï¼ˆINADDR_ANYï¼‰ã€‚\n\n\nservice\nconst char*\nè¾“å…¥å‚æ•°ï¼šæœåŠ¡åï¼ˆå¦‚&quot;http&quot;ã€&quot;ssh&quot;ï¼‰æˆ–ç«¯å£å·å­—ç¬¦ä¸²ï¼ˆå¦‚&quot;80&quot;ã€&quot;22&quot;ï¼‰ã€‚è‹¥ä¸ºNULLï¼Œåˆ™ä¸æŒ‡å®šç«¯å£å·ï¼ˆéœ€æ‰‹åŠ¨åœ¨è¿”å›çš„struct sockaddrä¸­è®¾ç½®ï¼‰ã€‚\n\n\nhints\nconst struct addrinfo*\nè¾“å…¥å‚æ•°ï¼šç”¨äºè¿‡æ»¤å’ŒæŒ‡å®šè¿”å›ç»“æœçš„ â€œæç¤ºâ€ ç»“æ„ä½“ã€‚è‹¥ä¸ºNULLï¼Œåˆ™é»˜è®¤è¿”å›æ‰€æœ‰å¯èƒ½çš„åœ°å€ç±»å‹ï¼ˆIPv4/IPv6ï¼ŒTCP/UDP ç­‰ï¼‰ã€‚\n\n\nres\nstruct addrinfo**\nè¾“å‡ºå‚æ•°ï¼šæŒ‡å‘struct addrinfoé“¾è¡¨çš„æŒ‡é’ˆï¼Œå­˜å‚¨è§£æç»“æœã€‚éœ€é€šè¿‡freeaddrinfoé‡Šæ”¾å†…å­˜ã€‚\n\n\n\n3. å…³é”®ç»“æ„ä½“ï¼šstruct addrinfo\nhintså’Œreså‡ä¸ºstruct addrinfoç±»å‹ï¼Œå…¶å®šä¹‰å¦‚ä¸‹ï¼š\nstruct addrinfo &#123;    int ai_flags;           // æ ‡å¿—ä½ï¼ˆè§ä¸‹æ–‡ï¼‰    int ai_family;          // åœ°å€æ—ï¼ˆå¦‚AF_INETã€AF_INET6ã€AF_UNSPECï¼‰    int ai_socktype;        // å¥—æ¥å­—ç±»å‹ï¼ˆå¦‚SOCK_STREAMã€SOCK_DGRAMï¼‰    int ai_protocol;        // åè®®ï¼ˆå¦‚IPPROTO_TCPã€IPPROTO_UDPï¼Œ0è¡¨ç¤ºä»»æ„ï¼‰    socklen_t ai_addrlen;   // ai_addræŒ‡å‘çš„åœ°å€ç»“æ„çš„é•¿åº¦    char *ai_canonname;     // ä¸»æœºçš„è§„èŒƒåç§°ï¼ˆè‹¥æŒ‡å®šAI_CANONNAMEæ ‡å¿—ï¼‰    struct sockaddr *ai_addr; // æŒ‡å‘å¥—æ¥å­—åœ°å€ç»“æ„ï¼ˆsockaddr_inæˆ–sockaddr_in6ï¼‰    struct addrinfo *ai_next; // é“¾è¡¨ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ï¼ˆå¯èƒ½æœ‰å¤šä¸ªè§£æç»“æœï¼‰&#125;;\nå…¶ä¸­æ ¸å¿ƒå­—æ®µè¯´æ˜ï¼š\n\n\nai_familyï¼šæŒ‡å®šåœ°å€æ—ï¼ŒAF_INETï¼ˆä»… IPv4ï¼‰ã€AF_INET6ï¼ˆä»… IPv6ï¼‰ã€AF_UNSPECï¼ˆä¸é™åˆ¶ï¼Œè¿”å›æ‰€æœ‰å¯èƒ½ï¼‰ã€‚\n\n\nai_socktypeï¼šæŒ‡å®šå¥—æ¥å­—ç±»å‹ï¼ŒSOCK_STREAMï¼ˆTCPï¼‰ã€SOCK_DGRAMï¼ˆUDPï¼‰ã€0ï¼ˆä»»æ„ç±»å‹ï¼‰ã€‚\n\n\nai_protocolï¼šæŒ‡å®šåè®®ï¼ŒIPPROTO_TCPï¼ˆTCPï¼‰ã€IPPROTO_UDPï¼ˆUDPï¼‰ã€0ï¼ˆä»»æ„åè®®ï¼‰ã€‚\n\n\nai_flagsï¼šå¸¸ç”¨æ ‡å¿—ï¼ˆå¯ç»„åˆä½¿ç”¨ï¼ŒæŒ‰ä½æˆ–ï¼‰ï¼š\n\nAI_PASSIVEï¼šç”¨äºæœåŠ¡å™¨ï¼Œnodeä¸ºNULLæ—¶ï¼Œè¿”å›çš„åœ°å€å°†æ˜¯é€šé…åœ°å€ï¼ˆINADDR_ANY for IPv4ï¼Œin6addr_any for IPv6ï¼‰ï¼Œé€‚åˆbindã€‚\nAI_CANONNAMEï¼šè¦æ±‚è¿”å›ä¸»æœºçš„è§„èŒƒåç§°ï¼ˆå­˜å‚¨åœ¨ai_canonnameï¼‰ã€‚\nAI_NUMERICHOSTï¼šnodeå¿…é¡»æ˜¯ IP åœ°å€å­—ç¬¦ä¸²ï¼ˆä¸è¿›è¡ŒåŸŸåè§£æï¼‰ï¼Œå¦åˆ™è¿”å›é”™è¯¯ã€‚\nAI_NUMERICSERVï¼šserviceå¿…é¡»æ˜¯ç«¯å£å·å­—ç¬¦ä¸²ï¼ˆä¸è§£ææœåŠ¡åï¼‰ï¼Œå¦åˆ™è¿”å›é”™è¯¯ã€‚\n\n\n\n4. è¿”å›å€¼\n\n\næˆåŠŸï¼šè¿”å›0ï¼ŒresæŒ‡å‘è§£æç»“æœé“¾è¡¨ï¼ˆå¯èƒ½æœ‰å¤šä¸ªåœ°å€ï¼Œéœ€éå†å¤„ç†ï¼‰ã€‚\n\n\nå¤±è´¥ï¼šè¿”å›é 0 é”™è¯¯ç ï¼ˆå¦‚EAI_NONAMEè¡¨ç¤ºä¸»æœºåæ— æ•ˆï¼‰ï¼Œå¯é€šè¿‡gai_strerror(err)è·å–é”™è¯¯ä¿¡æ¯å­—ç¬¦ä¸²ã€‚\n\n\n5. å†…å­˜é‡Šæ”¾\nè§£æå®Œæˆåï¼Œå¿…é¡»é€šè¿‡freeaddrinfoé‡Šæ”¾resæŒ‡å‘çš„é“¾è¡¨å†…å­˜ï¼Œé¿å…æ³„æ¼ï¼š\nvoid freeaddrinfo(struct addrinfo *res);\n6. ä½¿ç”¨åœºæ™¯\n\n\nå®¢æˆ·ç«¯ï¼šå°†æœåŠ¡å™¨ä¸»æœºåï¼ˆå¦‚&quot;www.baidu.com&quot;ï¼‰å’ŒæœåŠ¡åï¼ˆå¦‚&quot;http&quot;ï¼‰è§£æä¸ºstruct sockaddrï¼Œç”¨äºconnectã€‚\n\n\næœåŠ¡å™¨ï¼šå°†NULLï¼ˆä¸»æœºåï¼‰å’ŒæœåŠ¡åï¼ˆå¦‚&quot;8080&quot;ï¼‰è§£æä¸ºé€šé…åœ°å€ï¼ˆç»“åˆAI_PASSIVEï¼‰ï¼Œç”¨äºbindã€‚\n\n\ngetnameinfo å‡½æ•°ï¼šåå‘è§£æï¼ˆIP åœ°å€â†’ä¸»æœºåï¼Œç«¯å£å·â†’æœåŠ¡åï¼‰\ngetnameinfoæ˜¯getaddrinfoçš„åå‘æ“ä½œï¼šå°†struct sockaddrï¼ˆå¥—æ¥å­—åœ°å€ç»“æ„ï¼ŒåŒ…å« IP å’Œç«¯å£ï¼‰è½¬æ¢ä¸ºä¸»æœºåå’ŒæœåŠ¡åã€‚\n1. å‡½æ•°åŸå‹\n#include &lt;netdb.h&gt;int getnameinfo(const struct sockaddr *addr, socklen_t addrlen,                char *host, socklen_t hostlen,                char *serv, socklen_t servlen,                int flags);\n2. å‚æ•°è¯¦è§£\n\n\n\nå‚æ•°å\nç±»å‹\nå«ä¹‰\n\n\n\n\naddr\nconst struct sockaddr*\nè¾“å…¥å‚æ•°ï¼šæŒ‡å‘struct sockaddrï¼ˆæˆ–sockaddr_in/sockaddr_in6ï¼‰çš„æŒ‡é’ˆï¼ŒåŒ…å«å¾…è§£æçš„ IP å’Œç«¯å£ã€‚\n\n\naddrlen\nsocklen_t\nè¾“å…¥å‚æ•°ï¼šaddræŒ‡å‘çš„åœ°å€ç»“æ„çš„é•¿åº¦ï¼ˆå¦‚sizeof(struct sockaddr_in)ï¼‰ã€‚\n\n\nhost\nchar*\nè¾“å‡ºå‚æ•°ï¼šå­˜å‚¨ä¸»æœºåçš„ç¼“å†²åŒºï¼ˆè‹¥ä¸ºNULLï¼Œåˆ™ä¸è·å–ä¸»æœºåï¼‰ã€‚\n\n\nhostlen\nsocklen_t\nè¾“å…¥å‚æ•°ï¼šhostç¼“å†²åŒºçš„å¤§å°ï¼ˆå­—èŠ‚ï¼‰ã€‚\n\n\nserv\nchar*\nè¾“å‡ºå‚æ•°ï¼šå­˜å‚¨æœåŠ¡åçš„ç¼“å†²åŒºï¼ˆè‹¥ä¸ºNULLï¼Œåˆ™ä¸è·å–æœåŠ¡åï¼‰ã€‚\n\n\nservlen\nsocklen_t\nè¾“å…¥å‚æ•°ï¼šservç¼“å†²åŒºçš„å¤§å°ï¼ˆå­—èŠ‚ï¼‰ã€‚\n\n\nflags\nint\nè¾“å…¥å‚æ•°ï¼šæ§åˆ¶è§£æè¡Œä¸ºçš„æ ‡å¿—ï¼ˆè§ä¸‹æ–‡ï¼‰ã€‚\n\n\n\n3. å…³é”®æ ‡å¿—ï¼ˆflagsï¼‰\n\n\nNI_NAMEREQDï¼šè‹¥æ— æ³•è§£æä¸»æœºåï¼ˆå¦‚æ—  DNS è®°å½•ï¼‰ï¼Œåˆ™è¿”å›é”™è¯¯ï¼ˆEAI_NONAMEï¼‰ï¼Œä¸è¿”å› IP å­—ç¬¦ä¸²ã€‚\n\n\nNI_NUMERICHOSTï¼šå¼ºåˆ¶è¿”å› IP åœ°å€å­—ç¬¦ä¸²ï¼ˆä¸è§£æä¸ºä¸»æœºåï¼‰ã€‚\n\n\nNI_NUMERICSERVï¼šå¼ºåˆ¶è¿”å›ç«¯å£å·å­—ç¬¦ä¸²ï¼ˆä¸è§£æä¸ºæœåŠ¡åï¼‰ã€‚\n\n\nNI_DGRAMï¼šè¡¨ç¤ºæ˜¯ UDP æœåŠ¡ï¼ˆé»˜è®¤å‡è®¾æ˜¯ TCPï¼ŒæŸäº›æœåŠ¡ååœ¨ TCP å’Œ UDP ä¸­å¯èƒ½ä¸åŒï¼‰ã€‚\n\n\n4. è¿”å›å€¼\n\n\næˆåŠŸï¼šè¿”å›0ï¼Œhostå’Œservç¼“å†²åŒºåˆ†åˆ«å­˜å‚¨ä¸»æœºåå’ŒæœåŠ¡åï¼ˆè‹¥å¯¹åº”å‚æ•°éNULLï¼‰ã€‚\n\n\nå¤±è´¥ï¼šè¿”å›é 0 é”™è¯¯ç ï¼Œå¯é€šè¿‡gai_strerror(err)è·å–é”™è¯¯ä¿¡æ¯ã€‚\n\n\n5. ä½¿ç”¨åœºæ™¯\n\n\næœåŠ¡å™¨ï¼šè·å–å®¢æˆ·ç«¯è¿æ¥çš„ IP å¯¹åº”çš„ä¸»æœºåï¼ˆå¦‚æ—¥å¿—è®°å½•ï¼‰ã€‚\n\n\nç½‘ç»œå·¥å…·ï¼šå°†å¥—æ¥å­—åœ°å€è½¬æ¢ä¸ºäººç±»å¯è¯»çš„ä¸»æœºåå’ŒæœåŠ¡åï¼ˆå¦‚netstatæ˜¾ç¤ºwww.baidu.com:httpè€Œé180.101.50.242:80ï¼‰ã€‚\n\n\nç¤ºä¾‹ä»£ç ç‰‡æ®µ\n1. getaddrinfo ç¤ºä¾‹ï¼ˆè§£æä¸»æœºåå’ŒæœåŠ¡åï¼‰\n#include &lt;iostream&gt;#include &lt;netdb.h&gt;#include &lt;sys/socket.h&gt;#include &lt;arpa/inet.h&gt;int main() &#123;    const char* host = &quot;www.baidu.com&quot;; // ä¸»æœºå    const char* service = &quot;http&quot;;       // æœåŠ¡åï¼ˆå¯¹åº”80ç«¯å£ï¼‰        struct addrinfo hints, *res, *p;    memset(&amp;hints, 0, sizeof(hints));    hints.ai_family = AF_UNSPEC;    // ä¸é™åˆ¶IPv4/IPv6    hints.ai_socktype = SOCK_STREAM; // TCP        int status = getaddrinfo(host, service, &amp;hints, &amp;res);    if (status != 0) &#123;        std::cerr &lt;&lt; &quot;getaddrinfo error: &quot; &lt;&lt; gai_strerror(status) &lt;&lt; std::endl;        return 1;    &#125;        // éå†è§£æç»“æœ    for (p = res; p != nullptr; p = p-&gt;ai_next) &#123;        char ipstr[INET6_ADDRSTRLEN]; // è¶³å¤Ÿå­˜å‚¨IPv6åœ°å€çš„ç¼“å†²åŒº        void* addr;                // åˆ¤æ–­æ˜¯IPv4è¿˜æ˜¯IPv6        if (p-&gt;ai_family == AF_INET) &#123;            struct sockaddr_in* ipv4 = (struct sockaddr_in*)p-&gt;ai_addr;            addr = &amp;(ipv4-&gt;sin_addr);        &#125; else &#123;            struct sockaddr_in6* ipv6 = (struct sockaddr_in6*)p-&gt;ai_addr;            addr = &amp;(ipv6-&gt;sin6_addr);        &#125;                // è½¬æ¢ä¸ºå­—ç¬¦ä¸²        inet_ntop(p-&gt;ai_family, addr, ipstr, sizeof(ipstr));        std::cout &lt;&lt; &quot;IPåœ°å€: &quot; &lt;&lt; ipstr &lt;&lt; std::endl;    &#125;        freeaddrinfo(res); // é‡Šæ”¾å†…å­˜    return 0;&#125;\n2. getnameinfo ç¤ºä¾‹ï¼ˆè§£æ IP åœ°å€å’Œç«¯å£ï¼‰\n#include &lt;iostream&gt;#include &lt;netdb.h&gt;#include &lt;sys/socket.h&gt;#include &lt;arpa/inet.h&gt;int main() &#123;    struct sockaddr_in addr; // IPv4åœ°å€ç»“æ„    memset(&amp;addr, 0, sizeof(addr));    addr.sin_family = AF_INET;    addr.sin_port = htons(80); // ç«¯å£80    inet_pton(AF_INET, &quot;180.101.50.242&quot;, &amp;addr.sin_addr); // ç™¾åº¦çš„ä¸€ä¸ªIP        char host[NI_MAXHOST];   // ä¸»æœºåç¼“å†²åŒº    char serv[NI_MAXSERV];   // æœåŠ¡åç¼“å†²åŒº        // è§£æï¼šè·å–ä¸»æœºåå’ŒæœåŠ¡å    int status = getnameinfo((struct sockaddr*)&amp;addr, sizeof(addr),                             host, sizeof(host),                             serv, sizeof(serv),                             0); // ä¸ä½¿ç”¨ç‰¹æ®Šæ ‡å¿—        if (status != 0) &#123;        std::cerr &lt;&lt; &quot;getnameinfo error: &quot; &lt;&lt; gai_strerror(status) &lt;&lt; std::endl;        return 1;    &#125;        std::cout &lt;&lt; &quot;ä¸»æœºå: &quot; &lt;&lt; host &lt;&lt; std::endl; // å¯èƒ½è¾“å‡º&quot;www.baidu.com&quot;    std::cout &lt;&lt; &quot;æœåŠ¡å: &quot; &lt;&lt; serv &lt;&lt; std::endl; // è¾“å‡º&quot;http&quot;    return 0;&#125;\n","categories":["ç¼–ç¨‹"],"tags":["C++","Linux"]},{"title":"äº‹ä»¶å¤„ç†æ¨¡å¼","url":"/2025/08/11/linux/%E5%B9%B6%E5%8F%91%E4%BA%8B%E4%BB%B6%E5%A4%84%E7%90%86%E6%A8%A1%E5%BC%8F/","content":"AIç”Ÿæˆï¼Œæœªå®Œå…¨æ¶ˆåŒ–â€¦â€¦\n \nä¸€ã€Reactor æ¨¡å¼ï¼ˆååº”å™¨æ¨¡å¼ï¼‰\næ ¸å¿ƒæ€æƒ³ï¼šåŸºäº â€œäº‹ä»¶é©±åŠ¨â€ï¼Œé€šè¿‡ä¸€ä¸ªé›†ä¸­å¼çš„äº‹ä»¶å¾ªç¯ç­‰å¾…äº‹ä»¶å‘ç”Ÿï¼Œå†å°†äº‹ä»¶åˆ†å‘ç»™å¯¹åº”çš„å¤„ç†å™¨å¤„ç†ã€‚å…¶æ ¸å¿ƒæ˜¯ â€œç­‰å¾…äº‹ä»¶â†’åˆ†å‘å¤„ç†â€ çš„åŒæ­¥è§¦å‘æœºåˆ¶ã€‚\n1. æ ¸å¿ƒç»„ä»¶\n\n\näº‹ä»¶æºï¼ˆEvent Sourceï¼‰ï¼šäº§ç”Ÿäº‹ä»¶çš„å®ä½“ï¼Œå¦‚ç½‘ç»œå¥—æ¥å­—ï¼ˆsocketï¼‰ã€æ–‡ä»¶æè¿°ç¬¦ï¼ˆfdï¼‰ç­‰ã€‚\n\n\näº‹ä»¶å¤šè·¯åˆ†å‘å™¨ï¼ˆEvent Multiplexerï¼‰ï¼šç›‘å¬äº‹ä»¶æºï¼Œå½“äº‹ä»¶å°±ç»ªæ—¶é€šçŸ¥ååº”å™¨ï¼ˆå¦‚ Linux çš„epollã€pollï¼ŒWindows çš„selectï¼‰ã€‚\n\n\näº‹ä»¶å¤„ç†å™¨ï¼ˆEventHandlerï¼‰ï¼šå®šä¹‰äº‹ä»¶å¤„ç†æ¥å£ï¼ˆå¦‚handleRead()ã€handleWrite()ï¼‰ï¼Œç”±å…·ä½“ä¸šåŠ¡é€»è¾‘å®ç°ã€‚\n\n\nååº”å™¨ï¼ˆReactorï¼‰ï¼šåè°ƒäº‹ä»¶å¤šè·¯åˆ†å‘å™¨å’Œäº‹ä»¶å¤„ç†å™¨ï¼Œè´Ÿè´£æ³¨å†Œ / æ³¨é”€äº‹ä»¶ã€åˆ†å‘å°±ç»ªäº‹ä»¶ã€‚\n\n\n2. å·¥ä½œæµç¨‹\n\n\nåº”ç”¨ç¨‹åºå‘ Reactor æ³¨å†Œäº‹ä»¶ï¼ˆå¦‚ â€œè¯»å°±ç»ªâ€ï¼‰åŠå¯¹åº”çš„å¤„ç†å™¨ï¼›\n\n\nReactor é€šè¿‡äº‹ä»¶å¤šè·¯åˆ†å‘å™¨é˜»å¡ç­‰å¾…äº‹ä»¶å°±ç»ªï¼›\n\n\nå½“äº‹ä»¶å°±ç»ªï¼ˆå¦‚ socket å¯è¯»ï¼‰ï¼Œäº‹ä»¶å¤šè·¯åˆ†å‘å™¨é€šçŸ¥ Reactorï¼›\n\n\nReactor æ ¹æ®äº‹ä»¶ç±»å‹è°ƒç”¨å¯¹åº”å¤„ç†å™¨çš„å¤„ç†æ–¹æ³•ï¼ˆå¦‚handleRead()ï¼‰ï¼›\n\n\nå¤„ç†å™¨å®Œæˆä¸šåŠ¡é€»è¾‘ï¼ˆå¦‚è¯»å–æ•°æ®ã€è§£æåè®®ï¼‰ã€‚\n\n\n3. å…³é”®ç‰¹æ€§\n\n\nåŒæ­¥ I/O æ¨¡å‹ï¼šI/O æ“ä½œï¼ˆå¦‚read()/write()ï¼‰ç”±åº”ç”¨ç¨‹åºä¸»åŠ¨å‘èµ·ï¼ŒReactor ä»…è´Ÿè´£ â€œé€šçŸ¥äº‹ä»¶å°±ç»ªâ€ï¼Œä¸å‚ä¸å®é™… I/Oã€‚\n\n\nä¼˜åŠ¿ï¼šå®ç°ç®€å•ï¼Œæ— æ“ä½œç³»ç»Ÿå¼‚æ­¥ I/O ä¾èµ–ï¼Œé€‚åˆ I/O å¯†é›†å‹åœºæ™¯ï¼ˆå¦‚é«˜å¹¶å‘ç½‘ç»œæœåŠ¡å™¨ï¼‰ã€‚\n\n\nåŠ£åŠ¿ï¼šè‹¥å¤„ç†å™¨å¤„ç†è€—æ—¶ä»»åŠ¡ï¼ˆå¦‚å¤æ‚è®¡ç®—ï¼‰ï¼Œä¼šé˜»å¡äº‹ä»¶å¾ªç¯ï¼Œå¯¼è‡´å…¶ä»–äº‹ä»¶å»¶è¿Ÿå¤„ç†ã€‚\n\n\n4. C++ åº”ç”¨ç¤ºä¾‹\n\n\nçŸ¥åç½‘ç»œåº“muduoï¼ˆé™ˆç¡•å®ç°ï¼‰åŸºäº Reactor æ¨¡å¼ï¼Œç”¨epollä½œä¸ºäº‹ä»¶å¤šè·¯åˆ†å‘å™¨ï¼Œé…åˆçº¿ç¨‹æ± å¤„ç†è€—æ—¶ä»»åŠ¡ã€‚\n\n\nä»£ç æ¡†æ¶ç¤ºæ„ï¼š\n// äº‹ä»¶å¤„ç†å™¨æ¥å£class EventHandler &#123;public:    virtual void handleRead() = 0;    virtual void handleWrite() = 0;    virtual int getFd() = 0; // è·å–äº‹ä»¶æºfd&#125;;// Reactoræ ¸å¿ƒclass Reactor &#123;public:    void registerHandler(EventHandler* handler, int events); // æ³¨å†Œäº‹ä»¶    void removeHandler(EventHandler* handler); // æ³¨é”€äº‹ä»¶    void loop() &#123; // äº‹ä»¶å¾ªç¯        while (true) &#123;            // è°ƒç”¨epoll_waitç­‰å¾…äº‹ä»¶å°±ç»ª            int n = epoll_wait(epfd, events, MAX_EVENTS, -1);            for (int i = 0; i &lt; n; ++i) &#123;                EventHandler* handler = (EventHandler*)events[i].data.ptr;                if (events[i].events &amp; EPOLLIN) &#123;                    handler-&gt;handleRead(); // åˆ†å‘è¯»äº‹ä»¶                &#125;                if (events[i].events &amp; EPOLLOUT) &#123;                    handler-&gt;handleWrite(); // åˆ†å‘å†™äº‹ä»¶                &#125;            &#125;        &#125;    &#125;&#125;;\n\n\näºŒã€Proactor æ¨¡å¼ï¼ˆå‰æ‘„å™¨æ¨¡å¼ï¼‰\næ ¸å¿ƒæ€æƒ³ï¼šåŸºäº â€œå¼‚æ­¥ I/Oâ€ï¼Œç”±æ“ä½œç³»ç»Ÿå®Œæˆå®é™… I/O æ“ä½œåï¼Œé€šçŸ¥åº”ç”¨ç¨‹åºå¤„ç† I/O ç»“æœã€‚å…¶æ ¸å¿ƒæ˜¯ â€œå‘èµ·å¼‚æ­¥ I/Oâ†’ç­‰å¾…å®Œæˆâ†’å¤„ç†ç»“æœâ€ã€‚\n1. æ ¸å¿ƒç»„ä»¶\n\n\nå¼‚æ­¥æ“ä½œå¤„ç†å™¨ï¼ˆAsync Operation Processorï¼‰ï¼šç”±æ“ä½œç³»ç»Ÿæä¾›ï¼Œè´Ÿè´£æ‰§è¡Œå¼‚æ­¥ I/Oï¼ˆå¦‚è¯»å–æ•°æ®åˆ°ç¼“å†²åŒºï¼‰ã€‚\n\n\nå®Œæˆäº‹ä»¶é˜Ÿåˆ—ï¼ˆCompletion Queueï¼‰ï¼šå­˜å‚¨ I/O æ“ä½œå®Œæˆçš„ç»“æœï¼ˆå¦‚æ•°æ®ã€é”™è¯¯ç ï¼‰ã€‚\n\n\nå®Œæˆäº‹ä»¶å¤šè·¯åˆ†å‘å™¨ï¼šç›‘å¬å®Œæˆäº‹ä»¶é˜Ÿåˆ—ï¼Œé€šçŸ¥ Proactor æœ‰ I/O å®Œæˆã€‚\n\n\nProactorï¼šåè°ƒå¼‚æ­¥æ“ä½œå’Œç»“æœå¤„ç†ï¼Œå°†å®Œæˆäº‹ä»¶åˆ†å‘ç»™å¤„ç†å™¨ã€‚\n\n\nå®Œæˆå¤„ç†å™¨ï¼ˆCompletion Handlerï¼‰ï¼šå¤„ç† I/O å®Œæˆåçš„ä¸šåŠ¡é€»è¾‘ï¼ˆå¦‚è§£ææ•°æ®ï¼‰ã€‚\n\n\n2. å·¥ä½œæµç¨‹\n\n\nåº”ç”¨ç¨‹åºå‘èµ·å¼‚æ­¥ I/O è¯·æ±‚ï¼ˆå¦‚aio_readï¼‰ï¼ŒæŒ‡å®šç¼“å†²åŒºã€å›è°ƒå¤„ç†å™¨ï¼Œå¹¶æ³¨å†Œåˆ° Proactorï¼›\n\n\næ“ä½œç³»ç»Ÿçš„å¼‚æ­¥æ“ä½œå¤„ç†å™¨æ‰§è¡Œ I/Oï¼ˆå¦‚ä» socket è¯»å–æ•°æ®åˆ°ç¼“å†²åŒºï¼‰ï¼›\n\n\nI/O å®Œæˆåï¼Œæ“ä½œç³»ç»Ÿå°†ç»“æœæ”¾å…¥å®Œæˆäº‹ä»¶é˜Ÿåˆ—ï¼›\n\n\nProactor é€šè¿‡å®Œæˆäº‹ä»¶å¤šè·¯åˆ†å‘å™¨æ£€æµ‹åˆ°å®Œæˆäº‹ä»¶ï¼Œè°ƒç”¨å¯¹åº”å®Œæˆå¤„ç†å™¨ï¼›\n\n\nå¤„ç†å™¨å¤„ç† I/O ç»“æœï¼ˆå¦‚è§£æç¼“å†²åŒºæ•°æ®ï¼‰ã€‚\n\n\n3. å…³é”®ç‰¹æ€§\n\n\nå¼‚æ­¥ I/O æ¨¡å‹ï¼šI/O æ“ä½œç”±æ“ä½œç³»ç»Ÿå®Œæˆï¼Œåº”ç”¨ç¨‹åºä»…å¤„ç†ç»“æœï¼Œé¿å… I/O é˜»å¡ã€‚\n\n\nä¼˜åŠ¿ï¼šé€‚åˆé«˜å¹¶å‘åœºæ™¯ï¼ŒI/O æ•ˆç‡é«˜ï¼ˆæ— åº”ç”¨ç¨‹åºè½®è¯¢æˆ–é˜»å¡ç­‰å¾…ï¼‰ã€‚\n\n\nåŠ£åŠ¿ï¼šä¾èµ–æ“ä½œç³»ç»Ÿå¼‚æ­¥ I/O æ”¯æŒï¼ˆå¦‚ Windows çš„ IOCPã€Linux çš„io_uringï¼‰ï¼Œå®ç°å¤æ‚ï¼Œç§»æ¤æ€§å·®ã€‚\n\n\n4. C++ åº”ç”¨ç¤ºä¾‹\n\n\nLinux ä¸‹å¯åŸºäºio_uringå®ç° Proactorï¼ŒWindows å¯åŸºäº IOCPã€‚\n\n\nä»£ç æ¡†æ¶ç¤ºæ„ï¼ˆç®€åŒ–io_uringç”¨æ³•ï¼‰ï¼š\n// å®Œæˆå¤„ç†å™¨class CompletionHandler &#123;public:    virtual void handleCompletion(ssize_t res) = 0; // å¤„ç†I/Oç»“æœ&#125;;// Proactoræ ¸å¿ƒclass Proactor &#123;public:    // å‘èµ·å¼‚æ­¥è¯»    void asyncRead(int fd, void* buf, size_t len, CompletionHandler* handler) &#123;        // æäº¤io_uringå¼‚æ­¥è¯»è¯·æ±‚        struct io_uring_sqe* sqe = io_uring_get_sqe(&amp;ring);        io_uring_prep_read(sqe, fd, buf, len, 0);        sqe-&gt;user_data = (uint64_t)handler; // ç»‘å®šå¤„ç†å™¨        io_uring_submit(&amp;ring);    &#125;    void loop() &#123; // äº‹ä»¶å¾ªç¯        while (true) &#123;            struct io_uring_cqe* cqe;            io_uring_wait_cqe(&amp;ring, &amp;cqe); // ç­‰å¾…I/Oå®Œæˆ            CompletionHandler* handler = (CompletionHandler*)cqe-&gt;user_data;            handler-&gt;handleCompletion(cqe-&gt;res); // å¤„ç†ç»“æœ            io_uring_cqe_seen(&amp;ring, cqe);        &#125;    &#125;&#125;;\n\n\nå¹¶å‘ç¼–ç¨‹æ¨¡å¼\nä¸€ã€åŠåŒæ­¥ / åŠå¼‚æ­¥æ¨¡å¼ï¼ˆHalf-Sync/Half-Asyncï¼‰\næ ¸å¿ƒæ€æƒ³ï¼šå°†ç³»ç»Ÿåˆ†ä¸º â€œå¼‚æ­¥å±‚â€ å’Œ â€œåŒæ­¥å±‚â€ï¼Œå¼‚æ­¥å±‚å¤„ç† I/O äº‹ä»¶ï¼ŒåŒæ­¥å±‚å¤„ç†ä¸šåŠ¡é€»è¾‘ï¼Œé€šè¿‡é˜Ÿåˆ—è¿æ¥ä¸¤å±‚ï¼Œå¹³è¡¡æ•ˆç‡ä¸å¤æ‚åº¦ã€‚\n1. ä¸‰å±‚ç»“æ„\n\n\nå¼‚æ­¥å±‚ï¼šé‡‡ç”¨ Reactor æ¨¡å¼å¤„ç† I/O äº‹ä»¶ï¼ˆå¦‚æ¥æ”¶è¿æ¥ã€è¯»å†™æ•°æ®ï¼‰ï¼Œä¸é˜»å¡ï¼Œé«˜æ•ˆå“åº”äº‹ä»¶ã€‚\n\n\nåŒæ­¥å±‚ï¼šç”±çº¿ç¨‹æ± ç»„æˆï¼ŒåŒæ­¥æ‰§è¡Œä¸šåŠ¡é€»è¾‘ï¼ˆå¦‚åè®®è§£æã€äº‹åŠ¡å¤„ç†ï¼‰ï¼Œé¿å…å¼‚æ­¥å±‚è¢«è€—æ—¶ä»»åŠ¡é˜»å¡ã€‚\n\n\nä»»åŠ¡é˜Ÿåˆ—ï¼šå¼‚æ­¥å±‚å°†å¾…å¤„ç†çš„ä»»åŠ¡ï¼ˆå¦‚ â€œè§£æè¯·æ±‚â€ï¼‰æ”¾å…¥é˜Ÿåˆ—ï¼ŒåŒæ­¥å±‚çº¿ç¨‹ä»é˜Ÿåˆ—å–ä»»åŠ¡æ‰§è¡Œã€‚\n\n\n2. å·¥ä½œæµç¨‹\n\n\nå¼‚æ­¥å±‚ï¼ˆReactorï¼‰æ¥æ”¶ç½‘ç»œäº‹ä»¶ï¼ˆå¦‚å®¢æˆ·ç«¯è¯·æ±‚ï¼‰ï¼Œå°†è¯·æ±‚å°è£…ä¸ºä»»åŠ¡ï¼›\n\n\nå¼‚æ­¥å±‚å°†ä»»åŠ¡æ”¾å…¥ä»»åŠ¡é˜Ÿåˆ—ï¼›\n\n\nåŒæ­¥å±‚çš„çº¿ç¨‹æ± ä»é˜Ÿåˆ—ä¸­å–ä»»åŠ¡ï¼ŒåŒæ­¥æ‰§è¡Œä¸šåŠ¡é€»è¾‘ï¼ˆå¦‚æ•°æ®åº“æ“ä½œï¼‰ï¼›\n\n\nä¸šåŠ¡å¤„ç†å®Œæˆåï¼Œç»“æœé€šè¿‡é˜Ÿåˆ—è¿”å›ç»™å¼‚æ­¥å±‚ï¼Œç”±å¼‚æ­¥å±‚å‘é€å“åº”ã€‚\n\n\n3. å…³é”®ç‰¹æ€§\n\n\nåˆ†ç¦» I/O ä¸ä¸šåŠ¡ï¼šå¼‚æ­¥å±‚ä¸“æ³¨é«˜æ•ˆ I/Oï¼ŒåŒæ­¥å±‚ä¸“æ³¨å¤æ‚ä¸šåŠ¡ï¼Œé™ä½è€¦åˆã€‚\n\n\nä¼˜åŠ¿ï¼šå…¼é¡¾é«˜å¹¶å‘ I/O å’Œå¤æ‚ä¸šåŠ¡å¤„ç†ï¼Œé¿å…å•ä¸€çº¿ç¨‹é˜»å¡æ•´ä¸ªç³»ç»Ÿã€‚\n\n\nåŠ£åŠ¿ï¼šä»»åŠ¡é˜Ÿåˆ—å¯èƒ½æˆä¸ºç“¶é¢ˆï¼ˆéœ€è€ƒè™‘çº¿ç¨‹å®‰å…¨å’Œé˜Ÿåˆ—é•¿åº¦ï¼‰ï¼›çº¿ç¨‹æ± ç®¡ç†å¢åŠ å¤æ‚åº¦ã€‚\n\n\n4. C++ åº”ç”¨ç¤ºä¾‹\n\n\nå¤šæ•°å•†ä¸šæœåŠ¡å™¨æ¡†æ¶é‡‡ç”¨æ­¤æ¨¡å¼ï¼Œå¦‚ Nginxï¼ˆå¼‚æ­¥å±‚å¤„ç†è¿æ¥ï¼ŒåŒæ­¥è¿›ç¨‹å¤„ç†è¯·æ±‚ï¼‰ã€‚\n\n\nä»£ç æ¡†æ¶ç¤ºæ„ï¼š\n// å¼‚æ­¥å±‚ï¼ˆReactorï¼‰class AsyncLayer &#123;public:    void onRequest(Request* req) &#123;        taskQueue.push(req); // è¯·æ±‚æ”¾å…¥é˜Ÿåˆ—        cond.notify_one(); // å”¤é†’åŒæ­¥å±‚çº¿ç¨‹    &#125;&#125;;// åŒæ­¥å±‚ï¼ˆçº¿ç¨‹æ± ï¼‰class SyncLayer &#123;public:    SyncLayer() &#123;        for (int i = 0; i &lt; 4; ++i) &#123; // 4ä¸ªå·¥ä½œçº¿ç¨‹            threads.emplace_back([this]() &#123;                while (true) &#123;                    std::unique_lock&lt;std::mutex&gt; lock(mtx);                    cond.wait(lock, []&#123; return !taskQueue.empty(); &#125;);                    Request* req = taskQueue.front();                    taskQueue.pop();                    lock.unlock();                    processRequest(req); // åŒæ­¥å¤„ç†ä¸šåŠ¡                &#125;            &#125;);        &#125;    &#125;&#125;;\n\n\näºŒã€é¢†å¯¼ / è¿½éšè€…æ¨¡å¼ï¼ˆLeader/Followerï¼‰\næ ¸å¿ƒæ€æƒ³ï¼šçº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹è½®æµæ‹…ä»» â€œé¢†å¯¼è€…â€ï¼Œé¢†å¯¼è€…è´Ÿè´£ç­‰å¾…äº‹ä»¶ï¼›äº‹ä»¶åˆ°æ¥åï¼Œé¢†å¯¼è€…æŒ‡å®šä¸€ä¸ª â€œè¿½éšè€…â€ æˆä¸ºæ–°é¢†å¯¼è€…ï¼Œè‡ªå·±è½¬ä¸º â€œå¤„ç†è€…â€ å¤„ç†äº‹ä»¶ï¼›å¤„ç†å®Œæˆåå›å½’è¿½éšè€…é˜Ÿåˆ—ã€‚\n1. æ ¸å¿ƒç»„ä»¶\n\n\nçº¿ç¨‹æ± ï¼šåŒ…å«å¤šä¸ªç›¸åŒè§’è‰²çš„çº¿ç¨‹ï¼ˆé¢†å¯¼è€… / è¿½éšè€… / å¤„ç†è€…ï¼‰ã€‚\n\n\näº‹ä»¶å¤šè·¯åˆ†å‘å™¨ï¼šä»…ç”±å½“å‰é¢†å¯¼è€…æŒæœ‰ï¼Œç”¨äºç­‰å¾…äº‹ä»¶ã€‚\n\n\näº‹ä»¶é˜Ÿåˆ—ï¼šæš‚å­˜å¾…å¤„ç†äº‹ä»¶ï¼ˆå¯é€‰ï¼Œç”¨äºæ‰¹é‡å¤„ç†ï¼‰ã€‚\n\n\nçº¿ç¨‹å±éšœï¼ˆBarrierï¼‰ï¼šåè°ƒçº¿ç¨‹è§’è‰²åˆ‡æ¢ï¼ˆå¦‚é¢†å¯¼è€…é€‰ä¸¾ï¼‰ã€‚\n\n\n2. å·¥ä½œæµç¨‹\n\n\nåˆå§‹æ—¶ï¼Œä¸€ä¸ªçº¿ç¨‹æˆä¸ºé¢†å¯¼è€…ï¼Œå…¶ä»–ä¸ºè¿½éšè€…ï¼›\n\n\né¢†å¯¼è€…é€šè¿‡äº‹ä»¶å¤šè·¯åˆ†å‘å™¨ç­‰å¾…äº‹ä»¶ï¼›\n\n\näº‹ä»¶åˆ°æ¥åï¼Œé¢†å¯¼è€…ä»è¿½éšè€…ä¸­é€‰ä¸€ä¸ªçº¿ç¨‹ä½œä¸ºæ–°é¢†å¯¼è€…ï¼ˆæ¥ç®¡äº‹ä»¶å¤šè·¯åˆ†å‘å™¨ï¼‰ï¼›\n\n\nåŸé¢†å¯¼è€…è½¬ä¸ºå¤„ç†è€…ï¼Œå¤„ç†å½“å‰äº‹ä»¶ï¼›\n\n\nå¤„ç†å®Œæˆåï¼Œå¤„ç†è€…å˜å›è¿½éšè€…ï¼Œç­‰å¾…ä¸‹æ¬¡é€‰ä¸¾ã€‚\n\n\n3. å…³é”®ç‰¹æ€§\n\n\næ— é”è®¾è®¡ï¼šçº¿ç¨‹è§’è‰²åˆ‡æ¢é€šè¿‡å±éšœåè°ƒï¼Œé¿å…é”ç«äº‰ï¼Œå‡å°‘å¼€é”€ã€‚\n\n\nä¼˜åŠ¿ï¼šé€‚åˆçŸ­ä»»åŠ¡å¤„ç†ï¼ˆå¦‚äº‹ä»¶åˆ†å‘ï¼‰ï¼Œçº¿ç¨‹åˆ‡æ¢æ•ˆç‡é«˜ï¼Œé€‚åˆé«˜å¹¶å‘åœºæ™¯ã€‚\n\n\nåŠ£åŠ¿ï¼šä¸é€‚åˆé•¿ä»»åŠ¡ï¼ˆä¼šé˜»å¡é¢†å¯¼è€…é€‰ä¸¾ï¼Œå¯¼è‡´äº‹ä»¶å¤„ç†å»¶è¿Ÿï¼‰ï¼›å®ç°å¤æ‚ï¼ˆéœ€ç²¾ç»†æ§åˆ¶çº¿ç¨‹çŠ¶æ€ï¼‰ã€‚\n\n\n4. C++ åº”ç”¨ç¤ºä¾‹\n\n\nå¸¸ç”¨äºé«˜æ€§èƒ½äº‹ä»¶é©±åŠ¨æ¡†æ¶ï¼ˆå¦‚ ACE åº“çš„ACE_Leader_Followerï¼‰ã€‚\n\n\næ ¸å¿ƒé€»è¾‘ç¤ºæ„ï¼š\nclass LeaderFollower &#123;public:    void run() &#123;        while (true) &#123;            if (isLeader()) &#123;                // é¢†å¯¼è€…ç­‰å¾…äº‹ä»¶                Event* event = eventDemux.wait();                // é€‰æ–°é¢†å¯¼è€…                Thread* newLeader = selectFollower();                newLeader-&gt;becomeLeader();                // å¤„ç†äº‹ä»¶                processEvent(event);                // å˜å›è¿½éšè€…                becomeFollower();            &#125; else &#123;                // è¿½éšè€…ç­‰å¾…æˆä¸ºé¢†å¯¼è€…                barrier.wait();            &#125;        &#125;    &#125;&#125;;\n\n\næ€»ç»“ä¸å¯¹æ¯”\n\n\n\næ¨¡å¼\næ ¸å¿ƒæœºåˆ¶\né€‚ç”¨åœºæ™¯\nå…¸å‹ä¾èµ– / åº“\n\n\n\n\nReactor\nåŒæ­¥äº‹ä»¶é©±åŠ¨ï¼ˆç­‰äº‹ä»¶â†’å¤„ç†ï¼‰\né«˜å¹¶å‘ I/Oã€çŸ­ä»»åŠ¡\nepollã€muduo\n\n\nProactor\nå¼‚æ­¥ I/Oï¼ˆOS å®Œæˆ I/Oâ†’é€šçŸ¥ï¼‰\nè¶…å¤§è§„æ¨¡å¹¶å‘ã€å¼‚æ­¥ I/O æ”¯æŒ\nIOCPã€io_uring\n\n\nåŠåŒæ­¥ / åŠå¼‚æ­¥\nå¼‚æ­¥ I/O + åŒæ­¥ä¸šåŠ¡ + ä»»åŠ¡é˜Ÿåˆ—\nå¤æ‚ä¸šåŠ¡ + é«˜å¹¶å‘ I/O\nçº¿ç¨‹æ±  + Reactor\n\n\né¢†å¯¼ / è¿½éšè€…\nçº¿ç¨‹è½®æµé¢†å¯¼ + æ— é”å¤„ç†\né«˜å¹¶å‘çŸ­ä»»åŠ¡ã€äº‹ä»¶åˆ†å‘\nACE åº“ã€è‡ªå®šä¹‰çº¿ç¨‹æ± \n\n\n\nåœ¨ C++ ç½‘ç»œç¼–ç¨‹ä¸­ï¼ŒReactor æ¨¡å¼å› å®ç°ç®€å•ä¸”å…¼å®¹æ€§å¥½ï¼Œæ˜¯æœ€å¸¸ç”¨çš„åŸºç¡€æ¨¡å¼ï¼›Proactor é€‚åˆå¯¹æ€§èƒ½è¦æ±‚æé«˜ä¸”ä¾èµ–ç‰¹å®š OS çš„åœºæ™¯ï¼›åŠåŒæ­¥ / åŠå¼‚æ­¥æ˜¯æ¶æ„çº§è®¾è®¡ï¼Œå¹³è¡¡äº†æ•ˆç‡ä¸ä¸šåŠ¡å¤æ‚åº¦ï¼›é¢†å¯¼ / è¿½éšè€…åˆ™é€‚åˆè¿½æ±‚æè‡´æ€§èƒ½çš„çŸ­ä»»åŠ¡å¤„ç†åœºæ™¯\n","categories":["ç¼–ç¨‹"],"tags":["C++","Linux"]},{"title":"é›¶æ‹·è´","url":"/2025/09/15/linux/%E9%9B%B6%E6%8B%B7%E8%B4%9D/","content":"å¦‚ä½•åˆ©ç”¨é›¶æ‹·è´æŠ€æœ¯ä¼˜åŒ–æ€§èƒ½ï¼Œå‡ä½è´Ÿè·\n \né›¶æ‹·è´\né›¶æ‹·è´ï¼ˆZero-Copyï¼‰ æ˜¯ä¸€ç§é€šè¿‡å‡å°‘æ•°æ®åœ¨ç”¨æˆ·ç©ºé—´ä¸å†…æ ¸ç©ºé—´ä¹‹é—´çš„æ‹·è´æ¬¡æ•°ï¼Œæ¥æå‡æ•°æ®ä¼ è¾“æ•ˆç‡çš„å…³é”®æŠ€æœ¯ã€‚å…¶æ ¸å¿ƒæ€æƒ³æ˜¯é¿å…ä¸å¿…è¦çš„æ•°æ®å¤åˆ¶æ“ä½œï¼Œè®©æ•°æ®ç›´æ¥åœ¨å†…æ ¸ç©ºé—´ä¸­å®Œæˆæµè½¬ï¼Œä»è€Œé™ä½ CPU å¼€é”€ã€å‡å°‘å†…å­˜å¸¦å®½å ç”¨ï¼Œç‰¹åˆ«é€‚ç”¨äºé«˜ååé‡çš„åœºæ™¯ï¼ˆå¦‚å¤§æ–‡ä»¶ä¼ è¾“ã€é«˜æ€§èƒ½æœåŠ¡å™¨ç­‰ï¼‰ã€‚\nä¸€ã€é›¶æ‹·è´çš„æ ¸å¿ƒä»·å€¼\nä¼ ç»Ÿæ•°æ®ä¼ è¾“ï¼ˆå¦‚ â€œè¯»å–æ–‡ä»¶å¹¶å‘é€åˆ°ç½‘ç»œâ€ï¼‰çš„æµç¨‹é€šå¸¸åŒ…å« 4 æ¬¡æ‹·è´å’Œ 2 æ¬¡ç”¨æˆ·æ€ / å†…æ ¸æ€åˆ‡æ¢ï¼š\n\n\næ•°æ®ä»ç£ç›˜æ‹·è´åˆ°å†…æ ¸ç¼“å†²åŒºï¼ˆDMA æ‹·è´ï¼‰ï¼›\n\n\næ•°æ®ä»å†…æ ¸ç¼“å†²åŒºæ‹·è´åˆ°ç”¨æˆ·ç¼“å†²åŒºï¼ˆCPU æ‹·è´ï¼‰ï¼›\n\n\næ•°æ®ä»ç”¨æˆ·ç¼“å†²åŒºæ‹·è´åˆ° Socket å†…æ ¸ç¼“å†²åŒºï¼ˆCPU æ‹·è´ï¼‰ï¼›\n\n\næ•°æ®ä» Socket å†…æ ¸ç¼“å†²åŒºæ‹·è´åˆ°ç½‘ç»œæ¥å£ï¼ˆDMA æ‹·è´ï¼‰ã€‚\n\n\né›¶æ‹·è´æŠ€æœ¯é€šè¿‡çœç•¥æ­¥éª¤ 2 å’Œ 3 ä¸­çš„ CPU æ‹·è´ï¼Œæ˜¾è‘—æå‡æ•ˆç‡ã€‚\näºŒã€C++ ä¸­å¸¸ç”¨çš„é›¶æ‹·è´å‡½æ•°åŠç”¨æ³•\né›¶æ‹·è´çš„å®ç°ä¾èµ–äºæ“ä½œç³»ç»Ÿæä¾›çš„ç³»ç»Ÿè°ƒç”¨ï¼Œä¸åŒå¹³å°ï¼ˆLinux/Windowsï¼‰å‡½æ•°ä¸åŒï¼Œä»¥ä¸‹ä»¥ Linux ä¸ºä¸»ï¼ˆæœ€å¸¸ç”¨ï¼‰ï¼š\n1. sendfileï¼šæ–‡ä»¶åˆ°ç½‘ç»œçš„ç›´æ¥ä¼ è¾“\nsendfile æ˜¯ Linux å†…æ ¸ 2.1 ç‰ˆæœ¬åæä¾›çš„é›¶æ‹·è´å‡½æ•°ï¼Œä¸“é—¨ç”¨äºå°†æ–‡ä»¶æ•°æ®ç›´æ¥ä»æ–‡ä»¶æè¿°ç¬¦ä¼ è¾“åˆ° Socket æè¿°ç¬¦ï¼Œå…¨ç¨‹åœ¨å†…æ ¸ç©ºé—´å®Œæˆï¼Œå®Œå…¨é¿å…ç”¨æˆ·ç©ºé—´å‚ä¸ã€‚\nå‡½æ•°åŸå‹ï¼š\n#include &lt;sys/sendfile.h&gt;ssize_t sendfile(int out_fd, int in_fd, off_t *offset, size_t count);\nå‚æ•°è¯´æ˜ï¼š\n\n\nout_fdï¼šç›®æ ‡æ–‡ä»¶æè¿°ç¬¦ï¼ˆé€šå¸¸æ˜¯ Socket çš„ fdï¼‰ï¼›\n\n\nin_fdï¼šæºæ–‡ä»¶æè¿°ç¬¦ï¼ˆå¿…é¡»æ˜¯æ”¯æŒmmapçš„æ–‡ä»¶ï¼Œä¸èƒ½æ˜¯ Socketï¼‰ï¼›\n\n\noffsetï¼šæ–‡ä»¶è¯»å–çš„èµ·å§‹åç§»é‡ï¼ˆè‹¥ä¸ºNULLï¼Œåˆ™ä»å½“å‰ä½ç½®å¼€å§‹ï¼‰ï¼›\n\n\ncountï¼šè¦ä¼ è¾“çš„å­—èŠ‚æ•°ã€‚\n\n\nè¿”å›å€¼ï¼š\n\n\næˆåŠŸï¼šå®é™…ä¼ è¾“çš„å­—èŠ‚æ•°ï¼›\n\n\nå¤±è´¥ï¼š-1ï¼ˆéœ€é€šè¿‡errnoåˆ¤æ–­é”™è¯¯åŸå› ï¼‰ã€‚\n\n\nç¤ºä¾‹ä»£ç ï¼ˆç”¨sendfileå‘é€æ–‡ä»¶åˆ°ç½‘ç»œï¼‰ï¼š\n#include &lt;sys/socket.h&gt;#include &lt;sys/sendfile.h&gt;#include &lt;fcntl.h&gt;#include &lt;unistd.h&gt;#include &lt;iostream&gt;int main() &#123;    // 1. åˆ›å»ºSocketï¼ˆå‡è®¾å·²å®Œæˆç»‘å®šã€ç›‘å¬ã€ acceptï¼Œå¾—åˆ°client_fdï¼‰    int client_fd = ...;  // å·²è¿æ¥çš„å®¢æˆ·ç«¯Socket    // 2. æ‰“å¼€è¦å‘é€çš„æ–‡ä»¶    int file_fd = open(&quot;large_file.dat&quot;, O_RDONLY);    if (file_fd == -1) &#123;        perror(&quot;open failed&quot;);        return -1;    &#125;    // 3. è·å–æ–‡ä»¶å¤§å°ï¼ˆç®€åŒ–ç¤ºä¾‹ï¼‰    off_t file_size = lseek(file_fd, 0, SEEK_END);    lseek(file_fd, 0, SEEK_SET);  // å›åˆ°æ–‡ä»¶å¼€å¤´    // 4. ä½¿ç”¨sendfileä¼ è¾“æ–‡ä»¶    off_t offset = 0;    ssize_t total_sent = 0;    while (total_sent &lt; file_size) &#123;        ssize_t sent = sendfile(client_fd, file_fd, &amp;offset, file_size - total_sent);        if (sent == -1) &#123;            perror(&quot;sendfile failed&quot;);            close(file_fd);            close(client_fd);            return -1;        &#125;        total_sent += sent;    &#125;    std::cout &lt;&lt; &quot;File sent successfully, total: &quot; &lt;&lt; total_sent &lt;&lt; &quot; bytes\\n&quot;;    // 5. å…³é—­èµ„æº    close(file_fd);    close(client_fd);    return 0;&#125;\n2. mmap + writeï¼šå†…å­˜æ˜ å°„çš„é—´æ¥é›¶æ‹·è´\nmmap å°†æ–‡ä»¶ç›´æ¥æ˜ å°„åˆ°ç”¨æˆ·ç©ºé—´çš„å†…å­˜åœ°å€ï¼Œæ­¤æ—¶ç”¨æˆ·ç©ºé—´å¯ä»¥ç›´æ¥è®¿é—®å†…æ ¸ç¼“å†²åŒºçš„æ•°æ®ï¼ˆæ— éœ€æ‹·è´åˆ°ç”¨æˆ·ç¼“å†²åŒºï¼‰ï¼Œå†é€šè¿‡writeå°†æ•°æ®å‘é€åˆ° Socketã€‚è™½ç„¶ä»æœ‰ä¸€æ¬¡ â€œç”¨æˆ·ç©ºé—´åˆ° Socket å†…æ ¸ç¼“å†²åŒºâ€ çš„æ‹·è´ï¼Œä½†æ¯”ä¼ ç»Ÿæ–¹å¼å°‘ä¸€æ¬¡æ‹·è´ã€‚\nå‡½æ•°åŸå‹ï¼š\n#include &lt;sys/mman.h&gt;void *mmap(void *addr, size_t length, int prot, int flags, int fd, off_t offset);int munmap(void *addr, size_t length);  // è§£é™¤æ˜ å°„\nå‚æ•°è¯´æ˜ï¼š\n\n\naddrï¼šæ˜ å°„çš„èµ·å§‹åœ°å€ï¼ˆé€šå¸¸ä¸ºNULLï¼Œç”±ç³»ç»Ÿè‡ªåŠ¨åˆ†é…ï¼‰ï¼›\n\n\nlengthï¼šæ˜ å°„çš„å­—èŠ‚æ•°ï¼›\n\n\nprotï¼šå†…å­˜ä¿æŠ¤æ ‡å¿—ï¼ˆå¦‚PROT_READè¡¨ç¤ºå¯è¯»ï¼‰ï¼›\n\n\nflagsï¼šæ˜ å°„å±æ€§ï¼ˆå¦‚MAP_SHAREDè¡¨ç¤ºä¿®æ”¹ä¼šåŒæ­¥åˆ°æ–‡ä»¶ï¼‰ï¼›\n\n\nfdï¼šæ–‡ä»¶æè¿°ç¬¦ï¼›\n\n\noffsetï¼šæ–‡ä»¶æ˜ å°„çš„èµ·å§‹åç§»é‡ã€‚\n\n\nç¤ºä¾‹ä»£ç ï¼š\n#include &lt;sys/mman.h&gt;#include &lt;fcntl.h&gt;#include &lt;unistd.h&gt;#include &lt;iostream&gt;int main() &#123;    int client_fd = ...;  // å·²è¿æ¥çš„å®¢æˆ·ç«¯Socket    int file_fd = open(&quot;large_file.dat&quot;, O_RDONLY);    if (file_fd == -1) &#123; /* é”™è¯¯å¤„ç† */ &#125;    // è·å–æ–‡ä»¶å¤§å°    off_t file_size = lseek(file_fd, 0, SEEK_END);    // æ˜ å°„æ–‡ä»¶åˆ°ç”¨æˆ·ç©ºé—´    void *addr = mmap(NULL, file_size, PROT_READ, MAP_SHARED, file_fd, 0);    if (addr == MAP_FAILED) &#123;        perror(&quot;mmap failed&quot;);        close(file_fd);        return -1;    &#125;    // ç›´æ¥é€šè¿‡writeå‘é€æ˜ å°„çš„å†…å­˜ï¼ˆå†…éƒ¨ä»æœ‰ä¸€æ¬¡å†…æ ¸æ‹·è´ï¼‰    ssize_t sent = write(client_fd, addr, file_size);    if (sent == -1) &#123; /* é”™è¯¯å¤„ç† */ &#125;    // è§£é™¤æ˜ å°„å¹¶å…³é—­èµ„æº    munmap(addr, file_size);    close(file_fd);    close(client_fd);    return 0;&#125;\n3. spliceï¼šä»»æ„æ–‡ä»¶æè¿°ç¬¦é—´çš„é›¶æ‹·è´\nsplice æ˜¯ Linux 2.6.17 åæä¾›çš„æ›´çµæ´»çš„é›¶æ‹·è´å‡½æ•°ï¼Œæ”¯æŒåœ¨ä¸¤ä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼ˆå¯ä»¥æ˜¯ç®¡é“ã€Socketã€æ–‡ä»¶ç­‰ï¼‰ä¹‹é—´ç›´æ¥ä¼ è¾“æ•°æ®ï¼Œå…¨ç¨‹åœ¨å†…æ ¸ç©ºé—´å®Œæˆï¼Œä¸”æ— éœ€ç”¨æˆ·ç©ºé—´å‚ä¸ã€‚\nå‡½æ•°åŸå‹ï¼š\n#include &lt;fcntl.h&gt;ssize_t splice(int fd_in, loff_t *off_in, int fd_out, loff_t *off_out, size_t len, unsigned int flags);\nå‚æ•°è¯´æ˜ï¼š\n\n\nfd_in/fd_outï¼šè¾“å…¥ / è¾“å‡ºæ–‡ä»¶æè¿°ç¬¦ï¼ˆè‡³å°‘æœ‰ä¸€ä¸ªå¿…é¡»æ˜¯ç®¡é“ï¼‰ï¼›\n\n\noff_in/off_outï¼šè¾“å…¥ / è¾“å‡ºçš„åç§»é‡ï¼ˆNULLè¡¨ç¤ºä½¿ç”¨å½“å‰ä½ç½®ï¼‰ï¼›\n\n\nlenï¼šä¼ è¾“çš„å­—èŠ‚æ•°ï¼›\n\n\nflagsï¼šæ§åˆ¶æ ‡å¿—ï¼ˆå¦‚SPLICE_F_MOVEè¡¨ç¤ºå°½å¯èƒ½ç§»åŠ¨æ•°æ®è€Œéå¤åˆ¶ï¼‰ã€‚\n\n\nç¤ºä¾‹ä»£ç ï¼ˆç”¨spliceåœ¨ä¸¤ä¸ª Socket é—´è½¬å‘æ•°æ®ï¼‰ï¼š\n#include &lt;fcntl.h&gt;#include &lt;unistd.h&gt;#include &lt;iostream&gt;int main() &#123;    int sock1 = ...;  // æºSocket    int sock2 = ...;  // ç›®æ ‡Socket    // åˆ›å»ºç®¡é“ï¼ˆspliceè¦æ±‚è‡³å°‘ä¸€ä¸ªfdæ˜¯ç®¡é“ï¼‰    int pipefd[2];    if (pipe(pipefd) == -1) &#123; /* é”™è¯¯å¤„ç† */ &#125;    const size_t BUF_SIZE = 4096;    ssize_t n;    // ä»sock1è¯»å–æ•°æ®åˆ°ç®¡é“ï¼Œå†ä»ç®¡é“å†™å…¥sock2    while ((n = splice(sock1, NULL, pipefd[1], NULL, BUF_SIZE, SPLICE_F_MOVE)) &gt; 0) &#123;        ssize_t written = splice(pipefd[0], NULL, sock2, NULL, n, SPLICE_F_MOVE);        if (written != n) &#123; /* é”™è¯¯å¤„ç† */ &#125;    &#125;    close(pipefd[0]);    close(pipefd[1]);    close(sock1);    close(sock2);    return 0;&#125;\næ§åˆ¶æ ‡å¿—\n\n\nSPLICE_F_MOVE\n\n\n\n\nä½œç”¨ï¼šå°è¯•ä»¥ â€œç§»åŠ¨â€ æ–¹å¼ä¼ è¾“æ•°æ®ï¼Œè€Œéå¤åˆ¶ã€‚\n\n\nè¡Œä¸ºï¼šå‘ŠçŸ¥å†…æ ¸å°½å¯èƒ½é‡ç”¨é¡µé¢ï¼ˆå¦‚å°†é¡µé¢æ‰€æœ‰æƒä»æºæ–‡ä»¶æè¿°ç¬¦è½¬ç§»åˆ°ç›®æ ‡ï¼‰ï¼Œå‡å°‘å†…å­˜å¤åˆ¶å¼€é”€ã€‚\n\n\næ³¨æ„ï¼šè¿™åªæ˜¯ä¸€ä¸ª â€œå»ºè®®â€ï¼Œå†…æ ¸å¯èƒ½å› æ¡ä»¶é™åˆ¶ï¼ˆå¦‚é¡µé¢è¢«å…¶ä»–è¿›ç¨‹å¼•ç”¨ï¼‰è€Œé€€åŒ–ä¸ºå¤åˆ¶æ–¹å¼ã€‚\n\n\n\n\nSPLICE_F_NONBLOCK\n\n\n\n\nä½œç”¨ï¼šä½¿ splice() æ“ä½œéé˜»å¡æ‰§è¡Œã€‚\n\n\nè¡Œä¸ºï¼šè‹¥æ“ä½œæ— æ³•ç«‹å³å®Œæˆï¼ˆå¦‚æ•°æ®æœªå°±ç»ªï¼‰ï¼Œå‡½æ•°ä¼šç«‹å³è¿”å› -1 å¹¶è®¾ç½® errno ä¸º EAGAIN æˆ– EWOULDBLOCKï¼Œè€Œéé˜»å¡ç­‰å¾…ã€‚\n\n\næ³¨æ„ï¼šéœ€ç¡®ä¿ç›¸å…³æ–‡ä»¶æè¿°ç¬¦æœ¬èº«æ”¯æŒéé˜»å¡æ“ä½œï¼ˆå¦‚é€šè¿‡ fcntl() è®¾ç½® O_NONBLOCKï¼‰ã€‚\n\n\n\n\nSPLICE_F_MORE\n\n\n\n\nä½œç”¨ï¼šæç¤ºå†…æ ¸åç»­è¿˜æœ‰æ›´å¤šæ•°æ®è¦ä¼ è¾“ã€‚\n\n\nè¡Œä¸ºï¼šå†…æ ¸å¯æ®æ­¤ä¼˜åŒ– I/O è°ƒåº¦ï¼ˆå¦‚å»¶è¿Ÿæäº¤æ•°æ®ï¼Œåˆå¹¶æˆæ›´å¤§çš„ I/O æ“ä½œï¼‰ï¼Œæå‡æ•ˆç‡ã€‚\n\n\né€‚ç”¨åœºæ™¯ï¼šè¿ç»­å¤šæ¬¡è°ƒç”¨ splice() ä¼ è¾“å¤§é‡æ•°æ®æ—¶ä½¿ç”¨ã€‚\n\n\n\n\nSPLICE_F_GIFT\n\n\n\n\nä½œç”¨ï¼šè¡¨ç¤ºä¼ è¾“çš„æ•°æ®æ˜¯ç»™å†…æ ¸çš„ â€œç¤¼ç‰©â€ï¼Œç”¨æˆ·æ€ä¸å†éœ€è¦è®¿é—®è¿™äº›æ•°æ®ã€‚\n\n\nè¡Œä¸ºï¼šå†…æ ¸å¯è‡ªç”±å¤„ç†æ•°æ®é¡µé¢ï¼ˆå¦‚ç›´æ¥ä¸¢å¼ƒï¼‰ï¼Œé€šå¸¸ç”¨äºç®¡é“å†™ç«¯å‘å†…æ ¸ä¼ é€’æ•°æ®çš„åœºæ™¯ã€‚\n\n\né™åˆ¶ï¼šä»…é€‚ç”¨äºä»ç”¨æˆ·æ€æ–‡ä»¶æè¿°ç¬¦ï¼ˆå¦‚åŒ¿åç®¡é“ï¼‰å‘å†…æ ¸æ€ä¼ è¾“æ•°æ®çš„æƒ…å†µã€‚\n\n\n4.Windows å¹³å°ï¼šTransmitFile\nWindows æä¾›çš„TransmitFileå‡½æ•°ç±»ä¼¼ Linux çš„sendfileï¼Œç”¨äºå°†æ–‡ä»¶æ•°æ®ç›´æ¥å‘é€åˆ° Socketï¼Œå®ç°é›¶æ‹·è´ã€‚\nå‡½æ•°åŸå‹ï¼š\n#include &lt;windows.h&gt;BOOL TransmitFile(  SOCKET hSocket,  HANDLE hFile,  DWORD nNumberOfBytesToWrite,  DWORD nNumberOfBytesPerSend,  LPOVERLAPPED lpOverlapped,  LPTRANSMIT_FILE_BUFFERS lpTransmitBuffers,  DWORD dwFlags);\nä¸‰ã€æ³¨æ„äº‹é¡¹\n\n\nå¹³å°ä¾èµ–æ€§ï¼šé›¶æ‹·è´å‡½æ•°æ˜¯æ“ä½œç³»ç»Ÿç›¸å…³çš„ï¼ˆå¦‚sendfileä»… Linux æœ‰æ•ˆï¼ŒTransmitFileä»… Windows æœ‰æ•ˆï¼‰ï¼Œè·¨å¹³å°å¼€å‘éœ€å°è£…é€‚é…å±‚ï¼ˆå¦‚ä½¿ç”¨ Boost.Asio ç­‰åº“æŠ½è±¡ï¼‰ã€‚\n\n\né€‚ç”¨åœºæ™¯é™åˆ¶ï¼š\n\nsendfileæ—©æœŸç‰ˆæœ¬ä»…æ”¯æŒ â€œæ–‡ä»¶åˆ° Socketâ€ çš„ä¼ è¾“ï¼ˆæ— æ³•åå‘æˆ– Socket åˆ° Socketï¼‰ï¼›\nspliceè¦æ±‚è‡³å°‘ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦æ˜¯ç®¡é“ï¼Œçµæ´»æ€§å—é™ï¼›\nå°æ•°æ®ä¼ è¾“å¯èƒ½å› å‡½æ•°è°ƒç”¨å¼€é”€é«˜äºæ‹·è´å¼€é”€ï¼Œåè€Œæ•ˆç‡æ›´ä½ã€‚\n\n\n\né”™è¯¯å¤„ç†ï¼šé›¶æ‹·è´å‡½æ•°çš„é”™è¯¯ç ä¸æ™®é€š IO å‡½æ•°ä¸åŒï¼ˆå¦‚sendfileå¤±è´¥æ—¶errnoå¯èƒ½ä¸ºEINVALè¡¨ç¤ºä¸æ”¯æŒçš„ fd ç±»å‹ï¼‰ï¼Œéœ€é’ˆå¯¹æ€§å¤„ç†ã€‚\n\n\nå†…å­˜æ˜ å°„é£é™©ï¼šmmapæ˜ å°„çš„å†…å­˜è‹¥è¢«æ„å¤–ä¿®æ”¹ï¼ˆå¦‚MAP_SHAREDæ¨¡å¼ï¼‰ï¼Œå¯èƒ½å¯¼è‡´æ–‡ä»¶æ•°æ®æŸåï¼›ä¸”æ˜ å°„å¤§æ–‡ä»¶å¯èƒ½è€—å°½è™šæ‹Ÿå†…å­˜ã€‚\n\n\nåç§»é‡ç®¡ç†ï¼šsendfileå’Œmmapçš„offsetå‚æ•°éœ€æ‰‹åŠ¨ç®¡ç†ï¼Œå¤šæ¬¡è°ƒç”¨æ—¶éœ€ç¡®ä¿åç§»é‡æ­£ç¡®é€’å¢ï¼Œé¿å…æ•°æ®é‡å¤æˆ–ä¸¢å¤±ã€‚\n\n\nå››ã€å…¸å‹ä½¿ç”¨åœºæ™¯\n\n\né™æ€æ–‡ä»¶æœåŠ¡å™¨ï¼ˆå¦‚ Nginxï¼‰ï¼šç”¨sendfileç›´æ¥å°†ç£ç›˜æ–‡ä»¶å‘é€åˆ°ç½‘ç»œï¼Œé¿å…ç”¨æˆ·ç©ºé—´æ‹·è´ï¼Œæ”¯æ’‘é«˜å¹¶å‘ä¸‹è½½ã€‚\n\n\nå¤§æ–‡ä»¶ä¼ è¾“ï¼ˆå¦‚è§†é¢‘ã€å¤‡ä»½æ•°æ®ï¼‰ï¼šæ•°æ®é‡é€šå¸¸è¾¾ GB çº§ï¼Œé›¶æ‹·è´å¯å‡å°‘ 90% ä»¥ä¸Šçš„ CPU å¼€é”€ï¼Œæ˜¾è‘—æå‡ä¼ è¾“é€Ÿåº¦ã€‚\n\n\nä»£ç†æœåŠ¡å™¨ï¼ˆå¦‚åå‘ä»£ç†ï¼‰ï¼šç”¨spliceåœ¨å®¢æˆ·ç«¯ä¸åç«¯æœåŠ¡å™¨é—´è½¬å‘æ•°æ®ï¼Œå…¨ç¨‹å†…æ ¸æ€å¤„ç†ï¼Œæå‡è½¬å‘ååé‡ã€‚\n\n\né«˜æ€§èƒ½æ—¥å¿—æ”¶é›†ï¼šç”¨mmapæ˜ å°„æ—¥å¿—æ–‡ä»¶ï¼Œåº”ç”¨ç¨‹åºç›´æ¥å†™å…¥æ˜ å°„å†…å­˜ï¼Œé¿å…é¢‘ç¹ IO æ‹·è´ã€‚\n\n\n","categories":["ç¼–ç¨‹"],"tags":["C++","Linux"]},{"title":"ã€ŠC++ primerã€‹æ–‡æœ¬æŸ¥è¯¢ç¨‹åºä¸€","url":"/2024/04/13/school_assignments/%E3%80%8AC-primer%E3%80%8B%E6%96%87%E6%9C%AC%E6%9F%A5%E8%AF%A2%E7%A8%8B%E5%BA%8F%E4%B8%80/","content":"\nè¿™æ˜¯ã€ŠC++ primerã€‹ä¸­çš„ä¸€ä¸ªç¤ºä¾‹ç¨‹åºï¼Œçœ‹äº†å‡ éä»è§‰æœ‰äº›ç»†èŠ‚æ²¡æœ‰æ˜ç™½ï¼Œæ•…æ‰‹æ•²äº†ä¸€é\néœ€äº†è§£STLå®¹å™¨éƒ¨åˆ†çŸ¥è¯†ç‚¹ï¼Œæ™ºèƒ½æŒ‡é’ˆï¼Œæ–‡ä»¶æµï¼Œstringæµ\n\n\nã€ŠC++ primerã€‹æ–‡æœ¬æŸ¥è¯¢ç¨‹åºä¸€\nä¹¦ä¸Šç»™çš„ä¾‹å­å°šæœ‰ç‘•ç–µï¼Œå¦‚æœå•è¯åœ¨åŒä¸€è¡Œå‡ºç°å¤šæ¬¡ï¼Œåˆ™åªä¼šè®°å½•ä¸ºä¸€æ¬¡ï¼Œæœ¬äººèƒ½åŠ›æœ‰é™ï¼Œå°šæœªè§£å†³æ­¤é—®é¢˜\nä»¥ä¸‹æ˜¯å†™å®Œç¨‹åºåç»˜åˆ¶çš„æ€ç»´å¯¼å›¾\n\nä»£ç éƒ¨åˆ†\n\n\nmain.cpp\n\n\n#include&lt;iostream&gt;#include&lt;fstream&gt;#include&quot;TextQuery.h&quot;#include&quot;ResultQuery.h&quot;using namespace std;void runQueries(ifstream&amp; fin);int main(void)&#123;    string filename;    cout &lt;&lt; &quot;è¯·è¾“å…¥ä½ è¦æŸ¥è¯¢çš„æ–‡ä»¶å(åŒ…å«åç¼€)&quot;&lt;&lt;endl;    cin &gt;&gt; filename;\tifstream readFile(filename, ios::in);\tif (readFile.is_open())\t&#123;\t\trunQueries(readFile);\t&#125;\telse\t\tcout &lt;&lt; &quot;the file open failed!!!&quot; &lt;&lt; endl;&#125;void runQueries(ifstream&amp; fin)&#123;\tTextQuery tq(fin);\twhile (1)\t&#123;\t\tcout &lt;&lt; &quot;please enter word to look for, or q to quit.&quot; &lt;&lt; endl;\t\tstring needle;\t\tif (cin &gt;&gt; needle &amp;&amp; needle != &quot;q&quot; &amp;&amp; needle != &quot;Q&quot;)\t\t&#123;\t\t\tMyPrint(cout, tq.query(needle)) &lt;&lt; endl;\t\t&#125;\t\telse break;\t&#125;&#125;\n\n\nTextQuery.h\n\n\n#pragma once#include&lt;memory&gt;#include&lt;string&gt;#include&lt;map&gt;#include&lt;set&gt;#include&lt;vector&gt;#include&quot;ResultQuery.h&quot;using namespace std;class TextQuery &#123;private:\tshared_ptr&lt;vector&lt;string&gt;&gt; file;   //æ™ºèƒ½æŒ‡é’ˆ å¤šä¸ªå¯¹è±¡å…±äº«æ•°æ® å­˜å‚¨åœ°å€\tmap&lt;string, shared_ptr&lt;set&lt;int&gt;&gt;&gt; wm; //é—´æ¥å®ç°å•è¯ä¸è¡Œå·ä¹‹é—´çš„æ˜ å°„public:\tTextQuery(ifstream&amp; fin);   //æ„é€ å‡½æ•°\tResultQuery query(string needle); //ç”¨æ¥æ•´ç†å‡ºç›®æ ‡å•è¯çš„ç›¸å…³ä¿¡æ¯ï¼Œç„¶åä¼ é€’ç»™ResultQuery&#125;;\n\n\nTextQuery.cpp\n\n\n#include &quot;TextQuery.h&quot;#include&lt;string&gt;#include&lt;sstream&gt;#include&lt;fstream&gt;using namespace std;TextQuery::TextQuery(ifstream&amp; fin):file(new vector&lt;string&gt;)&#123;\tstring lineContent;\tsize_t lineNo;\twhile(getline(fin,lineContent))    // å°†æ–‡ä»¶å†…å®¹æ‹†åˆ†ä¸ºä¸€è¡Œä¸€è¡Œ\t&#123;\t\tfile-&gt;push_back(lineContent);\t\tlineNo = file-&gt;size() - 1;    //ä»é›¶å¼€å§‹è®¡æ•°ï¼Œæ–¹ä¾¿ä¹‹ååˆ©ç”¨è¿­ä»£å™¨è¿›è¡Œè¾“å‡ºæŸ¥è¯¢ç»“æœ\t\tistringstream line(lineContent); //åˆ©ç”¨stringæµ å°†ä¸€è¡Œå†…å®¹å†æ‹†åˆ†ä¸ºæ¯ä¸ªå•è¯\t\tstring word;\t\twhile (line &gt;&gt; word)     //å®ç°æ¯ä¸ªå•è¯ä¸å¯¹åº”è¡Œå·ä¹‹é—´çš„æ˜ å°„\t\t&#123;\t\t\tshared_ptr&lt;set&lt;int&gt;&gt;&amp; NO = wm[word];  // åœ¨mapä¸­å¦‚æœä½¿ç”¨ä¸‹æ ‡æœªæ‰¾åˆ°å¯¹åº”çš„å€¼ï¼Œåˆ™ä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªé»˜è®¤å€¼\t\t\tif (!NO)\t\t\t&#123;\t\t\t\tNO.reset(new set&lt;int&gt;);    //æ¸…ç©ºé»˜è®¤å€¼ï¼Œä½¿å…¶æ˜¯ä¸€ä¸ªæŒ‡å‘set&lt;int&gt;å‹çš„æŒ‡é’ˆ\t\t\t\tNO-&gt;insert(lineNo);        //å°†è¿™ä¸ªå•è¯æ‰€åœ¨çš„è¡Œå·æ‹·è´ç»™ æŒ‡é’ˆæŒ‡å‘çš„é‚£ä¸ªç©ºé—´\t\t\t&#125;\t\t\telse\t\t\t\tNO-&gt;insert(lineNo);\t\t&#125;\t&#125;&#125;ResultQuery TextQuery::query(string needle)&#123;\tshared_ptr&lt;set&lt;int&gt;&gt; nothing (new set&lt;int&gt;);\tauto result = wm.find(needle);\tif (result == wm.end())\t&#123;\t\treturn ResultQuery(needle,file, nothing);\t&#125;\telse\t&#123;\t\treturn ResultQuery(needle,file, result-&gt;second);\t&#125;&#125;\n\n\nResultQuery.h\n\n\n#pragma once#include&lt;memory&gt;#include&lt;string&gt;#include&lt;vector&gt;#include&lt;set&gt;#include&lt;map&gt;using namespace std;class ResultQuery&#123;private:\tstring needle;\tshared_ptr&lt;vector&lt;string&gt;&gt; file;\tshared_ptr&lt;set&lt;int&gt;&gt; lines;public:\tResultQuery(string n, shared_ptr&lt;vector&lt;string&gt;&gt; f, shared_ptr&lt;set&lt;int&gt;&gt; l) :\\\t\tneedle(n), file(f), lines(l) &#123;&#125;    //æ„é€ å‡½æ•° è¿›è¡Œåˆå§‹åŒ–\tfriend ostream&amp; MyPrint(ostream&amp;, const ResultQuery&amp;);&#125;;\n\n\nResultQuery.cpp\n\n\n#include &quot;ResultQuery.h&quot;#include &lt;iostream&gt;ostream&amp; MyPrint(ostream&amp; os, const ResultQuery&amp; rq) &#123;\tos&lt;&lt; rq.needle &lt;&lt; &quot; occurs &quot; &lt;&lt; rq.lines-&gt;size() &lt;&lt; &quot;times in the file &quot;  &lt;&lt; endl;\tfor (auto line : *(rq.lines))\t&#123;\t\tos &lt;&lt; &quot;\\tline:&quot;&lt;&lt;line+1&lt;&lt; &quot; &quot;&lt;&lt;rq.file-&gt;begin()[line]&lt;&lt;endl;\t&#125;\treturn os;&#125;\n","categories":["ç¼–ç¨‹"],"tags":["C++"]},{"title":"ã€Šæ±‡ç¼–è¯­è¨€ã€‹ç‹çˆ½----å®éªŒä¸ƒ","url":"/2025/05/04/school_assignments/%E3%80%8A%E6%B1%87%E7%BC%96%E8%AF%AD%E8%A8%80%E3%80%8B%E7%8E%8B%E7%88%BD-%E5%AE%9E%E9%AA%8C%E4%B8%83/","content":"\nã€Šæ±‡ç¼–è¯­è¨€ã€‹ç‹çˆ½(ç¬¬å››ç‰ˆ)ç¬¬å…«ç«  å®éªŒ7ä¹ é¢˜è§£ç­”\n\n\né¢˜ç›®è¦æ±‚\nassume cs:codedata segment    ;å¹´ä»½    db &#x27;1975&#x27;, &#x27;1976&#x27;, &#x27;1977&#x27;, &#x27;1978&#x27;, &#x27;1979&#x27;, &#x27;1980&#x27;, &#x27;1981&#x27;, &#x27;1982&#x27;, &#x27;1983&#x27;    db &#x27;1984&#x27;, &#x27;1985&#x27;, &#x27;1986&#x27;, &#x27;1987&#x27;, &#x27;1988&#x27;, &#x27;1989&#x27;, &#x27;1990&#x27;, &#x27;1991&#x27;, &#x27;1992&#x27;    db &#x27;1993&#x27;, &#x27;1994&#x27;, &#x27;1995&#x27;    ;æ”¶å…¥    dd 16, 22, 382, 1356, 2390, 8000, 16000, 24486, 50065, 97479, 140417, 197514    dd 345980, 590827, 803530, 1183000, 1843000, 2759000, 3753000, 4649000, 5937000    ;å‘˜å·¥    dw 3, 7, 9, 13, 28, 38, 130, 220, 476, 778, 1001, 1442, 2258, 2793, 4037, 5635, 8226    dw 11542, 14430, 15257, 17800data endstable segment    db 21 dup (&#x27;year sumn ne ?? &#x27;)table ends\nå°† data æ®µä¸­çš„æ•°æ®æŒ‰å¦‚ä¸‹æ ¼å¼å†™å…¥åˆ° table æ®µä¸­ï¼Œå¹¶è®¡ç®— 21 å¹´ä¸­çš„äººå‡æ”¶å…¥ (å–æ•´), ç»“æœä¹ŸæŒ‰ç…§ä¸‹é¢çš„æ ¼å¼ä¿å­˜åœ¨ table æ®µä¸­\næç¤º\nå¯å°†dataæ®µä¸­çš„æ•°æ®çœ‹æˆæ˜¯å¤šä¸ªæ•°ç»„,è€Œå°†tableä¸­çš„æ•°æ®çœ‹æˆæ˜¯ä¸€ä¸ªç»“æ„å‹æ•°æ®çš„æ•°ç»„,æ¯ä¸ªç»“æ„å‹æ•°æ®ä¸­åŒ…å«å¤šä¸ªæ•°æ®é¡¹ã€‚\nå¯ç”¨diå®šä½tableæ®µä¸­å¯¹åº”çš„å­˜å‚¨å•å…ƒ,ç”¨idataå®šä½æ•°æ®é¡¹,ç”¨siå®šä½dataæ®µä¸­çš„æ¯ä¸ªå…ƒç´ \n\nè§£ç­”ä»£ç \nassume cs:code,ss:stack,ds:datadata segment    ;å¹´ä»½    db &#x27;1975&#x27;, &#x27;1976&#x27;, &#x27;1977&#x27;, &#x27;1978&#x27;, &#x27;1979&#x27;, &#x27;1980&#x27;, &#x27;1981&#x27;, &#x27;1982&#x27;, &#x27;1983&#x27;    db &#x27;1984&#x27;, &#x27;1985&#x27;, &#x27;1986&#x27;, &#x27;1987&#x27;, &#x27;1988&#x27;, &#x27;1989&#x27;, &#x27;1990&#x27;, &#x27;1991&#x27;, &#x27;1992&#x27;    db &#x27;1993&#x27;, &#x27;1994&#x27;, &#x27;1995&#x27;    ;æ”¶å…¥    dd 16, 22, 382, 1356, 2390, 8000, 16000, 24486, 50065, 97479, 140417, 197514    dd 345980, 590827, 803530, 1183000, 1843000, 2759000, 3753000, 4649000, 5937000    ;å‘˜å·¥    dw 3, 7, 9, 13, 28, 38, 130, 220, 476, 778, 1001, 1442, 2258, 2793, 4037, 5635, 8226    dw 11542, 14430, 15257, 17800data endstable segment    db 21 dup (&#x27;year sumn ne ?? &#x27;)table endsstack segment\tdw 8 dup (0)stack endscode segmentmain:\tmov ax,data\tmov ds,ax\tmov ax,table\tmov es,ax\tmov ax,stack\tmov ss,ax\tmov sp,10H;å¤åˆ¶å¹´ä»½åˆ°tableä¸­\tmov si,0\tmov di,0\tmov cx,21s1:\tmov ax,ds:[si]\tmov es:[di],ax\tmov ax,ds:[si+2]\tmov es:[di+2],ax\tmov al,20H ;å­˜å‚¨ç©ºæ ¼åˆ°tableä¸­çš„å¯¹åº”ä½ç½®\tmov es:[di+4],al\t\tadd si,4\tadd di,10H\tloop s1;å¤åˆ¶æ”¶å…¥åˆ°tableä¸­\tmov si,84\tmov di,5\tmov cx,21s2:\tmov ax,ds:[si]\tmov es:[di],ax\tmov ax,ds:[si+2]\tmov es:[di+2],ax\tmov al,20H\tmov es:[di+4],al\t\tadd si,4\tadd di,10H\tloop s2;å¤åˆ¶äººæ•°åˆ°tableä¸­\tmov si,168\tmov di,10\tmov cx,21s3:\tmov ax,ds:[si]\tmov es:[di],ax\tmov al,20H\tmov es:[di+2],al\t\tadd si,2\tadd di,10H\tloop s3;è®¡ç®—äººå‡æ”¶å…¥\tmov bx,0\tmov cx,21s4:\tmov ax,es:[bx+5] ;é™¤æ•°æ˜¯dw,16ä½,æ‰€ä»¥è¢«é™¤æ•°åº”è¯¥æ˜¯32ä½,ä½¿ç”¨DX:AXæ¥å­˜å‚¨\tmov dx,es:[bx+7]\tdiv word ptr es:[bx+10];æ˜¾å¼åœ°å‘Šè¯‰ç¼–è¯‘å™¨,é™¤æ•°æ˜¯16ä½,å­—å‹\tmov es:[bx+13],ax\t\t;å•†å­˜å‚¨åœ¨axä¸­,ä½™æ•°å­˜å‚¨åœ¨dxä¸­\tmov al,20H\tmov es:[bx+15],al\t\tadd bx,10H\tloop s4\tmov ax,4c00H\tint 21Hcode endsend main\n","categories":["ç¼–ç¨‹"],"tags":["æ±‡ç¼–è¯­è¨€"]},{"title":"æ•°æ®ç»“æ„æœŸæœ«å¤ä¹ ","url":"/2025/01/01/school_assignments/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E6%9C%9F%E6%9C%AB%E8%80%83%E7%BA%B2%E5%A4%8D%E4%B9%A0/","content":"\næ•°æ®ç»“æ„çš„æœŸæœ«å¤ä¹ è€ƒçº²\n\n\næ•°æ®ç»“æ„æœŸæœ«è€ƒçº²\né¡ºåºè¡¨å’Œé“¾è¡¨çš„ç±»å‹å®šä¹‰\n\n\n**é¡ºåºè¡¨:**ç”¨ä¸€ç»„åœ°å€è¿ç»­çš„å­˜å‚¨å•å…ƒä¾æ¬¡å­˜æ”¾çº¿æ€§è¡¨ä¸­çš„æ‰€æœ‰å…ƒç´ , å…ƒç´ çš„å­˜å‚¨ä½ç½®ä¸é€»è¾‘ä½ç½®æ˜¯ä¸€ä¸€å¯¹åº”å…³ç³»\n\n\ntemplate&lt;typename T,size_t N&gt;struct SeqList&#123;    T data[N];    int length;    SeqList():length(0) &#123;&#125;;        size_t getCapacity() const &#123;        return N;    &#125;&#125;;using IntSeqList = SeqList&lt;int,100&gt;;\n\n\né“¾è¡¨: ç”¨ä¸€ç»„åœ°å€éè¿ç»­çš„å­˜å‚¨å•å…ƒä¾æ¬¡å­˜æ”¾çº¿æ€§è¡¨ä¸­çš„æ‰€æœ‰å…ƒç´ , å…ƒç´ é—´çš„å…ˆåå…³ç³»åˆ©ç”¨æŒ‡é’ˆæ¥è¡¨ç¤º\n\n\ntemplate&lt;typename T&gt;struct Node &#123;    T data;    Node* next;    Node&lt;T&gt;() : next(nullptr) &#123;&#125;;&#125;;using LinkList = Node&lt;int&gt;*;\nå°†ä¸¤ä¸ªæœ‰åºçš„é¡ºåºè¡¨(é“¾è¡¨)åˆå¹¶ä¸ºä¸€ä¸ªæœ‰åºçš„é¡ºåºè¡¨(é“¾è¡¨) åˆ†æåˆå¹¶æ“ä½œçš„å¤æ‚åº¦\n\n\né¡ºåºè¡¨\n\n\nIntSeqList mergeSeqList(IntSeqList&amp; s1, IntSeqList&amp; s2)&#123;    if(s1 == NULL)&#123;        s1 = s2;        return s1;    &#125;    if(s2 == NULL) return s1;    \tint size1 = s1.length;    int size2 = s2.length;    int total_size = size1 + size2;    IntSeqList new_seqlist;    new_seqlist.length = total_size;    \tint index1 = 0;int index2 = 0;    int k = 0;    while(index1 &lt; size1 &amp;&amp; index2 &lt; size2)&#123;\t\tif(s1.data[index1]&lt;s2.data[index2])  &#123; new_seqlist.data[k] = s1.data[index1]; index1++;&#125;        else  &#123; new_seqlist.data[k] = s2.data[index2]; index2++; &#125;        k++;             &#125;        if(index1 &lt; size1 &amp;&amp; index2 == size2)&#123;       \twhile(index1 &lt; size1)&#123;            new_seqlist.data[k] = s1.data[index1];            k++;            index1++;\t\t&#125;    &#125;    else if(index1 == size1 &amp;&amp; index2 &lt; size2)&#123;        while(index2 &lt; size2)&#123;            new_seqlist.data[k] = s2.data[index2];            k++;            index2++;\t\t&#125;\t&#125;   return new_seqlist;&#125;\n**æ—¶é—´å¤æ‚åº¦ï¼š**O(n + m)\n**ç©ºé—´å¤æ‚åº¦ï¼š**O(n + m)\n\n\né“¾è¡¨\n\n\nNode&lt;int&gt;* mergeLinkedList(LinkList&amp; l1, LinkList&amp; l2) &#123;    if (l1 == nullptr) &#123;        l1 = l2;        return l1;    &#125;    if (l2 == nullptr) return l1;    LinkList cur = l1;    LinkList temp1 = l1-&gt;next; LinkList temp2 = l2-&gt;next;    while (temp1 &amp;&amp; temp2) &#123;        if (temp1-&gt;data &lt; temp2-&gt;data) &#123;            cur-&gt;next = temp1;            temp1 = temp1-&gt;next;        &#125;        else &#123;            cur-&gt;next = temp2;            temp2 = temp2-&gt;next;        &#125;        cur = cur-&gt;next;    &#125;    cur-&gt;next = temp1 ? temp1 : temp2;    delete l2;    return l1;&#125;\n**æ—¶é—´å¤æ‚åº¦ï¼š**O(n + m)\n**ç©ºé—´å¤æ‚åº¦ï¼š**O(1)\nåœ¨é“¾è¡¨(é¡ºåºè¡¨)çš„æŸä¸ªèŠ‚ç‚¹åæ’å…¥ä¸€ä¸ªèŠ‚ç‚¹\né“¾è¡¨\nvoid insertNode(LinkList l, int index, T data) &#123;    LinkList cur = l;    while (index--) &#123;        cur = cur-&gt;next;    &#125;    Node&lt;T&gt;* new_node = new Node&lt;T&gt;;    new_node-&gt;data = data;    new_node-&gt;next = cur-&gt;next;    cur-&gt;next = new_node;&#125;\né¡ºåºè¡¨\ntemplate&lt;typename T&gt;void insertNode(IntSeqList&amp; s, int index, T data) &#123;    if (index &gt; s.length &amp;&amp; s.length + 1 &gt; s.getCapacity()) return;    if (index &lt;= 0) &#123;        for (int i = s.length - 1; i &gt;= 0; i--) &#123;            s.data[i + 1] = s.data[i];        &#125;        s.data[0] = data;        s.length++;        return;    &#125;    for (int i = s.length - 1; i &gt;= index; i--) &#123;        s.data[i + 1] = s.data[i];    &#125;    s.data[index] = data;    s.length++;    return;&#125;\nå°†ä¸€ä¸ªé“¾è¡¨(é¡ºåºè¡¨)è¿›è¡Œå€’ç½® å¹¶åˆ†æå€’ç½®æ“ä½œçš„å¤æ‚åº¦\né“¾è¡¨\nvoid reverseLL(LinkList l)&#123;    LinkList pre = nullptr;    LinkList cur = l;        while(cur)&#123;        LinkList temp = cur-&gt;next;        cur-&gt;next = pre;        pre = cur;        cur = temp;    &#125;    l = pre;&#125;\n**æ—¶é—´å¤æ‚åº¦ï¼š**O(n)\n**ç©ºé—´å¤æ‚åº¦ï¼š**O(1)\né¡ºåºè¡¨\nvoid reverseSeq(IntSeqList&amp; s)&#123;\tint i = 0; int j = s.length-1;    while(i&lt;j)&#123;        int temp  = s.data[j];        s.data[j] = s.data[i];        s.data[i] = temp;        i++;        j--;    &#125;&#125;\n**æ—¶é—´å¤æ‚åº¦ï¼š**O(n)\n**ç©ºé—´å¤æ‚åº¦ï¼š**O(1)\næ— å‘å›¾çš„é“¾æ¥è¡¨è¡¨ç¤ºæ³•å’Œé‚»æ¥çŸ©é˜µè¡¨ç¤ºæ³•\né‚»æ¥çŸ©é˜µè¡¨ç¤ºæ³•: åˆ©ç”¨äºŒç»´æ•°ç»„æ¥è¡¨ç¤ºä¸€ä¸ªå›¾,äºŒç»´æ•°ç»„ä¸­çš„æ¯ä¸€ä¸ªå…ƒç´ è¡¨ç¤ºç›¸åº”çš„ä¸¤ä¸ªé¡¶ç‚¹ä¹‹é—´çš„å…³ç³»\nâ€‹\t\t\t     æ— å‘å›¾çš„é‚»æ¥çŸ©é˜µä¸ºå¯¹ç§°çŸ©é˜µ\né“¾æ¥è¡¨è¡¨ç¤ºæ³•: å°†å›¾çš„æ¯ä¸€ä¸ªé¡¶ç‚¹çš„é‚»æ¥ç‚¹å­˜æ”¾åœ¨ä¸€ä¸ªé“¾è¡¨ä¸­ æ¯ä¸ªé¡¶ç‚¹å¯¹åº”ä¸€æ¡é“¾è¡¨,æ‰€æœ‰çš„å¤´èŠ‚ç‚¹å­˜æ”¾åœ¨ä¸€ä¸ªæ•°ç»„ä¸­\nåˆ©ç”¨DFSæˆ–BFSæ±‚ä¸€ä¸ªå›¾çš„è¿é€šåˆ†é‡æ•°\nDFS\né€’å½’ç‰ˆ(å›¾åˆ©ç”¨é‚»æ¥çŸ©é˜µæ¥è¡¨ç¤º)\nvoid DFS(vector&lt;vector&lt;int&gt;&gt;&amp; isConnected,vector&lt;int&gt;&amp; visited,int row)&#123;     for(int i = 0;i&lt;isConnected.size();i++)&#123;         if(isConnected[row][i]&amp;&amp;!visited[i])&#123;            visited[i] = 1;            DFS(isConnected,visited,i);         &#125;     &#125;&#125;int findCircleNum(vector&lt;vector&lt;int&gt;&gt;&amp; isConnected) &#123;    int num = 0;    vector&lt;int&gt; visited(isConnected.size(),0);    for(int i = 0;i&lt;isConnected.size();i++)&#123;     \tif(!visited[i])&#123;            DFS(isConnected,visited,i);            num++;         &#125;     &#125;    return num;&#125;\næ ˆå®ç°\nint findCircleNum(vector&lt;vector&lt;int&gt;&gt;&amp; isConnected) &#123;    int num = 0;    vector&lt;int&gt; visited(isConnected.size(), 0);    stack&lt;int&gt; s;    for(int i = 0; i &lt; isConnected.size(); i++) &#123;        if(!visited[i]) &#123;            s.push(i);            while(!s.empty()) &#123;                int temp = s.top();                s.pop();                visited[temp] = 1;                for(int j = 0; j &lt; isConnected.size(); j++) &#123;                    if(isConnected[temp][j] &amp;&amp; !visited[j]) &#123;                        s.push(j);                    &#125;                &#125;            &#125;            num++;        &#125;    &#125;    return num;&#125;\nBFS\nint findCircleNum(vector&lt;vector&lt;int&gt;&gt;&amp; isConnected) &#123;    int num = 0;    vector&lt;int&gt; visited(isConnected.size(), 0);    queue&lt;int&gt; q;    for (int i = 0; i &lt; isConnected.size(); i++) &#123;        if (!visited[i]) &#123;            q.push(i);            while (!q.empty()) &#123;                int temp = q.front();                q.pop();                visited[temp] = 1;                for (int j = 0; j &lt; isConnected.size(); j++) &#123;                   if (isConnected[temp][j] &amp;&amp; !visited[j]) &#123;                       q.push(j);                    &#125;                &#125;            &#125;            num++;        &#125;    &#125;    return num;&#125;\nåˆ©ç”¨Floydç®—æ³•æ±‚å›¾çš„ä»»æ„ä¸¤ç‚¹çš„æœ€çŸ­è·ç¦»ï¼Œå›¾çš„ä¼ é€’é—­åŒ…(Floyd-Warshall)\n//æœ€çŸ­è·ç¦»void floyd(vector&lt;vector&lt;int&gt;&gt;&amp; matrix,vector&lt;vector&lt;int&gt;&gt;&amp; grid)&#123;    grid = matrix;    int n = grid.size();    for(int k = 0; k &lt; n;K++)&#123;\t\tfor(int i = 0; i &lt; n;i++)&#123;            for(int j = 0; j &lt; n;j++)&#123;                grid[i][j]=min(grid[i][j],grid[i][k]+grid[k][j]);            &#125;        &#125;    &#125;&#125;//ä¼ é€’é—­åŒ…(ä½¿ç”¨å‰éœ€å°†çŸ©é˜µè½¬æ¢ä¸ºä½¿ç”¨0å’Œ1è¡¨è¾¾çš„çŸ©é˜µ)void floydWarshall(vector&lt;vector&lt;int&gt;&gt;&amp; matrix) &#123;    int n = matrix.size();    for (int k = 0; k &lt; n; k++) &#123;        for (int i = 0; i &lt; n; i++) &#123;            for (int j = 0; j &lt; n; j++) &#123;                matrix[i][j] |= matrix[i][k] &amp; matrix[k][j];            &#125;        &#125;    &#125;&#125;\nåˆ¤æ–­ä¸¤ä¸ªå·¦å³é“¾è¡¨è¡¨ç¤ºçš„äºŒå‰æ ‘æ˜¯å¦ç­‰ä»· å¹¶åˆ†ææ—¶é—´å¤æ‚åº¦\nstruct TreeNode &#123;    int val;    TreeNode *left;    TreeNode *right;    TreeNode() : val(0), left(nullptr), right(nullptr) &#123;&#125;    TreeNode(int x) : val(x), left(nullptr), right(nullptr) &#123;&#125;    TreeNode(int x, TreeNode *left, TreeNode *right) : val(x), left(left), right(right) &#123;&#125;&#125;;bool isSameTree(TreeNode* p, TreeNode* q) &#123;    if(p == nullptr &amp;&amp; q == nullptr) return true;    if(p == nullptr || q == nullptr) return false;    if(p-&gt;val != q-&gt;val) return false;    return isSameTree(p-&gt;left, q-&gt;left) &amp;&amp; isSameTree(p-&gt;right, q-&gt;right);&#125;\n**æ—¶é—´å¤æ‚åº¦ï¼š**O(n)\nå°†ä¸€ä¸ªæ•´æ•°åºåˆ—è½¬åŒ–ä¸ºå¤§é¡¶å †(å°é¡¶å †)çš„è¿‡ç¨‹æè¿°\nå¤§é¡¶å †\n\n\nå°†æ­¤æ•´æ•°åºåˆ—çœ‹ä½œä¸€æ£µå®Œå…¨äºŒå‰æ ‘çš„æ•°ç»„å½¢å¼\n\n\nä»æœ€åä¸€ä¸ªéå¶èŠ‚ç‚¹å¼€å§‹è¿›è¡Œä¸‹æ²‰æ“ä½œ,ä¿è¯çˆ¶èŠ‚ç‚¹å¤§äºå­èŠ‚ç‚¹,ä½¿å…¶å †åŒ–\n\n\nå€’åºéå†æ¯ä¸ªèŠ‚ç‚¹,é‡å¤ä¸Šè¿°æ“ä½œ ç›´è‡³æ ¹èŠ‚ç‚¹\n\n\nåˆ é™¤å †é¡¶(å¤§é¡¶å †æˆ–å°é¡¶å †)çš„è¿‡ç¨‹æè¿°\n\n\nå°†å †é¡¶å…ƒç´ ä¸å †ä¸­æœ€åä¸€ä¸ªå…ƒç´ äº’æ¢\n\n\nåˆ é™¤æœ€åä¸€ä¸ªå…ƒç´ \n\n\nä»å †é¡¶å…ƒç´ å¼€å§‹,ä»é¡¶è‡³åº•è¿›è¡Œä¸‹æ²‰æ“ä½œä½¿å…¶å †åŒ–\n\n\næ„å»ºå“ˆå¤«æ›¼æ ‘çš„è¿‡ç¨‹, å¹¶è®¡ç®—å¸¦æƒè·¯å¾„é•¿åº¦\nå‡è®¾ç»™äº†nä¸ªå…ƒç´ \n\n\nå°†è¿™nä¸ªå…ƒç´ çœ‹ä½œnæ£µåªæœ‰ä¸€ä¸ªèŠ‚ç‚¹çš„äºŒå‰æ ‘,ä»–ä»¬æ„æˆäº†æ£®æ—F\n\n\nä»æ£®æ—Fä¸­é€‰æ‹©ä¸¤ä¸ªæƒå€¼æœ€å°çš„èŠ‚ç‚¹(æ ‘)æ„æˆä¸€ä¸ªæ–°æ ‘, æ–°æ ‘çš„æ ¹èŠ‚ç‚¹çš„æƒå€¼ä¸ºè¿™ä¸¤ä¸ªèŠ‚ç‚¹æƒå€¼çš„å’Œ\n\n\nå°†è¿™é¢—æ–°æ ‘åŠ å…¥åˆ°æ£®æ—Fä¸­ å¹¶åˆ é™¤Fä¸­çš„é‚£ä¸¤ä¸ªè¢«åˆå¹¶çš„èŠ‚ç‚¹\n\n\né‡å¤ä¸Šè¿°è¿‡ç¨‹ ç›´è‡³æ£®æ—ä¸­åªå‰©ä¸‹ä¸€ä¸ªæ ‘ è¯¥æ ‘å³ä¸ºå“ˆå¤«æ›¼æ ‘\n\n\n**å¸¦æƒè·¯å¾„é•¿åº¦:**æ¯ä¸ªå¶èŠ‚ç‚¹çš„æƒå€¼ä¸å…¶åˆ°æ ¹èŠ‚ç‚¹çš„è·¯å¾„é•¿åº¦çš„ä¹˜ç§¯ä¹‹å’Œ\nåˆ©ç”¨æ ˆæ±‚é€†æ³¢å…°è¡¨è¾¾å¼çš„å€¼\nå‡è®¾è¯¥é€†æ³¢å…°è¡¨è¾¾å¼ç¬¦åˆè§„èŒƒ\n\n\nå°†è¯¥è¡¨è¾¾å¼ä¸­çš„å…ƒç´ ä¾æ¬¡éå†\n\n\nå¦‚æœè¯¥å…ƒç´ æ˜¯æ“ä½œæ•° é‚£ä¹ˆå‹å…¥æ ˆä¸­ ç»§ç»­éå†ä¸‹ä¸€ä¸ªå…ƒç´ \n\n\nå¦‚æœè¯¥å…ƒç´ æ˜¯æ“ä½œç¬¦ é‚£ä¹ˆä»æ ˆä¸­å¼¹å‡ºæ‰€éœ€æ•°é‡çš„å…ƒç´ è¿›è¡Œè®¡ç®— å¹¶å°†è®¡ç®—ç»“æœå‹å…¥æ ˆä¸­\n\n\né‡å¤ä¸Šè¿°æ“ä½œ ç›´è‡³éå†ç©è¡¨è¾¾å¼ä¸­æ‰€æœ‰å…ƒç´  æ ˆé¡¶å…ƒç´ å³ä¸ºè¯¥è¡¨è¾¾å¼çš„ç»“æœ\n\n\næœ€å°ç”Ÿæˆæ ‘çš„æ„å»ºæ–¹æ³•\nPrim\n\n\næ„é€ ä¸€ä¸ªåä¸ºminDistçš„æ•°ç»„,ç”¨æ¥è®°å½•æ¯ä¸ªèŠ‚ç‚¹è·ç¦»ç”Ÿæˆæ ‘çš„æœ€çŸ­è·ç¦»,é•¿åº¦ä¸ºn,nä¸ºé¡¶ç‚¹çš„æ•°é‡\n\n\næ„é€ ä¸€ä¸ªåä¸ºvisitedçš„æ•°ç»„,ç”¨æ¥è®°å½•å“ªäº›èŠ‚ç‚¹å·²ç»è¢«æ·»åŠ åˆ°æœ€å°ç”Ÿæˆæ ‘ä¸­,é•¿åº¦ä¸ºn\n\n\néšæœºé€‰æ‹©ä¸€ä¸ªèŠ‚ç‚¹ä½œä¸ºç¬¬ä¸€ä¸ªèŠ‚ç‚¹åŠ å…¥åˆ°æœ€å°ç”Ÿæˆæ ‘ä¸­å¹¶å°†å…¶åœ¨visitedæ•°ç»„ä¸­æ ‡è®°ä¸ºtrue\n\n\næ›´æ–°minDistæ•°ç»„ å³æ›´æ–°æœªè¢«visitedæ•°ç»„æ ‡è®°çš„èŠ‚ç‚¹åˆ°ç”Ÿæˆæ ‘çš„è·ç¦»\n\n\né€‰æ‹©minDistæ•°ç»„ä¸­å€¼æœ€å°ä¸”æœªè¢«visitedæ•°ç»„æ ‡è®°çš„èŠ‚ç‚¹åŠ å…¥ç”Ÿæˆæ ‘ å¹¶å°†è¯¥èŠ‚ç‚¹æ ‡è®°ä¸ºtrue\n\n\né‡å¤ä¸Šè¿°è¿‡ç¨‹n-1æ¬¡å³å¯å®Œæˆæ„å»º\n\n\nKruskal\n\n\nå°†å›¾ä¸­çš„è¾¹æŒ‰ç…§æƒå€¼ç”±å°åˆ°å¤§è¿›è¡Œæ’åº\n\n\nåˆå§‹åŒ–å¹¶æŸ¥é›†,ä½¿æ¯ä¸ªé¡¶ç‚¹è‡ªæˆä¸€ä¸ªé›†åˆ\n\n\nå¯¹æ’åºåçš„è¾¹è¿›è¡Œéå†\n\n\nåˆ©ç”¨å¹¶æŸ¥é›†åˆ¤æ–­è¯¥è¾¹çš„ä¸¤ä¸ªé¡¶ç‚¹æ˜¯å¦åœ¨åŒä¸€ä¸ªé›†åˆä¸­\n\n\nå¦‚æœåœ¨ åˆ™ä¸èƒ½å°†æ­¤è¾¹åŠ å…¥ç”Ÿæˆæ ‘ å¦åˆ™ä¼šå½¢æˆç¯\n\n\nå¦‚æœä¸åœ¨ åˆ™å°†æ­¤è¾¹åŠ å…¥ç”Ÿæˆæ ‘ å¹¶å°†è¿™ä¸¤ä¸ªé¡¶ç‚¹æ‰€åœ¨çš„é›†åˆåˆå¹¶\n\n\né‡å¤ä¸Šè¿°è¿‡ç¨‹ ç›´è‡³ç”Ÿæˆæ ‘ä¸­æœ‰n-1æ¡è¾¹(nä¸ºé¡¶ç‚¹æ•°ç›®) æˆ–éå†ç»“æŸ\n\n\nåˆ©ç”¨Dijkstraæ±‚å•æºæœ€çŸ­è·ç¦»å’Œæœ€çŸ­è·¯å¾„,äº†è§£U då’Œpçš„å«ä¹‰;å¦‚ä½•æ ¹æ®pæ±‚åˆ°æ¯ä¸€ä¸ªé¡¶ç‚¹åˆ°æºç‚¹çš„æœ€çŸ­è·¯å¾„\n**U:**å·²ç»æ±‚å‡ºä¸æºç‚¹çš„æœ€çŸ­è·ç¦»çš„é¡¶ç‚¹çš„é›†åˆ\n**d:**ç”¨æ¥å­˜æ”¾é¡¶ç‚¹åˆ°æºç‚¹æœ€çŸ­è·ç¦»çš„æ•°ç»„,d[i]ä»£è¡¨é¡¶ç‚¹iåˆ°æºç‚¹çš„æœ€çŸ­è·ç¦»\n**p:**ç”¨æ¥å­˜æ”¾æœ€çŸ­è·¯å¾„æ ‘ä¸­æ¯ä¸ªèŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹çš„æ•°ç»„,p[i]ä»£è¡¨æœ€çŸ­è·¯å¾„æ ‘ä¸­èŠ‚ç‚¹içš„çˆ¶èŠ‚ç‚¹\nvoid getPath(int p[N],int v)&#123;\tif(v==p[v])&#123;        cout&lt;&lt;v&lt;&lt;&quot; &quot;;        return;    &#125;    getPath(p,p[v]);    cout&lt;&lt;v&lt;&lt;&quot; &quot;;&#125;\næ‹“æ‰‘æ’åºå’Œå…³é”®è·¯å¾„çš„æ±‚æ³•\næ‹“æ‰‘æ’åº\n\n\nå®šä¹‰ä¸€ä¸ªé˜Ÿåˆ—q,ç»Ÿè®¡å›¾ä¸­æ¯ä¸€ä¸ªé¡¶ç‚¹çš„å…¥åº¦,å°†å…¥åº¦ä¸ºé›¶çš„é¡¶ç‚¹åŠ å…¥é˜Ÿåˆ—qä¸­\n\n\nä»é˜Ÿåˆ—qä¸­å–å‡ºä¸€ä¸ªé¡¶ç‚¹u,å°†å…¶åŠ å…¥åˆ°æ‹“æ‰‘åºåˆ—ä¸­\n\n\néå†é¡¶ç‚¹uçš„æ‰€æœ‰å‡ºè¾¹,å°†è¿™äº›ç›¸é‚»ç‚¹çš„å…¥åº¦å‡ä¸€,è‹¥å…¶å…¥åº¦å˜ä¸ºé›¶,åˆ™å°†å…¶åŠ å…¥åˆ°é˜Ÿåˆ—qä¸­\n\n\né‡å¤ä¸Šè¿°æ­¥éª¤,ç›´è‡³é˜Ÿåˆ—qä¸ºç©º\n\n\nå¦‚æœé˜Ÿåˆ—qä¸ºç©ºæ—¶ ä»æœ‰é¡¶ç‚¹æœªåŠ å…¥åˆ°æ‹“æ‰‘åºåˆ—ä¸­ è¯´æ˜è¯¥å›¾å­˜åœ¨ç¯ ä¸å­˜åœ¨æ‹“æ‰‘åºåˆ—\n\n\nå…³é”®è·¯å¾„\n\n\nå¯¹å›¾ä¸­å„é¡¶ç‚¹è¿›è¡Œæ‹“æ‰‘æ’åºï¼Œå¾—åˆ°æ‹“æ‰‘åºåˆ—\n\n\næŒ‰ç…§æ‹“æ‰‘åºåˆ—çš„é¡ºåº ä¾æ¬¡è®¡ç®—æ¯ä¸ªäº‹ä»¶çš„æœ€æ—©å‘ç”Ÿæ—¶é—´\n\n\nå†æ ¹æ®æ¯ä¸ªäº‹ä»¶çš„æœ€æ—©å‘ç”Ÿæ—¶é—´ æ±‚å‡ºæ¯ä¸ªæ´»åŠ¨çš„æœ€æ—©å‘ç”Ÿæ—¶é—´\n\n\næŒ‰ç…§é€†æ‹“æ‰‘åº ä¾æ¬¡è®¡ç®—æ¯ä¸ªäº‹ä»¶çš„æœ€æ™šå‘ç”Ÿæ—¶é—´\n\n\néå†æ¯ä¸€ä¸ªæ´»åŠ¨ï¼Œè®¡ç®—å…¶æœ€æ—©å‘ç”Ÿæ—¶é—´ä¸æœ€æ™šå‘ç”Ÿæ—¶é—´ä¹‹å·® è‹¥ä¸ºé›¶ åˆ™å°†è¯¥æ´»åŠ¨åŠ å…¥å…³é”®è·¯å¾„\n\n\näºŒåˆ†æŸ¥æ‰¾åŠå…¶å¤æ‚åº¦åˆ†æ\nä¸»è¦éƒ¨åˆ†ä¸æ’å€¼æŸ¥æ‰¾ç›¸åŒ ä¸åŒç‚¹ä¸º mid = left+0.5*(right-left)\næ—¶é—´å¤æ‚åº¦ä¸º O(log n)\nç©ºé—´å¤æ‚åº¦ä¸º O(1)\næ’å€¼æŸ¥æ‰¾\n\n\nç¡®å®šè¢«æŸ¥æ‰¾ç›®æ ‡æ‰€åœ¨çš„èŒƒå›´è¾¹ç•Œ,å·¦è¾¹ç•Œè®°ä¸ºleft,å³è¾¹ç•Œè®°ä¸ºright\n\n\nè®¾ç½®æŸ¥æ‰¾ç‚¹ä¸‹æ ‡ä¸º $mid=left+ (key-array[left]/array[right]-array[left])*(right-left)$\n\n\nå¼€å§‹å¾ªç¯ ä¿è¯leftä¸å¤§äºright\n\n\nåˆ¤æ–­ä»¥midä¸ºä¸‹æ ‡çš„æ•°ç»„å…ƒç´ æ˜¯å¦ç­‰äºç›®æ ‡å€¼\n\n\nå¦‚æœç­‰äº åˆ™æ‰¾åˆ°ç›®æ ‡ é€€å‡ºå¾ªç¯\n\n\nå¦‚æœå¤§äºç›®æ ‡å…ƒç´  åˆ™ä»¤right = mid - 1\n\n\nå¦‚æœå°äºç›®æ ‡å…ƒç´  åˆ™å¦left = mid + 1\n\n\næŒ‰ç…§ä»¥ä¸Šæè¿°è¿›è¡Œå¾ªç¯ç›´è‡³æ‰¾åˆ°ç›®æ ‡å€¼ æˆ–ä¸æ»¡è¶³å¾ªç¯æ¡ä»¶æ—¶é€€å‡ºå¾ªç¯\n\n\næ—¶é—´å¤æ‚åº¦æ˜¯O(loglogN)\nå½“æœ‰åºåºåˆ—ä¸­çš„å…ƒç´ å‘ˆå‡åŒ€åˆ†å¸ƒæ—¶æ’å€¼æŸ¥æ‰¾ä¼˜äºäºŒåˆ†æŸ¥æ‰¾\nKMPç®—æ³•\nä»¤æ¨¡å¼ä¸²ä¸ºt ä¸»ä¸²ä¸ºs\n\n\nå®šä¹‰ä¸¤ä¸ªæ•´æ•°iï¼Œj åˆ†åˆ«è¡¨ç¤ºä¸»ä¸²å’Œæ¨¡å¼ä¸²çš„ä¸‹æ ‡ï¼Œåˆå§‹å€¼è®¾ç½®ä¸º0\n\n\nå½“j == -1 æˆ– t[j] == s[i]æ—¶ iå’ŒjåŒæ—¶åŠ ä¸€ å³åŒæ—¶å‘åç§»åŠ¨ä¸€ä½\n\n\nå¦‚æœt[j] != s[i]æ—¶ ä»¤j=next[j]\n\n\né‡å¤ä¸Šè¿°è¿‡ç¨‹ç›´è‡³éå†å®Œiä¸»ä¸²æˆ–jéå†å®Œæ¨¡å¼ä¸²\n\n\nnextæ•°ç»„\n\n\nä½¿ç”¨æ•´æ•°jä½œä¸ºä¸‹æ ‡æ¥éå†æ¨¡å¼ä¸²\n\n\nä»¤next[j] = ç¬¬jä½çš„å…¬å…±æœ€é•¿çœŸå‰åç¼€çš„é•¿åº¦ ç‰¹åˆ«è§„å®šnext[0]=-1\n\n\nä¼˜åŒ–nextæ•°ç»„\n\n\nåœ¨ä¸Šä¸€ä¸ªæ–¹æ³•æ±‚nextæ•°ç»„çš„åŸºç¡€ä¹‹ä¸Š åœ¨jéå†æ¨¡å¼ä¸²sçš„è¿‡ç¨‹ä¸­æ·»åŠ å¦‚ä¸‹åˆ¤æ–­\n\n\nåˆ¤æ–­ t[j]æ˜¯å¦ç­‰äºt[next[j]]\n\n\nå¦‚æœç­‰äº åˆ™ä»¤next[j] = next[next[j]]\n\n\näºŒå‰æŸ¥æ‰¾æ ‘\nç‰¹ç‚¹\n\n\nå¯¹äºæ ¹èŠ‚ç‚¹ï¼Œè‹¥å®ƒçš„å·¦å³å­æ ‘ä¸ä¸ºç©º, åˆ™å·¦å­æ ‘ä¸­æ‰€æœ‰èŠ‚ç‚¹çš„å€¼ &lt; æ ¹èŠ‚ç‚¹çš„å€¼ &lt; å³å­æ ‘ä¸­æ‰€æœ‰èŠ‚ç‚¹çš„å€¼\n\n\nè‹¥å®ƒçš„å·¦å³å­æ ‘éƒ½ä¸ä¸ºç©º,  åˆ™å®ƒçš„å·¦å³å­æ ‘ä¹Ÿåˆ†åˆ«ä¸ºäºŒå‰æŸ¥æ‰¾æ ‘\n\n\næ„å»ºäºŒå‰æŸ¥æ‰¾æ ‘\n\n\nå°†åºåˆ—çš„ç¬¬ä¸€ä¸ªå…ƒç´ ä½œä¸ºäºŒå‰æŸ¥æ‰¾æ ‘çš„æ ¹èŠ‚ç‚¹\n\n\næ¥ç€ä¾æ¬¡éå†åºåˆ—ä¸­çš„å‰©ä½™å…ƒç´ ,å¹¶å°†è¯¥å…ƒç´ ä½œä¸ºæ–°èŠ‚ç‚¹\n\n\nå¦‚æœæ–°èŠ‚ç‚¹çš„å€¼å°äºå½“å‰èŠ‚ç‚¹çš„å€¼ï¼Œåˆ™æ–°èŠ‚ç‚¹åº”æ’å…¥åˆ°å·¦å­æ ‘ä¸­\n\n\nå¦‚æœæ–°èŠ‚ç‚¹çš„å€¼å¤§äºå½“å‰èŠ‚ç‚¹çš„å€¼ï¼Œåˆ™æ–°èŠ‚ç‚¹åº”æ’å…¥åˆ°å³å­æ ‘ä¸­\n\n\né‡å¤ä¸Šä¸¤ä¸ªæ­¥éª¤ï¼Œç›´åˆ°æ‰¾åˆ°åˆé€‚çš„å¶å­ä½ç½®, å°†å…¶æ’å…¥æ ‘ä¸­\n\n\nå¯¹åºåˆ—ä¸­çš„æ¯ä¸ªå…ƒç´ è¿›è¡Œå¦‚ä¸Šæ“ä½œç›´è‡³éå†ç»“æŸ è‡³æ­¤äºŒå‰æŸ¥æ‰¾æ ‘æ„å»ºå®Œæˆ\n\n\nAVLæ ‘\nå››ç§åŸºæœ¬å½¢å¼åŠå¯¹åº”å˜å½¢æ“ä½œ\n\n\nLLæ—‹è½¬\nå‡è®¾èŠ‚ç‚¹Aæ˜¯å¤±è¡¡çš„èŠ‚ç‚¹ï¼ŒèŠ‚ç‚¹Bæ˜¯Açš„å·¦å­èŠ‚ç‚¹ï¼ŒèŠ‚ç‚¹Cæ˜¯Bçš„å³å­èŠ‚ç‚¹\n\n\nBå˜ä¸ºæ–°çš„æ ¹èŠ‚ç‚¹ã€‚\n\n\nAæˆä¸ºBçš„å³å­èŠ‚ç‚¹ã€‚\n\n\nCï¼ˆå¦‚æœå­˜åœ¨ï¼‰æˆä¸ºAçš„å·¦å­èŠ‚ç‚¹\n\n\n\n\n\nRRæ—‹è½¬\n\n\nâ€‹\tä¸LLæ“ä½œåä¹‹\n\n\nLRæ—‹è½¬\n\n\nâ€‹\tå‡è®¾èŠ‚ç‚¹Aæ˜¯å¤±è¡¡çš„èŠ‚ç‚¹ï¼ŒèŠ‚ç‚¹Bæ˜¯Açš„å·¦å­èŠ‚ç‚¹\nâ€‹\té¦–å…ˆå¯¹Açš„å·¦å­èŠ‚ç‚¹Bè¿›è¡ŒRRæ—‹è½¬ï¼Œç„¶åå¯¹Aè¿›è¡ŒLLæ—‹è½¬\n\n\n\nRLæ—‹è½¬\n\n\nâ€‹\tä¸LRåä¹‹\næ„å»ºAVLæ ‘\n\n\nå°†ç»™å®šæ•°æ®é›†çš„ç¬¬ä¸€ä¸ªå…ƒç´ ä½œä¸ºAVLæ ‘çš„æ ¹èŠ‚ç‚¹\n\n\næŒ‰ç…§äºŒå‰æŸ¥æ‰¾æ ‘çš„æ–¹å¼æ’å…¥æ–°çš„èŠ‚ç‚¹\n\n\næ¯æ¬¡æ’å…¥æ–°èŠ‚ç‚¹åï¼Œæ›´æ–°è¯¥èŠ‚ç‚¹åŠå…¶ç¥–å…ˆèŠ‚ç‚¹çš„é«˜åº¦\n\n\nåœ¨æ¯æ¬¡æ’å…¥æ“ä½œåï¼Œè®¡ç®—å½“å‰èŠ‚ç‚¹åŠå…¶ç¥–å…ˆèŠ‚ç‚¹çš„å¹³è¡¡å› å­ï¼ˆå·¦å­æ ‘é«˜åº¦å‡å»å³å­æ ‘é«˜åº¦ï¼‰ã€‚\n\n\nå¦‚æœå¹³è¡¡å› å­çš„ç»å¯¹å€¼å¤§äº1ï¼Œåˆ™è¯¥èŠ‚ç‚¹å¤±è¡¡, æ ¹æ®å¤±è¡¡èŠ‚ç‚¹çš„å…·ä½“æƒ…å†µè¿›è¡Œå¯¹åº”çš„æ—‹è½¬æ“ä½œ\n\n\né‡å¤ä¸Šè¿°è¿‡ç¨‹ ç›´è‡³æ‰€æœ‰å…ƒç´ è¢«æ·»åŠ åˆ°AVLæ ‘ä¸­\n\n\n","categories":["æ•°æ®ç»“æ„"],"tags":["C++"]},{"title":"è®¢é¤ç¨‹åºä¸­qtçš„ä½¿ç”¨(qtåŸºç¡€ç”¨æ³•)","url":"/2024/05/18/school_assignments/%E8%AE%A2%E9%A4%90%E7%A8%8B%E5%BA%8F%E4%B8%ADqt%E7%9A%84%E4%BD%BF%E7%94%A8-qt%E5%9F%BA%E7%A1%80%E7%94%A8%E6%B3%95/","content":"\nè®°å½•äº†ä¸€ä¸‹é¡¹ç›®åˆ¶ä½œè¿‡ç¨‹ä¸­ QtåŸºæœ¬APIçš„ä½¿ç”¨,ä»¥åŠä¸€äº›åŸºæœ¬æ¦‚å¿µæºç å¯è‡³GitHubæŸ¥çœ‹\n\n\nQtåŸºç¡€çŸ¥è¯†\nQtä¸­çš„çª—å£ç±»\n1.1 åŸºç¡€çª—å£ç±»\n\nå¸¸ç”¨çš„çª—å£ç±»æ˜¯å›¾ä¸­ä¸‹é¢ä¸‰ä¸ªï¼Œåœ¨åˆ›å»ºQtçª—å£æ—¶ï¼Œéœ€è¦è®©è‡ªå·±çš„çª—å£ç±»ç»§æ‰¿ä¸Šè¿°ä¸‰ä¸ªçª—å£ç±»ä¸­çš„ä¸€ä¸ª\n1.2 çª—å£çš„æ˜¾ç¤ºæ–¹å¼\næ¨¡æ€ï¼ˆmodalï¼‰çª—å£ï¼šçª—å£å¼¹å‡ºåï¼Œæ²¡å…³é—­ä¹‹å‰ï¼Œä¸å¯ä»¥å¯¹åŒä¸€åº”ç”¨ç¨‹åºçš„å…¶ä»–çª—å£è¿›è¡Œæ“ä½œï¼›éæ¨¡æ€ï¼ˆmodelessï¼‰çª—å£ï¼šçª—å£å¼¹å‡ºåï¼Œæ²¡å…³é—­ä¹‹å‰ï¼Œå¯ä»¥å¯¹åŒä¸€åº”ç”¨ç¨‹åºçš„å…¶ä»–çª—å£è¿›è¡Œæ“ä½œ\n1.3 æ¨¡æ€çª—å£çš„å®ç°æ–¹æ³•\n\nçª—å£çš„show()å‡½æ•°æ˜¾ç¤ºçš„ç±»å‹æ˜¯éæ¨¡æ€çš„ï¼Œæœ‰å‡ ç§æ–¹æ³•å¯ä»¥å°†çª—å£è®¾ä¸ºæ¨¡æ€ï¼Œå¦‚ä¸‹\n\n1.3.1 QDialogå¯¹è¯æ¡†\næ–¹æ³•ä¸€ï¼šexec()\nQDialog dlg(this);dlg.exec();//execæ˜¯executeï¼ˆæ‰§è¡Œï¼‰çš„ç¼©å†™ï¼Œå½“è°ƒç”¨exec()å‡½æ•°æ—¶ï¼Œå¹¶ä¸ä¼šç«‹å³è¿”å›ï¼Œåªç”¨å½“å¯¹è¯æ¡†å…³é—­æ‰ä¼šè¿”å›ï¼Œå› æ­¤ï¼Œåªæœ‰å…³é—­å¯¹è¯æ¡†æ‰ä¼šæ‰§è¡Œåç»­çš„ä»£ç \næ–¹æ³•äºŒï¼šsetModal()\nQDialog dlg(this);dlg.setModal(true);\t\t//ç›¸å½“äºdlg.setWindowModality(Qt::ApplicationModal);dlg.show();\næ–¹æ³•ä¸‰ï¼šsetWindowModality()\nQDialog dlg(this);dlg.setWindowModality(Qt::ApplicationModal);dlg.show();\n\n==setWindowModality()==çš„å‚æ•°è®¾ç½®è¦é˜»å¡çš„çª—å£ç±»å‹:\n\n\n\næšä¸¾å€¼\nå€¼\nè¯´æ˜\n\n\n\n\nQt::NonModal\n0\néæ¨¡æ€ï¼Œä¸é˜»å¡ä»»ä½•çª—å£\n\n\nQt::WindowModal\n1\nåŠæ¨¡æ€,çª—å£ææ¨¡æ€,é˜»å¡å®ƒçš„çˆ¶çª—å£ã€æ‰€æœ‰çš„ç¥–å…ˆçª—å£ä»¥åŠä»–ä»¬çš„å­çª—å£\n\n\nQt::ApplicationModal\n2\næ¨¡æ€,åº”ç”¨ç¨‹åºçº§æ¨¡æ€,é˜»å¡åº”ç”¨ç¨‹åºæ‰€æœ‰çš„çª—å£\n\n\n\n\nå¸¸ç”¨ç±»\nå­—ç¬¦ä¸²ç±»å‹\n\nC   ----&gt;   char*\nC++  ------&gt;   std::string\nQt   -------&gt;   QByteArray,QString\n\nç›¸å…³å‡½æ•°,æŸ¥é˜…qtä¸­çš„å¸®åŠ©æ–‡æ¡£,åœ¨å‘½ä»¤è¡Œä¸­è¾“å…¥assistant\nQVariantç±»\n\nç±»ä¼¼äºC++ä¸­çš„æ¨¡æ¿\nå¯ä»¥å¯¹ä¸åŒçš„æ•°æ®ç±»å‹è¿›è¡ŒåŒ…è£…,ä»è€Œä½¿ç”¨ç›¸åŒçš„å‡½æ•°å¯¹ä¸åŒç±»å‹çš„æ•°æ®è¿›è¡Œå¤„ç†\n\n2.2.1 å¯¹Qtä¸­çš„æ ‡å‡†ç±»å‹è¿›è¡Œå¤„ç†\nHelloQt::HelloQt(QWidget *parent): QMainWindow(parent)&#123;    ui.setupUi(this);    int value = dataPlus(10,20);    QString str = dataPlus(&quot;hello&quot;,&quot;world&quot;).toString();&#125;//dataPlus()å‡½æ•°åœ¨HelloQtç±»ä¸­å·²ç»è¢«å£°æ˜QVariant HelloQt::dataPlus(QVariant a,QVariant b)&#123;    QVariant ret;    if(a.type() == QVariant::int &amp;&amp; b.type() == QVariant::int)  //æˆ–è€…ä½¿ç”¨QMetaType::Int        ret = QVariant(a.toInt() + b.toInt());    else if(a.type() == QVariant::String &amp;&amp; b.type() == QVariant::String)        ret.setValue(a.toString() + b.toString());    return ret;&#125;\n2.2.2 è‡ªå®šä¹‰ç±»å‹\n\nè‹¥è‡ªå®šä¹‰äº†ä¸€ä¸ªç±»å‹,åˆ™éœ€è¦ä½¿ç”¨Qtä¸­çš„å®è¿›è¡Œå£°æ˜\nQ_DECLARE_METATYPE(Type)\n\nç¬¬ä¸€æ­¥:å®šä¹‰ç±»å‹,å¹¶æ³¨å†Œ\n//è‡ªå®šä¹‰ç±»å‹class Animal&#123;public:    Animal()&#123;&#125;  //å¿…é¡»è¦æœ‰é»˜è®¤æ„é€ å‡½æ•°                //æ‹·è´æ„é€ å‡½æ•°ä¹Ÿå¿…é¡»æœ‰ï¼Œä¸è¿‡æ²¡æœ‰æ·±ã€æµ…æ‹·è´æ—¶ï¼Œç”¨é»˜è®¤çš„å³å¯    Animal(QString name):_name(name)&#123;&#125;    void show()    &#123;        qDebug()&lt;&lt;&quot;Animal show name is :&quot;&lt;&lt; _name &lt;&lt;endl;    &#125;private:    QString _name;&#125;;//è‡ªå®šä¹‰ç±»å‹æ³¨å†ŒQ_DECLARE_METATYPE(Animal);\nç¬¬äºŒæ­¥: ä½¿ç”¨fromvalue()å­˜å‚¨å¯¹è±¡\nint main()&#123;    //QVariant vt(Animal(&quot;snake&quot;)); //ä¸å¯ä»¥é€šè¿‡æ„é€ å‡½æ•°å­˜è‡ªå®šä¹‰ç±»å‹    QVariant vt;    //æœ‰ä»¥ä¸‹ä¸¤ç§æ–¹æ³•å¯ä»¥ï¼Œå­˜è‡ªå®šä¹‰ç±»å‹    vt = QVariant::fromValue(Animal(&quot;dog&quot;));    //â‘     vt.setValue(Animal(&quot;cat&quot;));                 //â‘¡    //å¦‚æœèƒ½è½¬æ¢åˆ°Animalç±»å‹ï¼Œå°±è½¬æ¢    if(vt.canConvert&lt;Animal&gt;())    &#123;        Animal animal = vt.value&lt;Animal&gt;();        animal.show();    &#125;    return 0;&#125;\nQPoint\n\nQPointç±»å°è£…äº†æˆ‘ä»¬å¸¸ç”¨ç”¨åˆ°çš„åæ ‡ç‚¹ (x, y), å¸¸ç”¨çš„ APIå¦‚ä¸‹\n\nvoid QPoint::setX(int x);void QPoint::setY(int y);int QPoint::x() const;int &amp;QPoint::rx();int QPoint::y() const;int &amp;QPoint::ry();//å¦‚æœxå’Œyåæ ‡éƒ½ä¸º0åˆ™è¿”å›trueï¼Œå¦åˆ™è¿”å›falsebool isNull() const//è¿”å›x()å’Œy()çš„ç»å¯¹å€¼ä¹‹å’Œï¼Œä¼ ç»Ÿä¸Šç§°ä¸ºä»åŸç‚¹åˆ°è¯¥ç‚¹çš„å‘é‡çš„â€œæ›¼å“ˆé¡¿é•¿åº¦â€ã€‚//(p1-p2).manhattanLength();   int manhattanLength() const    //è¿”å›ä¸€ä¸ªäº¤æ¢äº†xå’Œyåæ ‡çš„ç‚¹:   QPoint&#123;1, 2&#125;.transposed() // &#123;2, 1&#125;  QPoint transposed() const        // ç›´æ¥é€šè¿‡åæ ‡å¯¹è±¡è¿›è¡Œç®—æœ¯è¿ç®—: åŠ å‡ä¹˜é™¤QPoint &amp;QPoint::operator*=(float factor);QPoint &amp;QPoint::operator*=(double factor);QPoint &amp;QPoint::operator*=(int factor);QPoint &amp;QPoint::operator+=(const QPoint &amp;point);QPoint &amp;QPoint::operator-=(const QPoint &amp;point);QPoint &amp;QPoint::operator/=(qreal divisor);\nQLine\n// è®¾ç½®ç›´çº¿çš„èµ·ç‚¹åæ ‡void QLine::setP1(const QPoint &amp;p1);// è®¾ç½®ç›´çº¿çš„ç»ˆç‚¹åæ ‡void QLine::setP2(const QPoint &amp;p2);void QLine::setPoints(const QPoint &amp;p1, const QPoint &amp;p2);void QLine::setLine(int x1, int y1, int x2, int y2);QPoint QLine::p1() const;      // è¿”å›ç›´çº¿çš„èµ·å§‹ç‚¹åæ ‡QPoint QLine::p2() const;      // è¿”å›ç›´çº¿çš„ç»ˆç‚¹åæ ‡QPoint QLine::center() const;  // è¿”å›å€¼ç›´çº¿çš„ä¸­å¿ƒç‚¹åæ ‡, (p1() + p2()) / 2   int QLine::x1() const;     // è¿”å›å€¼ç›´çº¿èµ·ç‚¹çš„ x åæ ‡int QLine::y1() const;     // è¿”å›å€¼ç›´çº¿èµ·ç‚¹çš„ y åæ ‡int QLine::x2() const;     // è¿”å›å€¼ç›´çº¿ç»ˆç‚¹çš„ x åæ ‡int QLine::y2() const;     // è¿”å›å€¼ç›´çº¿ç»ˆç‚¹çš„ y åæ ‡int QLine::dx() const          //è¿”å›ç›´çº¿å‘é‡çš„æ°´å¹³åˆ†é‡  int QLine::dy() const          //è¿”å›ç›´çº¿å‘é‡çš„å‚ç›´åˆ†é‡  // ç”¨ç»™å®šçš„åæ ‡ç‚¹å¹³ç§»è¿™æ¡ç›´çº¿void QLine::translate(const QPoint &amp;offset);void QLine::translate(int dx, int dy);// ç”¨ç»™å®šçš„åæ ‡ç‚¹å¹³ç§»è¿™æ¡ç›´çº¿, è¿”å›å¹³ç§»ä¹‹åçš„åæ ‡ç‚¹(ä¸ä¼šæ”¹å˜è¿™æ¡çº¿çš„åæ ‡)QLine QLine::translated(const QPoint &amp;offset) const;QLine QLine::translated(int dx, int dy) const;// ç›´çº¿å¯¹è±¡è¿›è¡Œæ¯”è¾ƒbool operator!=(const QLine &amp;line) const;bool operator==(const QLine &amp;line) const;\n2.5 QSize\n\nåœ¨QTä¸­QSizeç±»ç”¨æ¥å½¢å®¹é•¿åº¦å’Œå®½åº¦, å¸¸ç”¨çš„APIå¦‚ä¸‹:\n\nvoid setWidth(int width)void setHeight(int height);â€‹int width() const;      // å¾—åˆ°å®½åº¦int &amp;rwidth();          // å¾—åˆ°å®½åº¦çš„å¼•ç”¨int height() const;     // å¾—åˆ°é«˜åº¦int &amp;rheight();         // å¾—åˆ°é«˜åº¦çš„å¼•ç”¨â€‹void transpose();           // äº¤æ¢é«˜åº¦å’Œå®½åº¦çš„å€¼QSize transposed() const;   // äº¤æ¢é«˜åº¦å’Œå®½åº¦çš„å€¼, è¿”å›äº¤æ¢ä¹‹åçš„å°ºå¯¸ä¿¡æ¯â€‹//è¿”å›ä¸€ä¸ªå¤§å°ï¼Œå®½ä¸ºå½“å‰å¤§å°ä¸otherçš„æœ€å°å€¼ï¼Œé«˜ä¸ºå½“å‰å¤§å°ä¸otherçš„æœ€å°å€¼QSize boundedTo(const QSize&amp; oterSize)//è¿”å›ä¸€ä¸ªå¤§å°ï¼Œå®½ä¸ºå½“å‰å¤§å°ä¸otherçš„æœ€å¤§å€¼ï¼Œé«˜ä¸ºå½“å‰å¤§å°ä¸otherçš„æœ€å¤§å€¼    QSize expandedTo(const QSize &amp;otherSize) const        /*æ ¹æ®æŒ‡å®šçš„æ¨¡å¼ï¼ŒæŒ‰ç»™å®šçš„å®½åº¦å’Œé«˜åº¦ç¼©æ”¾çŸ©å½¢:      å¦‚æœmodeä¸ºQt::IgnoreAspectRatioï¼Œåˆ™å¤§å°è®¾ç½®ä¸º(width, height)ã€‚      å¦‚æœmodeä¸ºQt::KeepAspectRatioï¼Œå½“å‰å¤§å°å°†åœ¨å†…éƒ¨ç¼©æ”¾åˆ°ä¸€ä¸ªå°½å¯èƒ½å¤§çš„çŸ©å½¢(å®½åº¦ï¼Œé«˜åº¦)ï¼Œä¿æŒé«˜å®½æ¯”ã€‚      å¦‚æœmodeæ˜¯Qt::KeepAspectRatioByExpandingï¼Œå½“å‰å¤§å°è¢«ç¼©æ”¾åˆ°ä¸€ä¸ªçŸ©å½¢ï¼Œå°½å¯èƒ½å°çš„å¤–éƒ¨(å®½åº¦ï¼Œé«˜åº¦)ï¼Œä¿æŒé•¿å®½æ¯”ã€‚  */void scale(int width, int height, Qt::AspectRatioMode mode)void scale(const QSize &amp;size, Qt::AspectRatioMode mode)QSize scaled(int width, int height, Qt::AspectRatioMode mode) constQSize scaled(const QSize &amp;s, Qt::AspectRatioMode mode) const    â€‹// è¿›è¡Œç®—æ³•è¿ç®—: åŠ å‡ä¹˜é™¤QSize &amp;operator*=(qreal factor);QSize &amp;operator+=(const QSize &amp;size);QSize &amp;operator-=(const QSize &amp;size);QSize &amp;operator/=(qreal divisor);\nä¿¡å·å’Œæ§½\n3.1 ä¿¡å·(signal)\n\n\nä¿¡å·æœ¬è´¨æ˜¯äº‹ä»¶,å¦‚æŒ‰é’®ç‚¹å‡»,çª—å£åˆ·æ–°ç­‰\n\n\nä¿¡å·ä»¥å‡½æ•°å½¢å¼å‘ˆç°\n\n\nQtä¸­ä¿¡å·çš„å‘å‡ºè€…å¯èƒ½æ˜¯æŸä¸ªå®ä¾‹åŒ–çš„ç±»å¯¹è±¡,å¯¹è±¡å†…éƒ¨å¯ä»¥è¿›è¡Œç›¸å…³äº‹ä»¶çš„æ£€æµ‹\n3.2 æ§½(slot)\n\n\næ§½å‡½æ•°æ˜¯ä¸€ç±»ç‰¹æ®Šçš„åŠŸèƒ½å‡½æ•°,åœ¨ç¼–ç è¿‡ç¨‹ä¸­ä¹Ÿå¯ä»¥ä½œä¸ºç±»çš„æ™®é€šæˆå‘˜å‡½æ•°æ¥ä½¿ç”¨\n\n\nå¯¹å‘å‡ºæ¥çš„ä¿¡å·è¿›è¡Œå¤„ç†\n\n\næ§½å‡½æ•°çš„æ‰€æœ‰è€…ä¹Ÿæ˜¯æŸä¸ªç±»çš„å®ä¾‹å¯¹è±¡\n3.3 connectå‡½æ•°\n\nconnectå‡½æ•°å±äºQObjectç±»\n\néœ€è¦é€šè¿‡è¿™ä¸ªå‡½æ•°å»ºç«‹signalå’ŒslotäºŒè€…ä¹‹é—´çš„è”ç³»\nQMetaObject::Connection QObject::connect(const QObject *sender,const char *signal,                                         const QObject *receiver, [static] const char *method, Qt::ConnectionType type = Qt::AutoConnection)------------------------------------------------------------------------sender: å‘é€ä¿¡å·çš„å¯¹è±¡ã€‚signal: å‘é€çš„ä¿¡å·çš„åç§°,è¯´æ˜å‘å‡ºäº†ä»€ä¹ˆä¿¡å·,ä»¥å­—ç¬¦ä¸²å½¢å¼è¡¨ç¤ºã€‚receiver: æ¥æ”¶ä¿¡å·çš„å¯¹è±¡ã€‚method: æ¥æ”¶å¯¹è±¡ä¸­ç”¨äºå“åº”ä¿¡å·çš„æ§½å‡½æ•°çš„åç§°ï¼Œä»¥å­—ç¬¦ä¸²å½¢å¼è¡¨ç¤ºã€‚type: è¿æ¥ç±»å‹ï¼Œå†³å®šäº†ä¿¡å·å’Œæ§½çš„è¿æ¥æ–¹å¼ã€‚é»˜è®¤ä¸º Qt::AutoConnectionã€‚   \nä¾‹å¦‚ï¼Œå¦‚æœä½ æœ‰ä¸€ä¸ªæŒ‰é’®ï¼ˆQPushButtonï¼‰ï¼Œå¹¶ä¸”æƒ³è¦åœ¨æŒ‰é’®è¢«ç‚¹å‡»æ—¶æ‰§è¡ŒæŸäº›æ“ä½œï¼Œä½ å¯ä»¥å°†æŒ‰é’®çš„ clicked() ä¿¡å·è¿æ¥åˆ°ä¸€ä¸ªæ§½å‡½æ•°ï¼š\n#include&lt;QPushButton&gt;QPushButton *button = new QPushButton(&quot;Click me&quot;);MyObject *myObject = new MyObject;// è¿æ¥æŒ‰é’®çš„clickedä¿¡å·åˆ°myObjectçš„slotMethodæ§½å‡½æ•°QObject::connect(button, SIGNAL(clicked()), myObject, SLOT(slotMethod()));//å½“æŒ‰é’®è¢«ç‚¹å‡»æ—¶ï¼ŒMyObject çš„ slotMethod æ–¹æ³•å°†è¢«è°ƒç”¨ã€‚\n3.4 è‡ªå®šä¹‰ä¿¡å·å’Œæ§½\n\nä¸ºäº†ä½¿è‡ªå®šä¹‰ä¿¡å·å’Œæ§½æ­£å¸¸å·¥ä½œï¼Œç¡®ä¿ä½ çš„ç±»ç»§æ‰¿è‡ª QObject å¹¶ä¸”åœ¨ç±»çš„å®šä¹‰ä¸­æ·»åŠ Q_OBJECT å®ã€‚åŒæ—¶ï¼Œç¡®ä¿é¡¹ç›®çš„ .pro æ–‡ä»¶ä¸­æ·»åŠ äº† QT += coreï¼Œä»¥ç¡®ä¿ Qt æ ¸å¿ƒæ¨¡å—è¢«æ­£ç¡®é“¾æ¥\n\n\n\nè‡ªå®šä¹‰ä¿¡å·ï¼Œé€šå¸¸ä¿¡å·åªæœ‰å£°æ˜æ²¡æœ‰å®ç°\n\n\nclass MyClass : public QObject&#123;    Q_OBJECTsignals:    void mySignal(int value);&#125;;\n\n\nè‡ªå®šä¹‰æ§½ï¼š\n\n\n\nè‡ªå®šä¹‰æ§½æ˜¯æ™®é€šçš„æˆå‘˜å‡½æ•°ï¼Œå¯ä»¥åœ¨ä¿¡å·å‘å°„æ—¶è¢«è°ƒç”¨ã€‚\n\nclass MyClass : public QObject&#123;    Q_OBJECTpublic slots:   //æ–°ç‰ˆæœ¬ä¸­ä¸å¯ä»¥çœç•¥ä¸å†™    void mySlot(int value) &#123;        qDebug() &lt;&lt; &quot;Received value:&quot; &lt;&lt; value;    &#125;&#125;;\n\n\nè§¦å‘è‡ªå®šä¹‰ä¿¡å·\n\n\n\néœ€åœ¨ç±»ä¸­çš„æŸä¸ªå‡½æ•°ä¸­ä½¿ç”¨ emit å…³é”®å­—,å¯åŠ å¯ä¸åŠ ,åŠ äº†æ›´è§„èŒƒ\n\nvoid MyClass::someFunction() &#123;    // è§¦å‘ä¿¡å·    emit mySignal(42);&#125;//ä½¿ç”¨MyClass obj;obj.someFunction(); // è¿™å°†è§¦å‘ mySignalï¼Œå¯¼è‡´ mySlot è¢«è°ƒç”¨ã€‚\n3.5 è¡¥å……\n\n\nä¿¡å·å¯ä»¥è¿æ¥å¤šä¸ªæ§½å‡½æ•°\n\n\nä¿¡å·å¯ä»¥è¿æ¥ä¿¡å·\n\n\nä¿¡å·å‡½æ•°å’Œæ§½å‡½æ•°çš„å‚æ•°æœ‰ä¸€äº›è¦æ±‚ï¼š\n\nå‚æ•°ç±»å‹å¿…é¡»å…¼å®¹ï¼šä¿¡å·å‡½æ•°å’Œæ§½å‡½æ•°çš„å‚æ•°ç±»å‹å¿…é¡»å…¼å®¹ï¼Œæœ€å¥½æ˜¯ç›¸åŒçš„ç±»å‹æˆ–å¯ä»¥è‡ªåŠ¨è½¬æ¢çš„ç±»å‹ã€‚å¦‚æœå‚æ•°ç±»å‹ä¸å…¼å®¹ï¼Œè¿æ¥å°†æ— æ³•å»ºç«‹ï¼Œå¹¶ä¸”ç¼–è¯‘å™¨å°†ä¼šæŠ¥é”™ã€‚\nå‚æ•°æ•°é‡å¿…é¡»åŒ¹é…ï¼šä¿¡å·å‡½æ•°å’Œæ§½å‡½æ•°çš„å‚æ•°æ•°é‡å¿…é¡»åŒ¹é…ã€‚å¦‚æœä¿¡å·å‡½æ•°æœ‰å‚æ•°è€Œæ§½å‡½æ•°æ²¡æœ‰ï¼Œæˆ–è€…æ§½å‡½æ•°æœ‰å‚æ•°è€Œä¿¡å·å‡½æ•°æ²¡æœ‰ï¼Œè¿æ¥ä»ç„¶æ˜¯æœ‰æ•ˆçš„ã€‚ä½†æ˜¯ï¼Œå¦‚æœå‚æ•°æ•°é‡ä¸åŒ¹é…ï¼Œè¿æ¥å°†æ— æ³•å»ºç«‹ã€‚\nå‚æ•°çš„é¡ºåºå’Œç±»å‹å¿…é¡»ä¸€è‡´ï¼šå‚æ•°çš„é¡ºåºå’Œç±»å‹åœ¨ä¿¡å·å‡½æ•°å’Œæ§½å‡½æ•°ä¹‹é—´å¿…é¡»ä¸€è‡´ã€‚å¦‚æœé¡ºåºæˆ–ç±»å‹ä¸åŒ¹é…ï¼Œè¿æ¥å°†æ— æ³•å»ºç«‹ã€‚\n\n\n\n4. QLineEdit\n4.1 è·å–å’Œè®¾ç½®æ–‡æœ¬å†…å®¹ï¼š\n\n\nQString text() constï¼šè¿”å›å½“å‰æ–‡æœ¬æ¡†ä¸­çš„æ–‡æœ¬å†…å®¹ã€‚\n\n\nsetText(const QString &amp;text)ï¼šè®¾ç½®æ–‡æœ¬æ¡†çš„æ–‡æœ¬å†…å®¹ã€‚\n\n\nQLineEdit *lineEdit = new QLineEdit();lineEdit-&gt;setText(&quot;Hello, World!&quot;);// è·å–å½“å‰æ–‡æœ¬å†…å®¹QString currentText = lineEdit-&gt;text();\n4.2 å¯†ç æ¨¡å¼\nsetEchoMode(QLineEdit::EchoMode mode)ï¼šè®¾ç½®æ–‡æœ¬æ¡†çš„æ˜¾ç¤ºæ¨¡å¼ã€‚å¸¸ç”¨çš„æ¨¡å¼æœ‰ï¼š\n\n\nQLineEdit::Normalï¼šé»˜è®¤æ¨¡å¼ï¼Œæ˜¾ç¤ºè¾“å…¥çš„æ–‡æœ¬ã€‚\n\n\nQLineEdit::Passwordï¼šä»¥å¯†ç å½¢å¼æ˜¾ç¤ºæ–‡æœ¬ï¼Œç”¨åœ†ç‚¹æˆ–æ˜Ÿå·ä»£æ›¿å®é™…å­—ç¬¦ã€‚\n\n\nQLineEdit::PasswordEchoOnEditï¼šåœ¨ç¼–è¾‘æ—¶ä»¥å¯†ç å½¢å¼æ˜¾ç¤ºæ–‡æœ¬ï¼Œä½†åœ¨å¤±å»ç„¦ç‚¹åæ˜¾ç¤ºåœ†ç‚¹ã€‚\n\n\nQLineEdit *lineEdit = new QLineEdit();lineEdit-&gt;setEchoMode(QLineEdit::Password);\n4.3 è®¾ç½®æœ€å¤§é•¿åº¦\nä½¿ç”¨setMaxLentghæ–¹æ³•å¯ä»¥é™åˆ¶ç”¨æˆ·è¾“å…¥çš„æœ€å¤§å­—ç¬¦æ•°\nQLineEdit* lineEdit = new QLineEdit(this);lineEdit- &gt;setMaxLength(10);//é™åˆ¶è¾“å…¥çš„æœ€å¤§é•¿åº¦ä¸º10ä¸ªå­—ç¬¦\nQLable\n5.1 è®¾ç½®å­—ä½“çš„é¢œè‰² å¤§å°ç­‰\nå¯ä»¥ä½¿ç”¨setStyleSheet()å‡½æ•°\n//å¯¹æŸä¸ªç»„ä»¶å±€éƒ¨ä½¿ç”¨ui-&gt;display-&gt;setStyleSheet(&quot;color: red;&quot; &quot;text-align: right;&quot; &quot; font-size: 10px;&quot;);//å¯¹æŸä¸ªçª—å£ä¸‹çš„æŸç§ç»„ä»¶è®¾ç½®MainWindow-&gt;setStyleSheet(&quot;QLineEdit&#123; background-color: lime&#125;&quot;);//å…¨å±€ä½¿ç”¨/*ä½¿ç”¨qAppçš„setStyleSheetå‡½æ•°å¯ä»¥ä¸ºåº”ç”¨ç¨‹åºå…¨å±€è®¾ç½®æ ·å¼ã€‚ä¾‹å¦‚ä¸‹é¢ä¸ºåº”ç”¨ç¨‹åºçš„QLineEditç»„ä»¶è®¾ç½®æ ·å¼*/qApp-&gt;setStyleSheet(&quot;QLineEdit&#123; background-color: gray &#125;&quot;);\n6. ä½¿ç”¨ç±»è®¾ç½®å­—ä½“å±æ€§ é¢œè‰²\n\n\nQFontç±»çš„æ„é€ å‡½æ•°QFont(const QString &amp;family, int pointSize, int weight = -1, bool italic = false)\n\n\n\nfamilyï¼šå­—ç¬¦ä¸²ï¼Œè¡¨ç¤ºå­—ä½“çš„å®¶æ—åç§°ï¼Œä¾‹å¦‚&quot;Arial&quot;ï¼Œ&quot;Times New Roman&quot;ç­‰ã€‚\npointSizeï¼šæ•´æ•°ï¼Œä»£è¡¨å­—ä½“çš„å¤§å°ï¼Œä»¥ç£…ï¼ˆpointï¼‰ä¸ºå•ä½ã€‚\nweightï¼šæ•´æ•°ï¼ŒæŒ‡å®šå­—ä½“çš„ç²—ç»†ï¼Œé€šå¸¸æ˜¯100åˆ°1000çš„èŒƒå›´å†…çš„æ•°å€¼ï¼›-1è¡¨ç¤ºä½¿ç”¨é»˜è®¤å€¼ã€‚\nitalicï¼šå¸ƒå°”å€¼ï¼Œè¡¨ç¤ºå­—ä½“æ˜¯å¦æ˜¯æ–œä½“ï¼›falseè¡¨ç¤ºéæ–œä½“ï¼Œtrueè¡¨ç¤ºæ–œä½“ã€‚\n\n//è®¾ç½®å­—ä½“å±æ€§QFont font(&quot;Arial&quot;, 16);font.setBold(true);ui-&gt;lineEdit-&gt;setFont(font);//è®¾ç½®å¯¹é½ä½ç½®ui-&gt;lineEdit-&gt;setAlignment(Qt::AlignRight);\n\n\nQPalette ç±»ç”¨äºç®¡ç†çª—å£éƒ¨ä»¶çš„å¤–è§‚ï¼ŒåŒ…æ‹¬èƒŒæ™¯è‰²ã€å‰æ™¯è‰²å’Œæ–‡æœ¬æ ¼å¼ç­‰\n\n\n//è®¾ç½®é¢œè‰² QPalette palette; palette.setColor(QPalette::Text, Qt::red); ui-&gt;lineEdit-&gt;setPalette(palette);//setColor() æ–¹æ³•ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯è¦è®¾ç½®çš„é¢œè‰²å±æ€§ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯è¦åº”ç”¨çš„é¢œè‰²å€¼ã€‚//åœ¨è®¾ç½®æ§ä»¶èƒŒæ™¯è‰²å¡«å……æ—¶ï¼Œä¸€å®šè¦å…ˆè°ƒç”¨setAutoFillBackground(true)å‡½æ•°ï¼Œæ¥è¿è¡Œè‡ªåŠ¨å¡«å……èƒŒæ™¯\n7. QProgressBar\n\nå¯ä¸QSlider QScrollBar QDialé…åˆä½¿ç”¨\n\nformatå±æ€§\n%p:å®Œæˆçš„ç™¾åˆ†æ¯”  %v:å½“å‰å€¼  %m:æ€»æ­¥éª¤æ•°\né»˜è®¤å€¼ä¸º%p%\nconnect(ui-&gt;slider,&amp;QSlider::valueChanged,this,&amp;Widget::do_valueChanged);void Widget::do_valueChanged(int value);&#123;    ui-&gt;progressBar-&gt;setValue(value);&#125;\n8. æ—¥æœŸæ—¶é—´æ•°æ®\n\nQTime    QDate    QDateTime    QCalendarWidget\n\nvoid Widgey::on_btnGetTime_clicked()&#123;    QDateTime curDateTime = QDateTime::currentDateTime();    ui-&gt;timeEdit-&gt;setTime(curDateTime.time());    ui-&gt;editTime-&gt;setText(curDateTime.toString(&quot;hh:mm:ss&quot;))        ui-&gt;timeEdit-&gt;setDate(curDateTime.date());    ui-&gt;editTime-&gt;setText(curDateTime.toString(&quot;yy-MM-dd&quot;));        ui-&gt;timeEdit-&gt;setDateTime(curDateTime);&#125;void Widget::on_calendarWidget_selectionChanged()&#123;    //è·å–æ—¥å†æ§ä»¶ä¸Šé€‰æ‹©çš„æ—¥æœŸ    QString str = ui-&gt;calendarWidget-&gt;selectedDate().toString(&quot;yyyyå¹´Mæœˆdæ—¥&quot;);&#125;\n9. è®¡æ—¶å™¨ QTimer\n\ntimer è¶…æ—¶åä¼šå‘å‡ºtimeout()ä¿¡å·ï¼Œæ‰€ä»¥åœ¨åˆ›å»ºå¥½å®šæ—¶å™¨å¯¹è±¡åç»™å…¶å»ºç«‹ä¿¡å·ä¸æ§½\n\n#inlcude &lt;QTimer&gt;QTimer *timer = new QTimer;timer-&gt;setSingleShot(false);//è®¾ç½®æ˜¯å¦åªä½¿ç”¨ä¸€æ¬¡timer-&gt;setInterval(2000);//è®¾ç½®æ—¶é—´é—´éš”,ä»¥æ¯«ç§’ä¸ºå•ä½timer-&gt;start();//å¯åŠ¨timer-&gt;stop();//åœæ­¢connect(timer, SIGNAL(timeout()), this, SLOT(onTimeout()));\n10. QTabWidget\n// åˆ›å»ºä¸€ä¸ª QTabWidget å®ä¾‹ï¼Œç”¨äºåŒ…å«å¤šä¸ªé€‰é¡¹å¡QTabWidget *tabWidget = new QTabWidget;// è®¾ç½®é€‰é¡¹å¡çš„å½¢çŠ¶ä¸ºä¸‰è§’å½¢tabWidget-&gt;setTabShape(QTabWidget::Triangular);// è®¾ç½®é€‰é¡¹å¡å¯ç§»åŠ¨tabWidget-&gt;setMovable(true);// è®¾ç½®é€‰é¡¹å¡çš„ä½ç½®ä¸ºå·¦ä¾§tabWidget-&gt;setTabPosition(QTabWidget::West);// åˆ›å»ºä¸‰ä¸ªå­çª—å£éƒ¨ä»¶(QWidget)ï¼Œç”¨ä½œæ¯ä¸ªé€‰é¡¹å¡çš„å†…å®¹QWidget *pageWidget_0 = new QWidget;QWidget *pageWidget_1 = new QWidget;QWidget *pageWidget_2 = new QWidget;// å°†æ¯ä¸ªå­çª—å£éƒ¨ä»¶æ·»åŠ åˆ°é€‰é¡¹å¡ä¸­ï¼ŒåŒæ—¶è®¾ç½®ç›¸åº”çš„æ ‡ç­¾tabWidget-&gt;addTab(pageWidget_0, &quot;ç¬¬ä¸€é¡µ&quot;);tabWidget-&gt;addTab(pageWidget_1, &quot;ç¬¬äºŒé¡µ&quot;);tabWidget-&gt;addTab(pageWidget_2, &quot;ç¬¬ä¸‰é¡µ&quot;);\n11. QTableView QStandardItemModel QItemSelectionModel\n\nQStandardItemModelæ˜¯Qtæä¾›çš„ç”¨äºå­˜å‚¨å’Œæ“ä½œæ ‡å‡†é¡¹æ•°æ®æ¨¡å‹çš„ç±»ã€‚å®ƒç»§æ‰¿è‡ªQAbstractItemModelï¼Œå¹¶æä¾›äº†ä¸€ç§æ–¹ä¾¿çš„æ–¹å¼æ¥ç»„ç»‡å’Œå±•ç¤ºæ•°æ®ã€‚é€šè¿‡æ·»åŠ ã€åˆ é™¤ã€ä¿®æ”¹æˆ–ç§»åŠ¨æ ‡å‡†é¡¹ï¼Œå¯ä»¥å¯¹æ•°æ®è¿›è¡Œæ“ä½œã€‚\nQItemSelectionModelåˆ™æ˜¯ç”¨äºç®¡ç†é¡¹é€‰æ‹©çŠ¶æ€çš„ç±»ã€‚å®ƒæ˜¯ä¸€ä¸ªä¸è§†å›¾äº¤äº’çš„æ¨¡å‹ï¼Œè´Ÿè´£è·Ÿè¸ªç”¨æˆ·é€‰æ‹©çš„é¡¹ä»¥åŠé€šçŸ¥ç›¸å…³è§†å›¾è¿›è¡Œç›¸åº”æ›´æ–°ã€‚QItemSelectionModelå¯ä»¥ç›‘å¬å¹¶å“åº”ç”¨æˆ·é€‰æ‹©é¡¹å˜åŒ–äº‹ä»¶ï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥é€šè¿‡ç¼–ç¨‹æ–¹å¼æ”¹å˜é€‰æ‹©çŠ¶æ€ã€‚\n\n#include &lt;QFileDialog&gt;#include &lt;QFile&gt;#include &lt;QStandardItemModel&gt;#include &lt;QItemSelectionModel&gt;class MainWindow:public QMainWindow&#123;    Q_OBJECTprivate:    QStandardItemModel* m_model; // æ•°æ®æ¨¡å‹    QItemSelectionModel* m_selection; // é€‰æ‹©æ¨¡å‹    QLabel* labCurFile; // å½“å‰æ–‡ä»¶æ ‡ç­¾    QLabel* labCellPos; // å½“å‰å•å…ƒæ ¼ä½ç½®æ ‡ç­¾public:    .........private slots:    void do_currentChanged(const QModelIndex &amp;current,const QModelIndex &amp;previous);    &#125;;MainWindow::MainWindow(QWidget* parent):QMainWindow(parent),ui(new Ui::MainWindow)&#123;    labCurFile = new QLabel(&quot;å½“å‰æ–‡ä»¶&quot;,this);    labCurFile-&gt;setMinimumWidth(200);    ui-&gt;statusBar-&gt;addWidget(labCurFile); // å°†å½“å‰æ–‡ä»¶æ ‡ç­¾æ·»åŠ åˆ°çŠ¶æ€æ         m_model = new QStandardItemModel(2,6,this); // åˆ›å»ºæ•°æ®æ¨¡å‹ï¼Œ2è¡Œ6åˆ—    m_selection = new QItemSelectionModel(m_model,this); // åˆ›å»ºé€‰æ‹©æ¨¡å‹        ui-&gt;tableView-&gt;setModel(m_model); // è®¾ç½®è¡¨æ ¼è§†å›¾çš„æ¨¡å‹    ui-&gt;tableView-&gt;setSelectionModel(m_selection); // è®¾ç½®è¡¨æ ¼è§†å›¾çš„é€‰æ‹©æ¨¡å‹    ui-&gt;tableView-&gt;setSelectionMode(QAbstractItemView::ExtendedSelection); // è®¾ç½®é€‰æ‹©æ¨¡å¼    ui-&gt;tableView-&gt;setSelectionBehavior(QAbstractItemView::SelectItems); // è®¾ç½®é€‰æ‹©è¡Œä¸º        connect(m_selection,&amp;QItemSelection::currentChanged,this,&amp;MainWindow::do_currentChanged);&#125;void MainWinidow::do_currentChanged(const QModelIndex &amp;current,const QModelIndex &amp;previous)&#123;    if(current.isValid())    &#123;        labCellPos-&gt;setText(QString::asprintf(&quot;å½“å‰å•å…ƒæ ¼:%dè¡Œ,%dåˆ—&quot;,current.row(),current.column()));        QStandardItem *aItem = m_model-&gt;itemFromIndex(current); // è·å–å½“å‰å•å…ƒæ ¼çš„é¡¹        ui-&gt;actFontBold-&gt;setChecked(aItem-&gt;font().bold()); // æ£€æŸ¥å½“å‰å•å…ƒæ ¼çš„æ–‡æœ¬æ˜¯å¦ä¸ºç²—ä½“,å¦‚æœå½“å‰å•å…ƒæ ¼çš„æ–‡æœ¬ä¸ºç²—ä½“ï¼ŒåŠ¨ä½œå°†è¢«é€‰ä¸­ï¼Œå¦åˆ™åŠ¨ä½œå°†å–æ¶ˆé€‰ä¸­    &#125;&#125;void MainWindow::on_actOpen_triggered()&#123;    // è·å–å½“å‰åº”ç”¨ç¨‹åºçš„è·¯å¾„    QString curPath = QCoreApplication::applicationDirPath();    // æ‰“å¼€æ–‡ä»¶å¯¹è¯æ¡†ä»¥è·å–è¦æ‰“å¼€çš„æ–‡ä»¶è·¯å¾„    QString aFilePath = QFileDialog::getOpenFileName(this, &quot;æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶&quot;, curPath, &quot;æ•°æ®æ–‡ä»¶(*.txt);;æ‰€æœ‰æ–‡ä»¶(*.*)&quot;);    // å¦‚æœæ–‡ä»¶åä¸ºç©ºï¼Œåˆ™é€€å‡ºå‡½æ•°    if (aFileName.isEmpty()) return;        // æ‰“å¼€æ–‡ä»¶    QFile aFile(aFileName);    if (!aFile.open(QIODevice::ReadOnly | QIODevice::Text)) return; // å¦‚æœæ–‡ä»¶æ— æ³•æ‰“å¼€ï¼Œåˆ™é€€å‡ºå‡½æ•°        // è¯»å–æ–‡ä»¶å†…å®¹å¹¶æ˜¾ç¤ºåœ¨ç•Œé¢ä¸Š    QStringList aFileContent;    QTextStream aStream(&amp;aFile);    while (!aStream.atEnd())    &#123;        QString str = aStream.readLine();        ui-&gt;plainTextEdit-&gt;appendPlainText(str); // åœ¨æ–‡æœ¬æ¡†ä¸­æ·»åŠ ä¸€è¡Œå†…å®¹        aFileContent.append(str); // å°†è¯»å–çš„æ¯ä¸€è¡Œå†…å®¹æ·»åŠ åˆ°QStringListä¸­    &#125;    // å…³é—­æ–‡ä»¶    aFile.close();        // æ›´æ–°ç•Œé¢æ˜¾ç¤ºï¼Œæ˜¾ç¤ºå½“å‰æ‰“å¼€çš„æ–‡ä»¶å    labCurFile-&gt;setText(&quot;å½“å‰æ–‡ä»¶:&quot; + aFileName);    // å¯ç”¨ä¸€ä¸ªåŠ¨ä½œï¼ˆå‡è®¾è¿™é‡Œæ˜¯ä¸€ä¸ªèœå•é¡¹æˆ–æŒ‰é’®ï¼‰ï¼Œå…è®¸ç”¨æˆ·è¿½åŠ å†…å®¹    ui-&gt;actAppend-&gt;setEnabled(true);        iniModelData(aFileContent); // åˆå§‹åŒ–æ¨¡å‹æ•°æ®&#125;void MainWindow::iniModelData(QStringList&amp; aFileContent)&#123;    int rowCnt  = aFileContent.size(); // è·å–æ–‡ä»¶å†…å®¹çš„è¡Œæ•°    m_model-&gt;setRowCount(rowCnt - 1); // è®¾ç½®è¡¨æ ¼æ¨¡å‹çš„è¡Œæ•°ï¼ˆå‡å»æ ‡é¢˜è¡Œï¼‰    QString header = aFileContent.at(0); // è·å–æ ‡é¢˜è¡Œ    QStringList headerList = header.split(QRegularExpression(R&quot;(\\s+)&quot;), Qt::SkipEmptyParts); // æ ¹æ®ç©ºç™½å­—ç¬¦æ‹†åˆ†æ ‡é¢˜è¡Œ    m_model-&gt;setHorizontalHeaderLabels(headerList); // è®¾ç½®è¡¨å¤´æ ‡ç­¾    QStandardItem* aItem; // ç”¨äºåˆ›å»ºæ¯ä¸ªå•å…ƒæ ¼çš„é¡¹    int j;    for(int i = 1; i &lt; rowCnt; i++) // ä»ç¬¬äºŒè¡Œå¼€å§‹éå†æ–‡ä»¶å†…å®¹    &#123;        QString aLineText = aFileContent.at(i); // è·å–å½“å‰è¡Œçš„æ–‡æœ¬        QStringList tmpList = aLineText.split(QRegularExpression(R&quot;(\\s+)&quot;), Qt::SkipEmptyParts); // æ ¹æ®ç©ºç™½å­—ç¬¦æ‹†åˆ†å½“å‰è¡Œ        for(j = 0; j &lt; 6; j++) // éå†å½“å‰è¡Œçš„æ¯ä¸€åˆ—ï¼ˆå‡è®¾æ¯è¡Œæœ‰6åˆ—ï¼‰        &#123;            aItem = new QStandardItem(tmpList.at(j)); // åˆ›å»ºä¸€ä¸ªæ–°çš„é¡¹ï¼Œå†…å®¹ä¸ºå½“å‰åˆ—çš„å€¼            m_model-&gt;setItem(i - 1, j, aItem); // åœ¨æŒ‡å®šä½ç½®è®¾ç½®é¡¹        &#125;        // å¤„ç†æœ€åä¸€åˆ—        aItem = new QStandardItem(tmpList.at(j)); // åˆ›å»ºæœ€åä¸€åˆ—çš„é¡¹        aItem-&gt;setCheckable(true); // è®¾ç½®é¡¹ä¸ºå¯é€‰ä¸­çš„        aItem-&gt;setBackground(QBrush(Qt::yellow)); // è®¾ç½®é¡¹çš„èƒŒæ™¯é¢œè‰²ä¸ºé»„è‰²        if(tmpList.at(j) == &quot;0&quot;) // å¦‚æœå€¼ä¸º0ï¼Œåˆ™è®¾ç½®ä¸ºæœªé€‰ä¸­çŠ¶æ€        &#123;            aItem-&gt;setCheckState(Qt::Unchecked);        &#125;        else // å¦åˆ™è®¾ç½®ä¸ºé€‰ä¸­çŠ¶æ€        &#123;            aItem-&gt;setCheckState(Qt::Checked);        &#125;        m_model-&gt;setItem(i - 1, j, aItem); // åœ¨æŒ‡å®šä½ç½®è®¾ç½®é¡¹    &#125;&#125;\n12. QTableWidget\n\nQTableWidgetç»§æ‰¿è‡ªQTableView,QTableWidgetæ˜¯QTableViewçš„å­ç±»ï¼Œä¸»è¦çš„åŒºåˆ«æ˜¯QTableViewå¯ä»¥ä½¿ç”¨è‡ªå®šä¹‰çš„æ•°æ®æ¨¡å‹æ¥æ˜¾ç¤ºå†…å®¹(ä¹Ÿå°±æ˜¯å…ˆè¦é€šè¿‡setModelæ¥ç»‘å®šæ•°æ®æº)ï¼Œè€ŒQTableWidgetåˆ™åªèƒ½ä½¿ç”¨æ ‡å‡†çš„æ•°æ®æ¨¡å‹ï¼Œå¹¶ä¸”å…¶å•å…ƒæ ¼æ•°æ®æ˜¯QTableWidgetItemçš„å¯¹è±¡æ¥å®ç°çš„\n\n12.1 åˆå§‹åŒ–è¡¨æ ¼æ•°æ®\nç•Œé¢ä¸Šçš„â€œåˆå§‹åŒ–è¡¨æ ¼æ•°æ®â€æŒ‰é’®æ ¹æ®è¡¨æ ¼çš„è¡Œæ•°ï¼Œç”Ÿæˆæ•°æ®å¡«å……è¡¨æ ¼ï¼Œå¹¶ä¸ºæ¯ä¸ªå•å…ƒæ ¼ç”Ÿæˆ QTableWidgetItem å¯¹è±¡ï¼Œè®¾ç½®ç›¸åº”å±æ€§ã€‚ä¸‹é¢æ˜¯ btnlniData çš„ clicked() ä¿¡å·çš„æ§½å‡½æ•°ä»£ç ï¼š\nvoid ManagerInterface::readMenuInfo()&#123;\tQFile file(&quot;menuInfo.dat&quot;);\tfile.open(QIODevice::ReadOnly);\tif (!file.isOpen())\t&#123;\t\tqDebug() &lt;&lt; &quot;æ–‡ä»¶æ‰“å¼€å¤±è´¥1&quot;;\t&#125;\telse\t&#123;\t\tQString name;\t\tQString type;\t\tdouble price;\t\tdouble discount;\t\tQString imagePath;\t\tQDataStream in(&amp;file);\t\twhile (!in.atEnd())\t\t&#123;\t\t\tin &gt;&gt; name &gt;&gt; type &gt;&gt; price &gt;&gt; discount&gt;&gt; imagePath;\t\t\tui-&gt;menuTable-&gt;insertRow(ui-&gt;menuTable-&gt;rowCount());\t\t\tcreatTableRows(ui-&gt;menuTable-&gt;rowCount()-1, name, type, price, discount,imagePath);//æ³¨æ„è¦å°†è·å¾—çš„è¡Œæ•°å‡ä¸€\t\t\tqDebug() &lt;&lt; name &lt;&lt; type &lt;&lt; price &lt;&lt; discount &lt;&lt; imagePath;\t\t&#125;\t&#125;\tfile.close();&#125;---------------------------------------------------------------------------QTableWidget::clearContents() å‡½æ•°æ¸…é™¤è¡¨æ ¼æ•°æ®åŒºçš„æ‰€æœ‰å†…å®¹ï¼Œä½†æ˜¯ä¸æ¸…é™¤è¡¨å¤´ã€‚QTableWidget::rowCount() å‡½æ•°è¿”å›è¡¨æ ¼æ•°æ®åŒºçš„è¡Œæ•°ã€‚åœ¨ for å¾ªç¯é‡Œä¸ºæ¯ä¸€è¡Œç”Ÿæˆéœ€è¦æ˜¾ç¤ºçš„æ•°æ®ï¼Œç„¶åè°ƒç”¨è‡ªå®šä¹‰å‡½æ•° creatTableRows()ï¼Œä¸ºè¡¨æ ¼ä¸€è¡Œçš„å„ä¸ªå•å…ƒæ ¼ç”Ÿæˆ QTableWidgetItem å¯¹è±¡ã€‚\ncreatTableRows() æ˜¯åœ¨çª—ä½“ç±»é‡Œè‡ªå®šä¹‰çš„å‡½æ•°ï¼Œå…¶å®ç°ä»£ç å¦‚ä¸‹ï¼š\nvoid ManagerInterface::creatTableRows(int rowNo,  QString menuName, QString type, double price, double discount,QString imagePath)&#123;\tQTableWidgetItem* item;\t\titem = new QTableWidgetItem(menuName);\titem-&gt;setTextAlignment(Qt::AlignCenter);\tui-&gt;menuTable-&gt;setItem(rowNo, 0, item);\titem = new QTableWidgetItem(type);\titem-&gt;setTextAlignment(Qt::AlignCenter);\tui-&gt;menuTable-&gt;setItem(rowNo, 1, item);\t\titem = new QTableWidgetItem(QString::number(price, &#x27;f&#x27;, 2));\titem-&gt;setTextAlignment(Qt::AlignCenter);\tui-&gt;menuTable-&gt;setItem(rowNo, 2, item);\titem = new QTableWidgetItem(QString::number(discount, &#x27;f&#x27;, 2));\titem-&gt;setTextAlignment(Qt::AlignCenter);\tui-&gt;menuTable-&gt;setItem(rowNo, 3, item);\titem = new QTableWidgetItem(imagePath);\titem-&gt;setTextAlignment(Qt::AlignCenter);\tui-&gt;menuTable-&gt;setItem(rowNo, 4, item);        //å°†ç¬¬å››åˆ—éšè—\tui-&gt;menuTable-&gt;setColumnHidden(4, true);&#125;\n12.2 è·å¾—å½“å‰å•å…ƒæ ¼æ•°æ®\nå½“é¼ æ ‡åœ¨è¡¨æ ¼ä¸Šå•å‡»å•å…ƒæ ¼æ—¶ï¼Œè¢«é€‰ä¸­çš„å•å…ƒæ ¼æ˜¯å½“å‰å•å…ƒæ ¼ã€‚é€šè¿‡QTableWidget çš„ currentColumn() å’Œ currentRow() å¯ä»¥è·å¾—å½“å‰å•å…ƒæ ¼çš„åˆ—ç¼–å·å’Œè¡Œç¼–å·ã€‚\nå½“å‰å•å…ƒæ ¼å‘ç”Ÿåˆ‡æ¢æ—¶ï¼Œä¼šå‘å°„==currentCellChanged() ä¿¡å·å’Œ currentItemChanged()==ä¿¡å·ï¼Œä¸¤ä¸ªä¿¡å·éƒ½å¯ä»¥åˆ©ç”¨ï¼Œåªæ˜¯ä¼ é€’çš„å‚æ•°ä¸åŒã€‚\nå¯¹ currentCellChanged() ä¿¡å·ç¼–å†™æ§½å‡½æ•°ï¼Œç”¨äºè·å–å½“å‰å•å…ƒæ ¼çš„æ•°æ®ï¼Œä»¥åŠå½“å‰è¡Œçš„å­¦ç”Ÿçš„å­¦å·ä¿¡æ¯ï¼Œä»£ç å¦‚ä¸‹ï¼š\nvoid MainWindow::on_tableInfo_currentCellChanged(int currentRow, int currentColumn, int previousRow, int previousColumn)&#123;//å½“å‰é€‰æ‹©å•å…ƒæ ¼å‘ç”Ÿå˜åŒ–æ—¶çš„å“åº”   Q_UNUSED(previousRow);   Q_UNUSED(previousColumn);    QTableWidgetItem* item=ui-&gt;tableInfo-&gt;item(currentRow,currentColumn); //è·å–å•å…ƒæ ¼çš„ Item    if  (item==NULL)        return;    labCellIndex-&gt;setText(QString::asprintf(&quot;å½“å‰å•å…ƒæ ¼åæ ‡ï¼š%d è¡Œï¼Œ%d åˆ—&quot;,currentRow,currentColumn));    int cellType=item-&gt;type();//è·å–å•å…ƒæ ¼çš„ç±»å‹    labCellType-&gt;setText(QString::asprintf(&quot;å½“å‰å•å…ƒæ ¼ç±»å‹ï¼š%d&quot;,cellType));    item=ui-&gt;tableInfo-&gt;item(currentRow,MainWindow::colName); //å–å½“å‰è¡Œç¬¬1åˆ—çš„å•å…ƒæ ¼çš„ item    int ID=item-&gt;data(Qt::UserRole).toInt();//ç”¨data()å‡½æ•°æå–è‡ªå®šä¹‰æ•°æ®ï¼Œä¹Ÿå°±æ˜¯åˆ›å»ºå•å…ƒæ ¼æ—¶å­˜å‚¨çš„å­¦ç”Ÿ ID    labStudID-&gt;setText(QString::asprintf(&quot;å­¦ç”ŸIDï¼š%d&quot;,ID));//å­¦ç”ŸID&#125;\n12.3 æ’å…¥ã€æ·»åŠ ã€åˆ é™¤è¡Œ\nQTableWidget å¤„ç†è¡Œæ“ä½œçš„å‡½æ•°å¦‚ä¸‹ï¼š\ninsertRow(int row)ï¼šåœ¨è¡Œå·ä¸ºrowçš„è¡Œå‰é¢æ’å…¥ä¸€è¡Œï¼Œå¦‚æœrowç­‰äºæˆ–å¤§äºæ€»è¡Œæ•°ï¼Œåˆ™åœ¨è¡¨æ ¼æœ€åæ·»åŠ ä¸€è¡Œã€‚insertRow()å‡½æ•°åªæ˜¯æ’å…¥ä¸€ä¸ªç©ºè¡Œï¼Œä¸ä¼šä¸ºå•å…ƒæ ¼åˆ›å»ºQTableWidgetItemå¯¹è±¡ï¼Œéœ€è¦æ‰‹å·¥ä¸ºå•å…ƒæ ¼åˆ›å»ºã€‚\nremoveRow(int row)ï¼šåˆ é™¤è¡Œå·ä¸º row çš„è¡Œã€‚\nä¸‹é¢æ˜¯ç•Œé¢ä¸Šâ€œæ’å…¥è¡Œâ€ â€œæ·»åŠ è¡Œâ€â€œåˆ é™¤å½“å‰è¡Œâ€æŒ‰é’®çš„å“åº”ä»£ç ã€‚åœ¨æ’å…¥è¡Œä¹‹åï¼Œä¼šè°ƒç”¨ createItemsARow() å‡½æ•°ï¼Œä¸ºæ–°åˆ›å»ºçš„ç©ºè¡Œçš„å„å•å…ƒæ ¼æ„é€  QTableWidgetItem å¯¹è±¡ï¼š\nvoid MainWindow::on_btnInsertRow_clicked()&#123; //æ’å…¥ä¸€è¡Œ    //int curRow;    int curRow=ui-&gt;tableInfo-&gt;currentRow();//å½“å‰è¡Œå·    ui-&gt;tableInfo-&gt;insertRow(curRow); //æ’å…¥ä¸€è¡Œï¼Œä½†ä¸ä¼šè‡ªåŠ¨ä¸ºå•å…ƒæ ¼åˆ›å»ºitem    createItemsARow(curRow, &quot;æ–°å­¦ç”Ÿ&quot;, &quot;ç”·&quot;,          QDate::fromString(&quot;1990-1-1&quot;,&quot;yyyy-M-d&quot;),&quot;è‹—æ—&quot;,true,60 ); //ä¸ºæŸä¸€è¡Œåˆ›å»ºitems&#125;void MainWindow::on_btnAppendRow_clicked()&#123; //æ·»åŠ ä¸€è¡Œ    //int curRow;    int curRow=ui-&gt;tableInfo-&gt;rowCount();//æ€»è¡Œå·    ui-&gt;tableInfo-&gt;insertRow(curRow);//åœ¨è¡¨æ ¼å°¾éƒ¨æ·»åŠ ä¸€è¡Œ    createItemsARow(curRow, &quot;æ–°ç”Ÿ&quot;, &quot;å¥³&quot;,          QDate::fromString(&quot;2000-1-1&quot;,&quot;yyyy-M-d&quot;),&quot;æ»¡æ—&quot;,false,50 ); //ä¸ºæŸä¸€è¡Œåˆ›å»ºitems&#125;void MainWindow::on_btnDelCurRow_clicked()&#123;//åˆ é™¤å½“å‰è¡ŒåŠå…¶items    //int curRow;    int curRow=ui-&gt;tableInfo-&gt;currentRow();//å½“å‰è¡Œå·    ui-&gt;tableInfo-&gt;removeRow(curRow); //åˆ é™¤å½“å‰è¡ŒåŠå…¶items&#125;\n12.4 è‡ªåŠ¨è°ƒæ•´è¡Œé«˜å’Œåˆ—å®½\nQTableWidget æœ‰å‡ ä¸ªå‡½æ•°è‡ªåŠ¨è°ƒæ•´è¡¨æ ¼çš„è¡Œé«˜å’Œåˆ—å®½ï¼Œåˆ†åˆ«å¦‚ä¸‹ï¼š\nresizeColumnsToContents()ï¼šè‡ªåŠ¨è°ƒæ•´æ‰€æœ‰åˆ—çš„å®½åº¦ï¼Œä»¥é€‚åº”å…¶å†…å®¹ã€‚resizeColumnToContents(int column)ï¼šè‡ªåŠ¨è°ƒæ•´åˆ—å·ä¸º co/www çš„åˆ—çš„å®½åº¦ã€‚resizeRowsToContents()ï¼šè‡ªåŠ¨è°ƒæ•´æ‰€æœ‰è¡Œçš„é«˜åº¦ï¼Œä»¥é€‚åº”å…¶å†…å®¹ã€‚resizeRowToContents(int row)ï¼šè‡ªåŠ¨è°ƒæ•´è¡Œå·ä¸º raw çš„è¡Œçš„é«˜åº¦ã€‚    è¿™å‡ ä¸ªå‡½æ•°å®é™…ä¸Šæ˜¯ QTableWidget çš„çˆ¶ç±» QTableView çš„å‡½æ•°ã€‚\n12.4 å…¶ä»–å±æ€§æ§åˆ¶\nè®¾ç½®è¡¨æ ¼å†…å®¹æ˜¯å¦å¯ç¼–è¾‘ï¼šQTableWidget çš„ EditTriggers å±æ€§è¡¨ç¤ºæ˜¯å¦å¯ç¼–è¾‘ï¼Œä»¥åŠè¿›å…¥ç¼–è¾‘çŠ¶æ€çš„æ–¹å¼ã€‚ç•Œé¢ä¸Šçš„&quot;è¡¨æ ¼å¯ç¼–è¾‘&quot;å¤é€‰æ¡†çš„æ§½å‡½æ•°ä»£ç ä¸ºï¼š\nvoid MainWindow::on_chkBoxTabEditable_clicked(bool checked)&#123; //è®¾ç½®ç¼–è¾‘æ¨¡å¼    if (checked)        //åŒå‡»æˆ–è·å–ç„¦ç‚¹åå•å‡»ï¼Œè¿›å…¥ç¼–è¾‘çŠ¶æ€        ui-&gt;tableInfo-&gt;setEditTriggers(QAbstractItemView::DoubleClicked | QAbstractItemView::SelectedClicked);    else        ui-&gt;tableInfo-&gt;setEditTriggers(QAbstractItemView::NoEditTriggers); //ä¸å…è®¸ç¼–è¾‘&#125;\nè®¾ç½®è¡Œè¡¨å¤´ã€åˆ—è¡¨å¤´æ˜¯å¦æ˜¾ç¤ºï¼šhorizontalHeader()è·å–è¡Œè¡¨å¤´ï¼ŒverticalHeader()è·å–åˆ—è¡¨å¤´ï¼Œç„¶åå¯è®¾ç½®å…¶å¯è§æ€§ã€‚\nvoid MainWindow::on_chkBoxHeaderH_clicked(bool checked)&#123;    //æ˜¯å¦æ˜¾ç¤ºæ°´å¹³è¡¨å¤´    ui-&gt;tableInfo-&gt;horizontalHeader()-&gt;setVisible(checked);&#125;void MainWindow::on_chkBoxHeaderV_clicked(bool checked)&#123;    //æ˜¯å¦æ˜¾ç¤ºå‚ç›´è¡¨å¤´    ui-&gt;tableInfo-&gt;verticalHeader()-&gt;setVisible(checked);&#125;\né—´éš”è¡Œåº•è‰²ï¼šsetAltematingRowColors() å‡½æ•°å¯ä»¥è®¾ç½®è¡¨æ ¼çš„è¡Œæ˜¯å¦ç”¨äº¤æ›¿åº•è‰²æ˜¾ç¤ºï¼Œè‹¥ä¸ºäº¤æ›¿åº•è‰²ï¼Œåˆ™é—´éš”çš„ä¸€è¡Œä¼šç”¨ç°è‰²ä½œä¸ºåº•è‰²ã€‚å…·ä½“åº•è‰²çš„è®¾ç½®éœ€è¦ç”¨ styleSheetã€‚\nvoid MainWindow::on_chkBoxRowColor_clicked(bool checked)&#123;    ui-&gt;tableInfo-&gt;setAlternatingRowColors(checked);&#125;\né€‰æ‹©æ¨¡å¼ï¼šsetSelectionBehavior() å‡½æ•°å¯ä»¥è®¾ç½®é€‰æ‹©æ–¹å¼ä¸ºå•å…ƒæ ¼é€‰æ‹©ï¼Œè¿˜æ˜¯è¡Œé€‰æ‹©ï¼š\nvoid MainWindow::on_rBtnSelectItem_clicked()&#123;//é€‰æ‹©è¡Œä¸ºï¼šå•å…ƒæ ¼é€‰æ‹©    ui-&gt;tableInfo-&gt;setSelectionBehavior(QAbstractItemView::Selectltems);&#125;void MainWindow::on_rBtnSelectRow_clicked()&#123;//é€‰æ‹©è¡Œä¸ºï¼šè¡Œé€‰æ‹©    ui-&gt;tableInfo-&gt;setSelectionBehavior(QAbstractItemView::SelectRows);&#125;\n12.6 éå†è¡¨æ ¼è¯»å–æ•°æ®\nâ€œè¯»å–è¡¨æ ¼å†…å®¹åˆ°æ–‡æœ¬â€æŒ‰é’®æ¼”ç¤ºäº†å°†è¡¨æ ¼æ•°æ®åŒºçš„å†…å®¹å…¨éƒ¨è¯»å‡ºçš„æ–¹æ³•ï¼Œå®ƒå°†æ¯ä¸ªå•å…ƒæ ¼çš„æ–‡å­—è¯»å‡ºï¼ŒåŒä¸€è¡Œçš„å•å…ƒæ ¼çš„æ–‡å­—ç”¨ç©ºæ ¼åˆ†éš”å¼€ï¼Œä½œä¸ºæ–‡æœ¬çš„ä¸€è¡Œï¼Œç„¶åå°†è¿™è¡Œæ–‡å­—ä½œä¸ºæ–‡æœ¬ç¼–è¾‘å™¨çš„ä¸€è¡Œå†…å®¹ï¼Œä»£ç å¦‚ä¸‹ï¼š\nvoid ManagerInterface::saveMenuInfo()&#123;\tQFile file(&quot;menuInfo.dat&quot;);\tfile.open(QIODevice::WriteOnly);\tif (!file.isOpen())\t&#123;\t\tqDebug() &lt;&lt; &quot;æ–‡ä»¶æ‰“å¼€å¤±è´¥2&quot;;\t&#125;\telse\t&#123;\t\tQDataStream out(&amp;file);\t\tfor (int i = 0; i &lt; ui-&gt;menuTable-&gt;rowCount(); i++)\t\t&#123;\t\t\tQTableWidgetItem* item = ui-&gt;menuTable-&gt;item(i, 0);\t\t\tQString menuName = item-&gt;text();\t\t\titem = ui-&gt;menuTable-&gt;item(i, 1);\t\t\tQString type = item-&gt;text();\t\t\titem = ui-&gt;menuTable-&gt;item(i, 2);\t\t\tdouble price = item-&gt;text().toDouble();\t\t\titem = ui-&gt;menuTable-&gt;item(i, 3);\t\t\tdouble discount = item-&gt;text().toDouble();\t\t\titem = ui-&gt;menuTable-&gt;item(i, 4);\t\t\tQString imagePath = item-&gt;text();\t\t\tout &lt;&lt; menuName &lt;&lt; type &lt;&lt; price &lt;&lt; discount&lt;&lt;imagePath;\t\t\t\t&#125;\t\tfile.close();\t&#125;&#125;\n12.7 åœ¨ä¸€ä¸ªqtablewidgetitemä¸­è®¾ç½®å¤é€‰æ¡†\nQTableWidgetItem* item;for (int i = 0; i &lt; ui-&gt;menuTable-&gt;rowCount(); i++)&#123;\titem = ui-&gt;menuTable-&gt;item(i,0);\titem-&gt;setCheckState(Qt::Unchecked);&#125;//å•ä¸€æ§åˆ¶ åˆ©ç”¨QTableWidget::cellchanged()å‡½æ•°åˆ¤æ–­å•å…ƒæ ¼å†…å®¹çš„å˜åŒ–//æ‰¹é‡åˆ é™¤è¢«é€‰æ‹©çš„è¡Œvoid ManagerInterface::on_deleteBut_clicked()&#123;\tfor (int i = 0; i &lt; ui-&gt;menuTable-&gt;rowCount(); i++)\t&#123;\t\tif(ui-&gt;menuTable-&gt;item(i,0)-&gt;checkState() == Qt::Checked)\t\t\tui-&gt;menuTable-&gt;removeRow(i);\t&#125;&#125;\n","categories":["ç¼–ç¨‹"],"tags":["C++","Qt"]},{"title":"è®¢é¤ç¨‹åºæ¶‰åŠçŸ¥è¯†","url":"/2024/05/16/school_assignments/%E8%AE%A2%E9%A4%90%E7%A8%8B%E5%BA%8F%E6%B6%89%E5%8F%8A%E7%9F%A5%E8%AF%86/","content":"\nè®°å½•äº†ä¸€ä¸‹é¡¹ç›®åˆ¶ä½œè¿‡ç¨‹ä¸­ æ‰€æ¶‰åŠçš„ä¸ç†Ÿæ‚‰çš„éƒ¨åˆ†æºç å¯è‡³GitHubæŸ¥çœ‹\n\n\nç›¸å…³çŸ¥è¯†\nctime å¤´æ–‡ä»¶\n1.1  time_t time(time_t *timer): è¿”å›è‡ªçºªå…ƒä»¥æ¥ç»è¿‡çš„æ—¶é—´ï¼Œä»¥ç§’ä¸ºå•ä½\ntime_t currentTime;time(&amp; currentTime);\n1.2 struct tm *localtime(const time_t *timer): å°† time_t æ ¼å¼çš„æ—¶é—´è½¬æ¢ä¸ºæœ¬åœ°æ—¶é—´ï¼Œè¿”å›ä¸€ä¸ªæŒ‡å‘ tm ç»“æ„ä½“çš„æŒ‡é’ˆ\ntime_t currTime;time(&amp;currTime);struct tm* timeTmp = locatime(&amp;currTime);\n1.3 char *asctime(const struct tm *timeptr): å°† tm ç»“æ„ä½“è¡¨ç¤ºçš„æ—¶é—´è½¬æ¢ä¸ºå­—ç¬¦ä¸²å½¢å¼çš„æ—¶é—´ï¼Œå¹¶è¿”å›æŒ‡å‘é™æ€å­—ç¬¦ä¸²çš„æŒ‡é’ˆ\n time_t currTime;time(&amp;currTime);struct tm* timeTmp = locatime(&amp;currTime);char *timeString = asctime(&amp;timeTmp);\n1.4 tmç»“æ„ä½“(åŒ…å«åœ¨ctimeå¤´æ–‡ä»¶ä¸­)\nstruct tm &#123;    int tm_sec;   // ç§’ï¼ˆ0-59ï¼‰    int tm_min;   // åˆ†é’Ÿï¼ˆ0-59ï¼‰    int tm_hour;  // å°æ—¶ï¼ˆ0-23ï¼‰    int tm_mday;  // ä¸€ä¸ªæœˆä¸­çš„æ—¥æœŸï¼ˆ1-31ï¼‰    int tm_mon;   // æœˆä»½ï¼ˆ0-11ï¼‰    int tm_year;  // å¹´ä»½è‡ª1900å¹´èµ·    int tm_wday;  // ä¸€å‘¨ä¸­çš„å¤©æ•°ï¼ˆ0-6ï¼Œæ˜ŸæœŸæ—¥ä¸º0ï¼‰    int tm_yday;  // ä¸€å¹´ä¸­çš„å¤©æ•°ï¼ˆ0-365ï¼Œ1æœˆ1æ—¥ä¸º0ï¼‰    int tm_isdst; // å¤ä»¤æ—¶æ ‡å¿—ï¼ˆ&gt;0 è¡¨ç¤ºæ˜¯å¤ä»¤æ—¶ï¼Œ0 è¡¨ç¤ºä¸æ˜¯å¤ä»¤æ—¶ï¼Œ-1 è¡¨ç¤ºå¤ä»¤æ—¶ä¿¡æ¯ä¸å¯ç”¨ï¼‰&#125;;\n1.5 ä½¿ç”¨\n\nå…ˆä½¿ç”¨time()å‡½æ•°è·å–è‡ª1970å¹´1æœˆ1æ—¥åˆå¤œï¼ˆæ ¼æ—å¨æ²»æ—¶é—´ï¼‰èµ·ç®—çš„ç§’æ•°ï¼Œç„¶åä½¿ç”¨localtime()å‡½æ•°å°†å…¶è½¬åŒ–ä¸ºæœ¬åœ°æ—¶é—´ (ä½¿ç”¨tmç»“æ„ä½“å­˜å‚¨)ï¼Œæœ€åæ ¹æ®éœ€è¦è¿›è¡Œæ‰“å°\n\n#define _CRT_SECURE_NO_WARNINGS#include &lt;iostream&gt; #include&lt;ctime&gt;using namespace std;int main()&#123;    time_t now;    time(&amp;now);    struct tm* lt = localtime(&amp;now);    cout &lt;&lt; &quot;Local time is: &quot; &lt;&lt; lt-&gt;tm_year + 1900 &lt;&lt; &quot;-&quot; &lt;&lt; lt-&gt;tm_mon + 1 &lt;&lt; &quot;-&quot; &lt;&lt; lt-&gt;tm_mday &lt;&lt; &quot; &quot; &lt;&lt; lt-&gt;tm_hour &lt;&lt; &quot;:&quot; &lt;&lt; lt-&gt;tm_min &lt;&lt; &quot;:&quot; &lt;&lt; lt-&gt;tm_sec &lt;&lt; endl;    char* timeStr = asctime(lt);    cout &lt;&lt; &quot;Formatted time is: &quot; &lt;&lt; timeStr &lt;&lt; endl;    char buffer[255];    strftime(buffer, 255, &quot;%Y-%m-%d %H:%M:%S&quot;, lt);    //sprintf(buffer,&quot;%04d-%02d-%02d %02d:%02d:%02d&quot;, lt-&gt;tm_year + 1900, lt-&gt;tm_mon + 1, lt-&gt;tm_mday, lt-&gt;tm_hour,lt-&gt;tm_min,lt-&gt;tm_sec);    cout &lt;&lt; &quot;Formatted time is: &quot; &lt;&lt; buffer &lt;&lt; endl;    return 0;&#125;----------è¾“å‡ºç»“æœ-----------------Local time is: 2024-4-28 17:15:42Formatted time is: Sun Apr 28 17:15:42 2024Formatted time is: 2024-04-28 17:15:42\nCMakeç®€å•ä½¿ç”¨\n2.1 åˆ›å»ºä¸€ä¸ªCMakeLists.txtæ–‡ä»¶\n2.2 åˆ›å»ºä¸€ä¸ªåä¸ºbuildçš„æ–‡ä»¶å¤¹\n\né¿å…ç¼–è¯‘äº§ç‰©ä¸ä»£ç æ–‡ä»¶æ··åœ¨ä¸€èµ·\n\n2.3 åœ¨CMakeLists.txtä¸­å†™å…¥å†…å®¹\n# è®¾ç½® CMake çš„æœ€ä½ç‰ˆæœ¬è¦æ±‚cmake_minimum_required(VERSION 3.20)# å®šä¹‰é¡¹ç›®åç§°project(dinnerSystem)# æ·»åŠ å¯æ‰§è¡Œæ–‡ä»¶ï¼Œå¹¶æŒ‡å®šæºæ–‡ä»¶# äº¦å¯å†™æˆ  add_executable($&#123;PROJECT_NAME&#125;)add_executable(dinnerSystem)# ä½¿ç”¨fileå‡½æ•° globbing åŒ¹é…æ¥è·å–æ‰€æœ‰çš„ .cpp å’Œ .h æ–‡ä»¶,å¹¶å°†æ–‡ä»¶ä¿å­˜åœ¨sourceså˜é‡ä¸­file(GLOB sources CONFIGURE_DEPENDS *.cpp *.h)# å°†è·å–çš„æºæ–‡ä»¶ä¸ç›®æ ‡æ–‡ä»¶ç›¸å…³è”#target_sources($&#123;PROJECT_NAME&#125; PBULIC $&#123;sources&#125;)target_sources(dinnerSystem PUBLIC $&#123;sources&#125;)\n2.4 åœ¨buildæ–‡ä»¶å¤¹ä¸­æ‰“å¼€cmd\nè¾“å…¥cmake ..\ncmake --build .\nè§£å†³ä¸­æ–‡ä¹±ç \nä½¿ç”¨UTF-8 æ— BOM  å¯ä»¥åœ¨VS2022ä¸‹è½½æ’ä»¶Force UTF-8(No BOM)\nQtçš„åŸºç¡€ä½¿ç”¨\nè§å¦ä¸€ç¯‡ç¬”è®°\n","categories":["ç¼–ç¨‹"],"tags":["C++"]},{"title":"èº«ä»½è¯å·ç ç®€æ˜“è¯†åˆ«(opencv + Qt)","url":"/2024/05/30/school_assignments/%E8%BA%AB%E4%BB%BD%E8%AF%81%E5%8F%B7%E7%A0%81%E7%AE%80%E6%98%93%E8%AF%86%E5%88%AB-opencv-Qt/","content":"è®°å½•äº†ä¸€ä¸‹é¡¹ç›®åˆ¶ä½œè¿‡ç¨‹ä¸­ opencvåŸºæœ¬APIçš„ä½¿ç”¨,ä»¥åŠä¸€äº›åŸºæœ¬æ¦‚å¿µæºç å¯è‡³GitHubæŸ¥çœ‹\n \nèº«ä»½è¯ä¿¡æ¯è¯†åˆ«\n1. å›¾ç‰‡çš„è¯»å– æ˜¾ç¤º\n\nimread()è¯»å–å›¾åƒï¼ŒimreadåŒ…å«ä¸¤ä¸ªå‚æ•°ï¼šimread(å›¾åƒè·¯å¾„ï¼Œ å›¾åƒå½¢å¼)ï¼›\nnamedWindow() ç”¨æ¥æ–°å»ºä¸€ä¸ªæ˜¾ç¤ºçª—å£,ç”¨æ¥æ˜¾ç¤ºå›¾åƒ,åŒ…å«ä¸¤ä¸ªå‚æ•°ï¼šnamedWindow(çª—å£åç§°ï¼Œ çª—å£å½¢å¼)\n**imshow()**ç”¨äºæ˜¾ç¤ºå›¾åƒ,åŒ…å«ä¸¤ä¸ªå‚æ•°ï¼šimshow(çª—å£åç§°ï¼Œå›¾åƒåç§°)\n\nå›¾åƒå½¢å¼æœ‰ä¸‰ç§\n\n\nåŠ è½½å½©è‰²å›¾ç‰‡ (é»˜è®¤åŠ è½½å½¢å¼)\n\n\nimread(å›¾åƒè·¯å¾„ï¼Œ IMREAD_COLOR)ï¼›//æˆ–è€…imread(å›¾åƒè·¯å¾„ï¼Œ 1)ï¼›\n\n\nåŠ è½½ç°åº¦æ¨¡å¼å›¾åƒ\n\n\nimread(å›¾åƒè·¯å¾„ï¼Œ IMREAD_GRAYSCALE)ï¼›//æˆ–è€…imread(å›¾åƒè·¯å¾„ï¼Œ 0)ï¼›\n\n\nåŠ è½½å›¾åƒ,åŒ…æ‹¬alphaé€šé“\n\n\nimread(å›¾åƒè·¯å¾„ï¼ŒIMREAD_UNCHANGED)ï¼›//æˆ–è€…imread(å›¾åƒè·¯å¾„ï¼Œ -1)ï¼›\nçª—å£å½¢å¼\n\n\næ˜¾ç¤ºçš„å›¾åƒå¤§å°ä¸èƒ½æ”¹å˜ï¼ˆé»˜è®¤å½¢å¼ï¼‰\nnamedWindow(çª—å£åç§°ï¼Œ WINDOW_AUTOSIZE)     1\n\n\nå›¾åƒå¤§å°èƒ½å¤Ÿè°ƒèŠ‚\nnamedWindow(çª—å£åç§°ï¼Œ WINDOW_NORMAL)      0\n\n\nç¤ºä¾‹ä»£ç \n#include&lt;opencv2/opencv.hpp&gt;#include&lt;iostream&gt;using namespace cv;using namespace std;int main()&#123;\tMat image;   //åˆ›å»ºä¸€ä¸ªç©ºå›¾åƒimage\timage = imread(&quot;D://work//c++//Imageprocessing1//ä¼é¹….jpg&quot;);  //è¯»å–æ–‡ä»¶å¤¹ä¸­çš„å›¾åƒ\t//æ£€æµ‹å›¾åƒæ˜¯å¦åŠ è½½æˆåŠŸ\tif (image.empty())  //æ£€æµ‹imageæœ‰æ— æ•°æ®ï¼Œæ— æ•°æ® image.empty()è¿”å› çœŸ\t&#123;\t\tcout &lt;&lt; &quot;Could not open or find the image&quot; &lt;&lt; endl;\t\treturn -1;\t&#125;\tnamedWindow(&quot;IMAGE&quot;);  //åˆ›å»ºæ˜¾ç¤ºçª—å£ï¼Œä¸åŠ è¿™è¡Œä»£ç ï¼Œä¹Ÿèƒ½æ˜¾ç¤ºï¼Œé»˜è®¤çª—å£å¤§å°ä¸èƒ½æ”¹å˜\timshow(&quot;IMAGE&quot;, image);  //åœ¨çª—å£æ˜¾ç¤ºå›¾åƒ\timwrite(&quot;1.png&quot;, image); //ä¿å­˜å›¾åƒä¸ºpngæ ¼å¼ï¼Œæ–‡ä»¶åç§°ä¸º1\twaitKey(0);  //æš‚åœï¼Œä¿æŒå›¾åƒæ˜¾ç¤ºï¼Œç­‰å¾…æŒ‰é”®ç»“æŸ\treturn 0;&#125;\n2. qtä¸­çš„stringè½¬åŒ–ä¸ºopencvä¸­çš„string\n\nå…ˆè°ƒç”¨ toLocal8Bit() æ–¹æ³•å°† fileName è½¬æ¢ä¸ºæœ¬åœ°8ä½ç¼–ç çš„ QByteArrayï¼Œç„¶åå†è°ƒç”¨ data() æ–¹æ³•è·å–è¯¥ QByteArray ä¸­å­˜å‚¨çš„ C é£æ ¼å­—ç¬¦ä¸²çš„æŒ‡é’ˆ\n\nvoid ID_card_recognition::read_image(const QString&amp; fileName)&#123;    QString tmpPath = fileName.toLocal8Bit().data();//å°† fileName è½¬æ¢ä¸ºæœ¬åœ°8ä½ç¼–ç çš„ C é£æ ¼å­—ç¬¦ä¸²    Mat image;   //åˆ›å»ºä¸€ä¸ªç©ºå›¾åƒimage    image = imread(tmpPath.toStdString(), IMREAD_COLOR);  //è¯»å–æ–‡ä»¶å¤¹ä¸­çš„å›¾åƒ&#125;\n3. äºŒå€¼åŒ–å¤„ç†\n\näºŒå€¼åŒ–å¤„ç†ï¼ˆBinarizationï¼‰æ˜¯ä¸€ç§å›¾åƒå¤„ç†æŠ€æœ¯ï¼Œå®ƒå°†å›¾åƒä¸­çš„åƒç´ å€¼æ ¹æ®ç‰¹å®šçš„é˜ˆå€¼è½¬åŒ–ä¸ºä¸¤ç§å€¼ï¼ˆé€šå¸¸æ˜¯0å’Œ255ï¼‰ï¼Œä»è€Œç®€åŒ–å›¾åƒçš„æ•°æ®è¡¨ç¤ºã€‚\né€šå¸¸éœ€è¦å…ˆå°†å›¾ç‰‡è½¬æ¢ä¸ºç°åº¦å›¾åƒå†è¿›è¡ŒäºŒå€¼åŒ–å¤„ç†\n\n\n\nvoid threshold(InputArray src, OutputArray dst, double thresh, double maxval, int type);\n\n\n\nthreshold() å‡½æ•°æ˜¯ OpenCV ä¸­ç”¨äºå›¾åƒäºŒå€¼åŒ–çš„å‡½æ•°ï¼Œå®ƒå°†è¾“å…¥å›¾åƒçš„åƒç´ å€¼æ ¹æ®æŒ‡å®šçš„é˜ˆå€¼è¿›è¡Œåˆ†å‰²ï¼Œç”Ÿæˆä¸€ä¸ªäºŒå€¼åŒ–å›¾åƒ\n\n\n\ncv::THRESH_BINARYï¼šå¦‚æœæºå›¾åƒåƒç´ å€¼å¤§äºé˜ˆå€¼ï¼Œåˆ™è¾“å‡ºå›¾åƒçš„å¯¹åº”åƒç´ å€¼è®¾ç½®ä¸ºmaxvalï¼Œå¦åˆ™è®¾ç½®ä¸º0ã€‚\n\n\ncv::THRESH_BINARY_INVï¼šä¸THRESH_BINARYç›¸åï¼Œå¦‚æœæºå›¾åƒåƒç´ å€¼å¤§äºé˜ˆå€¼ï¼Œåˆ™è¾“å‡ºå›¾åƒçš„å¯¹åº”åƒç´ å€¼è®¾ç½®ä¸º0ï¼Œå¦åˆ™è®¾ç½®ä¸ºmaxvalã€‚\n\n\ncv::THRESH_TRUNCï¼šå¦‚æœæºå›¾åƒåƒç´ å€¼å¤§äºé˜ˆå€¼ï¼Œåˆ™è¾“å‡ºå›¾åƒçš„å¯¹åº”åƒç´ å€¼è®¾ç½®ä¸ºé˜ˆå€¼threshï¼Œå¦åˆ™ä¿æŒæºå›¾åƒçš„åƒç´ å€¼ä¸å˜ã€‚\n\n\ncv::THRESH_TOZEROï¼šå¦‚æœæºå›¾åƒåƒç´ å€¼å¤§äºé˜ˆå€¼ï¼Œåˆ™è¾“å‡ºå›¾åƒçš„å¯¹åº”åƒç´ å€¼ä¿æŒä¸å˜ï¼Œå¦åˆ™è®¾ç½®ä¸º0ã€‚\n\n\ncv::THRESH_TOZERO_INVï¼šä¸THRESH_TOZEROç›¸åï¼Œå¦‚æœæºå›¾åƒåƒç´ å€¼å¤§äºé˜ˆå€¼ï¼Œåˆ™è¾“å‡ºå›¾åƒçš„å¯¹åº”åƒç´ å€¼è®¾ç½®ä¸º0ï¼Œå¦åˆ™ä¿æŒæºå›¾åƒçš„åƒç´ å€¼ä¸å˜ã€‚\n\n\ncv::THRESH_MASKï¼šè¿™æ˜¯ä¸€ä¸ªæ©ç å€¼ï¼Œç”¨äºä¸ä¸Šè¿°å…¶ä»–å€¼è¿›è¡ŒæŒ‰ä½æˆ–æ“ä½œï¼Œä»¥ä¿æŒæ—§çš„OpenCVå…¼å®¹æ€§ã€‚\n\n\ncv::THRESH_OTSUï¼šåœ¨ä½¿ç”¨THRESH_BINARYæˆ–THRESH_BINARY_INVé˜ˆå€¼ç±»å‹æ—¶ï¼Œè¿™ä¸ªæ ‡å¿—å¯ä»¥è‡ªåŠ¨é€‰æ‹©æœ€ä¼˜çš„é˜ˆå€¼ã€‚å®ƒä¼šè®¡ç®—æºå›¾åƒçš„ç›´æ–¹å›¾ï¼Œå¹¶ä½¿ç”¨å¤§æ´¥äºŒå€¼åŒ–æ–¹æ³•æ¥æ‰¾åˆ°å°†å›¾åƒåˆ†ä¸ºä¸¤ä¸ªç±»åˆ«çš„æœ€ä½³é˜ˆå€¼ã€‚\n\n\ncv::THRESH_TRIANGLEï¼šè¿™æ˜¯å¦ä¸€ä¸ªè‡ªåŠ¨é€‰æ‹©é˜ˆå€¼çš„æ ‡å¿—ï¼Œå®ƒä½¿ç”¨ä¸‰è§’å½¢æ–¹æ³•æ¥æ‰¾åˆ°æœ€ä¼˜é˜ˆå€¼ï¼Œè¿™ç§æ–¹æ³•é€šå¸¸æ¯”å¤§æ´¥æ–¹æ³•æ›´å¿«ï¼Œä½†åœ¨æŸäº›æƒ…å†µä¸‹å¯èƒ½ä¸å¦‚å¤§æ´¥æ–¹æ³•å‡†ç¡®ã€‚\n\n\n#include &lt;opencv2/opencv.hpp&gt;#include &lt;iostream&gt;using namespace cv;using namespace std;int main() &#123;    // è¯»å–ç°åº¦å›¾åƒ    Mat image = imread(&quot;image.jpg&quot;, IMREAD_GRAYSCALE);    if (image.empty()) &#123;        cout &lt;&lt; &quot;Could not open or find the image&quot; &lt;&lt; endl;        return -1;    &#125;        // è®¾ç½®é˜ˆå€¼å’Œæœ€å¤§å€¼    int thresh_value = 0;    int max_value = 255;    // åº”ç”¨äºŒå€¼åŒ–    Mat binary_image; \tthreshold(image, binary_image, thresh_val, max_value, THRESH_BINARY | THRESH_OTSU);    /*THRESH_BINARYï¼šå¤§äºé˜ˆå€¼çš„åƒç´ èµ‹å€¼ä¸º maxvalï¼Œå°äºç­‰äºé˜ˆå€¼çš„åƒç´ èµ‹å€¼ä¸º 0ã€‚    THRESH_OTSUå¯ä»¥å®ç° Otsu&#x27;s äºŒå€¼åŒ–æ–¹æ³•ï¼Œå³è‡ªåŠ¨é€‰æ‹©æœ€ä¼˜çš„é˜ˆå€¼ï¼Œè€Œæ— éœ€æ‰‹åŠ¨æŒ‡å®šé˜ˆå€¼    äºŒè€…é€šå¸¸ç»“åˆä½¿ç”¨  ä½¿ç”¨Otsu&#x27;sæ—¶thresh å‚æ•°å¯ä»¥è®¾ç½®ä¸º 0ï¼Œå› ä¸ºè¯¥å€¼ä¸ä¼šè¢«å®é™…ä½¿ç”¨*/    // æ˜¾ç¤ºç»“æœ    imshow(&quot;Binary Image&quot;, binary_image);    waitKey(0);    destroyAllWindows();    return 0;&#125;\n4. åŒè¾¹æ»¤æ³¢\n\nåŒè¾¹æ»¤æ³¢ï¼ˆBilateral Filterï¼‰æ˜¯ä¸€ç§éçº¿æ€§æ»¤æ³¢æŠ€æœ¯ï¼Œå®ƒèƒ½å¤Ÿåœ¨ä¿æŒè¾¹ç¼˜æ¸…æ™°çš„åŒæ—¶æœ‰æ•ˆåœ°å»é™¤å›¾åƒä¸­çš„å™ªå£°\n\nvoid bilateralFilter(InputArray src, OutputArray dst, int d, double sigmaColor, double sigmaSpace, int borderType = BORDER_DEFAULT);\n\n\ndï¼šæ»¤æ³¢å™¨çš„ç›´å¾„ã€‚å¦‚æœä¸º -1ï¼Œåˆ™æ ¹æ® sigmaSpace è‡ªåŠ¨è®¡ç®—ã€‚\n\n\nsigmaColorï¼šé¢œè‰²ç©ºé—´çš„æ ‡å‡†å·®ï¼Œè¾ƒå¤§çš„å€¼è¡¨ç¤ºé¢œè‰²ç©ºé—´ä¸­æ›´å¤§çš„åƒç´ è·ç¦»å°†ç›¸äº’æ··åˆã€‚\n\n\nsigmaSpaceï¼šç©ºé—´åŸŸçš„æ ‡å‡†å·®ï¼Œè¾ƒå¤§çš„å€¼è¡¨ç¤ºåœ¨ç©ºé—´åŸŸå†…çš„åƒç´ è·ç¦»å°†ç›¸äº’æ··åˆã€‚\n\n\nborderTypeï¼šç”¨äºå¤„ç†è¾¹ç•Œçš„ç±»å‹ï¼Œé»˜è®¤ä¸º BORDER_DEFAULTã€‚\n\n\n5.  æŸ¥æ‰¾è½®å»“\n\nè½®å»“å¯ä»¥çœ‹ä½œæ˜¯å°†å…·æœ‰ç›¸åŒé¢œè‰²æˆ–ç°åº¦å€¼çš„æ‰€æœ‰è¿ç»­ç‚¹ï¼ˆæ²¿ç€è¾¹ç•Œï¼‰è¿æ¥èµ·æ¥çš„æ›²çº¿\n\n//å‡½æ•°åŸå‹void cv::findContours(    InputOutputArray image,    OutputArrayOfArrays contours,    OutputArray hierarchy,    int mode,    int method,    Point offset = Point());//åœ¨é»‘è‰²èƒŒæ™¯ä¸­å¯»æ‰¾ç™½è‰²è½®å»“\n\n\nimageï¼šè¾“å…¥å›¾åƒï¼ˆ8ä½å•é€šé“å›¾åƒï¼‰ï¼Œä¹Ÿæ˜¯è¾“å‡ºå›¾åƒã€‚\n\nå›¾åƒå¿…é¡»æ˜¯äºŒå€¼åŒ–å›¾åƒï¼ˆé€šå¸¸é€šè¿‡ cv::threshold æˆ– cv::Canny ç­‰æ–¹æ³•é¢„å¤„ç†ï¼‰ã€‚\nè¯¥å‡½æ•°ä¼šä¿®æ”¹è¾“å…¥å›¾åƒï¼Œå»ºè®®åœ¨è°ƒç”¨è¯¥å‡½æ•°ä¹‹å‰å¯¹å›¾åƒè¿›è¡Œå¤‡ä»½ã€‚\n\n\n\ncontoursï¼šè¾“å‡ºå‚æ•°ï¼Œç”¨äºå­˜å‚¨æ£€æµ‹åˆ°çš„è½®å»“ã€‚\n\nè½®å»“å­˜å‚¨ä¸ºç‚¹çš„å‘é‡çš„å‘é‡ï¼Œæ¯ä¸ªè½®å»“æ˜¯ä¸€ä¸ª std::vector&lt;cv::Point&gt; ç±»å‹çš„å¯¹è±¡ã€‚\n\n\n\nhierarchyï¼šè¾“å‡ºå‚æ•°ï¼Œç”¨äºå­˜å‚¨æ¯ä¸ªè½®å»“çš„å±‚æ¬¡ç»“æ„ä¿¡æ¯ã€‚\n\nè¿™æ˜¯ä¸€ä¸ª std::vector&lt;cv::Vec4i&gt; ç±»å‹çš„å‘é‡ã€‚\nhierarchy[i][0] è¡¨ç¤ºåä¸€ä¸ªè½®å»“çš„ç´¢å¼•ã€‚\nhierarchy[i][1] è¡¨ç¤ºå‰ä¸€ä¸ªè½®å»“çš„ç´¢å¼•ã€‚\nhierarchy[i][2] è¡¨ç¤ºçˆ¶è½®å»“çš„ç´¢å¼•ã€‚\nhierarchy[i][3] è¡¨ç¤ºç¬¬ä¸€ä¸ªå­è½®å»“çš„ç´¢å¼•ã€‚\n\n\n\nmodeï¼šè½®å»“æ£€ç´¢æ¨¡å¼ï¼Œå†³å®šè½®å»“çš„æå–æ–¹å¼å’Œå±‚æ¬¡ç»“æ„ã€‚\n\ncv::RETR_EXTERNALï¼šåªæ£€ç´¢æœ€å¤–å±‚çš„è½®å»“ã€‚\ncv::RETR_LISTï¼šæ£€ç´¢æ‰€æœ‰è½®å»“ï¼Œä½†ä¸å»ºç«‹å±‚æ¬¡ç»“æ„ã€‚\ncv::RETR_CCOMPï¼šæ£€ç´¢æ‰€æœ‰è½®å»“å¹¶å°†å®ƒä»¬ç»„ç»‡æˆä¸¤çº§å±‚æ¬¡ç»“æ„ã€‚\ncv::RETR_TREEï¼šæ£€ç´¢æ‰€æœ‰è½®å»“å¹¶é‡å»ºåµŒå¥—è½®å»“çš„å®Œæ•´å±‚æ¬¡ç»“æ„ã€‚\n\n\n\nmethodï¼šè½®å»“è¿‘ä¼¼æ–¹æ³•ï¼Œå†³å®šå¦‚ä½•å­˜å‚¨è½®å»“ç‚¹ã€‚\n\ncv::CHAIN_APPROX_NONEï¼šå­˜å‚¨æ‰€æœ‰è½®å»“ç‚¹ã€‚\ncv::CHAIN_APPROX_SIMPLEï¼šå‹ç¼©æ°´å¹³ã€å‚ç›´å’Œå¯¹è§’çº¿æ®µï¼Œåªä¿ç•™å®ƒä»¬çš„ç«¯ç‚¹ã€‚\ncv::CHAIN_APPROX_TC89_L1 å’Œ cv::CHAIN_APPROX_TC89_KCOSï¼šä½¿ç”¨ Teh-Chin é“¾è¿‘ä¼¼ç®—æ³•ã€‚\n\n\n\noffsetï¼ˆå¯é€‰ï¼‰ï¼šå¯é€‰å‚æ•°ï¼Œç”¨äºå¯¹è¾“å‡ºçš„è½®å»“ç‚¹åæ ‡è¿›è¡Œåç§»ï¼Œé»˜è®¤ä¸º (0, 0)ã€‚\n\n\n6. ç»˜åˆ¶è½®å»“\n//å‡½æ•°åŸå‹void cv::drawContours(    InputOutputArray image,    InputArrayOfArrays contours,    int contourIdx,    const Scalar&amp; color,    int thickness = 1,    int lineType = LINE_8,    InputArray hierarchy = noArray(),    int maxLevel = INT_MAX,    Point offset = Point());\n\n\nimageï¼šè¾“å…¥è¾“å‡ºå‚æ•°ï¼Œç”¨äºç»˜åˆ¶è½®å»“çš„å›¾åƒã€‚\n\nç±»å‹ä¸º cv::InputOutputArrayï¼Œé€šå¸¸ä¸º cv::Mat ç±»å‹ã€‚\nè¿™æ˜¯ä¸€ä¸ªä¿®æ”¹åçš„å›¾åƒï¼Œè½®å»“ä¼šè¢«ç»˜åˆ¶åœ¨è¯¥å›¾åƒä¸Šã€‚\n\n\n\ncontoursï¼šè¾“å…¥å‚æ•°ï¼Œè¡¨ç¤ºè½®å»“çš„é›†åˆã€‚\n\nç±»å‹ä¸º cv::InputArrayOfArraysï¼Œé€šå¸¸æ˜¯ std::vector&lt;std::vector&lt;cv::Point&gt;&gt; ç±»å‹ã€‚\næ¯ä¸ªè½®å»“éƒ½æ˜¯ä¸€ä¸ªç‚¹çš„é›†åˆï¼Œè¡¨ç¤ºå›¾åƒä¸­çš„ä¸€ä¸ªè¿é€šåŒºåŸŸã€‚\n\n\n\ncontourIdxï¼šè¾“å…¥å‚æ•°ï¼ŒæŒ‡å®šç»˜åˆ¶å“ªä¸ªè½®å»“çš„ç´¢å¼•ã€‚\n\nå¦‚æœä¸ºè´Ÿå€¼ï¼ˆä¾‹å¦‚ -1ï¼‰ï¼Œåˆ™ç»˜åˆ¶æ‰€æœ‰è½®å»“ã€‚\n\n\n\ncolorï¼šè¾“å…¥å‚æ•°ï¼ŒæŒ‡å®šç»˜åˆ¶è½®å»“çš„é¢œè‰²ã€‚\n\nç±»å‹ä¸º cv::Scalarï¼Œä¾‹å¦‚ cv::Scalar(0, 255, 0) è¡¨ç¤ºç»¿è‰²ã€‚\n\n\n\nthicknessï¼ˆå¯é€‰ï¼‰ï¼šè¾“å…¥å‚æ•°ï¼ŒæŒ‡å®šç»˜åˆ¶è½®å»“çš„çº¿æ¡ç²—ç»†ã€‚\n\né»˜è®¤å€¼ä¸º 1ã€‚\nå¦‚æœå€¼ä¸º FILLED æˆ–è´Ÿå€¼ï¼Œåˆ™å¡«å……æ•´ä¸ªè½®å»“ã€‚\n\n\n\nlineTypeï¼ˆå¯é€‰ï¼‰ï¼šè¾“å…¥å‚æ•°ï¼ŒæŒ‡å®šçº¿æ¡çš„ç±»å‹ã€‚\n\né»˜è®¤å€¼ä¸º cv::LINE_8ï¼Œè¡¨ç¤º 8-è¿æ¥çº¿ã€‚\nå¯ä»¥ä¸º cv::LINE_4ï¼ˆ4-è¿æ¥çº¿ï¼‰æˆ– cv::LINE_AAï¼ˆæŠ—é”¯é½¿çº¿ï¼‰ã€‚\n\n\n\nhierarchyï¼ˆå¯é€‰ï¼‰ï¼šè¾“å…¥å‚æ•°ï¼ŒæŒ‡å®šè½®å»“çš„å±‚æ¬¡ç»“æ„ã€‚\n\nç±»å‹ä¸º cv::InputArrayï¼Œé€šå¸¸æ˜¯ std::vector&lt;cv::Vec4i&gt; ç±»å‹ã€‚\nå¦‚æœä¸éœ€è¦å±‚æ¬¡ç»“æ„ï¼Œå¯ä»¥ä¼ é€’ cv::noArray()ã€‚\n\n\n\nmaxLevelï¼ˆå¯é€‰ï¼‰ï¼šè¾“å…¥å‚æ•°ï¼ŒæŒ‡å®šç»˜åˆ¶è½®å»“çš„æœ€å¤§å±‚æ¬¡ã€‚\n\né»˜è®¤å€¼ä¸º INT_MAXï¼Œè¡¨ç¤ºç»˜åˆ¶æ‰€æœ‰å±‚æ¬¡çš„è½®å»“ã€‚\nä¾‹å¦‚ï¼Œå¦‚æœè®¾ç½®ä¸º 0ï¼Œåˆ™åªç»˜åˆ¶æœ€å¤–å±‚çš„è½®å»“ã€‚\n\n\n\noffsetï¼ˆå¯é€‰ï¼‰ï¼šè¾“å…¥å‚æ•°ï¼ŒæŒ‡å®šç»˜åˆ¶è½®å»“æ—¶çš„åç§»é‡ã€‚\n\nç±»å‹ä¸º cv::Pointï¼Œé»˜è®¤å€¼ä¸º cv::Point(0, 0)ã€‚\n\n\n\n7 ç»˜åˆ¶è½®å»“(äºŒ)\n7.1 cv::boundingRect å‡½æ•°\n\nç”¨äºè®¡ç®—ç»™å®šç‚¹é›†æˆ–è½®å»“çš„æœ€å°è¾¹ç•ŒçŸ©å½¢ã€‚è¿™ä¸ªçŸ©å½¢æ˜¯å®Œå…¨åŒ…å«è¾“å…¥è½®å»“çš„æœ€å°çŸ©å½¢ï¼Œå¹¶ä¸”å…¶è¾¹ä¸åæ ‡è½´å¯¹é½ã€‚\n\ncv::Rect cv::boundingRect(InputArray points);\n\n\npointsï¼šè¾“å…¥çš„ç‚¹é›†ï¼Œå¯ä»¥æ˜¯ä¸€ä¸ªè½®å»“ï¼ˆå¦‚ std::vector&lt;cv::Point&gt;ï¼‰æˆ–è€…æ˜¯ cv::Mat ç±»å‹çš„ç‚¹é›†ã€‚\n\n\nè¿”å›å€¼\n\n\nè¿”å›ä¸€ä¸ª cv::Rect å¯¹è±¡ï¼Œè¡¨ç¤ºåŒ…å«æ‰€æœ‰è¾“å…¥ç‚¹çš„æœ€å°è¾¹ç•ŒçŸ©å½¢ã€‚\n\n\n7.2 cv::rectangle å‡½æ•°\n\nç”¨äºåœ¨å›¾åƒä¸Šç»˜åˆ¶çŸ©å½¢ã€‚å¯ä»¥æ ¹æ®éœ€è¦è®¾ç½®çŸ©å½¢çš„ä½ç½®ã€å¤§å°ã€é¢œè‰²å’Œçº¿æ¡åšåº¦ç­‰å±æ€§ã€‚\n\n//å‡½æ•°åŸå‹void cv::rectangle(    InputOutputArray img,    Point pt1,    Point pt2,    const Scalar&amp; color,    int thickness = 1,    int lineType = LINE_8,    int shift = 0);æˆ–è€…void cv::rectangle(    InputOutputArray img,    const Rect&amp; rec,    const Scalar&amp; color,    int thickness = 1,    int lineType = LINE_8,    int shift = 0);\n\n\nimgï¼šè¾“å…¥è¾“å‡ºå›¾åƒï¼Œç”¨äºç»˜åˆ¶çŸ©å½¢çš„å›¾åƒã€‚\n\n\npt1ï¼šçŸ©å½¢çš„ä¸€ä¸ªé¡¶ç‚¹ã€‚\n\n\npt2ï¼šçŸ©å½¢çš„å¯¹è§’é¡¶ç‚¹ã€‚\n\n\nrecï¼šè¡¨ç¤ºçŸ©å½¢çš„ cv::Rect å¯¹è±¡ã€‚\n\n\ncolorï¼šçŸ©å½¢çš„é¢œè‰²ï¼Œä½¿ç”¨ cv::Scalar å®šä¹‰ï¼Œä¾‹å¦‚ cv::Scalar(0, 255, 0) è¡¨ç¤ºç»¿è‰²ã€‚\n\n\nthicknessï¼šçº¿æ¡åšåº¦ã€‚é»˜è®¤å€¼ä¸º 1ã€‚å¦‚æœå€¼ä¸ºè´Ÿæ•°ï¼ˆå¦‚ FILLEDï¼‰ï¼Œåˆ™å¡«å……çŸ©å½¢ã€‚\n\n\nlineTypeï¼šçº¿æ¡ç±»å‹ï¼Œå¯ä»¥æ˜¯ cv::LINE_8ã€cv::LINE_4 æˆ– cv::LINE_AAã€‚\n\n\nshiftï¼šåæ ‡ç‚¹çš„å°æ•°ç‚¹ä½æ•°ï¼Œé»˜è®¤å€¼ä¸º 0ã€‚\n\n\nç¤ºä¾‹ä»£ç \nfor (size_t i = 0; i &lt; contours.size(); i++) &#123;    // è®¡ç®—è½®å»“çš„æœ€å°è¾¹ç•ŒçŸ©å½¢    cv::Rect boundingRect = cv::boundingRect(contours[i]);    // åœ¨å›¾åƒä¸Šç»˜åˆ¶è¾¹ç•ŒçŸ©å½¢    cv::rectangle(image, boundingRect, cv::Scalar(0, 255, 0), 2);    // è®¡ç®—å¹¶æ ‡è®°çŸ©å½¢çš„ä¸­å¿ƒç‚¹    cv::Point center = (boundingRect.tl() + boundingRect.br()) * 0.5;    cv::circle(image, center, 5, cv::Scalar(255, 0, 0), -1);&#125;\n8. è…èš€ ä¸ è†¨èƒ€\n\n\n9. å¼€æ“ä½œ é—­æ“ä½œ\nå¼€æ“ä½œå…ˆè…èš€åè†¨èƒ€çš„æ“ä½œç§°ä¹‹ä¸ºå¼€æ“ä½œã€‚ä¸»è¦ç”¨äºæ¶ˆé™¤å°çš„ç‰©ä½“ã€åœ¨çº¤ç»†ç‚¹å¤„åˆ†ç¦»ç‰©ä½“ã€å¹³æ»‘è¾ƒå¤§ç‰©ä½“çš„è¾¹ç•Œï¼ŒåŒæ—¶å¹¶ä¸æ˜æ˜¾æ”¹å˜å…¶é¢ç§¯ã€‚æ­¤å¤–ï¼Œå¼€æ“ä½œè¿˜å¯ä»¥ç”¨äºæå–æ°´å¹³æˆ–ç«–ç›´çš„çº¿æ¡\né—­æ“ä½œå…ˆè†¨èƒ€åè…èš€ ä¸»è¦ç”¨äºå¡«å……ç‰©ä½“å†…çš„å°ç©ºæ´ã€è¿æ¥é‚»è¿‘ç‰©ä½“ã€å¹³æ»‘å…¶è¾¹ç•Œï¼ŒåŒæ—¶å¹¶ä¸æ˜æ˜¾æ”¹å˜å…¶é¢ç§¯ å¯ä»¥ç”¨äºå¡«å……å°çš„å°é—­åŒºåŸŸ\n#include &lt;opencv2/opencv.hpp&gt;#include &lt;opencv2/highgui/highgui.hpp&gt;#include &lt;opencv2/imgproc/imgproc.hpp&gt;int main() &#123;    // è¯»å–å›¾åƒ    cv::Mat image = cv::imread(&quot;path_to_your_image.jpg&quot;, cv::IMREAD_COLOR);    if (image.empty()) &#123;        std::cerr &lt;&lt; &quot;æ— æ³•è¯»å–å›¾åƒ&quot; &lt;&lt; std::endl;        return -1;    &#125;    // æ˜¾ç¤ºåŸå§‹å›¾åƒ    cv::imshow(&quot;åŸå§‹å›¾åƒ&quot;, image);    // å®šä¹‰ç»“æ„å…ƒç´ ï¼Œç”¨äºå¼€æ“ä½œå’Œé—­æ“ä½œ    cv::Mat kernel = cv::getStructuringElement(cv::MORPH_RECT, cv::Size(5, 5));\t/*kernel2 = cv2.getStructuringElement(cv2.MORPH_ELLIPSE, (10, 10)) # æ¤­åœ†ç»“æ„\tkernel3 = cv2.getStructuringElement(cv2.MORPH_CROSS, (10, 10)) # åå­—ç»“æ„*/    // æ‰§è¡Œå¼€æ“ä½œ    cv::Mat open_result;    cv::morphologyEx(image, open_result, cv::MORPH_OPEN, kernel);    // æ˜¾ç¤ºå¼€æ“ä½œç»“æœ    cv::imshow(&quot;å¼€æ“ä½œç»“æœ&quot;, open_result);    // æ‰§è¡Œé—­æ“ä½œ    cv::Mat close_result;    cv::morphologyEx(image, close_result, cv::MORPH_CLOSE, kernel);    // æ˜¾ç¤ºé—­æ“ä½œç»“æœ    cv::imshow(&quot;é—­æ“ä½œç»“æœ&quot;, close_result);    // ç­‰å¾…æŒ‰é”®åé€€å‡º    cv::waitKey(0);    return 0;&#125;\n10. æ¨¡æ¿åŒ¹é…\nvoid matchTemplate(InputArray image, InputArray templ, OutputArray result, int method);\n\n\nimageï¼šè¾“å…¥å›¾åƒï¼Œå¿…é¡»æ˜¯ 8 ä½æˆ– 32 ä½æµ®ç‚¹æ•°ã€‚\n\n\ntemplateï¼šæ¨¡æ¿å›¾åƒï¼Œå¿…é¡»æ˜¯ç›¸åŒç±»å‹å’Œæ·±åº¦çš„å¤§å°å°äºæˆ–ç­‰äºè¾“å…¥å›¾åƒçš„å›¾åƒã€‚\n\n\nresultï¼šåŒ¹é…ç»“æœå›¾åƒï¼Œæ˜¯ä¸€ä¸ªå•é€šé“ 32 ä½æµ®ç‚¹æ•°ã€‚æ¯ä¸ªåƒç´ è¡¨ç¤ºè¯¥åŒºåŸŸä¸æ¨¡æ¿çš„åŒ¹é…ç¨‹åº¦ã€‚\n\n\nmethodæŒ‡å®šçš„åŒ¹é…æ–¹æ³•ï¼Œå¯ä»¥æ˜¯ä»¥ä¸‹ä¹‹ä¸€ï¼š\n\nTM_SQDIFFï¼šå¹³æ–¹å·®åŒ¹é…æ³•ï¼Œè®¡ç®—æ¨¡æ¿ä¸å›¾åƒä¹‹é—´çš„å¹³æ–¹å·®ï¼Œå€¼è¶Šå°è¡¨ç¤ºåŒ¹é…åº¦è¶Šé«˜ã€‚\nTM_SQDIFF_NORMEDï¼šå½’ä¸€åŒ–å¹³æ–¹å·®åŒ¹é…æ³•ï¼Œè®¡ç®—å½’ä¸€åŒ–çš„å¹³æ–¹å·®ï¼Œå€¼è¶Šå°è¡¨ç¤ºåŒ¹é…åº¦è¶Šé«˜ã€‚\nTM_CCORRï¼šç›¸å…³æ€§åŒ¹é…æ³•ï¼Œè®¡ç®—æ¨¡æ¿ä¸å›¾åƒä¹‹é—´çš„ç›¸å…³æ€§ï¼Œå€¼è¶Šå¤§è¡¨ç¤ºåŒ¹é…åº¦è¶Šé«˜ã€‚\nTM_CCORR_NORMEDï¼šå½’ä¸€åŒ–ç›¸å…³æ€§åŒ¹é…æ³•ï¼Œè®¡ç®—å½’ä¸€åŒ–çš„ç›¸å…³æ€§ï¼Œå€¼è¶Šå¤§è¡¨ç¤ºåŒ¹é…åº¦è¶Šé«˜ã€‚\nTM_CCOEFFï¼šç›¸å…³ç³»æ•°åŒ¹é…æ³•ï¼Œè®¡ç®—æ¨¡æ¿ä¸å›¾åƒä¹‹é—´çš„ç›¸å…³ç³»æ•°ï¼Œå€¼è¶Šå¤§è¡¨ç¤ºåŒ¹é…åº¦è¶Šé«˜ã€‚\nTM_CCOEFF_NORMEDï¼šå½’ä¸€åŒ–ç›¸å…³ç³»æ•°åŒ¹é…æ³•ï¼Œè®¡ç®—å½’ä¸€åŒ–çš„ç›¸å…³ç³»æ•°ï¼Œå€¼è¶Šå¤§è¡¨ç¤ºåŒ¹é…åº¦è¶Šé«˜ã€‚\n\n\n\nvoid minMaxLoc(InputArray src, double minVal, double maxVal = 0, Point* minLoc = 0, Point* maxLoc = 0, InputArray mask = noArray());**\n\nç”¨äºåœ¨ç»™å®šçš„çŸ©é˜µä¸­æ‰¾åˆ°æœ€å°å€¼å’Œæœ€å¤§å€¼ï¼Œå¹¶è¿”å›å®ƒä»¬çš„ä½ç½®ã€‚è¿™ä¸ªå‡½æ•°åœ¨å›¾åƒå¤„ç†ä¸­éå¸¸æœ‰ç”¨ï¼Œå°¤å…¶æ˜¯åœ¨éœ€è¦æ‰¾åˆ°å›¾åƒä¸­çš„æœ€äº®æˆ–æœ€æš—ç‚¹ã€æˆ–è€…åœ¨æ¨¡æ¿åŒ¹é…ä¸­æ‰¾åˆ°æœ€ä½³åŒ¹é…ä½ç½®æ—¶\n\n\n\nsrcï¼šè¾“å…¥çš„å•é€šé“æ•°ç»„ã€‚\n\n\nminValï¼šè¿”å›æœ€å°å€¼çš„æŒ‡é’ˆï¼ˆå¦‚æœä¸éœ€è¦ï¼Œåˆ™å¯ä»¥è®¾ç½®ä¸º NULLï¼‰ã€‚\n\n\nmaxValï¼šè¿”å›æœ€å¤§å€¼çš„æŒ‡é’ˆï¼ˆå¦‚æœä¸éœ€è¦ï¼Œåˆ™å¯ä»¥è®¾ç½®ä¸º NULLï¼‰ã€‚\n\n\nminLocï¼šè¿”å›æœ€å°å€¼ä½ç½®çš„æŒ‡é’ˆï¼ˆå¦‚æœä¸éœ€è¦ï¼Œåˆ™å¯ä»¥è®¾ç½®ä¸º NULLï¼‰ã€‚\n\n\nmaxLocï¼šè¿”å›æœ€å¤§å€¼ä½ç½®çš„æŒ‡é’ˆï¼ˆå¦‚æœä¸éœ€è¦ï¼Œåˆ™å¯ä»¥è®¾ç½®ä¸º NULLï¼‰ã€‚\n\n\nmaskï¼šç”¨äºé€‰æ‹©æ•°ç»„å…ƒç´ çš„æ„Ÿå…´è¶£åŒºåŸŸï¼Œå¦‚æœä¸éœ€è¦ï¼Œåˆ™ä½¿ç”¨ noArray()ã€‚\n\n\nvoid resize(InputArray src, OutputArray dst, Size dsize, double fx=0, double fy=0, int interpolation=INTER_LINEAR);\n\nç¼©æ”¾å›¾ç‰‡\n\n\n\nsrcï¼šè¾“å…¥å›¾åƒï¼Œå¯ä»¥æ˜¯ä»»æ„é€šé“æ•°çš„ Mat å¯¹è±¡ã€‚\n\n\ndstï¼šè¾“å‡ºå›¾åƒï¼Œå¤§å°ä¸º dsizeï¼Œæˆ–è€…ä¸ src ç›¸åŒç±»å‹å’Œå¤§å°çš„ Mat å¯¹è±¡ã€‚\n\n\ndsizeï¼šè¾“å‡ºå›¾åƒçš„å¤§å°ã€‚å¦‚æœè¿™ä¸ªå‚æ•°ä¸º 0ï¼Œåˆ™å®ƒç”± fx å’Œ fy å‚æ•°å†³å®šã€‚\n\n\nfxï¼šæ°´å¹³æ–¹å‘çš„ç¼©æ”¾æ¯”ä¾‹ã€‚å¦‚æœè¿™ä¸ªå‚æ•°ä¸º 0ï¼Œåˆ™å®ƒç”± dsize å‚æ•°å†³å®šã€‚\n\n\nfyï¼šå‚ç›´æ–¹å‘çš„ç¼©æ”¾æ¯”ä¾‹ã€‚å¦‚æœè¿™ä¸ªå‚æ•°ä¸º 0ï¼Œåˆ™å®ƒç”± dsize å‚æ•°å†³å®šã€‚\n\n\ninterpolationæ’å€¼æ–¹æ³•ï¼Œç”¨äºåœ¨ç¼©æ”¾æ—¶è®¡ç®—æ–°åƒç´ å€¼ã€‚å¯é€‰çš„æ’å€¼æ–¹æ³•åŒ…æ‹¬ï¼š\n\nINTER_NEARESTï¼šæœ€è¿‘é‚»æ’å€¼ã€‚\nINTER_LINEARï¼šåŒçº¿æ€§æ’å€¼ï¼ˆé»˜è®¤å€¼ï¼‰ã€‚\nINTER_AREAï¼šä½¿ç”¨åƒç´ åŒºåŸŸå…³ç³»é‡é‡‡æ ·ã€‚å½“å›¾åƒç¼©å°æ—¶ï¼Œè¿™ç§æ–¹æ³•å¯ä»¥é¿å…æ³¢çº¹å‡ºç°ï¼Œé€šå¸¸ç”¨äºå›¾åƒç¼©æ”¾ã€‚\nINTER_CUBICï¼šä¸‰æ¬¡æ ·æ¡æ’å€¼ã€‚\nINTER_LANCZOS4ï¼šLanczos æ’å€¼ï¼Œè¶…è¿‡ 8x8 åƒç´ é‚»åŸŸçš„é‡‡æ ·ã€‚\n\n\n\nif (ID_number.size() != 18) return false;for (int i = 0; i &lt; 18; i++)&#123;\tMat roi = ID_number[i].mat;\tresize(roi, roi, Size(30, 40), 0, 0, INTER_AREA);\tMat gray_image;\tcvtColor(roi, gray_image, cv::COLOR_BGR2GRAY);\tMat binary_image;\tthreshold (gray_image, binary_image, 0, 255, THRESH_BINARY_INV | THRESH_OTSU);\tint maxIndex = 0;\tdouble Max = 0.0;\tfor (int j = 0; j &lt; 11; j++)\t&#123;\t\tMat template_num = templates_cards[j].mat;\t\tresize(template_num, template_num, Size(30, 40), 0, 0, INTER_AREA);\t\tMat gray_template_num;\t\tcvtColor(template_num, gray_template_num, cv::COLOR_BGR2GRAY);\t\tMat binary_template_num;\t\tthreshold(gray_template_num, binary_template_num, 0, 255, THRESH_BINARY_INV | THRESH_OTSU);\t\tMat result;\t\tmatchTemplate(binary_image, binary_template_num, result, TM_CCOEFF_NORMED);\t\tdouble minVal, maxVal;\t\tPoint minLoc, maxLoc;\t\tminMaxLoc(result, &amp;minVal, &amp;maxVal, &amp;minLoc, &amp;maxLoc);\t\tif (maxVal &gt; Max)\t\t&#123;\t\t\tMax = maxVal;\t\t\tmaxIndex = j;\t\t&#125;\t&#125;\tresult[i] = maxIndex;&#125;\n","categories":["ç¼–ç¨‹"],"tags":["C++","Qt","OpenCV"]},{"title":"ASP.NET Core(ä¸€)","url":"/2024/08/08/web/ASP-NET-Core-%E4%B8%80/","content":"\nASP.NET Coreæ¡†æ¶ä¸­ ä¾èµ–æ³¨å…¥ LINQè¯­å¥ é…ç½®ç³»ç»Ÿ æ—¥å¿—\n\n\nASP.NET core\nå¼‚æ­¥\n\n\nTask\n\n\nasync\n\n\nawait\n\n\nå§”æ‰˜\n\n\nå…³é”®å­— delegate\n\n\næŒ‡å‘æ–¹æ³•çš„ç±»å‹\n\n\n.NETä¸­å†…ç½®äº†ä¸¤ä¸ªæ³›å‹å§”æ‰˜ Action(æ— è¿”å›å€¼) å’Œ Func(æœ‰è¿”å›å€¼)\n\n\n//æ— è¿”å›å€¼namespace ConsoleApp1;class MainClass&#123;    public static void Main(string[] args)    &#123;        Action a1 = F1;        a1();        Action&lt;int&gt; a_int = F_int;        a_int(520);            &#125;    static void F1()     &#123;        Console.WriteLine(&quot;hello world!&quot;);    &#125;    static void F_int(int a)    &#123;        Console.WriteLine(a);    &#125;&#125;//æœ‰è¿”å›å€¼,ä¸ä¸Šè¿°ç±»ä¼¼,ä½†æ˜¯Funcçš„å‚æ•°åˆ—è¡¨ä¸­æœ€åä¸€ä¸ªè®°å½•çš„æ˜¯è¿”å›å€¼Func&lt;int&gt; F1 = function;F1();int function()&#123;    return 520;&#125;\nLambda è¡¨è¾¾å¼\nnamespace ConsoleApp1;class MainClass&#123;    public static void Main(string[] args)    &#123;        Action&lt;int, int&gt; a1 = (int i, int j) =&gt; &#123; Console.WriteLine(&quot;hello world!&quot;); &#125;;        a1(1, 2);    &#125;&#125;\nyeild\nyieldå…³é”®å­—ç”¨äºç®€åŒ–å®ç°è¿­ä»£å™¨çš„æ–¹æ³•ã€‚è¿­ä»£å™¨æ˜¯ä¸€ç§ç‰¹æ®Šçš„æ–¹æ³•ï¼Œå®ƒå¯ä»¥é€æ­¥è¿”å›é›†åˆä¸­çš„å…ƒç´ ï¼Œè€Œä¸æ˜¯ä¸€æ¬¡æ€§è¿”å›æ•´ä¸ªé›†åˆã€‚ä½¿ç”¨yieldå¯ä»¥è®©æ–¹æ³•åœ¨æ¯æ¬¡è°ƒç”¨æ—¶è¿”å›ä¸€ä¸ªå…ƒç´ ï¼Œå¹¶åœ¨éœ€è¦æ—¶ä¿æŒå…¶å½“å‰çŠ¶æ€ï¼Œä»¥ä¾¿ä¸‹æ¬¡è°ƒç”¨æ—¶ç»§ç»­æ‰§è¡Œã€‚\nLINQ\n\nå‡ ä¹é‡Œé¢çš„æ‰€æœ‰çš„æ‰©å±•æ–¹æ³•éƒ½æ˜¯é’ˆå¯¹ IEnumerableæ¥å£çš„\næ‰€æœ‰èƒ½è¿”å›é›†åˆçš„éƒ½æ˜¯è¿”å›IEnumerable\nå¤„äºSystem.Linqå‘½åç©ºé—´ä¸­\n\nå¸¸ç”¨æ–¹æ³•\n\n\nWhere()  ç­›é€‰å‡ºç¬¦åˆæ¡ä»¶çš„æ•°æ®\n\n\nSingle()  æœ‰ä¸”åªæœ‰ä¸€æ¡æ•°æ®æ—¶è¿”å›\n\n\nSingleOrDefault()\n\n\nFirst():è‡³å°‘æœ‰ä¸€æ¡æ—¶è¿”å›ç¬¬ä¸€æ¡\n\n\nFirstOrDefault()\n\n\nOrder()  æ­£åºæ’åº\n\n\nOrderByDescending() å€’åºæ’åº\n\n\nOrderBy() æŒ‰ç…§è‡ªå®šä¹‰è¦æ±‚æ’åº\n\n\nThenBy()\n\n\nSkip() Take()\n\n\nèšåˆå‡½æ•°\n\n\nMax() Min() Average() Sum() Count()\n\n\nåˆ†ç»„å‡½æ•°\n\n\nGroupBy() æ ¹æ®é€‰æ‹©çš„å±æ€§è¿›è¡Œåˆ†ç»„\n\n\nè¿”å›å€¼IEnumerable&lt;IGrouping&lt;T,Y&gt;&gt;\næŠ•å½±\næŒ‰ç…§æŸç§è§„åˆ™å°†ä¸€ç»„æ•°æ®æ˜ å°„ä¸ºå¦ä¸€ç»„æ•°æ®\n\n\nSelect\n\n\né›†åˆè½¬æ¢\n\n\nToList()\n\n\nToArray()\n\n\næ§åˆ¶åè½¬\n1.æœåŠ¡å®šä½å™¨(ServiceLocator)\nusing Microsoft.Extensions.DependencyInjection;namespace ConsoleApp1;class MainClass&#123;    public interface ITestService    &#123;        public string? Name &#123; get; set; &#125;        public void SayHi();    &#125;    public class TestServiceImpl : ITestService    &#123;        public string? Name &#123; get; set; &#125;        public void SayHi()         &#123;            Console.WriteLine($&quot;Hi!My name is &#123;Name&#125;&quot;);        &#125;    &#125;    public static void Main(string[] args)    &#123;        ServiceCollection services = new ServiceCollection();//åˆ›å»ºæœåŠ¡å®¹å™¨        services.AddTransient&lt;TestServiceImpl&gt;();//æ³¨å†ŒæœåŠ¡        using (ServiceProvider sp = services.BuildServiceProvider())//åˆ›å»ºæœåŠ¡å®šä½å™¨        &#123;//ä½¿ç”¨äº†æœåŠ¡å®šä½å™¨ è·å–å­˜æ”¾åœ¨å®¹å™¨ä¸­æ‰€éœ€è¦çš„æœåŠ¡            TestServiceImpl t = sp.GetService&lt;TestServiceImpl&gt;();            t.Name = &quot;WangMC&quot;;            t.SayHi();        &#125;    &#125;   &#125;\n2.ä¾èµ–æ³¨å…¥(Dependency Injection)\n\n.NETæ§åˆ¶åè½¬ç»„ä»¶å–åä¸ºDependencyInjection,ä½†å…¶ä¸­åŒ…å«æœåŠ¡å®šä½å™¨\nä½¿ç”¨å‰è¦å®‰è£…Microsoft.Extensions.DependencyInjection\n\n\n\næœåŠ¡(service):è¦ä½¿ç”¨çš„å¯¹è±¡\n\n\næ³¨å†ŒæœåŠ¡\n\n\næœåŠ¡å®¹å™¨:å­˜æ”¾å’Œç®¡ç†æ³¨å†Œå¥½çš„æœåŠ¡\n\n\næŸ¥è¯¢æœåŠ¡:åˆ›å»ºå¯¹è±¡åŠå…³è”å¯¹è±¡\n\n\nå¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸ:Transient(ç¬æ€) Scoped(èŒƒå›´) Singleton(å•ä¾‹)\n\n\nusing Microsoft.Extensions.DependencyInjection;namespace ConsoleApp1;//æ§åˆ¶å™¨å‘å‡ºæµ‹è¯•è¯·æ±‚,å¼€å§‹è°ƒç”¨æ—¥å¿—å•å…ƒå’Œå­˜å‚¨å•å…ƒ//å­˜å‚¨å•å…ƒéœ€è¦è°ƒç”¨é…ç½®ä¿¡æ¯è¿æ¥å­˜å‚¨è®¾å¤‡,æœ€åå°†æµ‹è¯•çš„ä¿¡æ¯å­˜å‚¨åˆ°è®¾å¤‡ä¸­class MainClass&#123;    public static void Main(string[] args)    &#123;        var service = new ServiceCollection();        service.AddScoped&lt;Controller&gt;();        service.AddScoped&lt;IStorage,StorageImp1&gt;();        service.AddScoped&lt;ILog,LogImp1&gt;();        service.AddScoped&lt;IConfig,ConfigImp1&gt;();        using (var sp = service.BuildServiceProvider())        &#123;            var controller = sp.GetService&lt;Controller&gt;();            controller.Test();        &#125;    &#125;        class Controller    &#123;        private readonly ILog log;        private readonly IStorage storage;        public Controller(ILog log, IStorage storage)        &#123;            this.storage = storage;            this.log = log;        &#125;        public void Test()        &#123;            this.log.Log(&quot;å¼€å§‹ä¸Šä¼ &quot;);            this.storage.Save(&quot;ä¾èµ–æ³¨å…¥æµ‹è¯•&quot;, &quot;1.txt&quot;);            this.log.Log(&quot;ä¸Šä¼ å®Œæ¯•&quot;);        &#125;    &#125;    interface ILog    &#123;        public void Log(string msg);    &#125;    class LogImp1 : ILog    &#123;        public void Log(string msg)        &#123;            Console.WriteLine($&quot;æ—¥å¿—&#123;msg&#125;&quot;);        &#125;    &#125;    interface IConfig    &#123;        public string GetValue(string name);    &#125;    class ConfigImp1 : IConfig    &#123;        public string GetValue(string name)        &#123;            return &quot;\\&quot;hello_world\\&quot;&quot;;        &#125;    &#125;    interface IStorage    &#123;        public void Save(string content, string name);    &#125;    class StorageImp1 : IStorage    &#123;        private readonly IConfig config;        public StorageImp1(IConfig config)        &#123;            this.config = config;        &#125;        public void Save(string content, string name)        &#123;            string service = config.GetValue(&quot;service&quot;);            Console.WriteLine($&quot;å‘æœåŠ¡å™¨&#123;service&#125;ä¸Šä¼ æ–‡ä»¶åä¸º&#123;name&#125;,å…¶å†…å®¹ä¸º&#123;content&#125;&quot;);        &#125;    &#125;&#125;\né…ç½®ç³»ç»Ÿ\né…ç½®è¯»å–é¡ºåº\né…ç½®ä¸­å¿ƒæœåŠ¡å™¨----&gt;æœ¬åœ°ç¯å¢ƒå˜é‡------&gt;æœ¬åœ°é…ç½®æ–‡ä»¶  (åè€…å¯å°†å‰è€…è¦†ç›–)\nJsonæ–‡ä»¶é…ç½®\n&#123;  &quot;name&quot;: &quot;WangMC&quot;,  &quot;age&quot;: &quot;18&quot;,  &quot;hobby&quot;: &#123; &quot;sport&quot;: &quot;swimming&quot;, &quot;music&quot;: &quot;rock&quot; &#125;&#125;\nå±æ€§è®¾ç½®ä¸º å¦‚æœè¾ƒæ–°åˆ™å¤åˆ¶\næ³•ä¸€: NuGetå®‰è£…Microsoft.Extensions.Configurationå’ŒMicrosoft.Extensions.Configuration.JsonåŒ…\nusing Microsoft.Extensions.Configuration;using Microsoft.Extensions.DependencyInjection;using System.Threading.Channels;namespace ConsoleApp1;class MainClass&#123;    public static void Main(string[] args)    &#123;        var configBuilder = new ConfigurationBuilder();        configBuilder.AddJsonFile(&quot;config.json&quot;, optional: true, reloadOnChange: true);        var configRoot = configBuilder.Build();        string name = configRoot[&quot;name&quot;];        string hobby_sport = configRoot.GetSection(&quot;hobby&quot;)[&quot;sport&quot;];                Console.WriteLine($&quot;Name: &#123;name&#125;, Age: &#123;age&#125;, Hobby_sport: &#123;hobby_sport&#125;&quot;);    &#125;&#125;\næ³•äºŒ: ç»‘å®šä¸€ä¸ªç±» æ¥è¿›è¡Œé…ç½®çš„è¯»å–\nNuGetå®‰è£…Microsoft.Extensions.Configuration.Binder\nusing Microsoft.Extensions.Configuration; using Microsoft.Extensions.DependencyInjection;using System.Threading.Channels;namespace ConsoleApp1;class MainClass&#123;    public static void Main(string[] args)    &#123;        var configBuilder = new ConfigurationBuilder();        configBuilder.AddJsonFile(&quot;config.json&quot;, optional: true, reloadOnChange: true);        var configRoot = configBuilder.Build();        var config = configRoot.Get&lt;Config&gt;();        string name = config.name;        int age = config.age;        Hobby hobby = config.hobby;        string sprot = config.hobby.sport;    &#125;    class Config    &#123;        public string name &#123; get; set; &#125;        public int age &#123; get; set; &#125;        public Hobby hobby &#123; get; set; &#125;    &#125;    class Hobby    &#123;        public string sport &#123; get; set; &#125;        public string music &#123; get; set; &#125;    &#125;&#125;\né€‰é¡¹æ–¹å¼è¯»å–\n\n\nNuGetå®‰è£…Microsoft.Extensions.Configuration  Microsoft.Extensions.Configuration.JsonåŒ…\n\n\nMicrosoft.Extensions.Configuration.Options  Microsoft.Extensions.Configuration.Binder\n\n\nè¯»å–é…ç½®æ—¶, DIè¦å£°æ˜IOptions IOptionsMonitor IOptionsSnapshotç­‰ç±»å‹\n\n\n\n\nIOptionsä¸ä¼šè¯»å–åˆ°æ–°çš„å€¼\n\n\n==IOptionsSnapshot==ä¸IOptionsMonitor ç›¸æ¯”,IOptionsSnapshotè¯»å–åˆ°çš„å€¼ä¼šåœ¨åŒä¸€ä¸ªèŒƒå›´ä¸­ä¿æŒä¸€è‡´\n\n\nusing Microsoft.Extensions.Configuration; using Microsoft.Extensions.DependencyInjection;using Microsoft.Extensions.Options;namespace ConsoleApp1;class MainClass&#123;    public static void Main(string[] args)    &#123;        var services = new ServiceCollection();        services.AddScoped&lt;TestController&gt;();        var configBuild = new ConfigurationBuilder();        configBuild.AddJsonFile(&quot;config.json&quot;,optional:true,reloadOnChange:true);        var configRoot = configBuild.Build();        services.AddOptions().Configure&lt;Config&gt;(e =&gt; configRoot.Bind(e));        using (var sp = services.BuildServiceProvider())        &#123;            int i = 4;            while (i!=0)            &#123;                var info = sp.GetRequiredService&lt;TestController&gt;();                info.Test();                i--;            &#125;        &#125;            &#125;    class TestController     &#123;        private readonly IOptionsSnapshot&lt;Config&gt; optConfig;        public TestController(IOptionsSnapshot&lt;Config&gt; optConfig)        &#123;            this.optConfig=optConfig;        &#125;        public void Test()        &#123;            Console.WriteLine($&quot;å§“å:&#123;optConfig.Value.name&#125;&quot;);            Console.WriteLine($&quot;å¹´é¾„:&#123;optConfig.Value.age&#125;&quot;);            Console.WriteLine($&quot;å…´è¶£çˆ±å¥½:&#123;optConfig.Value.hobby.sport&#125;&quot;);            Console.WriteLine($&quot;å…´è¶£çˆ±å¥½:&#123;optConfig.Value.hobby.music&#125;&quot;);        &#125;    &#125;    class Config    &#123;        public string name &#123; get; set; &#125;        public int age &#123; get; set; &#125;        public Hobby hobby &#123; get; set; &#125;    &#125;    class Hobby    &#123;        public string sport &#123; get; set; &#125;        public string music &#123; get; set; &#125;    &#125;&#125;\næ—¥å¿—\n\nçº§åˆ«: Trace&lt;Debug&lt;Information&lt;Warning&lt;Error&lt;Critical\n\n1. è¾“å‡ºåˆ°æ§åˆ¶å°\n\nå®‰è£…Microsoft.Extensions.Logging  Microsoft.Extensions.Logging.Console\n\nusing Microsoft.Extensions.DependencyInjection;using Microsoft.Extensions.Logging;using Microsoft.Extensions.Logging.Consolenamespace ConsoleApp1;class MainClass&#123;    public static void Main(string[] args)    &#123;        var services = new ServiceCollection();        services.AddLogging(logBuilder =&gt; &#123;             logBuilder.AddConsole();            logBuilder.SetMinimumLevel(LogLevel.Trace);        &#125;);        services.AddScoped&lt;Demo&gt;();        using (var sp = services.BuildServiceProvider())        &#123;            var demo = sp.GetRequiredService&lt;Demo&gt;();            demo.Test();        &#125;    &#125;    class Demo     &#123;        private readonly ILogger&lt;Demo&gt; logger;        public Demo(ILogger&lt;Demo&gt; logger)        &#123;            this.logger = logger;        &#125;        public void Test()        &#123;            logger.LogWarning(&quot;this is a warning&quot;);            logger.LogError(&quot;this is a Error&quot;);            try            &#123;                File.ReadAllText(&quot;A fake document&quot;);                logger.LogDebug(&quot;Read Success!!&quot;);            &#125;            catch(Exception ex)            &#123;                logger.LogDebug(ex,&quot;Read Failed!!&quot;);            &#125;        &#125;    &#125; &#125;\n2. æ–‡æœ¬æ—¥å¿—\n\nä½¿ç”¨NLogåŒ…\n\næ—¥å¿—è¿‡æ»¤å’Œåˆ†ç±»\n&lt;target xsi:type=&quot;File&quot; name=&quot;logfile&quot; fileName=&quot;c:\\temp\\console-example.log&quot;        archiveAboveSize=&quot;10000&quot; maxArchiveFiles=&quot;3&quot; maxArchiveDays=&quot;30&quot;            layout=&quot;$&#123;longdate&#125;|$&#123;level&#125;|$&#123;message&#125; |$&#123;all-event-properties&#125; $&#123;exception:format=tostring&#125;&quot; /&gt;\n\n\nxsi:type=&quot;File&quot;ï¼šæŒ‡å®šäº†ç›®æ ‡çš„ç±»å‹ä¸ºFileï¼Œè¿™æ„å‘³ç€æ—¥å¿—æ¶ˆæ¯å°†è¢«å†™å…¥åˆ°æ–‡ä»¶ä¸­ã€‚\n\n\nname=&quot;logfile&quot;ï¼šä¸ºç›®æ ‡å‘½åï¼Œè¿™ä¸ªåå­—åœ¨æ•´ä¸ªNLogé…ç½®ä¸­å¿…é¡»æ˜¯å”¯ä¸€çš„ï¼Œå¹¶ä¸”å¯ä»¥åœ¨æ—¥å¿—è§„åˆ™ä¸­å¼•ç”¨ã€‚\n\n\nfileName=&quot;c:\\temp\\console-example.log&quot;ï¼šæŒ‡å®šäº†æ—¥å¿—æ–‡ä»¶çš„å®Œæ•´è·¯å¾„ã€‚æ—¥å¿—æ¶ˆæ¯å°†è¢«å†™å…¥åˆ°è¿™ä¸ªæ–‡ä»¶ä¸­ã€‚\n\n\narchiveAboveSize=&quot;10000&quot;ï¼šè¿™æ˜¯ä¸€ä¸ªå¯é€‰å‚æ•°ï¼Œç”¨äºæŒ‡å®šæ—¥å¿—æ–‡ä»¶çš„å¤§å°é˜ˆå€¼ã€‚å½“æ—¥å¿—æ–‡ä»¶è¾¾åˆ°æˆ–è¶…è¿‡è¿™ä¸ªå¤§å°æ—¶ï¼ŒNLogä¼šå°†å½“å‰æ—¥å¿—æ–‡ä»¶å½’æ¡£ï¼Œå¹¶åˆ›å»ºä¸€ä¸ªæ–°çš„æ—¥å¿—æ–‡ä»¶ç»§ç»­è®°å½•ã€‚å•ä½æ˜¯å­—èŠ‚ï¼Œè¿™é‡Œè®¾ç½®ä¸º10000å­—èŠ‚ï¼ˆå¤§çº¦10KBï¼‰ã€‚\n\n\nmaxArchiveFiles=&quot;3&quot;ï¼šè¿™æ˜¯ä¸€ä¸ªå¯é€‰å‚æ•°ï¼Œç”¨äºæŒ‡å®šæœ€å¤§å½’æ¡£æ–‡ä»¶çš„æ•°é‡ã€‚å½“è¾¾åˆ°è¿™ä¸ªæ•°é‡æ—¶ï¼ŒNLogå°†å¼€å§‹åˆ é™¤æœ€æ—§çš„å½’æ¡£æ–‡ä»¶ï¼Œä»¥ä¾¿ä¸ºæ–°å½’æ¡£æ–‡ä»¶è…¾å‡ºç©ºé—´ã€‚è¿™é‡Œè®¾ç½®ä¸º3ï¼Œæ„å‘³ç€æœ€å¤šä¿ç•™3ä¸ªå½’æ¡£æ–‡ä»¶ã€‚\n\n\nmaxArchiveDays=&quot;30&quot;ï¼šå…¶ä¸­ X æ˜¯ä¸€ä¸ªæ•´æ•°ï¼Œè¡¨ç¤ºå½’æ¡£æ–‡ä»¶å°†è¢«ä¿ç•™çš„å¤©æ•°ã€‚å½“å½’æ¡£æ–‡ä»¶åˆ›å»ºåç»è¿‡ X å¤©ï¼ŒNLog å°†è‡ªåŠ¨åˆ é™¤è¿™äº›å½’æ¡£æ–‡ä»¶\n\n\nlayout=&quot;${longdate}|${level}|${message} |${all-event-properties} ${exception:format=tostring}&quot;ï¼šå®šä¹‰äº†æ—¥å¿—æ¶ˆæ¯çš„å¸ƒå±€ï¼ˆlayoutï¼‰ã€‚å¸ƒå±€æ˜¯ä¸€ä¸ªæ¨¡æ¿ï¼Œå®ƒæŒ‡å®šäº†æ—¥å¿—æ¶ˆæ¯çš„æ ¼å¼ã€‚ä»¥ä¸‹æ˜¯å¸ƒå±€ä¸­å„ä¸ªå…ƒç´ çš„å«ä¹‰ï¼š\n\n${longdate}ï¼šæ’å…¥æ—¥å¿—äº‹ä»¶çš„æ—¶é—´æˆ³ã€‚\n${level}ï¼šæ’å…¥æ—¥å¿—äº‹ä»¶çš„çº§åˆ«ï¼ˆä¾‹å¦‚ï¼šInfoã€Debugã€Errorç­‰ï¼‰ã€‚\n${message}ï¼šæ’å…¥æ—¥å¿—äº‹ä»¶çš„æ–‡æœ¬æ¶ˆæ¯ã€‚\n${all-event-properties}ï¼šæ’å…¥æ‰€æœ‰äº‹ä»¶å±æ€§çš„å†…å®¹ã€‚\n${exception:format=tostring}ï¼šå¦‚æœæ—¥å¿—äº‹ä»¶ä¸­åŒ…å«å¼‚å¸¸ä¿¡æ¯ï¼Œåˆ™å°†å…¶è½¬æ¢ä¸ºå­—ç¬¦ä¸²å¹¶æ’å…¥åˆ°æ—¥å¿—æ¶ˆæ¯ä¸­ã€‚\n\n\n\n3.ç»“æ„åŒ–æ—¥å¿—\n\nä½¿ç”¨SerilogåŒ… å®‰è£…Serilog.AspNetCoreåŒ…\n\nusing Microsoft.Extensions.DependencyInjection;using Microsoft.Extensions.Logging;using Serilog;using Serilog.Formatting.Json;namespace ConsoleApp1;class MainClass&#123;    public static void Main(string[] args)    &#123;        IServiceCollection services = new ServiceCollection();        services.AddLogging(logBuilder =&gt;        &#123;            Log.Logger = new LoggerConfiguration().                             MinimumLevel.Debug().                             Enrich.FromLogContext().                             WriteTo.Console(new JsonFormatter()).                             CreateLogger();        services.AddSerilog();        &#125;);        //services.AddSerilog();        services.AddScoped&lt;Demo&gt;();        services.AddScoped&lt;Demo1&gt;();        using (var sp = services.BuildServiceProvider())        &#123;            var demo = sp.GetRequiredService&lt;Demo&gt;();            var demo1 = sp.GetRequiredService&lt;Demo1&gt;();            demo1.Test();            demo.Test();        &#125;    &#125;    class Demo    &#123;        private readonly ILogger&lt;Demo&gt; logger;        public Demo(ILogger&lt;Demo&gt; logger)        &#123;            this.logger = logger;        &#125;        public void Test()        &#123;            logger.LogWarning(&quot;this is a warning&quot;);            logger.LogError(&quot;this is a Error&quot;);            logger.LogDebug(&quot;this is a debug&quot;);            var Information = new &#123; name = &quot;WangMC&quot;, Age = 18 &#125;;            string Hobby = &quot;running&quot;;            logger.LogDebug(&quot;Hello this is my informaiton &#123;@Information&#125;,my hobby is &#123;Hobby&#125;&quot;, Information, Hobby);        &#125;    &#125;    class Demo1    &#123;        private readonly ILogger&lt;Demo1&gt; logger;        public Demo1(ILogger&lt;Demo1&gt; logger)        &#123;            this.logger = logger;        &#125;        public void Test()        &#123;            logger.LogWarning(&quot;è¿™æ˜¯ä¸€ä¸ªè­¦å‘Š&quot;);            logger.LogError(&quot;è¿™æ˜¯ä¸€ä¸ªé”™è¯¯&quot;);            logger.LogDebug(&quot;è¿™æ˜¯ä¸€ä¸ªdebug&quot;);        &#125;    &#125;&#125;\n4.é›†ä¸­åŒ–æ—¥å¿—\n\né€‚åˆé›†ç¾¤åŒ–éƒ¨ç½² æœ‰Nå¤šæœåŠ¡å™¨\nExceptionless æä¾›äº†ç°æˆçš„äº‘æœåŠ¡ ä¹Ÿå¯ä»¥æœ¬åœ°éƒ¨ç½²(self hosting)\n\n","categories":["ç¼–ç¨‹"],"tags":["C#"]},{"title":"AxiosæŒ‡åŒ—","url":"/2025/10/16/web/Axios%20%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/","content":"\nå¦‚é¢˜ï¼Œç»“åˆå®˜æ–¹æ–‡æ¡£ä¸ç½‘ç»œå¸–å­ï¼Œåˆ©ç”¨AIæ•´ç†\n\n\nAxios ä½¿ç”¨æŒ‡å—\nDate: October 16, 2025\nCode: https://github.com/axios/axios\n\nç›®å½•\n\n\nå¼•è¨€\n\n\nAxios åŸºç¡€ä»‹ç»\n\n\nå®‰è£…ä¸ç¯å¢ƒé…ç½®\n\n\nåŸºç¡€ä½¿ç”¨æ–¹æ³•\n\n\nä¸€èˆ¬åœºæ™¯åº”ç”¨\n\n\nVue é¡¹ç›®ä¸­çš„ä½¿ç”¨\n\n\nAxios å°è£…æœ€ä½³å®è·µ\n\n\nç½‘ç»œçŸ¥è¯†ç§‘æ™®\n\n\nå®‰å…¨æ€§è€ƒè™‘\n\n\næ€§èƒ½ä¼˜åŒ–\n\n\nå¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ\n\n\næ€»ç»“\n\n\n\nå¼•è¨€\nåœ¨ç°ä»£å‰ç«¯å¼€å‘ä¸­ï¼Œä¸åç«¯æœåŠ¡å™¨è¿›è¡Œæ•°æ®äº¤äº’æ˜¯ä¸å¯æˆ–ç¼ºçš„ç¯èŠ‚ã€‚Axios ä½œä¸ºä¸€æ¬¾åŸºäº Promise çš„ HTTP å®¢æˆ·ç«¯ï¼Œå·²ç»æˆä¸ºä¼—å¤šå¼€å‘è€…çš„é¦–é€‰å·¥å…·ã€‚æœ¬æŒ‡å—å°†ä»åŸºç¡€æ¦‚å¿µåˆ°é«˜çº§åº”ç”¨ï¼Œå…¨é¢ä»‹ç» Axios çš„ä½¿ç”¨æ–¹æ³•ï¼Œå¸®åŠ©å¼€å‘è€…æ„å»ºæ›´åŠ å¥å£®å’Œé«˜æ•ˆçš„ç½‘ç»œè¯·æ±‚ç³»ç»Ÿã€‚\n\nAxios åŸºç¡€ä»‹ç»\nä»€ä¹ˆæ˜¯ Axios\nAxios æ˜¯ä¸€ä¸ªåŸºäº Promise çš„ HTTP åº“ï¼Œå¯ä»¥ç”¨åœ¨æµè§ˆå™¨å’Œ Node.js ä¸­ã€‚å®ƒæœ¬è´¨ä¸Šæ˜¯å¯¹åŸç”Ÿ XMLHttpRequest çš„å°è£…ï¼Œä½†æä¾›äº†æ›´ç®€æ´çš„ API å’Œæ›´å¼ºå¤§çš„åŠŸèƒ½ã€‚\næ ¸å¿ƒç‰¹æ€§\n\n\næ”¯æŒ Promise APIï¼šä½¿ç”¨ç°ä»£åŒ–çš„å¼‚æ­¥ç¼–ç¨‹æ¨¡å¼\n\n\næ‹¦æˆªè¯·æ±‚å’Œå“åº”ï¼šç»Ÿä¸€å¤„ç†è¯·æ±‚å‰å’Œå“åº”åçš„é€»è¾‘\n\n\nè‡ªåŠ¨è½¬æ¢ JSON æ•°æ®ï¼šæ— éœ€æ‰‹åŠ¨å¤„ç†æ•°æ®æ ¼å¼è½¬æ¢\n\n\nå–æ¶ˆè¯·æ±‚ï¼šæ”¯æŒä¸­æ­¢é•¿æ—¶é—´æœªå“åº”çš„è¯·æ±‚\n\n\nå®¢æˆ·ç«¯é˜²å¾¡ XSRFï¼šæä¾›å®‰å…¨é˜²æŠ¤æœºåˆ¶\n\n\nè·¨å¹³å°æ”¯æŒï¼šåŒæ—¶æ”¯æŒæµè§ˆå™¨å’Œ Node.js ç¯å¢ƒ\n\n\nä¸ºä»€ä¹ˆé€‰æ‹© Axios\nç›¸æ¯”åŸç”Ÿ XMLHttpRequest å’Œ fetch APIï¼ŒAxios å…·æœ‰ä»¥ä¸‹ä¼˜åŠ¿ï¼š\n\n\næ›´ç®€æ´çš„ APIï¼šé“¾å¼è°ƒç”¨ï¼Œä»£ç æ›´æ˜“è¯»\n\n\næ›´å¥½çš„é”™è¯¯å¤„ç†ï¼šç»Ÿä¸€çš„é”™è¯¯å¤„ç†æœºåˆ¶\n\n\næ‹¦æˆªå™¨åŠŸèƒ½ï¼šå…¨å±€è¯·æ±‚/å“åº”å¤„ç†\n\n\nå–æ¶ˆè¯·æ±‚ï¼šé¿å…å†…å­˜æ³„æ¼å’Œä¸å¿…è¦çš„ç½‘ç»œè¯·æ±‚\n\n\næµè§ˆå™¨å…¼å®¹æ€§ï¼šæ”¯æŒæ›´å¤šæµè§ˆå™¨ç‰ˆæœ¬\n\n\n\nå®‰è£…ä¸ç¯å¢ƒé…ç½®\nä½¿ç”¨ npm å®‰è£…\nnpm install axios# æˆ–è€…yarn add axios# æˆ–è€…pnpm add axios\nä½¿ç”¨ CDN\n&lt;script src=&quot;https://unpkg.com/axios/dist/axios.min.js&quot;&gt;&lt;/script&gt;\nç¯å¢ƒé…ç½®\nåœ¨é¡¹ç›®ä¸­åˆ›å»ºåŸºç¡€é…ç½®æ–‡ä»¶ï¼š\n// src/utils/axiosConfig.jsimport axios from &#x27;axios&#x27;;// åˆ›å»º axios å®ä¾‹const axiosInstance = axios.create(&#123;  baseURL: process.env.VUE_APP_API_BASE_URL || &#x27;http://localhost:3000/api&#x27;,  timeout: 10000, // è¶…æ—¶æ—¶é—´  headers: &#123;    &#x27;Content-Type&#x27;: &#x27;application/json&#x27;  &#125;&#125;);export default axiosInstance;\n\nåŸºç¡€ä½¿ç”¨æ–¹æ³•\nå‘èµ· GET è¯·æ±‚\nimport axios from &#x27;axios&#x27;;// åŸºç¡€ GET è¯·æ±‚axios.get(&#x27;/users&#x27;)  .then(response =&gt; &#123;    console.log(response.data);  &#125;)  .catch(error =&gt; &#123;    console.error(&#x27;Error:&#x27;, error);  &#125;);// å¸¦å‚æ•°çš„ GET è¯·æ±‚axios.get(&#x27;/users&#x27;, &#123;  params: &#123;    id: 123,    name: &#x27;John&#x27;  &#125;&#125;).then(response =&gt; &#123;  console.log(response.data);&#125;);// ä½¿ç”¨ async/awaitasync function getUser() &#123;  try &#123;    const response = await axios.get(&#x27;/users/123&#x27;);    console.log(response.data);  &#125; catch (error) &#123;    console.error(&#x27;Error:&#x27;, error);  &#125;&#125;\nå‘èµ· POST è¯·æ±‚\n// åŸºç¡€ POST è¯·æ±‚axios.post(&#x27;/users&#x27;, &#123;  username: &#x27;john_doe&#x27;,  email: &#x27;john@example.com&#x27;,  password: &#x27;password123&#x27;&#125;).then(response =&gt; &#123;  console.log(&#x27;User created:&#x27;, response.data);&#125;).catch(error =&gt; &#123;  console.error(&#x27;Error:&#x27;, error);&#125;);// å¸¦è¯·æ±‚å¤´çš„ POST è¯·æ±‚axios.post(&#x27;/login&#x27;,   &#123; username: &#x27;admin&#x27;, password: &#x27;admin123&#x27; &#125;,  &#123;    headers: &#123;      &#x27;Content-Type&#x27;: &#x27;application/x-www-form-urlencoded&#x27;    &#125;  &#125;).then(response =&gt; &#123;  console.log(&#x27;Login successful:&#x27;, response.data);&#125;);\nå…¶ä»–è¯·æ±‚æ–¹æ³•\n// PUT è¯·æ±‚ - æ›´æ–°æ•´ä¸ªèµ„æºaxios.put(&#x27;/users/123&#x27;, &#123;  name: &#x27;John Updated&#x27;,  email: &#x27;john.updated@example.com&#x27;&#125;);// PATCH è¯·æ±‚ - éƒ¨åˆ†æ›´æ–°axios.patch(&#x27;/users/123&#x27;, &#123;  email: &#x27;new.email@example.com&#x27;&#125;);// DELETE è¯·æ±‚axios.delete(&#x27;/users/123&#x27;);// HEAD è¯·æ±‚ - è·å–å“åº”å¤´axios.head(&#x27;/users/123&#x27;);// OPTIONS è¯·æ±‚ - è·å–èµ„æºæ”¯æŒçš„æ–¹æ³•axios.options(&#x27;/users&#x27;);\n\nä¸€èˆ¬åœºæ™¯åº”ç”¨\nå¤„ç†å¹¶å‘è¯·æ±‚\n// åŒæ—¶å‘èµ·å¤šä¸ªè¯·æ±‚function getUserAccount() &#123;  return axios.get(&#x27;/user/123&#x27;);&#125;function getUserPermissions() &#123;  return axios.get(&#x27;/user/123/permissions&#x27;);&#125;axios.all([getUserAccount(), getUserPermissions()])  .then(axios.spread((account, permissions) =&gt; &#123;    console.log(&#x27;Account:&#x27;, account.data);    console.log(&#x27;Permissions:&#x27;, permissions.data);  &#125;));// ä½¿ç”¨ Promise.allPromise.all([  axios.get(&#x27;/users&#x27;),  axios.get(&#x27;/posts&#x27;),  axios.get(&#x27;/comments&#x27;)]).then(([usersRes, postsRes, commentsRes]) =&gt; &#123;  console.log(&#x27;Users:&#x27;, usersRes.data);  console.log(&#x27;Posts:&#x27;, postsRes.data);  console.log(&#x27;Comments:&#x27;, commentsRes.data);&#125;);\nè¯·æ±‚é…ç½®è¯¦è§£\nconst config = &#123;  url: &#x27;/users&#x27;,  method: &#x27;get&#x27;, // default  baseURL: &#x27;https://api.example.com&#x27;,  transformRequest: [function (data, headers) &#123;    // å¯¹è¯·æ±‚æ•°æ®è¿›è¡Œè½¬æ¢å¤„ç†    return data;  &#125;],  transformResponse: [function (data) &#123;    // å¯¹å“åº”æ•°æ®è¿›è¡Œè½¬æ¢å¤„ç†    return data;  &#125;],  headers: &#123;&#x27;X-Requested-With&#x27;: &#x27;XMLHttpRequest&#x27;&#125;,  params: &#123;    ID: 12345  &#125;,  paramsSerializer: function(params) &#123;    return Qs.stringify(params, &#123;arrayFormat: &#x27;brackets&#x27;&#125;)  &#125;,  data: &#123;    firstName: &#x27;Fred&#x27;  &#125;,  timeout: 1000,  withCredentials: false, // default  adapter: function (config) &#123;    /* ... */  &#125;,  auth: &#123;    username: &#x27;janedoe&#x27;,    password: &#x27;s00pers3cret&#x27;  &#125;,  responseType: &#x27;json&#x27;, // default  responseEncoding: &#x27;utf8&#x27;, // default  xsrfCookieName: &#x27;XSRF-TOKEN&#x27;, // default  xsrfHeaderName: &#x27;X-XSRF-TOKEN&#x27;, // default  onUploadProgress: function (progressEvent) &#123;    // å¤„ç†ä¸Šä¼ è¿›åº¦  &#125;,  onDownloadProgress: function (progressEvent) &#123;    // å¤„ç†ä¸‹è½½è¿›åº¦  &#125;,  maxContentLength: 2000,  validateStatus: function (status) &#123;    return status &gt;= 200 &amp;&amp; status &lt; 300; // default  &#125;,  maxRedirects: 5, // default  socketPath: null, // default  httpAgent: new http.Agent(&#123; keepAlive: true &#125;),  httpsAgent: new https.Agent(&#123; keepAlive: true &#125;),  proxy: &#123;    host: &#x27;127.0.0.1&#x27;,    port: 9000,    auth: &#123;      username: &#x27;mikeymike&#x27;,      password: &#x27;rapunz3l&#x27;    &#125;  &#125;,  cancelToken: new axios.CancelToken(function (cancel) &#123;  &#125;)&#125;;axios(config)  .then(response =&gt; &#123;    console.log(response.data);  &#125;);\né”™è¯¯å¤„ç†\naxios.get(&#x27;/users&#x27;)  .then(response =&gt; &#123;    console.log(response.data);  &#125;)  .catch(error =&gt; &#123;    if (error.response) &#123;      // è¯·æ±‚å·²å‘å‡ºï¼ŒæœåŠ¡å™¨è¿”å›çŠ¶æ€ç ä¸åœ¨ 2xx èŒƒå›´å†…      console.log(error.response.data);      console.log(error.response.status);      console.log(error.response.headers);    &#125; else if (error.request) &#123;      // è¯·æ±‚å·²å‘å‡ºï¼Œä½†æ²¡æœ‰æ”¶åˆ°å“åº”      console.log(error.request);    &#125; else &#123;      // å‘ç”Ÿäº†ä¸€äº›è®¾ç½®è¯·æ±‚æ—¶çš„é”™è¯¯      console.log(&#x27;Error:&#x27;, error.message);    &#125;    console.log(error.config);  &#125;);\n\nVue é¡¹ç›®ä¸­çš„ä½¿ç”¨\nVue 3 ä¸­çš„åŸºç¡€ä½¿ç”¨\n// src/main.jsimport &#123; createApp &#125; from &#x27;vue&#x27;;import App from &#x27;./App.vue&#x27;;import axios from &#x27;axios&#x27;;const app = createApp(App);// å…¨å±€é…ç½® axiosaxios.defaults.baseURL = process.env.VUE_APP_API_URL;axios.defaults.timeout = 10000;// æ·»åŠ åˆ°å…¨å±€å±æ€§app.config.globalProperties.$axios = axios;app.mount(&#x27;#app&#x27;);\nåœ¨ç»„ä»¶ä¸­ä½¿ç”¨\n&lt;template&gt;  &lt;div class=&quot;user-profile&quot;&gt;    &lt;div v-if=&quot;loading&quot; class=&quot;loading&quot;&gt;Loading...&lt;/div&gt;    &lt;div v-else-if=&quot;error&quot; class=&quot;error&quot;&gt;&#123;&#123; error &#125;&#125;&lt;/div&gt;    &lt;div v-else class=&quot;profile&quot;&gt;      &lt;h2&gt;&#123;&#123; user.name &#125;&#125;&lt;/h2&gt;      &lt;p&gt;&#123;&#123; user.email &#125;&#125;&lt;/p&gt;    &lt;/div&gt;  &lt;/div&gt;&lt;/template&gt;&lt;script setup&gt;import &#123; ref, onMounted &#125; from &#x27;vue&#x27;;import axios from &#x27;axios&#x27;;const user = ref(null);const loading = ref(false);const error = ref(null);onMounted(async () =&gt; &#123;  loading.value = true;  try &#123;    const response = await axios.get(&#x27;/users/profile&#x27;);    user.value = response.data;  &#125; catch (err) &#123;    error.value = &#x27;Failed to load user data&#x27;;    console.error(err);  &#125; finally &#123;    loading.value = false;  &#125;&#125;);&lt;/script&gt;&lt;style scoped&gt;.loading &#123; color: #666; &#125;.error &#123; color: #dc3545; &#125;.profile &#123; padding: 20px; &#125;&lt;/style&gt;\nç»“åˆ Pinia è¿›è¡ŒçŠ¶æ€ç®¡ç†\n// src/stores/userStore.jsimport &#123; defineStore &#125; from &#x27;pinia&#x27;;import axios from &#x27;@/utils/axiosConfig&#x27;;export const useUserStore = defineStore(&#x27;user&#x27;, &#123;  state: () =&gt; (&#123;    user: null,    loading: false,    error: null  &#125;),    actions: &#123;    async fetchUserProfile() &#123;      this.loading = true;      this.error = null;            try &#123;        const response = await axios.get(&#x27;/users/profile&#x27;);        this.user = response.data;        return response.data;      &#125; catch (err) &#123;        this.error = err.message || &#x27;Failed to fetch user profile&#x27;;        throw err;      &#125; finally &#123;        this.loading = false;      &#125;    &#125;,        async updateUserProfile(data) &#123;      this.loading = true;      this.error = null;            try &#123;        const response = await axios.put(&#x27;/users/profile&#x27;, data);        this.user = response.data;        return response.data;      &#125; catch (err) &#123;        this.error = err.message || &#x27;Failed to update profile&#x27;;        throw err;      &#125; finally &#123;        this.loading = false;      &#125;    &#125;  &#125;&#125;);\nåœ¨ Vue Router ä¸­ä½¿ç”¨\n// src/router/index.jsimport &#123; createRouter, createWebHistory &#125; from &#x27;vue-router&#x27;;import Home from &#x27;../views/Home.vue&#x27;;import axios from &#x27;@/utils/axiosConfig&#x27;;const routes = [  &#123;    path: &#x27;/&#x27;,    name: &#x27;Home&#x27;,    component: Home  &#125;,  &#123;    path: &#x27;/dashboard&#x27;,    name: &#x27;Dashboard&#x27;,    component: () =&gt; import(&#x27;../views/Dashboard.vue&#x27;),    beforeEnter: async (to, from, next) =&gt; &#123;      try &#123;        // æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å·²ç™»å½•        const response = await axios.get(&#x27;/auth/me&#x27;);        if (response.data.isAuthenticated) &#123;          next();        &#125; else &#123;          next(&#x27;/login&#x27;);        &#125;      &#125; catch (error) &#123;        next(&#x27;/login&#x27;);      &#125;    &#125;  &#125;];const router = createRouter(&#123;  history: createWebHistory(process.env.BASE_URL),  routes&#125;);export default router;\n\nAxios å°è£…æœ€ä½³å®è·µ\nåˆ›å»ºåŸºç¡€è¯·æ±‚ç±»\n// src/utils/request.jsimport axios from &#x27;axios&#x27;;import &#123; ElMessage, ElLoading &#125; from &#x27;element-plus&#x27;;class Request &#123;  constructor() &#123;    this.instance = axios.create(&#123;      baseURL: process.env.VUE_APP_API_BASE_URL,      timeout: 10000,      headers: &#123;        &#x27;Content-Type&#x27;: &#x27;application/json&#x27;      &#125;    &#125;);        this.setupInterceptors();    this.loadingInstance = null;    this.requestCount = 0;  &#125;    // è®¾ç½®æ‹¦æˆªå™¨  setupInterceptors() &#123;    // è¯·æ±‚æ‹¦æˆªå™¨    this.instance.interceptors.request.use(      (config) =&gt; &#123;        this.showLoading(config);                // æ·»åŠ è®¤è¯ token        const token = localStorage.getItem(&#x27;token&#x27;);        if (token) &#123;          config.headers.Authorization = `Bearer $&#123;token&#125;`;        &#125;                return config;      &#125;,      (error) =&gt; &#123;        this.hideLoading();        return Promise.reject(error);      &#125;    );        // å“åº”æ‹¦æˆªå™¨    this.instance.interceptors.response.use(      (response) =&gt; &#123;        this.hideLoading();        return this.handleResponse(response);      &#125;,      (error) =&gt; &#123;        this.hideLoading();        return this.handleError(error);      &#125;    );  &#125;    // æ˜¾ç¤ºåŠ è½½çŠ¶æ€  showLoading(config) &#123;    if (config.showLoading !== false) &#123;      this.requestCount++;      if (this.requestCount === 1) &#123;        this.loadingInstance = ElLoading.service(&#123;          fullscreen: true,          text: &#x27;Loading...&#x27;,          background: &#x27;rgba(0, 0, 0, 0.5)&#x27;        &#125;);      &#125;    &#125;  &#125;    // éšè—åŠ è½½çŠ¶æ€  hideLoading() &#123;    if (this.requestCount &gt; 0) &#123;      this.requestCount--;      if (this.requestCount === 0 &amp;&amp; this.loadingInstance) &#123;        this.loadingInstance.close();        this.loadingInstance = null;      &#125;    &#125;  &#125;    // å¤„ç†å“åº”æ•°æ®  handleResponse(response) &#123;    const &#123; data, status &#125; = response;        // æ ¹æ®åç«¯è¿”å›æ ¼å¼ç»Ÿä¸€å¤„ç†    if (status === 200) &#123;      if (data.code === 200) &#123;        return data.data;      &#125; else &#123;        ElMessage.error(data.message || &#x27;Request failed&#x27;);        return Promise.reject(data);      &#125;    &#125;        return data;  &#125;    // å¤„ç†é”™è¯¯  handleError(error) &#123;    const &#123; response &#125; = error;        if (response) &#123;      const &#123; status, data &#125; = response;            switch (status) &#123;        case 401:          // æœªæˆæƒï¼Œè·³è½¬åˆ°ç™»å½•é¡µ          ElMessage.error(&#x27;Authentication failed, please login again&#x27;);          localStorage.removeItem(&#x27;token&#x27;);          window.location.href = &#x27;/login&#x27;;          break;        case 403:          ElMessage.error(&#x27;Access denied&#x27;);          break;        case 404:          ElMessage.error(&#x27;Resource not found&#x27;);          break;        case 500:          ElMessage.error(&#x27;Server error&#x27;);          break;        default:          ElMessage.error(data.message || &#x27;Request error&#x27;);      &#125;    &#125; else if (error.request) &#123;      ElMessage.error(&#x27;Network error&#x27;);    &#125; else &#123;      ElMessage.error(error.message);    &#125;        return Promise.reject(error);  &#125;    // è¯·æ±‚æ–¹æ³•  request(config) &#123;    return this.instance.request(config);  &#125;    get(url, params, config = &#123;&#125;) &#123;    return this.instance.get(url, &#123; params, ...config &#125;);  &#125;    post(url, data, config = &#123;&#125;) &#123;    return this.instance.post(url, data, config);  &#125;    put(url, data, config = &#123;&#125;) &#123;    return this.instance.put(url, data, config);  &#125;    patch(url, data, config = &#123;&#125;) &#123;    return this.instance.patch(url, data, config);  &#125;    delete(url, config = &#123;&#125;) &#123;    return this.instance.delete(url, config);  &#125;&#125;export default new Request();\nåˆ›å»º API æœåŠ¡å±‚\n// src/api/index.jsimport request from &#x27;@/utils/request&#x27;;// ç»Ÿä¸€å¯¼å‡ºæ‰€æœ‰ APIexport * from &#x27;./auth&#x27;;export * from &#x27;./user&#x27;;export * from &#x27;./post&#x27;;export * from &#x27;./comment&#x27;;// src/api/auth.jsexport const authAPI = &#123;  login: (data) =&gt; request.post(&#x27;/auth/login&#x27;, data),  logout: () =&gt; request.post(&#x27;/auth/logout&#x27;),  register: (data) =&gt; request.post(&#x27;/auth/register&#x27;, data),  getProfile: () =&gt; request.get(&#x27;/auth/profile&#x27;),  refreshToken: () =&gt; request.post(&#x27;/auth/refresh-token&#x27;)&#125;;// src/api/user.jsexport const userAPI = &#123;  getUserList: (params) =&gt; request.get(&#x27;/users&#x27;, params),  getUserById: (id) =&gt; request.get(`/users/$&#123;id&#125;`),  createUser: (data) =&gt; request.post(&#x27;/users&#x27;, data),  updateUser: (id, data) =&gt; request.put(`/users/$&#123;id&#125;`, data),  deleteUser: (id) =&gt; request.delete(`/users/$&#123;id&#125;`),  updatePassword: (data) =&gt; request.post(&#x27;/users/password&#x27;, data)&#125;;\nåœ¨ç»„ä»¶ä¸­ä½¿ç”¨å°è£…åçš„ API\n&lt;template&gt;  &lt;div class=&quot;user-management&quot;&gt;    &lt;div class=&quot;search-bar&quot;&gt;      &lt;el-input v-model=&quot;searchKeyword&quot; placeholder=&quot;Search users...&quot; /&gt;      &lt;el-button @click=&quot;fetchUsers&quot;&gt;Search&lt;/el-button&gt;    &lt;/div&gt;        &lt;el-table :data=&quot;userList&quot; border&gt;      &lt;el-table-column prop=&quot;id&quot; label=&quot;ID&quot; width=&quot;80&quot; /&gt;      &lt;el-table-column prop=&quot;name&quot; label=&quot;Name&quot; /&gt;      &lt;el-table-column prop=&quot;email&quot; label=&quot;Email&quot; /&gt;      &lt;el-table-column prop=&quot;status&quot; label=&quot;Status&quot; /&gt;      &lt;el-table-column label=&quot;Actions&quot; width=&quot;200&quot;&gt;        &lt;template #default=&quot;scope&quot;&gt;          &lt;el-button @click=&quot;editUser(scope.row)&quot;&gt;Edit&lt;/el-button&gt;          &lt;el-button type=&quot;danger&quot; @click=&quot;deleteUser(scope.row.id)&quot;&gt;Delete&lt;/el-button&gt;        &lt;/template&gt;      &lt;/el-table-column&gt;    &lt;/el-table&gt;        &lt;el-pagination      v-model:current-page=&quot;currentPage&quot;      v-model:page-size=&quot;pageSize&quot;      :total=&quot;total&quot;      @current-change=&quot;fetchUsers&quot;    /&gt;  &lt;/div&gt;&lt;/template&gt;&lt;script setup&gt;import &#123; ref, onMounted &#125; from &#x27;vue&#x27;;import &#123; userAPI &#125; from &#x27;@/api&#x27;;const userList = ref([]);const searchKeyword = ref(&#x27;&#x27;);const currentPage = ref(1);const pageSize = ref(10);const total = ref(0);const fetchUsers = async () =&gt; &#123;  try &#123;    const params = &#123;      page: currentPage.value,      pageSize: pageSize.value    &#125;;        if (searchKeyword.value) &#123;      params.keyword = searchKeyword.value;    &#125;        const response = await userAPI.getUserList(params);    userList.value = response.list;    total.value = response.total;  &#125; catch (error) &#123;    console.error(&#x27;Failed to fetch users:&#x27;, error);  &#125;&#125;;const deleteUser = async (id) =&gt; &#123;  try &#123;    await userAPI.deleteUser(id);    ElMessage.success(&#x27;User deleted successfully&#x27;);    fetchUsers(); // é‡æ–°åŠ è½½åˆ—è¡¨  &#125; catch (error) &#123;    console.error(&#x27;Failed to delete user:&#x27;, error);  &#125;&#125;;onMounted(() =&gt; &#123;  fetchUsers();&#125;);&lt;/script&gt;\n\nç½‘ç»œçŸ¥è¯†ç§‘æ™®\nHTTP åè®®åŸºç¡€\nHTTP åè®®æ¦‚è¿°\nHTTPï¼ˆHyperText Transfer Protocolï¼‰æ˜¯è¶…æ–‡æœ¬ä¼ è¾“åè®®ï¼Œæ˜¯ç”¨äºä¼ è¾“è¶…åª’ä½“æ–‡æ¡£ï¼ˆå¦‚ HTMLï¼‰çš„åº”ç”¨å±‚åè®®ã€‚å®ƒåŸºäº TCP/IP åè®®ï¼Œé‡‡ç”¨å®¢æˆ·ç«¯-æœåŠ¡å™¨æ¨¡å‹ã€‚\nHTTP è¯·æ±‚æ–¹æ³•\n\n\n\næ–¹æ³•\nç”¨é€”\nå®‰å…¨æ€§\nå¹‚ç­‰æ€§\n\n\n\n\nGET\nè·å–èµ„æº\nå®‰å…¨\nå¹‚ç­‰\n\n\nPOST\nåˆ›å»ºèµ„æº\nä¸å®‰å…¨\nä¸å¹‚ç­‰\n\n\nPUT\næ›´æ–°æ•´ä¸ªèµ„æº\nä¸å®‰å…¨\nå¹‚ç­‰\n\n\nPATCH\néƒ¨åˆ†æ›´æ–°èµ„æº\nä¸å®‰å…¨\nä¸å¹‚ç­‰\n\n\nDELETE\nåˆ é™¤èµ„æº\nä¸å®‰å…¨\nå¹‚ç­‰\n\n\nHEAD\nè·å–å“åº”å¤´\nå®‰å…¨\nå¹‚ç­‰\n\n\nOPTIONS\nè·å–èµ„æºæ”¯æŒçš„æ–¹æ³•\nå®‰å…¨\nå¹‚ç­‰\n\n\n\nHTTP çŠ¶æ€ç \n1xx: ä¿¡æ¯æ€§çŠ¶æ€ç   100 Continue - ç»§ç»­å¤„ç†è¯·æ±‚  101 Switching Protocols - åè®®åˆ‡æ¢2xx: æˆåŠŸçŠ¶æ€ç   200 OK - è¯·æ±‚æˆåŠŸ  201 Created - èµ„æºåˆ›å»ºæˆåŠŸ  204 No Content - æˆåŠŸä½†æ— è¿”å›å†…å®¹3xx: é‡å®šå‘çŠ¶æ€ç   301 Moved Permanently - æ°¸ä¹…é‡å®šå‘  302 Found - ä¸´æ—¶é‡å®šå‘  304 Not Modified - èµ„æºæœªä¿®æ”¹4xx: å®¢æˆ·ç«¯é”™è¯¯çŠ¶æ€ç   400 Bad Request - è¯·æ±‚å‚æ•°é”™è¯¯  401 Unauthorized - æœªæˆæƒ  403 Forbidden - ç¦æ­¢è®¿é—®  404 Not Found - èµ„æºä¸å­˜åœ¨  429 Too Many Requests - è¯·æ±‚è¿‡äºé¢‘ç¹5xx: æœåŠ¡å™¨é”™è¯¯çŠ¶æ€ç   500 Internal Server Error - æœåŠ¡å™¨å†…éƒ¨é”™è¯¯  502 Bad Gateway - ç½‘å…³é”™è¯¯  503 Service Unavailable - æœåŠ¡ä¸å¯ç”¨\nRESTful API è®¾è®¡è§„èŒƒ\næ ¸å¿ƒåŸåˆ™\n\n\nèµ„æºå¯¼å‘ï¼šæ‰€æœ‰æ“ä½œéƒ½æ˜¯é’ˆå¯¹èµ„æºçš„\n\n\næ— çŠ¶æ€æ€§ï¼šæ¯ä¸ªè¯·æ±‚éƒ½åŒ…å«å®Œæ•´çš„ä¿¡æ¯\n\n\nç»Ÿä¸€æ¥å£ï¼šä½¿ç”¨æ ‡å‡†çš„ HTTP æ–¹æ³•\n\n\nå¯ç¼“å­˜æ€§ï¼šæ”¯æŒç¼“å­˜æœºåˆ¶\n\n\nåˆ†å±‚ç³»ç»Ÿï¼šå®¢æˆ·ç«¯ä¸éœ€è¦äº†è§£ç³»ç»Ÿæ¶æ„\n\n\nURL è®¾è®¡è§„èŒƒ\n# æ­£ç¡®çš„ URL è®¾è®¡GET    /users          # è·å–ç”¨æˆ·åˆ—è¡¨GET    /users/123      # è·å–æŒ‡å®šç”¨æˆ·POST   /users          # åˆ›å»ºæ–°ç”¨æˆ·PUT    /users/123      # æ›´æ–°ç”¨æˆ·ä¿¡æ¯DELETE /users/123      # åˆ é™¤ç”¨æˆ·# é”™è¯¯çš„ URL è®¾è®¡GET    /getUsers       # ä½¿ç”¨åŠ¨è¯GET    /user/123       # å•æ•°å½¢å¼POST   /users/create   # å†—ä½™åŠ¨è¯\næŸ¥è¯¢å‚æ•°è®¾è®¡\n# è¿‡æ»¤GET /users?role=admin&amp;status=active# æ’åºGET /users?sort=name&amp;order=asc# åˆ†é¡µGET /users?page=1&amp;pageSize=20# å­—æ®µç­›é€‰GET /users?fields=id,name,email\nè·¨åŸŸèµ„æºå…±äº«ï¼ˆCORSï¼‰\nä»€ä¹ˆæ˜¯ CORS\nCORSï¼ˆCross-Origin Resource Sharingï¼‰æ˜¯ä¸€ç§æœºåˆ¶ï¼Œå…è®¸æµè§ˆå™¨å‘è·¨æºæœåŠ¡å™¨å‘å‡º XMLHttpRequest è¯·æ±‚ï¼Œä»è€Œå…‹æœäº† AJAX åªèƒ½åŒæºä½¿ç”¨çš„é™åˆ¶ã€‚\nCORS å·¥ä½œåŸç†\n\n\nç®€å•è¯·æ±‚ï¼šç›´æ¥å‘é€è¯·æ±‚ï¼ŒæœåŠ¡å™¨è¿”å› CORS ç›¸å…³å¤´\n\n\né¢„æ£€è¯·æ±‚ï¼šå¤æ‚è¯·æ±‚ä¼šå…ˆå‘é€ OPTIONS è¯·æ±‚è¿›è¡Œé¢„æ£€\n\n\nå¸¸è§ CORS é…ç½®\n// æœåŠ¡å™¨ç«¯ CORS é…ç½®ç¤ºä¾‹ï¼ˆNode.js/Expressï¼‰const express = require(&#x27;express&#x27;);const cors = require(&#x27;cors&#x27;);const app = express();app.use(cors(&#123;  origin: [&#x27;http://localhost:3000&#x27;, &#x27;https://example.com&#x27;],  methods: [&#x27;GET&#x27;, &#x27;POST&#x27;, &#x27;PUT&#x27;, &#x27;DELETE&#x27;, &#x27;OPTIONS&#x27;],  allowedHeaders: [&#x27;Content-Type&#x27;, &#x27;Authorization&#x27;],  credentials: true,  maxAge: 86400 // é¢„æ£€ç¼“å­˜æ—¶é—´&#125;));\nHTTP ç¼“å­˜æœºåˆ¶\nç¼“å­˜ç±»å‹\n\n\nå¼ºç¼“å­˜ï¼šExpires å’Œ Cache-Control å¤´æ§åˆ¶\n\n\nåå•†ç¼“å­˜ï¼šLast-Modified/If-Modified-Since å’Œ ETag/If-None-Match\n\n\nç¼“å­˜æ§åˆ¶å¤´\n# Cache-Control æŒ‡ä»¤Cache-Control: public, max-age=3600, must-revalidate# å“åº”å¤´ç¤ºä¾‹Cache-Control: private, max-age=0, no-cacheETag: &quot;33a64df551425fcc55e4d42a148795d9f25f89d4&quot;Last-Modified: Wed, 21 Oct 2015 07:28:00 GMT\n\nå®‰å…¨æ€§è€ƒè™‘\nè®¤è¯ä¸æˆæƒ\nJWT è®¤è¯å®ç°\n// JWT å·¥å…·ç±»class JWTUtils &#123;  static setToken(token) &#123;    localStorage.setItem(&#x27;token&#x27;, token);    // ä¹Ÿå¯ä»¥ä½¿ç”¨ HttpOnly Cookie    // document.cookie = `token=$&#123;token&#125;; HttpOnly; Secure; SameSite=Strict`;  &#125;    static getToken() &#123;    return localStorage.getItem(&#x27;token&#x27;);  &#125;    static removeToken() &#123;    localStorage.removeItem(&#x27;token&#x27;);  &#125;    static isTokenExpired(token) &#123;    try &#123;      const payload = JSON.parse(atob(token.split(&#x27;.&#x27;)[1]));      return payload.exp * 1000 &lt; Date.now();    &#125; catch (error) &#123;      return true;    &#125;  &#125;&#125;// è¯·æ±‚æ‹¦æˆªå™¨ä¸­çš„è®¤è¯å¤„ç†instance.interceptors.request.use(config =&gt; &#123;  const token = JWTUtils.getToken();    if (token) &#123;    if (JWTUtils.isTokenExpired(token)) &#123;      // Token è¿‡æœŸï¼Œå°è¯•åˆ·æ–°      return refreshToken()        .then(newToken =&gt; &#123;          JWTUtils.setToken(newToken);          config.headers.Authorization = `Bearer $&#123;newToken&#125;`;          return config;        &#125;)        .catch(() =&gt; &#123;          JWTUtils.removeToken();          window.location.href = &#x27;/login&#x27;;          return Promise.reject(new Error(&#x27;Token expired&#x27;));        &#125;);    &#125;        config.headers.Authorization = `Bearer $&#123;token&#125;`;  &#125;    return config;&#125;);\nCSRF é˜²æŠ¤\nCSRF æ”»å‡»åŸç†\nCSRFï¼ˆCross-Site Request Forgeryï¼‰è·¨ç«™è¯·æ±‚ä¼ªé€ ï¼Œæ”»å‡»è€…åˆ©ç”¨ç”¨æˆ·å·²è®¤è¯çš„èº«ä»½æ‰§è¡Œéé¢„æœŸçš„æ“ä½œã€‚\né˜²æŠ¤æªæ–½\n// 1. ä½¿ç”¨ CSRF Tokenconst csrfToken = document.querySelector(&#x27;meta[name=&quot;csrf-token&quot;]&#x27;).content;axios.post(&#x27;/api/action&#x27;, &#123;  data: &#x27;value&#x27;&#125;, &#123;  headers: &#123;    &#x27;X-CSRF-Token&#x27;: csrfToken  &#125;&#125;);// 2. ä½¿ç”¨ SameSite Cookie// Set-Cookie: sessionid=abc123; SameSite=Strict; Secure; HttpOnly// 3. éªŒè¯ Origin/Referer å¤´app.use((req, res, next) =&gt; &#123;  const origin = req.headers.origin;  const allowedOrigins = [&#x27;https://example.com&#x27;, &#x27;http://localhost:3000&#x27;];    if (allowedOrigins.includes(origin)) &#123;    res.setHeader(&#x27;Access-Control-Allow-Origin&#x27;, origin);    next();  &#125; else &#123;    res.status(403).send(&#x27;Forbidden&#x27;);  &#125;&#125;);\nXSS é˜²æŠ¤\nXSS æ”»å‡»ç±»å‹\n\n\nå­˜å‚¨å‹ XSSï¼šæ¶æ„è„šæœ¬å­˜å‚¨åœ¨æœåŠ¡å™¨\n\n\nåå°„å‹ XSSï¼šæ¶æ„è„šæœ¬é€šè¿‡ URL å‚æ•°æ³¨å…¥\n\n\nDOM å‹ XSSï¼šå®¢æˆ·ç«¯ JavaScript å¤„ç†ä¸å½“\n\n\né˜²æŠ¤æªæ–½\n// 1. è¾“å…¥éªŒè¯function sanitizeInput(input) &#123;  return input    .replace(/&amp;/g, &#x27;&amp;amp;&#x27;)    .replace(/&lt;/g, &#x27;&amp;lt;&#x27;)    .replace(/&gt;/g, &#x27;&amp;gt;&#x27;)    .replace(/&quot;/g, &#x27;&amp;quot;&#x27;)    .replace(/&#x27;/g, &#x27;&amp;#039;&#x27;);&#125;// 2. ä½¿ç”¨ Content Security Policy// Content-Security-Policy: default-src &#x27;self&#x27;; script-src &#x27;self&#x27; &#x27;unsafe-inline&#x27; &#x27;unsafe-eval&#x27;; style-src &#x27;self&#x27; &#x27;unsafe-inline&#x27;; img-src &#x27;self&#x27; data:;// 3. Vue ä¸­çš„ v-text å’Œ v-bind&lt;template&gt;  &lt;!-- å®‰å…¨çš„æ–‡æœ¬ç»‘å®š --&gt;  &lt;div v-text=&quot;userInput&quot;&gt;&lt;/div&gt;    &lt;!-- å®‰å…¨çš„å±æ€§ç»‘å®š --&gt;  &lt;div :title=&quot;sanitizedTitle&quot;&gt;&lt;/div&gt;&lt;/template&gt;\næ•°æ®ä¼ è¾“å®‰å…¨\nHTTPS é…ç½®\n// å¼ºåˆ¶ä½¿ç”¨ HTTPSif (process.env.NODE_ENV === &#x27;production&#x27; &amp;&amp; window.location.protocol !== &#x27;https:&#x27;) &#123;  window.location.href = `https:$&#123;window.location.href.substring(window.location.protocol.length)&#125;`;&#125;// å®‰å…¨çš„ cookie è®¾ç½®document.cookie = &#x27;session=abc123; Secure; HttpOnly; SameSite=Strict; Path=/; Max-Age=86400&#x27;;\n\næ€§èƒ½ä¼˜åŒ–\nè¯·æ±‚ä¼˜åŒ–\nè¯·æ±‚åˆå¹¶ä¸æ‰¹å¤„ç†\nclass RequestBatcher &#123;  constructor() &#123;    this.queue = new Map();    this.timer = null;  &#125;    // æ·»åŠ è¯·æ±‚åˆ°æ‰¹å¤„ç†é˜Ÿåˆ—  addRequest(url, params, callback) &#123;    const key = `$&#123;url&#125;-$&#123;JSON.stringify(params)&#125;`;        if (!this.queue.has(key)) &#123;      this.queue.set(key, &#123; url, params, callbacks: [] &#125;);    &#125;        this.queue.get(key).callbacks.push(callback);        this.scheduleBatch();  &#125;    // è°ƒåº¦æ‰¹å¤„ç†  scheduleBatch() &#123;    if (this.timer) return;        this.timer = setTimeout(() =&gt; &#123;      this.processBatch();    &#125;, 100); // 100ms å»¶è¿Ÿåˆå¹¶è¯·æ±‚  &#125;    // å¤„ç†æ‰¹å¤„ç†è¯·æ±‚  async processBatch() &#123;    const batchRequests = Array.from(this.queue.values());        try &#123;      // å‘é€æ‰¹å¤„ç†è¯·æ±‚      const response = await axios.post(&#x27;/api/batch&#x27;, &#123;        requests: batchRequests.map(req =&gt; (&#123;          url: req.url,          params: req.params        &#125;))      &#125;);            // åˆ†å‘å“åº”ç»“æœ      response.data.forEach((result, index) =&gt; &#123;        const request = batchRequests[index];        request.callbacks.forEach(callback =&gt; callback(result));      &#125;);    &#125; catch (error) &#123;      batchRequests.forEach(request =&gt; &#123;        request.callbacks.forEach(callback =&gt; callback(null, error));      &#125;);    &#125; finally &#123;      this.queue.clear();      this.timer = null;    &#125;  &#125;&#125;const batcher = new RequestBatcher();\nè¯·æ±‚ç¼“å­˜\nclass RequestCache &#123;  constructor() &#123;    this.cache = new Map();    this.maxAge = 5 * 60 * 1000; // é»˜è®¤ç¼“å­˜ 5 åˆ†é’Ÿ  &#125;    // è·å–ç¼“å­˜æ•°æ®  get(key) &#123;    const item = this.cache.get(key);        if (!item) return null;        // æ£€æŸ¥ç¼“å­˜æ˜¯å¦è¿‡æœŸ    if (Date.now() - item.timestamp &gt; this.maxAge) &#123;      this.cache.delete(key);      return null;    &#125;        return item.data;  &#125;    // è®¾ç½®ç¼“å­˜æ•°æ®  set(key, data, maxAge = this.maxAge) &#123;    this.cache.set(key, &#123;      data,      timestamp: Date.now(),      maxAge    &#125;);        // è®¾ç½®è¿‡æœŸæ¸…ç†    setTimeout(() =&gt; &#123;      this.cache.delete(key);    &#125;, maxAge);  &#125;    // ç”Ÿæˆç¼“å­˜ key  generateKey(url, params = &#123;&#125;) &#123;    return `$&#123;url&#125;?$&#123;new URLSearchParams(params).toString()&#125;`;  &#125;    // ç¼“å­˜è¯·æ±‚  async cachedRequest(url, params = &#123;&#125;, config = &#123;&#125;) &#123;    const cacheKey = this.generateKey(url, params);    const cachedData = this.get(cacheKey);        if (cachedData &amp;&amp; !config.forceRefresh) &#123;      return cachedData;    &#125;        try &#123;      const response = await axios.get(url, &#123; params, ...config &#125;);      this.set(cacheKey, response.data, config.maxAge);      return response.data;    &#125; catch (error) &#123;      // å¦‚æœæœ‰ç¼“å­˜ï¼Œå³ä½¿è¯·æ±‚å¤±è´¥ä¹Ÿè¿”å›ç¼“å­˜æ•°æ®      if (cachedData) &#123;        console.warn(&#x27;Using cached data due to request failure&#x27;);        return cachedData;      &#125;      throw error;    &#125;  &#125;&#125;const requestCache = new RequestCache();\nå“åº”ä¼˜åŒ–\næ•°æ®å‹ç¼©\n// æœåŠ¡å™¨ç«¯å¯ç”¨ Gzip å‹ç¼©const compression = require(&#x27;compression&#x27;);app.use(compression());// å®¢æˆ·ç«¯è¯·æ±‚å‹ç¼©æ•°æ®axios.get(&#x27;/api/data&#x27;, &#123;  headers: &#123;    &#x27;Accept-Encoding&#x27;: &#x27;gzip, deflate&#x27;  &#125;&#125;);\nå›¾ç‰‡ä¼˜åŒ–\n// å›¾ç‰‡æ‡’åŠ è½½const loadImage = (url) =&gt; &#123;  return new Promise((resolve, reject) =&gt; &#123;    const img = new Image();    img.onload = () =&gt; resolve(img);    img.onerror = reject;    img.src = url;  &#125;);&#125;;// ä½¿ç”¨ WebP æ ¼å¼const getWebPImage = (url) =&gt; &#123;  return new Promise((resolve) =&gt; &#123;    const webpData = &#x27;data:image/webp;base64,UklGRjoAAABXRUJQVlA4IC4AAACyAgCdASoCAAIALmk0mk0iIiIiIgBoSygABc6WWgAA/veff/0PP8bA//LwYAAA&#x27;;    const img = new Image();        img.onload = () =&gt; &#123;      if (img.width &gt; 0 &amp;&amp; img.height &gt; 0) &#123;        resolve(url.replace(/\\.(jpg|jpeg|png)$/, &#x27;.webp&#x27;));      &#125; else &#123;        resolve(url);      &#125;    &#125;;        img.onerror = () =&gt; resolve(url);    img.src = webpData;  &#125;);&#125;;\nè¿æ¥ä¼˜åŒ–\nHTTP/2 æ”¯æŒ\n// æ£€æŸ¥ HTTP/2 æ”¯æŒif (window.location.protocol === &#x27;https:&#x27;) &#123;  fetch(&#x27;/api/check-http2&#x27;)    .then(response =&gt; &#123;      const isHttp2 = response.headers.get(&#x27;x-http2&#x27;) === &#x27;h2&#x27;;      console.log(&#x27;HTTP/2 supported:&#x27;, isHttp2);    &#125;);&#125;\nè¿æ¥æ± ç®¡ç†\n// è‡ªå®šä¹‰ Axios é€‚é…å™¨ä¼˜åŒ–è¿æ¥æ± const http = require(&#x27;http&#x27;);const https = require(&#x27;https&#x27;);const httpAgent = new http.Agent(&#123;  keepAlive: true,  maxSockets: 50,  maxFreeSockets: 10,  timeout: 60000,  freeSocketTimeout: 30000&#125;);const httpsAgent = new https.Agent(&#123;  keepAlive: true,  maxSockets: 50,  maxFreeSockets: 10,  timeout: 60000,  freeSocketTimeout: 30000&#125;);const axiosInstance = axios.create(&#123;  httpAgent,  httpsAgent,  timeout: 10000&#125;);\n\nå¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ\nè·¨åŸŸé—®é¢˜\né—®é¢˜æè¿°\nå‰ç«¯åº”ç”¨ä¸åç«¯ API ä¸åœ¨åŒä¸€ä¸ªåŸŸåä¸‹ï¼Œå¯¼è‡´æµè§ˆå™¨é˜»æ­¢è¯·æ±‚ã€‚\nè§£å†³æ–¹æ¡ˆ\n// 1. å¼€å‘ç¯å¢ƒä»£ç†é…ç½®ï¼ˆVue CLIï¼‰// vue.config.jsmodule.exports = &#123;  devServer: &#123;    proxy: &#123;      &#x27;/api&#x27;: &#123;        target: &#x27;http://localhost:3000&#x27;,        changeOrigin: true,        pathRewrite: &#123;          &#x27;^/api&#x27;: &#x27;&#x27;        &#125;,        cookieDomainRewrite: &#123;          &#x27;localhost:3000&#x27;: &#x27;localhost:8080&#x27;        &#125;      &#125;    &#125;  &#125;&#125;;// 2. Vite ä»£ç†é…ç½®// vite.config.jsexport default &#123;  server: &#123;    proxy: &#123;      &#x27;/api&#x27;: &#123;        target: &#x27;http://localhost:3000&#x27;,        changeOrigin: true,        rewrite: (path) =&gt; path.replace(/^\\/api/, &#x27;&#x27;)      &#125;    &#125;  &#125;&#125;;\nè¯·æ±‚è¶…æ—¶å¤„ç†\nå…¨å±€è¶…æ—¶é…ç½®\nconst axiosInstance = axios.create(&#123;  timeout: 10000 // å…¨å±€è¶…æ—¶æ—¶é—´&#125;);// å•ä¸ªè¯·æ±‚è¶…æ—¶é…ç½®axios.get(&#x27;/api/data&#x27;, &#123;  timeout: 5000 // è¦†ç›–å…¨å±€é…ç½®&#125;);// è¶…æ—¶é‡è¯•æœºåˆ¶class RetryHandler &#123;  static async requestWithRetry(config, retries = 3, delay = 1000) &#123;    try &#123;      return await axios(config);    &#125; catch (error) &#123;      if (retries &gt; 0 &amp;&amp; this.isRetryable(error)) &#123;        await this.delay(delay);        return this.requestWithRetry(config, retries - 1, delay * 2);      &#125;      throw error;    &#125;  &#125;    static isRetryable(error) &#123;    return (      error.code === &#x27;ECONNABORTED&#x27; ||      (error.response &amp;&amp; error.response.status &gt;= 500)    );  &#125;    static delay(ms) &#123;    return new Promise(resolve =&gt; setTimeout(resolve, ms));  &#125;&#125;\né‡å¤è¯·æ±‚å¤„ç†\né˜²æ­¢é‡å¤æäº¤\nclass RequestDeduplicator &#123;  constructor() &#123;    this.pendingRequests = new Map();  &#125;    async request(config) &#123;    const key = this.generateKey(config);        // å¦‚æœè¯·æ±‚æ­£åœ¨è¿›è¡Œä¸­ï¼Œè¿”å›åŒä¸€ä¸ª Promise    if (this.pendingRequests.has(key)) &#123;      return this.pendingRequests.get(key);    &#125;        try &#123;      const promise = axios(config).finally(() =&gt; &#123;        this.pendingRequests.delete(key);      &#125;);            this.pendingRequests.set(key, promise);      return promise;    &#125; catch (error) &#123;      this.pendingRequests.delete(key);      throw error;    &#125;  &#125;    generateKey(config) &#123;    const &#123; method = &#x27;get&#x27;, url, params, data &#125; = config;    return `$&#123;method&#125;-$&#123;url&#125;-$&#123;JSON.stringify(params)&#125;-$&#123;JSON.stringify(data)&#125;`;  &#125;    cancelPendingRequests() &#123;    this.pendingRequests.forEach((promise, key) =&gt; &#123;      // å¦‚æœæ”¯æŒå–æ¶ˆï¼Œå–æ¶ˆè¯·æ±‚      if (config.cancelToken) &#123;        config.cancelToken.cancel(&#x27;Request canceled by deduplicator&#x27;);      &#125;      this.pendingRequests.delete(key);    &#125;);  &#125;&#125;const deduplicator = new RequestDeduplicator();\né”™è¯¯å¤„ç†æœ€ä½³å®è·µ\nç»Ÿä¸€é”™è¯¯å¤„ç†\n// é”™è¯¯ç±»å‹å®šä¹‰class ApiError extends Error &#123;  constructor(message, status = 500, code = &#x27;UNKNOWN_ERROR&#x27;, data = null) &#123;    super(message);    this.name = &#x27;ApiError&#x27;;    this.status = status;    this.code = code;    this.data = data;  &#125;&#125;// é”™è¯¯å¤„ç†ä¸­é—´ä»¶function errorHandler(error) &#123;  if (error instanceof ApiError) &#123;    return &#123;      success: false,      error: &#123;        message: error.message,        code: error.code,        status: error.status      &#125;    &#125;;  &#125;    if (axios.isAxiosError(error)) &#123;    const response = error.response;        if (response) &#123;      return &#123;        success: false,        error: &#123;          message: response.data.message || &#x27;Request failed&#x27;,          code: response.data.code || &#x27;API_ERROR&#x27;,          status: response.status        &#125;      &#125;;    &#125;        return &#123;      success: false,      error: &#123;        message: error.message || &#x27;Network error&#x27;,        code: &#x27;NETWORK_ERROR&#x27;,        status: 0      &#125;    &#125;;  &#125;    return &#123;    success: false,    error: &#123;      message: error.message || &#x27;Unknown error&#x27;,      code: &#x27;UNKNOWN_ERROR&#x27;,      status: 500    &#125;  &#125;;&#125;\n\næ ¸å¿ƒè¦ç‚¹å›é¡¾\n\n\nåŸºç¡€ä½¿ç”¨ï¼šæŒæ¡äº† GETã€POSTã€PUTã€DELETE ç­‰åŸºæœ¬è¯·æ±‚æ–¹æ³•\n\n\nVue é›†æˆï¼šå­¦ä¼šäº†åœ¨ Vue é¡¹ç›®ä¸­ä¼˜é›…åœ°ä½¿ç”¨ Axios\n\n\né«˜çº§å°è£…ï¼šæ„å»ºäº†å¯å¤ç”¨çš„è¯·æ±‚ç±»å’Œ API æœåŠ¡å±‚\n\n\nç½‘ç»œçŸ¥è¯†ï¼šæ·±å…¥ç†è§£äº† HTTP åè®®ã€RESTful APIã€CORS ç­‰æ¦‚å¿µ\n\n\nå®‰å…¨æ€§ï¼šæŒæ¡äº†è®¤è¯ã€æˆæƒã€CSRFã€XSS ç­‰å®‰å…¨é˜²æŠ¤æªæ–½\n\n\næ€§èƒ½ä¼˜åŒ–ï¼šå­¦ä¼šäº†è¯·æ±‚åˆå¹¶ã€ç¼“å­˜ã€è¿æ¥æ± ç­‰ä¼˜åŒ–æŠ€å·§\n\n\næœ€ä½³å®è·µå»ºè®®\n\n\nç»Ÿä¸€å°è£…ï¼šå§‹ç»ˆå¯¹ Axios è¿›è¡ŒäºŒæ¬¡å°è£…ï¼Œä¾¿äºç»Ÿä¸€ç®¡ç†\n\n\né”™è¯¯å¤„ç†ï¼šå»ºç«‹å®Œå–„çš„é”™è¯¯å¤„ç†æœºåˆ¶ï¼Œæå‡ç”¨æˆ·ä½“éªŒ\n\n\nå®‰å…¨æ„è¯†ï¼šé‡è§†ç½‘ç»œå®‰å…¨ï¼Œä¿æŠ¤ç”¨æˆ·æ•°æ®å’Œç³»ç»Ÿå®‰å…¨\n\n\næ€§èƒ½ä¼˜åŒ–ï¼šåˆç†ä½¿ç”¨ç¼“å­˜ã€è¿æ¥æ± ç­‰æŠ€æœ¯æå‡æ€§èƒ½\n\n\nä»£ç è§„èŒƒï¼šä¿æŒè‰¯å¥½çš„ä»£ç ç»„ç»‡å’Œå‘½åè§„èŒƒ\n\n\næŠ€æœ¯å‘å±•è¶‹åŠ¿\néšç€ Web æŠ€æœ¯çš„ä¸æ–­å‘å±•ï¼Œæˆ‘ä»¬è¿˜éœ€è¦å…³æ³¨ï¼š\n\n\nHTTP/3ï¼šåŸºäº QUIC åè®®çš„æ–°ä¸€ä»£ HTTP åè®®\n\n\nGraphQLï¼šä½œä¸º RESTful API çš„è¡¥å……å’Œæ›¿ä»£æ–¹æ¡ˆ\n\n\nWebSocketï¼šå®æ—¶é€šä¿¡çš„é‡è¦æŠ€æœ¯\n\n\nè¾¹ç¼˜è®¡ç®—ï¼šåœ¨ CDN è¾¹ç¼˜èŠ‚ç‚¹å¤„ç†è¯·æ±‚ï¼Œæå‡æ€§èƒ½\n\n\n\nå‚è€ƒèµ„æº\n\n\nAxios å®˜æ–¹æ–‡æ¡£\n\n\nMDN HTTP æ–‡æ¡£\n\n\nRESTful API è®¾è®¡æŒ‡å—\n\n\nHTTP/2 è§„èŒƒ\n\n\n\n","categories":["ç¼–ç¨‹"],"tags":["Web"]},{"title":"DOM&BOMå¯¹è±¡çš„æ–¹æ³•å’Œå±æ€§","url":"/2025/10/19/web/DOM&BOM%E5%AF%B9%E8%B1%A1%E7%9A%84%E6%96%B9%E6%B3%95%E5%92%8C%E5%B1%9E%E6%80%A7/","content":"\nå¦‚é¢˜ï¼Œç»“åˆå®˜æ–¹æ–‡æ¡£ä¸ç½‘ç»œå¸–å­ï¼Œåˆ©ç”¨AIæ•´ç†\n\n\nDOM &amp; BOM å¯¹è±¡æ–¹æ³•å±æ€§å…¨é¢æ€»ç»“\nDOMï¼ˆæ–‡æ¡£å¯¹è±¡æ¨¡å‹ï¼‰\næ¦‚å¿µä»‹ç»\nDOM (Document Object Model) æ˜¯æµè§ˆå™¨æŠŠHTMLæˆ–XMLæ–‡æ¡£ç»“æ„åŒ–æˆå¯¹è±¡çš„æ–¹å¼ï¼Œå¹¶æä¾›äº†ä¸€å¥—APIè®©JavaScriptå»æ“ä½œè¿™äº›å¯¹è±¡ï¼Œä»è€ŒåŠ¨æ€æ§åˆ¶ç½‘é¡µå†…å®¹ã€ç»“æ„å’Œæ ·å¼ã€‚\næ ¸å¿ƒç‰¹ç‚¹ï¼š\n\n\nDOMå°†æ–‡æ¡£è¡¨ç¤ºä¸ºèŠ‚ç‚¹æ ‘ç»“æ„\n\n\næ¯ä¸ªèŠ‚ç‚¹éƒ½æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå¯ä»¥è¢«JavaScriptè®¿é—®å’Œä¿®æ”¹\n\n\nDOMä¸æ˜¯JavaScriptè¯­è¨€çš„ä¸€éƒ¨åˆ†ï¼Œè€Œæ˜¯æµè§ˆå™¨æä¾›çš„Web API\n\n\næ”¯æŒè·¨å¹³å°å’Œè·¨è¯­è¨€è®¿é—®\n\n\nDocumentå¯¹è±¡\næ¦‚å¿µï¼šä»£è¡¨æ•´ä¸ªHTMLæ–‡æ¡£ï¼Œæ˜¯DOMæ ‘çš„æ ¹èŠ‚ç‚¹\nå¸¸ç”¨å±æ€§\n\n\n\nå±æ€§å\nè¯´æ˜\n\n\n\n\ndocument.documentElement\nè·å–&lt;html&gt;å…ƒç´ \n\n\ndocument.body\nè·å–&lt;body&gt;å…ƒç´ \n\n\ndocument.head\nè·å–&lt;head&gt;å…ƒç´ \n\n\ndocument.title\nè·å–æˆ–è®¾ç½®æ–‡æ¡£æ ‡é¢˜\n\n\ndocument.URL\nè·å–å½“å‰æ–‡æ¡£çš„URL\n\n\ndocument.domain\nè·å–æ–‡æ¡£çš„åŸŸå\n\n\ndocument.cookie\nè·å–æˆ–è®¾ç½®cookie\n\n\ndocument.referrer\nè·å–å¼•ç”¨é¡µé¢çš„URL\n\n\ndocument.characterSet\nè·å–æ–‡æ¡£çš„å­—ç¬¦ç¼–ç \n\n\ndocument.readyState\nè·å–æ–‡æ¡£çš„åŠ è½½çŠ¶æ€\n\n\ndocument.doctype\nè·å–æ–‡æ¡£ç±»å‹å£°æ˜\n\n\ndocument.activeElement\nè·å–å½“å‰è·å¾—ç„¦ç‚¹çš„å…ƒç´ \n\n\ndocument.hidden\nè·å–æ–‡æ¡£æ˜¯å¦éšè—\n\n\ndocument.visibilityState\nè·å–æ–‡æ¡£çš„å¯è§æ€§çŠ¶æ€\n\n\n\nå¸¸ç”¨æ–¹æ³•\n\n\n\næ–¹æ³•å\nè¯´æ˜\n\n\n\n\ngetElementById(id)\né€šè¿‡IDè·å–å…ƒç´ \n\n\ngetElementsByClassName(className)\né€šè¿‡ç±»åè·å–å…ƒç´ é›†åˆ\n\n\ngetElementsByTagName(tagName)\né€šè¿‡æ ‡ç­¾åè·å–å…ƒç´ é›†åˆ\n\n\nquerySelector(selector)\né€šè¿‡CSSé€‰æ‹©å™¨è·å–ç¬¬ä¸€ä¸ªåŒ¹é…å…ƒç´ \n\n\nquerySelectorAll(selector)\né€šè¿‡CSSé€‰æ‹©å™¨è·å–æ‰€æœ‰åŒ¹é…å…ƒç´ \n\n\ncreateElement(tagName)\nåˆ›å»ºæ–°çš„å…ƒç´ èŠ‚ç‚¹\n\n\ncreateTextNode(text)\nåˆ›å»ºæ–°çš„æ–‡æœ¬èŠ‚ç‚¹\n\n\ncreateDocumentFragment()\nåˆ›å»ºæ–‡æ¡£ç‰‡æ®µ\n\n\nwrite(content)\nå‘æ–‡æ¡£å†™å…¥å†…å®¹\n\n\nopen()\næ‰“å¼€æ–‡æ¡£ä»¥ä¾¿å†™å…¥\n\n\nclose()\nå…³é—­æ–‡æ¡£å†™å…¥\n\n\naddEventListener(eventName, listener)\næ·»åŠ äº‹ä»¶ç›‘å¬å™¨\n\n\nremoveEventListener(eventName, listener)\nç§»é™¤äº‹ä»¶ç›‘å¬å™¨\n\n\ndispatchEvent(event)\næ´¾å‘äº‹ä»¶\n\n\n\nElementå¯¹è±¡\næ¦‚å¿µï¼šä»£è¡¨HTMLå…ƒç´ ï¼Œæ˜¯DOMæ ‘ä¸­çš„å…ƒç´ èŠ‚ç‚¹\nå¸¸ç”¨å±æ€§\n\n\n\nå±æ€§å\nè¯´æ˜\n\n\n\n\nelement.id\nè·å–æˆ–è®¾ç½®å…ƒç´ çš„ID\n\n\nelement.className\nè·å–æˆ–è®¾ç½®å…ƒç´ çš„ç±»å\n\n\nelement.classList\nè·å–å…ƒç´ çš„ç±»åˆ—è¡¨å¯¹è±¡\n\n\nelement.style\nè·å–å…ƒç´ çš„å†…è”æ ·å¼å¯¹è±¡\n\n\nelement.innerHTML\nè·å–æˆ–è®¾ç½®å…ƒç´ çš„HTMLå†…å®¹\n\n\nelement.textContent\nè·å–æˆ–è®¾ç½®å…ƒç´ çš„æ–‡æœ¬å†…å®¹\n\n\nelement.attributes\nè·å–å…ƒç´ çš„æ‰€æœ‰å±æ€§\n\n\nelement.parentElement\nè·å–çˆ¶å…ƒç´ \n\n\nelement.children\nè·å–å­å…ƒç´ é›†åˆ\n\n\nelement.firstElementChild\nè·å–ç¬¬ä¸€ä¸ªå­å…ƒç´ \n\n\nelement.lastElementChild\nè·å–æœ€åä¸€ä¸ªå­å…ƒç´ \n\n\nelement.previousElementSibling\nè·å–å‰ä¸€ä¸ªå…„å¼Ÿå…ƒç´ \n\n\nelement.nextElementSibling\nè·å–åä¸€ä¸ªå…„å¼Ÿå…ƒç´ \n\n\nelement.offsetTop\nè·å–å…ƒç´ ç›¸å¯¹äºoffsetParentçš„é¡¶éƒ¨åç§»\n\n\nelement.offsetLeft\nè·å–å…ƒç´ ç›¸å¯¹äºoffsetParentçš„å·¦ä¾§åç§»\n\n\nelement.offsetWidth\nè·å–å…ƒç´ çš„å®½åº¦ï¼ˆåŒ…æ‹¬è¾¹æ¡†å’Œå†…è¾¹è·ï¼‰\n\n\nelement.offsetHeight\nè·å–å…ƒç´ çš„é«˜åº¦ï¼ˆåŒ…æ‹¬è¾¹æ¡†å’Œå†…è¾¹è·ï¼‰\n\n\nelement.clientWidth\nè·å–å…ƒç´ çš„å†…å®¹å®½åº¦ï¼ˆä¸åŒ…æ‹¬è¾¹æ¡†ï¼‰\n\n\nelement.clientHeight\nè·å–å…ƒç´ çš„å†…å®¹é«˜åº¦ï¼ˆä¸åŒ…æ‹¬è¾¹æ¡†ï¼‰\n\n\nelement.scrollTop\nè·å–æˆ–è®¾ç½®å…ƒç´ çš„å‚ç›´æ»šåŠ¨ä½ç½®\n\n\nelement.scrollLeft\nè·å–æˆ–è®¾ç½®å…ƒç´ çš„æ°´å¹³æ»šåŠ¨ä½ç½®\n\n\nelement.scrollWidth\nè·å–å…ƒç´ çš„æ€»å®½åº¦ï¼ˆåŒ…æ‹¬ä¸å¯è§éƒ¨åˆ†ï¼‰\n\n\nelement.scrollHeight\nè·å–å…ƒç´ çš„æ€»é«˜åº¦ï¼ˆåŒ…æ‹¬ä¸å¯è§éƒ¨åˆ†ï¼‰\n\n\nelement.dataset\nè·å–å…ƒç´ çš„è‡ªå®šä¹‰æ•°æ®å±æ€§\n\n\n\nå¸¸ç”¨æ–¹æ³•\n\n\n\næ–¹æ³•å\nè¯´æ˜\n\n\n\n\nsetAttribute(name, value)\nè®¾ç½®å…ƒç´ å±æ€§\n\n\ngetAttribute(name)\nè·å–å…ƒç´ å±æ€§å€¼\n\n\nremoveAttribute(name)\nç§»é™¤å…ƒç´ å±æ€§\n\n\nhasAttribute(name)\næ£€æŸ¥å…ƒç´ æ˜¯å¦æœ‰æŒ‡å®šå±æ€§\n\n\nappendChild(child)\næ·»åŠ å­å…ƒç´ åˆ°æœ«å°¾\n\n\ninsertBefore(newChild, refChild)\nåœ¨æŒ‡å®šä½ç½®æ’å…¥å­å…ƒç´ \n\n\nremoveChild(child)\nç§»é™¤å­å…ƒç´ \n\n\nreplaceChild(newChild, oldChild)\næ›¿æ¢å­å…ƒç´ \n\n\ncloneNode(deep)\nå…‹éš†å…ƒç´ èŠ‚ç‚¹\n\n\ncontains(node)\næ£€æŸ¥å…ƒç´ æ˜¯å¦åŒ…å«æŒ‡å®šèŠ‚ç‚¹\n\n\nscrollIntoView(behavior)\næ»šåŠ¨åˆ°è§†å›¾ä¸­\n\n\nfocus()\nä½¿å…ƒç´ è·å¾—ç„¦ç‚¹\n\n\nblur()\nä½¿å…ƒç´ å¤±å»ç„¦ç‚¹\n\n\nclick()\næ¨¡æ‹Ÿç‚¹å‡»å…ƒç´ \n\n\nclassList.add(className)\næ·»åŠ ç±»å\n\n\nclassList.remove(className)\nç§»é™¤ç±»å\n\n\nclassList.toggle(className)\nåˆ‡æ¢ç±»å\n\n\nclassList.contains(className)\næ£€æŸ¥æ˜¯å¦æœ‰ç±»å\n\n\n\nNodeå¯¹è±¡\næ¦‚å¿µï¼šDOMæ ‘ä¸­çš„æ‰€æœ‰èŠ‚ç‚¹éƒ½ç»§æ‰¿è‡ªNodeæ¥å£\nèŠ‚ç‚¹ç±»å‹\n\n\n\nèŠ‚ç‚¹ç±»å‹\nå€¼\nè¯´æ˜\n\n\n\n\nELEMENT_NODE\n1\nå…ƒç´ èŠ‚ç‚¹\n\n\nTEXT_NODE\n3\næ–‡æœ¬èŠ‚ç‚¹\n\n\nCOMMENT_NODE\n8\næ³¨é‡ŠèŠ‚ç‚¹\n\n\nDOCUMENT_NODE\n9\næ–‡æ¡£èŠ‚ç‚¹\n\n\nDOCUMENT_TYPE_NODE\n10\næ–‡æ¡£ç±»å‹èŠ‚ç‚¹\n\n\nDOCUMENT_FRAGMENT_NODE\n11\næ–‡æ¡£ç‰‡æ®µèŠ‚ç‚¹\n\n\n\nå¸¸ç”¨å±æ€§\n\n\n\nå±æ€§å\nè¯´æ˜\n\n\n\n\nnodeType\nèŠ‚ç‚¹ç±»å‹\n\n\nnodeName\nèŠ‚ç‚¹åç§°\n\n\nnodeValue\nèŠ‚ç‚¹å€¼\n\n\nparentNode\nçˆ¶èŠ‚ç‚¹\n\n\nchildNodes\nå­èŠ‚ç‚¹é›†åˆ\n\n\nfirstChild\nç¬¬ä¸€ä¸ªå­èŠ‚ç‚¹\n\n\nlastChild\næœ€åä¸€ä¸ªå­èŠ‚ç‚¹\n\n\npreviousSibling\nå‰ä¸€ä¸ªå…„å¼ŸèŠ‚ç‚¹\n\n\nnextSibling\nåä¸€ä¸ªå…„å¼ŸèŠ‚ç‚¹\n\n\nownerDocument\næ‰€å±æ–‡æ¡£\n\n\ntextContent\næ–‡æœ¬å†…å®¹\n\n\n\nå¸¸ç”¨æ–¹æ³•\n\n\n\næ–¹æ³•å\nè¯´æ˜\n\n\n\n\nappendChild(child)\næ·»åŠ å­èŠ‚ç‚¹\n\n\ninsertBefore(newChild, refChild)\næ’å…¥å­èŠ‚ç‚¹\n\n\nremoveChild(child)\nç§»é™¤å­èŠ‚ç‚¹\n\n\nreplaceChild(newChild, oldChild)\næ›¿æ¢å­èŠ‚ç‚¹\n\n\ncloneNode(deep)\nå…‹éš†èŠ‚ç‚¹\n\n\nnormalize()\nè§„èŒƒåŒ–èŠ‚ç‚¹\n\n\nisEqualNode(node)\næ£€æŸ¥èŠ‚ç‚¹æ˜¯å¦ç›¸ç­‰\n\n\ncontains(node)\næ£€æŸ¥æ˜¯å¦åŒ…å«èŠ‚ç‚¹\n\n\nhasChildNodes()\næ£€æŸ¥æ˜¯å¦æœ‰å­èŠ‚ç‚¹\n\n\n\nDOMäº‹ä»¶å¤„ç†\näº‹ä»¶çº§åˆ«\n\n\nDOM0çº§äº‹ä»¶ï¼šç›´æ¥é€šè¿‡å…ƒç´ å±æ€§ç»‘å®š\n\n\nDOM2çº§äº‹ä»¶ï¼šä½¿ç”¨addEventListenerï¼Œæ”¯æŒäº‹ä»¶æ•è·å’Œå†’æ³¡\n\n\nDOM3çº§äº‹ä»¶ï¼šæ‰©å±•äº†äº‹ä»¶ç±»å‹ï¼Œå¢åŠ äº†æ›´å¤šäº‹ä»¶æ¥å£\n\n\näº‹ä»¶æµé˜¶æ®µ\n\n\næ•è·é˜¶æ®µï¼šäº‹ä»¶ä»æ–‡æ¡£æ ¹èŠ‚ç‚¹å‘ä¸‹ä¼ æ’­åˆ°ç›®æ ‡å…ƒç´ \n\n\nç›®æ ‡é˜¶æ®µï¼šäº‹ä»¶åˆ°è¾¾ç›®æ ‡å…ƒç´ \n\n\nå†’æ³¡é˜¶æ®µï¼šäº‹ä»¶ä»ç›®æ ‡å…ƒç´ å‘ä¸Šä¼ æ’­åˆ°æ–‡æ¡£æ ¹èŠ‚ç‚¹\n\n\nå¸¸ç”¨äº‹ä»¶æ–¹æ³•\n\n\n\næ–¹æ³•å\nè¯´æ˜\n\n\n\n\naddEventListener(type, listener, useCapture)\næ·»åŠ äº‹ä»¶ç›‘å¬å™¨\n\n\nremoveEventListener(type, listener, useCapture)\nç§»é™¤äº‹ä»¶ç›‘å¬å™¨\n\n\ndispatchEvent(event)\næ´¾å‘äº‹ä»¶\n\n\npreventDefault()\né˜»æ­¢äº‹ä»¶é»˜è®¤è¡Œä¸º\n\n\nstopPropagation()\né˜»æ­¢äº‹ä»¶ä¼ æ’­\n\n\nstopImmediatePropagation()\nç«‹å³é˜»æ­¢äº‹ä»¶ä¼ æ’­\n\n\n\nå¸¸è§äº‹ä»¶ç±»å‹\né¼ æ ‡äº‹ä»¶ï¼š\n\n\nclick - é¼ æ ‡ç‚¹å‡»\n\n\ndblclick - é¼ æ ‡åŒå‡»\n\n\nmousedown - é¼ æ ‡æŒ‰ä¸‹\n\n\nmouseup - é¼ æ ‡é‡Šæ”¾\n\n\nmouseover - é¼ æ ‡æ‚¬åœ\n\n\nmouseout - é¼ æ ‡ç¦»å¼€\n\n\nmousemove - é¼ æ ‡ç§»åŠ¨\n\n\nmouseenter - é¼ æ ‡è¿›å…¥\n\n\nmouseleave - é¼ æ ‡ç¦»å¼€\n\n\né”®ç›˜äº‹ä»¶ï¼š\n\n\nkeydown - é”®ç›˜æŒ‰ä¸‹\n\n\nkeyup - é”®ç›˜é‡Šæ”¾\n\n\ninput - è¾“å…¥äº‹ä»¶\n\n\nè¡¨å•äº‹ä»¶ï¼š\n\n\nsubmit - è¡¨å•æäº¤\n\n\nreset - è¡¨å•é‡ç½®\n\n\nchange - å€¼æ”¹å˜\n\n\nfocus - è·å¾—ç„¦ç‚¹\n\n\nblur - å¤±å»ç„¦ç‚¹\n\n\næ–‡æ¡£äº‹ä»¶ï¼š\n\n\nload - é¡µé¢åŠ è½½å®Œæˆ\n\n\nunload - é¡µé¢å¸è½½\n\n\nbeforeunload - é¡µé¢å³å°†å¸è½½\n\n\nDOMContentLoaded - DOMåŠ è½½å®Œæˆ\n\n\nresize - çª—å£å¤§å°æ”¹å˜\n\n\nscroll - é¡µé¢æ»šåŠ¨\n\n\nBOMï¼ˆæµè§ˆå™¨å¯¹è±¡æ¨¡å‹ï¼‰\næ¦‚å¿µä»‹ç»\nBOM (Browser Object Model) æ˜¯æµè§ˆå™¨å¯¹è±¡æ¨¡å‹ï¼Œæä¾›äº†ç‹¬ç«‹äºå†…å®¹çš„ã€å¯ä»¥ä¸æµè§ˆå™¨çª—å£è¿›è¡Œäº’åŠ¨çš„å¯¹è±¡ç»“æ„ã€‚BOMç”±å¤šä¸ªå¯¹è±¡ç»„æˆï¼Œå…¶ä¸­ä»£è¡¨æµè§ˆå™¨çª—å£çš„windowå¯¹è±¡æ˜¯BOMçš„é¡¶å±‚å¯¹è±¡ã€‚\næ ¸å¿ƒç‰¹ç‚¹ï¼š\n\n\nBOMæ²¡æœ‰æ­£å¼çš„æ ‡å‡†ï¼Œä½†æ‰€æœ‰æµè§ˆå™¨éƒ½æ”¯æŒåŸºæœ¬çš„å¯¹è±¡å’Œæ–¹æ³•\n\n\nwindowå¯¹è±¡æ˜¯BOMçš„æ ¸å¿ƒï¼Œä¹Ÿæ˜¯JavaScriptçš„å…¨å±€å¯¹è±¡\n\n\næä¾›äº†æ“ä½œæµè§ˆå™¨çª—å£ã€å¯¼èˆªã€å†å²è®°å½•ç­‰åŠŸèƒ½\n\n\nåŒ…å«DOMçš„documentå¯¹è±¡ä½œä¸ºå…¶å­å¯¹è±¡\n\n\nWindowå¯¹è±¡\næ¦‚å¿µï¼šä»£è¡¨æµè§ˆå™¨çª—å£ï¼Œæ˜¯BOMçš„é¡¶å±‚å¯¹è±¡\nå¸¸ç”¨å±æ€§\n\n\n\nå±æ€§å\nè¯´æ˜\n\n\n\n\nwindow.innerWidth\nè§†å£å®½åº¦\n\n\nwindow.innerHeight\nè§†å£é«˜åº¦\n\n\nwindow.outerWidth\næµè§ˆå™¨çª—å£å®½åº¦\n\n\nwindow.outerHeight\næµè§ˆå™¨çª—å£é«˜åº¦\n\n\nwindow.scrollX\næ°´å¹³æ»šåŠ¨è·ç¦»\n\n\nwindow.scrollY\nå‚ç›´æ»šåŠ¨è·ç¦»\n\n\nwindow.screenX\nçª—å£ç›¸å¯¹äºå±å¹•çš„Xåæ ‡\n\n\nwindow.screenY\nçª—å£ç›¸å¯¹äºå±å¹•çš„Yåæ ‡\n\n\nwindow.closed\næ£€æŸ¥çª—å£æ˜¯å¦å…³é—­\n\n\nwindow.frames\nè·å–çª—å£ä¸­çš„æ¡†æ¶é›†åˆ\n\n\nwindow.parent\nè·å–çˆ¶çª—å£\n\n\nwindow.top\nè·å–é¡¶çº§çª—å£\n\n\nwindow.self\nè·å–å½“å‰çª—å£\n\n\nwindow.name\nè·å–æˆ–è®¾ç½®çª—å£åç§°\n\n\nwindow.location\nè·å–ä½ç½®å¯¹è±¡\n\n\nwindow.history\nè·å–å†å²å¯¹è±¡\n\n\nwindow.navigator\nè·å–å¯¼èˆªå¯¹è±¡\n\n\nwindow.screen\nè·å–å±å¹•å¯¹è±¡\n\n\nwindow.document\nè·å–æ–‡æ¡£å¯¹è±¡\n\n\nwindow.localStorage\nè·å–æœ¬åœ°å­˜å‚¨\n\n\nwindow.sessionStorage\nè·å–ä¼šè¯å­˜å‚¨\n\n\nwindow.console\nè·å–æ§åˆ¶å°å¯¹è±¡\n\n\n\nå¸¸ç”¨æ–¹æ³•\n\n\n\næ–¹æ³•å\nè¯´æ˜\n\n\n\n\nalert(message)\næ˜¾ç¤ºè­¦å‘Šæ¡†\n\n\nconfirm(message)\næ˜¾ç¤ºç¡®è®¤æ¡†\n\n\nprompt(message, defaultText)\næ˜¾ç¤ºè¾“å…¥æ¡†\n\n\nopen(url, name, features)\næ‰“å¼€æ–°çª—å£\n\n\nclose()\nå…³é—­çª—å£\n\n\nfocus()\nä½¿çª—å£è·å¾—ç„¦ç‚¹\n\n\nblur()\nä½¿çª—å£å¤±å»ç„¦ç‚¹\n\n\nprint()\næ‰“å°çª—å£å†…å®¹\n\n\nscrollTo(x, y)\næ»šåŠ¨åˆ°æŒ‡å®šä½ç½®\n\n\nscrollBy(x, y)\nç›¸å¯¹æ»šåŠ¨\n\n\nresizeTo(width, height)\nè°ƒæ•´çª—å£å¤§å°\n\n\nresizeBy(width, height)\nç›¸å¯¹è°ƒæ•´çª—å£å¤§å°\n\n\nsetTimeout(callback, delay)\nè®¾ç½®è¶…æ—¶å™¨\n\n\nsetInterval(callback, interval)\nè®¾ç½®å®šæ—¶å™¨\n\n\nclearTimeout(timeoutId)\næ¸…é™¤è¶…æ—¶å™¨\n\n\nclearInterval(intervalId)\næ¸…é™¤å®šæ—¶å™¨\n\n\nrequestAnimationFrame(callback)\nè¯·æ±‚åŠ¨ç”»å¸§\n\n\ncancelAnimationFrame(requestId)\nå–æ¶ˆåŠ¨ç”»å¸§\n\n\nbtoa(string)\nBase64ç¼–ç \n\n\natob(string)\nBase64è§£ç \n\n\nencodeURI(uri)\nç¼–ç URI\n\n\ndecodeURI(uri)\nè§£ç URI\n\n\nencodeURIComponent(uriComponent)\nç¼–ç URIç»„ä»¶\n\n\ndecodeURIComponent(uriComponent)\nè§£ç URIç»„ä»¶\n\n\n\nLocationå¯¹è±¡\næ¦‚å¿µï¼šåŒ…å«æœ‰å…³å½“å‰URLçš„ä¿¡æ¯\nå¸¸ç”¨å±æ€§\n\n\n\nå±æ€§å\nè¯´æ˜\n\n\n\n\nlocation.href\nå®Œæ•´URL\n\n\nlocation.protocol\nåè®®ï¼ˆhttp:æˆ–https:ï¼‰\n\n\nlocation.host\nä¸»æœºåå’Œç«¯å£\n\n\nlocation.hostname\nä¸»æœºå\n\n\nlocation.port\nç«¯å£å·\n\n\nlocation.pathname\nè·¯å¾„éƒ¨åˆ†\n\n\nlocation.search\næŸ¥è¯¢å­—ç¬¦ä¸²\n\n\nlocation.hash\nå“ˆå¸Œå€¼\n\n\nlocation.origin\næºï¼ˆåè®®+ä¸»æœºå+ç«¯å£ï¼‰\n\n\n\nå¸¸ç”¨æ–¹æ³•\n\n\n\næ–¹æ³•å\nè¯´æ˜\n\n\n\n\nassign(url)\nè·³è½¬åˆ°æŒ‡å®šURL\n\n\nreplace(url)\næ›¿æ¢å½“å‰URL\n\n\nreload(forceGet)\né‡æ–°åŠ è½½é¡µé¢\n\n\ntoString()\nè¿”å›å®Œæ•´URLå­—ç¬¦ä¸²\n\n\n\nHistoryå¯¹è±¡\næ¦‚å¿µï¼šåŒ…å«æµè§ˆå™¨çš„å†å²è®°å½•\nå¸¸ç”¨å±æ€§\n\n\n\nå±æ€§å\nè¯´æ˜\n\n\n\n\nhistory.length\nå†å²è®°å½•æ•°é‡\n\n\nhistory.state\nå½“å‰å†å²çŠ¶æ€\n\n\nhistory.scrollRestoration\næ»šåŠ¨æ¢å¤æ¨¡å¼\n\n\n\nå¸¸ç”¨æ–¹æ³•\n\n\n\næ–¹æ³•å\nè¯´æ˜\n\n\n\n\nback()\nè¿”å›ä¸Šä¸€é¡µ\n\n\nforward()\nå‰è¿›åˆ°ä¸‹ä¸€é¡µ\n\n\ngo(delta)\nè·³è½¬åˆ°æŒ‡å®šé¡µé¢\n\n\npushState(state, title, url)\næ·»åŠ å†å²è®°å½•\n\n\nreplaceState(state, title, url)\næ›¿æ¢å½“å‰å†å²è®°å½•\n\n\n\nNavigatorå¯¹è±¡\næ¦‚å¿µï¼šåŒ…å«æµè§ˆå™¨çš„ç›¸å…³ä¿¡æ¯\nå¸¸ç”¨å±æ€§\n\n\n\nå±æ€§å\nè¯´æ˜\n\n\n\n\nnavigator.userAgent\nç”¨æˆ·ä»£ç†å­—ç¬¦ä¸²\n\n\nnavigator.appName\næµè§ˆå™¨åç§°\n\n\nnavigator.appVersion\næµè§ˆå™¨ç‰ˆæœ¬\n\n\nnavigator.platform\næ“ä½œç³»ç»Ÿå¹³å°\n\n\nnavigator.language\næµè§ˆå™¨è¯­è¨€\n\n\nnavigator.onLine\næ˜¯å¦åœ¨çº¿\n\n\nnavigator.cookieEnabled\næ˜¯å¦å¯ç”¨cookie\n\n\nnavigator.geolocation\nåœ°ç†ä½ç½®æ¥å£\n\n\nnavigator.mediaDevices\nåª’ä½“è®¾å¤‡æ¥å£\n\n\nnavigator.hardwareConcurrency\nCPUæ ¸å¿ƒæ•°\n\n\nnavigator.deviceMemory\nè®¾å¤‡å†…å­˜\n\n\n\nScreenå¯¹è±¡\næ¦‚å¿µï¼šåŒ…å«å±å¹•çš„ç›¸å…³ä¿¡æ¯\nå¸¸ç”¨å±æ€§\n\n\n\nå±æ€§å\nè¯´æ˜\n\n\n\n\nscreen.width\nå±å¹•å®½åº¦\n\n\nscreen.height\nå±å¹•é«˜åº¦\n\n\nscreen.availWidth\nå¯ç”¨å±å¹•å®½åº¦\n\n\nscreen.availHeight\nå¯ç”¨å±å¹•é«˜åº¦\n\n\nscreen.colorDepth\né¢œè‰²æ·±åº¦\n\n\nscreen.pixelDepth\nåƒç´ æ·±åº¦\n\n\nscreen.orientation\nå±å¹•æ–¹å‘\n\n\n\nStorageå¯¹è±¡\næ¦‚å¿µï¼šæä¾›æœ¬åœ°å­˜å‚¨åŠŸèƒ½\nå­˜å‚¨ç±»å‹\n\n\nlocalStorageï¼šæ°¸ä¹…å­˜å‚¨ï¼Œæ— è¿‡æœŸæ—¶é—´ï¼Œå®¹é‡çº¦5MB\n\n\nsessionStorageï¼šä¼šè¯å­˜å‚¨ï¼Œå…³é—­é¡µé¢åæ¸…é™¤ï¼Œå®¹é‡çº¦5MB\n\n\nå¸¸ç”¨æ–¹æ³•\n\n\n\næ–¹æ³•å\nè¯´æ˜\n\n\n\n\nsetItem(key, value)\nè®¾ç½®å­˜å‚¨é¡¹\n\n\ngetItem(key)\nè·å–å­˜å‚¨é¡¹\n\n\nremoveItem(key)\nç§»é™¤å­˜å‚¨é¡¹\n\n\nclear()\næ¸…é™¤æ‰€æœ‰å­˜å‚¨é¡¹\n\n\nkey(index)\nè·å–æŒ‡å®šç´¢å¼•çš„é”®å\n\n\n\nå®é™…ä½¿ç”¨ç¤ºä¾‹\nDOMæ“ä½œç¤ºä¾‹\nå…ƒç´ é€‰æ‹©å’Œæ“ä½œ\n// è·å–å…ƒç´ const element = document.getElementById(&#x27;myElement&#x27;);const elements = document.querySelectorAll(&#x27;.myClass&#x27;);const firstDiv = document.querySelector(&#x27;div&#x27;);// ä¿®æ”¹å†…å®¹element.textContent = &#x27;æ–°çš„æ–‡æœ¬å†…å®¹&#x27;;element.innerHTML = &#x27;&lt;strong&gt;åŠ ç²—æ–‡æœ¬&lt;/strong&gt;&#x27;;// ä¿®æ”¹æ ·å¼element.style.color = &#x27;red&#x27;;element.style.fontSize = &#x27;16px&#x27;;element.classList.add(&#x27;active&#x27;);element.classList.remove(&#x27;inactive&#x27;);element.classList.toggle(&#x27;visible&#x27;);// ä¿®æ”¹å±æ€§element.setAttribute(&#x27;src&#x27;, &#x27;image.jpg&#x27;);element.getAttribute(&#x27;href&#x27;);element.removeAttribute(&#x27;disabled&#x27;);\nåˆ›å»ºå’Œæ’å…¥å…ƒç´ \n// åˆ›å»ºå…ƒç´ const newDiv = document.createElement(&#x27;div&#x27;);newDiv.textContent = &#x27;æ–°åˆ›å»ºçš„å…ƒç´ &#x27;;newDiv.className = &#x27;new-element&#x27;;// æ’å…¥å…ƒç´ const container = document.getElementById(&#x27;container&#x27;);container.appendChild(newDiv);// åœ¨æŒ‡å®šä½ç½®æ’å…¥const referenceElement = document.getElementById(&#x27;reference&#x27;);container.insertBefore(newDiv, referenceElement);// ä½¿ç”¨æ–‡æ¡£ç‰‡æ®µæ‰¹é‡æ’å…¥const fragment = document.createDocumentFragment();for (let i = 0; i &lt; 10; i++) &#123;    const item = document.createElement(&#x27;div&#x27;);    item.textContent = `é¡¹ç›® $&#123;i + 1&#125;`;    fragment.appendChild(item);&#125;container.appendChild(fragment);\näº‹ä»¶å¤„ç†\n// DOM0çº§äº‹ä»¶const button = document.getElementById(&#x27;myButton&#x27;);button.onclick = function() &#123;    alert(&#x27;æŒ‰é’®è¢«ç‚¹å‡»äº†ï¼&#x27;);&#125;;// DOM2çº§äº‹ä»¶button.addEventListener(&#x27;click&#x27;, function(event) &#123;    console.log(&#x27;äº‹ä»¶ç±»å‹:&#x27;, event.type);    console.log(&#x27;ç›®æ ‡å…ƒç´ :&#x27;, event.target);        // é˜»æ­¢é»˜è®¤è¡Œä¸º    event.preventDefault();        // é˜»æ­¢äº‹ä»¶ä¼ æ’­    event.stopPropagation();&#125;);// äº‹ä»¶å§”æ‰˜document.getElementById(&#x27;list&#x27;).addEventListener(&#x27;click&#x27;, function(event) &#123;    if (event.target.tagName === &#x27;LI&#x27;) &#123;        console.log(&#x27;åˆ—è¡¨é¡¹è¢«ç‚¹å‡»:&#x27;, event.target.textContent);    &#125;&#125;);\nBOMæ“ä½œç¤ºä¾‹\nçª—å£æ“ä½œ\n// çª—å£ä¿¡æ¯console.log(&#x27;çª—å£å®½åº¦:&#x27;, window.innerWidth);console.log(&#x27;çª—å£é«˜åº¦:&#x27;, window.innerHeight);console.log(&#x27;æ»šåŠ¨ä½ç½®:&#x27;, window.scrollX, window.scrollY);// æ»šåŠ¨æ“ä½œwindow.scrollTo(0, 100); // æ»šåŠ¨åˆ°æŒ‡å®šä½ç½®window.scrollBy(0, 50);  // ç›¸å¯¹æ»šåŠ¨window.scrollTo(&#123;    top: 100,    left: 0,    behavior: &#x27;smooth&#x27; // å¹³æ»‘æ»šåŠ¨&#125;);// å¼¹å‡ºæ¡†alert(&#x27;è¿™æ˜¯ä¸€ä¸ªè­¦å‘Šæ¡†&#x27;);const result = confirm(&#x27;ç¡®å®šè¦åˆ é™¤å—ï¼Ÿ&#x27;);const name = prompt(&#x27;è¯·è¾“å…¥æ‚¨çš„å§“å:&#x27;, &#x27;å¼ ä¸‰&#x27;);// æ‰“å¼€å’Œå…³é—­çª—å£const newWindow = window.open(&#x27;https://www.example.com&#x27;, &#x27;_blank&#x27;, &#x27;width=800,height=600&#x27;);newWindow.close();\nä½ç½®å’Œå¯¼èˆª\n// ä½ç½®ä¿¡æ¯console.log(&#x27;å½“å‰URL:&#x27;, location.href);console.log(&#x27;åè®®:&#x27;, location.protocol);console.log(&#x27;ä¸»æœºå:&#x27;, location.hostname);console.log(&#x27;è·¯å¾„:&#x27;, location.pathname);console.log(&#x27;æŸ¥è¯¢å‚æ•°:&#x27;, location.search);// å¯¼èˆªæ“ä½œlocation.href = &#x27;https://www.example.com&#x27;; // è·³è½¬location.assign(&#x27;https://www.example.com&#x27;); // è·³è½¬location.replace(&#x27;https://www.example.com&#x27;); // æ›¿æ¢å½“å‰é¡µé¢location.reload(); // åˆ·æ–°é¡µé¢location.reload(true); // å¼ºåˆ¶åˆ·æ–°// è§£ææŸ¥è¯¢å‚æ•°function getQueryParams() &#123;    const params = new URLSearchParams(location.search);    const result = &#123;&#125;;    for (const [key, value] of params) &#123;        result[key] = value;    &#125;    return result;&#125;\nå†å²è®°å½•\n// å†å²è®°å½•æ“ä½œconsole.log(&#x27;å†å²è®°å½•æ•°é‡:&#x27;, history.length);history.back(); // è¿”å›ä¸Šä¸€é¡µhistory.forward(); // å‰è¿›åˆ°ä¸‹ä¸€é¡µhistory.go(-2); // è¿”å›å‰ä¸¤é¡µ// HTML5 History APIhistory.pushState(&#123;page: 1&#125;, &#x27;é¡µé¢ 1&#x27;, &#x27;?page=1&#x27;);history.replaceState(&#123;page: 2&#125;, &#x27;é¡µé¢ 2&#x27;, &#x27;?page=2&#x27;);// ç›‘å¬å†å²çŠ¶æ€å˜åŒ–window.addEventListener(&#x27;popstate&#x27;, function(event) &#123;    console.log(&#x27;å†å²çŠ¶æ€å˜åŒ–:&#x27;, event.state);&#125;);\næœ¬åœ°å­˜å‚¨\n// localStoragelocalStorage.setItem(&#x27;username&#x27;, &#x27;å¼ ä¸‰&#x27;);localStorage.setItem(&#x27;settings&#x27;, JSON.stringify(&#123;theme: &#x27;dark&#x27;&#125;));const username = localStorage.getItem(&#x27;username&#x27;);const settings = JSON.parse(localStorage.getItem(&#x27;settings&#x27;));localStorage.removeItem(&#x27;username&#x27;);// localStorage.clear();// sessionStoragesessionStorage.setItem(&#x27;tempData&#x27;, &#x27;ä¸´æ—¶æ•°æ®&#x27;);const tempData = sessionStorage.getItem(&#x27;tempData&#x27;);// ç›‘å¬å­˜å‚¨å˜åŒ–window.addEventListener(&#x27;storage&#x27;, function(event) &#123;    console.log(&#x27;å­˜å‚¨å˜åŒ–:&#x27;, event.key, event.newValue);&#125;);\n","categories":["ç¼–ç¨‹"],"tags":["web"]},{"title":"Piniaå­¦ä¹ ç¬”è®°","url":"/2025/10/10/web/Pinia%20%E7%9F%A5%E8%AF%86%E7%82%B9%E6%95%B4%E7%90%86/","content":"\nå¦‚é¢˜ï¼Œç»“åˆå®˜æ–¹æ–‡æ¡£ä¸ç½‘ç»œå¸–å­ï¼Œåˆ©ç”¨AIæ•´ç†\n\n\nPinia çŸ¥è¯†ç‚¹æ•´ç†ï¼šä»åŸºç¡€åˆ°è¿›é˜¶\nç›®å½•\n\n\nç®€ä»‹\n\n\nå®‰è£…å’ŒåŸºæœ¬é…ç½®\n\n\næ ¸å¿ƒæ¦‚å¿µ\n\n\nåŸºç¡€ç”¨æ³•\n\n\nè¿›é˜¶ç”¨æ³•\n\n\næ’ä»¶ç³»ç»Ÿ\n\n\nTypeScript æ”¯æŒ\n\n\næœ€ä½³å®è·µ\n\n\nä¸ Vuex çš„å¯¹æ¯”\n\n\næ€»ç»“\n\n\nç®€ä»‹\nä»€ä¹ˆæ˜¯ Piniaï¼Ÿ\nPinia æ˜¯ Vue.js çš„ä¸“å±çŠ¶æ€ç®¡ç†åº“ï¼Œå®ƒå…è®¸ä½ è·¨ç»„ä»¶æˆ–é¡µé¢å…±äº«çŠ¶æ€ã€‚Pinia èµ·å§‹äº 2019 å¹´ 11 æœˆçš„ä¸€æ¬¡å®éªŒï¼Œå…¶ç›®çš„æ˜¯è®¾è®¡ä¸€ä¸ªæ‹¥æœ‰ç»„åˆå¼ API çš„ Vue çŠ¶æ€ç®¡ç†åº“ã€‚\nä¸ºä»€ä¹ˆé€‰æ‹© Piniaï¼Ÿ\nPinia ç›¸æ¯”ä¼ ç»Ÿçš„çŠ¶æ€ç®¡ç†æ–¹æ¡ˆå…·æœ‰ä»¥ä¸‹ä¼˜åŠ¿ï¼š\n\n\nTypeScript æ”¯æŒï¼šåŸç”Ÿæ”¯æŒ TypeScriptï¼Œæä¾›å®Œå–„çš„ç±»å‹æ¨æ–­\n\n\nç®€æ´çš„ APIï¼šæ¯” Vuex æ›´ç®€æ´ï¼Œå‡å°‘äº†æ ·æ¿ä»£ç \n\n\nç»„åˆå¼ APIï¼šæ”¯æŒ Vue 3 çš„ç»„åˆå¼ API é£æ ¼\n\n\nDevTools æ”¯æŒï¼šå®Œæ•´çš„ DevTools é›†æˆï¼Œæ”¯æŒæ—¶é—´æ—…è¡Œè°ƒè¯•\n\n\næ’ä»¶ç³»ç»Ÿï¼šå¼ºå¤§çš„æ’ä»¶ç³»ç»Ÿï¼Œå¯ä»¥æ‰©å±• Pinia çš„åŠŸèƒ½\n\n\næœåŠ¡ç«¯æ¸²æŸ“æ”¯æŒï¼šåŸç”Ÿæ”¯æŒæœåŠ¡ç«¯æ¸²æŸ“\n\n\nçƒ­æ›´æ–°ï¼šå¼€å‘æ—¶æ— éœ€é‡è½½é¡µé¢å³å¯ä¿®æ”¹ Store\n\n\næ ¸å¿ƒç‰¹æ€§\nPinia çš„æ ¸å¿ƒæ¦‚å¿µåŒ…æ‹¬ï¼š\n\n\nStoreï¼šå­˜å‚¨åº”ç”¨çŠ¶æ€çš„å®¹å™¨\n\n\nStateï¼šå­˜å‚¨å…·ä½“çŠ¶æ€æ•°æ®\n\n\nGettersï¼šè®¡ç®—å±æ€§ï¼Œç”¨äºæ´¾ç”ŸçŠ¶æ€\n\n\nActionsï¼šç”¨äºä¿®æ”¹çŠ¶æ€çš„æ–¹æ³•ï¼Œå¯ä»¥æ˜¯åŒæ­¥æˆ–å¼‚æ­¥\n\n\nå®‰è£…å’ŒåŸºæœ¬é…ç½®\nå®‰è£… Pinia\nä½¿ç”¨ npm æˆ– yarn å®‰è£… Piniaï¼š\n# npmnpm install pinia# yarnyarn add pinia# pnpmpnpm add pinia# bunbun add pinia\nVue 2 å…¼å®¹æ€§\nå¦‚æœä½¿ç”¨ Vue 2ï¼Œè¿˜éœ€è¦å®‰è£… composition-apiï¼š\nnpm install pinia @vue/composition-api\nåŸºæœ¬é…ç½®\nåœ¨ main.ts ä¸­åˆå§‹åŒ– Piniaï¼š\n// src/main.tsimport &#123; createApp &#125; from &#x27;vue&#x27;import &#123; createPinia &#125; from &#x27;pinia&#x27;import App from &#x27;./App.vue&#x27;const app = createApp(App)const pinia = createPinia()app.use(pinia)app.mount(&#x27;#app&#x27;)\næ ¸å¿ƒæ¦‚å¿µ\nStore\nStore æ˜¯ Pinia çš„æ ¸å¿ƒæ¦‚å¿µï¼Œæ¯ä¸ª Store éƒ½æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„æ¨¡å—ï¼š\n// src/stores/counter.tsimport &#123; defineStore &#125; from &#x27;pinia&#x27;// ç»„åˆå¼è¯­æ³•ï¼ˆæ¨èï¼‰export const useCounterStore = defineStore(&#x27;counter&#x27;, () =&gt; &#123;  const count = ref(0)  const name = ref(&#x27;Pinia&#x27;)    const doubleCount = computed(() =&gt; count.value * 2)    function increment() &#123;    count.value++  &#125;    async function fetchData() &#123;    const data = await fetch(&#x27;/api/data&#x27;)    name.value = data.name  &#125;    return &#123; count, name, doubleCount, increment, fetchData &#125;&#125;)\nState\nState æ˜¯å­˜å‚¨åº”ç”¨çŠ¶æ€çš„åœ°æ–¹ï¼Œç›¸å½“äºç»„ä»¶ä¸­çš„ dataï¼š\n// ç»„åˆå¼const count = ref(0)const user = ref(null)const todos = ref([])\nGetters\nGetters æ˜¯è®¡ç®—å±æ€§ï¼Œç”¨äºä» State ä¸­æ´¾ç”Ÿå‡ºæ–°çš„çŠ¶æ€ï¼š\n// ç»„åˆå¼const doubleCount = computed(() =&gt; count.value * 2)const doublePlusOne = computed(() =&gt; doubleCount.value + 1)\nActions\nActions ç”¨äºä¿®æ”¹çŠ¶æ€ï¼Œå¯ä»¥æ˜¯åŒæ­¥æˆ–å¼‚æ­¥çš„ï¼š\n// ç»„åˆå¼function increment() &#123;  count.value++&#125;async function fetchUser() &#123;  const response = await fetch(&#x27;/api/user&#x27;)  user.value = await response.json()&#125;\nåŸºç¡€ç”¨æ³•\nåœ¨ç»„ä»¶ä¸­ä½¿ç”¨ Store\n&lt;!-- src/components/Counter.vue --&gt;&lt;template&gt;  &lt;div&gt;    &lt;h2&gt;&#123;&#123; counterStore.name &#125;&#125;&lt;/h2&gt;    &lt;p&gt;Count: &#123;&#123; counterStore.count &#125;&#125;&lt;/p&gt;    &lt;p&gt;Double Count: &#123;&#123; counterStore.doubleCount &#125;&#125;&lt;/p&gt;    &lt;button @click=&quot;counterStore.increment&quot;&gt;Increment&lt;/button&gt;    &lt;button @click=&quot;counterStore.fetchData&quot;&gt;Fetch Data&lt;/button&gt;  &lt;/div&gt;&lt;/template&gt;&lt;script setup lang=&quot;ts&quot;&gt;import &#123; useCounterStore &#125; from &#x27;@/stores/counter&#x27;const counterStore = useCounterStore()&lt;/script&gt;\nè§£æ„ Store\nç›´æ¥è§£æ„ä¼šå¤±å»å“åº”æ€§ï¼Œéœ€è¦ä½¿ç”¨ storeToRefsï¼š\n&lt;script setup lang=&quot;ts&quot;&gt;import &#123; storeToRefs &#125; from &#x27;pinia&#x27;import &#123; useCounterStore &#125; from &#x27;@/stores/counter&#x27;const counterStore = useCounterStore()// ä¿æŒå“åº”æ€§const &#123; count, doubleCount &#125; = storeToRefs(counterStore)// æ–¹æ³•å¯ä»¥ç›´æ¥è§£æ„const &#123; increment, fetchData &#125; = counterStore&lt;/script&gt;\nä¿®æ”¹ State\næœ‰å¤šç§æ–¹å¼å¯ä»¥ä¿®æ”¹ Stateï¼š\n&lt;script setup lang=&quot;ts&quot;&gt;import &#123; useCounterStore &#125; from &#x27;@/stores/counter&#x27;const counterStore = useCounterStore()// 1. ç›´æ¥ä¿®æ”¹counterStore.count++// 2. ä½¿ç”¨ $patch æ‰¹é‡ä¿®æ”¹counterStore.$patch(&#123;  count: counterStore.count + 1,  name: &#x27;New Name&#x27;&#125;)// 3. ä½¿ç”¨ $patch å‡½æ•°å½¢å¼ï¼ˆæ¨èç”¨äºå¤æ‚ä¿®æ”¹ï¼‰counterStore.$patch((state) =&gt; &#123;  state.count++  state.todos.push(&#123; id: 1, text: &#x27;Learn Pinia&#x27; &#125;)&#125;)// 4. ä½¿ç”¨ actionsï¼ˆæ¨èï¼‰counterStore.increment()&lt;/script&gt;\nè¿›é˜¶ç”¨æ³•\nç›‘å¬ State å˜åŒ–\nä½¿ç”¨ $subscribe ç›‘å¬çŠ¶æ€å˜åŒ–ï¼š\n&lt;script setup lang=&quot;ts&quot;&gt;import &#123; useCounterStore &#125; from &#x27;@/stores/counter&#x27;const counterStore = useCounterStore()// ç›‘å¬å•ä¸ª storeconst unsubscribe = counterStore.$subscribe((mutation, state) =&gt; &#123;  console.log(&#x27;State changed:&#x27;, mutation, state)  // æŒä¹…åŒ–åˆ°æœ¬åœ°å­˜å‚¨  localStorage.setItem(&#x27;counter&#x27;, JSON.stringify(state))&#125;)// ç›‘å¬æ‰€æœ‰ storeconst pinia = usePinia()pinia.use((&#123; store &#125;) =&gt; &#123;  store.$subscribe((mutation, state) =&gt; &#123;    console.log(`Store $&#123;store.$id&#125; changed`)  &#125;)&#125;)// åœæ­¢ç›‘å¬// unsubscribe()&lt;/script&gt;\nGetter é«˜çº§ç”¨æ³•\nè®¿é—®å…¶ä»– Store\n// src/stores/user.tsimport &#123; defineStore &#125; from &#x27;pinia&#x27;import &#123; useCounterStore &#125; from &#x27;./counter&#x27;export const useUserStore = defineStore(&#x27;user&#x27;, &#123;  state: () =&gt; (&#123;    userId: 1  &#125;),  getters: &#123;    // è®¿é—®å…¶ä»– store    userWithCount: (state) =&gt; &#123;      const counterStore = useCounterStore()      return &#123;        userId: state.userId,        count: counterStore.count      &#125;    &#125;  &#125;&#125;)\nGetter å‚æ•°åŒ–\n// ç»„åˆå¼const getUserById = computed(() =&gt; &#123;  return (userId: number) =&gt; users.value.find(user =&gt; user.id === userId)&#125;)// åœ¨ç»„ä»¶ä¸­ä½¿ç”¨const user = userStore.getUserById(1)\nAction é«˜çº§ç”¨æ³•\nå¼‚æ­¥ Actions\n// src/stores/user.tsexport const useUserStore = defineStore(&#x27;user&#x27;, &#123;  state: () =&gt; (&#123;    users: [],    loading: false,    error: null  &#125;),  actions: &#123;    async fetchUsers() &#123;      this.loading = true      this.error = null      try &#123;        const response = await fetch(&#x27;/api/users&#x27;)        this.users = await response.json()      &#125; catch (error) &#123;        this.error = error.message      &#125; finally &#123;        this.loading = false      &#125;    &#125;,    async addUser(userData) &#123;      const response = await fetch(&#x27;/api/users&#x27;, &#123;        method: &#x27;POST&#x27;,        body: JSON.stringify(userData)      &#125;)      const newUser = await response.json()      this.users.push(newUser)      return newUser    &#125;  &#125;&#125;)\nAction é—´çš„è°ƒç”¨\nactions: &#123;  async fetchAndProcessData() &#123;    // è°ƒç”¨å…¶ä»– action    await this.fetchUsers()    this.processUserData()  &#125;,  processUserData() &#123;    // å¤„ç†ç”¨æˆ·æ•°æ®    this.users = this.users.map(user =&gt; (&#123;      ...user,      fullName: `$&#123;user.firstName&#125; $&#123;user.lastName&#125;`    &#125;))  &#125;&#125;\næ’ä»¶ç³»ç»Ÿ\nè‡ªå®šä¹‰æ’ä»¶\n// src/plugins/pinia-logger.tsexport function piniaLogger() &#123;  return (context) =&gt; &#123;    const &#123; store &#125; = context        // ç›‘å¬ action è°ƒç”¨    store.$onAction((&#123; name, args, after, onError &#125;) =&gt; &#123;      console.log(`[Pinia Logger] Action &quot;$&#123;name&#125;&quot; started with args:`, args)            after((result) =&gt; &#123;        console.log(`[Pinia Logger] Action &quot;$&#123;name&#125;&quot; succeeded with result:`, result)      &#125;)            onError((error) =&gt; &#123;        console.error(`[Pinia Logger] Action &quot;$&#123;name&#125;&quot; failed with error:`, error)      &#125;)    &#125;)        // ç›‘å¬ state å˜åŒ–    store.$subscribe((mutation) =&gt; &#123;      console.log(`[Pinia Logger] State changed in store &quot;$&#123;store.$id&#125;&quot;:`, mutation)    &#125;)  &#125;&#125;\nä½¿ç”¨æ’ä»¶\n// src/main.tsimport &#123; createPinia &#125; from &#x27;pinia&#x27;import &#123; piniaLogger &#125; from &#x27;./plugins/pinia-logger&#x27;const pinia = createPinia()pinia.use(piniaLogger())\nçŠ¶æ€æŒä¹…åŒ–æ’ä»¶\nä½¿ç”¨ pinia-plugin-persistedstate å®ç°çŠ¶æ€æŒä¹…åŒ–ï¼š\nnpm install pinia-plugin-persistedstate// src/main.tsimport &#123; createPinia &#125; from &#x27;pinia&#x27;import piniaPluginPersist from &#x27;pinia-plugin-persistedstate&#x27;const pinia = createPinia()pinia.use(piniaPluginPersist)// src/stores/user.tsexport const useUserStore = defineStore(&#x27;user&#x27;, &#123;  state: () =&gt; (&#123;    token: &#x27;&#x27;,    userInfo: null  &#125;),  // é…ç½®æŒä¹…åŒ–  persist: &#123;    enabled: true,    strategies: [      &#123;        key: &#x27;user-store&#x27;,        storage: localStorage,        paths: [&#x27;token&#x27;, &#x27;userInfo&#x27;]      &#125;    ]  &#125;&#125;)\nTypeScript æ”¯æŒ\nç±»å‹å®šä¹‰\n// src/types/index.tsinterface User &#123;  id: number  name: string  email: string&#125;interface CounterState &#123;  count: number  name: string  user: User | null&#125;// src/stores/counter.tsimport &#123; defineStore &#125; from &#x27;pinia&#x27;import type &#123; CounterState &#125; from &#x27;@/types&#x27;export const useCounterStore = defineStore(&#x27;counter&#x27;, &#123;  state: (): CounterState =&gt; (&#123;    count: 0,    name: &#x27;Pinia&#x27;,    user: null  &#125;),  getters: &#123;    userName: (state): string =&gt; state.user?.name || &#x27;Guest&#x27;  &#125;,  actions: &#123;    setUser(user: User | null) &#123;      this.user = user    &#125;  &#125;&#125;)\nç»„åˆå¼ API ç±»å‹\n// src/stores/user.tsimport &#123; defineStore &#125; from &#x27;pinia&#x27;import &#123; ref, computed &#125; from &#x27;vue&#x27;import type &#123; User &#125; from &#x27;@/types&#x27;export const useUserStore = defineStore(&#x27;user&#x27;, () =&gt; &#123;  const users = ref&lt;User[]&gt;([])  const loading = ref(false)    const userCount = computed(() =&gt; users.value.length)  const activeUsers = computed(() =&gt;     users.value.filter(user =&gt; user.active)  )    const fetchUsers = async (): Promise&lt;void&gt; =&gt; &#123;    loading.value = true    const response = await fetch(&#x27;/api/users&#x27;)    users.value = await response.json()    loading.value = false  &#125;    const addUser = (user: Omit&lt;User, &#x27;id&#x27;&gt;): void =&gt; &#123;    const newUser = &#123; ...user, id: Date.now() &#125;    users.value.push(newUser)  &#125;    return &#123;    users,    loading,    userCount,    activeUsers,    fetchUsers,    addUser  &#125;&#125;)\næœ€ä½³å®è·µ\né¡¹ç›®ç»“æ„\næ¨èçš„é¡¹ç›®ç»“æ„ï¼š\nsrc/â”œâ”€â”€ stores/â”‚   â”œâ”€â”€ index.ts           # Pinia å®ä¾‹â”‚   â”œâ”€â”€ modules/â”‚   â”‚   â”œâ”€â”€ system/        # ç³»ç»Ÿçº§çŠ¶æ€â”‚   â”‚   â”‚   â”œâ”€â”€ app.ts     # åº”ç”¨é…ç½®â”‚   â”‚   â”‚   â”œâ”€â”€ user.ts    # ç”¨æˆ·ä¿¡æ¯â”‚   â”‚   â”‚   â””â”€â”€ permission.ts # æƒé™ç®¡ç†â”‚   â”‚   â””â”€â”€ business/      # ä¸šåŠ¡æ¨¡å—â”‚   â”‚       â”œâ”€â”€ cart.ts    # è´­ç‰©è½¦â”‚   â”‚       â””â”€â”€ product.ts # äº§å“ç®¡ç†â””â”€â”€ types/                 # ç±»å‹å®šä¹‰    â””â”€â”€ index.ts\næ¨¡å—åŒ–è®¾è®¡\n// src/stores/index.tsexport * from &#x27;./modules/system/app&#x27;export * from &#x27;./modules/system/user&#x27;export * from &#x27;./modules/system/permission&#x27;export * from &#x27;./modules/business/cart&#x27;export * from &#x27;./modules/business/product&#x27;\nçŠ¶æ€è®¾è®¡åŸåˆ™\n\n\nå•ä¸€èŒè´£ï¼šæ¯ä¸ª Store åº”è¯¥ä¸“æ³¨äºä¸€ä¸ªç‰¹å®šçš„ä¸šåŠ¡é¢†åŸŸ\n\n\næœ€å°çŠ¶æ€ï¼šåªå­˜å‚¨å¿…è¦çš„çŠ¶æ€ï¼Œé¿å…å­˜å‚¨å¯ä»¥è®¡ç®—å¾—å‡ºçš„æ•°æ®\n\n\nä¸å¯å˜æ€§ï¼šè™½ç„¶ Pinia å…è®¸ç›´æ¥ä¿®æ”¹çŠ¶æ€ï¼Œä½†å¤æ‚å¯¹è±¡å»ºè®®ä½¿ç”¨ä¸å¯å˜æ¨¡å¼\n\n\nç±»å‹å®‰å…¨ï¼šä¸ºæ‰€æœ‰çŠ¶æ€å’Œæ“ä½œæ·»åŠ ç±»å‹å®šä¹‰\n\n\næ€§èƒ½ä¼˜åŒ–\n\n\né¿å…è¿‡åº¦ä½¿ç”¨å…¨å±€çŠ¶æ€ï¼šåªå°†çœŸæ­£éœ€è¦å…±äº«çš„çŠ¶æ€æ”¾å…¥ Store\n\n\nåˆç†ä½¿ç”¨ Gettersï¼šåˆ©ç”¨ç¼“å­˜æœºåˆ¶æé«˜æ€§èƒ½\n\n\næ‰¹é‡æ›´æ–°ï¼šä½¿ç”¨ $patch è¿›è¡Œæ‰¹é‡çŠ¶æ€æ›´æ–°\n\n\næŒ‰éœ€åŠ è½½ï¼šå¯¹äºå¤§å‹åº”ç”¨ï¼Œå¯ä»¥è€ƒè™‘åŠ¨æ€æ³¨å†Œ Store\n\n\næµ‹è¯•ç­–ç•¥\n// tests/stores/counter.test.tsimport &#123; setActivePinia, createPinia &#125; from &#x27;pinia&#x27;import &#123; useCounterStore &#125; from &#x27;@/stores/counter&#x27;describe(&#x27;Counter Store&#x27;, () =&gt; &#123;  beforeEach(() =&gt; &#123;    setActivePinia(createPinia())  &#125;)    it(&#x27;should initialize with count 0&#x27;, () =&gt; &#123;    const counterStore = useCounterStore()    expect(counterStore.count).toBe(0)  &#125;)    it(&#x27;should increment count&#x27;, () =&gt; &#123;    const counterStore = useCounterStore()    counterStore.increment()    expect(counterStore.count).toBe(1)  &#125;)    it(&#x27;should calculate double count correctly&#x27;, () =&gt; &#123;    const counterStore = useCounterStore()    counterStore.count = 2    expect(counterStore.doubleCount).toBe(4)  &#125;)&#125;)\nä¸ Vuex çš„å¯¹æ¯”\næ ¸å¿ƒå·®å¼‚\n\n\n\nç‰¹æ€§\nPinia\nVuex\n\n\n\n\nTypeScript æ”¯æŒ\nåŸç”Ÿæ”¯æŒï¼Œç±»å‹æ¨æ–­å®Œå–„\néœ€è¦é¢å¤–ç±»å‹å£°æ˜\n\n\næ¨¡å—åŒ–è®¾è®¡\næ¯ä¸ª store ç‹¬ç«‹ï¼Œæ— åµŒå¥—\néœ€è¦é€šè¿‡ modules åµŒå¥—\n\n\nçŠ¶æ€ä¿®æ”¹\nç›´æ¥ä¿®æ”¹ state\nå¿…é¡»é€šè¿‡ mutations\n\n\nActions\næ”¯æŒåŒæ­¥å’Œå¼‚æ­¥\nå¼‚æ­¥æ“ä½œéœ€è¦é€šè¿‡ actions\n\n\nMutations\nå·²åºŸå¼ƒ\nå¿…é¡»ä½¿ç”¨ mutations ä¿®æ”¹çŠ¶æ€\n\n\nä»£ç ç®€æ´æ€§\næ›´ç®€æ´ï¼Œå‡å°‘æ ·æ¿ä»£ç \nç›¸å¯¹ç¹ç\n\n\nDevTools æ”¯æŒ\nå®Œæ•´æ”¯æŒ\nå®Œæ•´æ”¯æŒ\n\n\n\nè¿ç§»æŒ‡å—\nä» Vuex è¿ç§»åˆ° Piniaï¼š\n// Vuexconst store = new Vuex.Store(&#123;  state: &#123; count: 0 &#125;,  mutations: &#123;    increment(state) &#123;      state.count++    &#125;  &#125;,  actions: &#123;    incrementAsync(&#123; commit &#125;) &#123;      setTimeout(() =&gt; commit(&#x27;increment&#x27;), 1000)    &#125;  &#125;,  getters: &#123;    doubleCount: state =&gt; state.count * 2  &#125;&#125;)// Pinia ç­‰æ•ˆä»£ç export const useCounterStore = defineStore(&#x27;counter&#x27;, &#123;  state: () =&gt; (&#123; count: 0 &#125;),  actions: &#123;    increment() &#123;      this.count++    &#125;,    incrementAsync() &#123;      setTimeout(() =&gt; this.increment(), 1000)    &#125;  &#125;,  getters: &#123;    doubleCount: state =&gt; state.count * 2  &#125;&#125;)\nPinia çš„ä¼˜åŠ¿\n\n\nç°ä»£åŒ–è®¾è®¡ï¼šåŸºäº Vue 3 çš„ç»„åˆå¼ API è®¾è®¡\n\n\nä¼˜ç§€çš„ TypeScript æ”¯æŒï¼šæä¾›å®Œå–„çš„ç±»å‹æ¨æ–­\n\n\nç®€æ´çš„ APIï¼šå‡å°‘äº† Vuex ä¸­çš„æ ·æ¿ä»£ç \n\n\nå¼ºå¤§çš„æ’ä»¶ç³»ç»Ÿï¼šå¯ä»¥è½»æ¾æ‰©å±•åŠŸèƒ½\n\n\nè‰¯å¥½çš„å¼€å‘ä½“éªŒï¼šå®Œæ•´çš„ DevTools æ”¯æŒå’Œçƒ­æ›´æ–°\n\n\né€‚ç”¨åœºæ™¯\n\n\nä¸­å¤§å‹ Vue 3 é¡¹ç›®ï¼šéœ€è¦é›†ä¸­ç®¡ç†çŠ¶æ€çš„åº”ç”¨\n\n\nTypeScript é¡¹ç›®ï¼šéœ€è¦ç±»å‹å®‰å…¨çš„çŠ¶æ€ç®¡ç†\n\n\néœ€è¦æœåŠ¡ç«¯æ¸²æŸ“çš„é¡¹ç›®ï¼šPinia åŸç”Ÿæ”¯æŒ SSR\n\n\nä» Vuex è¿ç§»çš„é¡¹ç›®ï¼šæä¾›æ›´ç®€æ´çš„ API\n\n\nå­¦ä¹ å»ºè®®\n\n\næŒæ¡åŸºç¡€æ¦‚å¿µï¼šç†è§£ Storeã€Stateã€Gettersã€Actions çš„åŸºæœ¬ç”¨æ³•\n\n\nå®è·µç»„åˆå¼ APIï¼šæ¨èä½¿ç”¨ç»„åˆå¼è¯­æ³•å®šä¹‰ Store\n\n\nå­¦ä¼šæ’ä»¶å¼€å‘ï¼šåˆ©ç”¨æ’ä»¶æ‰©å±• Pinia çš„åŠŸèƒ½\n\n\nå…³æ³¨æœ€ä½³å®è·µï¼šåˆç†è®¾è®¡çŠ¶æ€ç»“æ„ï¼Œé¿å…è¿‡åº¦ä½¿ç”¨å…¨å±€çŠ¶æ€\n\n\næŒç»­å­¦ä¹ ï¼šå…³æ³¨ Pinia çš„æœ€æ–°ç‰¹æ€§å’Œæœ€ä½³å®è·µ\n\n\nPinia ä½œä¸º Vue å®˜æ–¹æ¨èçš„çŠ¶æ€ç®¡ç†åº“ï¼Œæ­£åœ¨æˆä¸º Vue ç”Ÿæ€ç³»ç»Ÿä¸­çš„æ ‡å‡†é€‰æ‹©ã€‚æŒæ¡ Pinia å°†æœ‰åŠ©äºæ„å»ºæ›´åŠ å¥å£®ã€å¯ç»´æŠ¤çš„ Vue åº”ç”¨ã€‚\nå‚è€ƒèµ„æºï¼š\n\n\nPinia å®˜æ–¹æ–‡æ¡£\n\n\nVue å®˜æ–¹æ–‡æ¡£\n\n\nPinia GitHub ä»“åº“\n\n\n","categories":["ç¼–ç¨‹"],"tags":["Web"]},{"title":"VS2022 ASP.NET core Web API ç¤ºä¾‹ä»£ç è§£é‡Š","url":"/2024/07/15/web/VS2022-ASP-NET-core-Web-API-%E7%A4%BA%E4%BE%8B%E4%BB%A3%E7%A0%81%E8%A7%A3%E9%87%8A/","content":"\nå…³äºVS2022æä¾›çš„å¤©æ°”é¢„æŠ¥ç¤ºä¾‹ä»£ç çš„ä¸€äº›è§£é‡Š\n\n \n0. é¡¹ç›®ç»“æ„\nåœ¨åˆ›å»ºASP.NET Core Web APIé¡¹ç›®åï¼Œé¡¹ç›®çš„åŸºæœ¬ç»“æ„å¦‚ä¸‹ï¼š\nMyWebApiProjectâ”‚   Controllersâ”‚   â””â”€â”€ WeatherForecastController.csâ”‚   Program.csâ”‚   WeatherForecast.csâ”‚   appsettings.jsonâ”‚   ...\n1. Program.cs\nè¿™ä¸ªæ–‡ä»¶æ˜¯åº”ç”¨ç¨‹åºçš„å…¥å£ç‚¹ï¼Œè´Ÿè´£é…ç½®å’Œå¯åŠ¨WebæœåŠ¡å™¨ã€‚\nvar builder = WebApplication.CreateBuilder(args);\n\n\nWebApplication.CreateBuilder(args)ï¼šåˆ›å»ºä¸€ä¸ªWebåº”ç”¨ç¨‹åºæ„å»ºå™¨ã€‚\n\n\nargsï¼šå‘½ä»¤è¡Œå‚æ•°ã€‚\n\n\nbuilder.Services.AddControllers();\n\n\nbuilder.Servicesï¼šè¡¨ç¤ºä¾èµ–æ³¨å…¥å®¹å™¨ã€‚\n\n\nAddControllersï¼šå‘ä¾èµ–æ³¨å…¥å®¹å™¨æ·»åŠ æ§åˆ¶å™¨æœåŠ¡ã€‚\n\n\nbuilder.Services.AddEndpointsApiExplorer();builder.Services.AddSwaggerGen();\n\n\nAddEndpointsApiExplorerï¼šç”¨äºAPIæ–‡æ¡£ç”Ÿæˆã€‚\n\n\nAddSwaggerGenï¼šæ·»åŠ Swaggerç”Ÿæˆå™¨ï¼Œç”ŸæˆAPIæ–‡æ¡£ã€‚\n\n\nvar app = builder.Build();\n\n\nbuilder.Build()ï¼šæ„å»ºWebåº”ç”¨ç¨‹åºã€‚\n\n\nif (app.Environment.IsDevelopment())&#123;    app.UseDeveloperExceptionPage();    app.UseSwagger();    app.UseSwaggerUI();&#125;\n\n\napp.Environment.IsDevelopment()ï¼šæ£€æŸ¥å½“å‰ç¯å¢ƒæ˜¯å¦æ˜¯å¼€å‘ç¯å¢ƒã€‚\n\n\nUseDeveloperExceptionPageï¼šåœ¨å¼€å‘ç¯å¢ƒä¸­ä½¿ç”¨å¼€å‘è€…å¼‚å¸¸é¡µé¢ã€‚\n\n\nUseSwaggerå’ŒUseSwaggerUIï¼šå¯ç”¨Swaggerä¸­é—´ä»¶ï¼Œæä¾›APIæ–‡æ¡£UIã€‚\n\n\napp.UseHttpsRedirection();app.UseAuthorization();app.MapControllers();app.Run();\n\n\nUseHttpsRedirectionï¼šå¼ºåˆ¶ä½¿ç”¨HTTPSã€‚\n\n\nUseAuthorizationï¼šå¯ç”¨æˆæƒä¸­é—´ä»¶ã€‚\n\n\nMapControllersï¼šå°†æ§åˆ¶å™¨æ˜ å°„åˆ°è·¯ç”±ã€‚\n\n\napp.Run()ï¼šè¿è¡ŒWebåº”ç”¨ç¨‹åºã€‚\n\n\n2. WeatherForecast.cs\nè¿™ä¸ªæ–‡ä»¶å®šä¹‰äº†å¤©æ°”é¢„æŠ¥çš„æ•°æ®æ¨¡å‹ã€‚\npublic class WeatherForecast&#123;    public DateTime Date &#123; get; set; &#125;    public int TemperatureC &#123; get; set; &#125;    public int TemperatureF =&gt; 32 + (int)(TemperatureC / 0.5556);    public string? Summary &#123; get; set; &#125;&#125;\n\n\nDateï¼šè¡¨ç¤ºé¢„æŠ¥çš„æ—¥æœŸã€‚\n\n\nTemperatureCï¼šè¡¨ç¤ºæ‘„æ°æ¸©åº¦ã€‚\n\n\nTemperatureFï¼šè¡¨ç¤ºåæ°æ¸©åº¦ï¼Œé€šè¿‡æ‘„æ°æ¸©åº¦è®¡ç®—å¾—å‡ºã€‚\n\n\nSummaryï¼šè¡¨ç¤ºå¤©æ°”æ€»ç»“ï¼Œå¯ä»¥ä¸ºç©ºï¼ˆstring?è¡¨ç¤ºå¯ç©ºç±»å‹ï¼‰ã€‚\n\n\n3. WeatherForecastController.cs\nè¿™ä¸ªæ–‡ä»¶å®šä¹‰äº†ä¸€ä¸ªæ§åˆ¶å™¨ç±»ï¼Œå¤„ç†ä¸å¤©æ°”é¢„æŠ¥ç›¸å…³çš„HTTPè¯·æ±‚ã€‚\nusing Microsoft.AspNetCore.Mvc;\n\n\nusingè¯­å¥ï¼šå¯¼å…¥å‘½åç©ºé—´ï¼ŒåŒ…å«Microsoft.AspNetCore.Mvcç”¨äºæ§åˆ¶å™¨ç›¸å…³åŠŸèƒ½ã€‚\n\n\nnamespace MyWebApiProject.Controllers&#123;    [ApiController]    [Route(&quot;[controller]&quot;)]    public class WeatherForecastController : ControllerBase    &#123;        private static readonly string[] Summaries = new[]        &#123;            &quot;Freezing&quot;, &quot;Bracing&quot;, &quot;Chilly&quot;, &quot;Cool&quot;, &quot;Mild&quot;, &quot;Warm&quot;, &quot;Balmy&quot;, &quot;Hot&quot;, &quot;Sweltering&quot;, &quot;Scorching&quot;        &#125;;        private readonly ILogger&lt;WeatherForecastController&gt; _logger;        public WeatherForecastController(ILogger&lt;WeatherForecastController&gt; logger)        &#123;            _logger = logger;        &#125;        [HttpGet]        public IEnumerable&lt;WeatherForecast&gt; Get()        &#123;            var rng = new Random();            return Enumerable.Range(1, 5).Select(index =&gt; new WeatherForecast            &#123;                Date = DateTime.Now.AddDays(index),                TemperatureC = rng.Next(-20, 55),                Summary = Summaries[rng.Next(Summaries.Length)]            &#125;)            .ToArray();        &#125;    &#125;&#125;\nè¯¦ç»†è§£æï¼š\n\n\n[ApiController]\n\næ ‡è®°è¯¥ç±»ä¸ºAPIæ§åˆ¶å™¨ï¼Œå¯ç”¨ä¸€äº›è‡ªåŠ¨åŒ–åŠŸèƒ½ï¼Œå¦‚æ¨¡å‹éªŒè¯å’Œè·¯ç”±æ¨æ–­ã€‚\n\n\n\n[Route(&quot;[controller]&quot;)]\n\nå®šä¹‰æ§åˆ¶å™¨çš„è·¯ç”±æ¨¡æ¿ã€‚[controller]å ä½ç¬¦ä¼šè¢«æ§åˆ¶å™¨åç§°æ›¿æ¢ï¼ˆå»æ‰â€œControllerâ€åç¼€ï¼‰ã€‚\n\n\n\næ§åˆ¶å™¨ç±»ï¼š\n public class WeatherForecastController : ControllerBase\n\nWeatherForecastControllerï¼šæ§åˆ¶å™¨ç±»ï¼Œç»§æ‰¿è‡ªControllerBaseã€‚\nControllerBaseï¼šæä¾›è®¿é—®æ§åˆ¶å™¨åŠŸèƒ½çš„åŸºç±»ï¼Œä¸åŒ…å«è§†å›¾æ”¯æŒã€‚\n\n\n\nSummarieså­—æ®µï¼š\n private static readonly string[] Summaries = new[]\n\nå®šä¹‰äº†ä¸€ä¸ªé™æ€åªè¯»æ•°ç»„ï¼ŒåŒ…å«å„ç§å¤©æ°”æ€»ç»“æè¿°ã€‚\n\n\n\næ„é€ å‡½æ•°ï¼š\n public WeatherForecastController(ILogger&lt;WeatherForecastController&gt; logger)\n\nä¾èµ–æ³¨å…¥ILogger&lt;WeatherForecastController&gt;å®ä¾‹ï¼Œç”¨äºæ—¥å¿—è®°å½•ã€‚\n\n\n\nGetæ–¹æ³•ï¼š\n [HttpGet]public IEnumerable&lt;WeatherForecast&gt; Get()\n\n[HttpGet]ï¼šæ ‡è®°è¯¥æ–¹æ³•å¤„ç†HTTP GETè¯·æ±‚ã€‚\nGetæ–¹æ³•è¿”å›ä¸€ä¸ªIEnumerable&lt;WeatherForecast&gt;ï¼Œç”Ÿæˆå¹¶è¿”å›5å¤©çš„å¤©æ°”é¢„æŠ¥æ•°æ®ã€‚\n\n var rng = new Random();return Enumerable.Range(1, 5).Select(index =&gt; new WeatherForecast&#123;    Date = DateTime.Now.AddDays(index),    TemperatureC = rng.Next(-20, 55),    Summary = Summaries[rng.Next(Summaries.Length)]&#125;).ToArray();\n\n\nåˆ›å»ºä¸€ä¸ªéšæœºæ•°ç”Ÿæˆå™¨ã€‚\n\n\nä½¿ç”¨Enumerable.Rangeç”Ÿæˆ1åˆ°5çš„æ•´æ•°åºåˆ—ã€‚\n\n\nä½¿ç”¨Selectæ–¹æ³•å°†æ¯ä¸ªæ•´æ•°è½¬æ¢ä¸ºä¸€ä¸ªWeatherForecastå¯¹è±¡ã€‚\n\n\nç”Ÿæˆæ—¥æœŸä¸ºå½“å‰æ—¥æœŸåŠ ä¸Šåºåˆ—ä¸­çš„å¤©æ•°ã€‚\n\n\nç”Ÿæˆéšæœºçš„æ‘„æ°æ¸©åº¦å’Œå¤©æ°”æ€»ç»“ã€‚\n\n\nå°†ç»“æœè½¬æ¢ä¸ºæ•°ç»„å¹¶è¿”å›ã€‚\n\n\n\n\nè®¾è®¡ä»£ç ç»“æ„çš„å»ºè®®\nåœ¨ASP.NET Core Web APIé¡¹ç›®ä¸­ï¼Œå°†ä»£ç åˆ†ä¸ºæ¨¡å‹å±‚ã€æ§åˆ¶å™¨å±‚ã€æœåŠ¡å±‚å’Œæ•°æ®è®¿é—®å±‚æœ‰åŠ©äºç»„ç»‡ä»£ç ï¼Œä½¿å…¶æ›´æ˜“äºç»´æŠ¤å’Œæ‰©å±•ã€‚ä»¥ä¸‹æ˜¯å„ä¸ªå±‚çš„è¯¦ç»†æè¿°ä»¥åŠå®ƒä»¬å­˜æ”¾çš„ä»£ç ç±»å‹ï¼š\n1. æ¨¡å‹å±‚ï¼ˆModelsï¼‰\næ¨¡å‹å±‚å­˜æ”¾æ•°æ®ç»“æ„å’Œä¸šåŠ¡å¯¹è±¡ï¼Œè¿™äº›å¯¹è±¡é€šå¸¸åæ˜ äº†ç³»ç»Ÿçš„æ ¸å¿ƒä¸šåŠ¡å®ä½“ã€‚\n\n\næ•°æ®æ¨¡å‹ï¼šè¡¨ç¤ºæ•°æ®çš„ç»“æ„ï¼Œå¦‚æ•°æ®åº“è¡¨çš„å®ä½“ã€‚\n\n\næ•°æ®ä¼ è¾“å¯¹è±¡ï¼ˆDTOï¼‰ï¼šç”¨äºåœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´ä¼ è¾“æ•°æ®ã€‚\n\n\nè§†å›¾æ¨¡å‹ï¼šç”¨äºå°†æ•°æ®ä»æ§åˆ¶å™¨ä¼ é€’åˆ°è§†å›¾ï¼ˆåœ¨APIä¸­è¾ƒå°‘ä½¿ç”¨ï¼‰ã€‚\n\n\nç¤ºä¾‹ï¼š\n// æ–‡ä»¶è·¯å¾„ï¼šModels/WeatherForecast.cspublic class WeatherForecast&#123;    public DateTime Date &#123; get; set; &#125;    public int TemperatureC &#123; get; set; &#125;    public int TemperatureF =&gt; 32 + (int)(TemperatureC / 0.5556);    public string? Summary &#123; get; set; &#125;&#125;\n2. æ§åˆ¶å™¨å±‚ï¼ˆControllersï¼‰\næ§åˆ¶å™¨å±‚åŒ…å«æ§åˆ¶å™¨ç±»ï¼Œè¿™äº›ç±»å¤„ç†HTTPè¯·æ±‚å¹¶è¿”å›å“åº”ã€‚æ§åˆ¶å™¨é€šå¸¸ä½¿ç”¨æœåŠ¡å±‚æ¥å¤„ç†ä¸šåŠ¡é€»è¾‘ã€‚\n\n\næ§åˆ¶å™¨ï¼šå¤„ç†HTTPè¯·æ±‚ï¼Œè°ƒç”¨æœåŠ¡å±‚ï¼Œå¹¶è¿”å›å“åº”ã€‚\n\n\nå±æ€§å’Œæ–¹æ³•ï¼šå¤„ç†ç‰¹å®šçš„HTTPè¯·æ±‚ï¼ˆå¦‚GETã€POSTã€PUTã€DELETEï¼‰ã€‚\n\n\nç¤ºä¾‹ï¼š\n// æ–‡ä»¶è·¯å¾„ï¼šControllers/WeatherForecastController.csusing Microsoft.AspNetCore.Mvc;using MyWebApiProject.Services;namespace MyWebApiProject.Controllers&#123;    [ApiController]    [Route(&quot;[controller]&quot;)]    public class WeatherForecastController : ControllerBase    &#123;        private readonly IWeatherForecastService _weatherForecastService;        public WeatherForecastController(IWeatherForecastService weatherForecastService)        &#123;            _weatherForecastService = weatherForecastService;        &#125;        [HttpGet]        public IEnumerable&lt;WeatherForecast&gt; Get()        &#123;            return _weatherForecastService.GetWeatherForecasts();        &#125;    &#125;&#125;\n3. æœåŠ¡å±‚ï¼ˆServicesï¼‰\næœåŠ¡å±‚åŒ…å«ä¸šåŠ¡é€»è¾‘å’Œæ“ä½œï¼Œè¿™äº›é€»è¾‘é€šå¸¸æ¶‰åŠå¤šä¸ªæ•°æ®æ¨¡å‹æˆ–éœ€è¦å¤æ‚çš„ä¸šåŠ¡è§„åˆ™ã€‚æœåŠ¡å±‚ä»æ•°æ®è®¿é—®å±‚è·å–æ•°æ®å¹¶è¿›è¡Œå¤„ç†ã€‚\n\n\næœåŠ¡æ¥å£ï¼šå®šä¹‰æœåŠ¡çš„åˆåŒã€‚\n\n\næœåŠ¡å®ç°ï¼šå®ç°æœåŠ¡æ¥å£ï¼ŒåŒ…å«å…·ä½“çš„ä¸šåŠ¡é€»è¾‘ã€‚\n\n\nç¤ºä¾‹ï¼š\n// æ–‡ä»¶è·¯å¾„ï¼šServices/IWeatherForecastService.csusing MyWebApiProject.Models;public interface IWeatherForecastService&#123;    IEnumerable&lt;WeatherForecast&gt; GetWeatherForecasts();&#125;// æ–‡ä»¶è·¯å¾„ï¼šServices/WeatherForecastService.csusing MyWebApiProject.Models;using MyWebApiProject.Data;public class WeatherForecastService : IWeatherForecastService&#123;    private readonly IWeatherForecastRepository _repository;    public WeatherForecastService(IWeatherForecastRepository repository)    &#123;        _repository = repository;    &#125;    public IEnumerable&lt;WeatherForecast&gt; GetWeatherForecasts()    &#123;        return _repository.GetWeatherForecasts();    &#125;&#125;\n4. æ•°æ®è®¿é—®å±‚ï¼ˆData Access Layer, DALï¼‰\næ•°æ®è®¿é—®å±‚å¤„ç†ä¸æ•°æ®åº“çš„äº¤äº’ï¼Œè´Ÿè´£ä»æ•°æ®åº“ä¸­æ£€ç´¢å’Œå­˜å‚¨æ•°æ®ã€‚\n\n\nä»“å‚¨æ¥å£ï¼šå®šä¹‰æ•°æ®è®¿é—®çš„åˆåŒã€‚\n\n\nä»“å‚¨å®ç°ï¼šå®ç°ä»“å‚¨æ¥å£ï¼ŒåŒ…å«å…·ä½“çš„æ•°æ®è®¿é—®é€»è¾‘ã€‚\n\n\næ•°æ®ä¸Šä¸‹æ–‡ï¼šè¡¨ç¤ºæ•°æ®åº“è¿æ¥å’Œæ“ä½œã€‚\n\n\nç¤ºä¾‹ï¼š\n// æ–‡ä»¶è·¯å¾„ï¼šData/IWeatherForecastRepository.csusing MyWebApiProject.Models;public interface IWeatherForecastRepository&#123;    IEnumerable&lt;WeatherForecast&gt; GetWeatherForecasts();&#125;// æ–‡ä»¶è·¯å¾„ï¼šData/WeatherForecastRepository.csusing MyWebApiProject.Models;using System.Collections.Generic;public class WeatherForecastRepository : IWeatherForecastRepository&#123;    public IEnumerable&lt;WeatherForecast&gt; GetWeatherForecasts()    &#123;        // è¿™é‡Œå¯ä»¥è¿æ¥æ•°æ®åº“å¹¶è·å–æ•°æ®        var rng = new Random();        return Enumerable.Range(1, 5).Select(index =&gt; new WeatherForecast        &#123;            Date = DateTime.Now.AddDays(index),            TemperatureC = rng.Next(-20, 55),            Summary = Summaries[rng.Next(Summaries.Length)]        &#125;)        .ToArray();    &#125;    private static readonly string[] Summaries = new[]    &#123;        &quot;Freezing&quot;, &quot;Bracing&quot;, &quot;Chilly&quot;, &quot;Cool&quot;, &quot;Mild&quot;, &quot;Warm&quot;, &quot;Balmy&quot;, &quot;Hot&quot;, &quot;Sweltering&quot;, &quot;Scorching&quot;    &#125;;&#125;\nä»£ç ç»“æ„è®¾è®¡å»ºè®®\nä»¥ä¸‹æ˜¯ä¸€ä¸ªç¤ºä¾‹é¡¹ç›®çš„ç›®å½•ç»“æ„ï¼Œä»¥å¸®åŠ©ç»„ç»‡å„ä¸ªå±‚çš„ä»£ç ï¼š\nMyWebApiProjectâ”‚â”œâ”€â”€ Controllersâ”‚   â””â”€â”€ WeatherForecastController.csâ”‚â”œâ”€â”€ Modelsâ”‚   â””â”€â”€ WeatherForecast.csâ”‚â”œâ”€â”€ Servicesâ”‚   â”œâ”€â”€ IWeatherForecastService.csâ”‚   â””â”€â”€ WeatherForecastService.csâ”‚â”œâ”€â”€ Dataâ”‚   â”œâ”€â”€ IWeatherForecastRepository.csâ”‚   â””â”€â”€ WeatherForecastRepository.csâ”‚â”œâ”€â”€ Program.csâ”œâ”€â”€ Startup.cs (å¦‚æœä½¿ç”¨Startupç±»è¿›è¡Œé…ç½®)â”œâ”€â”€ appsettings.jsonâ”‚â””â”€â”€ MyWebApiProject.csproj\nå„å±‚çš„å®ç°åŸç†\n\n\næ¨¡å‹å±‚ï¼šå®šä¹‰åº”ç”¨ç¨‹åºçš„æ•°æ®ç»“æ„ï¼Œè¡¨ç¤ºä¸šåŠ¡å®ä½“å’Œæ•°æ®ä¼ è¾“å¯¹è±¡ã€‚\n\n\næ§åˆ¶å™¨å±‚ï¼šå¤„ç†HTTPè¯·æ±‚ï¼Œé€šè¿‡è°ƒç”¨æœåŠ¡å±‚è·å–æˆ–å¤„ç†æ•°æ®ï¼Œç„¶åè¿”å›HTTPå“åº”ã€‚\n\n\næœåŠ¡å±‚ï¼šåŒ…å«ä¸šåŠ¡é€»è¾‘ï¼Œå¤„ç†å¤æ‚çš„æ“ä½œå’Œä¸šåŠ¡è§„åˆ™ã€‚é€šè¿‡è°ƒç”¨æ•°æ®è®¿é—®å±‚è·å–å’Œå­˜å‚¨æ•°æ®ã€‚\n\n\næ•°æ®è®¿é—®å±‚ï¼šä¸æ•°æ®åº“æˆ–å…¶ä»–æ•°æ®æºäº¤äº’ï¼Œæ‰§è¡ŒCRUDï¼ˆåˆ›å»ºã€è¯»å–ã€æ›´æ–°ã€åˆ é™¤ï¼‰æ“ä½œï¼Œè¿”å›æ•°æ®ç»™æœåŠ¡å±‚ã€‚\n\n\né€šè¿‡è¿™ç§åˆ†å±‚ç»“æ„ï¼Œå¯ä»¥ä½¿ä»£ç æ›´åŠ æ¨¡å—åŒ–ã€æ˜“äºç»´æŠ¤å’Œæµ‹è¯•ï¼ŒåŒæ—¶æ¸…æ™°åœ°åˆ†ç¦»äº†å„ä¸ªéƒ¨åˆ†çš„èŒè´£ã€‚\n","categories":["ç¼–ç¨‹"],"tags":["C#"]},{"title":"Vueè·¯ç”±","url":"/2025/10/09/web/Vue%20%E8%B7%AF%E7%94%B1/","content":"\nå¦‚é¢˜ï¼Œç»“åˆå®˜æ–¹æ–‡æ¡£ä¸ç½‘ç»œå¸–å­ï¼Œåˆ©ç”¨AIæ•´ç†\n\n\nVue è·¯ç”±\n1. å®‰è£…ä¸åŸºç¡€é…ç½®\nVue Router æ˜¯ Vue 3 æ„å»ºå•é¡µé¢åº”ç”¨ï¼ˆSPAï¼‰çš„æ ¸å¿ƒå·¥å…·ï¼Œç¬¬ä¸€æ­¥éœ€å®Œæˆå®‰è£…ä¸åŸºç¡€é…ç½®ï¼Œç¡®ä¿è·¯ç”±åŠŸèƒ½æ­£å¸¸è¿è¡Œï¼š\n\n\nå®‰è£…ï¼šé€šè¿‡ npm å®‰è£…é€‚é… Vue 3 çš„ Vue Router 4 ç‰ˆæœ¬ï¼Œå‘½ä»¤å¦‚ä¸‹ï¼š\nnpm install vue-router@4\n\n\nè·¯ç”±é…ç½®ï¼šåœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»º router/index.js æ–‡ä»¶ï¼Œå®šä¹‰è·¯ç”±è§„åˆ™ã€‚æ ¸å¿ƒæ˜¯é€šè¿‡ createRouter åˆ›å»ºè·¯ç”±å®ä¾‹ï¼ŒcreateWebHistory è®¾ç½® History æ¨¡å¼ï¼ŒåŒæ—¶å¯¼å…¥éœ€è·¯ç”±ç®¡ç†çš„ç»„ä»¶ï¼ˆå¦‚ Homeã€Aboutï¼‰ï¼Œå¹¶é…ç½®è·¯ç”±è·¯å¾„ï¼ˆpathï¼‰ã€è·¯ç”±åç§°ï¼ˆnameï¼‰åŠå¯¹åº”ç»„ä»¶ï¼ˆcomponentï¼‰ï¼š\nimport &#123; createRouter, createWebHistory &#125; from &#x27;vue-router&#x27;;import Home from &#x27;@/views/Home.vue&#x27;;import About from &#x27;@/views/About.vue&#x27;;const routes = [  &#123; path: &#x27;/&#x27;, name: &#x27;Home&#x27;, component: Home &#125;,  &#123; path: &#x27;/about&#x27;, name: &#x27;About&#x27;, component: About &#125;];const router = createRouter(&#123;  history: createWebHistory(), // é‡‡ç”¨ HTML5 History æ¨¡å¼  routes // æ³¨å…¥è·¯ç”±è§„åˆ™&#125;);export default router;\n\n\næ³¨å†Œè·¯ç”±ï¼šåœ¨é¡¹ç›®å…¥å£æ–‡ä»¶ main.js ä¸­ï¼Œå¯¼å…¥è·¯ç”±å®ä¾‹å¹¶é€šè¿‡ use(router) æ³¨å†Œåˆ° Vue åº”ç”¨ï¼Œç¡®ä¿è·¯ç”±åŠŸèƒ½å…¨å±€å¯ç”¨ï¼š\nimport &#123; createApp &#125; from &#x27;vue&#x27;;import App from &#x27;./App.vue&#x27;;import router from &#x27;./router&#x27;;createApp(App).use(router).mount(&#x27;#app&#x27;);\n\n\nè·¯ç”±å‡ºå£ä¸å¯¼èˆªï¼šåœ¨ App.vue ä¸­ï¼Œä½¿ç”¨ &lt;router-view&gt; ä½œä¸ºè·¯ç”±ç»„ä»¶çš„æ¸²æŸ“å®¹å™¨ï¼ˆåŒ¹é…çš„è·¯ç”±ç»„ä»¶ä¼šåœ¨æ­¤å¤„æ¸²æŸ“ï¼‰ï¼Œä½¿ç”¨ &lt;router-link&gt; å®ç°é¡µé¢å¯¼èˆªï¼ˆæ›¿ä»£ä¼ ç»Ÿ &lt;a&gt; æ ‡ç­¾ï¼Œé¿å…é¡µé¢åˆ·æ–°ï¼‰ï¼š\n&lt;template&gt;  &lt;div id=&quot;app&quot;&gt;    &lt;nav&gt;      &lt;router-link to=&quot;/&quot;&gt;é¦–é¡µ&lt;/router-link&gt; &lt;!-- è·³è½¬åˆ°é¦–é¡µè·¯ç”± --&gt;      &lt;router-link to=&quot;/about&quot;&gt;å…³äº&lt;/router-link&gt; &lt;!-- è·³è½¬åˆ°å…³äºè·¯ç”± --&gt;    &lt;/nav&gt;    &lt;router-view&gt;&lt;/router-view&gt; &lt;!-- è·¯ç”±ç»„ä»¶æ¸²æŸ“å‡ºå£ --&gt;  &lt;/div&gt;&lt;/template&gt;\n\n\n2. æ ¸å¿ƒåŠŸèƒ½\nVue Router æä¾› 4 ä¸ªæ ¸å¿ƒåŠŸèƒ½ï¼Œæ»¡è¶³æ—¥å¸¸è·¯ç”±ç®¡ç†éœ€æ±‚ï¼ŒåŒ…æ‹¬åŠ¨æ€è·¯ç”±ã€åµŒå¥—è·¯ç”±ã€ç¼–ç¨‹å¼å¯¼èˆªå’Œè·¯ç”±æ‡’åŠ è½½ï¼š\n\n\nåŠ¨æ€è·¯ç”±ï¼šç”¨äºåŒ¹é…åŒä¸€ç±»è·¯å¾„ï¼ˆå¦‚ä¸åŒç”¨æˆ·çš„è¯¦æƒ…é¡µï¼‰ï¼Œé€šè¿‡ : åœ¨è·¯ç”± path ä¸­å®šä¹‰åŠ¨æ€å‚æ•°ï¼ˆå¦‚ idï¼‰ï¼Œç»„ä»¶å†…é€šè¿‡ useRoute() è·å–è·¯ç”±å®ä¾‹ï¼Œå†é€šè¿‡ route.params è®¿é—®åŠ¨æ€å‚æ•°ï¼š\n\nè·¯ç”±é…ç½®ï¼š{ path: '/user/:id', component: User }\nç»„ä»¶å†…è·å–å‚æ•°ï¼š&lt;script setup&gt;import &#123; useRoute &#125; from &#x27;vue-router&#x27;;const route = useRoute();console.log(route.params.id); // è¾“å‡ºåŠ¨æ€å‚æ•° id çš„å€¼&lt;/script&gt;\n\n\n\n\nåµŒå¥—è·¯ç”±ï¼šå®ç°è·¯ç”±çš„å±‚çº§ç»“æ„ï¼ˆå¦‚ä»ªè¡¨ç›˜ä¸‹çš„ä¸ªäººèµ„æ–™ã€è®¾ç½®é¡µé¢ï¼‰ï¼Œé€šè¿‡ children å­—æ®µåœ¨çˆ¶è·¯ç”±ä¸­é…ç½®å­è·¯ç”±ï¼Œä¸”çˆ¶ç»„ä»¶å¿…é¡»åŒ…å« &lt;router-view&gt; ä»¥æ¸²æŸ“å­è·¯ç”±ç»„ä»¶ï¼š\n&#123;  path: &#x27;/dashboard&#x27;, // çˆ¶è·¯ç”±è·¯å¾„  component: Dashboard, // çˆ¶è·¯ç”±ç»„ä»¶  children: [    &#123; path: &#x27;profile&#x27;, component: Profile &#125;, // å­è·¯ç”± 1ï¼Œè®¿é—®è·¯å¾„ /dashboard/profile    &#123; path: &#x27;settings&#x27;, component: Settings &#125; // å­è·¯ç”± 2ï¼Œè®¿é—®è·¯å¾„ /dashboard/settings  ]&#125;\n\n\nç¼–ç¨‹å¼å¯¼èˆªï¼šä¸ä¾èµ– &lt;router-link&gt;ï¼Œé€šè¿‡ä»£ç å®ç°é¡µé¢è·³è½¬ï¼Œæ ¸å¿ƒæ–¹æ³•æ˜¯ router.push()ï¼Œæ”¯æŒ 4 ç§è·³è½¬å½¢å¼ï¼š\n// 1. å­—ç¬¦ä¸²è·¯å¾„ï¼šç›´æ¥ä¼ å…¥ç›®æ ‡è·¯ç”±è·¯å¾„router.push(&#x27;/about&#x27;);// 2. å¯¹è±¡å½¢å¼ï¼šä¼ å…¥å« path çš„å¯¹è±¡router.push(&#123; path: &#x27;/user/123&#x27; &#125;);// 3. å‘½åè·¯ç”± + å‚æ•°ï¼šéœ€é…åˆè·¯ç”± name å’Œ paramsï¼ˆæ¨èï¼Œå‚æ•°æ›´æ¸…æ™°ï¼‰router.push(&#123; name: &#x27;User&#x27;, params: &#123; id: &#x27;123&#x27; &#125; &#125;);// 4. æŸ¥è¯¢å‚æ•°ï¼šé€šè¿‡ query ä¼ é€’å‚æ•°ï¼ŒURL ä¼šæ˜¾ç¤ºä¸º /search?keyword=vuerouter.push(&#123; path: &#x27;/search&#x27;, query: &#123; keyword: &#x27;vue&#x27; &#125; &#125;);\n\n\nè·¯ç”±æ‡’åŠ è½½ï¼šä¼˜åŒ–åˆå§‹åŠ è½½æ€§èƒ½ï¼Œå‡å°‘é¦–å±åŠ è½½ä½“ç§¯ï¼Œé€šè¿‡åŠ¨æ€å¯¼å…¥ï¼ˆ() =&gt; import('ç»„ä»¶è·¯å¾„')ï¼‰çš„æ–¹å¼å®šä¹‰è·¯ç”±ç»„ä»¶ï¼Œåªæœ‰å½“è·¯ç”±è¢«è®¿é—®æ—¶æ‰ä¼šåŠ è½½å¯¹åº”ç»„ä»¶ï¼š\n&#123; path: &#x27;/admin&#x27;, component: () =&gt; import(&#x27;@/views/Admin.vue&#x27;) &#125;\n\n\n3. é«˜çº§ç‰¹æ€§\nVue Router æä¾› 4 ä¸ªé«˜çº§ç‰¹æ€§ï¼Œæ»¡è¶³å¤æ‚åœºæ™¯ä¸‹çš„è·¯ç”±æ§åˆ¶ä¸ä¸ªæ€§åŒ–éœ€æ±‚ï¼š\n\n\nå¯¼èˆªå®ˆå«ï¼šæ§åˆ¶è·¯ç”±è·³è½¬é€»è¾‘ï¼Œåˆ†ä¸º 3 ç±»ï¼Œåˆ†åˆ«ä½œç”¨äºå…¨å±€ã€å•ä¸ªè·¯ç”±å’Œç»„ä»¶å†…éƒ¨ï¼š\n\nå…¨å±€å®ˆå«ï¼šåœ¨ router/index.js ä¸­å®šä¹‰ï¼Œä½œç”¨äºæ‰€æœ‰è·¯ç”±ï¼ŒåŒ…æ‹¬å‰ç½®å®ˆå«ï¼ˆbeforeEachï¼Œè·³è½¬å‰æ‰§è¡Œï¼Œéœ€è°ƒç”¨ next() æ§åˆ¶è·³è½¬ï¼‰å’Œåç½®å®ˆå«ï¼ˆafterEachï¼Œè·³è½¬åæ‰§è¡Œï¼Œæ—  next()ï¼‰ï¼š// å…¨å±€å‰ç½®å®ˆå«ï¼šåˆ¤æ–­æ˜¯å¦éœ€è¦ç™»å½•router.beforeEach((to, from, next) =&gt; &#123;  if (to.meta.requiresAuth &amp;&amp; !isAuthenticated) &#123; // to.meta.requiresAuth æ¥è‡ªè·¯ç”±å…ƒä¿¡æ¯    next(&#x27;/login&#x27;); // æœªç™»å½•åˆ™é‡å®šå‘åˆ°ç™»å½•é¡µ  &#125; else &#123;    next(); // å·²ç™»å½•åˆ™æ”¾è¡Œ  &#125;&#125;);// å…¨å±€åç½®å®ˆå«ï¼šä¿®æ”¹é¡µé¢æ ‡é¢˜router.afterEach((to, from) =&gt; &#123;  document.title = to.meta.title || &#x27;é»˜è®¤æ ‡é¢˜&#x27;; // ä»è·¯ç”±å…ƒä¿¡æ¯è·å–æ ‡é¢˜&#125;);\n\nè·¯ç”±ç‹¬äº«å®ˆå«ï¼šåœ¨å•ä¸ªè·¯ç”±é…ç½®ä¸­å®šä¹‰ï¼Œä»…ä½œç”¨äºè¯¥è·¯ç”±ï¼Œé€šè¿‡ beforeEnter å®ç°ï¼š&#123;  path: &#x27;/admin&#x27;,  component: Admin,  beforeEnter: (to, from, next) =&gt; &#123;    // ä»…å¯¹ /admin è·¯ç”±ç”Ÿæ•ˆçš„éªŒè¯é€»è¾‘  &#125;&#125;\n\nç»„ä»¶å†…å®ˆå«ï¼šåœ¨ç»„ä»¶å†…éƒ¨å®šä¹‰ï¼Œä½œç”¨äºå½“å‰ç»„ä»¶å¯¹åº”çš„è·¯ç”±ï¼Œå¸¸ç”¨ onBeforeRouteLeaveï¼ˆç¦»å¼€ç»„ä»¶è·¯ç”±å‰æ‰§è¡Œï¼‰ï¼š&lt;script setup&gt;import &#123; onBeforeRouteLeave &#125; from &#x27;vue-router&#x27;;const unsavedChanges = true; // æ¨¡æ‹Ÿæœªä¿å­˜çš„ä¿®æ”¹onBeforeRouteLeave((to, from, next) =&gt; &#123;  if (unsavedChanges) &#123;    // æœ‰æœªä¿å­˜ä¿®æ”¹æ—¶ï¼Œæç¤ºç”¨æˆ·ç¡®è®¤    confirm(&#x27;ç¡®å®šç¦»å¼€ï¼Ÿæœªä¿å­˜çš„ä¿®æ”¹å°†ä¸¢å¤±ï¼&#x27;) ? next() : next(false);  &#125; else &#123;    next(); // æ— æœªä¿å­˜ä¿®æ”¹åˆ™æ”¾è¡Œ  &#125;&#125;);&lt;/script&gt;\n\n\n\n\nè·¯ç”±å…ƒä¿¡æ¯ï¼šä¸ºè·¯ç”±é™„åŠ é¢å¤–æ•°æ®ï¼ˆå¦‚æ˜¯å¦éœ€è¦ç™»å½•ã€é¡µé¢æ ‡é¢˜ï¼‰ï¼Œé€šè¿‡ meta å­—æ®µåœ¨è·¯ç”±é…ç½®ä¸­å®šä¹‰ï¼Œåœ¨å¯¼èˆªå®ˆå«ã€ç»„ä»¶ä¸­å¯é€šè¿‡ to.meta æˆ– route.meta è®¿é—®ï¼š\n&#123;  path: &#x27;/dashboard&#x27;,  meta: &#123;     requiresAuth: true, // æ ‡è®°è¯¥è·¯ç”±éœ€è¦ç™»å½•æ‰èƒ½è®¿é—®    title: &#x27;æ§åˆ¶å°&#x27; // è¯¥è·¯ç”±å¯¹åº”çš„é¡µé¢æ ‡é¢˜  &#125;&#125;\n\n\næ»šåŠ¨è¡Œä¸ºï¼šè‡ªå®šä¹‰é¡µé¢åˆ‡æ¢åçš„æ»šåŠ¨ä½ç½®ï¼Œåœ¨åˆ›å»ºè·¯ç”±å®ä¾‹æ—¶é€šè¿‡ scrollBehavior é…ç½®ï¼Œæ”¯æŒ 3 ç§åœºæ™¯ï¼šæ»šåŠ¨åˆ°é”šç‚¹ã€æ¢å¤ä¹‹å‰æ»šåŠ¨ä½ç½®ã€æ»šåŠ¨åˆ°é¡¶éƒ¨ï¼š\nconst router = createRouter(&#123;  scrollBehavior(to, from, savedPosition) &#123;    if (to.hash) &#123;      // è‹¥ç›®æ ‡è·¯ç”±æœ‰é”šç‚¹ï¼ˆå¦‚ /page#section1ï¼‰ï¼Œæ»šåŠ¨åˆ°é”šç‚¹ä½ç½®ï¼Œä¸”å¹³æ»‘æ»šåŠ¨      return &#123; el: to.hash, behavior: &#x27;smooth&#x27; &#125;;    &#125; else if (savedPosition) &#123;      // è‹¥å­˜åœ¨ä¹‹å‰çš„æ»šåŠ¨ä½ç½®ï¼ˆå¦‚æµè§ˆå™¨åé€€ï¼‰ï¼Œæ¢å¤è¯¥ä½ç½®      return savedPosition;    &#125; else &#123;      // å…¶ä»–æƒ…å†µï¼Œé»˜è®¤æ»šåŠ¨åˆ°é¡µé¢é¡¶éƒ¨      return &#123; top: 0 &#125;;    &#125;  &#125;&#125;);\n\n\nè·¯ç”±æ¨¡å¼ï¼šæ§åˆ¶ URL çš„è¡¨ç°å½¢å¼ï¼Œåˆ†ä¸º 2 ç§æ¨¡å¼ï¼Œå„æœ‰ç‰¹ç‚¹ï¼š\n\n\n\næ¨¡å¼ç±»å‹\næ ¸å¿ƒæ–¹æ³•\nç‰¹ç‚¹\né€‚ç”¨åœºæ™¯\n\n\n\n\nHash æ¨¡å¼\ncreateWebHashHistory()\nURL ä¸­å¸¦ #ï¼ˆå¦‚ http://xxx/#/homeï¼‰ï¼Œå…¼å®¹æ€§å¥½ï¼ˆæ”¯æŒæ‰€æœ‰æµè§ˆå™¨ï¼‰ï¼Œæ— éœ€æœåŠ¡å™¨é…ç½®\nå¯¹ URL ç¾è§‚åº¦è¦æ±‚ä¸é«˜ã€å…¼å®¹æ€§è¦æ±‚é«˜çš„åœºæ™¯\n\n\nHistory æ¨¡å¼\ncreateWebHistory()\nURL ä¸­æ—  #ï¼ˆå¦‚ http://xxx/homeï¼‰ï¼Œç¾è§‚åº¦é«˜ï¼Œä½†éœ€æœåŠ¡å™¨é…ç½®ï¼ˆå¦‚ Nginx é…ç½® fallback åˆ° index.htmlï¼‰ï¼Œå¦åˆ™åˆ·æ–°ä¼š 404\nå¯¹ URL ç¾è§‚åº¦è¦æ±‚é«˜ã€å¯é…ç½®æœåŠ¡å™¨çš„åœºæ™¯\n\n\n\n\n\n4. å¸¸è§åœºæ™¯å¤„ç†\né’ˆå¯¹è·¯ç”±ä½¿ç”¨ä¸­çš„ 3 ç§å¸¸è§åœºæ™¯ï¼ˆ404 é¡µé¢ã€è·¯ç”±é‡å®šå‘ã€è·¯ç”±åˆ«åï¼‰ï¼Œæä¾›å…·ä½“è§£å†³æ–¹æ¡ˆï¼š\n\n\n404 é¡µé¢ï¼šæ•è·æ‰€æœ‰æœªåŒ¹é…çš„è·¯ç”±ï¼Œæ˜¾ç¤º 404 é¡µé¢ï¼Œé€šè¿‡é€šé…ç¬¦ /:pathMatch(.*)* é…ç½®è·¯ç”±è·¯å¾„ï¼Œç¡®ä¿æ‰€æœ‰æœªå®šä¹‰çš„è·¯ç”±éƒ½æŒ‡å‘ 404 ç»„ä»¶ï¼š\n&#123; path: &#x27;/:pathMatch(.*)*&#x27;, component: NotFound &#125; // NotFound ä¸ºè‡ªå®šä¹‰ 404 ç»„ä»¶\n\n\nè·¯ç”±é‡å®šå‘ï¼šå°†ä¸€ä¸ªè·¯ç”±è·¯å¾„é‡å®šå‘åˆ°å¦ä¸€ä¸ªè·¯ç”±ï¼Œé€šè¿‡ redirect å­—æ®µé…ç½®ï¼Œæ”¯æŒ 2 ç§å½¢å¼ï¼ˆé‡å®šå‘åˆ°å›ºå®šè·¯å¾„ã€é‡å®šå‘åˆ°å‘½åè·¯ç”±ï¼‰ï¼š\n// 1. é‡å®šå‘åˆ°å›ºå®šè·¯å¾„ï¼šè®¿é—® /old æ—¶ï¼Œè‡ªåŠ¨è·³è½¬åˆ° /new&#123; path: &#x27;/old&#x27;, redirect: &#x27;/new&#x27; &#125;// 2. é‡å®šå‘åˆ°å‘½åè·¯ç”±ï¼šè®¿é—® /home æ—¶ï¼Œè‡ªåŠ¨è·³è½¬åˆ° name ä¸º Home çš„è·¯ç”±&#123; path: &#x27;/home&#x27;, redirect: &#123; name: &#x27;Home&#x27; &#125; &#125;\n\n\nè·¯ç”±åˆ«åï¼šä¸ºä¸€ä¸ªè·¯ç”±è·¯å¾„è®¾ç½®å¤šä¸ªè®¿é—®å…¥å£ï¼Œé€šè¿‡ alias å­—æ®µé…ç½®ï¼ˆæ”¯æŒå­—ç¬¦ä¸²å•ä¸ªåˆ«åã€æ•°ç»„å¤šä¸ªåˆ«åï¼‰ï¼Œè®¿é—®åˆ«åè·¯å¾„æ—¶ï¼Œä¼šæ¸²æŸ“åŸè·¯ç”±çš„ç»„ä»¶ï¼Œä¸”æµè§ˆå™¨åœ°å€æ ä¿æŒåˆ«åè·¯å¾„ï¼ˆä¸è·³è½¬ï¼‰ï¼š\n// é…ç½® /dashboard çš„åˆ«åä¸º /homeã€/mainã€/control-panelconst routes = [  &#123;    path: &#x27;/dashboard&#x27;, // åŸè·¯ç”±è·¯å¾„    component: Dashboard, // åŸè·¯ç”±ç»„ä»¶    alias: [&#x27;/home&#x27;, &#x27;/main&#x27;, &#x27;/control-panel&#x27;] // å¤šä¸ªåˆ«åï¼Œè®¿é—®ä»»æ„åˆ«åéƒ½æ¸²æŸ“ Dashboard ç»„ä»¶  &#125;];\nè·¯ç”±åˆ«åä¸é‡å®šå‘çš„æ ¸å¿ƒåŒºåˆ«ï¼š\n\n\n\nç‰¹æ€§\nè·¯ç”±åˆ«åï¼ˆaliasï¼‰\nè·¯ç”±é‡å®šå‘ï¼ˆredirectï¼‰\n\n\n\n\nURL å˜åŒ–\nåœ°å€æ æ˜¾ç¤ºåˆ«åè·¯å¾„ï¼Œä¸å˜åŒ–\nåœ°å€æ è·³è½¬åˆ°ç›®æ ‡è·¯å¾„ï¼Œå‘ç”Ÿå˜åŒ–\n\n\næœ¬è´¨\nå¤šå…¥å£è®¿é—®åŒä¸€ç»„ä»¶\nè·¯å¾„è·³è½¬\n\n\nåœºæ™¯\nå¤šè¯­è¨€æ”¯æŒã€ç®€åŒ– URLã€æ¨å¹¿é“¾æ¥è¿½è¸ª\næ—§è·¯å¾„è¿ç§»ã€ç»Ÿä¸€è®¿é—®å…¥å£\n\n\n\n\n\n5. ç»„åˆå¼ API ä½¿ç”¨\nVue 3 ä¸­æ¨èä½¿ç”¨ç»„åˆå¼ API æ“ä½œè·¯ç”±ï¼Œæ ¸å¿ƒæ˜¯ useRouter å’Œ useRoute ä¸¤ä¸ªé’©å­ï¼Œæ›¿ä»£ Vue 2 ä¸­çš„ $router å’Œ $routeï¼š\n\n\næ ¸å¿ƒ API è¯´æ˜ï¼š\n\nuseRouterï¼šè·å–è·¯ç”±å®ä¾‹ï¼Œç”¨äºæ‰§è¡Œè·¯ç”±è·³è½¬æ“ä½œï¼ˆå¦‚ pushã€replaceï¼‰ï¼›\nuseRouteï¼šè·å–å½“å‰è·¯ç”±ä¿¡æ¯ï¼Œç”¨äºè®¿é—®è·¯ç”±å‚æ•°ï¼ˆqueryã€paramsï¼‰ã€è·¯ç”±å…ƒä¿¡æ¯ï¼ˆmetaï¼‰ç­‰ã€‚\n\n\n\nä½¿ç”¨ç¤ºä¾‹ï¼š\n&lt;script setup&gt;import &#123; useRouter, useRoute &#125; from &#x27;vue-router&#x27;;// è·å–è·¯ç”±å®ä¾‹å’Œå½“å‰è·¯ç”±ä¿¡æ¯const router = useRouter();const route = useRoute();// 1. è·¯ç”±è·³è½¬ï¼šç‚¹å‡»æŒ‰é’®è·³è½¬åˆ° /about è·¯ç”±const goToAbout = () =&gt; &#123;  router.push(&#x27;/about&#x27;);&#125;;// 2. è·å–è·¯ç”±å‚æ•°ï¼šè·å– URL ä¸­çš„ query å‚æ•° idï¼ˆå¦‚ /page?id=123ï¼‰console.log(route.query.id); // è¾“å‡º &#x27;123&#x27;// 3. è·å–åŠ¨æ€è·¯ç”±å‚æ•°ï¼šè·å– /user/:id ä¸­çš„ idï¼ˆå¦‚ /user/456ï¼‰console.log(route.params.id); // è¾“å‡º &#x27;456&#x27;&lt;/script&gt;\n\n\n6. è·¯ç”±ä¼ å‚\nVue Router æä¾› 3 ç§è·¯ç”±ä¼ å‚æ–¹å¼ï¼Œåˆ†åˆ«æ˜¯ Query å‚æ•°ã€Params å‚æ•°å’Œ Props è§£è€¦ï¼Œé€‚ç”¨äºä¸åŒåœºæ™¯ï¼š\n\n\nQuery å‚æ•°ï¼šé€šè¿‡ URL çš„æŸ¥è¯¢å­—ç¬¦ä¸²ï¼ˆ? åçš„éƒ¨åˆ†ï¼‰ä¼ é€’å‚æ•°ï¼Œç‰¹ç‚¹æ˜¯å‚æ•°å¯è§ã€æ— éœ€é¢„å…ˆåœ¨è·¯ç”±é…ç½®ä¸­å£°æ˜ï¼Œé€‚åˆä¼ é€’éæ•æ„Ÿã€å¯é€‰çš„å‚æ•°ï¼ˆå¦‚ç­›é€‰æ¡ä»¶ã€åˆ†é¡µä¿¡æ¯ï¼‰ï¼š\n\nä¼ é€’å‚æ•°ï¼šé€šè¿‡ router.push() ä¼ å…¥å« query çš„å¯¹è±¡ï¼šimport &#123; useRouter &#125; from &#x27;vue-router&#x27;;const router = useRouter();// ä¼ é€’ keyword å’Œ sort ä¸¤ä¸ª Query å‚æ•°router.push(&#123;  path: &#x27;/search&#x27;, // ç›®æ ‡è·¯ç”±è·¯å¾„  query: &#123; keyword: &#x27;vue&#x27;, sort: &#x27;desc&#x27; &#125; // Query å‚æ•°å¯¹è±¡&#125;);// ç”Ÿæˆçš„ URLï¼š/search?keyword=vue&amp;sort=desc\n\næ¥æ”¶å‚æ•°ï¼šåœ¨ç›®æ ‡ç»„ä»¶ä¸­ï¼Œé€šè¿‡ useRoute() è·å– route.queryï¼šimport &#123; useRoute &#125; from &#x27;vue-router&#x27;;const route = useRoute();const keyword = route.query.keyword; // å–å€¼ &#x27;vue&#x27;const sort = route.query.sort; // å–å€¼ &#x27;desc&#x27;\n\n\n\n\nParams å‚æ•°ï¼šé€šè¿‡ URL è·¯å¾„çš„åŠ¨æ€æ®µä¼ é€’å‚æ•°ï¼Œç‰¹ç‚¹æ˜¯å‚æ•°éœ€åœ¨è·¯ç”±é…ç½®ä¸­é¢„å…ˆå£°æ˜ï¼ˆç”¨ : å®šä¹‰ï¼‰ã€å‚æ•°å¯è§ï¼Œé€‚åˆä¼ é€’å¿…è¦ã€ç»“æ„åŒ–çš„å‚æ•°ï¼ˆå¦‚èµ„æº IDï¼‰ï¼š\n\nè·¯ç”±é…ç½®ï¼šå…ˆåœ¨ path ä¸­ç”¨ : å£°æ˜åŠ¨æ€å‚æ•°ï¼ˆå¦‚ userIdã€postIdï¼‰ï¼šconst routes = [  &#123;    path: &#x27;/user/:userId/post/:postId&#x27;, // å£°æ˜ 2 ä¸ªåŠ¨æ€å‚æ•°ï¼šuserId å’Œ postId    component: UserPost, // ç›®æ ‡ç»„ä»¶    name: &#x27;UserPost&#x27; // è·¯ç”±åç§°ï¼Œç”¨äºç¼–ç¨‹å¼å¯¼èˆª  &#125;];\n\nä¼ é€’å‚æ•°ï¼šæ”¯æŒ 2 ç§æ–¹å¼ï¼ˆä½¿ç”¨å‘½åè·¯ç”±ã€ä½¿ç”¨è·¯å¾„æ‹¼æ¥ï¼‰ï¼šimport &#123; useRouter &#125; from &#x27;vue-router&#x27;;const router = useRouter();const userId = 123;const postId = 456;// æ–¹å¼ 1ï¼šä½¿ç”¨å‘½åè·¯ç”±ï¼ˆæ¨èï¼Œå‚æ•°ä¸è·¯å¾„è§£è€¦ï¼‰router.push(&#123;  name: &#x27;UserPost&#x27;, // åŒ¹é…è·¯ç”±çš„ name  params: &#123; userId, postId &#125; // Params å‚æ•°å¯¹è±¡ï¼Œä¸è·¯ç”±å£°æ˜çš„å‚æ•°å¯¹åº”&#125;);// æ–¹å¼ 2ï¼šä½¿ç”¨è·¯å¾„æ‹¼æ¥ï¼ˆéœ€æ‰‹åŠ¨æ‹¼æ¥å‚æ•°ï¼‰router.push(`/user/$&#123;userId&#125;/post/$&#123;postId&#125;`);// ç”Ÿæˆçš„ URLï¼š/user/123/post/456\n\næ¥æ”¶å‚æ•°ï¼šåœ¨ç›®æ ‡ç»„ä»¶ä¸­ï¼Œé€šè¿‡ useRoute() è·å– route.paramsï¼šimport &#123; useRoute &#125; from &#x27;vue-router&#x27;;const route = useRoute();const userId = route.params.userId; // å–å€¼ &#x27;123&#x27;ï¼ˆæ³¨æ„ï¼šParams å‚æ•°å€¼ä¸ºå­—ç¬¦ä¸²ç±»å‹ï¼‰const postId = route.params.postId; // å–å€¼ &#x27;456&#x27;\n\n\n\n\nProps è§£è€¦ï¼šè®©ç»„ä»¶ä¸ç›´æ¥ä¾èµ– $route æˆ– useRoute()ï¼Œé€šè¿‡ props æ¥æ”¶è·¯ç”±å‚æ•°ï¼Œæå‡ç»„ä»¶å¤ç”¨æ€§å’Œå¯æµ‹è¯•æ€§ï¼Œä»…æ”¯æŒ Params å‚æ•°ï¼š\n\nè·¯ç”±é…ç½®ï¼šåœ¨è·¯ç”±ä¸­è®¾ç½® props: trueï¼ŒVue Router ä¼šè‡ªåŠ¨å°† Params å‚æ•°è½¬æ¢ä¸ºç»„ä»¶çš„ propsï¼š&#123;  path: &#x27;/user/:id&#x27;, // å£°æ˜åŠ¨æ€å‚æ•° id  component: UserDetail,  props: true // å¼€å¯ Props ä¼ å‚ï¼ŒParams å‚æ•°ä¼šä½œä¸º props ä¼ å…¥ç»„ä»¶&#125;\n\nç»„ä»¶æ¥æ”¶ï¼šåœ¨ç»„ä»¶ä¸­é€šè¿‡ props æ¥æ”¶å‚æ•°ï¼Œåƒä½¿ç”¨æ™®é€š props ä¸€æ ·ä½¿ç”¨ï¼š// é€‰é¡¹å¼ APIexport default &#123;  props: [&#x27;id&#x27;], // å£°æ˜æ¥æ”¶ id props  setup(props) &#123;    console.log(props.id); // ç›´æ¥ä½¿ç”¨å‚æ•°ï¼Œæ— éœ€ä¾èµ– useRoute()  &#125;&#125;;// ç»„åˆå¼ APIï¼ˆ&lt;script setup&gt;ï¼‰const props = defineProps([&#x27;id&#x27;]);console.log(props.id); // ç›´æ¥ä½¿ç”¨å‚æ•°\n\n\n\n\nä¸‰ç§ä¼ å‚æ–¹å¼å¯¹æ¯”ï¼š\n\n\n\nå¯¹æ¯”ç»´åº¦\nQuery å‚æ•°\nParams å‚æ•°\nProps è§£è€¦\n\n\n\n\nURL è¡¨ç°\n?key=valueï¼ˆæŸ¥è¯¢å­—ç¬¦ä¸²ï¼‰\n/path/valueï¼ˆè·¯å¾„åŠ¨æ€æ®µï¼‰\nåŒ Params å‚æ•°\n\n\nè·¯ç”±é…ç½®ä¾èµ–\næ— éœ€é¢„å…ˆå£°æ˜\néœ€åœ¨ path ä¸­ç”¨ : å£°æ˜\néœ€åœ¨ path ä¸­ç”¨ : å£°æ˜ï¼Œä¸”è·¯ç”±éœ€è®¾ props: true\n\n\nå‚æ•°ç±»å‹\nå­—ç¬¦ä¸²ï¼ˆè‡ªåŠ¨è½¬æ¢åŸºæœ¬ç±»å‹ï¼‰\nå­—ç¬¦ä¸²ï¼ˆéœ€æ‰‹åŠ¨è½¬æ¢ç±»å‹ï¼‰\nåŒ Params å‚æ•°ï¼Œä½†é€šè¿‡ props å¯å®šä¹‰ç±»å‹\n\n\nç»„ä»¶ä¾èµ–\nä¾èµ– useRoute()\nä¾èµ– useRoute()\nä¸ä¾èµ– useRoute()ï¼Œä¾èµ– props\n\n\né€‚ç”¨åœºæ™¯\nå¯é€‰å‚æ•°ã€ç­›é€‰æ¡ä»¶ã€åˆ†é¡µ\nèµ„æº IDã€å¿…è¦æ ‡è¯†ç¬¦\nç»„ä»¶å¤ç”¨æ€§è¦æ±‚é«˜çš„åœºæ™¯ï¼ˆå¦‚ç‹¬ç«‹ç»„ä»¶åº“ï¼‰\n\n\n\n\n\n7. æ³¨æ„äº‹é¡¹\nä½¿ç”¨ Vue Router æ—¶éœ€æ³¨æ„ 3 ä¸ªå…³é”®é—®é¢˜ï¼Œé¿å…åŠŸèƒ½å¼‚å¸¸æˆ–æ€§èƒ½é—®é¢˜ï¼š\n\n\nè·¯ç”±å‚æ•°å˜åŒ–æ—¶ç»„ä»¶å¤ç”¨ï¼šå½“è·¯ç”±å‚æ•°å˜åŒ–ï¼ˆå¦‚ä» /user/123 è·³è½¬åˆ° /user/456ï¼‰ï¼Œç»„ä»¶ä¼šå¤ç”¨ï¼ˆä¸ä¼šé‡æ–°åˆ›å»ºï¼‰ï¼Œè‹¥éœ€ç›‘å¬å‚æ•°å˜åŒ–ï¼Œéœ€ä½¿ç”¨ beforeRouteUpdate å®ˆå«æˆ–ç›‘å¬ route.paramsï¼š\n// æ–¹å¼ 1ï¼šä½¿ç”¨ beforeRouteUpdate å®ˆå«onBeforeRouteUpdate((to, from) =&gt; &#123;  console.log(&#x27;å‚æ•°å˜åŒ–ï¼š&#x27;, to.params.id);&#125;);// æ–¹å¼ 2ï¼šç›‘å¬ route.paramswatch(() =&gt; route.params.id, (newId) =&gt; &#123;  console.log(&#x27;å‚æ•°å˜åŒ–ï¼š&#x27;, newId);&#125;);\n\n\nHistory æ¨¡å¼éƒ¨ç½²ï¼šHistory æ¨¡å¼ä¸‹ï¼Œåˆ·æ–°é¡µé¢ä¼šå‘æœåŠ¡å™¨å‘é€è¯·æ±‚ï¼Œè‹¥æœåŠ¡å™¨æœªé…ç½® fallback åˆ° index.htmlï¼Œä¼šè¿”å› 404ã€‚éœ€é…ç½®æœåŠ¡å™¨ï¼ˆå¦‚ Nginxï¼‰ï¼š\nlocation / &#123;  try_files $uri $uri/ /index.html;&#125;\n\n\nå¯¼èˆªå®ˆå«å¼‚æ­¥æ“ä½œï¼šè‹¥å¯¼èˆªå®ˆå«ä¸­å­˜åœ¨å¼‚æ­¥æ“ä½œï¼ˆå¦‚è¯·æ±‚æ¥å£éªŒè¯æƒé™ï¼‰ï¼Œéœ€ç¡®ä¿ next() ä»…è°ƒç”¨ä¸€æ¬¡ï¼Œé¿å…å¤šæ¬¡è·³è½¬ã€‚å¯é€šè¿‡ async/await å¤„ç†ï¼š\nrouter.beforeEach(async (to, from, next) =&gt; &#123;  const isAuthenticated = await checkAuth(); // å¼‚æ­¥éªŒè¯æƒé™  if (to.meta.requiresAuth &amp;&amp; !isAuthenticated) &#123;    next(&#x27;/login&#x27;);  &#125; else &#123;    next();  &#125;&#125;);\n\n\n\nå…³é”®é—®é¢˜\né—®é¢˜ 1ï¼šVue Router ä¸­ Query å‚æ•°å’Œ Params å‚æ•°çš„æ ¸å¿ƒåŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿåœ¨å®é™…é¡¹ç›®ä¸­å¦‚ä½•é€‰æ‹©ï¼Ÿ\nç­”æ¡ˆï¼š\nä¸¤è€…æ ¸å¿ƒåŒºåˆ«ä½“ç°åœ¨ è·¯ç”±é…ç½®ä¾èµ–ã€URL è¡¨ç° å’Œ é€‚ç”¨åœºæ™¯ ä¸Šï¼Œå…·ä½“å¦‚ä¸‹ï¼š\n\n\nè·¯ç”±é…ç½®ä¾èµ–ï¼šQuery å‚æ•°æ— éœ€åœ¨è·¯ç”± path ä¸­é¢„å…ˆå£°æ˜ï¼Œç›´æ¥é€šè¿‡ router.push({path, query}) ä¼ é€’ï¼›Params å‚æ•°å¿…é¡»åœ¨è·¯ç”± path ä¸­ç”¨ : å£°æ˜åŠ¨æ€æ®µï¼ˆå¦‚ /user/:idï¼‰ï¼Œå¦åˆ™æ— æ³•ä¼ é€’ã€‚\n\n\nURL è¡¨ç°ï¼šQuery å‚æ•°æ˜¾ç¤ºåœ¨ URL çš„æŸ¥è¯¢å­—ç¬¦ä¸²ä¸­ï¼ˆå¦‚ /search?keyword=vueï¼‰ï¼›Params å‚æ•°ä½œä¸º URL è·¯å¾„çš„ä¸€éƒ¨åˆ†ï¼ˆå¦‚ /user/123ï¼‰ã€‚\n\n\nå‚æ•°ç¨³å®šæ€§ï¼šä¸¤è€…åˆ·æ–°é¡µé¢åå‚æ•°å‡ä¿ç•™ï¼Œä½† Query å‚æ•°æ›´é€‚åˆä¼ é€’å¯é€‰ã€éç»“æ„åŒ–æ•°æ®ï¼ŒParams å‚æ•°æ›´é€‚åˆä¼ é€’å¿…è¦ã€ç»“æ„åŒ–æ•°æ®ï¼ˆå¦‚èµ„æº IDï¼‰ã€‚\n\n\nå®é™…é€‰æ‹©æ—¶ï¼š\n\n\nè‹¥å‚æ•°ä¸º å¯é€‰ã€éæ•æ„Ÿï¼ˆå¦‚ç­›é€‰æ¡ä»¶ã€åˆ†é¡µé¡µç ã€æœç´¢å…³é”®è¯ï¼‰ï¼Œé€‰ Query å‚æ•°ï¼›\n\n\nè‹¥å‚æ•°ä¸º å¿…è¦ã€æ ‡è¯†èµ„æºï¼ˆå¦‚ç”¨æˆ· IDã€æ–‡ç«  IDï¼‰ï¼Œé€‰ Params å‚æ•°ï¼Œä½¿ URL æ›´ç¬¦åˆ RESTful è§„èŒƒã€‚\n\n\né—®é¢˜ 2ï¼šVue Router çš„å¯¼èˆªå®ˆå«æœ‰å“ªå‡ ç±»ï¼Ÿåˆ†åˆ«é€‚ç”¨äºä»€ä¹ˆåœºæ™¯ï¼Ÿ\nç­”æ¡ˆï¼š\nVue Router å¯¼èˆªå®ˆå«åˆ†ä¸º å…¨å±€å®ˆå«ã€è·¯ç”±ç‹¬äº«å®ˆå« å’Œ ç»„ä»¶å†…å®ˆå« ä¸‰ç±»ï¼Œé€‚ç”¨åœºæ™¯å„æœ‰ä¸åŒï¼š\n\n\nå…¨å±€å®ˆå«ï¼šä½œç”¨äºæ‰€æœ‰è·¯ç”±ï¼Œå®šä¹‰åœ¨ router/index.js ä¸­ï¼ŒåŒ…æ‹¬ beforeEachï¼ˆè·³è½¬å‰ï¼‰å’Œ afterEachï¼ˆè·³è½¬åï¼‰ï¼š\n\né€‚ç”¨åœºæ™¯ï¼šå…¨å±€æƒé™æ§åˆ¶ï¼ˆå¦‚ç™»å½•éªŒè¯ï¼‰ã€å…¨å±€é¡µé¢æ ‡é¢˜ä¿®æ”¹ã€å…¨å±€åŸ‹ç‚¹ç»Ÿè®¡ã€‚\n\n\n\nè·¯ç”±ç‹¬äº«å®ˆå«ï¼šä»…ä½œç”¨äºå•ä¸ªè·¯ç”±ï¼Œé€šè¿‡è·¯ç”±é…ç½®çš„ beforeEnter å®šä¹‰ï¼š\n\né€‚ç”¨åœºæ™¯ï¼šå•ä¸ªè·¯ç”±çš„ç‰¹æ®Šæƒé™éªŒè¯ï¼ˆå¦‚ç®¡ç†å‘˜é¡µé¢é¢å¤–éªŒè¯è§’è‰²ï¼‰ã€ç‰¹å®šè·¯ç”±çš„è·³è½¬é™åˆ¶ã€‚\n\n\n\nç»„ä»¶å†…å®ˆå«ï¼šä½œç”¨äºç»„ä»¶å¯¹åº”çš„è·¯ç”±ï¼Œå®šä¹‰åœ¨ç»„ä»¶å†…éƒ¨ï¼Œå¸¸ç”¨ onBeforeRouteLeaveï¼ˆç¦»å¼€è·¯ç”±å‰ï¼‰ï¼š\n\né€‚ç”¨åœºæ™¯ï¼šç»„ä»¶å†…æœªä¿å­˜ä¿®æ”¹çš„æç¤ºï¼ˆå¦‚è¡¨å•æœªæäº¤æ—¶ç¦»å¼€é¡µé¢ï¼‰ã€ç»„ä»¶é”€æ¯å‰çš„èµ„æºæ¸…ç†ï¼ˆå¦‚å–æ¶ˆè¯·æ±‚ï¼‰ã€‚\n\n\n\né—®é¢˜ 3ï¼šVue Router ä¸­è·¯ç”±æ‡’åŠ è½½çš„å®ç°åŸç†æ˜¯ä»€ä¹ˆï¼Ÿå¦‚ä½•ç»“åˆè·¯ç”±åˆ†ç»„è¿›ä¸€æ­¥ä¼˜åŒ–æ€§èƒ½ï¼Ÿ\nç­”æ¡ˆï¼š\n\n\nå®ç°åŸç†ï¼šè·¯ç”±æ‡’åŠ è½½åŸºäº ES6 çš„ åŠ¨æ€å¯¼å…¥è¯­æ³•ï¼ˆ() =&gt; import('ç»„ä»¶è·¯å¾„')ï¼‰ï¼Œåœ¨åˆå§‹æ‰“åŒ…æ—¶ï¼Œæ‡’åŠ è½½çš„è·¯ç”±ç»„ä»¶ä¼šè¢«åˆ†å‰²æˆç‹¬ç«‹çš„ä»£ç å—ï¼ˆchunkï¼‰ï¼Œè€Œéæ‰“åŒ…è¿›ä¸»æ–‡ä»¶ï¼›åªæœ‰å½“ç”¨æˆ·è®¿é—®è¯¥è·¯ç”±æ—¶ï¼Œæµè§ˆå™¨æ‰ä¼šå¼‚æ­¥åŠ è½½å¯¹åº”çš„ä»£ç å—ï¼Œä»è€Œå‡å°‘é¦–å±åŠ è½½ä½“ç§¯ï¼Œæå‡åˆå§‹åŠ è½½é€Ÿåº¦ã€‚\n\n\nç»“åˆè·¯ç”±åˆ†ç»„ä¼˜åŒ–æ€§èƒ½ï¼šå½“å¤šä¸ªè·¯ç”±å±äºåŒä¸€åŠŸèƒ½æ¨¡å—ï¼ˆå¦‚ç”¨æˆ·ç›¸å…³çš„ /user/loginã€/user/registerã€/user/profileï¼‰ï¼Œå¯é€šè¿‡ å‘½åä»£ç å— å°†å®ƒä»¬åˆ†ç»„æ‰“åŒ…ï¼Œé¿å…ç”Ÿæˆè¿‡å¤šå°ä»£ç å—ï¼ˆå‡å°‘ HTTP è¯·æ±‚æ•°ï¼‰ã€‚å®ç°æ–¹å¼æ˜¯åœ¨åŠ¨æ€å¯¼å…¥æ—¶æ·»åŠ  /* webpackChunkName: &quot;group-user&quot; */ æ³¨é‡Šï¼ˆwebpack æ”¯æŒï¼‰ï¼š\nconst routes = [  // ç”¨æˆ·æ¨¡å—è·¯ç”±ï¼Œæ‰“åŒ…ä¸ºåä¸º &quot;group-user&quot; çš„ä»£ç å—  &#123; path: &#x27;/user/login&#x27;, component: () =&gt; import(/* webpackChunkName: &quot;group-user&quot; */ &#x27;@/views/user/Login.vue&#x27;) &#125;,  &#123; path: &#x27;/user/register&#x27;, component: () =&gt; import(/* webpackChunkName: &quot;group-user&quot; */ &#x27;@/views/user/Register.vue&#x27;) &#125;,  &#123; path: &#x27;/user/profile&#x27;, component: () =&gt; import(/* webpackChunkName: &quot;group-user&quot; */ &#x27;@/views/user/Profile.vue&#x27;) &#125;,  // å…¶ä»–æ¨¡å—è·¯ç”±ï¼Œæ‰“åŒ…ä¸ºå…¶ä»–ä»£ç å—  &#123; path: &#x27;/admin/dashboard&#x27;, component: () =&gt; import(/* webpackChunkName: &quot;group-admin&quot; */ &#x27;@/views/admin/Dashboard.vue&#x27;) &#125;];\nä¼˜åŒ–æ•ˆæœï¼šè®¿é—®ç”¨æˆ·æ¨¡å—ä»»æ„è·¯ç”±æ—¶ï¼Œä¼šåŠ è½½ â€œgroup-userâ€ ä»£ç å—ï¼Œåç»­è®¿é—®è¯¥æ¨¡å—å…¶ä»–è·¯ç”±æ— éœ€é‡å¤åŠ è½½ï¼Œå‡å°‘ HTTP è¯·æ±‚ï¼Œæå‡åç»­è®¿é—®é€Ÿåº¦ã€‚\n\n\n","categories":["ç¼–ç¨‹"],"tags":["Web"]},{"title":"VueåŸºæœ¬ç»„ä»¶","url":"/2025/09/09/web/Vue.js%20%E5%9F%BA%E6%9C%AC%E7%BB%84%E4%BB%B6%E6%95%B4%E7%90%86/","content":"\nå¦‚é¢˜ï¼Œç»“åˆå®˜æ–¹æ–‡æ¡£ä¸ç½‘ç»œå¸–å­ï¼Œåˆ©ç”¨AIæ•´ç†\n\n\nVue.js åŸºæœ¬ç»„ä»¶å±æ€§ä¸æ–¹æ³•è®²è§£\nç›®å½•\n\n\n1. Button æŒ‰é’®\n\n\n2. Input è¾“å…¥æ¡†\n\n\n3. Form è¡¨å•\n\n\n4. Table è¡¨æ ¼\n\n\n5. Checkbox å¤é€‰æ¡†\n\n\n6. Radio å•é€‰æ¡†\n\n\n7. Select ä¸‹æ‹‰é€‰æ‹©å™¨\n\n\n8. ç»„ä»¶é€šä¿¡\n\n\n\n1. Button æŒ‰é’®\nä¸»è¦å±æ€§\n\n\n\nå±æ€§å\nç±»å‹\né»˜è®¤å€¼\nè¯´æ˜\n\n\n\n\ntype\nString\nâ€˜buttonâ€™\næŒ‰é’®ç±»å‹ï¼Œå¯é€‰å€¼ï¼šâ€˜buttonâ€™ã€â€˜submitâ€™ã€â€˜resetâ€™\n\n\nvariant\nString\nâ€˜primaryâ€™\næŒ‰é’®æ ·å¼å˜ä½“ï¼Œå¯é€‰å€¼ï¼šâ€˜primaryâ€™ã€â€˜secondaryâ€™ã€â€˜dangerâ€™ã€â€˜successâ€™\n\n\nsize\nString\nâ€˜mediumâ€™\næŒ‰é’®å°ºå¯¸ï¼Œå¯é€‰å€¼ï¼šâ€˜smallâ€™ã€â€˜mediumâ€™ã€â€˜largeâ€™\n\n\ndisabled\nBoolean\nfalse\næ˜¯å¦ç¦ç”¨æŒ‰é’®\n\n\nloading\nBoolean\nfalse\næ˜¯å¦æ˜¾ç¤ºåŠ è½½çŠ¶æ€\n\n\ntext\nString\nâ€˜æŒ‰é’®â€™\næŒ‰é’®æ–‡æœ¬å†…å®¹\n\n\nicon\nString\n-\næŒ‰é’®å›¾æ ‡\n\n\n\nä¸»è¦æ–¹æ³•\n\n\n\næ–¹æ³•å\nå‚æ•°\nè¯´æ˜\n\n\n\n\nhandleClick\n-\nç‚¹å‡»äº‹ä»¶å¤„ç†å‡½æ•°\n\n\nhandleSubmit\n-\næäº¤äº‹ä»¶å¤„ç†å‡½æ•°ï¼ˆä»…å½“typeä¸ºâ€™submitâ€™æ—¶æœ‰æ•ˆï¼‰\n\n\n\näº‹ä»¶\n\n\nclick: ç‚¹å‡»äº‹ä»¶\n\n\nsubmit: æäº¤äº‹ä»¶\n\n\nä½¿ç”¨ç¤ºä¾‹\n&lt;template&gt;  &lt;div&gt;    &lt;BaseButton       variant=&quot;primary&quot;      size=&quot;large&quot;      :loading=&quot;isLoading&quot;      @click=&quot;handleClick&quot;    &gt;      æäº¤    &lt;/BaseButton&gt;        &lt;BaseButton       variant=&quot;danger&quot;      :disabled=&quot;!canDelete&quot;      @click=&quot;handleDelete&quot;    &gt;      åˆ é™¤    &lt;/BaseButton&gt;  &lt;/div&gt;&lt;/template&gt;&lt;script&gt;export default &#123;  data() &#123;    return &#123;      isLoading: false,      canDelete: true    &#125;  &#125;,  methods: &#123;    handleClick() &#123;      this.isLoading = true      // å¤„ç†é€»è¾‘      setTimeout(() =&gt; &#123;        this.isLoading = false      &#125;, 2000)    &#125;,    handleDelete() &#123;      if (confirm(&#x27;ç¡®å®šè¦åˆ é™¤å—ï¼Ÿ&#x27;)) &#123;        // åˆ é™¤é€»è¾‘      &#125;    &#125;  &#125;&#125;&lt;/script&gt;\n\n2. Input è¾“å…¥æ¡†\nä¸»è¦å±æ€§\n\n\n\nå±æ€§å\nç±»å‹\né»˜è®¤å€¼\nè¯´æ˜\n\n\n\n\nmodelValue\nString/Number\nâ€˜â€™\nç»‘å®šå€¼ï¼ˆv-modelï¼‰\n\n\ntype\nString\nâ€˜textâ€™\nè¾“å…¥æ¡†ç±»å‹\n\n\nlabel\nString\nâ€˜â€™\næ ‡ç­¾æ–‡æœ¬\n\n\nplaceholder\nString\nâ€˜â€™\nå ä½æ–‡æœ¬\n\n\ndisabled\nBoolean\nfalse\næ˜¯å¦ç¦ç”¨\n\n\nreadonly\nBoolean\nfalse\næ˜¯å¦åªè¯»\n\n\nrequired\nBoolean\nfalse\næ˜¯å¦å¿…å¡«\n\n\nmaxlength\nNumber\n-\næœ€å¤§è¾“å…¥é•¿åº¦\n\n\nminlength\nNumber\n-\næœ€å°è¾“å…¥é•¿åº¦\n\n\npattern\nRegExp\n-\næ­£åˆ™è¡¨è¾¾å¼éªŒè¯\n\n\nerrorMessage\nString\nâ€˜â€™\né”™è¯¯æç¤ºä¿¡æ¯\n\n\n\nä¸»è¦æ–¹æ³•\n\n\n\næ–¹æ³•å\nå‚æ•°\nè¯´æ˜\n\n\n\n\nhandleInput\nevent\nè¾“å…¥äº‹ä»¶å¤„ç†\n\n\nhandleFocus\n-\nè·å¾—ç„¦ç‚¹äº‹ä»¶\n\n\nhandleBlur\n-\nå¤±å»ç„¦ç‚¹äº‹ä»¶\n\n\nvalidate\n-\néªŒè¯è¾“å…¥å†…å®¹\n\n\n\näº‹ä»¶\n\n\ninput: è¾“å…¥äº‹ä»¶\n\n\nfocus: è·å¾—ç„¦ç‚¹äº‹ä»¶\n\n\nblur: å¤±å»ç„¦ç‚¹äº‹ä»¶\n\n\nvalidate: éªŒè¯äº‹ä»¶\n\n\nä½¿ç”¨ç¤ºä¾‹\n&lt;template&gt;  &lt;div&gt;    &lt;BaseInput      v-model=&quot;username&quot;      label=&quot;ç”¨æˆ·å&quot;      placeholder=&quot;è¯·è¾“å…¥ç”¨æˆ·å&quot;      required      :pattern=&quot;/^[a-zA-Z0-9_]&#123;4,16&#125;$/&quot;      @validate=&quot;handleValidate&quot;    /&gt;        &lt;BaseInput      v-model=&quot;password&quot;      type=&quot;password&quot;      label=&quot;å¯†ç &quot;      placeholder=&quot;è¯·è¾“å…¥å¯†ç &quot;      required      :errorMessage=&quot;passwordError&quot;    /&gt;  &lt;/div&gt;&lt;/template&gt;&lt;script&gt;export default &#123;  data() &#123;    return &#123;      username: &#x27;&#x27;,      password: &#x27;&#x27;,      passwordError: &#x27;&#x27;    &#125;  &#125;,  methods: &#123;    handleValidate(isValid) &#123;      console.log(&#x27;ç”¨æˆ·åéªŒè¯ç»“æœ:&#x27;, isValid)    &#125;  &#125;&#125;&lt;/script&gt;\n\n3. Form è¡¨å•\nä¸»è¦å±æ€§\n\n\n\nå±æ€§å\nç±»å‹\né»˜è®¤å€¼\nè¯´æ˜\n\n\n\n\nmodel\nObject\n{}\nè¡¨å•æ•°æ®å¯¹è±¡\n\n\nrules\nObject\n{}\néªŒè¯è§„åˆ™\n\n\nsubmitText\nString\nâ€˜æäº¤â€™\næäº¤æŒ‰é’®æ–‡æœ¬\n\n\nlabelWidth\nString/Number\nâ€˜120pxâ€™\næ ‡ç­¾å®½åº¦\n\n\ninline\nBoolean\nfalse\næ˜¯å¦è¡Œå†…è¡¨å•\n\n\n\nä¸»è¦æ–¹æ³•\n\n\n\næ–¹æ³•å\nå‚æ•°\nè¯´æ˜\n\n\n\n\nvalidate\n-\néªŒè¯è¡¨å•\n\n\nhandleSubmit\n-\næäº¤è¡¨å•\n\n\nhandleReset\n-\né‡ç½®è¡¨å•\n\n\nclearError\nfield\næ¸…é™¤æŒ‡å®šå­—æ®µé”™è¯¯\n\n\n\näº‹ä»¶\n\n\nsubmit: è¡¨å•æäº¤äº‹ä»¶\n\n\nreset: è¡¨å•é‡ç½®äº‹ä»¶\n\n\ninvalid: è¡¨å•éªŒè¯å¤±è´¥äº‹ä»¶\n\n\nä½¿ç”¨ç¤ºä¾‹\n&lt;template&gt;  &lt;BaseForm    :model=&quot;form&quot;    :rules=&quot;rules&quot;    @submit=&quot;handleSubmit&quot;    @invalid=&quot;handleInvalid&quot;  &gt;    &lt;BaseInput      v-model=&quot;form.username&quot;      label=&quot;ç”¨æˆ·å&quot;      placeholder=&quot;è¯·è¾“å…¥ç”¨æˆ·å&quot;    /&gt;        &lt;BaseInput      v-model=&quot;form.email&quot;      type=&quot;email&quot;      label=&quot;é‚®ç®±&quot;      placeholder=&quot;è¯·è¾“å…¥é‚®ç®±&quot;    /&gt;        &lt;template #actions&gt;      &lt;BaseButton type=&quot;primary&quot; @click=&quot;$parent.handleSubmit&quot;&gt;        æäº¤      &lt;/BaseButton&gt;      &lt;BaseButton type=&quot;secondary&quot; @click=&quot;$parent.handleReset&quot;&gt;        é‡ç½®      &lt;/BaseButton&gt;    &lt;/template&gt;  &lt;/BaseForm&gt;&lt;/template&gt;&lt;script&gt;export default &#123;  data() &#123;    return &#123;      form: &#123;        username: &#x27;&#x27;,        email: &#x27;&#x27;      &#125;,      rules: &#123;        username: &#123;          required: true,          message: &#x27;è¯·è¾“å…¥ç”¨æˆ·å&#x27;        &#125;,        email: &#123;          required: true,          pattern: /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/,          message: &#x27;è¯·è¾“å…¥æ­£ç¡®çš„é‚®ç®±æ ¼å¼&#x27;        &#125;      &#125;    &#125;  &#125;,  methods: &#123;    handleSubmit(formData) &#123;      console.log(&#x27;è¡¨å•æäº¤:&#x27;, formData)    &#125;,    handleInvalid(errors) &#123;      console.log(&#x27;è¡¨å•éªŒè¯å¤±è´¥:&#x27;, errors)    &#125;  &#125;&#125;&lt;/script&gt;\n\n4. Table è¡¨æ ¼\nä¸»è¦å±æ€§\n\n\n\nå±æ€§å\nç±»å‹\né»˜è®¤å€¼\nè¯´æ˜\n\n\n\n\ndata\nArray\n[]\nè¡¨æ ¼æ•°æ®\n\n\ncolumns\nArray\n[]\nåˆ—é…ç½®\n\n\nkeyField\nString\nâ€˜idâ€™\næ•°æ®å”¯ä¸€æ ‡è¯†å­—æ®µ\n\n\nemptyText\nString\nâ€˜æš‚æ— æ•°æ®â€™\nç©ºæ•°æ®æç¤ºæ–‡æœ¬\n\n\nsortKey\nString\nâ€˜â€™\næ’åºå­—æ®µ\n\n\nsortOrder\nString\nâ€˜ascâ€™\næ’åºæ–¹å‘\n\n\nborder\nBoolean\nfalse\næ˜¯å¦æ˜¾ç¤ºè¾¹æ¡†\n\n\nstriped\nBoolean\nfalse\næ˜¯å¦æ–‘é©¬çº¹\n\n\n\nä¸»è¦æ–¹æ³•\n\n\n\næ–¹æ³•å\nå‚æ•°\nè¯´æ˜\n\n\n\n\nhandleSort\nkey, order\nå¤„ç†æ’åº\n\n\nhandleSelection\nrows\nå¤„ç†é€‰æ‹©\n\n\nhandleRowClick\nrow, index\nå¤„ç†è¡Œç‚¹å‡»\n\n\n\näº‹ä»¶\n\n\nsort: æ’åºäº‹ä»¶\n\n\nselection-change: é€‰æ‹©å˜åŒ–äº‹ä»¶\n\n\nrow-click: è¡Œç‚¹å‡»äº‹ä»¶\n\n\nä½¿ç”¨ç¤ºä¾‹\n&lt;template&gt;  &lt;BaseTable    :data=&quot;users&quot;    :columns=&quot;columns&quot;    :sort-key=&quot;sortKey&quot;    :sort-order=&quot;sortOrder&quot;    @sort=&quot;handleSort&quot;  &gt;    &lt;template #status=&quot;&#123; row &#125;&quot;&gt;      &lt;span :class=&quot;row.status === &#x27;active&#x27; ? &#x27;status-active&#x27; : &#x27;status-inactive&#x27;&quot;&gt;        &#123;&#123; row.status === &#x27;active&#x27; ? &#x27;å¯ç”¨&#x27; : &#x27;ç¦ç”¨&#x27; &#125;&#125;      &lt;/span&gt;    &lt;/template&gt;        &lt;template #actions=&quot;&#123; row &#125;&quot;&gt;      &lt;div class=&quot;action-buttons&quot;&gt;        &lt;button @click=&quot;handleEdit(row)&quot;&gt;ç¼–è¾‘&lt;/button&gt;        &lt;button @click=&quot;handleDelete(row)&quot;&gt;åˆ é™¤&lt;/button&gt;      &lt;/div&gt;    &lt;/template&gt;  &lt;/BaseTable&gt;&lt;/template&gt;&lt;script&gt;export default &#123;  data() &#123;    return &#123;      users: [        &#123; id: 1, name: &#x27;å¼ ä¸‰&#x27;, email: &#x27;zhangsan@example.com&#x27;, status: &#x27;active&#x27; &#125;,        &#123; id: 2, name: &#x27;æå››&#x27;, email: &#x27;lisi@example.com&#x27;, status: &#x27;inactive&#x27; &#125;      ],      columns: [        &#123; key: &#x27;name&#x27;, title: &#x27;å§“å&#x27;, sortable: true &#125;,        &#123; key: &#x27;email&#x27;, title: &#x27;é‚®ç®±&#x27;, sortable: true &#125;,        &#123; key: &#x27;status&#x27;, title: &#x27;çŠ¶æ€&#x27; &#125;,        &#123; key: &#x27;actions&#x27;, title: &#x27;æ“ä½œ&#x27; &#125;      ],      sortKey: &#x27;&#x27;,      sortOrder: &#x27;asc&#x27;    &#125;  &#125;,  methods: &#123;    handleSort(key, order) &#123;      this.sortKey = key      this.sortOrder = order      // å¤„ç†æ’åºé€»è¾‘    &#125;,    handleEdit(row) &#123;      console.log(&#x27;ç¼–è¾‘:&#x27;, row)    &#125;,    handleDelete(row) &#123;      console.log(&#x27;åˆ é™¤:&#x27;, row)    &#125;  &#125;&#125;&lt;/script&gt;\n\n5. Checkbox å¤é€‰æ¡†\nä¸»è¦å±æ€§\n\n\n\nå±æ€§å\nç±»å‹\né»˜è®¤å€¼\nè¯´æ˜\n\n\n\n\nmodelValue\nBoolean/Array\nfalse\nç»‘å®šå€¼ï¼ˆv-modelï¼‰\n\n\nlabel\nString\nâ€˜â€™\næ ‡ç­¾æ–‡æœ¬\n\n\ndisabled\nBoolean\nfalse\næ˜¯å¦ç¦ç”¨\n\n\nindeterminate\nBoolean\nfalse\næ˜¯å¦åŠé€‰çŠ¶æ€\n\n\nname\nString\n-\nè¡¨å•åç§°\n\n\n\nä¸»è¦æ–¹æ³•\n\n\n\næ–¹æ³•å\nå‚æ•°\nè¯´æ˜\n\n\n\n\nhandleChange\nvalue\nå˜åŒ–äº‹ä»¶å¤„ç†\n\n\n\näº‹ä»¶\n\n\nchange: å˜åŒ–äº‹ä»¶\n\n\nä½¿ç”¨ç¤ºä¾‹\n&lt;template&gt;  &lt;div&gt;    &lt;!-- å•ä¸ªå¤é€‰æ¡† --&gt;    &lt;BaseCheckbox      v-model=&quot;agree&quot;      label=&quot;æˆ‘åŒæ„ç”¨æˆ·åè®®&quot;      @change=&quot;handleAgreeChange&quot;    /&gt;        &lt;!-- å¤é€‰æ¡†ç»„ --&gt;    &lt;div class=&quot;checkbox-group&quot;&gt;      &lt;BaseCheckbox        v-for=&quot;item in hobbies&quot;        :key=&quot;item.value&quot;        v-model=&quot;selectedHobbies&quot;        :label=&quot;item.label&quot;        :value=&quot;item.value&quot;      /&gt;    &lt;/div&gt;  &lt;/div&gt;&lt;/template&gt;&lt;script&gt;export default &#123;  data() &#123;    return &#123;      agree: false,      selectedHobbies: [],      hobbies: [        &#123; value: &#x27;reading&#x27;, label: &#x27;é˜…è¯»&#x27; &#125;,        &#123; value: &#x27;sports&#x27;, label: &#x27;è¿åŠ¨&#x27; &#125;,        &#123; value: &#x27;music&#x27;, label: &#x27;éŸ³ä¹&#x27; &#125;      ]    &#125;  &#125;,  methods: &#123;    handleAgreeChange(checked) &#123;      console.log(&#x27;åŒæ„çŠ¶æ€:&#x27;, checked)    &#125;  &#125;&#125;&lt;/script&gt;\n\n6. Radio å•é€‰æ¡†\nä¸»è¦å±æ€§\n\n\n\nå±æ€§å\nç±»å‹\né»˜è®¤å€¼\nè¯´æ˜\n\n\n\n\nmodelValue\nString/Number/Boolean\nâ€˜â€™\nç»‘å®šå€¼ï¼ˆv-modelï¼‰\n\n\nname\nString\n-\nè¡¨å•åç§°\n\n\noptions\nArray\n[]\né€‰é¡¹æ•°ç»„\n\n\ndisabled\nBoolean\nfalse\næ˜¯å¦ç¦ç”¨\n\n\n\nä¸»è¦æ–¹æ³•\n\n\n\næ–¹æ³•å\nå‚æ•°\nè¯´æ˜\n\n\n\n\nhandleChange\nvalue\nå˜åŒ–äº‹ä»¶å¤„ç†\n\n\n\näº‹ä»¶\n\n\nchange: å˜åŒ–äº‹ä»¶\n\n\nä½¿ç”¨ç¤ºä¾‹\n&lt;template&gt;  &lt;div&gt;    &lt;BaseRadio      v-model=&quot;gender&quot;      name=&quot;gender&quot;      :options=&quot;genderOptions&quot;      @change=&quot;handleGenderChange&quot;    /&gt;        &lt;BaseRadio      v-model=&quot;city&quot;      name=&quot;city&quot;      :options=&quot;cityOptions&quot;    /&gt;  &lt;/div&gt;&lt;/template&gt;&lt;script&gt;export default &#123;  data() &#123;    return &#123;      gender: &#x27;&#x27;,      city: &#x27;&#x27;,      genderOptions: [        &#123; value: &#x27;male&#x27;, label: &#x27;ç”·&#x27; &#125;,        &#123; value: &#x27;female&#x27;, label: &#x27;å¥³&#x27; &#125;      ],      cityOptions: [        &#123; value: &#x27;beijing&#x27;, label: &#x27;åŒ—äº¬&#x27; &#125;,        &#123; value: &#x27;shanghai&#x27;, label: &#x27;ä¸Šæµ·&#x27; &#125;,        &#123; value: &#x27;guangzhou&#x27;, label: &#x27;å¹¿å·&#x27; &#125;      ]    &#125;  &#125;,  methods: &#123;    handleGenderChange(value) &#123;      console.log(&#x27;æ€§åˆ«é€‰æ‹©:&#x27;, value)    &#125;  &#125;&#125;&lt;/script&gt;\n\n7. Select ä¸‹æ‹‰é€‰æ‹©å™¨\nä¸»è¦å±æ€§\n\n\n\nå±æ€§å\nç±»å‹\né»˜è®¤å€¼\nè¯´æ˜\n\n\n\n\nmodelValue\nString/Number/Boolean\nâ€˜â€™\nç»‘å®šå€¼ï¼ˆv-modelï¼‰\n\n\noptions\nArray\n[]\né€‰é¡¹æ•°ç»„\n\n\nplaceholder\nString\nâ€˜è¯·é€‰æ‹©â€™\nå ä½æ–‡æœ¬\n\n\ndisabled\nBoolean\nfalse\næ˜¯å¦ç¦ç”¨\n\n\nfilterable\nBoolean\nfalse\næ˜¯å¦å¯æœç´¢\n\n\nmultiple\nBoolean\nfalse\næ˜¯å¦å¤šé€‰\n\n\nclearable\nBoolean\nfalse\næ˜¯å¦å¯æ¸…ç©º\n\n\nsize\nString\nâ€˜mediumâ€™\nå°ºå¯¸\n\n\n\nä¸»è¦æ–¹æ³•\n\n\n\næ–¹æ³•å\nå‚æ•°\nè¯´æ˜\n\n\n\n\ntoggleDropdown\n-\nåˆ‡æ¢ä¸‹æ‹‰æ¡†æ˜¾ç¤º/éšè—\n\n\nselectOption\noption\né€‰æ‹©é€‰é¡¹\n\n\nhandleSearch\nkeyword\næœç´¢å¤„ç†\n\n\n\näº‹ä»¶\n\n\nchange: å˜åŒ–äº‹ä»¶\n\n\nopen: ä¸‹æ‹‰æ¡†æ‰“å¼€äº‹ä»¶\n\n\nclose: ä¸‹æ‹‰æ¡†å…³é—­äº‹ä»¶\n\n\nclear: æ¸…ç©ºäº‹ä»¶\n\n\nä½¿ç”¨ç¤ºä¾‹\n&lt;template&gt;  &lt;div&gt;    &lt;BaseSelect      v-model=&quot;selectedCity&quot;      :options=&quot;cityOptions&quot;      placeholder=&quot;è¯·é€‰æ‹©åŸå¸‚&quot;      filterable      @change=&quot;handleCityChange&quot;    /&gt;        &lt;BaseSelect      v-model=&quot;selectedTags&quot;      :options=&quot;tagOptions&quot;      placeholder=&quot;è¯·é€‰æ‹©æ ‡ç­¾&quot;      multiple      clearable    /&gt;  &lt;/div&gt;&lt;/template&gt;&lt;script&gt;export default &#123;  data() &#123;    return &#123;      selectedCity: &#x27;&#x27;,      selectedTags: [],      cityOptions: [        &#123; value: &#x27;beijing&#x27;, label: &#x27;åŒ—äº¬&#x27; &#125;,        &#123; value: &#x27;shanghai&#x27;, label: &#x27;ä¸Šæµ·&#x27; &#125;,        &#123; value: &#x27;guangzhou&#x27;, label: &#x27;å¹¿å·&#x27; &#125;,        &#123; value: &#x27;shenzhen&#x27;, label: &#x27;æ·±åœ³&#x27; &#125;      ],      tagOptions: [        &#123; value: &#x27;vue&#x27;, label: &#x27;Vue.js&#x27; &#125;,        &#123; value: &#x27;react&#x27;, label: &#x27;React&#x27; &#125;,        &#123; value: &#x27;angular&#x27;, label: &#x27;Angular&#x27; &#125;      ]    &#125;  &#125;,  methods: &#123;    handleCityChange(value) &#123;      console.log(&#x27;åŸå¸‚é€‰æ‹©:&#x27;, value)    &#125;  &#125;&#125;&lt;/script&gt;\n\n8. ç»„ä»¶é€šä¿¡\nProps çˆ¶ä¼ å­\n&lt;!-- ParentComponent.vue --&gt;&lt;template&gt;  &lt;ChildComponent     :message=&quot;parentMessage&quot;    :user=&quot;currentUser&quot;    :is-visible=&quot;showChild&quot;  /&gt;&lt;/template&gt;&lt;script&gt;export default &#123;  data() &#123;    return &#123;      parentMessage: &#x27;æ¥è‡ªçˆ¶ç»„ä»¶çš„æ¶ˆæ¯&#x27;,      currentUser: &#123; name: &#x27;å¼ ä¸‰&#x27;, age: 25 &#125;,      showChild: true    &#125;  &#125;&#125;&lt;/script&gt;&lt;!-- ChildComponent.vue --&gt;&lt;template&gt;  &lt;div v-if=&quot;isVisible&quot;&gt;    &lt;p&gt;&#123;&#123; message &#125;&#125;&lt;/p&gt;    &lt;p&gt;ç”¨æˆ·å: &#123;&#123; user.name &#125;&#125;&lt;/p&gt;  &lt;/div&gt;&lt;/template&gt;&lt;script&gt;export default &#123;  props: &#123;    message: String,    user: Object,    isVisible: Boolean  &#125;&#125;&lt;/script&gt;\nEmit å­ä¼ çˆ¶\n&lt;!-- ChildComponent.vue --&gt;&lt;template&gt;  &lt;button @click=&quot;handleClick&quot;&gt;ç‚¹å‡»æˆ‘&lt;/button&gt;  &lt;input v-model=&quot;inputValue&quot; @input=&quot;handleInput&quot; /&gt;&lt;/template&gt;&lt;script&gt;export default &#123;  data() &#123;    return &#123;      inputValue: &#x27;&#x27;    &#125;  &#125;,  methods: &#123;    handleClick() &#123;      this.$emit(&#x27;click&#x27;, &#x27;æŒ‰é’®è¢«ç‚¹å‡»äº†&#x27;)    &#125;,    handleInput() &#123;      this.$emit(&#x27;input&#x27;, this.inputValue)    &#125;  &#125;&#125;&lt;/script&gt;&lt;!-- ParentComponent.vue --&gt;&lt;template&gt;  &lt;ChildComponent     @click=&quot;handleChildClick&quot;    @input=&quot;handleChildInput&quot;  /&gt;&lt;/template&gt;&lt;script&gt;export default &#123;  methods: &#123;    handleChildClick(message) &#123;      console.log(&#x27;æ”¶åˆ°:&#x27;, message)    &#125;,    handleChildInput(value) &#123;      console.log(&#x27;è¾“å…¥:&#x27;, value)    &#125;  &#125;&#125;&lt;/script&gt;\nProvide/Inject\n&lt;!-- AncestorComponent.vue --&gt;&lt;template&gt;  &lt;div&gt;    &lt;DescendantComponent /&gt;  &lt;/div&gt;&lt;/template&gt;&lt;script&gt;export default &#123;  provide() &#123;    return &#123;      theme: this.theme,      updateTheme: this.updateTheme    &#125;  &#125;,  data() &#123;    return &#123;      theme: &#x27;dark&#x27;    &#125;  &#125;,  methods: &#123;    updateTheme(newTheme) &#123;      this.theme = newTheme    &#125;  &#125;&#125;&lt;/script&gt;&lt;!-- DescendantComponent.vue --&gt;&lt;template&gt;  &lt;div :class=&quot;theme&quot;&gt;    &lt;button @click=&quot;updateTheme(&#x27;light&#x27;)&quot;&gt;      åˆ‡æ¢åˆ°äº®è‰²ä¸»é¢˜    &lt;/button&gt;  &lt;/div&gt;&lt;/template&gt;&lt;script&gt;export default &#123;  inject: [&#x27;theme&#x27;, &#x27;updateTheme&#x27;]&#125;&lt;/script&gt;\n","categories":["ç¼–ç¨‹"],"tags":["Web"]},{"title":"Vue+IndexedDB+idb","url":"/2025/10/09/web/Vue%20%E4%B8%AD%E4%BD%BF%E7%94%A8%20idb%20%E6%93%8D%E4%BD%9C%20IndexedDB%20%E5%AE%8C%E6%95%B4%E6%8C%87%E5%8D%97/","content":"\nå¦‚é¢˜ï¼Œç»“åˆå®˜æ–¹æ–‡æ¡£ä¸ç½‘ç»œå¸–å­ï¼Œåˆ©ç”¨AIæ•´ç†\n\n\nVue ä¸­ä½¿ç”¨ idb æ“ä½œ IndexedDB å®Œæ•´æŒ‡å—\nç›®å½•\n\n\nä»€ä¹ˆæ˜¯ IndexedDB å’Œ idb\n\n\nç¯å¢ƒå‡†å¤‡ä¸å®‰è£…\n\n\nåŸºç¡€æ¦‚å¿µ\n\n\næ•°æ®åº“è¿æ¥ç®¡ç†\n\n\næ•°æ®æ“ä½œï¼ˆCRUDï¼‰\n\n\näº‹åŠ¡å¤„ç†\n\n\næ•°æ®åº“ç‰ˆæœ¬ç®¡ç†\n\n\nç´¢å¼•ä½¿ç”¨\n\n\né«˜çº§æŸ¥è¯¢æ“ä½œ\n\n\nVue ä¸­çš„æœ€ä½³å®è·µ\n\n\nå¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ\n\n\næ€§èƒ½ä¼˜åŒ–\n\n\nä»€ä¹ˆæ˜¯ IndexedDB å’Œ idb\nIndexedDB ç®€ä»‹\nIndexedDB æ˜¯æµè§ˆå™¨æä¾›çš„ä¸€ç§æœ¬åœ°å­˜å‚¨æ–¹æ¡ˆï¼Œå…·æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š\n\n\nNoSQL æ•°æ®åº“ï¼šåŸºäºé”®å€¼å¯¹å­˜å‚¨\n\n\nå¼‚æ­¥æ“ä½œï¼šæ‰€æœ‰æ“ä½œéƒ½æ˜¯å¼‚æ­¥çš„ï¼Œä¸ä¼šé˜»å¡ä¸»çº¿ç¨‹\n\n\nå¤§å®¹é‡å­˜å‚¨ï¼šç›¸æ¯” localStorage æœ‰æ›´å¤§çš„å­˜å‚¨å®¹é‡ï¼ˆé€šå¸¸æ˜¯ GB çº§åˆ«ï¼‰\n\n\næ”¯æŒäº‹åŠ¡ï¼šç¡®ä¿æ•°æ®æ“ä½œçš„åŸå­æ€§\n\n\næ”¯æŒç´¢å¼•ï¼šå¯ä»¥åœ¨å¯¹è±¡çš„å±æ€§ä¸Šåˆ›å»ºç´¢å¼•ï¼Œæé«˜æŸ¥è¯¢æ•ˆç‡\n\n\nåŒæºç­–ç•¥ï¼šéµå¾ªæµè§ˆå™¨çš„åŒæºç­–ç•¥\n\n\nidb åº“ç®€ä»‹\nidb æ˜¯ç”± Google å·¥ç¨‹å¸ˆ Jake Archibald å¼€å‘çš„ä¸€ä¸ªè½»é‡çº§ IndexedDB åŒ…è£…åº“ï¼š\n\n\nä½“ç§¯å°å·§ï¼šåªæœ‰ 1KB å¤§å°\n\n\nPromise APIï¼šå°†åŸç”Ÿçš„å›è°ƒå¼ API è½¬æ¢ä¸º Promise å¼\n\n\nTypeScript æ”¯æŒï¼šæä¾›å®Œæ•´çš„ç±»å‹å®šä¹‰\n\n\nç®€åŒ–æ“ä½œï¼šç®€åŒ–äº†å¤æ‚çš„ IndexedDB æ“ä½œæµç¨‹\n\n\næ´»è·ƒç»´æŠ¤ï¼šæŒç»­æ›´æ–°å’Œç»´æŠ¤\n\n\nGitHub åœ°å€ï¼šhttps://github.com/jakearchibald/idb\nç¯å¢ƒå‡†å¤‡ä¸å®‰è£…\nå®‰è£… idb\n# ä½¿ç”¨npmnpm install idb# ä½¿ç”¨yarnyarn add idb# ä½¿ç”¨pnpmpnpm add idb\nåœ¨ Vue ä¸­å¼•å…¥\n// åœ¨Vueç»„ä»¶ä¸­ç›´æ¥å¼•å…¥import &#123; openDB &#125; from &#x27;idb&#x27;// æˆ–è€…åˆ›å»ºä¸€ä¸ªä¸“é—¨çš„æ•°æ®åº“ç®¡ç†æ–‡ä»¶// src/utils/indexedDB.jsimport &#123; openDB &#125; from &#x27;idb&#x27;export const useIndexedDB = () =&gt; &#123;  // æ•°æ®åº“æ“ä½œé€»è¾‘&#125;\nåŸºç¡€æ¦‚å¿µ\næ•°æ®åº“ï¼ˆDatabaseï¼‰\n\n\næ•°æ®åº“æ˜¯å­˜å‚¨æ•°æ®çš„å®¹å™¨\n\n\næ¯ä¸ªæ•°æ®åº“æœ‰ä¸€ä¸ªå”¯ä¸€çš„åç§°\n\n\næ•°æ®åº“å¯ä»¥åŒ…å«å¤šä¸ªå¯¹è±¡ä»“åº“ï¼ˆstoreï¼‰\n\n\næ•°æ®åº“æœ‰ç‰ˆæœ¬å·ï¼Œç‰ˆæœ¬å·åªèƒ½é€’å¢\n\n\nå¯¹è±¡ä»“åº“ï¼ˆObject Storeï¼‰\n\n\nå¯¹è±¡ä»“åº“ç±»ä¼¼äºå…³ç³»æ•°æ®åº“ä¸­çš„è¡¨\n\n\næ¯ä¸ªå¯¹è±¡ä»“åº“å­˜å‚¨ä¸€ç»„ç›¸å…³çš„æ•°æ®\n\n\næ¯ä¸ªå¯¹è±¡ä»“åº“å¿…é¡»æœ‰ä¸€ä¸ªä¸»é”®ï¼ˆkeyï¼‰\n\n\nä¸»é”®å¯ä»¥æ˜¯å¯¹è±¡çš„å±æ€§ï¼ˆkeyPathï¼‰æˆ–è‡ªåŠ¨ç”Ÿæˆï¼ˆautoIncrementï¼‰\n\n\näº‹åŠ¡ï¼ˆTransactionï¼‰\n\n\näº‹åŠ¡æ˜¯ä¸€ç»„æ“ä½œçš„é›†åˆ\n\n\näº‹åŠ¡å…·æœ‰ ACID ç‰¹æ€§ï¼šåŸå­æ€§ã€ä¸€è‡´æ€§ã€éš”ç¦»æ€§ã€æŒä¹…æ€§\n\n\näº‹åŠ¡æœ‰ä¸‰ç§æ¨¡å¼ï¼šreadwriteï¼ˆè¯»å†™ï¼‰ã€readonlyï¼ˆåªè¯»ï¼‰ã€versionchangeï¼ˆç‰ˆæœ¬å˜æ›´ï¼‰\n\n\nç´¢å¼•ï¼ˆIndexï¼‰\n\n\nç´¢å¼•æ˜¯å¯¹è±¡ä»“åº“çš„æ’åºå‰¯æœ¬\n\n\nå¯ä»¥åŸºäºå¯¹è±¡çš„å±æ€§åˆ›å»ºç´¢å¼•\n\n\nç´¢å¼•å¯ä»¥æé«˜æŸ¥è¯¢æ•ˆç‡\n\n\nä¸€ä¸ªå¯¹è±¡ä»“åº“å¯ä»¥æœ‰å¤šä¸ªç´¢å¼•\n\n\næ•°æ®åº“è¿æ¥ç®¡ç†\nåˆ›å»ºæ•°æ®åº“è¿æ¥\n// src/utils/indexedDB.jsimport &#123; openDB &#125; from &#x27;idb&#x27;export const DB_NAME = &#x27;MyVueAppDB&#x27;export const DB_VERSION = 1// åˆ›å»ºæ•°æ®åº“è¿æ¥export const initDB = async () =&gt; &#123;  return openDB(DB_NAME, DB_VERSION, &#123;    upgrade(db) &#123;      // æ•°æ®åº“ç‰ˆæœ¬å‡çº§æ—¶çš„æ“ä½œ      console.log(&#x27;æ•°æ®åº“å‡çº§ä¸­...&#x27;)            // åˆ›å»ºç”¨æˆ·å¯¹è±¡ä»“åº“      if (!db.objectStoreNames.contains(&#x27;users&#x27;)) &#123;        db.createObjectStore(&#x27;users&#x27;, &#123;           keyPath: &#x27;id&#x27;,          autoIncrement: true         &#125;)      &#125;            // åˆ›å»ºå•†å“å¯¹è±¡ä»“åº“      if (!db.objectStoreNames.contains(&#x27;products&#x27;)) &#123;        db.createObjectStore(&#x27;products&#x27;, &#123;           keyPath: &#x27;id&#x27;        &#125;)      &#125;            // åˆ›å»ºè®¾ç½®å¯¹è±¡ä»“åº“ï¼ˆç±»ä¼¼localStorageï¼‰      if (!db.objectStoreNames.contains(&#x27;settings&#x27;)) &#123;        db.createObjectStore(&#x27;settings&#x27;)      &#125;    &#125;,        blocked() &#123;      // æ•°æ®åº“è¢«å…¶ä»–è¿æ¥å ç”¨æ—¶è§¦å‘      console.log(&#x27;æ•°æ®åº“è¿æ¥è¢«é˜»å¡ï¼Œè¯·å…³é—­å…¶ä»–æ ‡ç­¾é¡µåé‡è¯•&#x27;)    &#125;,        blocking() &#123;      // å½“å‰è¿æ¥é˜»å¡äº†æ–°è¿æ¥çš„ç‰ˆæœ¬å‡çº§æ—¶è§¦å‘      console.log(&#x27;æ•°æ®åº“éœ€è¦å‡çº§ï¼Œæ­£åœ¨å…³é—­å½“å‰è¿æ¥...&#x27;)    &#125;  &#125;)&#125;// è·å–æ•°æ®åº“å®ä¾‹let dbInstance = nullexport const getDB = async () =&gt; &#123;  if (!dbInstance) &#123;    dbInstance = await initDB()  &#125;  return dbInstance&#125;\nè¿æ¥ç®¡ç†æœ€ä½³å®è·µ\n// åœ¨Vueåº”ç”¨ä¸­ç®¡ç†æ•°æ®åº“è¿æ¥// src/plugins/indexedDB.jsimport &#123; getDB &#125; from &#x27;@/utils/indexedDB&#x27;export default &#123;  install(app) &#123;    // æä¾›å…¨å±€çš„æ•°æ®åº“å®ä¾‹    app.provide(&#x27;$db&#x27;, getDB())        // åœ¨ç»„ä»¶ä¸­å¯ä»¥é€šè¿‡ inject(&#x27;$db&#x27;) è·å–  &#125;&#125;// main.jsimport &#123; createApp &#125; from &#x27;vue&#x27;import App from &#x27;./App.vue&#x27;import IndexedDB from &#x27;./plugins/indexedDB&#x27;const app = createApp(App)app.use(IndexedDB)app.mount(&#x27;#app&#x27;)\næ•°æ®æ“ä½œï¼ˆCRUDï¼‰\nåˆ›å»ºæ•°æ®ï¼ˆCreateï¼‰\n// src/api/user.jsimport &#123; getDB &#125; from &#x27;@/utils/indexedDB&#x27;export const createUser = async (userData) =&gt; &#123;  const db = await getDB()    try &#123;    // ä½¿ç”¨addæ–¹æ³•æ·»åŠ æ–°æ•°æ®ï¼ˆä¸»é”®ä¸å­˜åœ¨ï¼‰    const userId = await db.add(&#x27;users&#x27;, &#123;      ...userData,      createdAt: new Date().toISOString(),      updatedAt: new Date().toISOString()    &#125;)        return &#123; success: true, userId &#125;  &#125; catch (error) &#123;    console.error(&#x27;åˆ›å»ºç”¨æˆ·å¤±è´¥:&#x27;, error)    return &#123; success: false, error: error.message &#125;  &#125;&#125;export const createOrUpdateUser = async (userData) =&gt; &#123;  const db = await getDB()    try &#123;    // ä½¿ç”¨putæ–¹æ³•æ·»åŠ æˆ–æ›´æ–°æ•°æ®    const userId = await db.put(&#x27;users&#x27;, &#123;      ...userData,      updatedAt: new Date().toISOString()    &#125;)        return &#123; success: true, userId &#125;  &#125; catch (error) &#123;    console.error(&#x27;åˆ›å»ºæˆ–æ›´æ–°ç”¨æˆ·å¤±è´¥:&#x27;, error)    return &#123; success: false, error: error.message &#125;  &#125;&#125;\nè¯»å–æ•°æ®ï¼ˆReadï¼‰\n// è·å–å•ä¸ªç”¨æˆ·export const getUserById = async (userId) =&gt; &#123;  const db = await getDB()    try &#123;    const user = await db.get(&#x27;users&#x27;, userId)    return &#123; success: true, data: user &#125;  &#125; catch (error) &#123;    console.error(&#x27;è·å–ç”¨æˆ·å¤±è´¥:&#x27;, error)    return &#123; success: false, error: error.message &#125;  &#125;&#125;// è·å–æ‰€æœ‰ç”¨æˆ·export const getAllUsers = async () =&gt; &#123;  const db = await getDB()    try &#123;    const users = await db.getAll(&#x27;users&#x27;)    return &#123; success: true, data: users &#125;  &#125; catch (error) &#123;    console.error(&#x27;è·å–æ‰€æœ‰ç”¨æˆ·å¤±è´¥:&#x27;, error)    return &#123; success: false, error: error.message &#125;  &#125;&#125;// è·å–æŒ‡å®šæ•°é‡çš„ç”¨æˆ·export const getUsersByLimit = async (limit, offset = 0) =&gt; &#123;  const db = await getDB()    try &#123;    const users = await db.getAll(&#x27;users&#x27;, undefined, limit, offset)    return &#123; success: true, data: users &#125;  &#125; catch (error) &#123;    console.error(&#x27;è·å–ç”¨æˆ·åˆ—è¡¨å¤±è´¥:&#x27;, error)    return &#123; success: false, error: error.message &#125;  &#125;&#125;// è·å–ç”¨æˆ·æ€»æ•°export const getUserCount = async () =&gt; &#123;  const db = await getDB()    try &#123;    const count = await db.count(&#x27;users&#x27;)    return &#123; success: true, count &#125;  &#125; catch (error) &#123;    console.error(&#x27;è·å–ç”¨æˆ·æ€»æ•°å¤±è´¥:&#x27;, error)    return &#123; success: false, error: error.message &#125;  &#125;&#125;\næ›´æ–°æ•°æ®ï¼ˆUpdateï¼‰\nexport const updateUser = async (userId, updateData) =&gt; &#123;  const db = await getDB()    try &#123;    // å…ˆè·å–å½“å‰ç”¨æˆ·æ•°æ®    const user = await db.get(&#x27;users&#x27;, userId)        if (!user) &#123;      return &#123; success: false, error: &#x27;ç”¨æˆ·ä¸å­˜åœ¨&#x27; &#125;    &#125;        // æ›´æ–°ç”¨æˆ·æ•°æ®    const updatedUser = &#123;      ...user,      ...updateData,      updatedAt: new Date().toISOString()    &#125;        await db.put(&#x27;users&#x27;, updatedUser)    return &#123; success: true, data: updatedUser &#125;  &#125; catch (error) &#123;    console.error(&#x27;æ›´æ–°ç”¨æˆ·å¤±è´¥:&#x27;, error)    return &#123; success: false, error: error.message &#125;  &#125;&#125;\nåˆ é™¤æ•°æ®ï¼ˆDeleteï¼‰\n// åˆ é™¤å•ä¸ªç”¨æˆ·export const deleteUser = async (userId) =&gt; &#123;  const db = await getDB()    try &#123;    await db.delete(&#x27;users&#x27;, userId)    return &#123; success: true &#125;  &#125; catch (error) &#123;    console.error(&#x27;åˆ é™¤ç”¨æˆ·å¤±è´¥:&#x27;, error)    return &#123; success: false, error: error.message &#125;  &#125;&#125;// æ¸…ç©ºç”¨æˆ·è¡¨export const clearAllUsers = async () =&gt; &#123;  const db = await getDB()    try &#123;    await db.clear(&#x27;users&#x27;)    return &#123; success: true &#125;  &#125; catch (error) &#123;    console.error(&#x27;æ¸…ç©ºç”¨æˆ·è¡¨å¤±è´¥:&#x27;, error)    return &#123; success: false, error: error.message &#125;  &#125;&#125;\näº‹åŠ¡å¤„ç†\nåŸºæœ¬äº‹åŠ¡æ“ä½œ\n// æ‰¹é‡åˆ›å»ºç”¨æˆ·ï¼ˆä½¿ç”¨äº‹åŠ¡ç¡®ä¿åŸå­æ€§ï¼‰export const batchCreateUsers = async (usersData) =&gt; &#123;  const db = await getDB()    try &#123;    // å¼€å§‹ä¸€ä¸ªè¯»å†™äº‹åŠ¡    const tx = db.transaction(&#x27;users&#x27;, &#x27;readwrite&#x27;)    const store = tx.objectStore(&#x27;users&#x27;)        const results = []    for (const userData of usersData) &#123;      const userId = await store.add(&#123;        ...userData,        createdAt: new Date().toISOString(),        updatedAt: new Date().toISOString()      &#125;)      results.push(userId)    &#125;        // ç­‰å¾…äº‹åŠ¡å®Œæˆ    await tx.done        return &#123; success: true, userIds: results &#125;  &#125; catch (error) &#123;    console.error(&#x27;æ‰¹é‡åˆ›å»ºç”¨æˆ·å¤±è´¥:&#x27;, error)    return &#123; success: false, error: error.message &#125;  &#125;&#125;\nè·¨å­˜å‚¨äº‹åŠ¡\n// åŒæ—¶æ“ä½œå¤šä¸ªå¯¹è±¡ä»“åº“export const createOrderWithProducts = async (orderData, productIds) =&gt; &#123;  const db = await getDB()    try &#123;    // å¼€å§‹ä¸€ä¸ªè·¨å­˜å‚¨çš„è¯»å†™äº‹åŠ¡    const tx = db.transaction([&#x27;orders&#x27;, &#x27;products&#x27;, &#x27;inventory&#x27;], &#x27;readwrite&#x27;)        const orderStore = tx.objectStore(&#x27;orders&#x27;)    const productStore = tx.objectStore(&#x27;products&#x27;)    const inventoryStore = tx.objectStore(&#x27;inventory&#x27;)        // 1. åˆ›å»ºè®¢å•    const orderId = await orderStore.add(&#123;      ...orderData,      createdAt: new Date().toISOString(),      status: &#x27;pending&#x27;    &#125;)        // 2. è·å–ç›¸å…³äº§å“ä¿¡æ¯    const products = []    for (const productId of productIds) &#123;      const product = await productStore.get(productId)      if (product) &#123;        products.push(product)                // 3. æ›´æ–°åº“å­˜        const inventory = await inventoryStore.get(productId)        if (inventory &amp;&amp; inventory.quantity &gt; 0) &#123;          await inventoryStore.put(&#123;            ...inventory,            quantity: inventory.quantity - 1          &#125;)        &#125; else &#123;          throw new Error(`äº§å“ $&#123;product.name&#125; åº“å­˜ä¸è¶³`)        &#125;      &#125;    &#125;        // ç­‰å¾…äº‹åŠ¡å®Œæˆ    await tx.done        return &#123;      success: true,      orderId,      products    &#125;  &#125; catch (error) &#123;    console.error(&#x27;åˆ›å»ºè®¢å•å¤±è´¥:&#x27;, error)    return &#123; success: false, error: error.message &#125;  &#125;&#125;\näº‹åŠ¡é”™è¯¯å¤„ç†\n// äº‹åŠ¡é”™è¯¯å¤„ç†ç¤ºä¾‹export const safeTransaction = async (storeNames, mode, operation) =&gt; &#123;  const db = await getDB()    try &#123;    const tx = db.transaction(storeNames, mode)        // ç›‘å¬äº‹åŠ¡é”™è¯¯    tx.onerror = (event) =&gt; &#123;      console.error(&#x27;äº‹åŠ¡é”™è¯¯:&#x27;, event.target.error)      // é˜»æ­¢é”™è¯¯å†’æ³¡åˆ°å…¨å±€      event.preventDefault()    &#125;        tx.onabort = () =&gt; &#123;      console.log(&#x27;äº‹åŠ¡è¢«ä¸­æ­¢&#x27;)    &#125;        tx.oncomplete = () =&gt; &#123;      console.log(&#x27;äº‹åŠ¡å®Œæˆ&#x27;)    &#125;        const result = await operation(tx)    await tx.done        return &#123; success: true, result &#125;  &#125; catch (error) &#123;    console.error(&#x27;äº‹åŠ¡æ“ä½œå¤±è´¥:&#x27;, error)    return &#123; success: false, error: error.message &#125;  &#125;&#125;// ä½¿ç”¨å®‰å…¨äº‹åŠ¡export const transferPoints = async (fromUserId, toUserId, amount) =&gt; &#123;  return safeTransaction([&#x27;users&#x27;], &#x27;readwrite&#x27;, async (tx) =&gt; &#123;    const store = tx.objectStore(&#x27;users&#x27;)        // è·å–ç”¨æˆ·æ•°æ®    const fromUser = await store.get(fromUserId)    const toUser = await store.get(toUserId)        if (!fromUser) throw new Error(&#x27;æºç”¨æˆ·ä¸å­˜åœ¨&#x27;)    if (!toUser) throw new Error(&#x27;ç›®æ ‡ç”¨æˆ·ä¸å­˜åœ¨&#x27;)    if (fromUser.points &lt; amount) throw new Error(&#x27;ç§¯åˆ†ä¸è¶³&#x27;)        // æ›´æ–°ç§¯åˆ†    await store.put(&#123;      ...fromUser,      points: fromUser.points - amount,      updatedAt: new Date().toISOString()    &#125;)        await store.put(&#123;      ...toUser,      points: toUser.points + amount,      updatedAt: new Date().toISOString()    &#125;)        // è®°å½•äº¤æ˜“    const transaction = &#123;      id: Date.now(),      fromUserId,      toUserId,      amount,      timestamp: new Date().toISOString()    &#125;        return transaction  &#125;)&#125;\næ•°æ®åº“ç‰ˆæœ¬ç®¡ç†\nç‰ˆæœ¬å‡çº§ç­–ç•¥\n// src/utils/indexedDB.js - ç‰ˆæœ¬å‡çº§ç¤ºä¾‹export const DB_NAME = &#x27;MyVueAppDB&#x27;export const DB_VERSION = 3 // å‡çº§åˆ°ç‰ˆæœ¬3export const initDB = async () =&gt; &#123;  return openDB(DB_NAME, DB_VERSION, &#123;    upgrade(db, oldVersion, newVersion) &#123;      console.log(`æ•°æ®åº“å‡çº§: $&#123;oldVersion&#125; -&gt; $&#123;newVersion&#125;`)            // ç‰ˆæœ¬ 0 -&gt; 1: åˆå§‹ç‰ˆæœ¬      if (oldVersion &lt; 1) &#123;        // åˆ›å»ºç”¨æˆ·è¡¨        const userStore = db.createObjectStore(&#x27;users&#x27;, &#123;           keyPath: &#x27;id&#x27;,          autoIncrement: true         &#125;)                // åˆ›å»ºå•†å“è¡¨        db.createObjectStore(&#x27;products&#x27;, &#123; keyPath: &#x27;id&#x27; &#125;)                // åˆ›å»ºè®¾ç½®è¡¨        db.createObjectStore(&#x27;settings&#x27;)      &#125;            // ç‰ˆæœ¬ 1 -&gt; 2: æ·»åŠ è®¢å•è¡¨å’Œç´¢å¼•      if (oldVersion &lt; 2) &#123;        // åˆ›å»ºè®¢å•è¡¨        const orderStore = db.createObjectStore(&#x27;orders&#x27;, &#123;           keyPath: &#x27;id&#x27;,          autoIncrement: true         &#125;)                // ä¸ºè®¢å•è¡¨åˆ›å»ºç”¨æˆ·IDç´¢å¼•        orderStore.createIndex(&#x27;userId&#x27;, &#x27;userId&#x27;)        orderStore.createIndex(&#x27;status&#x27;, &#x27;status&#x27;)        orderStore.createIndex(&#x27;createdAt&#x27;, &#x27;createdAt&#x27;)                // ä¸ºç”¨æˆ·è¡¨æ·»åŠ ç´¢å¼•        const userStore = db.transaction(&#x27;users&#x27;, &#x27;readwrite&#x27;).objectStore(&#x27;users&#x27;)        userStore.createIndex(&#x27;email&#x27;, &#x27;email&#x27;, &#123; unique: true &#125;)        userStore.createIndex(&#x27;username&#x27;, &#x27;username&#x27;, &#123; unique: true &#125;)      &#125;            // ç‰ˆæœ¬ 2 -&gt; 3: æ·»åŠ åº“å­˜è¡¨å’Œä¿®æ”¹ç”¨æˆ·è¡¨ç»“æ„      if (oldVersion &lt; 3) &#123;        // åˆ›å»ºåº“å­˜è¡¨        db.createObjectStore(&#x27;inventory&#x27;, &#123; keyPath: &#x27;productId&#x27; &#125;)                // ä¿®æ”¹ç”¨æˆ·è¡¨ç»“æ„        const userStore = db.transaction(&#x27;users&#x27;, &#x27;readwrite&#x27;).objectStore(&#x27;users&#x27;)                // å¦‚æœç”¨æˆ·è¡¨æ²¡æœ‰pointså­—æ®µï¼Œæ·»åŠ é»˜è®¤å€¼        userStore.openCursor().then(function cursorIterate(cursor) &#123;          if (!cursor) return                    const user = cursor.value          if (user.points === undefined) &#123;            user.points = 0 // é»˜è®¤ç§¯åˆ†            user.level = 1 // é»˜è®¤ç­‰çº§            cursor.update(user)          &#125;                    return cursor.continue().then(cursorIterate)        &#125;)                // ä¸ºç”¨æˆ·è¡¨æ·»åŠ æ–°çš„ç´¢å¼•        userStore.createIndex(&#x27;level&#x27;, &#x27;level&#x27;)        userStore.createIndex(&#x27;points&#x27;, &#x27;points&#x27;)      &#125;    &#125;  &#125;)&#125;\nç‰ˆæœ¬ç®¡ç†æœ€ä½³å®è·µ\n// æ•°æ®åº“ç‰ˆæœ¬ç®¡ç†å·¥å…·export const getCurrentDBVersion = async () =&gt; &#123;  try &#123;    const db = await openDB(DB_NAME, 1, &#123; upgrade: () =&gt; &#123;&#125; &#125;)    const version = db.version    db.close()    return version  &#125; catch (error) &#123;    if (error.name === &#x27;NotFoundError&#x27;) &#123;      return 0 // æ•°æ®åº“ä¸å­˜åœ¨    &#125;    throw error  &#125;&#125;// æ•°æ®åº“è¿ç§»å·¥å…·export const migrateDB = async (targetVersion) =&gt; &#123;  const currentVersion = await getCurrentDBVersion()    if (currentVersion &gt;= targetVersion) &#123;    console.log(`æ•°æ®åº“ç‰ˆæœ¬å·²æ˜¯ $&#123;currentVersion&#125;ï¼Œæ— éœ€è¿ç§»`)    return true  &#125;    console.log(`å¼€å§‹æ•°æ®åº“è¿ç§»: $&#123;currentVersion&#125; -&gt; $&#123;targetVersion&#125;`)    try &#123;    const db = await openDB(DB_NAME, targetVersion, &#123;      upgrade(db, oldVersion, newVersion) &#123;        console.log(`æ‰§è¡Œå‡çº§: $&#123;oldVersion&#125; -&gt; $&#123;newVersion&#125;`)        // è¿™é‡Œå¯ä»¥æ‰§è¡Œå…·ä½“çš„å‡çº§é€»è¾‘      &#125;    &#125;)        db.close()    console.log(&#x27;æ•°æ®åº“è¿ç§»å®Œæˆ&#x27;)    return true  &#125; catch (error) &#123;    console.error(&#x27;æ•°æ®åº“è¿ç§»å¤±è´¥:&#x27;, error)    throw error  &#125;&#125;\nç´¢å¼•ä½¿ç”¨\nåˆ›å»ºç´¢å¼•\n// åœ¨æ•°æ®åº“å‡çº§æ—¶åˆ›å»ºç´¢å¼•export const initDBWithIndexes = async () =&gt; &#123;  return openDB(&#x27;MyAppDB&#x27;, 2, &#123;    upgrade(db) &#123;      // ç”¨æˆ·è¡¨ç´¢å¼•      if (db.objectStoreNames.contains(&#x27;users&#x27;)) &#123;        const userStore = db.transaction(&#x27;users&#x27;, &#x27;readwrite&#x27;).objectStore(&#x27;users&#x27;)                // åˆ›å»ºæ™®é€šç´¢å¼•        if (!userStore.indexNames.contains(&#x27;email&#x27;)) &#123;          userStore.createIndex(&#x27;email&#x27;, &#x27;email&#x27;, &#123; unique: true &#125;)        &#125;                // åˆ›å»ºå¤åˆç´¢å¼•        if (!userStore.indexNames.contains(&#x27;nameAge&#x27;)) &#123;          userStore.createIndex(&#x27;nameAge&#x27;, [&#x27;name&#x27;, &#x27;age&#x27;])        &#125;                // åˆ›å»ºå¤šå­—æ®µç´¢å¼•        if (!userStore.indexNames.contains(&#x27;addressCity&#x27;)) &#123;          userStore.createIndex(&#x27;addressCity&#x27;, &#x27;address.city&#x27;)        &#125;      &#125;            // è®¢å•è¡¨ç´¢å¼•      if (!db.objectStoreNames.contains(&#x27;orders&#x27;)) &#123;        const orderStore = db.createObjectStore(&#x27;orders&#x27;, &#123;           keyPath: &#x27;id&#x27;,          autoIncrement: true         &#125;)                // åˆ›å»ºå¤šä¸ªç´¢å¼•        orderStore.createIndex(&#x27;userId&#x27;, &#x27;userId&#x27;)        orderStore.createIndex(&#x27;status&#x27;, &#x27;status&#x27;)        orderStore.createIndex(&#x27;createdAt&#x27;, &#x27;createdAt&#x27;)        orderStore.createIndex(&#x27;totalAmount&#x27;, &#x27;totalAmount&#x27;)                // åˆ›å»ºå”¯ä¸€ç´¢å¼•        orderStore.createIndex(&#x27;orderNumber&#x27;, &#x27;orderNumber&#x27;, &#123; unique: true &#125;)      &#125;    &#125;  &#125;)&#125;\nä½¿ç”¨ç´¢å¼•æŸ¥è¯¢\n// é€šè¿‡ç´¢å¼•æŸ¥è¯¢export const getUserByEmail = async (email) =&gt; &#123;  const db = await getDB()    try &#123;    const user = await db.getFromIndex(&#x27;users&#x27;, &#x27;email&#x27;, email)    return &#123; success: true, data: user &#125;  &#125; catch (error) &#123;    console.error(&#x27;é€šè¿‡é‚®ç®±æŸ¥è¯¢ç”¨æˆ·å¤±è´¥:&#x27;, error)    return &#123; success: false, error: error.message &#125;  &#125;&#125;// é€šè¿‡ç´¢å¼•è·å–å¤šä¸ªç»“æœexport const getOrdersByUserId = async (userId) =&gt; &#123;  const db = await getDB()    try &#123;    const orders = await db.getAllFromIndex(&#x27;orders&#x27;, &#x27;userId&#x27;, userId)    return &#123; success: true, data: orders &#125;  &#125; catch (error) &#123;    console.error(&#x27;é€šè¿‡ç”¨æˆ·IDæŸ¥è¯¢è®¢å•å¤±è´¥:&#x27;, error)    return &#123; success: false, error: error.message &#125;  &#125;&#125;// é€šè¿‡ç´¢å¼•è·å–èŒƒå›´æ•°æ®export const getHighValueOrders = async (minAmount) =&gt; &#123;  const db = await getDB()    try &#123;    // è·å–é‡‘é¢å¤§äºç­‰äºminAmountçš„è®¢å•    const range = IDBKeyRange.lowerBound(minAmount)    const orders = await db.getAllFromIndex(&#x27;orders&#x27;, &#x27;totalAmount&#x27;, range)        return &#123; success: true, data: orders &#125;  &#125; catch (error) &#123;    console.error(&#x27;æŸ¥è¯¢é«˜ä»·å€¼è®¢å•å¤±è´¥:&#x27;, error)    return &#123; success: false, error: error.message &#125;  &#125;&#125;\nç´¢å¼•ç®¡ç†\n// ç´¢å¼•ç®¡ç†å·¥å…·export const getIndexNames = async (storeName) =&gt; &#123;  const db = await getDB()    try &#123;    const tx = db.transaction(storeName, &#x27;readonly&#x27;)    const store = tx.objectStore(storeName)    const indexes = Array.from(store.indexNames)        await tx.done    return &#123; success: true, indexes &#125;  &#125; catch (error) &#123;    console.error(`è·å–$&#123;storeName&#125;ç´¢å¼•åˆ—è¡¨å¤±è´¥:`, error)    return &#123; success: false, error: error.message &#125;  &#125;&#125;// åˆ é™¤ç´¢å¼•export const deleteIndex = async (storeName, indexName) =&gt; &#123;  const db = await getDB()    try &#123;    const tx = db.transaction(storeName, &#x27;readwrite&#x27;)    const store = tx.objectStore(storeName)        if (store.indexNames.contains(indexName)) &#123;      store.deleteIndex(indexName)      await tx.done      return &#123; success: true, message: `ç´¢å¼• $&#123;indexName&#125; åˆ é™¤æˆåŠŸ` &#125;    &#125; else &#123;      return &#123; success: false, error: `ç´¢å¼• $&#123;indexName&#125; ä¸å­˜åœ¨` &#125;    &#125;  &#125; catch (error) &#123;    console.error(`åˆ é™¤ç´¢å¼• $&#123;indexName&#125; å¤±è´¥:`, error)    return &#123; success: false, error: error.message &#125;  &#125;&#125;\né«˜çº§æŸ¥è¯¢æ“ä½œ\nåŒºé—´æŸ¥æ‰¾\n// åŒºé—´æŸ¥æ‰¾å·¥å…·export const getUsersByAgeRange = async (minAge, maxAge) =&gt; &#123;  const db = await getDB()    try &#123;    // åˆ›å»ºåŒºé—´å¯¹è±¡    const ageRange = IDBKeyRange.bound(minAge, maxAge)        // é€šè¿‡ç´¢å¼•æŸ¥è¯¢åŒºé—´æ•°æ®    const users = await db.getAllFromIndex(&#x27;users&#x27;, &#x27;age&#x27;, ageRange)        return &#123; success: true, data: users &#125;  &#125; catch (error) &#123;    console.error(&#x27;æŒ‰å¹´é¾„åŒºé—´æŸ¥è¯¢ç”¨æˆ·å¤±è´¥:&#x27;, error)    return &#123; success: false, error: error.message &#125;  &#125;&#125;// å¤æ‚åŒºé—´æŸ¥è¯¢export const getRecentOrdersByStatus = async (status, days = 7) =&gt; &#123;  const db = await getDB()    try &#123;    const date = new Date()    date.setDate(date.getDate() - days)    const minDate = date.toISOString()        // ä½¿ç”¨å¤åˆæŸ¥è¯¢ï¼šçŠ¶æ€å’Œæ—¥æœŸèŒƒå›´    const tx = db.transaction(&#x27;orders&#x27;, &#x27;readonly&#x27;)    const store = tx.objectStore(&#x27;orders&#x27;)        // å…ˆæŒ‰çŠ¶æ€ç­›é€‰    const statusIndex = store.index(&#x27;status&#x27;)    const statusRange = IDBKeyRange.only(status)        const orders = []        // ä½¿ç”¨æ¸¸æ ‡éå†ç»“æœå¹¶è¿›ä¸€æ­¥ç­›é€‰æ—¥æœŸ    await new Promise((resolve, reject) =&gt; &#123;      const cursorRequest = statusIndex.openCursor(statusRange)            cursorRequest.onsuccess = (event) =&gt; &#123;        const cursor = event.target.result        if (cursor) &#123;          const order = cursor.value          if (order.createdAt &gt;= minDate) &#123;            orders.push(order)          &#125;          cursor.continue()        &#125; else &#123;          resolve()        &#125;      &#125;            cursorRequest.onerror = (event) =&gt; &#123;        reject(event.target.error)      &#125;    &#125;)        await tx.done    return &#123; success: true, data: orders &#125;  &#125; catch (error) &#123;    console.error(&#x27;æŸ¥è¯¢æœ€è¿‘è®¢å•å¤±è´¥:&#x27;, error)    return &#123; success: false, error: error.message &#125;  &#125;&#125;\næ¸¸æ ‡æ“ä½œ\n// ä½¿ç”¨æ¸¸æ ‡éå†æ‰€æœ‰æ•°æ®export const iterateAllUsers = async (callback) =&gt; &#123;  const db = await getDB()    try &#123;    const tx = db.transaction(&#x27;users&#x27;, &#x27;readonly&#x27;)    const store = tx.objectStore(&#x27;users&#x27;)        await new Promise((resolve, reject) =&gt; &#123;      const cursorRequest = store.openCursor()            cursorRequest.onsuccess = (event) =&gt; &#123;        const cursor = event.target.result        if (cursor) &#123;          // è°ƒç”¨å›è°ƒå‡½æ•°å¤„ç†å½“å‰è®°å½•          const shouldContinue = callback(cursor.value, cursor.key)                    if (shouldContinue !== false) &#123;            cursor.continue()          &#125; else &#123;            resolve() // åœæ­¢éå†          &#125;        &#125; else &#123;          resolve() // éå†å®Œæˆ        &#125;      &#125;            cursorRequest.onerror = (event) =&gt; &#123;        reject(event.target.error)      &#125;    &#125;)        await tx.done    return &#123; success: true &#125;  &#125; catch (error) &#123;    console.error(&#x27;éå†ç”¨æˆ·æ•°æ®å¤±è´¥:&#x27;, error)    return &#123; success: false, error: error.message &#125;  &#125;&#125;// ä½¿ç”¨æ¸¸æ ‡è¿›è¡Œåˆ†é¡µæŸ¥è¯¢export const getUsersByPage = async (page = 1, pageSize = 20) =&gt; &#123;  const db = await getDB()    try &#123;    const tx = db.transaction(&#x27;users&#x27;, &#x27;readonly&#x27;)    const store = tx.objectStore(&#x27;users&#x27;)        const users = []    const totalCount = await store.count()    const totalPages = Math.ceil(totalCount / pageSize)    const skip = (page - 1) * pageSize        let count = 0        await new Promise((resolve, reject) =&gt; &#123;      const cursorRequest = store.openCursor()            cursorRequest.onsuccess = (event) =&gt; &#123;        const cursor = event.target.result        if (cursor) &#123;          if (count &gt;= skip &amp;&amp; count &lt; skip + pageSize) &#123;            users.push(cursor.value)          &#125;                    count++                    if (count &lt; skip + pageSize) &#123;            cursor.continue()          &#125; else &#123;            resolve()          &#125;        &#125; else &#123;          resolve()        &#125;      &#125;            cursorRequest.onerror = (event) =&gt; &#123;        reject(event.target.error)      &#125;    &#125;)        await tx.done        return &#123;      success: true,      data: users,      pagination: &#123;        page,        pageSize,        totalCount,        totalPages      &#125;    &#125;  &#125; catch (error) &#123;    console.error(&#x27;åˆ†é¡µæŸ¥è¯¢ç”¨æˆ·å¤±è´¥:&#x27;, error)    return &#123; success: false, error: error.message &#125;  &#125;&#125;\nå¤æ‚æŸ¥è¯¢ç»„åˆ\n// å¤æ‚æŸ¥è¯¢ç¤ºä¾‹ï¼šå¤šæ¡ä»¶ç­›é€‰å’Œæ’åºexport const searchUsers = async (filters = &#123;&#125;, sort = &#123; field: &#x27;createdAt&#x27;, order: &#x27;desc&#x27; &#125;) =&gt; &#123;  const db = await getDB()    try &#123;    const tx = db.transaction(&#x27;users&#x27;, &#x27;readonly&#x27;)    const store = tx.objectStore(&#x27;users&#x27;)        let cursorRequest        // æ ¹æ®ç­›é€‰æ¡ä»¶é€‰æ‹©åˆé€‚çš„ç´¢å¼•    if (filters.email) &#123;      cursorRequest = store.index(&#x27;email&#x27;).openCursor(IDBKeyRange.only(filters.email))    &#125; else if (filters.age) &#123;      const ageRange = IDBKeyRange.bound(        filters.age.min || 0,        filters.age.max || 150      )      cursorRequest = store.index(&#x27;age&#x27;).openCursor(ageRange)    &#125; else if (filters.level) &#123;      cursorRequest = store.index(&#x27;level&#x27;).openCursor(IDBKeyRange.only(filters.level))    &#125; else &#123;      // é»˜è®¤éå†æ‰€æœ‰æ•°æ®      cursorRequest = store.openCursor()    &#125;        const users = []        await new Promise((resolve, reject) =&gt; &#123;      cursorRequest.onsuccess = (event) =&gt; &#123;        const cursor = event.target.result        if (cursor) &#123;          const user = cursor.value          let match = true                    // åº”ç”¨é¢å¤–çš„ç­›é€‰æ¡ä»¶          if (filters.name &amp;&amp; !user.name.toLowerCase().includes(filters.name.toLowerCase())) &#123;            match = false          &#125;                    if (filters.points &amp;&amp; user.points &lt; (filters.points.min || 0)) &#123;            match = false          &#125;                    if (match) &#123;            users.push(user)          &#125;                    cursor.continue()        &#125; else &#123;          // éå†å®Œæˆåè¿›è¡Œæ’åº          users.sort((a, b) =&gt; &#123;            if (a[sort.field] &lt; b[sort.field]) &#123;              return sort.order === &#x27;asc&#x27; ? -1 : 1            &#125;            if (a[sort.field] &gt; b[sort.field]) &#123;              return sort.order === &#x27;asc&#x27; ? 1 : -1            &#125;            return 0          &#125;)                    resolve()        &#125;      &#125;            cursorRequest.onerror = (event) =&gt; &#123;        reject(event.target.error)      &#125;    &#125;)        await tx.done        return &#123; success: true, data: users &#125;  &#125; catch (error) &#123;    console.error(&#x27;æœç´¢ç”¨æˆ·å¤±è´¥:&#x27;, error)    return &#123; success: false, error: error.message &#125;  &#125;&#125;\nVue ä¸­çš„æœ€ä½³å®è·µ\nåˆ›å»º Vue Composition API å°è£…\n// src/composables/useIndexedDB.jsimport &#123; ref, reactive, toRefs &#125; from &#x27;vue&#x27;import &#123; getDB &#125; from &#x27;@/utils/indexedDB&#x27;export const useIndexedDB = (storeName) =&gt; &#123;  const state = reactive(&#123;    data: null,    loading: false,    error: null,    pagination: &#123;      page: 1,      pageSize: 20,      totalCount: 0,      totalPages: 0    &#125;  &#125;)  const resetState = () =&gt; &#123;    state.data = null    state.loading = false    state.error = null  &#125;  const getById = async (id) =&gt; &#123;    resetState()    state.loading = true    try &#123;      const db = await getDB()      const data = await db.get(storeName, id)      state.data = data      return &#123; success: true, data &#125;    &#125; catch (error) &#123;      state.error = error.message      console.error(`è·å–$&#123;storeName&#125;æ•°æ®å¤±è´¥:`, error)      return &#123; success: false, error: error.message &#125;    &#125; finally &#123;      state.loading = false    &#125;  &#125;  const getAll = async () =&gt; &#123;    resetState()    state.loading = true    try &#123;      const db = await getDB()      const data = await db.getAll(storeName)      state.data = data      state.pagination.totalCount = data.length      state.pagination.totalPages = 1      return &#123; success: true, data &#125;    &#125; catch (error) &#123;      state.error = error.message      console.error(`è·å–æ‰€æœ‰$&#123;storeName&#125;æ•°æ®å¤±è´¥:`, error)      return &#123; success: false, error: error.message &#125;    &#125; finally &#123;      state.loading = false    &#125;  &#125;  const getByPage = async (page = 1, pageSize = 20) =&gt; &#123;    resetState()    state.loading = true    try &#123;      const db = await getDB()      const tx = db.transaction(storeName, &#x27;readonly&#x27;)      const store = tx.objectStore(storeName)      const totalCount = await store.count()      const totalPages = Math.ceil(totalCount / pageSize)      const skip = (page - 1) * pageSize      const data = []      let count = 0      await new Promise((resolve, reject) =&gt; &#123;        const cursorRequest = store.openCursor()        cursorRequest.onsuccess = (event) =&gt; &#123;          const cursor = event.target.result          if (cursor) &#123;            if (count &gt;= skip &amp;&amp; count &lt; skip + pageSize) &#123;              data.push(cursor.value)            &#125;            count++            if (count &lt; skip + pageSize) &#123;              cursor.continue()            &#125; else &#123;              resolve()            &#125;          &#125; else &#123;            resolve()          &#125;        &#125;        cursorRequest.onerror = (event) =&gt; &#123;          reject(event.target.error)        &#125;      &#125;)      await tx.done      state.data = data      state.pagination = &#123;        page,        pageSize,        totalCount,        totalPages      &#125;      return &#123;        success: true,        data,        pagination: state.pagination      &#125;    &#125; catch (error) &#123;      state.error = error.message      console.error(`åˆ†é¡µè·å–$&#123;storeName&#125;æ•°æ®å¤±è´¥:`, error)      return &#123; success: false, error: error.message &#125;    &#125; finally &#123;      state.loading = false    &#125;  &#125;  const create = async (item) =&gt; &#123;    state.loading = true    try &#123;      const db = await getDB()      const id = await db.add(storeName, item)      return &#123; success: true, id &#125;    &#125; catch (error) &#123;      state.error = error.message      console.error(`åˆ›å»º$&#123;storeName&#125;æ•°æ®å¤±è´¥:`, error)      return &#123; success: false, error: error.message &#125;    &#125; finally &#123;      state.loading = false    &#125;  &#125;  const update = async (id, item) =&gt; &#123;    state.loading = true    try &#123;      const db = await getDB()      await db.put(storeName, &#123; ...item, id &#125;)      return &#123; success: true &#125;    &#125; catch (error) &#123;      state.error = error.message      console.error(`æ›´æ–°$&#123;storeName&#125;æ•°æ®å¤±è´¥:`, error)      return &#123; success: false, error: error.message &#125;    &#125; finally &#123;      state.loading = false    &#125;  &#125;  const remove = async (id) =&gt; &#123;    state.loading = true    try &#123;      const db = await getDB()      await db.delete(storeName, id)      return &#123; success: true &#125;    &#125; catch (error) &#123;      state.error = error.message      console.error(`åˆ é™¤$&#123;storeName&#125;æ•°æ®å¤±è´¥:`, error)      return &#123; success: false, error: error.message &#125;    &#125; finally &#123;      state.loading = false    &#125;  &#125;  const clear = async () =&gt; &#123;    state.loading = true    try &#123;      const db = await getDB()      await db.clear(storeName)      state.data = null      state.pagination.totalCount = 0      state.pagination.totalPages = 0      return &#123; success: true &#125;    &#125; catch (error) &#123;      state.error = error.message      console.error(`æ¸…ç©º$&#123;storeName&#125;æ•°æ®å¤±è´¥:`, error)      return &#123; success: false, error: error.message &#125;    &#125; finally &#123;      state.loading = false    &#125;  &#125;  return &#123;    ...toRefs(state),    getById,    getAll,    getByPage,    create,    update,    remove,    clear,    resetState  &#125;&#125;\nåœ¨ Vue ç»„ä»¶ä¸­ä½¿ç”¨\n&lt;!-- src/components/UserManagement.vue --&gt;&lt;template&gt;  &lt;div class=&quot;user-management&quot;&gt;    &lt;div class=&quot;header&quot;&gt;      &lt;h2&gt;ç”¨æˆ·ç®¡ç†&lt;/h2&gt;      &lt;button @click=&quot;showCreateModal = true&quot; class=&quot;btn btn-primary&quot;&gt;        æ·»åŠ ç”¨æˆ·      &lt;/button&gt;    &lt;/div&gt;    &lt;!-- æœç´¢å’Œç­›é€‰ --&gt;    &lt;div class=&quot;filters&quot;&gt;      &lt;input        v-model=&quot;searchName&quot;        placeholder=&quot;æœç´¢ç”¨æˆ·å...&quot;        @input=&quot;handleSearch&quot;        class=&quot;search-input&quot;      /&gt;      &lt;select v-model=&quot;filterLevel&quot; @change=&quot;handleSearch&quot; class=&quot;filter-select&quot;&gt;        &lt;option value=&quot;&quot;&gt;æ‰€æœ‰ç­‰çº§&lt;/option&gt;        &lt;option value=&quot;1&quot;&gt;ç­‰çº§1&lt;/option&gt;        &lt;option value=&quot;2&quot;&gt;ç­‰çº§2&lt;/option&gt;        &lt;option value=&quot;3&quot;&gt;ç­‰çº§3&lt;/option&gt;      &lt;/select&gt;    &lt;/div&gt;    &lt;!-- åŠ è½½çŠ¶æ€ --&gt;    &lt;div v-if=&quot;loading&quot; class=&quot;loading&quot;&gt;      &lt;span&gt;åŠ è½½ä¸­...&lt;/span&gt;    &lt;/div&gt;    &lt;!-- é”™è¯¯æç¤º --&gt;    &lt;div v-else-if=&quot;error&quot; class=&quot;error&quot;&gt;      &lt;span&gt;é”™è¯¯: &#123;&#123; error &#125;&#125;&lt;/span&gt;    &lt;/div&gt;    &lt;!-- ç”¨æˆ·åˆ—è¡¨ --&gt;    &lt;div v-else class=&quot;user-list&quot;&gt;      &lt;table class=&quot;user-table&quot;&gt;        &lt;thead&gt;          &lt;tr&gt;            &lt;th&gt;ID&lt;/th&gt;            &lt;th&gt;ç”¨æˆ·å&lt;/th&gt;            &lt;th&gt;é‚®ç®±&lt;/th&gt;            &lt;th&gt;å¹´é¾„&lt;/th&gt;            &lt;th&gt;ç­‰çº§&lt;/th&gt;            &lt;th&gt;ç§¯åˆ†&lt;/th&gt;            &lt;th&gt;æ“ä½œ&lt;/th&gt;          &lt;/tr&gt;        &lt;/thead&gt;        &lt;tbody&gt;          &lt;tr v-for=&quot;user in data&quot; :key=&quot;user.id&quot;&gt;            &lt;td&gt;&#123;&#123; user.id &#125;&#125;&lt;/td&gt;            &lt;td&gt;&#123;&#123; user.name &#125;&#125;&lt;/td&gt;            &lt;td&gt;&#123;&#123; user.email &#125;&#125;&lt;/td&gt;            &lt;td&gt;&#123;&#123; user.age &#125;&#125;&lt;/td&gt;            &lt;td&gt;ç­‰çº§&#123;&#123; user.level &#125;&#125;&lt;/td&gt;            &lt;td&gt;&#123;&#123; user.points &#125;&#125;&lt;/td&gt;            &lt;td class=&quot;actions&quot;&gt;              &lt;button @click=&quot;handleEdit(user)&quot; class=&quot;btn btn-edit&quot;&gt;ç¼–è¾‘&lt;/button&gt;              &lt;button @click=&quot;handleDelete(user.id)&quot; class=&quot;btn btn-delete&quot;&gt;åˆ é™¤&lt;/button&gt;            &lt;/td&gt;          &lt;/tr&gt;        &lt;/tbody&gt;      &lt;/table&gt;      &lt;!-- åˆ†é¡µ --&gt;      &lt;div class=&quot;pagination&quot; v-if=&quot;pagination.totalPages &gt; 1&quot;&gt;        &lt;button          @click=&quot;handlePageChange(pagination.page - 1)&quot;          :disabled=&quot;pagination.page === 1&quot;          class=&quot;page-btn&quot;        &gt;          ä¸Šä¸€é¡µ        &lt;/button&gt;        &lt;span class=&quot;page-info&quot;&gt;          ç¬¬ &#123;&#123; pagination.page &#125;&#125; é¡µ / å…± &#123;&#123; pagination.totalPages &#125;&#125; é¡µ        &lt;/span&gt;        &lt;button          @click=&quot;handlePageChange(pagination.page + 1)&quot;          :disabled=&quot;pagination.page === pagination.totalPages&quot;          class=&quot;page-btn&quot;        &gt;          ä¸‹ä¸€é¡µ        &lt;/button&gt;      &lt;/div&gt;    &lt;/div&gt;    &lt;!-- åˆ›å»º/ç¼–è¾‘ç”¨æˆ·æ¨¡æ€æ¡† --&gt;    &lt;div v-if=&quot;showCreateModal || showEditModal&quot; class=&quot;modal-overlay&quot;&gt;      &lt;div class=&quot;modal&quot;&gt;        &lt;div class=&quot;modal-header&quot;&gt;          &lt;h3&gt;&#123;&#123; showEditModal ? &#x27;ç¼–è¾‘ç”¨æˆ·&#x27; : &#x27;åˆ›å»ºç”¨æˆ·&#x27; &#125;&#125;&lt;/h3&gt;          &lt;button @click=&quot;closeModal&quot; class=&quot;close-btn&quot;&gt;&amp;times;&lt;/button&gt;        &lt;/div&gt;        &lt;div class=&quot;modal-body&quot;&gt;          &lt;form @submit.prevent=&quot;handleSubmit&quot;&gt;            &lt;div class=&quot;form-group&quot;&gt;              &lt;label&gt;ç”¨æˆ·å:&lt;/label&gt;              &lt;input                v-model=&quot;form.name&quot;                required                class=&quot;form-control&quot;              /&gt;            &lt;/div&gt;            &lt;div class=&quot;form-group&quot;&gt;              &lt;label&gt;é‚®ç®±:&lt;/label&gt;              &lt;input                v-model=&quot;form.email&quot;                type=&quot;email&quot;                required                class=&quot;form-control&quot;              /&gt;            &lt;/div&gt;            &lt;div class=&quot;form-group&quot;&gt;              &lt;label&gt;å¹´é¾„:&lt;/label&gt;              &lt;input                v-model.number=&quot;form.age&quot;                type=&quot;number&quot;                min=&quot;1&quot;                max=&quot;150&quot;                required                class=&quot;form-control&quot;              /&gt;            &lt;/div&gt;            &lt;div class=&quot;form-group&quot;&gt;              &lt;label&gt;ç­‰çº§:&lt;/label&gt;              &lt;select v-model.number=&quot;form.level&quot; class=&quot;form-control&quot;&gt;                &lt;option value=&quot;1&quot;&gt;ç­‰çº§1&lt;/option&gt;                &lt;option value=&quot;2&quot;&gt;ç­‰çº§2&lt;/option&gt;                &lt;option value=&quot;3&quot;&gt;ç­‰çº§3&lt;/option&gt;              &lt;/select&gt;            &lt;/div&gt;            &lt;div class=&quot;form-group&quot;&gt;              &lt;label&gt;ç§¯åˆ†:&lt;/label&gt;              &lt;input                v-model.number=&quot;form.points&quot;                type=&quot;number&quot;                min=&quot;0&quot;                class=&quot;form-control&quot;              /&gt;            &lt;/div&gt;            &lt;div class=&quot;form-actions&quot;&gt;              &lt;button type=&quot;submit&quot; class=&quot;btn btn-primary&quot;&gt;                &#123;&#123; showEditModal ? &#x27;æ›´æ–°&#x27; : &#x27;åˆ›å»º&#x27; &#125;&#125;              &lt;/button&gt;              &lt;button type=&quot;button&quot; @click=&quot;closeModal&quot; class=&quot;btn btn-secondary&quot;&gt;                å–æ¶ˆ              &lt;/button&gt;            &lt;/div&gt;          &lt;/form&gt;        &lt;/div&gt;      &lt;/div&gt;    &lt;/div&gt;  &lt;/div&gt;&lt;/template&gt;&lt;script setup&gt;import &#123; ref, reactive &#125; from &#x27;vue&#x27;import &#123; useIndexedDB &#125; from &#x27;@/composables/useIndexedDB&#x27;import &#123; searchUsers &#125; from &#x27;@/api/user&#x27;// ä½¿ç”¨IndexedDB composableconst &#123;  data,  loading,  error,  pagination,  getByPage,  create,  update,  remove&#125; = useIndexedDB(&#x27;users&#x27;)// ç»„ä»¶çŠ¶æ€const showCreateModal = ref(false)const showEditModal = ref(false)const searchName = ref(&#x27;&#x27;)const filterLevel = ref(&#x27;&#x27;)const currentEditId = ref(null)// è¡¨å•æ•°æ®const form = reactive(&#123;  name: &#x27;&#x27;,  email: &#x27;&#x27;,  age: 18,  level: 1,  points: 0,  createdAt: new Date().toISOString(),  updatedAt: new Date().toISOString()&#125;)// åˆå§‹åŒ–const init = async () =&gt; &#123;  await getByPage(1, 20)&#125;// æœç´¢å¤„ç†const handleSearch = async () =&gt; &#123;  const filters = &#123;&#125;  if (searchName.value) &#123;    filters.name = searchName.value  &#125;  if (filterLevel.value) &#123;    filters.level = parseInt(filterLevel.value)  &#125;  const result = await searchUsers(filters)  if (result.success) &#123;    data.value = result.data    pagination.value.totalCount = result.data.length    pagination.value.totalPages = 1  &#125;&#125;// åˆ†é¡µå¤„ç†const handlePageChange = async (newPage) =&gt; &#123;  await getByPage(newPage, pagination.value.pageSize)&#125;// ç¼–è¾‘ç”¨æˆ·const handleEdit = async (user) =&gt; &#123;  currentEditId.value = user.id  form.name = user.name  form.email = user.email  form.age = user.age  form.level = user.level  form.points = user.points  showEditModal.value = true&#125;// åˆ é™¤ç”¨æˆ·const handleDelete = async (userId) =&gt; &#123;  if (confirm(&#x27;ç¡®å®šè¦åˆ é™¤è¿™ä¸ªç”¨æˆ·å—ï¼Ÿ&#x27;)) &#123;    const result = await remove(userId)    if (result.success) &#123;      await init() // é‡æ–°åŠ è½½æ•°æ®    &#125;  &#125;&#125;// è¡¨å•æäº¤const handleSubmit = async () =&gt; &#123;  form.updatedAt = new Date().toISOString()  if (showEditModal.value) &#123;    // æ›´æ–°ç”¨æˆ·    const result = await update(currentEditId.value, form)    if (result.success) &#123;      closeModal()      await init()    &#125;  &#125; else &#123;    // åˆ›å»ºç”¨æˆ·    const result = await create(form)    if (result.success) &#123;      closeModal()      await init()    &#125;  &#125;&#125;// å…³é—­æ¨¡æ€æ¡†const closeModal = () =&gt; &#123;  showCreateModal.value = false  showEditModal.value = false  currentEditId.value = null  // é‡ç½®è¡¨å•  form.name = &#x27;&#x27;  form.email = &#x27;&#x27;  form.age = 18  form.level = 1  form.points = 0&#125;// é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–init()&lt;/script&gt;&lt;style scoped&gt;/* ç»„ä»¶æ ·å¼ */.user-management &#123;  max-width: 1200px;  margin: 0 auto;  padding: 20px;&#125;.header &#123;  display: flex;  justify-content: space-between;  align-items: center;  margin-bottom: 20px;&#125;.filters &#123;  display: flex;  gap: 10px;  margin-bottom: 20px;&#125;.search-input, .filter-select &#123;  padding: 8px 12px;  border: 1px solid #ddd;  border-radius: 4px;  flex: 1;  max-width: 300px;&#125;.loading, .error &#123;  text-align: center;  padding: 20px;  color: #666;&#125;.error &#123;  color: #dc3545;&#125;.user-table &#123;  width: 100%;  border-collapse: collapse;  margin-bottom: 20px;&#125;.user-table th, .user-table td &#123;  padding: 12px 15px;  text-align: left;  border-bottom: 1px solid #ddd;&#125;.user-table th &#123;  background-color: #f8f9fa;  font-weight: bold;&#125;.actions &#123;  display: flex;  gap: 5px;&#125;.btn &#123;  padding: 6px 12px;  border: none;  border-radius: 4px;  cursor: pointer;  font-size: 14px;&#125;.btn-primary &#123;  background-color: #007bff;  color: white;&#125;.btn-edit &#123;  background-color: #28a745;  color: white;&#125;.btn-delete &#123;  background-color: #dc3545;  color: white;&#125;.pagination &#123;  display: flex;  justify-content: center;  align-items: center;  gap: 10px;  margin-top: 20px;&#125;.page-btn &#123;  padding: 6px 12px;  border: 1px solid #ddd;  background-color: white;  cursor: pointer;&#125;.page-btn:disabled &#123;  cursor: not-allowed;  opacity: 0.5;&#125;.modal-overlay &#123;  position: fixed;  top: 0;  left: 0;  right: 0;  bottom: 0;  background-color: rgba(0, 0, 0, 0.5);  display: flex;  justify-content: center;  align-items: center;  z-index: 1000;&#125;.modal &#123;  background-color: white;  border-radius: 4px;  width: 90%;  max-width: 500px;  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);&#125;.modal-header &#123;  display: flex;  justify-content: space-between;  align-items: center;  padding: 15px;  border-bottom: 1px solid #ddd;&#125;.close-btn &#123;  background: none;  border: none;  font-size: 20px;  cursor: pointer;&#125;.modal-body &#123;  padding: 15px;&#125;.form-group &#123;  margin-bottom: 15px;&#125;.form-control &#123;  width: 100%;  padding: 8px 12px;  border: 1px solid #ddd;  border-radius: 4px;&#125;.form-actions &#123;  display: flex;  gap: 10px;  margin-top: 20px;&#125;&lt;/style&gt;\nVuex/Pinia é›†æˆ\n// src/store/indexedDB.js (Pinia store)import &#123; defineStore &#125; from &#x27;pinia&#x27;import &#123; getDB &#125; from &#x27;@/utils/indexedDB&#x27;export const useIndexedDBStore = defineStore(&#x27;indexedDB&#x27;, &#123;  state: () =&gt; (&#123;    stores: &#123;&#125;,    loading: false,    error: null  &#125;),  actions: &#123;    async initStore(storeName) &#123;      if (!this.stores[storeName]) &#123;        this.stores[storeName] = &#123;          data: [],          pagination: &#123;            page: 1,            pageSize: 20,            totalCount: 0,            totalPages: 0          &#125;        &#125;      &#125;    &#125;,    async getById(storeName, id) &#123;      this.loading = true      this.error = null      try &#123;        await this.initStore(storeName)        const db = await getDB()        const data = await db.get(storeName, id)                this.stores[storeName].data = data ? [data] : []        return &#123; success: true, data &#125;      &#125; catch (error) &#123;        this.error = error.message        console.error(`è·å–$&#123;storeName&#125;æ•°æ®å¤±è´¥:`, error)        return &#123; success: false, error: error.message &#125;      &#125; finally &#123;        this.loading = false      &#125;    &#125;,    async getAll(storeName) &#123;      this.loading = true      this.error = null      try &#123;        await this.initStore(storeName)        const db = await getDB()        const data = await db.getAll(storeName)                this.stores[storeName].data = data        this.stores[storeName].pagination.totalCount = data.length        this.stores[storeName].pagination.totalPages = 1                return &#123; success: true, data &#125;      &#125; catch (error) &#123;        this.error = error.message        console.error(`è·å–æ‰€æœ‰$&#123;storeName&#125;æ•°æ®å¤±è´¥:`, error)        return &#123; success: false, error: error.message &#125;      &#125; finally &#123;        this.loading = false      &#125;    &#125;,    async create(storeName, item) &#123;      this.loading = true      this.error = null      try &#123;        const db = await getDB()        const id = await db.add(storeName, item)                // é‡æ–°åŠ è½½æ•°æ®        await this.getAll(storeName)                return &#123; success: true, id &#125;      &#125; catch (error) &#123;        this.error = error.message        console.error(`åˆ›å»º$&#123;storeName&#125;æ•°æ®å¤±è´¥:`, error)        return &#123; success: false, error: error.message &#125;      &#125; finally &#123;        this.loading = false      &#125;    &#125;,    async update(storeName, id, item) &#123;      this.loading = true      this.error = null      try &#123;        const db = await getDB()        await db.put(storeName, &#123; ...item, id &#125;)                // é‡æ–°åŠ è½½æ•°æ®        await this.getAll(storeName)                return &#123; success: true &#125;      &#125; catch (error) &#123;        this.error = error.message        console.error(`æ›´æ–°$&#123;storeName&#125;æ•°æ®å¤±è´¥:`, error)        return &#123; success: false, error: error.message &#125;      &#125; finally &#123;        this.loading = false      &#125;    &#125;,    async remove(storeName, id) &#123;      this.loading = true      this.error = null      try &#123;        const db = await getDB()        await db.delete(storeName, id)                // é‡æ–°åŠ è½½æ•°æ®        await this.getAll(storeName)                return &#123; success: true &#125;      &#125; catch (error) &#123;        this.error = error.message        console.error(`åˆ é™¤$&#123;storeName&#125;æ•°æ®å¤±è´¥:`, error)        return &#123; success: false, error: error.message &#125;      &#125; finally &#123;        this.loading = false      &#125;    &#125;  &#125;,  getters: &#123;    getStoreData: (state) =&gt; (storeName) =&gt; &#123;      return state.stores[storeName]?.data || []    &#125;,    getStorePagination: (state) =&gt; (storeName) =&gt; &#123;      return state.stores[storeName]?.pagination || &#123;        page: 1,        pageSize: 20,        totalCount: 0,        totalPages: 0      &#125;    &#125;  &#125;&#125;)\nå¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ\n1. æ•°æ®åº“è¿æ¥é—®é¢˜\né—®é¢˜ï¼šæ•°æ®åº“è¿æ¥è¢«é˜»å¡æˆ–æ— æ³•æ‰“å¼€\nè§£å†³æ–¹æ¡ˆï¼š\n// æ”¹è¿›çš„è¿æ¥ç®¡ç†let dbInstance = nulllet dbOpening = falselet dbQueue = []export const getDB = async () =&gt; &#123;  if (dbInstance) &#123;    return dbInstance  &#125;  // å¦‚æœæ­£åœ¨æ‰“å¼€è¿æ¥ï¼ŒåŠ å…¥é˜Ÿåˆ—ç­‰å¾…  if (dbOpening) &#123;    return new Promise((resolve) =&gt; &#123;      dbQueue.push(resolve)    &#125;)  &#125;  dbOpening = true  try &#123;    dbInstance = await initDB()        // é€šçŸ¥æ‰€æœ‰ç­‰å¾…çš„è¿æ¥    while (dbQueue.length &gt; 0) &#123;      dbQueue.shift()(dbInstance)    &#125;        return dbInstance  &#125; catch (error) &#123;    console.error(&#x27;æ•°æ®åº“è¿æ¥å¤±è´¥:&#x27;, error)        // æ¸…ç©ºé˜Ÿåˆ—å¹¶è¿”å›é”™è¯¯    while (dbQueue.length &gt; 0) &#123;      dbQueue.shift()(null)    &#125;        throw error  &#125; finally &#123;    dbOpening = false  &#125;&#125;// è¿æ¥å¥åº·æ£€æŸ¥export const checkDBHealth = async () =&gt; &#123;  try &#123;    const db = await getDB()        // å°è¯•æ‰§è¡Œä¸€ä¸ªç®€å•çš„æ“ä½œæ¥æ£€æŸ¥è¿æ¥çŠ¶æ€    const tx = db.transaction(db.objectStoreNames[0] || &#x27;settings&#x27;, &#x27;readonly&#x27;)    await tx.done        return true  &#125; catch (error) &#123;    console.error(&#x27;æ•°æ®åº“è¿æ¥ä¸å¥åº·ï¼Œå°è¯•é‡æ–°è¿æ¥:&#x27;, error)        // é‡ç½®è¿æ¥å®ä¾‹    dbInstance = null        // å°è¯•é‡æ–°è¿æ¥    try &#123;      dbInstance = await initDB()      return true    &#125; catch (reconnectError) &#123;      console.error(&#x27;é‡æ–°è¿æ¥æ•°æ®åº“å¤±è´¥:&#x27;, reconnectError)      return false    &#125;  &#125;&#125;\n2. æ•°æ®è¿ç§»é—®é¢˜\né—®é¢˜ï¼šç‰ˆæœ¬å‡çº§æ—¶æ•°æ®è¿ç§»å¤±è´¥\nè§£å†³æ–¹æ¡ˆï¼š\n// å®‰å…¨çš„æ•°æ®è¿ç§»å·¥å…·export const safeMigrate = async (migrationSteps) =&gt; &#123;  const currentVersion = await getCurrentDBVersion()  const targetVersion = Math.max(...Object.keys(migrationSteps).map(v =&gt; parseInt(v)))  if (currentVersion &gt;= targetVersion) &#123;    return &#123; success: true, message: &#x27;æ— éœ€è¿ç§»&#x27; &#125;  &#125;  try &#123;    // å¤‡ä»½å½“å‰æ•°æ®    await backupDatabase()    // æ‰§è¡Œè¿ç§»æ­¥éª¤    for (let version = currentVersion + 1; version &lt;= targetVersion; version++) &#123;      if (migrationSteps[version]) &#123;        console.log(`æ‰§è¡Œè¿ç§»æ­¥éª¤: $&#123;version&#125;`)        await migrationSteps[version]()      &#125;    &#125;    return &#123; success: true, message: &#x27;è¿ç§»å®Œæˆ&#x27; &#125;  &#125; catch (error) &#123;    console.error(&#x27;è¿ç§»å¤±è´¥ï¼Œå°è¯•å›æ»š:&#x27;, error)        // å°è¯•å›æ»šåˆ°å¤‡ä»½    await restoreDatabase()        return &#123; success: false, error: error.message &#125;  &#125;&#125;// æ•°æ®åº“å¤‡ä»½export const backupDatabase = async () =&gt; &#123;  const db = await getDB()  const backup = &#123;&#125;  // å¤‡ä»½æ‰€æœ‰å¯¹è±¡ä»“åº“çš„æ•°æ®  for (const storeName of db.objectStoreNames) &#123;    const tx = db.transaction(storeName, &#x27;readonly&#x27;)    const store = tx.objectStore(storeName)    backup[storeName] = await store.getAll()    await tx.done  &#125;  // ä¿å­˜å¤‡ä»½åˆ°localStorageæˆ–æœåŠ¡å™¨  localStorage.setItem(&#x27;db_backup&#x27;, JSON.stringify(&#123;    timestamp: new Date().toISOString(),    version: db.version,    data: backup  &#125;))  return backup&#125;// æ•°æ®åº“æ¢å¤export const restoreDatabase = async () =&gt; &#123;  const backupData = localStorage.getItem(&#x27;db_backup&#x27;)    if (!backupData) &#123;    throw new Error(&#x27;æ²¡æœ‰æ‰¾åˆ°å¤‡ä»½æ•°æ®&#x27;)  &#125;  const &#123; data, version &#125; = JSON.parse(backupData)  const db = await openDB(DB_NAME, version, &#123;    upgrade(db) &#123;      // é‡å»ºå¯¹è±¡ä»“åº“ç»“æ„      for (const storeName in data) &#123;        if (!db.objectStoreNames.contains(storeName)) &#123;          db.createObjectStore(storeName)        &#125;      &#125;    &#125;  &#125;)  // æ¢å¤æ•°æ®  for (const storeName in data) &#123;    const tx = db.transaction(storeName, &#x27;readwrite&#x27;)    const store = tx.objectStore(storeName)        // æ¸…ç©ºç°æœ‰æ•°æ®    await store.clear()        // æ¢å¤å¤‡ä»½æ•°æ®    for (const item of data[storeName]) &#123;      await store.put(item)    &#125;        await tx.done  &#125;  return true&#125;\n3. æ€§èƒ½é—®é¢˜\né—®é¢˜ï¼šå¤§é‡æ•°æ®æ“ä½œæ—¶æ€§èƒ½ä½ä¸‹\nè§£å†³æ–¹æ¡ˆï¼š\n// æ‰¹é‡æ“ä½œä¼˜åŒ–export const batchOperations = async (storeName, operations) =&gt; &#123;  const db = await getDB()    try &#123;    const tx = db.transaction(storeName, &#x27;readwrite&#x27;)    const store = tx.objectStore(storeName)        const results = []        for (const op of operations) &#123;      let result            switch (op.type) &#123;        case &#x27;add&#x27;:          result = await store.add(op.data)          break        case &#x27;put&#x27;:          result = await store.put(op.data)          break        case &#x27;delete&#x27;:          result = await store.delete(op.key)          break        default:          throw new Error(`ä¸æ”¯æŒçš„æ“ä½œç±»å‹: $&#123;op.type&#125;`)      &#125;            results.push(&#123;        operation: op,        result,        success: true      &#125;)    &#125;        await tx.done    return &#123; success: true, results &#125;  &#125; catch (error) &#123;    console.error(&#x27;æ‰¹é‡æ“ä½œå¤±è´¥:&#x27;, error)    return &#123; success: false, error: error.message &#125;  &#125;&#125;// å¤§æ•°æ®é›†åˆ†é¡µæŸ¥è¯¢ä¼˜åŒ–export const optimizedPagination = async (storeName, page = 1, pageSize = 20, indexName = null, keyRange = null) =&gt; &#123;  const db = await getDB()    try &#123;    const tx = db.transaction(storeName, &#x27;readonly&#x27;)    const store = tx.objectStore(storeName)        let index = store    if (indexName &amp;&amp; store.indexNames.contains(indexName)) &#123;      index = store.index(indexName)    &#125;        // è·å–æ€»æ•°ï¼ˆä¼˜åŒ–ï¼šå¦‚æœæœ‰èŒƒå›´æŸ¥è¯¢ï¼Œå…ˆè·å–èŒƒå›´å†…çš„æ€»æ•°ï¼‰    const totalCount = keyRange       ? await index.count(keyRange)      : await store.count()        const totalPages = Math.ceil(totalCount / pageSize)    const skip = (page - 1) * pageSize        const data = []        // ä½¿ç”¨æ¸¸æ ‡è¿›è¡Œé«˜æ•ˆåˆ†é¡µ    await new Promise((resolve, reject) =&gt; &#123;      let count = 0      const cursorRequest = keyRange         ? index.openCursor(keyRange)        : index.openCursor()            cursorRequest.onsuccess = (event) =&gt; &#123;        const cursor = event.target.result        if (cursor) &#123;          if (count &gt;= skip &amp;&amp; count &lt; skip + pageSize) &#123;            data.push(cursor.value)          &#125;                    count++                    if (count &lt; skip + pageSize) &#123;            cursor.continue()          &#125; else &#123;            resolve()          &#125;        &#125; else &#123;          resolve()        &#125;      &#125;            cursorRequest.onerror = (event) =&gt; &#123;        reject(event.target.error)      &#125;    &#125;)        await tx.done        return &#123;      success: true,      data,      pagination: &#123;        page,        pageSize,        totalCount,        totalPages      &#125;    &#125;  &#125; catch (error) &#123;    console.error(&#x27;ä¼˜åŒ–åˆ†é¡µæŸ¥è¯¢å¤±è´¥:&#x27;, error)    return &#123; success: false, error: error.message &#125;  &#125;&#125;\n4. æµè§ˆå™¨å…¼å®¹æ€§é—®é¢˜\né—®é¢˜ï¼šæŸäº›æµè§ˆå™¨ä¸æ”¯æŒ IndexedDB æˆ– idb åº“\nè§£å†³æ–¹æ¡ˆï¼š\n// å…¼å®¹æ€§æ£€æµ‹å’Œé™çº§æ–¹æ¡ˆexport const checkCompatibility = () =&gt; &#123;  try &#123;    // æ£€æµ‹IndexedDBæ”¯æŒ    if (!window.indexedDB) &#123;      return &#123;        supported: false,        message: &#x27;æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒIndexedDBï¼Œè¯·å‡çº§åˆ°ç°ä»£æµè§ˆå™¨&#x27;      &#125;    &#125;    // æ£€æµ‹Promiseæ”¯æŒï¼ˆidbéœ€è¦Promiseï¼‰    if (!window.Promise) &#123;      return &#123;        supported: false,        message: &#x27;æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒPromiseï¼Œè¯·å‡çº§åˆ°ç°ä»£æµè§ˆå™¨&#x27;      &#125;    &#125;    return &#123; supported: true &#125;  &#125; catch (error) &#123;    return &#123;      supported: false,      message: `å…¼å®¹æ€§æ£€æµ‹å¤±è´¥: $&#123;error.message&#125;`    &#125;  &#125;&#125;// é™çº§åˆ°localStorageçš„é€‚é…å™¨export const createFallbackStorage = () =&gt; &#123;  const STORAGE_KEY = &#x27;fallback_db_&#x27;  return &#123;    async get(storeName, key) &#123;      const data = localStorage.getItem(STORAGE_KEY + storeName)      if (!data) return null            const store = JSON.parse(data)      return store[key] || null    &#125;,    async getAll(storeName) &#123;      const data = localStorage.getItem(STORAGE_KEY + storeName)      if (!data) return []            const store = JSON.parse(data)      return Object.values(store)    &#125;,    async add(storeName, value, key) &#123;      const data = localStorage.getItem(STORAGE_KEY + storeName) || &#x27;&#123;&#125;&#x27;      const store = JSON.parse(data)            if (store[key]) &#123;        throw new Error(`ä¸»é”® $&#123;key&#125; å·²å­˜åœ¨`)      &#125;            store[key] = value      localStorage.setItem(STORAGE_KEY + storeName, JSON.stringify(store))      return key    &#125;,    async put(storeName, value, key) &#123;      const data = localStorage.getItem(STORAGE_KEY + storeName) || &#x27;&#123;&#125;&#x27;      const store = JSON.parse(data)            store[key] = value      localStorage.setItem(STORAGE_KEY + storeName, JSON.stringify(store))      return key    &#125;,    async delete(storeName, key) &#123;      const data = localStorage.getItem(STORAGE_KEY + storeName)      if (!data) return            const store = JSON.parse(data)      delete store[key]      localStorage.setItem(STORAGE_KEY + storeName, JSON.stringify(store))    &#125;,    async clear(storeName) &#123;      localStorage.removeItem(STORAGE_KEY + storeName)    &#125;,    async count(storeName) &#123;      const data = localStorage.getItem(STORAGE_KEY + storeName)      if (!data) return 0            const store = JSON.parse(data)      return Object.keys(store).length    &#125;  &#125;&#125;// åˆ›å»ºç»Ÿä¸€çš„å­˜å‚¨æ¥å£export const createStorage = async () =&gt; &#123;  const compatibility = checkCompatibility()    if (!compatibility.supported) &#123;    console.warn(&#x27;IndexedDBä¸æ”¯æŒï¼Œä½¿ç”¨localStorageé™çº§æ–¹æ¡ˆ&#x27;)    return createFallbackStorage()  &#125;  try &#123;    // å°è¯•åˆå§‹åŒ–IndexedDB    const db = await getDB()    return db  &#125; catch (error) &#123;    console.warn(&#x27;IndexedDBåˆå§‹åŒ–å¤±è´¥ï¼Œä½¿ç”¨localStorageé™çº§æ–¹æ¡ˆ:&#x27;, error)    return createFallbackStorage()  &#125;&#125;\næ€§èƒ½ä¼˜åŒ–\n1. è¿æ¥æ± ç®¡ç†\n// æ•°æ®åº“è¿æ¥æ± class DBConnectionPool &#123;  constructor() &#123;    this.pool = []    this.maxConnections = 5    this.waiting = []    this.isClosed = false  &#125;  async getConnection() &#123;    if (this.isClosed) &#123;      throw new Error(&#x27;è¿æ¥æ± å·²å…³é—­&#x27;)    &#125;    // å¦‚æœæœ‰ç©ºé—²è¿æ¥ï¼Œç›´æ¥è¿”å›    if (this.pool.length &gt; 0) &#123;      return this.pool.shift()    &#125;    // å¦‚æœæœªè¾¾åˆ°æœ€å¤§è¿æ¥æ•°ï¼Œåˆ›å»ºæ–°è¿æ¥    if (this.pool.length + this.waiting.length &lt; this.maxConnections) &#123;      const db = await initDB()      return db    &#125;    // å¦åˆ™ç­‰å¾…ç©ºé—²è¿æ¥    return new Promise((resolve) =&gt; &#123;      this.waiting.push(resolve)    &#125;)  &#125;  releaseConnection(db) &#123;    if (this.isClosed) &#123;      db.close()      return    &#125;    // å¦‚æœæœ‰ç­‰å¾…çš„è¯·æ±‚ï¼Œç›´æ¥åˆ†é…è¿æ¥    if (this.waiting.length &gt; 0) &#123;      const resolve = this.waiting.shift()      resolve(db)      return    &#125;    // å¦åˆ™æ”¾å›è¿æ¥æ±     this.pool.push(db)  &#125;  async close() &#123;    this.isClosed = true    // å…³é—­æ‰€æœ‰è¿æ¥    for (const db of this.pool) &#123;      await db.close()    &#125;    // æ‹’ç»æ‰€æœ‰ç­‰å¾…çš„è¯·æ±‚    for (const resolve of this.waiting) &#123;      resolve(null)    &#125;    this.pool = []    this.waiting = []  &#125;&#125;// åˆ›å»ºè¿æ¥æ± å®ä¾‹export const connectionPool = new DBConnectionPool()// ä½¿ç”¨è¿æ¥æ± çš„æ•°æ®åº“æ“ä½œexport const withConnection = async (operation) =&gt; &#123;  let db = null  try &#123;    db = await connectionPool.getConnection()        if (!db) &#123;      throw new Error(&#x27;æ— æ³•è·å–æ•°æ®åº“è¿æ¥&#x27;)    &#125;    return await operation(db)  &#125; finally &#123;    if (db) &#123;      connectionPool.releaseConnection(db)    &#125;  &#125;&#125;// ä½¿ç”¨è¿æ¥æ± çš„ç¤ºä¾‹export const getUserWithPool = async (userId) =&gt; &#123;  return withConnection(async (db) =&gt; &#123;    return db.get(&#x27;users&#x27;, userId)  &#125;)&#125;\n2. ç¼“å­˜ç­–ç•¥\n// å†…å­˜ç¼“å­˜ç®¡ç†å™¨class CacheManager &#123;  constructor(options = &#123;&#125;) &#123;    this.cache = new Map()    this.ttl = options.ttl || 5 * 60 * 1000 // é»˜è®¤5åˆ†é’Ÿ    this.maxSize = options.maxSize || 1000  &#125;  set(key, value, ttl = this.ttl) &#123;    // å¦‚æœç¼“å­˜å·²æ»¡ï¼Œåˆ é™¤æœ€æ—§çš„æ¡ç›®    if (this.cache.size &gt;= this.maxSize) &#123;      const firstKey = this.cache.keys().next().value      this.cache.delete(firstKey)    &#125;    const expireTime = Date.now() + ttl    this.cache.set(key, &#123; value, expireTime &#125;)  &#125;  get(key) &#123;    const item = this.cache.get(key)        if (!item) &#123;      return null    &#125;    // æ£€æŸ¥æ˜¯å¦è¿‡æœŸ    if (Date.now() &gt; item.expireTime) &#123;      this.cache.delete(key)      return null    &#125;    return item.value  &#125;  delete(key) &#123;    this.cache.delete(key)  &#125;  clear() &#123;    this.cache.clear()  &#125;  has(key) &#123;    return this.get(key) !== null  &#125;&#125;// åˆ›å»ºç¼“å­˜å®ä¾‹export const cache = new CacheManager(&#123;  ttl: 10 * 60 * 1000, // 10åˆ†é’Ÿ  maxSize: 500&#125;)// å¸¦ç¼“å­˜çš„æ•°æ®è·å–export const getCachedData = async (storeName, key, options = &#123;&#125;) =&gt; &#123;  const cacheKey = `$&#123;storeName&#125;:$&#123;key&#125;`    // å…ˆæ£€æŸ¥ç¼“å­˜  const cachedData = cache.get(cacheKey)  if (cachedData &amp;&amp; !options.forceRefresh) &#123;    return &#123; success: true, data: cachedData, fromCache: true &#125;  &#125;  // ç¼“å­˜æœªå‘½ä¸­æˆ–éœ€è¦å¼ºåˆ¶åˆ·æ–°ï¼Œä»æ•°æ®åº“è·å–  try &#123;    const result = await withConnection(async (db) =&gt; &#123;      return db.get(storeName, key)    &#125;)    if (result) &#123;      // æ›´æ–°ç¼“å­˜      cache.set(cacheKey, result, options.ttl)      return &#123; success: true, data: result, fromCache: false &#125;    &#125;    return &#123; success: false, error: &#x27;æ•°æ®ä¸å­˜åœ¨&#x27; &#125;  &#125; catch (error) &#123;    console.error(`è·å–$&#123;storeName&#125;æ•°æ®å¤±è´¥:`, error)    return &#123; success: false, error: error.message &#125;  &#125;&#125;// ç¼“å­˜å¤±æ•ˆæœºåˆ¶export const invalidateCache = (storeName, key = null) =&gt; &#123;  if (key) &#123;    cache.delete(`$&#123;storeName&#125;:$&#123;key&#125;`)  &#125; else &#123;    // æ¸…é™¤æ•´ä¸ªstoreçš„ç¼“å­˜    for (const cacheKey of cache.cache.keys()) &#123;      if (cacheKey.startsWith(`$&#123;storeName&#125;:`)) &#123;        cache.delete(cacheKey)      &#125;    &#125;  &#125;&#125;// æ›´æ–°æ•°æ®æ—¶è‡ªåŠ¨å¤±æ•ˆç¼“å­˜export const updateWithCacheInvalidation = async (storeName, id, data) =&gt; &#123;  const result = await withConnection(async (db) =&gt; &#123;    return db.put(storeName, data, id)  &#125;)  if (result.success) &#123;    // å¤±æ•ˆç›¸å…³ç¼“å­˜    invalidateCache(storeName, id)    // å¯ä»¥æ ¹æ®éœ€è¦å¤±æ•ˆå…¶ä»–ç›¸å…³ç¼“å­˜  &#125;  return result&#125;\n3. æ‰¹é‡æ“ä½œä¼˜åŒ–\n// æ‰¹é‡æ“ä½œé˜Ÿåˆ—class BatchOperationQueue &#123;  constructor(options = &#123;&#125;) &#123;    this.queue = new Map()    this.batchSize = options.batchSize || 100    this.delay = options.delay || 100    this.timers = new Map()  &#125;  addOperation(storeName, operation) &#123;    if (!this.queue.has(storeName)) &#123;      this.queue.set(storeName, [])    &#125;    const storeQueue = this.queue.get(storeName)    storeQueue.push(operation)    // å¦‚æœè¾¾åˆ°æ‰¹å¤„ç†å¤§å°ï¼Œç«‹å³æ‰§è¡Œ    if (storeQueue.length &gt;= this.batchSize) &#123;      this.processBatch(storeName)    &#125; else if (!this.timers.has(storeName)) &#123;      // å¦åˆ™è®¾ç½®å»¶è¿Ÿæ‰§è¡Œ      this.timers.set(storeName, setTimeout(() =&gt; &#123;        this.processBatch(storeName)      &#125;, this.delay))    &#125;  &#125;  async processBatch(storeName) &#123;    // æ¸…é™¤å®šæ—¶å™¨    if (this.timers.has(storeName)) &#123;      clearTimeout(this.timers.get(storeName))      this.timers.delete(storeName)    &#125;    const storeQueue = this.queue.get(storeName)    if (!storeQueue || storeQueue.length === 0) &#123;      return    &#125;    try &#123;      // æ‰§è¡Œæ‰¹å¤„ç†æ“ä½œ      await batchOperations(storeName, storeQueue)            // æ¸…ç©ºé˜Ÿåˆ—      this.queue.set(storeName, [])    &#125; catch (error) &#123;      console.error(`æ‰¹å¤„ç†æ“ä½œå¤±è´¥ ($&#123;storeName&#125;):`, error)      // å¯ä»¥é€‰æ‹©é‡è¯•æˆ–å¤„ç†å¤±è´¥çš„æ“ä½œ    &#125;  &#125;  async flush() &#123;    // ç«‹å³æ‰§è¡Œæ‰€æœ‰é˜Ÿåˆ—ä¸­çš„æ“ä½œ    for (const storeName of this.queue.keys()) &#123;      await this.processBatch(storeName)    &#125;  &#125;&#125;// åˆ›å»ºæ‰¹å¤„ç†é˜Ÿåˆ—å®ä¾‹export const batchQueue = new BatchOperationQueue(&#123;  batchSize: 50,  delay: 50&#125;)// ä½¿ç”¨æ‰¹å¤„ç†é˜Ÿåˆ—çš„æ“ä½œexport const queueUserUpdate = (userId, data) =&gt; &#123;  batchQueue.addOperation(&#x27;users&#x27;, &#123;    type: &#x27;put&#x27;,    data: &#123; id: userId, ...data &#125;  &#125;)&#125;export const queueProductAdd = (productData) =&gt; &#123;  batchQueue.addOperation(&#x27;products&#x27;, &#123;    type: &#x27;add&#x27;,    data: productData  &#125;)&#125;\n4. ç´¢å¼•ä¼˜åŒ–\n// ç´¢å¼•ä½¿ç”¨å»ºè®®å’Œä¼˜åŒ–export const optimizeIndexes = async () =&gt; &#123;  const db = await getDB()    // åˆ†ææŸ¥è¯¢æ¨¡å¼å¹¶å»ºè®®ç´¢å¼•  const indexRecommendations = []  // æ£€æŸ¥ç”¨æˆ·è¡¨çš„æŸ¥è¯¢æ¨¡å¼  const userStore = db.transaction(&#x27;users&#x27;, &#x27;readonly&#x27;).objectStore(&#x27;users&#x27;)    // æ£€æŸ¥å¸¸ç”¨æŸ¥è¯¢å­—æ®µæ˜¯å¦æœ‰ç´¢å¼•  const commonQueryFields = [&#x27;email&#x27;, &#x27;username&#x27;, &#x27;level&#x27;, &#x27;age&#x27;]  for (const field of commonQueryFields) &#123;    if (!userStore.indexNames.contains(field)) &#123;      indexRecommendations.push(&#123;        storeName: &#x27;users&#x27;,        field,        reason: &#x27;å¸¸ç”¨æŸ¥è¯¢å­—æ®µç¼ºå°‘ç´¢å¼•&#x27;      &#125;)    &#125;  &#125;  return indexRecommendations&#125;// ç´¢å¼•ä½¿ç”¨æ€§èƒ½ç›‘æ§export const monitorIndexPerformance = async () =&gt; &#123;  const db = await getDB()  const performanceData = &#123;&#125;  for (const storeName of db.objectStoreNames) &#123;    const tx = db.transaction(storeName, &#x27;readonly&#x27;)    const store = tx.objectStore(storeName)        performanceData[storeName] = &#123;      indexes: Array.from(store.indexNames),      recordCount: await store.count()    &#125;    await tx.done  &#125;  return performanceData&#125;\næ€»ç»“\næœ¬æŒ‡å—è¯¦ç»†ä»‹ç»äº†å¦‚ä½•åœ¨ Vue åº”ç”¨ä¸­ä½¿ç”¨ idb åº“æ“ä½œ IndexedDBï¼Œæ¶µç›–äº†ä»åŸºç¡€æ¦‚å¿µåˆ°é«˜çº§åº”ç”¨çš„å„ä¸ªæ–¹é¢ï¼š\næ ¸å¿ƒè¦ç‚¹\n\n\nç¯å¢ƒæ­å»ºï¼šå®‰è£… idb åº“å¹¶åˆ›å»ºæ•°æ®åº“è¿æ¥ç®¡ç†\n\n\nåŸºç¡€æ“ä½œï¼šæŒæ¡ CRUD æ“ä½œå’Œäº‹åŠ¡å¤„ç†\n\n\nç‰ˆæœ¬ç®¡ç†ï¼šæ­£ç¡®å¤„ç†æ•°æ®åº“ç‰ˆæœ¬å‡çº§å’Œè¿ç§»\n\n\nç´¢å¼•ä¼˜åŒ–ï¼šä½¿ç”¨ç´¢å¼•æé«˜æŸ¥è¯¢æ•ˆç‡\n\n\né«˜çº§æŸ¥è¯¢ï¼šæŒæ¡åŒºé—´æŸ¥æ‰¾å’Œæ¸¸æ ‡æ“ä½œ\n\n\nVue é›†æˆï¼šä½¿ç”¨ Composition API å’Œ Pinia/Vuex ç®¡ç†æ•°æ®\n\n\næ€§èƒ½ä¼˜åŒ–ï¼šè¿æ¥æ± ã€ç¼“å­˜ã€æ‰¹å¤„ç†ç­‰ä¼˜åŒ–ç­–ç•¥\n\n\né—®é¢˜è§£å†³ï¼šå¸¸è§é—®é¢˜çš„è§£å†³æ–¹æ¡ˆå’Œæœ€ä½³å®è·µ\n\n\næœ€ä½³å®è·µå»ºè®®\n\n\nè¿æ¥ç®¡ç†ï¼šä½¿ç”¨å•ä¾‹æ¨¡å¼ç®¡ç†æ•°æ®åº“è¿æ¥ï¼Œé¿å…é¢‘ç¹æ‰“å¼€å’Œå…³é—­\n\n\né”™è¯¯å¤„ç†ï¼šå®Œå–„çš„é”™è¯¯å¤„ç†å’Œç”¨æˆ·åé¦ˆæœºåˆ¶\n\n\næ€§èƒ½ä¼˜åŒ–ï¼šåˆç†ä½¿ç”¨ç´¢å¼•ï¼Œé¿å…å…¨è¡¨æ‰«æ\n\n\næ•°æ®å®‰å…¨ï¼šæ•æ„Ÿæ•°æ®åŠ å¯†ï¼Œå®šæœŸå¤‡ä»½\n\n\nå…¼å®¹æ€§è€ƒè™‘ï¼šæä¾›é™çº§æ–¹æ¡ˆï¼Œç¡®ä¿åœ¨ä¸æ”¯æŒ IndexedDB çš„æµè§ˆå™¨ä¸­ä¹Ÿèƒ½æ­£å¸¸è¿è¡Œ\n\n\nç›‘æ§å’Œè°ƒè¯•ï¼šä½¿ç”¨æµè§ˆå™¨ DevTools è¿›è¡Œè°ƒè¯•å’Œæ€§èƒ½ç›‘æ§\n\n\né€šè¿‡æœ¬æŒ‡å—çš„å­¦ä¹ ï¼Œæ‚¨åº”è¯¥èƒ½å¤Ÿåœ¨ Vue åº”ç”¨ä¸­ç†Ÿç»ƒä½¿ç”¨ IndexedDB è¿›è¡Œæœ¬åœ°æ•°æ®å­˜å‚¨ï¼Œä¸ºç”¨æˆ·æä¾›æ›´å¥½çš„ç¦»çº¿ä½“éªŒå’Œæ•°æ®æŒä¹…åŒ–åŠŸèƒ½ã€‚\nè¿›ä¸€æ­¥å­¦ä¹ èµ„æº\n\n\nidb å®˜æ–¹æ–‡æ¡£\n\n\nMDN IndexedDB æ–‡æ¡£\n\n\nVue.js å®˜æ–¹æ–‡æ¡£\n\n\næµè§ˆå™¨å…¼å®¹æ€§è¡¨\n\n\n","categories":["ç¼–ç¨‹"],"tags":["Web"]},{"title":"Vuexå­¦ä¹ ç¬”è®°","url":"/2025/10/16/web/Vuex%20%E5%AD%A6%E4%B9%A0%E6%8C%87%E5%8D%97/","content":"\nå¦‚é¢˜ï¼Œç»“åˆå®˜æ–¹æ–‡æ¡£ä¸ç½‘ç»œå¸–å­ï¼Œåˆ©ç”¨AIæ•´ç†\n\n\nVuex å­¦ä¹ æŒ‡å—ï¼ˆç»„åˆå¼ API ç‰ˆï¼‰\nDate: October 16, 2025\nCode: https://github.com/vuejs/vuex\nç›®å½•\n\n\nä»€ä¹ˆæ˜¯ Vuex\n\n\nä¸ºä»€ä¹ˆéœ€è¦ Vuex\n\n\nVuex æ ¸å¿ƒæ¦‚å¿µ\n\n\nç»„åˆå¼ API åŸºæœ¬ä½¿ç”¨\n\n\næ¨¡å—åŒ–ç®¡ç†\n\n\nå®é™…é¡¹ç›®åº”ç”¨\n\n\næœ€ä½³å®è·µ\n\n\næ€§èƒ½ä¼˜åŒ–\n\n\nå¸¸è§é—®é¢˜\n\n\nVuex 4 æ–°ç‰¹æ€§\n\n\nä»€ä¹ˆæ˜¯ Vuex\nVuex æ˜¯ä¸€ä¸ªä¸“ä¸º Vue.js åº”ç”¨ç¨‹åºå¼€å‘çš„çŠ¶æ€ç®¡ç†æ¨¡å¼ã€‚å®ƒé‡‡ç”¨é›†ä¸­å¼å­˜å‚¨ç®¡ç†åº”ç”¨çš„æ‰€æœ‰ç»„ä»¶çš„çŠ¶æ€ï¼Œå¹¶ä»¥ç›¸åº”çš„è§„åˆ™ä¿è¯çŠ¶æ€ä»¥ä¸€ç§å¯é¢„æµ‹çš„æ–¹å¼å‘ç”Ÿå˜åŒ–ã€‚\nVuex çš„æ ¸å¿ƒæ€æƒ³\n\n\nå•ä¸€çŠ¶æ€æ ‘ï¼šæ•´ä¸ªåº”ç”¨çš„çŠ¶æ€è¢«å­˜å‚¨åœ¨ä¸€ä¸ªå•ä¸€çš„å¯¹è±¡ä¸­\n\n\nçŠ¶æ€æ˜¯åªè¯»çš„ï¼šå”¯ä¸€æ”¹å˜çŠ¶æ€çš„æ–¹æ³•æ˜¯æäº¤ mutation\n\n\nä½¿ç”¨çº¯å‡½æ•°æ¥æ‰§è¡Œä¿®æ”¹ï¼šMutation å¿…é¡»æ˜¯åŒæ­¥å‡½æ•°\n\n\nä¸ºä»€ä¹ˆéœ€è¦ Vuex\nä¼ ç»Ÿç»„ä»¶é€šä¿¡çš„é—®é¢˜\nåœ¨å¤§å‹ Vue åº”ç”¨ä¸­ï¼Œç»„ä»¶é—´é€šä¿¡ä¼šå˜å¾—éå¸¸å¤æ‚ï¼š\n&lt;!-- ä¼ ç»Ÿçš„ç»„ä»¶é€šä¿¡æ–¹å¼ --&gt;&lt;!-- çˆ¶ç»„ä»¶ --&gt;&lt;template&gt;  &lt;div&gt;    &lt;ChildA :data=&quot;data&quot; @update=&quot;handleUpdate&quot; /&gt;    &lt;ChildB :data=&quot;data&quot; @update=&quot;handleUpdate&quot; /&gt;  &lt;/div&gt;&lt;/template&gt;&lt;script setup&gt;import &#123; ref &#125; from &#x27;vue&#x27;import ChildA from &#x27;./ChildA.vue&#x27;import ChildB from &#x27;./ChildB.vue&#x27;const data = ref(&#123; count: 0 &#125;)const handleUpdate = (newData) =&gt; &#123;  data.value = newData&#125;&lt;/script&gt;//å­ç»„ä»¶this.$emit(update,&#x27;newdata&#x27;)\nVuex è§£å†³çš„é—®é¢˜\n\n\nå¤šä¸ªè§†å›¾ä¾èµ–äºåŒä¸€çŠ¶æ€\n\n\næ¥è‡ªä¸åŒè§†å›¾çš„è¡Œä¸ºéœ€è¦å˜æ›´åŒä¸€çŠ¶æ€\n\n\nå¤æ‚çš„ç»„ä»¶æ ‘ä¸­ï¼Œè·¨å±‚çº§é€šä¿¡å›°éš¾\n\n\nä»€ä¹ˆæ—¶å€™ä½¿ç”¨ Vuex\n\n\næ„å»ºä¸­å¤§å‹å•é¡µåº”ç”¨\n\n\néœ€è¦åœ¨å¤šä¸ªç»„ä»¶é—´å…±äº«çŠ¶æ€\n\n\nçŠ¶æ€é€»è¾‘å¤æ‚ï¼Œéœ€è¦ç»Ÿä¸€ç®¡ç†\n\n\néœ€è¦è¿½è¸ªçŠ¶æ€å˜æ›´å†å²\n\n\nVuex æ ¸å¿ƒæ¦‚å¿µ\n1. State\nState æ˜¯å­˜å‚¨åº”ç”¨çŠ¶æ€çš„åœ°æ–¹ï¼Œå°±åƒç»„ä»¶ä¸­çš„ dataï¼š\n// store/index.jsimport &#123; createStore &#125; from &#x27;vuex&#x27;const store = createStore(&#123;  state() &#123;    return &#123;      count: 0,      user: &#123;        name: &#x27;&#x27;,        isLogin: false      &#125;,      products: []    &#125;  &#125;&#125;)export default store\nåœ¨ç»„ä»¶ä¸­è®¿é—® Stateï¼ˆç»„åˆå¼ APIï¼‰ï¼š\n&lt;script setup&gt;import &#123; useStore &#125; from &#x27;vuex&#x27;import &#123; computed &#125; from &#x27;vue&#x27;const store = useStore()// ç›´æ¥è®¿é—®const count = computed(() =&gt; store.state.count)const user = computed(() =&gt; store.state.user)// æˆ–è€…ä½¿ç”¨ mapStateï¼ˆä»ç„¶æ”¯æŒï¼‰import &#123; mapState &#125; from &#x27;vuex&#x27;const &#123; count, user &#125; = mapState(&#123;  count: state =&gt; state.count,  user: state =&gt; state.user&#125;)&lt;/script&gt;\n2. Mutations\nMutations æ˜¯ä¿®æ”¹çŠ¶æ€çš„å”¯ä¸€æ–¹æ³•ï¼Œå¿…é¡»æ˜¯åŒæ­¥å‡½æ•°ï¼š\n// store/index.jsconst store = createStore(&#123;  state() &#123;    return &#123;      count: 0    &#125;  &#125;,  mutations: &#123;    // åŸºæœ¬ mutation    increment(state) &#123;      state.count++    &#125;,        // å¸¦å‚æ•°çš„ mutation    incrementBy(state, payload) &#123;      state.count += payload.amount    &#125;  &#125;&#125;)\næäº¤ Mutationï¼ˆç»„åˆå¼ APIï¼‰ï¼š\n&lt;script setup&gt;import &#123; useStore &#125; from &#x27;vuex&#x27;const store = useStore()// ç›´æ¥æäº¤const increment = () =&gt; &#123;  store.commit(&#x27;increment&#x27;)&#125;const incrementBy = () =&gt; &#123;  store.commit(&#x27;incrementBy&#x27;, &#123; amount: 5 &#125;)&#125;// æˆ–è€…ä½¿ç”¨ mapMutationsimport &#123; mapMutations &#125; from &#x27;vuex&#x27;const &#123; increment, incrementBy &#125; = mapMutations([  &#x27;increment&#x27;,  &#x27;incrementBy&#x27;])&lt;/script&gt;\n3. Actions\nActions ç”¨äºå¤„ç†å¼‚æ­¥æ“ä½œï¼Œå¯ä»¥åŒ…å«ä»»æ„å¼‚æ­¥ä»£ç ï¼š\n// store/index.jsconst store = createStore(&#123;  state() &#123;    return &#123;      user: null,      loading: false    &#125;  &#125;,  mutations: &#123;    setUser(state, user) &#123;      state.user = user    &#125;,    setLoading(state, status) &#123;      state.loading = status    &#125;  &#125;,  actions: &#123;    // ç™»å½•å¼‚æ­¥æ“ä½œ    async login(&#123; commit &#125;, credentials) &#123;      commit(&#x27;setLoading&#x27;, true)      try &#123;        const response = await api.login(credentials)        commit(&#x27;setUser&#x27;, response.data)        return response.data      &#125; catch (error) &#123;        throw error      &#125; finally &#123;        commit(&#x27;setLoading&#x27;, false)      &#125;    &#125;  &#125;&#125;)\nåˆ†å‘ Actionï¼ˆç»„åˆå¼ APIï¼‰ï¼š\n&lt;script setup&gt;import &#123; useStore &#125; from &#x27;vuex&#x27;const store = useStore()// ç›´æ¥åˆ†å‘const handleLogin = async () =&gt; &#123;  try &#123;    const user = await store.dispatch(&#x27;login&#x27;, &#123;       username: &#x27;admin&#x27;,       password: &#x27;123456&#x27;     &#125;)    console.log(&#x27;ç™»å½•æˆåŠŸ:&#x27;, user)  &#125; catch (error) &#123;    console.error(&#x27;ç™»å½•å¤±è´¥:&#x27;, error)  &#125;&#125;// æˆ–è€…ä½¿ç”¨ mapActionsimport &#123; mapActions &#125; from &#x27;vuex&#x27;const &#123; login &#125; = mapActions([  &#x27;login&#x27;])const handleLogin = async () =&gt; &#123;  try &#123;    await login(&#123; username: &#x27;admin&#x27;, password: &#x27;123456&#x27; &#125;)  &#125; catch (error) &#123;    console.error(error)  &#125;&#125;&lt;/script&gt;\n4. Getters\nGetters ç”¨äºä» state ä¸­æ´¾ç”Ÿå‡ºä¸€äº›çŠ¶æ€ï¼Œç±»ä¼¼äºè®¡ç®—å±æ€§ï¼š\n// store/index.jsconst store = createStore(&#123;  state() &#123;    return &#123;      todos: [        &#123; id: 1, text: &#x27;å­¦ä¹ Vuex&#x27;, done: true &#125;,        &#123; id: 2, text: &#x27;ç¼–å†™ä»£ç &#x27;, done: false &#125;      ]    &#125;  &#125;,  getters: &#123;    // åŸºç¡€ getter    doneTodos: (state) =&gt; &#123;      return state.todos.filter(todo =&gt; todo.done)    &#125;,        // å¸¦å‚æ•°çš„ getter    getTodoById: (state) =&gt; (id) =&gt; &#123;      return state.todos.find(todo =&gt; todo.id === id)    &#125;,        // åŸºäºå…¶ä»– getter çš„è®¡ç®—    doneTodosCount: (state, getters) =&gt; &#123;      return getters.doneTodos.length    &#125;  &#125;&#125;)\nä½¿ç”¨ Gettersï¼ˆç»„åˆå¼ APIï¼‰ï¼š\n&lt;script setup&gt;import &#123; useStore &#125; from &#x27;vuex&#x27;import &#123; computed &#125; from &#x27;vue&#x27;const store = useStore()// ç›´æ¥è®¿é—®const doneTodos = computed(() =&gt; store.getters.doneTodos)const todoById = (id) =&gt; store.getters.getTodoById(id)// æˆ–è€…ä½¿ç”¨ mapGettersimport &#123; mapGetters &#125; from &#x27;vuex&#x27;const &#123; doneTodos, doneTodosCount &#125; = mapGetters([  &#x27;doneTodos&#x27;,  &#x27;doneTodosCount&#x27;])&lt;/script&gt;\nç»„åˆå¼ API åŸºæœ¬ä½¿ç”¨\n1. å®‰è£… Vuex\n# Vue 3npm install vuex@4 --save\n2. åˆ›å»º Store\n// store/index.jsimport &#123; createStore &#125; from &#x27;vuex&#x27;const store = createStore(&#123;  state() &#123;    return &#123;      count: 0    &#125;  &#125;,  mutations: &#123;    increment(state) &#123;      state.count++    &#125;  &#125;,  actions: &#123;    incrementAsync(&#123; commit &#125;) &#123;      return new Promise((resolve) =&gt; &#123;        setTimeout(() =&gt; &#123;          commit(&#x27;increment&#x27;)          resolve()        &#125;, 1000)      &#125;)    &#125;  &#125;,  getters: &#123;    doubleCount: (state) =&gt; state.count * 2  &#125;&#125;)export default store\n3. åœ¨ Vue åº”ç”¨ä¸­æ³¨å…¥ Store\n// main.jsimport &#123; createApp &#125; from &#x27;vue&#x27;import App from &#x27;./App.vue&#x27;import store from &#x27;./store&#x27;const app = createApp(App)app.use(store)app.mount(&#x27;#app&#x27;)\n4. åœ¨ç»„ä»¶ä¸­ä½¿ç”¨ï¼ˆç»„åˆå¼ APIï¼‰\n&lt;template&gt;  &lt;div&gt;    &lt;p&gt;Count: &#123;&#123; count &#125;&#125;&lt;/p&gt;    &lt;p&gt;Double Count: &#123;&#123; doubleCount &#125;&#125;&lt;/p&gt;    &lt;button @click=&quot;handleIncrement&quot;&gt;Increment&lt;/button&gt;    &lt;button @click=&quot;handleIncrementAsync&quot;&gt;Increment Async&lt;/button&gt;  &lt;/div&gt;&lt;/template&gt;&lt;script setup&gt;import &#123; useStore &#125; from &#x27;vuex&#x27;import &#123; computed &#125; from &#x27;vue&#x27;const store = useStore()// è®¿é—®çŠ¶æ€const count = computed(() =&gt; store.state.count)const doubleCount = computed(() =&gt; store.getters.doubleCount)// æäº¤ mutationconst handleIncrement = () =&gt; &#123;  store.commit(&#x27;increment&#x27;)&#125;// åˆ†å‘ actionconst handleIncrementAsync = async () =&gt; &#123;  await store.dispatch(&#x27;incrementAsync&#x27;)&#125;&lt;/script&gt;\n5. ç»„åˆå¼ API çš„ä¼˜åŠ¿\n&lt;script setup&gt;import &#123; useStore &#125; from &#x27;vuex&#x27;import &#123; computed, watch &#125; from &#x27;vue&#x27;const store = useStore()// å¯ä»¥æ›´å¥½åœ°ç»„ç»‡ç›¸å…³çš„é€»è¾‘const count = computed(() =&gt; store.state.count)const doubleCount = computed(() =&gt; count.value * 2)// å¯ä»¥ä½¿ç”¨watchç›‘å¬çŠ¶æ€å˜åŒ–watch(count, (newVal, oldVal) =&gt; &#123;  console.log(`Count changed from $&#123;oldVal&#125; to $&#123;newVal&#125;`)&#125;)// å¯ä»¥å°†é€»è¾‘æŠ½å–ä¸ºç»„åˆå‡½æ•°const useCounter = () =&gt; &#123;  const count = computed(() =&gt; store.state.count)    const increment = () =&gt; &#123;    store.commit(&#x27;increment&#x27;)  &#125;    return &#123;    count,    increment  &#125;&#125;const &#123; count, increment &#125; = useCounter()&lt;/script&gt;\næ¨¡å—åŒ–ç®¡ç†\nå½“åº”ç”¨å˜å¾—å¤æ‚æ—¶ï¼Œéœ€è¦å°† Store åˆ†å‰²æˆæ¨¡å—ï¼š\n1. æ¨¡å—ç»“æ„\nstore/â”œâ”€â”€ index.js          # ç»„è£…æ¨¡å—â”œâ”€â”€ getters.js        # å…¨å±€ gettersâ””â”€â”€ modules/    â”œâ”€â”€ user.js       # ç”¨æˆ·æ¨¡å—    â”œâ”€â”€ cart.js       # è´­ç‰©è½¦æ¨¡å—    â””â”€â”€ product.js    # å•†å“æ¨¡å—\n2. åˆ›å»ºæ¨¡å—\n// store/modules/user.jsexport default &#123;  namespaced: true,  // å¯ç”¨å‘½åç©ºé—´  state() &#123;    return &#123;      token: localStorage.getItem(&#x27;token&#x27;) || &#x27;&#x27;,      userInfo: JSON.parse(localStorage.getItem(&#x27;userInfo&#x27;)) || &#123;&#125;    &#125;  &#125;,  mutations: &#123;    SET_TOKEN(state, token) &#123;      state.token = token      localStorage.setItem(&#x27;token&#x27;, token)    &#125;,    SET_USER_INFO(state, userInfo) &#123;      state.userInfo = userInfo      localStorage.setItem(&#x27;userInfo&#x27;, JSON.stringify(userInfo))    &#125;,    LOGOUT(state) &#123;      state.token = &#x27;&#x27;      state.userInfo = &#123;&#125;      localStorage.removeItem(&#x27;token&#x27;)      localStorage.removeItem(&#x27;userInfo&#x27;)    &#125;  &#125;,  actions: &#123;    async login(&#123; commit &#125;, credentials) &#123;      const response = await api.login(credentials)      commit(&#x27;SET_TOKEN&#x27;, response.token)      commit(&#x27;SET_USER_INFO&#x27;, response.userInfo)      return response    &#125;,        logout(&#123; commit &#125;) &#123;      commit(&#x27;LOGOUT&#x27;)    &#125;  &#125;,  getters: &#123;    isAuthenticated: (state) =&gt; !!state.token,    userRole: (state) =&gt; state.userInfo.role || &#x27;&#x27;  &#125;&#125;\n3. æ³¨å†Œæ¨¡å—\n// store/index.jsimport &#123; createStore &#125; from &#x27;vuex&#x27;import user from &#x27;./modules/user&#x27;import cart from &#x27;./modules/cart&#x27;import product from &#x27;./modules/product&#x27;import getters from &#x27;./getters&#x27;const store = createStore(&#123;  modules: &#123;    user,    cart,    product  &#125;,  getters&#125;)export default store\n4. ä½¿ç”¨æ¨¡å—åŒ– Storeï¼ˆç»„åˆå¼ APIï¼‰\n&lt;script setup&gt;import &#123; useStore &#125; from &#x27;vuex&#x27;import &#123; computed &#125; from &#x27;vue&#x27;const store = useStore()// è®¿é—®æ¨¡å—çŠ¶æ€const token = computed(() =&gt; store.state.user.token)const isAuthenticated = computed(() =&gt; store.getters[&#x27;user/isAuthenticated&#x27;])// æäº¤æ¨¡å— mutationconst setToken = (token) =&gt; &#123;  store.commit(&#x27;user/SET_TOKEN&#x27;, token)&#125;// åˆ†å‘æ¨¡å— actionconst handleLogin = async (credentials) =&gt; &#123;  try &#123;    await store.dispatch(&#x27;user/login&#x27;, credentials)  &#125; catch (error) &#123;    console.error(error)  &#125;&#125;// æˆ–è€…ä½¿ç”¨ createNamespacedHelpersimport &#123; createNamespacedHelpers &#125; from &#x27;vuex&#x27;const &#123; mapState, mapGetters, mapMutations, mapActions &#125; = createNamespacedHelpers(&#x27;user&#x27;)const &#123; token, userInfo &#125; = mapState([  &#x27;token&#x27;,  &#x27;userInfo&#x27;])const &#123; isAuthenticated &#125; = mapGetters([  &#x27;isAuthenticated&#x27;])const &#123; SET_TOKEN &#125; = mapMutations([  &#x27;SET_TOKEN&#x27;])const &#123; login, logout &#125; = mapActions([  &#x27;login&#x27;,  &#x27;logout&#x27;])&lt;/script&gt;\nå®é™…é¡¹ç›®åº”ç”¨\nè´­ç‰©è½¦ç¤ºä¾‹\n// store/modules/cart.jsexport default &#123;  namespaced: true,  state() &#123;    return &#123;      items: JSON.parse(localStorage.getItem(&#x27;cart&#x27;)) || [],      totalPrice: 0    &#125;  &#125;,  mutations: &#123;    ADD_TO_CART(state, product) &#123;      const existingItem = state.items.find(item =&gt; item.id === product.id)            if (existingItem) &#123;        existingItem.quantity++      &#125; else &#123;        state.items.push(&#123; ...product, quantity: 1 &#125;)      &#125;            localStorage.setItem(&#x27;cart&#x27;, JSON.stringify(state.items))      this.commit(&#x27;cart/CALCULATE_TOTAL&#x27;)    &#125;,        REMOVE_FROM_CART(state, productId) &#123;      state.items = state.items.filter(item =&gt; item.id !== productId)      localStorage.setItem(&#x27;cart&#x27;, JSON.stringify(state.items))      this.commit(&#x27;cart/CALCULATE_TOTAL&#x27;)    &#125;,        UPDATE_QUANTITY(state, &#123; productId, quantity &#125;) &#123;      const item = state.items.find(item =&gt; item.id === productId)      if (item) &#123;        item.quantity = quantity        localStorage.setItem(&#x27;cart&#x27;, JSON.stringify(state.items))        this.commit(&#x27;cart/CALCULATE_TOTAL&#x27;)      &#125;    &#125;,        CLEAR_CART(state) &#123;      state.items = []      localStorage.removeItem(&#x27;cart&#x27;)      this.commit(&#x27;cart/CALCULATE_TOTAL&#x27;)    &#125;,        CALCULATE_TOTAL(state) &#123;      state.totalPrice = state.items.reduce((total, item) =&gt; &#123;        return total + (item.price * item.quantity)      &#125;, 0)    &#125;  &#125;,  actions: &#123;    addToCart(&#123; commit &#125;, product) &#123;      commit(&#x27;ADD_TO_CART&#x27;, product)    &#125;,        removeFromCart(&#123; commit &#125;, productId) &#123;      commit(&#x27;REMOVE_FROM_CART&#x27;, productId)    &#125;,        updateQuantity(&#123; commit &#125;, payload) &#123;      commit(&#x27;UPDATE_QUANTITY&#x27;, payload)    &#125;,        clearCart(&#123; commit &#125;) &#123;      commit(&#x27;CLEAR_CART&#x27;)    &#125;  &#125;,  getters: &#123;    cartItems: (state) =&gt; state.items,    cartCount: (state) =&gt; state.items.reduce((count, item) =&gt; count + item.quantity, 0),    totalPrice: (state) =&gt; state.totalPrice,    isEmpty: (state) =&gt; state.items.length === 0  &#125;&#125;\nåœ¨ç»„ä»¶ä¸­ä½¿ç”¨è´­ç‰©è½¦ï¼ˆç»„åˆå¼ APIï¼‰\n&lt;template&gt;  &lt;div class=&quot;cart&quot;&gt;    &lt;h2&gt;è´­ç‰©è½¦&lt;/h2&gt;        &lt;div v-if=&quot;isEmpty&quot; class=&quot;empty-cart&quot;&gt;      è´­ç‰©è½¦ä¸ºç©º    &lt;/div&gt;        &lt;div v-else&gt;      &lt;div v-for=&quot;item in cartItems&quot; :key=&quot;item.id&quot; class=&quot;cart-item&quot;&gt;        &lt;span&gt;&#123;&#123; item.name &#125;&#125;&lt;/span&gt;        &lt;span&gt;Â¥&#123;&#123; item.price &#125;&#125;&lt;/span&gt;        &lt;div class=&quot;quantity-controls&quot;&gt;          &lt;button @click=&quot;updateQuantity(item.id, item.quantity - 1)&quot; :disabled=&quot;item.quantity &lt;= 1&quot;&gt;            -          &lt;/button&gt;          &lt;span&gt;&#123;&#123; item.quantity &#125;&#125;&lt;/span&gt;          &lt;button @click=&quot;updateQuantity(item.id, item.quantity + 1)&quot;&gt;            +          &lt;/button&gt;          &lt;button @click=&quot;removeFromCart(item.id)&quot; class=&quot;remove-btn&quot;&gt;            åˆ é™¤          &lt;/button&gt;        &lt;/div&gt;      &lt;/div&gt;            &lt;div class=&quot;cart-summary&quot;&gt;        &lt;p&gt;æ€»è®¡: Â¥&#123;&#123; totalPrice &#125;&#125;&lt;/p&gt;        &lt;p&gt;å•†å“æ•°é‡: &#123;&#123; cartCount &#125;&#125;&lt;/p&gt;        &lt;button @click=&quot;clearCart&quot; class=&quot;clear-btn&quot;&gt;          æ¸…ç©ºè´­ç‰©è½¦        &lt;/button&gt;      &lt;/div&gt;    &lt;/div&gt;  &lt;/div&gt;&lt;/template&gt;&lt;script setup&gt;import &#123; useStore &#125; from &#x27;vuex&#x27;import &#123; computed &#125; from &#x27;vue&#x27;const store = useStore()// è·å–è´­ç‰©è½¦çŠ¶æ€const cartItems = computed(() =&gt; store.getters[&#x27;cart/cartItems&#x27;])const cartCount = computed(() =&gt; store.getters[&#x27;cart/cartCount&#x27;])const totalPrice = computed(() =&gt; store.getters[&#x27;cart/totalPrice&#x27;])const isEmpty = computed(() =&gt; store.getters[&#x27;cart/isEmpty&#x27;])// è´­ç‰©è½¦æ“ä½œconst addToCart = (product) =&gt; &#123;  store.dispatch(&#x27;cart/addToCart&#x27;, product)&#125;const removeFromCart = (productId) =&gt; &#123;  store.dispatch(&#x27;cart/removeFromCart&#x27;, productId)&#125;const updateQuantity = (productId, quantity) =&gt; &#123;  if (quantity &lt;= 0) &#123;    removeFromCart(productId)    return  &#125;    store.dispatch(&#x27;cart/updateQuantity&#x27;, &#123;    productId,    quantity  &#125;)&#125;const clearCart = () =&gt; &#123;  store.dispatch(&#x27;cart/clearCart&#x27;)&#125;&lt;/script&gt;\nç”¨æˆ·è®¤è¯ç¤ºä¾‹\n// store/modules/auth.jsexport default &#123;  namespaced: true,  state() &#123;    return &#123;      token: localStorage.getItem(&#x27;token&#x27;) || &#x27;&#x27;,      user: JSON.parse(localStorage.getItem(&#x27;user&#x27;)) || null,      loading: false,      error: null    &#125;  &#125;,  mutations: &#123;    SET_TOKEN(state, token) &#123;      state.token = token      localStorage.setItem(&#x27;token&#x27;, token)    &#125;,        SET_USER(state, user) &#123;      state.user = user      localStorage.setItem(&#x27;user&#x27;, JSON.stringify(user))    &#125;,        SET_LOADING(state, loading) &#123;      state.loading = loading    &#125;,        SET_ERROR(state, error) &#123;      state.error = error    &#125;,        CLEAR_AUTH(state) &#123;      state.token = &#x27;&#x27;      state.user = null      localStorage.removeItem(&#x27;token&#x27;)      localStorage.removeItem(&#x27;user&#x27;)    &#125;  &#125;,  actions: &#123;    async login(&#123; commit &#125;, &#123; email, password &#125;) &#123;      try &#123;        commit(&#x27;SET_LOADING&#x27;, true)        commit(&#x27;SET_ERROR&#x27;, null)                const response = await fetch(&#x27;/api/auth/login&#x27;, &#123;          method: &#x27;POST&#x27;,          headers: &#123; &#x27;Content-Type&#x27;: &#x27;application/json&#x27; &#125;,          body: JSON.stringify(&#123; email, password &#125;)        &#125;)                const data = await response.json()                if (!response.ok) &#123;          throw new Error(data.message || &#x27;Login failed&#x27;)        &#125;                commit(&#x27;SET_TOKEN&#x27;, data.token)        commit(&#x27;SET_USER&#x27;, data.user)                return data.user      &#125; catch (error) &#123;        commit(&#x27;SET_ERROR&#x27;, error.message)        throw error      &#125; finally &#123;        commit(&#x27;SET_LOADING&#x27;, false)      &#125;    &#125;,        async logout(&#123; commit, state &#125;) &#123;      try &#123;        commit(&#x27;SET_LOADING&#x27;, true)                await fetch(&#x27;/api/auth/logout&#x27;, &#123;          method: &#x27;POST&#x27;,          headers: &#123;            &#x27;Authorization&#x27;: `Bearer $&#123;state.token&#125;`          &#125;        &#125;)      &#125; finally &#123;        commit(&#x27;CLEAR_AUTH&#x27;)        commit(&#x27;SET_LOADING&#x27;, false)      &#125;    &#125;,        async checkAuth(&#123; commit, state &#125;) &#123;      if (!state.token) return false            try &#123;        commit(&#x27;SET_LOADING&#x27;, true)                const response = await fetch(&#x27;/api/auth/me&#x27;, &#123;          headers: &#123;            &#x27;Authorization&#x27;: `Bearer $&#123;state.token&#125;`          &#125;        &#125;)                if (!response.ok) &#123;          commit(&#x27;CLEAR_AUTH&#x27;)          return false        &#125;                const user = await response.json()        commit(&#x27;SET_USER&#x27;, user)        return true      &#125; catch (error) &#123;        commit(&#x27;CLEAR_AUTH&#x27;)        return false      &#125; finally &#123;        commit(&#x27;SET_LOADING&#x27;, false)      &#125;    &#125;  &#125;,  getters: &#123;    isAuthenticated: (state) =&gt; !!state.token,    currentUser: (state) =&gt; state.user,    isLoading: (state) =&gt; state.loading,    authError: (state) =&gt; state.error,    userRole: (state) =&gt; state.user?.role || &#x27;user&#x27;  &#125;&#125;\næœ€ä½³å®è·µ\n1. ä½¿ç”¨ç»„åˆå‡½æ•°å°è£…é€»è¾‘\n// composables/useAuth.jsimport &#123; useStore &#125; from &#x27;vuex&#x27;import &#123; computed &#125; from &#x27;vue&#x27;export function useAuth() &#123;  const store = useStore()    // çŠ¶æ€  const isAuthenticated = computed(() =&gt; store.getters[&#x27;auth/isAuthenticated&#x27;])  const currentUser = computed(() =&gt; store.getters[&#x27;auth/currentUser&#x27;])  const isLoading = computed(() =&gt; store.getters[&#x27;auth/isLoading&#x27;])  const authError = computed(() =&gt; store.getters[&#x27;auth/authError&#x27;])    // æ–¹æ³•  const login = async (credentials) =&gt; &#123;    return store.dispatch(&#x27;auth/login&#x27;, credentials)  &#125;    const logout = async () =&gt; &#123;    return store.dispatch(&#x27;auth/logout&#x27;)  &#125;    const checkAuth = async () =&gt; &#123;    return store.dispatch(&#x27;auth/checkAuth&#x27;)  &#125;    return &#123;    // çŠ¶æ€    isAuthenticated,    currentUser,    isLoading,    authError,        // æ–¹æ³•    login,    logout,    checkAuth  &#125;&#125;\n2. åœ¨ç»„ä»¶ä¸­ä½¿ç”¨ç»„åˆå‡½æ•°\n&lt;script setup&gt;import &#123; useAuth &#125; from &#x27;@/composables/useAuth&#x27;import &#123; onMounted &#125; from &#x27;vue&#x27;const &#123;  isAuthenticated,  currentUser,  isLoading,  authError,  login,  checkAuth&#125; = useAuth()// ç»„ä»¶æŒ‚è½½æ—¶æ£€æŸ¥è®¤è¯çŠ¶æ€onMounted(async () =&gt; &#123;  await checkAuth()&#125;)const handleLogin = async (email, password) =&gt; &#123;  try &#123;    await login(&#123; email, password &#125;)    // ç™»å½•æˆåŠŸåçš„å¤„ç†  &#125; catch (error) &#123;    console.error(&#x27;Login failed:&#x27;, error)  &#125;&#125;&lt;/script&gt;\n3. çŠ¶æ€æŒä¹…åŒ–\n// store/index.jsimport &#123; createStore &#125; from &#x27;vuex&#x27;import createPersistedState from &#x27;vuex-persistedstate&#x27;const store = createStore(&#123;  plugins: [    createPersistedState(&#123;      paths: [&#x27;auth.token&#x27;, &#x27;auth.user&#x27;, &#x27;cart.items&#x27;]    &#125;)  ]&#125;)\n4. ä¸¥æ ¼æ¨¡å¼\nconst store = createStore(&#123;  strict: process.env.NODE_ENV !== &#x27;production&#x27;&#125;)\n5. æ¨¡å—åŒ–æœ€ä½³å®è·µ\n// 1. æ¯ä¸ªæ¨¡å—ç‹¬ç«‹æ–‡ä»¶// 2. å¯ç”¨å‘½åç©ºé—´// 3. æŒ‰ä¸šåŠ¡åŠŸèƒ½åˆ’åˆ†æ¨¡å—// 4. æ¨¡å—å†…éƒ¨çŠ¶æ€ç§æœ‰// 5. ä½¿ç”¨ç»„åˆå‡½æ•°å°è£…æ¨¡å—é€»è¾‘\n6. å¼‚æ­¥æ“ä½œè§„èŒƒ\n// store/modules/example.jsactions: &#123;  async fetchData(&#123; commit &#125;, params) &#123;    try &#123;      commit(&#x27;SET_LOADING&#x27;, true)      commit(&#x27;SET_ERROR&#x27;, null)            const data = await api.fetchData(params)      commit(&#x27;SET_DATA&#x27;, data)            return data    &#125; catch (error) &#123;      commit(&#x27;SET_ERROR&#x27;, error.message)      throw error    &#125; finally &#123;      commit(&#x27;SET_LOADING&#x27;, false)    &#125;  &#125;&#125;\næ€§èƒ½ä¼˜åŒ–\n1. ä½¿ç”¨è®¡ç®—å±æ€§ç¼“å­˜\n&lt;script setup&gt;import &#123; useStore &#125; from &#x27;vuex&#x27;import &#123; computed &#125; from &#x27;vue&#x27;const store = useStore()// âœ… æ­£ç¡®ï¼šä½¿ç”¨è®¡ç®—å±æ€§ç¼“å­˜const filteredItems = computed(() =&gt; &#123;  return store.state.items.filter(item =&gt; item.active)&#125;)// âŒ é”™è¯¯ï¼šæ¯æ¬¡è®¿é—®éƒ½ä¼šé‡æ–°è®¡ç®—const getFilteredItems = () =&gt; &#123;  return store.state.items.filter(item =&gt; item.active)&#125;&lt;/script&gt;\n2. é¿å…ä¸å¿…è¦çš„çŠ¶æ€æ›´æ–°\n// store/mutations.jsmutations: &#123;  SET_USER(state, user) &#123;    // åªæœ‰å½“ç”¨æˆ·ä¿¡æ¯çœŸæ­£æ”¹å˜æ—¶æ‰æ›´æ–°    if (JSON.stringify(state.user) !== JSON.stringify(user)) &#123;      state.user = user    &#125;  &#125;&#125;\n3. ä½¿ç”¨ shallowRef ä¼˜åŒ–å¤§å¯¹è±¡\n&lt;script setup&gt;import &#123; useStore &#125; from &#x27;vuex&#x27;import &#123; shallowRef, watch &#125; from &#x27;vue&#x27;const store = useStore()// å¯¹äºå¤§å¯¹è±¡ï¼Œä½¿ç”¨ shallowRef é¿å…æ·±å±‚å“åº”å¼è½¬æ¢const largeData = shallowRef(store.state.largeData)// ç›‘å¬çŠ¶æ€å˜åŒ–å¹¶æ‰‹åŠ¨æ›´æ–°watch(  () =&gt; store.state.largeData,  (newData) =&gt; &#123;    largeData.value = newData  &#125;,  &#123; deep: true &#125;)&lt;/script&gt;\n4. æ¨¡å—æ‡’åŠ è½½\n// åŠ¨æ€æ³¨å†Œæ¨¡å—const registerModule = async () =&gt; &#123;  const module = await import(&#x27;./store/modules/lazyModule&#x27;)  store.registerModule(&#x27;lazy&#x27;, module.default)&#125;// åœ¨è·¯ç”±æ‡’åŠ è½½ä¸­ä½¿ç”¨const routes = [  &#123;    path: &#x27;/lazy&#x27;,    component: () =&gt; &#123;      registerModule()      return import(&#x27;./views/LazyView.vue&#x27;)    &#125;  &#125;]\n5. ä½¿ç”¨ createSelector ä¼˜åŒ– getter\n// store/getters.jsimport &#123; createSelector &#125; from &#x27;vuex&#x27;const selectItems = state =&gt; state.itemsconst selectFilter = state =&gt; state.filter// ä½¿ç”¨ createSelector åˆ›å»ºè®°å¿†åŒ–çš„ selectorexport const selectFilteredItems = createSelector(  [selectItems, selectFilter],  (items, filter) =&gt; &#123;    return items.filter(item =&gt; item.name.includes(filter))  &#125;)\nå¸¸è§é—®é¢˜\n1. å¦‚ä½•åœ¨ç»„åˆå¼ API ä¸­ä½¿ç”¨ map è¾…åŠ©å‡½æ•°\n&lt;script setup&gt;import &#123; mapState, mapGetters, mapMutations, mapActions &#125; from &#x27;vuex&#x27;import &#123; toRefs &#125; from &#x27;vue&#x27;// ä½¿ç”¨ toRefs å°†å¯¹è±¡è½¬æ¢ä¸ºå“åº”å¼å¼•ç”¨const &#123; count &#125; = toRefs(mapState(&#123;  count: state =&gt; state.count&#125;))const &#123; doubleCount &#125; = toRefs(mapGetters([  &#x27;doubleCount&#x27;]))const &#123; increment &#125; = mapMutations([  &#x27;increment&#x27;])const &#123; fetchData &#125; = mapActions([  &#x27;fetchData&#x27;])&lt;/script&gt;\n2. å¦‚ä½•å¤„ç† v-model å’Œ Vuex çš„å†²çª\n&lt;template&gt;  &lt;!-- ä½¿ç”¨è®¡ç®—å±æ€§çš„ get å’Œ set --&gt;  &lt;input v-model=&quot;userName&quot;&gt;&lt;/template&gt;&lt;script setup&gt;import &#123; useStore &#125; from &#x27;vuex&#x27;import &#123; computed &#125; from &#x27;vue&#x27;const store = useStore()const userName = computed(&#123;  get() &#123;    return store.state.user.name  &#125;,  set(value) &#123;    store.commit(&#x27;updateUserName&#x27;, value)  &#125;&#125;)&lt;/script&gt;\n3. å¦‚ä½•åœ¨ç»„åˆå¼ API ä¸­ç›‘å¬çŠ¶æ€å˜åŒ–\n&lt;script setup&gt;import &#123; useStore &#125; from &#x27;vuex&#x27;import &#123; watch, computed &#125; from &#x27;vue&#x27;const store = useStore()const count = computed(() =&gt; store.state.count)// ç›‘å¬çŠ¶æ€å˜åŒ–watch(count, (newVal, oldVal) =&gt; &#123;  console.log(`Count changed from $&#123;oldVal&#125; to $&#123;newVal&#125;`)&#125;)// ç›‘å¬æ·±å±‚å¯¹è±¡å˜åŒ–watch(  () =&gt; store.state.user,  (newUser, oldUser) =&gt; &#123;    console.log(&#x27;User changed&#x27;)  &#125;,  &#123; deep: true &#125;)&lt;/script&gt;\n4. å¦‚ä½•åœ¨æ¨¡å—é—´é€šä¿¡\n// store/modules/moduleA.jsactions: &#123;  async moduleAAction(&#123; dispatch, commit, rootGetters &#125;) &#123;    // è°ƒç”¨å…¶ä»–æ¨¡å—çš„ action    await dispatch(&#x27;moduleB/moduleBAction&#x27;, payload, &#123; root: true &#125;)        // æäº¤å…¶ä»–æ¨¡å—çš„ mutation    commit(&#x27;moduleB/moduleBMutation&#x27;, payload, &#123; root: true &#125;)        // è®¿é—®å…¶ä»–æ¨¡å—çš„ getter    const data = rootGetters[&#x27;moduleB/moduleBGetter&#x27;]  &#125;&#125;\n5. å¦‚ä½•å¤„ç†å¼‚æ­¥æ•°æ®åŠ è½½çŠ¶æ€\n&lt;script setup&gt;import &#123; useStore &#125; from &#x27;vuex&#x27;import &#123; computed &#125; from &#x27;vue&#x27;const store = useStore()const data = computed(() =&gt; store.state.data)const loading = computed(() =&gt; store.state.loading)const error = computed(() =&gt; store.state.error)const fetchData = async () =&gt; &#123;  try &#123;    await store.dispatch(&#x27;fetchData&#x27;)  &#125; catch (error) &#123;    console.error(error)  &#125;&#125;&lt;/script&gt;&lt;template&gt;  &lt;div&gt;    &lt;div v-if=&quot;loading&quot;&gt;åŠ è½½ä¸­...&lt;/div&gt;    &lt;div v-else-if=&quot;error&quot;&gt;&#123;&#123; error &#125;&#125;&lt;/div&gt;    &lt;div v-else&gt;      &lt;!-- æ˜¾ç¤ºæ•°æ® --&gt;    &lt;/div&gt;  &lt;/div&gt;&lt;/template&gt;\nVuex 4 æ–°ç‰¹æ€§\n1. ä¸ Vue 3 çš„å…¼å®¹æ€§\n// Vue 3 ä¸­åˆ›å»º Storeimport &#123; createStore &#125; from &#x27;vuex&#x27;const store = createStore(&#123;  state() &#123;    return &#123;      count: 0    &#125;  &#125;&#125;)\n2. Composition API æ”¯æŒ\n&lt;script setup&gt;import &#123; useStore &#125; from &#x27;vuex&#x27;import &#123; computed &#125; from &#x27;vue&#x27;const store = useStore()const count = computed(() =&gt; store.state.count)const increment = () =&gt; store.commit(&#x27;increment&#x27;)&lt;/script&gt;\n3. æ–°çš„æ’ä»¶ç³»ç»Ÿ\n// åˆ›å»ºæ’ä»¶const loggerPlugin = (store) =&gt; &#123;  store.subscribe((mutation, state) =&gt; &#123;    console.log(`[$&#123;mutation.type&#125;]:`, mutation.payload)  &#125;)&#125;// ä½¿ç”¨æ’ä»¶const store = createStore(&#123;  plugins: [loggerPlugin]&#125;)\n4. æ”¹è¿›çš„ TypeScript æ”¯æŒ\n// TypeScript æ”¯æŒinterface State &#123;  count: number  user: User | null&#125;interface User &#123;  id: number  name: string&#125;const store = createStore&lt;State&gt;(&#123;  state: &#123;    count: 0,    user: null  &#125;,  mutations: &#123;    setUser(state, user: User) &#123;      state.user = user    &#125;  &#125;&#125;)\n5. æ›´å¥½çš„ DevTools é›†æˆ\n// è‡ªå®šä¹‰ devtools é…ç½®const store = createStore(&#123;  devtools: &#123;    enabled: process.env.NODE_ENV !== &#x27;production&#x27;,    features: &#123;      timeTravel: true,      persistState: true    &#125;  &#125;&#125;)\nå…³é”®è¦ç‚¹ï¼šç»„åˆå¼ API é›†æˆï¼šä½¿ç”¨ useStore() åœ¨ç»„åˆå¼ API ä¸­è®¿é—® Store\n\n\nç»„åˆå‡½æ•°å°è£…ï¼šå°†ç›¸å…³çš„çŠ¶æ€å’Œé€»è¾‘å°è£…ä¸ºå¯å¤ç”¨çš„ç»„åˆå‡½æ•°\n\n\næ¨¡å—åŒ–è®¾è®¡ï¼šæŒ‰ä¸šåŠ¡åŠŸèƒ½åˆ’åˆ†æ¨¡å—ï¼Œå¯ç”¨å‘½åç©ºé—´\n\n\nç±»å‹å®‰å…¨ï¼šVuex 4 æä¾›äº†æ›´å¥½çš„ TypeScript æ”¯æŒ\n\n\næ€§èƒ½ä¼˜åŒ–ï¼šåˆ©ç”¨è®¡ç®—å±æ€§ç¼“å­˜ã€shallowRef ç­‰ç‰¹æ€§ä¼˜åŒ–æ€§èƒ½\n\n\nä½•æ—¶ä½¿ç”¨ Vuexï¼š\n\n\næ„å»ºä¸­å¤§å‹å•é¡µåº”ç”¨\n\n\néœ€è¦åœ¨å¤šä¸ªç»„ä»¶é—´å…±äº«çŠ¶æ€\n\n\nçŠ¶æ€é€»è¾‘å¤æ‚ï¼Œéœ€è¦ç»Ÿä¸€ç®¡ç†\n\n\néœ€è¦è¿½è¸ªçŠ¶æ€å˜æ›´å†å²\n\n\né€šè¿‡åˆç†ä½¿ç”¨ Vuex å’Œç»„åˆå¼ APIï¼Œå¯ä»¥æ˜¾è‘—æé«˜ Vue 3 åº”ç”¨çš„å¯ç»´æŠ¤æ€§å’Œå¯æ‰©å±•æ€§ï¼Œè®©çŠ¶æ€ç®¡ç†å˜å¾—æ›´åŠ æ¸…æ™°å’Œå¯æ§ã€‚\nå‚è€ƒèµ„æºï¼š\n\n\nVuex å®˜æ–¹æ–‡æ¡£\n\n\nVue 3 ç»„åˆå¼ API æ–‡æ¡£\n\n\nVue Devtools\n\n\n","categories":["ç¼–ç¨‹"],"tags":["Web"]},{"title":"Webå‰ç«¯åŸºç¡€","url":"/2024/04/05/web/Web%E5%89%8D%E7%AB%AF%E5%9F%BA%E7%A1%80/","content":"\nWeb å‰ç«¯çš„ä¸€äº›åŸºç¡€çŸ¥è¯†å’Œç›¸å…³å·¥å…·çš„ä½¿ç”¨\n\n\nJava Web\næ–‡æ¡£æŸ¥è¯¢ç½‘ç«™:https://www.w3school.com.cn/index.html\nWebå‰ç«¯\nç½‘é¡µ\n\n\næœ¬è´¨æ˜¯å‰ç«¯ä»£ç ç»è¿‡æµè§ˆå™¨çš„è§£æå’Œæ¸²æŸ“è€Œæˆçš„\n\n\næµè§ˆå™¨å†…æ ¸è¿›è¡Œä»£ç çš„è§£æå’Œæ¸²æŸ“\n\n\nwebæ ‡å‡†\n\n\nHTMLï¼šè´Ÿè´£ç½‘é¡µçš„ç»“æ„ï¼ˆé¡µé¢å…ƒç´ å’Œå†…å®¹ï¼‰\n\n\nCSSï¼šè´Ÿè´£ç½‘é¡µçš„è¡¨ç°ï¼ˆé¡µé¢å…ƒç´ çš„å¤–è§‚ï¼Œä½ç½®ï¼Œé¢œè‰²ï¼Œå¤§å°ç­‰ï¼‰\n\n\nJavaScriptï¼šè´Ÿè´£ç½‘é¡µçš„è¡Œä¸ºï¼ˆäº¤äº’æ•ˆæœï¼‰\n\n\né«˜çº§æŠ€æœ¯\n\nVue.js\nElementUI\nAjax\nAxios\nâ€¦\n\n\n\nHTMLï¼ˆHyperText Markup Languageï¼‰\n\n\nè¶…æ–‡æœ¬æ ‡è®°è¯­è¨€ï¼ˆè¶…è¶Šæ™®é€šæ–‡æœ¬è¯­è¨€ï¼Œç”±æ ‡ç­¾æ„æˆçš„è¯­è¨€ï¼‰\n\n\næ ‡ç­¾æ˜¯é¢„å®šå¥½çš„ï¼Œ\n\n\nHTMLä»£ç ç›´æ¥åœ¨æµè§ˆå™¨ä¸­è¿è¡Œï¼ŒHTMLæ ‡ç­¾ç”±æµè§ˆå™¨è§£æ\n\n\nç‰¹ç‚¹\n\n\nä¸åŒºåˆ†å¤§å°å†™\n\n\nå±æ€§å¯ä»¥ä½¿ç”¨å•å¼•å·æˆ–è€…åŒå¼•å·\n\n\nè¯­æ³•æ¾æ•£\n\n\nå¸¸ç”¨æ ‡ç­¾\n\n\n&lt;img&gt;\n\nsrc:æŒ‡å®šå›¾åƒçš„urlï¼ˆç›¸å¯¹æˆ–ç»å¯¹ï¼‰\nwidth\nheight\n\n\n\næ ‡é¢˜æ ‡ç­¾:&lt;h1&gt; - &lt;h6&gt;\n\n\næ°´å¹³çº¿æ ‡ç­¾:&lt;hr&gt;\n\n\nè¶…é“¾æ¥&lt;a&gt;\n\nhrefæŒ‡å®šè®¿é—®èµ„æºçš„url\ntargetæŒ‡å®šåœ¨ä½•å¤„æ‰“å¼€èµ„æº(_self,_blank)\n\n\n\n&lt;video&gt;è§†é¢‘\n\ncontrolsæ˜¾ç¤ºæ’­æ”¾æ§ä»¶\nsrc\nwidth\n\n\n\n&lt;audio&gt;éŸ³é¢‘\n\ncontrols\nsrc\nwidth\n\n\n\n&lt;b&gt;/&lt;strong&gt;åŠ ç²—\n\n\n&lt;p&gt;åˆ†æ®µè½\n\n\nè¡¨æ ¼æ ‡ç­¾\n\n\n&lt;table&gt;å®šä¹‰è¡¨æ ¼æ•´ä½“\n\nborder:è§„å®šè¾¹æ¡†å®½åº¦\nwidth:è§„å®šè¡¨æ ¼çš„å®½åº¦\ncellspacing:è§„å®šå•å…ƒæ ¼ä¹‹é—´çš„ç©ºéš™å¤§å°\n\n\n\n&lt;tr&gt;:è¡¨æ ¼çš„è¡Œ\n\n\n&lt;td&gt;:è¡¨æ ¼å•å…ƒæ ¼ï¼Œï¼ˆè¡¨å¤´ä½¿ç”¨&lt;th&gt;ï¼‰\n\n\n\n\n&lt;table border=&quot;1px&quot; cellspacing=&quot;0&quot; width=&quot;600px&quot;&gt;   &lt;tr&gt;      &lt;th&gt;è§’è‰²åç§°&lt;/th&gt;       &lt;th&gt;å›¾ç‰‡&lt;/th&gt;      &lt;th&gt;å…ƒç´ &lt;/th&gt;      &lt;th&gt;å›½åº¦&lt;/th&gt;   &lt;/tr&gt;     &lt;tr&gt;      &lt;td&gt;é‚£ç»´è±ç‰¹&lt;/td&gt;      &lt;td&gt;&lt;img src=&quot;https://picx.zhimg.com/70/v2-5623d0ee6d0a7f7a63ffce7830fdbc7a_1440w.avis?source=172ae18b&amp;biz_tag=Post&quot; width=&quot;100px&quot;&gt;&lt;/td&gt;      &lt;td&gt;æ°´&lt;/td&gt;      &lt;td&gt;æ«ä¸¹&lt;/td&gt;   &lt;/tr&gt;       &lt;tr&gt;      &lt;td&gt;æçº³é‡Œ&lt;/td&gt;      &lt;td&gt;&lt;img src=&quot;https://patchwiki.biligame.com/images/ys/2/2b/hcwuh3cbgc5dyfcx4qlqp95qlzbp619.png&quot; width=&quot;100px&quot;&gt;&lt;/td&gt;      &lt;td&gt;è‰&lt;/td&gt;      &lt;td&gt;é¡»å¼¥&lt;/td&gt;   &lt;/tr&gt;  &lt;/table&gt;\n\n\nè¡¨å•æ ‡ç­¾\n\nè´Ÿè´£é‡‡é›†æ•°æ®ï¼Œå¦‚ç™»å½•ï¼Œæ³¨å†Œç­‰ä¿¡æ¯\n&lt;form&gt;\n\n\n&lt;input&gt;:å®šä¹‰è¡¨å•é¡¹ï¼Œé€šè¿‡typeå±æ€§æ§åˆ¶è¾“å…¥å½¢å¼\n\n\n\n\n\n&lt;select&gt;:å®šä¹‰ä¸‹æ‹‰åˆ—è¡¨\n\n&lt;option&gt;å®šä¹‰åˆ—è¡¨é¡¹\n\n\n\n&lt;textarea&gt;:å®šä¹‰æ–‡æœ¬åŸŸ\n\n\n\n\n\n\n&lt;form action=&quot;&quot; method=&quot;post&quot;&gt;    å§“å:&lt;input type=&quot;text&quot; name=&quot;name&quot;&gt; &lt;br&gt;&lt;br&gt;    å¯†ç :&lt;input type=&quot;password&quot; name=&quot;password&quot;&gt; &lt;br&gt;&lt;br&gt;    æ€§åˆ«:&lt;label&gt;&lt;input type=&quot;radio&quot; name=&quot;gender&quot; value=&quot;1&quot;&gt;ç”·&lt;/label&gt;    \t&lt;label&gt;&lt;input type=&quot;radio&quot; name=&quot;gender&quot; value=&quot;2&quot;&gt;å¥³&lt;/label&gt;&lt;br&gt;&lt;br&gt;    çˆ±å¥½:&lt;label&gt;&lt;input type=&quot;checkbox&quot; name=&quot;hobby&quot; value=&quot;java&quot;&gt;java&lt;/label&gt;        &lt;label&gt;&lt;input type=&quot;checkbox&quot; name=&quot;hobby&quot; value=&quot;genshin&quot;&gt;genshin&lt;/label&gt;        &lt;label&gt;&lt;input type=&quot;checkbox&quot; name=&quot;hobby&quot; value=&quot;sleep&quot;&gt;sleep&lt;/label&gt; &lt;br&gt;&lt;br&gt;    å›¾åƒ:&lt;input type=&quot;file&quot; name=&quot;image&quot;&gt; &lt;br&gt;&lt;br&gt;    ç”Ÿæ—¥:&lt;input type=&quot;date&quot; name=&quot;birthday&quot;&gt; &lt;br&gt;&lt;br&gt;    æ—¶é—´:&lt;input type=&quot;time&quot; name=&quot;time&quot;&gt; &lt;br&gt;&lt;br&gt;    æ—¥æœŸæ—¶é—´:&lt;input type=&quot;datetime-local&quot; name=&quot;datetime&quot;&gt; &lt;br&gt;&lt;br&gt;    é‚®ç®±:&lt;input type=&quot;email&quot; name=&quot;email&quot;&gt; &lt;br&gt;&lt;br&gt;    å¹´é¾„:&lt;input type=&quot;number&quot; name=&quot;age&quot;&gt; &lt;br&gt;&lt;br&gt;    å­¦å†:&lt;select name=&quot;degree&quot;&gt;    \t\t &lt;option value=&quot;&quot;&gt;-----------è¯·é€‰æ‹©---------&lt;/option&gt;   \t\t\t &lt;option value=&quot;1&quot;&gt;å¤§ä¸“&lt;/option&gt;   \t\t\t &lt;option value=&quot;2&quot;&gt;æœ¬ç§‘&lt;/option&gt;   \t\t\t &lt;option value=&quot;3&quot;&gt;ç¡•å£«&lt;/option&gt;   \t\t\t &lt;option value=&quot;4&quot;&gt;åšå£«&lt;/option&gt;    \t&lt;/select&gt; &lt;br&gt;&lt;br&gt;    æè¿°:&lt;textarea name=&quot;description&quot; cols=&quot;30&quot; rows=&quot;10&quot;&gt;&lt;/textarea&gt;    &lt;input type=&quot;hidden&quot; name=&quot;id&quot; value=&quot;1&quot;&gt;        &lt;!-- è¡¨å•å¸¸è§æŒ‰é’® --&gt;    &lt;input type=&quot;button&quot; value=&quot;æŒ‰é’®&quot;&gt;    &lt;input type=&quot;reset&quot;  value=&quot;é‡ç½®&quot;&gt;    &lt;input type=&quot;submit&quot; value=&quot;æäº¤&quot;&gt;&lt;/form&gt;\n\n\nå±æ€§\n\naction:è§„å®šæäº¤è¡¨å•æ—¶å‘ä½•å¤„å‘é€è¡¨å•æ•°æ®ï¼ŒURL(å¦‚æœä¸æŒ‡å®šé»˜è®¤æäº¤åˆ°å½“å‰é¡µé¢)\nmethod:è§„å®šç”¨äºå‘é€è¡¨å•æ•°æ®çš„æ–¹å¼ã€‚GETï¼ŒPOST\n\ngetåœ¨urlåé¢æ‹¼æ¥è¡¨å•æ•°æ®\npoståœ¨æ¶ˆæ¯ä½“ï¼ˆè¯·æ±‚ä½“ï¼‰ä¸­ä¼ é€’ï¼Œå‚æ•°é•¿åº¦æ— é™åˆ¶\n\n\n\n\n\n\n\n\nCSSï¼ˆCascading Style Sheetï¼‰\n\n\nå±‚å æ ·å¼è¡¨ï¼Œæ§åˆ¶ç½‘é¡µçš„è¡¨ç°\n\n\nCSSé€‰æ‹©å™¨\n\n\nå…ƒç´ é€‰æ‹©å™¨h1&#123;&#125;\n\n\nidé€‰æ‹©å™¨#hid&#123;&#125;(åœ¨styleä¸­)     &lt;h1 id=&quot;hid&quot;&gt;ä¸èƒ½é‡å¤\n\n\nç±»é€‰æ‹©å™¨.cls&#123;&#125;(åœ¨styleä¸­)      &lt;h1 class=&quot;cls&quot;&gt;\n\n\nå¸¸ç”¨æ ‡ç­¾\n\n\n&lt;span&gt;æ— è¯­ä¹‰çš„å¸ƒå±€æ ‡ç­¾ï¼Œä¸€è¡Œå¯æ˜¾ç¤ºå¤šä¸ª\n\n\n&lt;div&gt;\n\n\nå±æ€§\n\n\ncolor\n\n\nfont-sizeï¼šå­—ä½“å¤§å°ï¼ˆåŠ pxï¼‰\n\n\ntext-decoration:è§„å®šæ–‡æœ¬çš„ä¿®é¥°ï¼Œnoneè¡¨ç¤ºå®šä¹‰æ ‡å‡†çš„æ–‡æœ¬\n\n\ntext-alignï¼šæ§åˆ¶å¯¹é½æ–¹å¼\n\n\ntext-indent:é¦–è¡Œç¼©è¿›\n\n\nline-heightï¼šè¡Œé«˜\n\n\nç©ºæ ¼å ä½ç¬¦ï¼š&amp;nbsp\n\n\nç›’å­æ¨¡å‹\n\n\n&lt;div&gt;æ— è¯­ä¹‰çš„å¸ƒå±€æ ‡ç­¾ï¼Œä¸€è¡Œåªå ä¸€ä¸ª\n\n\nç»„æˆï¼šå†…å®¹åŒºåŸŸ(content)ï¼Œå†…è¾¹è·åŒºåŸŸ(padding)ï¼Œè¾¹æ¡†åŒºåŸŸ(border)ï¼Œå¤–è¾¹è·åŒºåŸŸ(margin)\n\n\n\n&lt;style&gt;    h1&#123;       color:rgb(102, 97, 97);     &#125;   //ç±»é€‰æ‹©å™¨    .time&#123;      color:rgb(241, 3, 3);    &#125;    //æ ‡ç­¾é€‰æ‹©å™¨    a&#123;        color:black;        text-decoration: none;    &#125;    //idé€‰æ‹©å™¨   #wangmc&#123;        text-align: right;        font-size: 28px;        color:chocolate;    &#125;        /*&lt;div id=&quot;center&quot;&gt;*/   #center&#123;        width:80%;        box-sizing: border-box;/*æŒ‡å®šwidthä¸ºç›’å­å®½åº¦*/        background-color: rgb(219, 235, 235);        padding: 20px; /*å†…è¾¹è· ä¸Šå³ä¸‹å·¦*/        border: 1px solid red;/*è¾¹æ¡†å®½åº¦ çº¿æ¡ç±»å‹ é¢œè‰²*/        margin:auto;/*å¤–è¾¹è· */    &#125;&lt;/style&gt;\nJavaScriptï¼ˆç®€ç§°ï¼šjsï¼‰\n\n\nè·¨å¹³å°ï¼Œé¢å‘å¯¹è±¡çš„è„šæœ¬è¯­è¨€ï¼Œä½¿ç½‘é¡µå¯ä»¥äº¤äº’\n\n\njså¼•å…¥æ–¹å¼\n\n\nå†…éƒ¨è„šæœ¬ï¼ˆå®šä¹‰åœ¨HTMLé¡µé¢ï¼‰\n\njsä»£ç å¿…é¡»ä½äº&lt;script&gt;&lt;/script&gt;ä¹‹é—´\nå¯ä»¥æ”¾åœ¨ä»»æ„åœ°æ–¹ï¼Œæ”¾ç½®ä»»æ„æ•°é‡\nä¸€èˆ¬ä½äº&lt;body&gt;å…ƒç´ çš„åº•éƒ¨ï¼Œæ”¹å–„æ˜¾ç¤ºé€Ÿåº¦\n\n\n\nå¤–éƒ¨è„šæœ¬ï¼ˆjsä»£ç å®šä¹‰åœ¨å¤–éƒ¨è§’è‰²æ–‡ä»¶ä¸­ï¼Œç„¶åå¼•å…¥åˆ°HTMLä¸­ï¼‰\n\nå¤–éƒ¨jsæ–‡ä»¶ä¸­åªåŒ…å«jsä»£ç ï¼Œä¸å«æœ‰&lt;script&gt;æ ‡ç­¾\n&lt;script&gt;æ ‡ç­¾ä¸èƒ½è‡ªé—­åˆ\n\n\n\nåŸºç¡€è¯­æ³•\n\n\nä¹¦å†™è¯­æ³•\n\nåŒºåˆ†å¤§å°å†™\næ¯æ¡è¯­å¥ç»“æŸå¯ä»¥ä¸å†™åˆ†å·\n\n\n\nè¾“å‡ºè¯­å¥\n\nwindow.alert()  å†™å…¥è­¦å‘Šæ¡†\ndocument.write()  å†™å…¥HTMLè¾“å‡º\nconsole.log()  å†™å…¥æµè§ˆå™¨æ§åˆ¶å°\n\n\n\nå˜é‡\n\n\nåˆ©ç”¨varï¼Œletï¼Œconstå…³é”®å­—æ¥å£°æ˜å˜é‡\n\n\nå› ä¸ºjsæ˜¯å¼±ç±»å‹çš„è¯­è¨€ï¼Œæ‰€ä»¥å˜é‡å¯ä»¥å­˜æ”¾ä¸åŒç±»å‹çš„å€¼\n\n\nåˆ©ç”¨varå®šä¹‰å‡ºæ¥çš„æ˜¯å…¨å±€å˜é‡ï¼Œå¯ä»¥é‡å¤å®šä¹‰\n\n\nåˆ©ç”¨letå®šä¹‰å‡ºæ¥çš„æ˜¯å±€éƒ¨å˜é‡ï¼Œåªåœ¨ä»£ç å—ä¸­æœ‰æ•ˆï¼Œä¸å¯é‡å¤å®šä¹‰\n\n\næ•°æ®ç±»å‹\n\n\nåŸå§‹ç±»å‹\n\nnumberï¼Œstringï¼Œbooleanï¼Œnullï¼Œundefined\n\n\n\nå¼•ç”¨ç±»å‹\n\njsä¸­çš„å¯¹è±¡\n\n\n\nåˆ©ç”¨typeofæ¥è·å–æ•°æ®ç±»å‹\n\n\nè¿ç®—ç¬¦\n\n\n==ï¼šä¼šè¿›è¡Œç±»å‹è½¬æ¢\n\n\n===ï¼šä¸ä¼šè¿›è¡Œç±»å‹è½¬æ¢\n\n\njså‡½æ•°\n\n\né€šè¿‡functionå…³é”®å­—è¿›è¡Œå®šä¹‰\n\n\nä¸éœ€è¦å®šä¹‰å½¢å‚å’Œè¿”å›å€¼çš„ç±»å‹\n\n\njså¯¹è±¡\n\n\nArray\n\nvar å˜é‡å =  [å…ƒç´ åˆ—è¡¨]\nvar å˜é‡å = new Arrayï¼ˆå…ƒç´ åˆ—è¡¨ï¼‰\nå±æ€§ï¼šlengthï¼Œè¿”å›æ•°ç»„ä¸­çš„å…ƒç´ æ•°é‡\næ–¹æ³•\n\nforEach()ï¼šéå†æ•°ç»„ä¸­æ¯ä¸€ä¸ªæœ‰å€¼çš„å…ƒç´ ï¼Œå¹¶è°ƒç”¨ä¸€æ¬¡ä¼ å…¥çš„å‡½æ•°\n\nç®­å¤´å‡½æ•°:arry.forEach(item=&gt;{console.log(item);})\n\n\npush()ï¼šå°†æ–°å…ƒç´ æ·»åŠ åˆ°æ•°ç»„æœ«å°¾ï¼Œå¹¶è¿”å›æ–°çš„é•¿åº¦\nsplice(start,number)ï¼šä»æ•°ç»„ä¸­åˆ é™¤å…ƒç´ \n\n\n\n\n\nString\n\nå±æ€§ï¼šlength\næ–¹æ³•\n\ncharAt()ï¼šè¿”å›æŒ‡å®šä½ç½®çš„å­—ç¬¦\nindexOf()ï¼šæ£€ç´¢å­—ç¬¦ä¸²æ‰€åœ¨çš„ä½ç½®\ntrim()ï¼šå»é™¤å­—ç¬¦ä¸²ä¸¤è¾¹çš„ç©ºæ ¼\nsubstring(start,end):æå–å­—ç¬¦ä¸²ä¸­ä¸¤ä¸ªæŒ‡å®šçš„ç´¢å¼•å·ä¹‹é—´çš„å­—ç¬¦(å·¦é—­å³å¼€)\n\n\n\n\n\nJSON(JavaScript Object Notation)\n\né€šè¿‡JavaScriptå¯¹è±¡æ ‡è®°æ³•å†™çš„æ–‡æœ¬\nå¤šä½œä¸ºæ•°æ®è½½ä½“ï¼Œè¿›è¡Œæ•°æ®ä¼ è¾“\nè‡ªå®šä¹‰å¯¹è±¡\n\n\n\n\næ ¼å¼ä¸è‡ªå®šä¹‰å¯¹è±¡ç±»ä¼¼ï¼Œä½†å˜é‡åè¦åŠ åŒå¼•å·\nå®šä¹‰\n\nvar å˜é‡å = '&#123;&quot;key1&quot;: value1,&quot;key2&quot;:value2&#125;'\nvar userStr = '&#123;&quot;name&quot;:&quot;Jerry&quot;,&quot;age&quot;:18,&quot;addr&quot;:[&quot;åŸç¥&quot;,&quot;æ˜Ÿé“&quot;,&quot;ç»åŒºé›¶&quot;]&#125;'\nè¯¥å¯¹è±¡æ˜¯æ–‡æœ¬ï¼Œæ•´ä½“è¦åŠ å•å¼•å·\n\n\næ–¹æ³•\n\nJSON.parse()    å°† JSON å­—ç¬¦ä¸²è§£æä¸º JavaScript å¯¹è±¡\nJSON.stringify()\n\n\n\n\n\nBOM(Browser Object Model)\n\næµè§ˆå™¨å¯¹è±¡æ¨¡å‹ï¼Œå…è®¸jsä¸æµè§ˆå™¨å¯¹è¯ï¼Œjså°†æµè§ˆå™¨å„ä¸ªç»„æˆéƒ¨åˆ†å°è£…ä¸ºå¯¹è±¡\nç»„æˆ\n\nWindow:æµè§ˆå™¨çª—å£å¯¹è±¡\n\næ–¹æ³•\n\nalert()æ˜¾ç¤ºå¸¦æœ‰ä¸€æ®µæ¶ˆæ¯å’Œä¸€ä¸ªç¡®è®¤æŒ‰é’®çš„è­¦å‘Šæ¡†\nconfirm()æ˜¾ç¤ºå¸¦æœ‰ä¸€æ®µæ¶ˆæ¯ä»¥åŠä¸€ä¸ªç¡®è®¤å’Œå–æ¶ˆæŒ‰é’®çš„å¯¹è¯æ¡†\nsetInterval()æŒ‰ç…§æŒ‡å®šçš„å‘¨æœŸæ¥è°ƒç”¨å‡½æ•°\nsetTimeout()åœ¨æŒ‡å®šçš„æ¯«ç§’æ•°åè°ƒç”¨å‡½æ•°\n\n\n\n\nNavigator:æµè§ˆå™¨å¯¹è±¡\nScreen\nHistory\nLocation:åœ°å€æ å¯¹è±¡\n\nå±æ€§ï¼šhref\nlocation.href = &quot;https://www.xxxx.cn&quot;`\n\n\n\n\n\n\n\nDOM(Document Object Model)\n\nå°†æ ‡è®°è¯­è¨€çš„å„ä¸ªç»„æˆéƒ¨åˆ†å°è£…ä¸ºå¯¹åº”çš„å¯¹è±¡\n\nDocument:æ•´ä¸ªæ–‡æ¡£å¯¹è±¡\nElement:å…ƒç´ å¯¹è±¡\nAttribute:å±æ€§å¯¹è±¡\nText:æ–‡æœ¬å¯¹è±¡\nComment:æ³¨é‡Šå¯¹è±¡\n\n\n\n\n\njsäº‹ä»¶ç›‘å¬\n\n\næŒ‡å‘ç”Ÿåœ¨HTMLå…ƒç´ ä¸Šçš„äº‹æƒ…ï¼Œå¦‚æŒ‰é’®è¢«ç‚¹å‡»ï¼ŒæŒ‰ä¸‹é¼ æ ‡å¿«æ·é”®,æ‰§è¡Œç›¸åº”ä»£ç \n\n\näº‹ä»¶ç»‘å®š\n\n\n\n\n\nå¸¸è§äº‹ä»¶\n\n\n\n\n\nVue\n\n\nå‰ç«¯æ¡†æ¶ï¼Œå…é™¤jsä¸­çš„DOMæ“ä½œï¼ŒåŸºäºMVVMæ€æƒ³ï¼Œå®ç°æ•°æ®åŒå‘ç»‘å®š\n\n\næ’å€¼è¡¨è¾¾å¼:\nå¸¸ç”¨å±æ€§\n\n\nelæŒ‡ç¤ºvueç¼–è¯‘å™¨ä»ä»€ä¹ˆåœ°æ–¹å¼€å§‹è§£æ vueçš„è¯­æ³•\n\n\ndataå­˜å‚¨å˜é‡\n\n\nmethodså­˜æ”¾å‡½æ•°\n\n\ntemplateè®¾ç½®æ¨¡æ¿\n\n\nwatch\n\n\ncomputed\n\n\nrenderåˆ›å»ºçœŸæ­£çš„Virtual Dom\n\n\nå¸¸ç”¨æŒ‡ä»¤\n\n\nv-modelåœ¨è¡¨å•å…ƒç´ ä¸Šåˆ›å»ºåŒå‘æ•°æ®ç»‘å®š\n\n\nv-bindä¸ºHTMLæ ‡ç­¾ç»‘å®šå±æ€§å€¼ï¼Œå¦‚hrefï¼Œcssæ ·å¼\n\n\n&lt;body&gt;    &lt;div id=&quot;app&quot;&gt;        &lt;input type=&quot;text&quot; v-model=&quot;message&quot;&gt;        &#123;&#123;message&#125;&#125;    &lt;/div&gt;    &lt;div id=&quot;yuanshen&quot;&gt;        &lt;a v-bind:href=&quot;url&quot; target=&quot;_blank&quot;&gt;åŸç¥&lt;/a&gt;        &lt;input type=&quot;text&quot; v-model=&quot;url&quot;&gt;    &lt;/div&gt;&lt;/body&gt;&lt;script&gt;    new Vue(&#123;        el: &quot;#app&quot;,        data:&#123;            message:&quot;hello vue&quot;        &#125;    &#125;)    new Vue(&#123;        el:&quot;#yuanshen&quot;,        data:&#123;            url:&quot;https://www.yuanshen.com/#/&quot;        &#125;    &#125;)&lt;/script&gt;\n\n\nv-onä¸ºHTMLæ ‡ç­¾ç»‘å®šäº‹ä»¶\n\n\n\n\n\nv-if, v-else-if, v-elseæ¡ä»¶æ€§çš„æ¸²æŸ“æŸå…ƒç´ \n\n\nv-showæ ¹æ®æ¡ä»¶å±•ç¤ºæŸå…ƒç´ ï¼ŒåŒºåˆ«åœ¨äºåˆ‡æ¢çš„æ˜¯displayå±æ€§çš„å€¼\n\n\nv-foråˆ—è¡¨æ¸²æŸ“ï¼Œéå†å®¹å™¨ä¸­çš„å…ƒç´ æˆ–è€…å¯¹è±¡çš„å±æ€§\n\n&lt;div v-for=&quot;å˜é‡å in éå†å¯¹è±¡&quot;&gt;&#123;&#123;å˜é‡å&#125;&#125;&lt;/div&gt;\n\n\n\n&lt;div v-for=&quot;addr in addrs&quot;&#123;&#123;addr&#125;&#125;&lt;/div&gt;&lt;div v-for=&quot;(addr,index) in addrs&quot;&#123;&#123;index+1&#125;&#125;:&#123;&#123;addr&#125;&#125;&lt;/div&gt;data:&#123;\t...\taddrs:[&#x27;beijing&#x27;,&#x27;shanghai&#x27;,&#x27;hongkong&#x27;,&#x27;nanjing&#x27;]&#125;,\n\n\næ¡ˆä¾‹\n\n\n&lt;div id=&quot;app&quot;&gt;        &lt;table border=&quot;1px&quot; cellspacing=&quot;0&quot; width=&quot;60%&quot;&gt;            &lt;tr&gt;                &lt;th&gt;ç¼–å·&lt;/th&gt;&lt;th&gt;å§“å&lt;/th&gt;&lt;th&gt;å¹´é¾„&lt;/th&gt;&lt;th&gt;æ€§åˆ«&lt;/th&gt;&lt;th&gt;æˆç»©&lt;/th&gt;&lt;th&gt;ç­‰çº§&lt;/th&gt;            &lt;/tr&gt;            &lt;tr align=&quot;center&quot; v-for=&quot;(arr,index) in users&quot;&gt; //éå†usersæ•°ç»„ä¸­çš„å…ƒç´ ï¼Œå¹¶èµ‹å€¼ç»™arr                &lt;td&gt;&#123;&#123;index+1&#125;&#125;&lt;/td&gt;                &lt;td&gt;&#123;&#123;arr.name&#125;&#125;&lt;/td&gt;                &lt;td&gt;&#123;&#123;arr.age&#125;&#125;&lt;/td&gt;                &lt;td&gt;                    &lt;span v-if=&quot;arr.gender==1&quot;&gt;boy&lt;/span&gt;                    &lt;span v-else-if=&quot;arr.gender==0&quot;&gt;girl&lt;/span&gt;                &lt;/td&gt;                &lt;td&gt;&#123;&#123;arr.score&#125;&#125;&lt;/td&gt;                &lt;td&gt;                    &lt;span v-if=&quot;arr.score&gt;=90&quot;&gt;ä¼˜ç§€&lt;/span&gt;                    &lt;span v-else-if=&quot;arr.score&gt;=60&quot;&gt;åŠæ ¼&lt;/span&gt;                    &lt;span v-else=&quot;arr.score 60&quot; style=&quot;color:red &quot;&gt;ä¸åŠæ ¼&lt;/span&gt;                &lt;/td&gt;            &lt;/tr&gt;        &lt;/table&gt;    &lt;/div&gt;    &lt;script&gt;        new Vue(&#123;            el:&quot;#app&quot;,            data:&#123;                users:[&#123;name:&quot;çº³è¥¿å¦²&quot;,age:&quot;500&quot;,gender:0,score:100&#125;,                &#123;name:&quot;èŠ™å®å¨œ&quot;,age:&quot;530&quot;,gender:0,score:80&#125;,                &#123;name:&quot;è’æ³·ä¸€æ–—&quot;,age:&quot;101&quot;,gender:1,score:55&#125;,                &#123;name:&quot;æ—…è¡Œè€…&quot;,age:&quot;666&quot;,gender:1,score:90&#125;,                &#123;name:&quot;æ´¾è’™&quot;,age:&quot;320&quot;,gender:0,score:66&#125;,                &#123;name:&quot;ä¸ƒä¸ƒ&quot;,age:&quot;432&quot;,gender:0,score:77&#125;,                &#123;name:&quot;å¤©ç†&quot;,age:&quot;999&quot;,gender:0,score:150&#125;]            &#125;,        &#125;)    &lt;/script&gt;\nç”Ÿå‘½å‘¨æœŸ\n\n\næ¯è§¦å‘ä¸€ä¸ªç”Ÿå‘½å‘¨æœŸäº‹ä»¶ï¼Œä¼šè‡ªåŠ¨æ‰§è¡Œä¸€ä¸ªç”Ÿå‘½å‘¨æœŸæ–¹æ³•ï¼ˆé’©å­ï¼‰\n\n\nå…«ä¸ªé˜¶æ®µ\n\nbeforeCreate\ncreated\nbeforeMount\nmountedæŒ‚è½½å®Œæˆ\nbeforeUpdate\nupdated\nbeforeDestroy\ndestroyed\n\n\n\nVueè·¯ç”±(Vue Router)\n\n\nVue router è·¯ç”±å™¨ç±»ï¼Œæ ¹æ®è·¯ç”±è¯·æ±‚åœ¨è·¯ç”±è§†å›¾ä¸­åŠ¨æ€æ¸²æŸ“é€‰ä¸­çš„ç»„ä»¶\n\n\n&lt;router-link&gt;è¯·æ±‚é“¾æ¥ç»„ä»¶ï¼Œä¼šè¢«æµè§ˆå™¨è§£æä¸º&lt;a&gt;\n\n\n&lt;router-view&gt;åŠ¨æ€è§†å›¾ç»„ä»¶ï¼Œç”¨æ¥æ¸²æŸ“å±•ç¤ºä¸è·¯ç”±è·¯å¾„å¯¹åº”çš„ç»„ä»¶\n\n\nAjax(Asynchronous Javascript Anderson XML)\n\n\nå¼‚æ­¥çš„Javascriptå’ŒXML\n\n\nä½œç”¨\n\n\næ•°æ®äº¤æ¢ï¼šé€šè¿‡å®ƒå¯ä»¥å‘æœåŠ¡å™¨å‘é€è¯·æ±‚ï¼Œå¹¶è·å–æœåŠ¡å™¨å“åº”çš„æ•°æ®\n\n\nå¼‚æ­¥äº¤äº’ï¼šä¸åˆ·æ–°æ•´ä¸ªé¡µé¢çš„åŒæ—¶ï¼Œè¿›è¡Œå±€éƒ¨åˆ·æ–°\n\n\nAxios\n\n\nå¯¹åŸç”Ÿçš„Ajaxè¿›è¡Œäº†å°è£…ï¼Œç®€åŒ–ä¹¦å†™ï¼Œå¿«é€Ÿå¼€å‘\n\n\nå…¥é—¨ç¨‹åº\n\n\n&lt;input type=&quot;button&quot; value=&quot;è·å–æ•°æ®GET&quot; onclick=&quot;get()&quot;&gt;    &lt;input type=&quot;button&quot; value=&quot;åˆ é™¤æ•°æ®POST&quot; onclick=&quot;post()&quot;&gt;    &lt;script&gt;        function get()&#123;            axios(&#123;                method:&quot;get&quot;,                url:&quot;http://yuanshen.com&quot;            &#125;).then(result=&gt;&#123;                console.log(result.data);            &#125;)-------------------------------------------------------------------------------------------------            axios.get(&quot;http://yuanshen.com&quot;).then(result=&gt;&#123;console.log(result.data)&#125;) //ç®€åŒ–æ¨¡å¼        &#125;    &lt;/script&gt;\n\n\n\nç»“åˆVueä¸­çš„mountedç”Ÿå‘½å‘¨æœŸäº‹ä»¶\n\n\n&lt;script&gt;\tnew Vue(&#123;    \tel:&quot;#app&quot;,    \tdata:&#123;            emps:[]        &#125;,    \tmounted()&#123;            axios.get(&quot;http://www.xxxx.xxx.com&quot;).then(result=&gt;&#123;                this.emps = result.data.data;            &#125;)        &#125;&#125;);   &lt;/script&gt;\nYApi\n\n\né«˜æ•ˆï¼Œæ˜“ç”¨ï¼ŒåŠŸèƒ½å¼ºå¤§çš„apiç®¡ç†å¹³å°\n\n\nç”¨äºæ¨¡æ‹Ÿå‰ç«¯æ‰€éœ€è¦çš„æ•°æ®\n\n\nå‰ç«¯å·¥ç¨‹åŒ–\nå®šä¹‰\n\n\næŒ‡æŠŠå‰ç«¯å¼€å‘æ‰€éœ€çš„å·¥å…·ï¼ŒæŠ€æœ¯ï¼Œæµç¨‹ï¼Œç»éªŒç­‰è¿›è¡Œè§„èŒƒåŒ–ï¼Œæ ‡å‡†åŒ–\n\n\nvueè„šæ‰‹æ¶çš„ç¯å¢ƒå‡†å¤‡\n\n\nå®‰è£…node.js\n\n\né…ç½®npmçš„å…¨å±€å®‰è£…è·¯å¾„   npm config set prefix &quot;node.jsçš„å®‰è£…è·¯å¾„&quot;\n\n\nåˆ‡æ¢npmçš„é•œåƒ  npm config set registry é•œåƒåœ°å€\n\nè…¾è®¯ é•œåƒ: https://mirrors.cloud.tencent.com/npm/\nåä¸º é•œåƒ: https://mirrors.huaweicloud.com/repository/npm/\né˜¿é‡Œ é•œåƒï¼šhttps://npm.aliyun.com\n\n\n\nå®‰è£…vue-cli npm install -g @vue/cli\n\n\nç¡®è®¤æ˜¯å¦å®‰è£…æˆåŠŸ vue --version\n\n\nVueé¡¹ç›®\nåˆ›å»º\n\n\nå‘½ä»¤è¡Œ vue create vue-project01\n\n\nå›¾å½¢åŒ–ç•Œé¢vue ui\n\n\nç›®å½•ç»“æ„\n\n\nnode_modules æ•´ä¸ªé¡¹ç›®çš„ä¾èµ–åŒ…\n\n\npublic å­˜æ”¾é¡¹ç›®çš„é™æ€æ–‡ä»¶\n\n\nsrc       å­˜æ”¾é¡¹ç›®çš„æºä»£ç \n\nassetsé™æ€èµ„æº\ncomponentså¯é‡ç”¨çš„ç»„ä»¶\nrouterè·¯ç”±é…ç½®\nviewsè§†å›¾ç»„ä»¶ï¼ˆé¡µé¢ï¼‰\nApp.vueå…¥å£é¡µé¢ï¼ˆæ ¹ç»„ä»¶ï¼‰\nmain.jså…¥å£jsæ–‡ä»¶\n\n\n\npackage.json   æ¨¡æ¿åŸºæœ¬ä¿¡æ¯ï¼Œé¡¹ç›®å¼€å‘æ‰€éœ€è¦çš„æ¨¡å—ï¼Œç‰ˆæœ¬ä¿¡æ¯\n\n\nvue.config.js     ä¿å­˜vueé…ç½®çš„æ–‡ä»¶ï¼Œå¦‚ï¼šä»£ç†ï¼Œç«¯å£çš„é…ç½®\n\n\næ›´æ”¹ç«¯å£å·\n\n\nè¿›å…¥vue.config.jsæ–‡ä»¶\n\n\nconst &#123; defineConfig &#125; = require(&#x27;@vue/cli-service&#x27;)module.exports = defineConfig(&#123;  transpileDependencies: true, //æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼Œå°†ç«¯å£å·æ”¹ä¸º7000  devServer:&#123;    port:7000  &#125;&#125;)\nVueçš„ç»„ä»¶æ–‡ä»¶ä»¥.vueç»“å°¾ï¼Œæ¯ä¸ªç»„ä»¶ç”±ä¸‰éƒ¨åˆ†ç»„æˆ&lt;template&gt;ï¼Œ&lt;script&gt;ï¼Œ&lt;style&gt;\n&lt;template&gt;&lt;div&gt;&lt;h1&gt;&#123;&#123;message&#125;&#125;&lt;/h1&gt;&lt;/div&gt;&lt;/template&gt;  //æ¨¡æ¿éƒ¨åˆ†ï¼Œç”ŸæˆHTMLä»£ç &lt;script&gt;export default &#123;  data:function()&#123;    return&#123;      message:&quot;hello vue&quot;    &#125;  &#125;,  methods: &#123;      &#125;,&#125;&lt;/script&gt;  //æ§åˆ¶æ¨¡æ¿çš„æ•°æ®æ¥æºå’Œè¡Œä¸º&lt;style&gt;&lt;/style&gt;  //cssæ ·å¼éƒ¨åˆ†\nElement(Vueç»„ä»¶åº“)\nç»„ä»¶ï¼šç»„æˆç½‘é¡µçš„éƒ¨ä»¶ï¼Œå¦‚è¶…é“¾æ¥ï¼ŒæŒ‰é’®ï¼Œå›¾ç‰‡ï¼Œè¡¨æ ¼ï¼Œè¡¨å•ï¼Œåˆ†é¡µæ¡ç­‰\nurlï¼šä¸€ä¸ª Vue 3 UI æ¡†æ¶ | Element Plus (element-plus.org)\nå¦‚ä½•ä½¿ç”¨\n\n\nåœ¨åˆ›å»ºå¥½çš„Vueé¡¹ç›®ä¸­å®‰è£…ElementUIç»„ä»¶åº“  npm install element-plus --save\n\n\nå¼•å…¥ElementUIç»„ä»¶åº“\nimport &#123; createApp &#125; from &#x27;vue&#x27;import ElementPlus from &#x27;element-plus&#x27;import &#x27;element-plus/dist/index.css&#x27;import App from &#x27;./App.vue&#x27;const app = createApp(App)app.use(ElementPlus)app.mount(&#x27;#app&#x27;)\n\n\nè®¿é—®å®˜ç½‘ï¼Œå¤åˆ¶ç»„ä»¶ä»£ç ï¼Œè°ƒæ•´\n\n\næ‰“åŒ…éƒ¨ç½²\n\n\nå…ˆæ‰“åŒ…npm run build å†éƒ¨ç½²\n\n\nå°†æ‰“åŒ…å¥½çš„distç›®å½•ä¸‹çš„æ–‡ä»¶ï¼Œå¤åˆ¶åˆ°nginxå®‰è£…ç›®å½•ä¸‹çš„htmlç›®å½•\n\n\nå¯åŠ¨ï¼šåŒå‡»nginx.exeæ–‡ä»¶ï¼ŒnginxæœåŠ¡å™¨é»˜è®¤å ç”¨æœ¬æœº80ç«¯å£å·\n\nå¦‚æœ80ç«¯å£å·è¢«å ç”¨ï¼Œå¯ä»¥åœ¨nginx.confä¸­ä¿®æ”¹ç«¯å£å·\næŸ¥çœ‹ç«¯å£è¢«è°å ç”¨netstat -ano | findStr 80\n\n\n\nè®¿é—®ï¼šæµè§ˆå™¨è¾“å…¥ localhost:ç«¯å£å·\n\n\nNginx\nä¸€æ¬¾è½»é‡çº§çš„webæœåŠ¡å™¨ï¼Œåå‘ä»£ç†æœåŠ¡å™¨ï¼Œç”µå­é‚®ä»¶ä»£ç†æœåŠ¡å™¨\n","categories":["ç¼–ç¨‹"],"tags":["Web"]},{"title":"windowsæ‰¹å¤„ç†è„šæœ¬ç›¸å…³æ¦‚å¿µ","url":"/2025/10/20/windows/windows%E6%89%B9%E5%A4%84%E7%90%86%E8%84%9A%E6%9C%AC%E7%9B%B8%E5%85%B3%E6%A6%82%E5%BF%B5/","content":"\næƒ³è‡ªåŠ¨åŒ–åˆ›å»ºmarkdownæ–‡ä»¶æ—¶äº†è§£åˆ°çš„ç›¸å…³æŠ€æœ¯ï¼Œåˆ©ç”¨AIè¿›è¡Œäº†æ•´ç†ç®€å•äº†è§£å³å¯\n\n\næ‰¹å¤„ç†è„šæœ¬ï¼ˆBATï¼‰å®Œæ•´æ•™ç¨‹ï¼šè¯­æ³•ã€æ¦‚å¿µä¸å®è·µ\nç›®å½•\n\n\nåŸºæœ¬æ¦‚å¿µ\n\n\nå¸¸ç”¨å‘½ä»¤\n\n\nå˜é‡ç³»ç»Ÿ\n\n\nç‰¹æ®Šå‚æ•°æ‰©å±•\n\n\nå‘½ä»¤è¡Œå‚æ•°å¤„ç†\n\n\nç‰¹æ®Šç¬¦å·\n\n\næ§åˆ¶ç»“æ„\n\n\né«˜çº§æ¦‚å¿µ\n\n\nå®ç”¨è„šæœ¬ç¤ºä¾‹\n\n\nåŸºæœ¬æ¦‚å¿µ\næ‰¹å¤„ç†è„šæœ¬ï¼ˆ.bat æˆ– .cmd æ–‡ä»¶ï¼‰æ˜¯Windowsç³»ç»Ÿä¸‹çš„è„šæœ¬æ–‡ä»¶ï¼ŒåŒ…å«ä¸€ç³»åˆ—DOSå‘½ä»¤ï¼Œç”¨äºè‡ªåŠ¨åŒ–æ‰§è¡Œä»»åŠ¡ã€‚å®ƒæ˜¯ä¸€ç§è§£é‡Šæ€§è¯­è¨€ï¼Œç”±å‘½ä»¤æç¤ºç¬¦ï¼ˆcmd.exeï¼‰è§£é‡Šæ‰§è¡Œã€‚\nç‰¹ç‚¹ï¼š\n\n\næ— éœ€ç¼–è¯‘ï¼Œç›´æ¥æ‰§è¡Œ\n\n\né€è¡Œè§£é‡Šæ‰§è¡Œ\n\n\nå¯ä»¥è°ƒç”¨ç³»ç»Ÿå‘½ä»¤å’Œå…¶ä»–ç¨‹åº\n\n\næ”¯æŒå˜é‡ã€æ¡ä»¶åˆ¤æ–­å’Œå¾ªç¯ç­‰åŸºæœ¬ç¼–ç¨‹ç»“æ„\n\n\nå¸¸ç”¨å‘½ä»¤\næ–‡ä»¶æ“ä½œ\n\n\ndir - æ˜¾ç¤ºç›®å½•å†…å®¹\n\n\ncd - æ”¹å˜å½“å‰ç›®å½•\n\n\nmd/mkdir - åˆ›å»ºç›®å½•\n\n\nrd/rmdir - åˆ é™¤ç›®å½•\n\n\ncopy - å¤åˆ¶æ–‡ä»¶\n\n\nmove - ç§»åŠ¨æ–‡ä»¶\n\n\ndel - åˆ é™¤æ–‡ä»¶\n\n\nren/rename - é‡å‘½åæ–‡ä»¶\n\n\nç³»ç»Ÿæ“ä½œ\n\n\necho - æ˜¾ç¤ºæ–‡æœ¬æˆ–å…³é—­/æ‰“å¼€å‘½ä»¤å›æ˜¾\n\n\ncls - æ¸…ç©ºå±å¹•\n\n\ntype - æ˜¾ç¤ºæ–‡ä»¶å†…å®¹\n\n\ndate - æ˜¾ç¤ºæˆ–è®¾ç½®æ—¥æœŸ\n\n\ntime - æ˜¾ç¤ºæˆ–è®¾ç½®æ—¶é—´\n\n\nver - æ˜¾ç¤ºWindowsç‰ˆæœ¬\n\n\ntitle - è®¾ç½®å‘½ä»¤æç¤ºç¬¦çª—å£æ ‡é¢˜\n\n\nç¨‹åºæ‰§è¡Œ\n\n\nstart - å¯åŠ¨ä¸€ä¸ªæ–°çª—å£æ‰§è¡Œç¨‹åº\n\n\ncall - è°ƒç”¨å¦ä¸€ä¸ªæ‰¹å¤„ç†æ–‡ä»¶\n\n\nexit - é€€å‡ºæ‰¹å¤„ç†ç¨‹åº\n\n\npause - æš‚åœç¨‹åºæ‰§è¡Œï¼Œç­‰å¾…ç”¨æˆ·æŒ‰é”®\n\n\nå˜é‡ç³»ç»Ÿ\nç³»ç»Ÿå˜é‡\n\n\n\nå˜é‡\nè¯´æ˜\n\n\n\n\n%SystemRoot%\nWindowsç³»ç»Ÿç›®å½•ï¼ˆé€šå¸¸æ˜¯C:\\Windowsï¼‰\n\n\n%SystemDrive%\nç³»ç»Ÿæ‰€åœ¨é©±åŠ¨å™¨ï¼ˆé€šå¸¸æ˜¯C:ï¼‰\n\n\n%UserProfile%\nå½“å‰ç”¨æˆ·çš„ä¸ªäººæ–‡ä»¶å¤¹\n\n\n%PATH%\nå¯æ‰§è¡Œæ–‡ä»¶è·¯å¾„\n\n\n%TEMP%/%TMP%\nä¸´æ—¶æ–‡ä»¶å¤¹è·¯å¾„\n\n\n%DATE%\nå½“å‰æ—¥æœŸ\n\n\n%TIME%\nå½“å‰æ—¶é—´\n\n\n%CD%\nå½“å‰ç›®å½•\n\n\n%ALLUSERSPROFILE%\næ‰€æœ‰ç”¨æˆ·é…ç½®æ–‡ä»¶ä½ç½®\n\n\n%APPDATA%\nåº”ç”¨ç¨‹åºæ•°æ®å­˜å‚¨ä½ç½®\n\n\n%CMDCMDLINE%\nå¯åŠ¨å½“å‰Cmd.exeçš„å‘½ä»¤è¡Œ\n\n\n%CMDEXTVERSION%\nå‘½ä»¤å¤„ç†ç¨‹åºæ‰©å±•ç‰ˆæœ¬å·\n\n\n%COMPUTERNAME%\nè®¡ç®—æœºåç§°\n\n\n%COMSPEC%\nå‘½ä»¤è¡Œè§£é‡Šå™¨å¯æ‰§è¡Œç¨‹åºè·¯å¾„\n\n\n%ERRORLEVEL%\nä¸Šä¸€æ¡å‘½ä»¤çš„é”™è¯¯ä»£ç \n\n\n%HOMEDRIVE%\nç”¨æˆ·ä¸»ç›®å½•æ‰€åœ¨é©±åŠ¨å™¨\n\n\n%HOMEPATH%\nç”¨æˆ·ä¸»ç›®å½•å®Œæ•´è·¯å¾„\n\n\n%HOMESHARE%\nç”¨æˆ·å…±äº«ä¸»ç›®å½•çš„ç½‘ç»œè·¯å¾„\n\n\n%LOGONSERVER%\néªŒè¯å½“å‰ç™»å½•ä¼šè¯çš„åŸŸæ§åˆ¶å™¨åç§°\n\n\n%NUMBER_OF_PROCESSORS%\nå®‰è£…çš„å¤„ç†å™¨æ•°ç›®\n\n\n%OS%\næ“ä½œç³»ç»Ÿåç§°\n\n\n%PATHEXT%\næ“ä½œç³»ç»Ÿè®¤ä¸ºå¯æ‰§è¡Œçš„æ–‡ä»¶æ‰©å±•ååˆ—è¡¨\n\n\n%PROCESSOR_ARCHITECTURE%\nå¤„ç†å™¨èŠ¯ç‰‡ä½“ç³»ç»“æ„\n\n\n%PROCESSOR_IDENTFIER%\nå¤„ç†å™¨è¯´æ˜\n\n\n%PROCESSOR_LEVEL%\nå¤„ç†å™¨å‹å·\n\n\n%PROCESSOR_REVISION%\nå¤„ç†å™¨ç‰ˆæœ¬å·\n\n\n%PROMPT%\nå½“å‰å‘½ä»¤æç¤ºç¬¦è®¾ç½®\n\n\n%RANDOM%\n0åˆ°32767ä¹‹é—´çš„éšæœºæ•°\n\n\n%USERDOMAIN%\nåŒ…å«ç”¨æˆ·å¸æˆ·çš„åŸŸåç§°\n\n\n%USERNAME%\nå½“å‰ç™»å½•ç”¨æˆ·å\n\n\n%WINDIR%\næ“ä½œç³»ç»Ÿç›®å½•ä½ç½®\n\n\n\nç”¨æˆ·è‡ªå®šä¹‰å˜é‡\n@echo offset var=Hello Worldecho %var%:: è®¾ç½®å¸¦ç©ºæ ¼çš„å˜é‡å€¼set &quot;var=Hello World with spaces&quot;echo %var%:: æ•°å€¼è®¡ç®—set /a num=10+5echo %num%:: åˆ é™¤å˜é‡set var=\nç‰¹æ®Šå‚æ•°æ‰©å±•\næ ¹æ®å®˜æ–¹æ–‡æ¡£ï¼Œæ‰¹å¤„ç†è„šæœ¬æä¾›äº†å¼ºå¤§çš„å‚æ•°æ‰©å±•åŠŸèƒ½ï¼Œä½¿ç”¨%~è¯­æ³•å¯ä»¥å¯¹å‚æ•°è¿›è¡Œå„ç§è½¬æ¢ã€‚\nåŸºç¡€æ‰©å±•ä¿®é¥°ç¬¦\n\n\n\nè¯­æ³•\nè¯´æ˜\n\n\n\n\n%~1\nå±•å¼€%1å¹¶åˆ é™¤å‘¨å›´çš„å¼•å·\n\n\n%~f1\nå°†%1æ‰©å±•åˆ°å®Œå…¨é™å®šçš„è·¯å¾„å\n\n\n%~d1\nä»…å°†%1æ‰©å±•ä¸ºé©±åŠ¨å™¨å·\n\n\n%~p1\nä»…å°†%1æ‰©å±•åˆ°è·¯å¾„\n\n\n%~n1\nä»…å°†%1æ‰©å±•åˆ°æ–‡ä»¶å\n\n\n%~x1\nä»…å°†%1æ‰©å±•åˆ°æ–‡ä»¶æ‰©å±•å\n\n\n%~s1\næ‰©å±•è·¯å¾„åªåŒ…å«çŸ­åç§°\n\n\n%~a1\nå°†%1æ‰©å±•åˆ°æ–‡ä»¶å±æ€§\n\n\n%~t1\nå°†%1æ‰©å±•åˆ°æ–‡ä»¶çš„æ—¥æœŸå’Œæ—¶é—´\n\n\n%~z1\nå°†%1æ‰©å±•åˆ°æ–‡ä»¶çš„å¤§å°\n\n\n%~$PATH:1\næœç´¢PATHç¯å¢ƒå˜é‡ä¸­çš„ç›®å½•ï¼Œå°†%1æ‰©å±•åˆ°æ‰¾åˆ°çš„ç¬¬ä¸€ä¸ªæ–‡ä»¶çš„å®Œæ•´è·¯å¾„\n\n\n\n%~dp0è¯¦è§£\n%~dp0æ˜¯æœ€å¸¸ç”¨çš„ç‰¹æ®Šæ‰©å±•ä¹‹ä¸€ï¼š\n\n\nd = é©±åŠ¨å™¨å·\n\n\np = è·¯å¾„\n\n\n0 = è¡¨ç¤ºæ‰¹å¤„ç†æ–‡ä»¶æœ¬èº«\n\n\nä¾‹å¦‚ï¼Œå¦‚æœæ‰¹å¤„ç†æ–‡ä»¶ä½äºF:\\Temp\\Batch\\test.batï¼Œåˆ™ï¼š\necho %~dp0  :: è¾“å‡º F:\\Temp\\Batch\\echo %~f0  :: è¾“å‡º F:\\Temp\\Batch\\test.batecho %~n0  :: è¾“å‡º testecho %~x0  :: è¾“å‡º .bat\nç»„åˆæ‰©å±•ç¤ºä¾‹\n\n\n\nè¯­æ³•\nè¯´æ˜\n\n\n\n\n%~dp1\nå°†%1æ‰©å±•åˆ°é©±åŠ¨å™¨å·å’Œè·¯å¾„\n\n\n%~nx1\nå°†%1æ‰©å±•åˆ°æ–‡ä»¶åå’Œæ‰©å±•å\n\n\n%~dp$PATH:1\nåœ¨PATHä¸­æœç´¢%1ï¼Œæ‰©å±•åˆ°æ‰¾åˆ°çš„ç¬¬ä¸€ä¸ªæ–‡ä»¶çš„é©±åŠ¨å™¨å·å’Œè·¯å¾„\n\n\n%~ftza1\nå°†%1æ‰©å±•ä¸ºç±»ä¼¼dirå‘½ä»¤çš„è¾“å‡ºè¡Œ\n\n\n\nå‘½ä»¤è¡Œå‚æ•°å¤„ç†\nåŸºæœ¬å‚æ•°è®¿é—®\n@echo offecho æ‰¹å¤„ç†æ–‡ä»¶å: %0echo ç¬¬ä¸€ä¸ªå‚æ•°: %1echo ç¬¬äºŒä¸ªå‚æ•°: %2echo ç¬¬ä¸‰ä¸ªå‚æ•°: %3\n%*çš„å«ä¹‰\n%*è¡¨ç¤ºä¼ é€’ç»™æ‰¹å¤„ç†æ–‡ä»¶çš„æ‰€æœ‰å‚æ•°ï¼ˆä¸åŒ…æ‹¬%0ï¼‰ï¼Œä¿ç•™å‚æ•°ä¸­çš„å¼•å·å’Œç©ºæ ¼ã€‚\n@echo offecho æ‰€æœ‰å‚æ•°: %*\nå¤„ç†è¶…è¿‡9ä¸ªå‚æ•°\nä½¿ç”¨shiftå‘½ä»¤å¯ä»¥å¤„ç†è¶…è¿‡9ä¸ªå‚æ•°ï¼š\n@echo off:loopif &quot;%1&quot;==&quot;&quot; goto endecho å‚æ•°: %1shiftgoto loop:end\nå‚æ•°è§£æç¤ºä¾‹\n@echo offsetlocal enabledelayedexpansionset &quot;source=&quot;set &quot;destination=&quot;set &quot;verbose=false&quot;:parse_argsif &quot;%1&quot;==&quot;&quot; goto end_parseif &quot;%1&quot;==&quot;/v&quot; (    set &quot;verbose=true&quot;    shift    goto parse_args)if not defined source (    set &quot;source=%1&quot;) else if not defined destination (    set &quot;destination=%1&quot;)shiftgoto parse_args:end_parseecho æº: %source%echo ç›®æ ‡: %destination%echo è¯¦ç»†æ¨¡å¼: %verbose%endlocal\nç‰¹æ®Šç¬¦å·\né‡å®šå‘ç¬¦å·\n\n\n&gt; - è¾“å‡ºé‡å®šå‘ï¼ˆè¦†ç›–æ–‡ä»¶ï¼‰\n\n\n&gt;&gt; - è¾“å‡ºé‡å®šå‘ï¼ˆè¿½åŠ åˆ°æ–‡ä»¶ï¼‰\n\n\n&lt; - è¾“å…¥é‡å®šå‘\n\n\n| - ç®¡é“ç¬¦å·ï¼Œå°†å‰ä¸€ä¸ªå‘½ä»¤çš„è¾“å‡ºä½œä¸ºåä¸€ä¸ªå‘½ä»¤çš„è¾“å…¥\n\n\né€šé…ç¬¦\n\n\n* - åŒ¹é…ä»»æ„å­—ç¬¦åºåˆ—\n\n\n? - åŒ¹é…ä»»æ„å•ä¸ªå­—ç¬¦\n\n\nå…¶ä»–ç¬¦å·\n\n\n@ - éšè—å‘½ä»¤æœ¬èº«çš„æ˜¾ç¤º\n\n\n: - æ ‡ç­¾å®šä¹‰\n\n\n:: - æ³¨é‡Šï¼ˆä¸remç±»ä¼¼ï¼Œä½†æ‰§è¡Œæ›´å¿«ï¼‰\n\n\n&amp; - å‘½ä»¤åˆ†éš”ç¬¦ï¼Œåœ¨åŒä¸€è¡Œæ‰§è¡Œå¤šä¸ªå‘½ä»¤\n\n\n&amp;&amp; - é€»è¾‘ä¸ï¼Œå‰ä¸€ä¸ªå‘½ä»¤æˆåŠŸæ‰æ‰§è¡Œåä¸€ä¸ª\n\n\n|| - é€»è¾‘æˆ–ï¼Œå‰ä¸€ä¸ªå‘½ä»¤å¤±è´¥æ‰æ‰§è¡Œåä¸€ä¸ª\n\n\n() - å‘½ä»¤å—ï¼Œå°†å¤šä¸ªå‘½ä»¤ä½œä¸ºä¸€ä¸ªæ•´ä½“æ‰§è¡Œ\n\n\n^ - è½¬ä¹‰å­—ç¬¦ï¼Œç”¨äºæ˜¾ç¤ºç‰¹æ®Šå­—ç¬¦æœ¬èº«\n\n\né«˜çº§é‡å®šå‘ç¤ºä¾‹\n@echo off:: å°†å‘½ä»¤è¾“å‡ºåŒæ—¶ä¿å­˜åˆ°æ–‡ä»¶å’Œæ˜¾ç¤ºåœ¨å±å¹•ä¸Šdir | tee output.txt:: é”™è¯¯é‡å®šå‘command 2&gt; error.log  :: å°†é”™è¯¯è¾“å‡ºåˆ°æ–‡ä»¶command 2&gt;&amp;1          :: å°†é”™è¯¯è¾“å‡ºé‡å®šå‘åˆ°æ ‡å‡†è¾“å‡ºcommand &gt; output.log 2&gt;&amp;1  :: å°†æ‰€æœ‰è¾“å‡ºé‡å®šå‘åˆ°æ–‡ä»¶\næ§åˆ¶ç»“æ„\nif è¯­å¥\n@echo offset var=10:: åŸºæœ¬ifè¯­å¥if %var% equ 10 (    echo å˜é‡ç­‰äº10):: if-elseè¯­å¥if %var% gtr 5 (    echo å˜é‡å¤§äº5) else (    echo å˜é‡å°äºç­‰äº5):: æ–‡ä»¶/ç›®å½•æ£€æŸ¥if exist &quot;file.txt&quot; (    echo æ–‡ä»¶å­˜åœ¨)if not exist &quot;folder&quot; (    mkdir &quot;folder&quot;):: å­—ç¬¦ä¸²æ¯”è¾ƒif &quot;string1&quot;==&quot;string2&quot; (    echo å­—ç¬¦ä¸²ç›¸ç­‰)\nfor å¾ªç¯\n@echo off:: éå†æ–‡ä»¶for %%f in (*.txt) do (    echo æ–‡ä»¶: %%f):: éå†ç›®å½•for /d %%d in (*) do (    echo ç›®å½•: %%d):: éå†æ•°å­—åºåˆ—for /l %%i in (1,1,5) do (    echo æ•°å­—: %%i):: éå†å‘½ä»¤è¾“å‡ºfor /f &quot;delims=&quot; %%a in (&#x27;dir /b *.txt&#x27;) do (    echo æ–‡ä»¶: %%a):: éå†æ–‡ä»¶å†…å®¹for /f &quot;tokens=1,2 delims=,&quot; %%a in (data.csv) do (    echo åˆ—1: %%a, åˆ—2: %%b)\ngoto è¯­å¥å’Œæ ‡ç­¾\n@echo offecho å¼€å§‹goto middle:startecho è¿™æ˜¯å¼€å§‹æ ‡ç­¾goto end:middleecho è¿™æ˜¯ä¸­é—´æ ‡ç­¾goto start:endecho è¿™æ˜¯ç»“æŸæ ‡ç­¾\ncall è¯­å¥\n@echo offcall :subroutine &quot;Hello World&quot;goto end:subroutineecho æ¥æ”¶åˆ°çš„å‚æ•°: %1exit /b  :: è¿”å›ä¸»ç¨‹åº:endecho ä¸»ç¨‹åºç»“æŸ\né«˜çº§æ¦‚å¿µ\nå»¶è¿Ÿå˜é‡æ‰©å±•\nå»¶è¿Ÿå˜é‡æ‰©å±•å…è®¸åœ¨ä»£ç å—ä¸­æ›´æ–°å’Œä½¿ç”¨å˜é‡ï¼š\n@echo offsetlocal enabledelayedexpansionset count=0for %%i in (*.txt) do (    set /a count+=1    echo !count!: %%i  :: ä½¿ç”¨!è€Œé%æ¥è®¿é—®å»¶è¿Ÿæ‰©å±•å˜é‡)echo æ€»å…±æœ‰ !count! ä¸ªtxtæ–‡ä»¶endlocal\né”™è¯¯å¤„ç†\n@echo off:: æ£€æŸ¥å‘½ä»¤æ‰§è¡Œç»“æœcopy file1.txt file2.txtif %ERRORLEVEL% equ 0 (    echo å¤åˆ¶æˆåŠŸ) else (    echo å¤åˆ¶å¤±è´¥ï¼Œé”™è¯¯ä»£ç : %ERRORLEVEL%):: ä½¿ç”¨æ¡ä»¶æ‰§è¡Œç¬¦å·copy file1.txt file2.txt &amp;&amp; echo å¤åˆ¶æˆåŠŸ || echo å¤åˆ¶å¤±è´¥:: è®¾ç½®é”™è¯¯çº§åˆ«@echo offif &quot;%1&quot;==&quot;&quot; (    echo å‚æ•°ç¼ºå¤±    exit /b 1  :: è®¾ç½®é”™è¯¯çº§åˆ«ä¸º1)echo å‚æ•°: %1exit /b 0  :: è®¾ç½®é”™è¯¯çº§åˆ«ä¸º0\nç¯å¢ƒå˜é‡æ“ä½œ\n@echo off:: æ˜¾ç¤ºæ‰€æœ‰ç¯å¢ƒå˜é‡set:: è®¾ç½®ä¸´æ—¶ç¯å¢ƒå˜é‡set temp_var=ä¸´æ—¶å€¼echo %temp_var%:: æ°¸ä¹…è®¾ç½®ç¯å¢ƒå˜é‡ï¼ˆéœ€è¦ç®¡ç†å‘˜æƒé™ï¼‰setx permanent_var &quot;æ°¸ä¹…å€¼&quot;:: è¯»å–æ³¨å†Œè¡¨ä¸­çš„ç¯å¢ƒå˜é‡for /f &quot;skip=2 tokens=3*&quot; %%a in (&#x27;reg query &quot;HKCU\\Environment&quot; /v PATH&#x27;) do (    echo å½“å‰ç”¨æˆ·PATH: %%a %%b)\næ•°ç»„\nè™½ç„¶æ‰¹å¤„ç†ä¸ç›´æ¥æ”¯æŒæ•°ç»„ï¼Œä½†å¯ä»¥æ¨¡æ‹Ÿæ•°ç»„åŠŸèƒ½ï¼š\n@echo offsetlocal enabledelayedexpansion:: å®šä¹‰æ•°ç»„set arr[0]=ç¬¬ä¸€ä¸ªå…ƒç´ set arr[1]=ç¬¬äºŒä¸ªå…ƒç´ set arr[2]=ç¬¬ä¸‰ä¸ªå…ƒç´ :: è®¿é—®æ•°ç»„å…ƒç´ echo %arr[0]%echo %arr[1]%echo %arr[2]%:: éå†æ•°ç»„for /l %%i in (0,1,2) do (    echo !arr[%%i]!):: è·å–æ•°ç»„é•¿åº¦set &quot;array_length=0&quot;:count_loopif defined arr[%array_length%] (    set /a array_length+=1    goto count_loop)echo æ•°ç»„é•¿åº¦: %array_length%endlocal\nå­—ç¬¦ä¸²æ“ä½œ\n@echo offsetlocal enabledelayedexpansion:: å­—ç¬¦ä¸²è¿æ¥set str1=Helloset str2=Worldset combined=%str1% %str2%echo %combined%:: å­—ç¬¦ä¸²é•¿åº¦set test_str=This is a test stringset &quot;len=0&quot;:len_loopif &quot;!test_str:~%len%!&quot; neq &quot;&quot; (    set /a len+=1    goto len_loop)echo å­—ç¬¦ä¸²é•¿åº¦: %len%:: å­—ç¬¦ä¸²æˆªå–set full_str=Hello Worldecho å‰5ä¸ªå­—ç¬¦: %full_str:~0,5%echo ä»ç¬¬6ä¸ªå­—ç¬¦å¼€å§‹: %full_str:~5%echo æœ€å5ä¸ªå­—ç¬¦: %full_str:~-5%:: å­—ç¬¦ä¸²æ›¿æ¢set original=Hello Worldset replaced=%original:World=Batch%echo %replaced%endlocal\nå®ç”¨è„šæœ¬ç¤ºä¾‹\næ–‡ä»¶å¤‡ä»½è„šæœ¬\n@echo offsetlocal enabledelayedexpansion:: è®¾ç½®å¤‡ä»½å‚æ•°set &quot;source=C:\\Data&quot;set &quot;backup_root=D:\\Backup&quot;set &quot;backup_folder=%backup_root%\\%DATE:/=-%_%TIME::=-%&quot;set &quot;log_file=%backup_root%\\backup.log&quot;:: åˆ›å»ºå¤‡ä»½ç›®å½•mkdir &quot;%backup_folder%&quot; &gt;nul 2&gt;&amp;1:: å¼€å§‹å¤‡ä»½echo ======================================== &gt;&gt; &quot;%log_file%&quot;echo å¤‡ä»½å¼€å§‹: %DATE% %TIME% &gt;&gt; &quot;%log_file%&quot;echo æºç›®å½•: %source% &gt;&gt; &quot;%log_file%&quot;echo å¤‡ä»½ç›®å½•: %backup_folder% &gt;&gt; &quot;%log_file%&quot;:: æ‰§è¡Œå¤‡ä»½xcopy &quot;%source%&quot; &quot;%backup_folder%&quot; /E /H /R /Y /Z &gt;&gt; &quot;%log_file%&quot; 2&gt;&amp;1:: æ£€æŸ¥å¤‡ä»½ç»“æœif %ERRORLEVEL% equ 0 (    echo å¤‡ä»½æˆåŠŸå®Œæˆ &gt;&gt; &quot;%log_file%&quot;    echo å¤‡ä»½æ–‡ä»¶å·²ä¿å­˜åˆ°: %backup_folder%    echo æ—¥å¿—æ–‡ä»¶: %log_file%) else (    echo å¤‡ä»½å¤±è´¥ &gt;&gt; &quot;%log_file%&quot;    echo å¤‡ä»½è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯ï¼Œè¯·æŸ¥çœ‹æ—¥å¿—æ–‡ä»¶: %log_file%    exit /b 1)echo å¤‡ä»½ç»“æŸ: %DATE% %TIME% &gt;&gt; &quot;%log_file%&quot;echo ======================================== &gt;&gt; &quot;%log_file%&quot;:: æ¸…ç†æ—§å¤‡ä»½ï¼ˆä¿ç•™æœ€è¿‘7å¤©ï¼‰forfiles /p &quot;%backup_root%&quot; /s /m * /d -7 /c &quot;cmd /c if @isdir==TRUE rmdir /s /q @path&quot; &gt;&gt; &quot;%log_file%&quot; 2&gt;&amp;1endlocalpause\nç³»ç»Ÿä¿¡æ¯æ”¶é›†è„šæœ¬\n@echo offsetlocal enabledelayedexpansionset &quot;report_file=system_info_%DATE:/=-%_%TIME::=-%.txt&quot;:: æ”¶é›†ç³»ç»Ÿä¿¡æ¯echo ç³»ç»Ÿä¿¡æ¯æŠ¥å‘Š &gt; &quot;%report_file%&quot;echo ======================== &gt;&gt; &quot;%report_file%&quot;echo ç”Ÿæˆæ—¶é—´: %DATE% %TIME% &gt;&gt; &quot;%report_file%&quot;echo ======================== &gt;&gt; &quot;%report_file%&quot;echo. &gt;&gt; &quot;%report_file%&quot;echo ã€æ“ä½œç³»ç»Ÿä¿¡æ¯ã€‘ &gt;&gt; &quot;%report_file%&quot;ver &gt;&gt; &quot;%report_file%&quot;echo æ“ä½œç³»ç»Ÿ: %OS% &gt;&gt; &quot;%report_file%&quot;echo ç³»ç»Ÿç›®å½•: %SystemRoot% &gt;&gt; &quot;%report_file%&quot;echo. &gt;&gt; &quot;%report_file%&quot;echo ã€ç¡¬ä»¶ä¿¡æ¯ã€‘ &gt;&gt; &quot;%report_file%&quot;echo è®¡ç®—æœºåç§°: %COMPUTERNAME% &gt;&gt; &quot;%report_file%&quot;echo å¤„ç†å™¨æ¶æ„: %PROCESSOR_ARCHITECTURE% &gt;&gt; &quot;%report_file%&quot;echo å¤„ç†å™¨å‹å·: %PROCESSOR_IDENTFIER% &gt;&gt; &quot;%report_file%&quot;echo å¤„ç†å™¨æ•°é‡: %NUMBER_OF_PROCESSORS% &gt;&gt; &quot;%report_file%&quot;echo. &gt;&gt; &quot;%report_file%&quot;echo ã€å†…å­˜ä¿¡æ¯ã€‘ &gt;&gt; &quot;%report_file%&quot;systeminfo | findstr /C:&quot;Total Physical Memory&quot; &gt;&gt; &quot;%report_file%&quot;systeminfo | findstr /C:&quot;Available Physical Memory&quot; &gt;&gt; &quot;%report_file%&quot;echo. &gt;&gt; &quot;%report_file%&quot;echo ã€ç£ç›˜ä¿¡æ¯ã€‘ &gt;&gt; &quot;%report_file%&quot;wmic logicaldisk get caption,size,freespace &gt;&gt; &quot;%report_file%&quot;echo. &gt;&gt; &quot;%report_file%&quot;echo ã€ç”¨æˆ·ä¿¡æ¯ã€‘ &gt;&gt; &quot;%report_file%&quot;echo å½“å‰ç”¨æˆ·: %USERNAME% &gt;&gt; &quot;%report_file%&quot;echo ç”¨æˆ·åŸŸ: %USERDOMAIN% &gt;&gt; &quot;%report_file%&quot;echo ç”¨æˆ·é…ç½®æ–‡ä»¶: %USERPROFILE% &gt;&gt; &quot;%report_file%&quot;echo. &gt;&gt; &quot;%report_file%&quot;echo ã€ç½‘ç»œä¿¡æ¯ã€‘ &gt;&gt; &quot;%report_file%&quot;ipconfig /all | findstr /C:&quot;IPv4 Address&quot; /C:&quot;Subnet Mask&quot; /C:&quot;Default Gateway&quot; &gt;&gt; &quot;%report_file%&quot;echo. &gt;&gt; &quot;%report_file%&quot;echo ã€ç¯å¢ƒå˜é‡ã€‘ &gt;&gt; &quot;%report_file%&quot;echo PATH: %PATH% &gt;&gt; &quot;%report_file%&quot;echo. &gt;&gt; &quot;%report_file%&quot;echo æŠ¥å‘Šå·²ç”Ÿæˆ: %report_file%start notepad &quot;%report_file%&quot;endlocalpause\næ–‡ä»¶æ‰¹é‡é‡å‘½åè„šæœ¬\n@echo offsetlocal enabledelayedexpansionif &quot;%1&quot;==&quot;&quot; (    echo ç”¨æ³•: %0 [æ–‡ä»¶ç±»å‹] [å‰ç¼€]    echo ç¤ºä¾‹: %0 .txt &quot;æ–‡æ¡£_&quot;    exit /b 1)set &quot;file_type=%1&quot;set &quot;prefix=%2&quot;set &quot;count=1&quot;echo å¼€å§‹é‡å‘½å%file_type%æ–‡ä»¶...echo å‰ç¼€: %prefix%for /f &quot;delims=&quot; %%f in (&#x27;dir /b /a-d /o:n *%file_type%&#x27;) do (    set &quot;extension=%%~xf&quot;    set &quot;new_name=%prefix%!count!!extension!&quot;        echo &quot;%%f&quot; -^&gt; &quot;!new_name!&quot;    ren &quot;%%f&quot; &quot;!new_name!&quot;        set /a count+=1)echo é‡å‘½åå®Œæˆï¼Œå…±å¤„ç†äº† %count% ä¸ªæ–‡ä»¶endlocalpause\næ‰¹é‡æ–‡ä»¶å¤„ç†è„šæœ¬\n@echo offsetlocal enabledelayedexpansion:: æ£€æŸ¥å‚æ•°if &quot;%1&quot;==&quot;&quot; (    echo ç”¨æ³•: %0 [æºç›®å½•] [ç›®æ ‡ç›®å½•]    exit /b 1)set &quot;source_dir=%1&quot;set &quot;dest_dir=%2&quot;:: åˆ›å»ºç›®æ ‡ç›®å½•if not exist &quot;%dest_dir%&quot; (    mkdir &quot;%dest_dir%&quot;    echo åˆ›å»ºç›®æ ‡ç›®å½•: %dest_dir%):: å¤„ç†æ‰€æœ‰txtæ–‡ä»¶set &quot;count=0&quot;for /r &quot;%source_dir%&quot; %%f in (*.txt) do (    set /a count+=1        :: è·å–æ–‡ä»¶åå’Œè·¯å¾„    set &quot;file_name=%%~nxf&quot;    set &quot;file_path=%%~dpFf&quot;        :: å¤åˆ¶æ–‡ä»¶    copy &quot;%%f&quot; &quot;%dest_dir%\\!file_name!&quot; &gt;nul        :: æ˜¾ç¤ºè¿›åº¦    echo å¤„ç†æ–‡ä»¶ !count!: !file_name!)echo å¤„ç†å®Œæˆï¼Œå…±å¤åˆ¶äº† %count% ä¸ªæ–‡ä»¶endlocalpause\nè¿™ä¸ªå®Œæ•´çš„æ‰¹å¤„ç†è„šæœ¬æ•™ç¨‹æ¶µç›–äº†ä»åŸºç¡€æ¦‚å¿µåˆ°é«˜çº§æŠ€å·§çš„æ‰€æœ‰å†…å®¹ï¼ŒåŒ…æ‹¬ç‰¹æ®Šå˜é‡æ‰©å±•ã€å‚æ•°å¤„ç†ã€æ§åˆ¶ç»“æ„å’Œå®ç”¨è„šæœ¬ç¤ºä¾‹ã€‚æŒæ¡è¿™äº›çŸ¥è¯†å¯ä»¥å¸®åŠ©ä½ åˆ›å»ºå¼ºå¤§çš„è‡ªåŠ¨åŒ–è„šæœ¬ï¼Œæé«˜å·¥ä½œæ•ˆç‡ã€‚\n","categories":["æ“ä½œç³»ç»Ÿ"],"tags":["windows"]}]